<html>
<head>
<title>DRYing up your forms in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中干燥您的表单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/reducing-development-routine-with-reusable-forms-in-pure-react-9ef7e542518e?source=collection_archive---------10-----------------------#2020-04-16">https://javascript.plainenglish.io/reducing-development-routine-with-reusable-forms-in-pure-react-9ef7e542518e?source=collection_archive---------10-----------------------#2020-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b817" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想每个人在他的职业生涯中都至少做过一次有很多表格的项目。每次我开发一个管理面板或一个有很多搜索表单的平台时，我都会面临这样的任务，这种例行公事真的让我很沮丧。</p><p id="c8f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过几个项目，我开发了一个简单的解决方案，我想与你分享。所以，我们继续吧！</p><p id="1c4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个解决方案的思想是构建一个表单组件，它控制表单数据和所有表单组件的状态。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d705934c502a4072565e2e35bf2bc7b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KgKbo1hoHkK96Org"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@qwitka?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Maksym Kaharlytskyi</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="1a4f" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">第一步</h2><p id="eeb6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们从项目设置开始。例如，我将使用<code class="fe ma mb mc md b"><a class="ae lb" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">create-react-app</a></code>命令。应用程序设置好后，我们就可以开始开发了。</p><p id="381a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将编写一些表单控件组件:input和select。在这个概念中，每个表单控件组件都必须实现定义的接口:</p><ul class=""><li id="4eb1" class="me mf iq jp b jq jr ju jv jy mg kc mh kg mi kk mj mk ml mm bi translated">每个控件都可以有<code class="fe ma mb mc md b">onChange</code>方法</li><li id="236d" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">每个控件必须使用<code class="fe ma mb mc md b">name</code>道具来定义表单数据中的一个键</li><li id="4af6" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">每个控件都可以使用<code class="fe ma mb mc md b">value</code>属性来表示表单数据中的值</li><li id="1785" class="me mf iq jp b jq mn ju mo jy mp kc mq kg mr kk mj mk ml mm bi translated">每个控件可以有一个<code class="fe ma mb mc md b">label</code>道具和一个<code class="fe ma mb mc md b">className</code>道具</li></ul><p id="0dc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将用一个基本的道具类型<code class="fe ma mb mc md b">FormControlBasePropTypes</code>来控制这个接口，并将定义放在<code class="fe ma mb mc md b">base-prop-types.js</code>文件中。</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="ecd1" class="lc ld iq md b gy mw mx l my mz">import PropTypes from 'prop-types';</span><span id="f50f" class="lc ld iq md b gy na mx l my mz">export const <strong class="md ir"><em class="nb">FormControlBasePropTypes </em></strong>= {<br/>  className: PropTypes.<strong class="md ir"><em class="nb">string</em></strong>,<br/>  label: PropTypes.<strong class="md ir"><em class="nb">string</em></strong>,<br/>  name: PropTypes.<strong class="md ir"><em class="nb">string</em></strong>.isRequired,<br/>  onChange: PropTypes.<strong class="md ir"><em class="nb">func</em></strong>,<br/>  value: PropTypes.oneOfType([<br/>    PropTypes.<strong class="md ir"><em class="nb">string</em></strong>,<br/>    PropTypes.<strong class="md ir"><em class="nb">number</em></strong>,<br/>  ]),<br/>};</span></pre><p id="7ee2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nb">这个</em> <code class="fe ma mb mc md b"><em class="nb">onChange</em></code> <em class="nb">和</em> <code class="fe ma mb mc md b"><em class="nb">value</em></code> <em class="nb">是可选的，因为我们不会把这个道具直接定义到组件上，但是我们后面会讲到。</em></p><h2 id="9c30" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">制造组件</h2><p id="457e" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">对于表单控件组件，我们将定义基本样式和HTML结构，这种结构应该取决于项目的设计和要求，所以让我们说，我们有一个输入下单独标签的表单控件。然后，<code class="fe ma mb mc md b">Input</code>组件将包含以下代码:</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="d203" class="lc ld iq md b gy mw mx l my mz">import <strong class="md ir"><em class="nb">React </em></strong>from 'react';<br/>import classnames from 'classnames';<br/>import { <strong class="md ir"><em class="nb">FormControlBasePropTypes </em></strong>} from '../base-prop-types';<br/>import './Input.css';<br/><br/>const Input = ({<br/>  className,<br/>  label,<br/>  name,<br/>  value,<br/>  onChange,<br/>}) =&gt; (<br/>  &lt;label className={classnames('form-control', className)}&gt;<br/>    {label &amp;&amp; (<br/>      &lt;span className="form-control__label"&gt;<br/>        {label}<br/>      &lt;/span&gt;<br/>    )}<br/>    &lt;input<br/>      className="input form-control__input"<br/>      name={name}<br/>      value={value}<br/>      onChange={onChange}<br/>    /&gt;<br/>  &lt;/label&gt;<br/>);<br/><br/>Input.propTypes = {<br/>  ...<strong class="md ir"><em class="nb">FormControlBasePropTypes</em></strong>,<br/>};<br/><br/>Input.defaultProps = {<br/>  className: '',<br/>  label: '',<br/>  value: '',<br/>};<br/><br/>export default Input;</span></pre><p id="80de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nb">这里我使用</em> <code class="fe ma mb mc md b"><a class="ae lb" href="https://github.com/JedWatson/classnames#readme" rel="noopener ugc nofollow" target="_blank"><em class="nb">classnames</em></a></code> <em class="nb">进行简单灵活的类名管理。</em></p><p id="715a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<code class="fe ma mb mc md b">Select</code>组件，我们还必须定义一个附加属性<code class="fe ma mb mc md b">options</code>来定义select的选项。<code class="fe ma mb mc md b">Select</code>组件将包含以下代码:</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="3e65" class="lc ld iq md b gy mw mx l my mz">import <strong class="md ir"><em class="nb">React </em></strong>from 'react';<br/>import PropTypes from 'prop-types';<br/>import classnames from 'classnames';<br/>import { <strong class="md ir"><em class="nb">FormControlBasePropTypes </em></strong>} from '../base-prop-types';<br/>import './Select.css';<br/><br/>const Select = ({<br/>  className,<br/>  label,<br/>  name,<br/>  value,<br/>  options,<br/>  onChange,<br/>}) =&gt; (<br/>  &lt;label className={classnames('form-control', className)}&gt;<br/>    {label &amp;&amp; (<br/>      &lt;span className="form-control__label"&gt;<br/>        {label}<br/>      &lt;/span&gt;<br/>    )}<br/>    &lt;select<br/>      className="select form-control__input"<br/>      name={name}<br/>      value={value}<br/>      onChange={onChange}<br/>    &gt;<br/>      &lt;option value=""&gt;---&lt;/option&gt;<br/>      {options.map(option =&gt; (<br/>        &lt;option key={option} value={option}&gt;<br/>          {option}<br/>        &lt;/option&gt;<br/>      ))}<br/>    &lt;/select&gt;<br/>  &lt;/label&gt;<br/>);<br/><br/>Select.propTypes = {<br/>  ...<strong class="md ir"><em class="nb">FormControlBasePropTypes</em></strong>,<br/>  options: PropTypes.arrayOf(<br/>    PropTypes.oneOfType([<br/>      PropTypes.<strong class="md ir"><em class="nb">string</em></strong>,<br/>      PropTypes.<strong class="md ir"><em class="nb">number</em></strong>,<br/>    ])<br/>  ).isRequired,<br/>};<br/><br/>Select.defaultProps = {<br/>  className: '',<br/>  label: '',<br/>  value: '',<br/>};<br/><br/>export default Select;</span></pre><p id="093a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们可以从<code class="fe ma mb mc md b">Form</code>组件本身开始。组件的核心如下所示:</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="ccd7" class="lc ld iq md b gy mw mx l my mz">import <strong class="md ir"><em class="nb">React </em></strong>from 'react';<br/>import PropTypes from 'prop-types';<br/>import classnames from 'classnames';<br/>import './Form.css';</span><span id="3968" class="lc ld iq md b gy na mx l my mz">const Form = ({<br/>  className,<br/>  children,<br/>}) =&gt; (<br/>  &lt;form className={classnames('form', className)}&gt;<br/>    {children}</span><span id="bc09" class="lc ld iq md b gy na mx l my mz">    &lt;button<br/>      className="button form__submit"<br/>      type="submit"<br/>    &gt;<br/>      Submit<br/>    &lt;/button&gt;<br/>  &lt;/form&gt;<br/>);</span><span id="3c9e" class="lc ld iq md b gy na mx l my mz">Form.propTypes = {<br/>  children: PropTypes.oneOfType([<br/>    PropTypes.arrayOf(<br/>      PropTypes.<strong class="md ir"><em class="nb">node</em></strong>,<br/>    ),<br/>    PropTypes.<strong class="md ir"><em class="nb">node</em></strong>,<br/>  ]).isRequired,<br/>  className: PropTypes.<strong class="md ir"><em class="nb">string</em></strong>,<br/>};</span><span id="c98e" class="lc ld iq md b gy na mx l my mz">Form.defaultProps = {<br/>  className: '',<br/>};</span><span id="38c4" class="lc ld iq md b gy na mx l my mz">export default Form;</span></pre><p id="3669" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任何父组件中的表单显示将如下所示。请注意，应该在这一步定义<code class="fe ma mb mc md b">name</code>属性。</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="6396" class="lc ld iq md b gy mw mx l my mz">&lt;Form className="app__form"&gt;<br/>  &lt;Input<br/>    label="Some input"<br/>    name="input"<br/>  /&gt;<br/>  &lt;Select<br/>    label="Some select"<br/>    name="select"<br/>    options={['one', 'two', 'three']}<br/>  /&gt;<br/>&lt;/Form&gt;</span></pre><p id="da80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能会想:“那又怎样？这里没什么有趣的。”但是请耐心点。“魔术”马上就要开始了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/cf4e00a7f7bf7e1d03a0232a20dec5f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*wxUzIWZkpPUsoO2p3NzkcA.png"/></div></figure><p id="5aff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在将所有的东西绑定在一起之后，我们在<code class="fe ma mb mc md b">Form</code>组件中获得了<code class="fe ma mb mc md b">Select</code>和<code class="fe ma mb mc md b">Input</code>组件，但是结果并不令人满意，开发者的控制台充满了错误，所有的东西都无法工作。</p><p id="b897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，让我们变戏法吧！</p><h2 id="ce03" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">魔力</h2><p id="54bf" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在React中，你可以在<code class="fe ma mb mc md b"><a class="ae lb" href="https://reactjs.org/docs/react-api.html?#cloneelement" rel="noopener ugc nofollow" target="_blank">React.cloneElement</a></code>函数的帮助下<a class="ae lb" href="https://reactjs.org/docs/react-api.html#reactchildrentoarray" rel="noopener ugc nofollow" target="_blank">迭代子节点</a>并将一些道具应用于组件。这正是我们接下来要做的。</p><p id="df4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们不会直接在<code class="fe ma mb mc md b">Form</code>中渲染<code class="fe ma mb mc md b">children</code>，而是循环遍历所有子节点，并应用一些额外的道具，这些道具是我们在<code class="fe ma mb mc md b">FormControlBasePropTypes</code>中定义的。此外，我们将应用一个<code class="fe ma mb mc md b">className</code>道具，使所有控件在表单中看起来相似。</p><p id="9d9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ma mb mc md b">Form</code>将在存储中存储每个控件的值，所以我们首先定义存储。</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="88c9" class="lc ld iq md b gy mw mx l my mz">const [formValue, setFormValue] = useState({});</span></pre><p id="1e83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们定义了<code class="fe ma mb mc md b">formValue</code>更新处理程序。我们期望我们的控件应该在内部<code class="fe ma mb mc md b">onChange</code>事件之后触发<code class="fe ma mb mc md b">Event</code>对象，因此我们可以提取<code class="fe ma mb mc md b">name</code>和<code class="fe ma mb mc md b">value</code>。</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="ef0a" class="lc ld iq md b gy mw mx l my mz">const onFormValueUpdate = ({ target: { name, value } }) =&gt; {<br/>  setFormValue({<br/>    ...formValue,<br/>    [name]: value,<br/>  });<br/>};</span></pre><p id="a5a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">子渲染器代码变成带有以下代码的<code class="fe ma mb mc md b">map</code>循环:</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="be0e" class="lc ld iq md b gy mw mx l my mz"><strong class="md ir"><em class="nb">React</em></strong>.<strong class="md ir"><em class="nb">Children<br/>  </em></strong>.toArray(children)<br/>  .map((child) =&gt; <strong class="md ir"><em class="nb">React</em></strong>.cloneElement(child, {<br/>    value: formValue[child.props.name] || '',<br/>    className: classnames(child.props.className, 'form__control'),<br/>    onChange: onFormValueUpdate,<br/>  }))</span></pre><p id="72df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们添加了一个组件的<code class="fe ma mb mc md b">value</code>、<code class="fe ma mb mc md b">className</code>和<code class="fe ma mb mc md b">onChange</code>处理程序。现在，我们的组件看起来更好了，表单数据正在填充。但是我们仍然无法访问表单数据。</p><p id="7edc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们完成我们的表格。我们应该将<code class="fe ma mb mc md b">onSubmit</code>属性添加到我们的<code class="fe ma mb mc md b">Form</code>组件中，并将处理程序添加到表单标签中。</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="f9b8" class="lc ld iq md b gy mw mx l my mz">const Form = ({<br/>  className,<br/>  children,<br/>  onSubmit,<br/>}) =&gt; {<br/>  ...<br/>  const onSubmitHandler = (e) =&gt; {<br/>    e.preventDefault();<br/>    onSubmit(formValue);<br/>  };<br/><br/>  return (<br/>    &lt;form<br/>      onSubmit={onSubmitHandler}<br/>      className={classnames('form', className)}<br/>    &gt;<br/>...</span></pre><p id="3d3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们有了一个完全有效且可扩展的有状态表单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/a22d7d2b0484712c7012cb7e764533f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*He93LshJXQM-yGaM3Yq5Uw.png"/></div></div></figure><p id="f021" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">甚至我们的表单数据的<code class="fe ma mb mc md b">console.log</code>也在工作！</p><pre class="km kn ko kp gt ms md mt mu aw mv bi"><span id="e504" class="lc ld iq md b gy mw mx l my mz">{<br/>  input: “some text”,<br/>  select: “two”<br/>}</span></pre><h2 id="e019" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">结论</h2><p id="bf6a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这个例子并不理想，应该通过测试、额外的检查和组件来增强。例如，您可以添加表单重置按钮、错误突出显示等等。</p><p id="cb03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这个想法本身可以帮助你建立你的表单。</p><p id="0bc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以通过<a class="ae lb" href="https://github.com/Nick-Omen/react-form-example" rel="noopener ugc nofollow" target="_blank">链接</a>在Github上找到完整的代码。</p><p id="345a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请随意评论，我欢迎任何建议和批评。</p><p id="5cff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你的阅读！</p><h2 id="d6d8" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">用简单英语写的JavaScript的注释</h2><p id="4eee" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae lb" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jp ir">AI in Plain English</strong></a><a class="ae lb" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jp ir">UX in Plain English</strong></a><a class="ae lb" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jp ir">Python in Plain English</strong></a><strong class="jp ir"/>——谢谢，继续学习！</p><p id="ee00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae lb" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">submissions @ plain English . io</strong></a><strong class="jp ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>