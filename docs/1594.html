<html>
<head>
<title>React Native — Full authentication flow with Spotify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">react Native—Spotify的完整认证流程</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-full-authentication-flow-with-spotify-bc0a5b895696?source=collection_archive---------1-----------------------#2020-04-05">https://javascript.plainenglish.io/react-native-full-authentication-flow-with-spotify-bc0a5b895696?source=collection_archive---------1-----------------------#2020-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="723a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">React Native中的身份验证可能是一次地狱之旅。让我们尝试构建一个React原生应用程序，并使用Spotify作为身份验证提供者。</p><p id="fcfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">我的目标是基于Spotify API开发一款应用。第一个挑战是建立一个认证流程，允许Spotify用户登录我的应用程序。</em></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/072089f800e7eac639434630eee802cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*u9twdmc622Ftu41knjfMHg.png"/></div></figure><h1 id="523f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第1部分:OAuth——它是如何工作的？</h1><blockquote class="lz ma mb"><p id="6fa5" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><em class="iq"/><a class="ae mf" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"><em class="iq">OAuth 2.0是行业标准的授权协议。</em></a>T10】</p></blockquote><p id="f3db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">如果您不熟悉oAuth，我建议您阅读本文档。它会给你一个主要概念的清晰概述。</em></p><p id="8924" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要的是要知道oAuth支持几个认证流:</p><ul class=""><li id="8afe" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated"><a class="ae mf" href="https://auth0.com/docs/flows/concepts/client-credentials" rel="noopener ugc nofollow" target="_blank">客户凭证流程</a></li><li id="a9e2" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><a class="ae mf" href="https://auth0.com/docs/flows/concepts/auth-code" rel="noopener ugc nofollow" target="_blank">授权代码流程</a></li><li id="ab5d" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><a class="ae mf" href="https://auth0.com/docs/api-auth/grant/password" rel="noopener ugc nofollow" target="_blank">资源所有者密码凭证授予</a></li></ul><p id="c0dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们设置中最常见的流程是授权代码流程:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mu"><img src="../Images/a6dfa047fba82513fbd8f39fe22dbd20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_Ah1So32VkdEAYue.png"/></div></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h2 id="0060" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">Spotify授权流程</h2><p id="5980" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">我们将使用Spotify作为oAuth提供商。所以我们来看看他们的授权流程。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nq"><img src="../Images/82425912c86e06ca6ff7f2f295ad3130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w1BkIZ2Le7PCtzqy.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Spotify authorization flow</figcaption></figure><p id="70a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们浏览一下该模式，并尝试理解将会发生什么:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nv"><img src="../Images/ea79f3ce7d2705615f1cef8269148c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgqAvue7cMd6Hw0e-0hsQg.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Spotify authorization flow — part 1</figcaption></figure><p id="2621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的客户端应用程序将要求用户通过我们的oAuth提供者登录。Spotify登录页面将显示一些关于我们的应用程序需要的授权范围的附加信息。用户登录并批准授权范围。<strong class="jp ir"> (A) </strong> <br/>他将被重定向到我们的客户端应用程序的预定义URL以及Spotify提供的代码。这个代码的意思是:用户同意登录您的应用程序。<strong class="jp ir"> (B) </strong></p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nw"><img src="../Images/a3e96b49bb33d1f5b6d8eb5e25d9a6d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AaLpALR2sQOYPP3wvE7ysg.png"/></div></div></figure><p id="52ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2 </strong>现在，Spotify知道用户想要验证你的应用程序。但是Spotify并不能100%确定这个应用就是<em class="kl"> </em>你的应用。<br/>所以在你拥有代码的情况下，你不能以用户的名义执行API调用。<br/>您需要询问访问令牌和刷新令牌。在这一步中，您借助<em class="kl">客户端密码向Spotify证明您是的所有者。<br/> </em>我之前提到过，但是客户端秘密必须保密。这就是为什么我们需要我们的后端API，因为这是一个安全的地方来存储我们的秘密。<br/>我们对我们的后端执行一个调用，包括我们刚刚从Spotify收到的代码。我们的后端将作为一个<em class="kl">代理</em>使用这段代码并注入我们的应用程序的客户端秘密来执行对Spotify的新调用，请求访问令牌和刷新令牌。我们返回访问令牌和刷新令牌。从现在起，我们可以以用户的名义进行呼叫。</p><p id="46cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3 </strong>访问令牌有一个有限的生存时间。使用刷新令牌，我们可以向Spotify索要新的访问令牌。</p><p id="224e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里了解更多:<br/><a class="ae mf" href="https://developer.spotify.com/documentation/general/guides/authorization-guide/#authorization-code-flow" rel="noopener ugc nofollow" target="_blank">https://developer . Spotify . com/documentation/general/guides/authorization-guide/# authorization-code-flow</a></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="f381" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">第2部分:为我们的应用程序设置基础</h1><p id="704e" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated"><em class="kl">您需要Node.js才能继续下面的步骤。<br/></em><a class="ae mf" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a></p><h2 id="c329" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">为Android上的React Native做准备</h2><p id="c912" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">遵循“React Native CLI快速入门”下的官方文档中的步骤。向下滚动到“Android开发环境”，安装Android Studio。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/9c368b48434fb08bd3027f3c81dae0d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*kTzDs1CPma_sVBrE-Z8mMA.png"/></div></figure><div class="od oe gp gr of og"><a href="https://reactnative.dev/docs/environment-setup" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">设置开发环境</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">该页面将帮助您安装和构建您的第一个React本机应用程序。如果您是移动开发的新手，那么…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">反应性发展</p></div></div><div class="op l"><div class="oq l or os ot op ou kz og"/></div></div></a></div><p id="7d7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:我们将在Android上测试我们的应用程序。</p><h1 id="d444" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">注册Spotify应用程序</h1><p id="6e37" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">在<a class="ae mf" href="https://developer.spotify.com/" rel="noopener ugc nofollow" target="_blank">https://developer.spotify.com/</a>上创建一个账户</p><p id="36e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的控制面板中，您会发现一个创建新客户端id的按钮。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/942ddc0e0a8ead3b1ed2f5f6d89c2814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*bqlZO0RC-88tSFIM0ejbUQ.png"/></div></figure><p id="b611" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成所有步骤后，您将看到以下屏幕:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ow"><img src="../Images/f1312e880b3d410f01e8d8147711ae61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oF8V8CUjseVfHxwg3NU3Dg.png"/></div></div></figure><p id="81cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此页面上，您可以编辑您的Spotify应用程序设置。在左上角显示您的<strong class="jp ir">客户ID </strong>和<strong class="jp ir">客户密码</strong>。当按下“编辑设置”按钮时，会弹出添加<strong class="jp ir">重定向URIs </strong>的选项。</p><p id="5836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在接下来的步骤中，您将需要您的客户端ID和客户端密码。目前，<strong class="jp ir">只要记住你可以在这里找到它们</strong>。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="4260" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">初始化我们的React本机应用程序</h1><p id="0b82" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated"><em class="kl">如果您已经有一个React本地项目，请跳过这一部分</em></p><p id="86c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用以下内容初始化项目:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="3962" class="mz lc iq oy b gy pc pd l pe pf">npx react-native init AwesomeProject</span></pre><p id="5bbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:由于npm版本5.2.0 npx预先打包在NPM中。使用npx，您可以直接从npm注册表中使用任何节点包，而无需安装它。过去，我们会全局安装软件包(npm install react-native -g ),然后直接从我们的计算机上使用它。这已经没有必要了，这意味着您将始终使用npm上可用的最新版本。</em></p><p id="d585" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您喜欢的IDE中打开项目。我将在Visual Studio工作。【https://code.visualstudio.com/】T5<br/>T6】</p><p id="194c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑您的文件夹结构:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/08b340074675e7a9239506f577c7612e.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*iI5Qgr1hV4wRf3FxmowDMw.png"/></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="5aeb" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">第3部分:在客户端应用程序中处理身份验证</h1><p id="0bda" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">处理标准oAuth流是很多应用程序都会遇到的事情。所以，在某个地方，已经有人写了这段代码。</p><p id="c14c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用这个库:<a class="ae mf" href="https://github.com/FormidableLabs/react-native-app-auth" rel="noopener ugc nofollow" target="_blank"> react-native-app-auth </a></p><p id="e5a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导航到我们的新项目并安装库:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="914a" class="mz lc iq oy b gy pc pd l pe pf">cd AwesomeProject<br/>npm install react-native-app-auth --save</span></pre><h2 id="2dcf" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">创建身份验证处理程序</h2><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">authenticationHandler.js</figcaption></figure><p id="cc61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们定义了一个将由授权库使用的配置:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pj"><img src="../Images/ace49be3838d4750c3fb87f1227e5f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G8_bTOTxO10QLTjGRG_n-A.png"/></div></div></figure><p id="eb8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们在看什么？</p><p id="27d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ClientID &amp;客户端机密</strong>:Spotify定义的客户端ID &amp;客户端机密。通过<a class="ae mf" href="https://developer.spotify.com/" rel="noopener ugc nofollow" target="_blank">https://developer.spotify.com/</a>进入您的Spotify开发者仪表盘。您将在左上角看到您的应用程序的客户端ID。</p><p id="ba45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">重定向URI:</strong>Spotify将用户登录后重定向到的URI。</p><p id="c4e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">范围:</strong>你的应用程序需要的范围(由Spotify定义)。这定义了您的应用程序在用户帐户上获得哪些授权。</p><p id="cd85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">范围列表:<a class="ae mf" href="https://developer.spotify.com/documentation/general/guides/scopes/" rel="noopener ugc nofollow" target="_blank">https://developer . Spotify . com/documentation/general/guides/scopes/</a></p><p id="32ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">授权端点:</strong>该端点将提示典型的Spotify登录屏幕。</p><p id="22f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">令牌端点:</strong>通过此端点请求访问令牌和刷新令牌</p><p id="5702" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在本页找到有关两个端点的更多信息:</p><p id="a668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mf" href="https://developer.spotify.com/documentation/general/guides/authorization-guide/#authorization-code-flow" rel="noopener ugc nofollow" target="_blank">https://developer . Spotify . com/documentation/general/guides/authorization-guide/# authorization-code-flow</a></p><p id="f261" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">郑重声明:<br/> </strong>你应该<strong class="jp ir">永远不要</strong>通过你的客户端应用或者前端暴露你的客户端秘密。在第二章中，我将解释如何使用Firebase函数作为代理来完成这项工作。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h2 id="287b" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">我们定义了两种方法</h2><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pk"><img src="../Images/e76872619c6fb1c75710a8e696843b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGXATl4AOPk1g2g2Zb8qdg.png"/></div></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h2 id="0a93" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">使其与Android兼容:</h2><p id="639d" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">向android/app/build.gradle添加manifes占位符。</p><p id="a6af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过添加这一行，我们的应用程序将“理解”Spotify身份验证中使用的重定向URI。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pl"><img src="../Images/7cf59e35c80ad7f18ee02dde76d312f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*lHtcMnYpjsJ-Cict-bpRIw.png"/></div></div></figure><h1 id="6c05" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">构建我们的登录屏幕</h1><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="a07a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们将坚持基本原则。目前，我们将只构建一个屏幕:登录屏幕。</p><p id="e73c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在登录屏幕上添加一个按钮。按下此按钮将执行onLogin方法。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pm"><img src="../Images/66ea793ea6b15e221ef4861af3644697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bs0yfcS7WDTfeDGVXyPFrw.png"/></div></div></figure><h1 id="9b5a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">修改App.js</h1><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="cab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">App.js是React本地应用程序的主要入口文件。目前，我们将始终返回我们的登录屏幕。</p><h1 id="1c02" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在Android设备上运行我们的应用</h1><p id="fee2" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">现在在你的Android设备或模拟器上运行这个应用程序:<br/>(如果你不知道如何访问https://reactnative.dev/docs/getting-started<a class="ae mf" href="https://reactnative.dev/docs/getting-started" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a><em class="kl">，向下滚动到“准备Android设备”)</em></p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="eee2" class="mz lc iq oy b gy pc pd l pe pf">npx react-native run-android</span></pre><p id="b98e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这应该是结果:</strong></p><div class="ku kv kw kx gt ab cb"><figure class="pn ky po pp pq pr ps paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/24f5c325f4fe4c0c2fe8c00eb9c7a8a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*2vx6Hmj8diBBVEY8cVDL1Q.png"/></div></figure><figure class="pn ky pt pp pq pr ps paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/cfff01650e6b20cea8fd63f2af85abfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*IQjGMoq-bCGKqlfOl7Pv4w.png"/></div></figure><figure class="pn ky pu pp pq pr ps paragraph-image"><img src="../Images/738ab176e8d129e7886d1c76f7977395.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*VfP8DUuCzOLBKYvqmfy1yg.png"/></figure></div><p id="9e12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧！我们有一个工作，非常简单的应用程序与Spotify认证流程。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="a966" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">现在的版本有什么问题？</h1><ul class=""><li id="f845" class="mg mh iq jp b jq nl ju nm jy pv kc pw kg px kk ml mm mn mo bi translated">我们的客户秘密暴露在我们的客户端应用程序中。客户端秘密应该永远是秘密的，所以这是不好的。我们将在下一章中解决这个问题</li><li id="6128" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">我们只有一个屏幕..我们稍后将添加一些导航。</li></ul></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="4c2a" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">第4部分:后端——使用Firebase作为代理</h1><h2 id="afb8" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">创建一个Firebase项目</h2><p id="b328" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated"><em class="kl">在Firebase控制台中创建一个Firebase项目。如果你知道怎么做，你可以跳过这一部分。</em></p><p id="73ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到<a class="ae mf" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/</a>并按下“开始”。使用您的Google帐户登录或创建一个新帐户。</p><p id="dc5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录后，您将看到以下屏幕:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi py"><img src="../Images/2d5280ce7b2aac1f7a56826653c4a5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZqv0A2ooYjKTwFdYnqSLw.png"/></div></div></figure><p id="865a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按“添加项目”创建一个新的Firebase项目。</p><p id="8ecf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">启用Blaze账户</strong></p><p id="6fbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建新项目时，标准项目计划将是“Spark”。<br/>这是Firebase的免费版本，但是它不允许我们的函数执行外部API调用。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/bb4ceb3072530234f460dd54e5cbcbc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*J3QXob2xooZaZ-FbYIBl-Q.png"/></div></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qa"><img src="../Images/7fce25f22fc6080be6a4bf20bdf8fd4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*piO_ONtABoqhWevfLeGxaQ.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Spark does not allow external calls</figcaption></figure><p id="8f77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">blaze定价计划是一项现收现付计划。这意味着你将不得不关注你的账单计划。我已经在许多演示项目和概念验证中使用了这个计划。我收到的最高月账单是€0.07英镑。请注意，调用Firebase函数的无限循环会给你带来一个非常糟糕的账单。</p><p id="fa0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以阅读这个故事，看看最坏的情况是什么。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qb"><img src="../Images/cb6ed3cf463255e9668c706bde17f26e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26OOJ1h3uUCwUSLBVETtyw.png"/></div></div></figure><p id="4979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以配置预算提醒来跟踪你的账单。我建议这样做，以避免意想不到的账单。</p><h2 id="2478" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">安装Firebase工具</h2><p id="3dee" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">在Firebase控制台中，选择您新创建的项目，然后在左侧菜单中选择Functions。</p><p id="39ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按“开始”</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qc"><img src="../Images/3f6fee821fe62c16e9dd7e75972af41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYdSUJkd1RvRdMNrCioy9Q.png"/></div></div></figure><ul class=""><li id="44ff" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">安装firebase工具(-g表示我们将全局安装，因此我们可以在任何地方使用firebase工具):</li></ul><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="c469" class="mz lc iq oy b gy pc pd l pe pf">npm install -g firebase-tools</span></pre><h2 id="b960" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">初始化我们的Firebase函数+ Express项目</h2><p id="c49e" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">现在打开命令提示符，导航到要初始化项目的文件夹:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="de6b" class="mz lc iq oy b gy pc pd l pe pf">firebase init</span></pre><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/0f9293a30827041478a5830313f28309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*LWdGrVz52n6-MS5DT7iBgQ.png"/></div></figure><ul class=""><li id="df00" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">选择功能</li><li id="292b" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">使用现有项目</li><li id="3492" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">选择您新创建的项目</li><li id="7192" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">选择Javascript <br/> <em class="kl">我们不会在这个演示中使用ESLint，但是我建议在真实项目中使用它</em></li><li id="7148" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">现在不要安装与npm的依赖关系</li></ul><p id="855c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到这个屏幕:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qe"><img src="../Images/37930dfb8cc8d295f4be9d6c919d35ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*HecnA8LTiiYbKleiV0Ij3A.png"/></div></figure><p id="7d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进入functions文件夹并安装express:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="1857" class="mz lc iq oy b gy pc pd l pe pf">cd functions<br/>npm install express --save</span></pre><blockquote class="lz ma mb"><p id="87c8" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">您成功初始化了您的项目！</em> </strong></p></blockquote><p id="84c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们安装npm依赖项并部署我们的第一个(空)项目</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="4afd" class="mz lc iq oy b gy pc pd l pe pf">npm install<br/>cd ../<br/>firebase deploy</span></pre><p id="f6dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">如果你没有得到任何错误，你的空app就部署好了！</em> </strong></p><p id="3256" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止一切顺利。但是你的应用还不能做任何事情:-)</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h2 id="ed17" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">构建、部署和测试我们的第一个API</h2><p id="75bf" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">转到functions文件夹(由firebase工具创建)</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="c3b3" class="mz lc iq oy b gy pc pd l pe pf">npm install body-parser --save</span></pre><p id="d1ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl"> Body-parser是一个中间件，它将以一种更易于使用的格式解析传入的请求。您可以在没有body-parser的情况下工作，但是这让事情变得简单多了。</em></p><p id="7dfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建此文件结构:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/ce83a4c87198540a841818cc39fe8945.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*EsJvjHdlLofLFLGN4w1buw.png"/></div></figure><p id="4b9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注意:有很多关于React原生项目中文件结构的“最佳实践”的文章。为了这个演示，我将保持简单。老实说，我没有goto结构，所以我所有的项目都有稍微不同的结构。</em></p><p id="b465" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> index.js </strong></p><p id="1269" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将是我们的Firebase函数的主文件。在这个文件中，我们将定义要导出的函数，并通过Firebase函数使其可用。通过使用runWith，我们可以定义我们希望分配给函数多少内存，以及我们希望函数在多少秒后超时。</p><p id="f574" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我们定义了一个函数“api ”,它将根据请求运行我们的服务器函数。(从out导入。/src/server.js文件)</p><blockquote class="lz ma mb"><p id="8448" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><a class="ae mf" href="https://firebase.google.com/docs/functions/manage-functions" rel="noopener ugc nofollow" target="_blank">阅读Firebase文档的这一部分</a>以获得定义函数时所有可能性的完整概述。</p></blockquote><p id="faa6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以基本上，我们的index.js会定义我们想要通过Firebase公开哪些函数。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="cdba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个截图中可以看到，Firebase现在可以识别一个内存为2GB、超时为120秒的函数“api”。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qg"><img src="../Images/35f5eccca6de8123f9b424ee938b570b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FImIQKMbuPe72XrxKsdr-Q.png"/></div></div></figure><p id="a0e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> server.js </strong></p><p id="ccac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将是我们的express api的入口文件。对我们的/api/* url的每个调用都将通过这个文件来处理。</p><p id="3ca9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我们定义了一个路径/用户，它将通过。/user/route.js。</p><p id="cf3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果我们想创建一个API端点/api/user/getuser/:id:我们将在。/user/route.js，这是我们将讨论的下一个文件</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="12f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> user/route.js </strong></p><p id="54a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们定义了一个路由:/authentication/</p><p id="2c80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(完整路径API/用户/身份验证)</p><p id="e685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该路由需要一个POST请求，并将通过函数controller.authentication来处理这个调用。/控制器文件。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="c041" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> user/controller.js </strong></p><p id="d5fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">重要提示:我们在后台工作，所以可以使用你的clientSecret。不要在你的前端应用程序中这样做！</em></p><p id="4917" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">控制器文件将处理逻辑。我为用户API端点构建了一个特定的控制器文件。再说一次，找到适合你的项目的文件结构取决于你。</p><p id="1868" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我有一个proxySpotifyToken方法，它将处理我们的授权调用，并在需要的地方注入oAuth提供者的客户机秘密。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="cd8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在这一点上，我们可以对外部端点(API/用户/身份验证)执行Post请求。在我们的正文中，我们除了“代码”或“刷新_令牌”之外都没有填写。有三种情况:</p><ol class=""><li id="f0e3" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk qh mm mn mo bi translated">code和refresh_token为空:我们发送一个响应403，告诉我们的客户端用户没有被授权。</li><li id="abdc" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk qh mm mn mo bi translated">refresh_token已填写:我们的用户之前已经进行了身份验证，客户端正在请求一个新的访问令牌，以便以我们用户的名义执行新的API调用。<br/>我们的回应将是:{ todo:"刷新访问令牌" }</li><li id="b524" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk qh mm mn mo bi translated">代码已填写:客户端没有刷新令牌，因此这是一个新的“新鲜”身份验证。该代码将用于请求访问令牌和刷新令牌。<br/>我们的响应将是:{ todo:"获取刷新令牌&amp;访问令牌" }</li></ol></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><blockquote class="lz ma mb"><p id="154e" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">这有用吗？</p></blockquote><p id="20c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在<a class="ae mf" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>里测试一下这个吧！</p><ul class=""><li id="9c2f" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">正在检索刷新令牌和访问令牌:检查！</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qi"><img src="../Images/1355089c39a7f02acd9b88b93399d2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u8wygSCPWa4sFFkdPqCehA.png"/></div></div></figure><ul class=""><li id="df70" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">刷新访问令牌:检查！</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qj"><img src="../Images/23e71f01d44456ce3aa4e46c12915355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LklO1QLQ8YpnmVaXfefQHA.png"/></div></div></figure><ul class=""><li id="a623" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">未授权呼叫— 403状态:检查！</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qk"><img src="../Images/e415c8b1fdaab9277ff9f961cdb302fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6sOb1Gsh1U5jWOFkzrUvmQ.png"/></div></div></figure><p id="05df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们有了一个工作的迷你API，它基本上可以..没什么。</p><p id="0e38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但我们仍然有点兴奋，因为我们得到了预期的回应！这意味着我们可以开始实现一些逻辑，做一些本地自由风格！</p><p id="7419" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">那就这么办吧！</strong></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><blockquote class="lz ma mb"><p id="9d4d" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><strong class="jp ir">写出重要逻辑</strong></p></blockquote><p id="10f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们希望我们的后端与oAuth提供者(Spotify)通信，并返回有效的访问令牌和刷新令牌。</p><p id="a20a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在简介中，我们谈到了Spotify认证流程。这部分主要集中在<strong class="jp ir">步骤2和3。</strong></p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nq"><img src="../Images/ac8a9c9e8f0f63b8eb1f94efe6131534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q11EQm80O3VLeDzh.png"/></div></div></figure><p id="8fdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们有两种情况需要解决:</p><ol class=""><li id="c0e6" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk qh mm mn mo bi translated">用授权码交换访问令牌和刷新令牌</li><li id="1baa" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk qh mm mn mo bi translated">用刷新令牌交换新的访问令牌</li></ol><p id="8d95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来定义我们的配置:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi ql"><img src="../Images/070bcd712f697a16d9f48951f16f4f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*LvkVaFpqzBkyIrcbOQgYCQ.png"/></div></figure><ul class=""><li id="ce54" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated"><strong class="jp ir">客户端ID &amp;客户端密码:</strong>您可以在Spotify的开发者仪表盘中找到。</li><li id="87de" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><strong class="jp ir">重定向URI: </strong>一个你必须加入Spotify仪表盘白名单的网址。在这篇博客中，无论何时你需要填写一个重定向URL，你都需要使用同一个URL。</li></ul></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><blockquote class="lz ma mb"><p id="c947" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">因此，让我们来看看controller.js中的第一个场景:</p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qm"><img src="../Images/a1f3940b5983304a1bad94242d93a094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gna4HMLMSxauwQOZLvSD-Q.png"/></div></div></figure><p id="1904" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，根据Spotify文档，我们必须对这个端点执行POST调用:<a class="ae mf" href="https://accounts.spotify.com/api/token" rel="noopener ugc nofollow" target="_blank">https://accounts.spotify.com/api/token</a></p><p id="6892" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应填写以下标题和正文请求参数:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qn"><img src="../Images/ac45fd3a9c2fa4a28ca9af126e7b74e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_DO5_UCVcqbi9j8MU5FwQ.png"/></div></div></figure><p id="85d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用一个用Javascript包装Spotify API的库:</p><p id="12f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mf" href="https://github.com/thelinmichael/spotify-web-api-node" rel="noopener ugc nofollow" target="_blank">https://github.com/thelinmichael/spotify-web-api-node</a></p><p id="6ca6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，再次打开命令提示并转到functions文件夹:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="684c" class="mz lc iq oy b gy pc pd l pe pf">npm install spotify-web-api-node --save</span></pre><p id="8aa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以通过导入该库:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="6e48" class="mz lc iq oy b gy pc pd l pe pf">var SpotifyWebApi = require(‘spotify-web-api-node’);</span></pre><p id="b594" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用spotifyConfig作为构造函数参数初始化变量spotifyApi。这样，我们所有的调用都将使用正确的客户端id、客户端密钥和重定向url。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qo"><img src="../Images/ef5a5a86b190be91ca29958b4115cff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*mFNjCRFs9Z9XGyNuoLOMGg.png"/></div></figure><p id="0b7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们将添加一点代码来处理我们的请求:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qp"><img src="../Images/0b74e2fcb0c348917d7e7e383389084c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*efg1fV_c0FwvlQdlD28ixw.png"/></div></figure><p id="6fb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用传入的授权代码获取访问令牌和请求令牌。authorizationCodeGrant方法返回访问令牌和刷新令牌。我们将直接向客户返回响应:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="211d" class="mz lc iq oy b gy pc pd l pe pf">res.json(data.body)</span></pre></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><blockquote class="lz ma mb"><p id="abc8" class="jn jo kl jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">让我们深入探讨第二种情形！</p></blockquote><p id="4354" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此场景中，我们希望使用现有的刷新令牌请求新的访问令牌。</p><p id="6622" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们仍将使用Spotify API包装库。<br/>首先，我们将使用方法设置刷新令牌</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="7e2b" class="mz lc iq oy b gy pc pd l pe pf">spotifyApi.setRefreshToken().</span></pre><p id="ae7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将使用refreshAccessToken()刷新我们的访问令牌</p><p id="5a8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当此调用成功时，我们将把主体返回给客户。我还将refresh token添加到我们的主体中(第25行)，这样我们就可以从那里使用它。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qq"><img src="../Images/7d043db4e9d6b1e68ad403411d137f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7y0mBCUR43yy3Uj0oV2dg.png"/></div></div></figure><p id="cb5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像前面的场景一样，对于我们的客户端应用程序，它看起来就像我们直接调用了Spotify API。但因为我们想隐藏我们的客户秘密，我们使用我们的firebase函数作为代理。</p><h1 id="ead9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在我们的React Native应用程序中使用Firebase代理</h1><p id="9042" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated"><em class="kl">现在我们有了一个运行在Firebase上的Proxy，以及一个直接连接到Spotify的React Native前端，包括我们的客户端id和客户端密钥。</em></p><p id="fa12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">这是不安全的，原因很简单，客户机密应该保持机密。我们将不得不把这些点连接起来，更新我们的代码库，使其更加安全。</em></p><p id="6acd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一下之前编写的一些代码:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pj"><img src="../Images/ace49be3838d4750c3fb87f1227e5f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G8_bTOTxO10QLTjGRG_n-A.png"/></div></div></figure><p id="1ff9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们做一些改变:</p><ul class=""><li id="3fb0" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">删除客户机密</li><li id="bb32" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">将tokenEndpoint URL更改为Firebase终结点</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qr"><img src="../Images/a21824c5c39cd515307011ed88757e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6oLgBzkJOgkdP5W3PZgs0Q.png"/></div></div></figure><p id="cf41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切仍然会很顺利。但现在，我们的客户秘密隐藏在我们的Firebase项目中。真棒。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="8182" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">第5部分:保持身份验证状态</h1><p id="37cd" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated"><em class="kl">现在我们可以对用户进行身份验证了，接下来我们希望应用程序逻辑的其余部分基于当前身份验证状态进行处理。此外，我们希望使用当前令牌执行所有下一个API调用。我们希望应用程序做的第三件事是将用户的刷新令牌保持在某个状态，因此当用户重新打开应用程序时，他将自动再次通过身份验证。</em></p><h2 id="e71d" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">使用redux保持我们的身份验证状态</h2><p id="cf4b" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">我将向你展示如何用Redux存储认证状态。如果你不知道Redux是如何工作的，我建议你看一些他们的文档。</p><p id="42f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用官方的Redux Toolkit库来尽可能简化这个设置。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qs"><img src="../Images/d59e4e2ba055b4319286712beff24ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFx1tF6WwZ5Z5BWPF36vmQ.png"/></div></div></figure><p id="3101" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装所需的依赖项以使用Redux:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="15e0" class="mz lc iq oy b gy pc pd l pe pf">npm install @reduxjs/toolkit --save<br/>npm install react-redux --save<br/>npm install <!-- -->@react-native-community/async-storage --save<br/>npm install redux-persist --save</span></pre><h2 id="dafc" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">Redux设置</h2><p id="af29" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">使用以下结构创建一个“redux”文件夹:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qt"><img src="../Images/1bf53d5b87cf66a7f3a6d377b795754d.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*wq_xYqcFTyjyniesb1IHsw.png"/></div></figure><h2 id="04a2" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">authenticationSlice.js:</h2><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="740f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您熟悉Redux，但不熟悉Redux Toolkit，您会注意到这不是定义reducers和动作的标准方式。我不会详细介绍redux工具包是如何工作的。但是在幕后，Redux工具包创建了我们从标准Redux中了解到的所有必要的对象。</p><p id="eb68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在定义一个身份验证状态，其中的一些操作将处理我们的访问令牌和刷新令牌的持久性。</p><p id="57d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> reducers/index.js </strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="573b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这个文件中定义了根归约器。使用“persistReducer ”,我们将能够在我们的设备上持久化我们的Reducer。异步存储将用于保存我们设备上的数据。我们创建一个身份验证配置，该配置将保留我们的身份验证状态，但访问令牌除外。这是因为我们只想保存我们的刷新令牌。每次打开我们的应用程序时，都应该刷新访问令牌。</p><p id="6688" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">商店/商店. js </strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="d8fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">店里汇集了Redux的一切。</p><h2 id="675a" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">App.js</h2><p id="dd73" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">我们需要在App.js中做一些修改，以便我们的应用程序知道如何处理我们的商店:</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><h2 id="ff52" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">loginScreen.js</h2><p id="c02d" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">此外，我们希望我们的登录屏幕与我们的Redux商店通信。<br/>因此，让我们修改我们的loginScreen.js代码。</p><p id="616c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将导入用于操作身份验证状态的操作。有了Redux的connect模块，我们将能够用Redux状态“连接”我们的组件。mapStateToProps和mapDispatchToProps是connect中可用的方法，允许我们将redux状态和redux调度映射到我们的组件。这样，我们将能够通过this.props在我们的组件内部调用和使用它们。</p><p id="42d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这正是我们在成功登录过程后在此代码中所做的事情:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="8421" class="mz lc iq oy b gy pc pd l pe pf">this.props.setAccessToken({accessToken: authenticationObject.accessToken});</span><span id="7f06" class="mz lc iq oy b gy qu pd l pe pf">this.props.setRefreshToken({</span><span id="31e9" class="mz lc iq oy b gy qu pd l pe pf">refreshToken: authenticationObject.refreshToken,</span><span id="c3ac" class="mz lc iq oy b gy qu pd l pe pf">});</span></pre><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="b014" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">第7部分:基于身份验证的导航</h1><p id="e507" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated"><em class="kl">现在我们可以验证我们的用户了。如果我们可以只在用户没有被认证的情况下显示登录页面，那不是很好吗？</em></p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qv"><img src="../Images/433fc76a9ffdf04661c6da9a7a79509f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*3bZx1E0FDpROilfLruup5g.png"/></div></figure><p id="e393" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的导航，我们将使用React本机导航最常见的goto库:</p><div class="od oe gp gr of og"><a href="https://reactnavigation.org/" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">反应导航|反应导航</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">描述将放入</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">reactnavigation.org</p></div></div></div></a></div><p id="2afd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将为我们的应用程序创建两个导航:</p><p id="1943" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">登录导航<br/>访客导航</strong></p><p id="1267" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以想出任何其他合适的名称，但是为了本教程的清晰起见，我想直截了当地说:-)。</p><p id="b8d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们想要导航，我们还需要构建一些额外的屏幕:</p><ul class=""><li id="da81" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">我的个人资料(仅适用于经过身份验证的用户)</li><li id="5a3d" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">MyFavoriteMusic(仅适用于已验证的用户)</li><li id="86a2" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">登录屏幕(仅针对客人)</li><li id="3445" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">主屏幕(仅适用于客人)</li><li id="c18d" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">入口屏幕</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qw"><img src="../Images/5a1332ac2f4bbbc7813c217e7aa50cae.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*9MTBef5D20LR6rNgcZVxsA.png"/></div></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi qx"><img src="../Images/fa233be9ce5640f6eef6abdd72621ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*1L2Bphnc55WIp2sMZnqtog.png"/></div></figure><p id="9790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们安装一些必需的依赖项:</p><pre class="ku kv kw kx gt ox oy oz pa aw pb bi"><span id="7574" class="mz lc iq oy b gy pc pd l pe pf">npm install <!-- -->react-navigation <!-- -->react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context @react-native-community/masked-view @react-navigation/bottom-tabs <!-- --> <a class="ae mf" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-navigation/native react-native-screens</span><span id="4389" class="mz lc iq oy b gy qu pd l pe pf">npm install</span></pre><p id="7db4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> BottomTabNavigator: </strong></p><p id="eb3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有不同种类的导航器。我们将使用BottomTabNavigator，它会在屏幕底部以选项卡的形式显示不同的导航路径。</p><p id="f6d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> guestNavigation.js: </strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="f953" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> loggedInNavigation.js: </strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="fee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> EntryScreen.js: </strong></p><p id="f812" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的入口屏幕将从App.js文件中调用。该屏幕将根据当前认证状态显示正确的导航器。它还将处理我们的自动登录:当刷新令牌可用但我们还没有访问令牌时，我们将尝试刷新它。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="af8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> myProfileScreen.js: </strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="e853" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">myfavoritemusicscreen . js:</strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="b276" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> App.js </strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><div class="ku kv kw kx gt ab cb"><figure class="pn ky qy pp pq pr ps paragraph-image"><img src="../Images/12ffcabc9724a59ce9bee37bfe8b9d3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*6x1jUiUgnlKvS0_yWCXtBw.png"/></figure><figure class="pn ky qy pp pq pr ps paragraph-image"><img src="../Images/f20a37deb8faf379a12d8bd557afe3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*BD3VIdT-tq7QiieZjljbwQ.png"/></figure></div><div class="ab cb"><figure class="pn ky qy pp pq pr ps paragraph-image"><img src="../Images/a4028f3a5500048235db8226c0b1c9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*e6QVnLZqFPo9LePOxTbSwg.png"/></figure><figure class="pn ky qy pp pq pr ps paragraph-image"><img src="../Images/e6faa4e6ed66eadadea851e873da8489.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*BCpCYYDoTMmPf-72Whl0lQ.png"/></figure></div><p id="7193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以现在我们有了一个针对访客的导航和一个针对登录用户的导航。这不是很好吗？</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="2c49" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">下一步是什么？</h1><h2 id="0c92" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">反应钩</h2><p id="47f6" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">在本教程中，我一直在使用React组件类。然而，用钩子工作会更干净。一些认证逻辑可以在定制钩子内部进行管理。了解更多信息:</p><div class="od oe gp gr of og"><a href="https://reactjs.org/docs/hooks-intro.html" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">介绍钩子-反应</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">钩子是React 16.8中的新增功能。它们允许您使用状态和其他React特性，而无需编写类。这个…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">reactjs.org</p></div></div><div class="op l"><div class="qz l or os ot op ou kz og"/></div></div></a></div><h2 id="2f88" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated">与自定义身份验证相结合</h2><p id="8c16" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">在我的一个项目中，我想在我的Firebase身份验证中保留一个用户群。所以我使用了上述原则，并将其与Firebase的自定义身份验证相结合:</p><div class="od oe gp gr of og"><a href="https://firebase.google.com/docs/auth/web/custom-auth" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">使用自定义身份验证系统通过JavaScript中的Firebase进行身份验证</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">通过修改您的身份验证服务器，您可以将Firebase身份验证与自定义身份验证系统集成在一起…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">firebase.google.com</p></div></div><div class="op l"><div class="ra l or os ot op ou kz og"/></div></div></a></div><p id="8124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加这个可能是一个很好的挑战！这样，您可以保留一个用户群，并为每个用户保存一些自定义数据。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="3eec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你喜欢这本书。坚持编码，每天努力提升自己！</p><p id="1957" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">—托马斯</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ph pi l"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Actual footage of me writing this article</figcaption></figure><h2 id="b7c1" class="mz lc iq bd ld na nb dn lh nc nd dp ll jy ne nf lp kc ng nh lt kg ni nj lx nk bi translated"><strong class="ak">用简单英语写的JavaScript的注释:</strong></h2><p id="d57f" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，用你的Medium用户名给我们发邮件到<a class="ae mf" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>，我们会把你添加为作者。</p></div></div>    
</body>
</html>