<html>
<head>
<title>Maintainable JavaScript — Storing Config Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可维护的JavaScript —存储配置数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/maintainable-javascript-storing-config-data-3630d580bb2?source=collection_archive---------10-----------------------#2020-09-28">https://javascript.plainenglish.io/maintainable-javascript-storing-config-data-3630d580bb2?source=collection_archive---------10-----------------------#2020-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9bcfe4e6db26c9a68ceef7e736f8186e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j_yCRO_uch6h5G0T"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@fikrirasyid?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fikri Rasyid</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f3ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果想继续使用代码，创建可维护的JavaScript代码很重要。</p><p id="9221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过查看存储配置数据的方式来了解创建可维护的JavaScript代码的基础。</p><h1 id="adc4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">存储配置数据</h1><p id="86be" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有各种方法来存储我们的应用程序的配置数据。</p><p id="d352" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像React、Vue和Angular这样的前端框架有它们自己存储特定于环境的配置数据的方式。</p><p id="59ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用来创建、运行和构建项目的CLI程序可以从中读取数据，并将正确的配置值放入我们的构建工件中。</p><p id="83a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，使用Create React App，我们可以创建自己的配置文件</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f4ff" class="mn lc iq mj b gy mo mp l mq mr">REACT_APP_NOT_SECRET_CODE=abcdef</span></pre><p id="c389" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的<code class="fe ms mt mu mj b">.env</code>文件中。</p><p id="1eed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以在我们的应用程序代码中读取带有<code class="fe ms mt mu mj b">process.env.REACT_APP_NOT_SECRET_CODE</code>的值。</p><p id="46b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，当我们运行<code class="fe ms mt mu mj b">npm start</code>来启动应用程序，运行<code class="fe ms mt mu mj b">npm run build</code>来构建应用程序时，该值将被添加。</p><p id="6f1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个环境可以有一个文件。</p><p id="e1b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以:</p><ul class=""><li id="4a43" class="mv mw iq kf b kg kh kk kl ko mx ks my kw mz la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env</code>:默认配置文件。</li><li id="9d6c" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env.local</code>:本地超控</li><li id="553d" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env.development</code>、<code class="fe ms mt mu mj b">.env.test</code>、<code class="fe ms mt mu mj b">.env.production</code>:环境特定设置</li><li id="7b62" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env.development.local</code>、<code class="fe ms mt mu mj b">.env.test.local</code>、<code class="fe ms mt mu mj b">.env.production.local</code> —本地超控。</li></ul><p id="8471" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检查ib <code class="fe ms mt mu mj b">.env</code>并忽略本地的。</p><p id="90d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要密钥以<code class="fe ms mt mu mj b">REACT_APP_</code>开头，那么就可以读取。</p><p id="7d4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue CLI也有类似的东西。</p><p id="715d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要以下文件:</p><ul class=""><li id="2985" class="mv mw iq kf b kg kh kk kl ko mx ks my kw mz la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env</code> —默认文件</li><li id="6e5f" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env.local</code> —本地覆盖</li><li id="6e5b" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env.[mode]</code> —针对特定环境的覆盖</li><li id="b8e6" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">.env.[mode].local</code> —特定环境的本地覆盖</li></ul><p id="3e67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe ms mt mu mj b">.env</code>文件中，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="55eb" class="mn lc iq mj b gy mo mp l mq mr">VUE_APP_NOT_SECRET_CODE=some_value</span></pre><p id="48b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要config键的前缀是<code class="fe ms mt mu mj b">VUE_APP_</code>，Vue CLI就会读取。</p><p id="015a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于节点应用，我们可以使用dotenv包。</p><p id="723b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过运行以下命令来安装它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c567" class="mn lc iq mj b gy mo mp l mq mr">npm i dotenv</span></pre><p id="4fc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来创建我们的配置:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0901" class="mn lc iq mj b gy mo mp l mq mr">DB_HOST=localhost<br/>DB_USER=root<br/>DB_PASS=s1mpl3</span></pre><p id="40c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过书写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2fab" class="mn lc iq mj b gy mo mp l mq mr">require('dotenv').config()</span></pre><p id="422c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来读取配置:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1f30" class="mn lc iq mj b gy mo mp l mq mr">const db = require('db')<br/>db.connect({<br/>  host: process.env.DB_HOST,<br/>  username: process.env.DB_USER,<br/>  password: process.env.DB_PASS<br/>})</span></pre><p id="6ddd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从<code class="fe ms mt mu mj b">process.env</code>获取配置值。</p><p id="0208" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以用JSON格式存储这些值。</p><p id="ca75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8a8a" class="mn lc iq mj b gy mo mp l mq mr">{<br/>  "MESSAGE_INVALID_VALUE": "Invalid value",<br/>  "URL_INVALID": "/errors/invalid"<br/>}</span></pre><p id="1fd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来存储JSON文件。</p><p id="6cc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe ms mt mu mj b">fetch</code>、jQuery的<code class="fe ms mt mu mj b">getJSON</code>或者任何我们想要的东西来读取JSON文件。</p><p id="deab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用像Webpack、Rollup或package这样的模块捆绑器，JSON也可以用<code class="fe ms mt mu mj b">import</code>直接导入。</p><p id="2cec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以这样写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d5ec" class="mn lc iq mj b gy mo mp l mq mr">import config from './config.json'</span></pre><p id="b300" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导入我们的JSON文件。</p><p id="3ac4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将像一个普通的JavaScript对象一样被导入，我们可以像这样使用它们。</p><p id="7e17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在所有示例中，我们将配置存储在应用程序之外。</p><p id="494f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们只需更改配置文件，这些值就会在引用它们的任何地方得到反映。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/5e3072f90b87bb59b2e388fba692cd62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZkrOZw6_TcdrKLsU"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@christiannkoepke?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christiann Koepke</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="55f5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="3d22" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在外部存储配置数据，这样我们可以在一个地方更改值，它们将在任何地方得到反映。</p><p id="d85a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以为每个环境创建单独的配置文件，以使我们的应用程序在所有环境中都能工作。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/787be6c671be8d345dc786dad8729ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-sOyyG8NoRbKpCG_y4Cmw@2x.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank">Subscribe to Decoded, our official YouTube channel!</a></figcaption></figure></div></div>    
</body>
</html>