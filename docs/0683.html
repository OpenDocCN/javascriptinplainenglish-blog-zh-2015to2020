<html>
<head>
<title>Crafting Effective Type Systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">打造有效的类型系统</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/crafting-effective-type-systems-c8bf8eba67f6?source=collection_archive---------9-----------------------#2019-11-25">https://javascript.plainenglish.io/crafting-effective-type-systems-c8bf8eba67f6?source=collection_archive---------9-----------------------#2019-11-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/cef7aaf50980ac1d66a5f66ce7c6a203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkszJODiLWfjqY5GouDBmQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@mlightbody?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Malcolm Lightbody</a> on <a class="ae jz" href="https://unsplash.com/s/photos/craft?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="769b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我描述了在应用程序中设计类型系统的两个简单原则，它们带来的好处，以及一些实际应用的例子。</p><p id="01a8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您曾经使用过TypeScript或Flow，您可能会发现自己处于一种感觉像是在与类型检查器作战的位置。很容易用过于严格或难以扩展的类型来限制自己，但是如果执行得好，应用程序的类型系统应该会帮助你，而不是碍手碍脚。</p><p id="9a70" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你已经有了类型系统的经验，这些原则可能对你来说很熟悉，但是我希望在这里将它们整理出来将有助于你的团队围绕这些共同的目标进行对话。</p><h1 id="32cd" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">1.错误应该是有意义的，并且在正确的位置</h1><p id="b053" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">大多数时候，你的类型系统是不可见的。它不会和你说话，直到你犯错，它的声音就是你读到的错误。对话的质量取决于这些错误的质量，定义有效错误有两个特征:</p><ol class=""><li id="1c2e" class="mb mc in kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">就在你犯错的地方</li><li id="6f35" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">错误消息描述了您所犯的错误</li></ol><p id="9113" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是一个错误信息出现在错误位置的简单示例:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6867" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们所犯的错误在第4行，但是这个错误直到我们稍后尝试使用<code class="fe mv mw mx my b">name</code>属性时才出现。对于不到十行的代码片段来说，这并没有太大的区别，但是在真实的应用程序中，错误可能出现在与代码库无关的不同文件中。</p><p id="e16d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过在函数定义中包含返回类型，可以轻松避免这个问题:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="cc59" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在错误出现在您犯错误的地方，并描述了实际的问题:您创建的对象不是一个<code class="fe mv mw mx my b">User</code>。</p><h1 id="2433" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">2.你的工具应该理解你的类型</h1><p id="42f7" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">你的类型系统形成了你的应用程序结构的文档，它是如何工作的，数据是如何通过它的。当设计你的类型时，目标是创建你所使用的工具能够理解的结构。一个简单的例子是自动完成，但是更复杂的例子是重命名重构和IDE的“转到定义”功能。</p><p id="5402" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">发生在我们app中的一个具体例子是i18n。有很多现有的JavaScript i18n库，但是我们决定不使用它们中的任何一个并构建我们自己的库，仅仅是因为它们都没有足够严格的类型定义在编译时有用。</p><p id="1cd2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您以前使用过任何典型的i18n库，您将会看到这样的模式，其中您在树结构中定义每种语言的翻译，并通过点分隔的字符串键来访问它们:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="1ccc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mv mw mx my b">getTranslation()</code>的签名通常是这样的:</p><pre class="mp mq mr ms gt mz my na nb aw nc bi"><span id="4cc9" class="nd kz in my b gy ne nf l ng nh">function getTranslation(key: string): string;</span></pre><p id="82a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不幸的是，这只是告诉编译器它接受一个字符串并返回一个字符串。这意味着，例如，您的工具无法为自动完成提供翻译键建议。</p><p id="d1b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的解决方案非常简单:我们为每种语言公开一个对象(就像上面的<code class="fe mv mw mx my b">germanTranslations</code>),您可以通过普通的点标记属性访问来访问它:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="0da8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">没有魔法。它只是一个物体。编译器知道它的结构，所以我们的工具在每一步都提供自动完成建议，不可能引用未定义的翻译键，我们IDE中的重构工具允许我们重命名translations对象中的<code class="fe mv mw mx my b">user</code>,并自动重命名对它的所有引用。</p><p id="d186" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">认真对待自动完成。如果您正在键入内容，而自动完成功能对使用您的解决方案的人不起作用，请选择您的工具可以理解的不同表示方式。</p><h1 id="eb5d" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="6a72" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">不要认为你的类型系统是你写完代码后附加的东西。作为开发人员，我们知道，预测我们的解决方案将如何被阅读、扩展和维护是我们的一些主要职责，为您的应用程序设计一个有效的类型系统对所有这些事情都有明显的影响。</p><p id="1185" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当你和你的团队开发你的产品时，你创建的类型系统塑造了你的对话。它定义了编译器会告诉你的术语，以及它会发送给你的消息。它还定义了你的<em class="ni">队友</em>在谈论你的代码时会用到的术语。</p><p id="b8ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">花时间仔细考虑，为你的团队和代码库找到一个有表现力的解决方案。如果你不同意这里的指导原则，拿出你自己的并与你的团队分享。我们发现它们对我们工具的开发非常有帮助，我希望它们至少能对你有所启发。</p></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><p id="0094" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你觉得这篇文章怎么样？我很想收到你的来信！</p><p id="35f5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我是Remerge的前端领导，我们在如何编写代码上花了很多心思。如果你像我们一样——热衷于尽你所能写出最好的应用程序——<a class="ae jz" href="https://remerge.recruitee.com/o/frontend-javascript-developer-1" rel="noopener ugc nofollow" target="_blank">我们正在寻找新的队友</a>。</p><p id="f344" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的办公室位于德国柏林市中心一座美丽的老建筑的顶层。在这里阅读更多关于我们的信息。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ec871029221d1ff31091aa9a1bb67e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*a5OEvzK7u6QvZhFtGHpDYQ.png"/></div></figure></div></div>    
</body>
</html>