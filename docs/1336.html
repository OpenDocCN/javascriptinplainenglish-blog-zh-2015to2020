<html>
<head>
<title>A guide to sending things in Express.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Express.js中发送邮件的指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/guide-to-the-express-response-object-sending-things-2defae78d53c?source=collection_archive---------2-----------------------#2020-03-03">https://javascript.plainenglish.io/guide-to-the-express-response-object-sending-things-2defae78d53c?source=collection_archive---------2-----------------------#2020-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/00e23f11d88cfa82ca19801b556d30fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TVncnuzibbowjVe5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@priscilladupreez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Priscilla Du Preez</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d542" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Express response对象允许我们向客户端发送响应。</p><p id="1a9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以发送各种响应，比如字符串、JSON和文件。此外，除了主体之外，我们还可以向客户端发送各种标头和状态代码。</p><p id="0ff8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将查看响应对象的各种属性，包括<code class="fe lb lc ld le b">send</code>、<code class="fe lb lc ld le b">sendFile</code>和<code class="fe lb lc ld le b">sendStatus</code>。</p><h1 id="9da7" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">方法</h1><h2 id="9e95" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">RES . send([正文])</h2><p id="10f3" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">res.send</code>方法发送一个HTTP响应。</p><p id="b2f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">body</code>参数可以是一个<code class="fe lb lc ld le b">Buffer</code>对象、字符串、普通对象或数组。</p><p id="5a67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以通过编写以下内容来发送二进制响应:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="0e93" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="0c61" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.send(Buffer.from('foo'));<br/>})<br/>app.listen(3000);</span></pre><p id="d216" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要发送JSON，我们可以传入一个对象:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="6cba" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="80e1" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.send({ foo: 'bar' });<br/>})<br/>app.listen(3000);</span></pre><p id="ba5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以通过传入一个字符串来发送HTML:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="20f7" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="c475" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.send('&lt;p&gt;foo&lt;/p&gt;');<br/>})<br/>app.listen(3000);</span></pre><p id="d36a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了<code class="fe lb lc ld le b">send</code>方法之外，我们还可以发送响应代码:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="52fd" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="121f" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.status(404).send('not found');<br/>})</span><span id="ad39" class="md lg iq le b gy ng nd l ne nf">app.listen(3000);</span></pre><p id="0de5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在发送响应之前设置响应头:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="eed0" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="d419" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.set('Content-Type', 'text/html');<br/>  res.send(Buffer.from('&lt;p&gt;foo&lt;/p&gt;'))<br/>})<br/>app.listen(3000);</span></pre><p id="f6b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">send</code>也适用于数组:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="eba8" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="1890" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.send([1, 2, 3]);<br/>})</span><span id="d35d" class="md lg iq le b gy ng nd l ne nf">app.listen(3000);</span></pre><p id="f24b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe lb lc ld le b">[1,2,3]</code>。</p><h2 id="c591" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">res.sendFile(路径[，选项] [，fn])</h2><p id="315a" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">sendFile</code>来发送一个带有在<code class="fe lb lc ld le b">options</code>对象中指定的各种选项的文件。</p><p id="4808" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">path</code>需要一个绝对路径才能使<code class="fe lb lc ld le b">sendFile</code>工作。</p><p id="483b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="4494" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="3f6f" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  const options = {<br/>    root: path.join(__dirname, 'files'),<br/>    dotfiles: 'deny',<br/>    headers: {<br/>      'x-timestamp': Date.now(),<br/>      'x-sent': true<br/>    }<br/>  }<br/>  res.sendFile('foo.txt', options);<br/>})<br/>app.listen(3000);</span></pre><p id="8216" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码在<code class="fe lb lc ld le b">options</code>中设置了根路径，这样我们就不必在每次调用<code class="fe lb lc ld le b">sendFile</code>时都构建绝对路径。</p><p id="d11f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下属性可以添加到<code class="fe lb lc ld le b">options</code>对象中:</p><ul class=""><li id="2a60" class="nh ni iq kf b kg kh kk kl ko nj ks nk kw nl la nm nn no np bi translated"><code class="fe lb lc ld le b">maxAge</code> —设置<code class="fe lb lc ld le b">Cache-Control</code>标题的<code class="fe lb lc ld le b">max-age</code>属性，单位为毫秒或ms格式的字符串</li><li id="eabb" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">root</code> —相对文件名的根目录</li><li id="1251" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">lastModified</code> —将<code class="fe lb lc ld le b">Last-Modified</code>头设置为文件在操作系统上的最后修改日期。设置<code class="fe lb lc ld le b">false</code>将其禁用。</li><li id="7667" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">headers</code> —包含与文件一起提供的HTTP响应头的对象。</li><li id="ee99" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">dotfiles</code> —提供点文件的选项。可能的值有<code class="fe lb lc ld le b">allow</code>、<code class="fe lb lc ld le b">deny</code>或<code class="fe lb lc ld le b">ignore</code>。</li><li id="7282" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">acceptRanges</code> —启用或禁用接受范围请求</li><li id="9817" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">cacheControl</code> —启用或禁用设置<code class="fe lb lc ld le b">Cache-Control</code>响应头</li><li id="ccd5" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><code class="fe lb lc ld le b">immutable</code> —启用或禁用<code class="fe lb lc ld le b">Cache-Control</code>表头中的<code class="fe lb lc ld le b">immutable</code>指令。如果启用，应该指定<code class="fe lb lc ld le b">maxAge</code>选项来启用缓存。<code class="fe lb lc ld le b">immutable</code>指令将阻止受支持的客户端在<code class="fe lb lc ld le b">maxAge</code>选项的生命周期内发出条件请求，以检查文件是否已更改。</li></ul><p id="4711" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以传入一个回调函数来处理错误，作为最后一个参数:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="d2db" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="a616" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  const options = {<br/>    root: path.join(__dirname, 'files'),<br/>    dotfiles: 'deny',<br/>    headers: {<br/>      'x-timestamp': Date.now(),<br/>      'x-sent': true<br/>    }<br/>  }<br/>  res.sendFile('foo.txt', options, err =&gt; next(err));<br/>})<br/>app.listen(3000);</span></pre><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/b93428f01a113ed885d4251a30ff9fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MRGI09qOsjC1By5_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@thiagothehuman?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thiago Thadeu</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="c84a" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源发送状态(状态代码)</h2><p id="45a9" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们可以用这个方法发送一个HTTP响应状态代码。我们只需要传入一个数字。</p><p id="a54d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果指定了不支持的状态代码，仍将发送该代码，并且将在响应正文中发送其字符串版本。</p><p id="3f33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="a404" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="d36c" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.sendStatus(200)<br/>})<br/>app.listen(3000);</span></pre><p id="295d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们再回来<code class="fe lb lc ld le b">OK</code>。</p><p id="a518" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们写下以下内容:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="a85a" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="d138" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.sendStatus(900)<br/>})<br/>app.listen(3000);</span></pre><p id="4acd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到<code class="fe lb lc ld le b">900</code>，因为我们发送了一个不支持的响应代码。</p><h1 id="df1e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="71f9" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">使用Express，我们可以通过各种方式发送响应。最通用的是<code class="fe lb lc ld le b">send</code>，它允许我们发送文本和二进制数据。我们可以设置标题来指示我们要发送的内容。</p><p id="7de7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">sendFile</code>发送带有服务器上文件的绝对文件路径的文件响应。我们可以为发送的文件指定各种选项。</p><p id="890a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">sendStatus</code>方法让我们只发送一个HTTP响应代码。我们可以用它来发送支持和不支持的响应代码。</p></div></div>    
</body>
</html>