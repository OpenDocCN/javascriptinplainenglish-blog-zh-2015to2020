<html>
<head>
<title>JavaScript Tips — Parsing HTML, Reading Files, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript技巧——解析HTML、读取文件等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-tips-parsing-html-reading-files-and-more-197dc163e4e5?source=collection_archive---------2-----------------------#2020-08-16">https://javascript.plainenglish.io/javascript-tips-parsing-html-reading-files-and-more-197dc163e4e5?source=collection_archive---------2-----------------------#2020-08-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c4f972cbe288cae1fca129785f640de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iNKgOyJpQCHyNrWx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@sarahbedu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sarah Bedu</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="13a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写JavaScript应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些常见JavaScript问题的解决方案。</p><h1 id="9919" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用JavaScript解析HTML字符串</h1><p id="cfb5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过创建一个不附加到DOM的<code class="fe me mf mg mh b">html</code>元素，用JavaScript解析一个HTML字符串。</p><p id="0b13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用它来得到我们想要的/</p><p id="17e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="54fc" class="mq lc iq mh b gy mr ms l mt mu">const html = `<br/>&lt;html&gt;</span><span id="ccc4" class="mq lc iq mh b gy mv ms l mt mu">  &lt;head&gt;<br/>    &lt;title&gt;title&lt;/title&gt;<br/>  &lt;/head&gt;</span><span id="116a" class="mq lc iq mh b gy mv ms l mt mu">  &lt;body&gt;&lt;a href='test'&gt;link&lt;/a&gt;&lt;/body&gt;</span><span id="1459" class="mq lc iq mh b gy mv ms l mt mu">&lt;/html&gt;<br/>`</span></pre><p id="6fdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ed68" class="mq lc iq mh b gy mr ms l mt mu">const el = document.createElement('html');<br/>el.innerHTML = html;<br/>const anchor = el.querySelector('a');</span></pre><p id="b02b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">createElement</code>创建了<code class="fe me mf mg mh b">html</code>元素。</p><p id="dad9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">html</code>设置<code class="fe me mf mg mh b">innerHTML</code>来填充新元素的字符串中的条目。</p><p id="4258" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用任何DOM方法，如<code class="fe me mf mg mh b">querySelector</code>来获取HTML中的元素。</p><p id="0bf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有用于解析DOM的<code class="fe me mf mg mh b">DOMParser</code>构造函数。</p><p id="434f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="11d4" class="mq lc iq mh b gy mr ms l mt mu">const parser = new DOMParser();<br/>const htmlDoc = parser.parseFromString(html, 'text/htm;');</span></pre><p id="5ad9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中<code class="fe me mf mg mh b">html</code>是和我们之前一样的字符串。</p><h1 id="76bc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将字符串转换成浮点数</h1><p id="9346" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">parseFloat</code>函数将字符串解析成浮点数。</p><p id="6764" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="433e" class="mq lc iq mh b gy mr ms l mt mu">const value = parseFloat("123.45");</span></pre><p id="994f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用它把123.45解析成一个浮点数。</p><p id="6771" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用不是句点的小数点分隔符，那么我们必须用句点来替换它。</p><p id="8078" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="06d7" class="mq lc iq mh b gy mr ms l mt mu">const value = parseFloat("123,45".replace(",", "."));</span></pre><h1 id="9528" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">HTML中的自定义属性</h1><p id="8791" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们想给元素添加自定义属性，那么我们必须给它加上前缀<code class="fe me mf mg mh b">data-</code>。</p><p id="9abf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c829" class="mq lc iq mh b gy mr ms l mt mu">&lt;p data-date-changed="2020-01-01"&gt;Hello&lt;/p&gt;</span></pre><p id="c5e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe me mf mg mh b">getAttribute</code>得到属性值:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4c9b" class="mq lc iq mh b gy mr ms l mt mu">const dateChanged = document.querySelector("p").getAttribute("data-date-changed");</span></pre><h1 id="53bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从URL获取YouTube视频ID</h1><p id="ada9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过拆分查询字符串从URL中获取YouTube视频ID。</p><p id="9e23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以使用<code class="fe me mf mg mh b">URLSearchParams</code>构造函数。</p><p id="2256" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="734d" class="mq lc iq mh b gy mr ms l mt mu">const urlSearchParams = new URLSearchParams(window.location.search.slice(1))<br/>const videoId = urlSearchParams.get('v');</span></pre><p id="4804" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一行用查询字符串创建了<code class="fe me mf mg mh b">URLSearchParams</code>实例。</p><p id="9dd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">lice</code>从<code class="fe me mf mg mh b">window.location.search</code>管柱中取出<code class="fe me mf mg mh b">?</code>。</p><p id="78a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用查询参数键<code class="fe me mf mg mh b">v</code>调用<code class="fe me mf mg mh b">get</code>。</p><p id="a6e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe me mf mg mh b">videoId</code>将是视频ID。</p><h1 id="de45" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从目录中的所有文件导入模块</h1><p id="42ba" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们从每个模块中导出所有内容，我们可以从一个目录中导入所有模块。</p><p id="f0cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以在一个模块中，我们可以写:</p><p id="bf4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">things/index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0fc9" class="mq lc iq mh b gy mr ms l mt mu">export * from './moduleA';<br/>export * from './moduleB';<br/>export * from './moduleC';</span></pre><p id="20eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过编写来导入所有内容:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e13c" class="mq lc iq mh b gy mr ms l mt mu">import { ModuleA, ModuleB, ModuleC } from './things';</span></pre><p id="691f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe me mf mg mh b">index.js</code>中导出每个模块中的所有内容。</p><p id="e830" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在另一个模块中导入它们。</p><p id="2ed4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以对默认导出做同样的事情。</p><p id="0bba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="f7db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">things/index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d124" class="mq lc iq mh b gy mr ms l mt mu">export { default as ModuleA } from './moduleA'<br/>export { default as ModuleB } from './moduleB'<br/>export { default as ModuleC } from './moduleC'</span></pre><p id="9ca8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来导入它们:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7284" class="mq lc iq mh b gy mr ms l mt mu">import { ModuleA, ModuleB, ModuleC } from './things'</span></pre><h1 id="6ade" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">innerText和innerHTML的区别</h1><p id="2d82" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">innerText</code>和<code class="fe me mf mg mh b">innerHTML</code>的区别在于<code class="fe me mf mg mh b">innerText</code>只能处理纯文本。</p><p id="5bf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置为其值的所有内容都将被解释为纯文本。</p><p id="4fc1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，<code class="fe me mf mg mh b">innerHTML</code>会将HTML文本解释为HTML，并在屏幕上呈现它们。</p><h1 id="a099" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">当从文件输入中选择文件时，解析C:\fakepath</h1><p id="fd4f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当我们选择文件输入时，我们无法获得完整的文件路径。</p><p id="a9ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，我们可以将文件的内容读入一个字符串。</p><p id="5a63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ca60" class="mq lc iq mh b gy mr ms l mt mu">const input = document.querySelector("input");<br/>input.onchange = () =&gt; {<br/>  const fileReader = new FileReader();<br/>  fileReader.readAsDataURL(input.files[0]);<br/>  fileReader.onloadend = (event) =&gt; {<br/>    console.log(event.target.result);<br/>  }<br/>}</span></pre><p id="2b49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">input</code>元素以<code class="fe me mf mg mh b">file</code>类型输入。</p><p id="6c2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过设置一个监听器到<code class="fe me mf mg mh b">onchange</code>属性来监视文件的变化。</p><p id="d592" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建一个新的<code class="fe me mf mg mh b">FileReader</code>实例并调用<code class="fe me mf mg mh b">readAsDataURL</code>方法来读取base64字符串形式的数据。</p><p id="412f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当文件被读取时，连接到<code class="fe me mf mg mh b">fileReader</code>的<code class="fe me mf mg mh b">onloadend</code>监听器将运行。</p><p id="9f80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">event.target.result</code>有base64字符串，里面有文件的完整内容。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/6938199ec3606df31d774e6902a993c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0dOTqUmYPMbhzXTq"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@wildlittlethingsphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Helena Lopes</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="248d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="4e6c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过将字符串设置为<code class="fe me mf mg mh b">innerHTML</code>或使用<code class="fe me mf mg mh b">DOMParser</code>来解析HTML字符串。</p><p id="f9b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">parseFloat</code>将字符串转换成浮点数。</p><p id="d103" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要在文件被选中时读取其内容，我们可以使用<code class="fe me mf mg mh b">FileReader</code>构造函数。</p><p id="8b07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以用<code class="fe me mf mg mh b">*</code>从一个模块中导出所有东西。</p><h2 id="28d4" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">简单英语的JavaScript</h2><p id="4f52" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>