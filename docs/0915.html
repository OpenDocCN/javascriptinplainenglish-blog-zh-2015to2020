<html>
<head>
<title>Extend Google Map library in Angular 7+</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Angular 7+中扩展谷歌地图库</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/extend-google-map-library-in-angular-7-2720259cd19d?source=collection_archive---------7-----------------------#2020-01-02">https://javascript.plainenglish.io/extend-google-map-library-in-angular-7-2720259cd19d?source=collection_archive---------7-----------------------#2020-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="be59" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">所有你需要知道的谷歌地图的角度</h2></div><p id="ec0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，我将谷歌地图整合到我的一个Angular项目中，我对结果非常满意。我想分享我从这个过程中学到的一些技巧。</p><p id="c0fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文中使用的例子基于Jocelyn Keung的一篇文章。这是我发现的将谷歌地图集成到Angular的最清晰的“hello world”教程。</p><p id="3242" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了演示如何扩展原始的Google地图库，我在她的例子上添加了一个简单的“清除标记”特性。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/c8d71dd4f8767be8211703efa4381c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQQ31ouBID9tUKWYFTw6Bg.png"/></div></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="b30a" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">添加/清除标记</h2><p id="e230" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">要添加一个标记，需要用position进行初始化，并使用setMap方法将其与地图相关联。</p><pre class="ld le lf lg gt mt mu mv mw aw mx bi"><span id="33c2" class="lv lw iq mu b gy my mz l na nb">const marker = new google.maps.Marker({</span><span id="d601" class="lv lw iq mu b gy nc mz l na nb">   position: new google.maps.LatLng(35.2271, -80.8431),<br/>   map: this.map<br/>});<br/>marker.setMap(this.map);</span></pre><p id="1f18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">清除一个标记并不像添加一个标记那么简单，因为出于性能考虑，Google Map Api v3没有提供现成的标记。在谷歌地图官方示例中，建议将标记保存在一个全局变量数组中。清除/删除标记时，循环遍历数组并调用"。给定标记对象上的setMap(null)”。基本步骤如下所示。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="3897" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">扩展谷歌地图库</h2><p id="7a13" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">然而，上述解决方案并不理想。如果有多个屏幕需要谷歌地图集成，代码将需要到处复制。我们需要一种更有效的方法来处理它。</p><p id="5c68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更好的解决方案是通过扩展将该特性添加到Google地图库中，这样代码就可以在一个地方进行维护。</p><p id="bd19" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要扩展这个库，我们首先需要在类型定义中声明新的接口。在Jocelyn的“Hello world”示例中，有一个类型定义文件“index.d.ts”，其模块声明如下，这将使angular编译器能够工作。</p><pre class="ld le lf lg gt mt mu mv mw aw mx bi"><span id="a7f2" class="lv lw iq mu b gy my mz l na nb">declare module 'googlemaps';</span></pre><p id="d1de" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，Google地图库类型定义文件使用了名称空间而不是模块，所以要扩展它，我们需要扩展名称空间。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="e4a1" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">接口声明</h2><p id="f335" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">为了添加新文件，我使用了“custom.d.ts”:</p><pre class="ld le lf lg gt mt mu mv mw aw mx bi"><span id="3a3c" class="lv lw iq mu b gy my mz l na nb">declare global {<br/>   namespace google.maps {<br/>    interface Map {<br/>      markers: Array&lt;any&gt;;<br/>      clearMarkers(): void;<br/>    }<br/>    interface Marker {<br/>      _setMap(map: Map): void;<br/>      setMap(map: Map): void;<br/>     }<br/>   }<br/>}<br/>export default global;</span></pre><p id="d1a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要添加配置，以允许IDE识别新的类型。在tsconfig.json文件中，我添加了以下内容</p><pre class="ld le lf lg gt mt mu mv mw aw mx bi"><span id="7b43" class="lv lw iq mu b gy my mz l na nb">"typeRoots": [<br/>   "node_modules/@types",<br/>   "src/app"<br/>]</span></pre><p id="c680" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，“src/app”是本例中“custom.d.ts”文件的路径，您应该将它移动到实际项目中的正确文件夹路径。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="211a" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">履行</h2><p id="88ce" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">新接口在“custom-map.ts”中实现。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2596" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以现在，当你需要清除地图上的标记时，你只需要写一行代码</p><pre class="ld le lf lg gt mt mu mv mw aw mx bi"><span id="f9f6" class="lv lw iq mu b gy my mz l na nb">this.map.clearMarkers();</span></pre><p id="0cb9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您可以将自己的功能添加到强大的谷歌地图API库中。</p><p id="811d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望这篇文章有所帮助。你可以在这里找到完整的示例源代码<a class="ae lb" href="https://github.com/sunnyy02/googlemapAngularIntegration.git" rel="noopener ugc nofollow" target="_blank">..为了让示例项目正常工作，您需要获得一个谷歌地图API密钥，并将其添加到index.html的脚本Url中。</a></p><p id="1d10" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编程快乐！</p><p id="58c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新日期:2019年2月13日</p><h2 id="e4e5" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">Angular 9: GoogleMap现在是一个角度组件</h2><p id="6304" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">Angular 9中引入了一个谷歌地图组件，使得它更容易使用。</p><pre class="ld le lf lg gt mt mu mv mw aw mx bi"><span id="f8b0" class="lv lw iq mu b gy my mz l na nb">&lt;google-map&gt;&lt;/google-map&gt;</span></pre><p id="fbcd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新组件的Github库在这里是<a class="ae lb" href="https://github.com/angular/components/tree/master/src/google-maps" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="6024" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">如果您还不是Medium的付费会员，</em> <a class="ae lb" href="https://sunnysun-5694.medium.com/membership" rel="noopener"> <strong class="kh ir"> <em class="nf">您可以通过访问此链接</em> </strong> </a> <em class="nf">进行注册。你可以无限制地阅读媒体上的所有报道。我会收你一部分会员费作为介绍费。</em></p></div></div>    
</body>
</html>