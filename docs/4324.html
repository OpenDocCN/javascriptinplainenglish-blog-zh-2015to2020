<html>
<head>
<title>Creating a Drag and Drop System in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中创建拖放系统</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/drag-and-drop-in-react-79d926fd666e?source=collection_archive---------3-----------------------#2020-12-03">https://javascript.plainenglish.io/drag-and-drop-in-react-79d926fd666e?source=collection_archive---------3-----------------------#2020-12-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="cac6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是我在React中创建拖放系统的方法。这并不复杂，我很高兴能在这篇博文中与你分享我的过程。</p><p id="f070" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先让我们创建一个新的React应用程序。</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="b0d8" class="kr ks in kn b gy kt ku l kv kw">npx create-react-app emoji-fun-app</span></pre><p id="5385" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将它命名为“表情符号-乐趣-应用”，因为我认为拖动表情符号并创建不同的“场景”会很酷</p><p id="c66e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我将重构我的App.js文件，将其转换为一个类，并删除任何不必要的细节。不会做太多，它只会获取表情符号的API并保存我们的组件。</p><p id="40f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我从表情API下载了每一个表情符号，将数组切片，取前10个表情符号，然后将表情符号设置为应用程序的状态。我将表情符号传递给另一个组件，并通过它们进行映射</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="32ab" class="kr ks in kn b gy kt ku l kv kw">import logo from './logo.svg';<br/>import './App.css';<br/>import React from 'react'</span><span id="0460" class="kr ks in kn b gy kx ku l kv kw">export default class App extends React.Component{<br/>  <br/>  state = {<br/>    emojis: [],<br/>    url: "<a class="ae ky" href="https://emoji-api.com/emojis?access_key=baf562ed274edd3bda0cdbf65ff31eba1e658f1a" rel="noopener ugc nofollow" target="_blank">https://emoji-api.com/emojis?access_key=baf562ed274edd3bda0cdbf65ff31eba1e658f1a</a>"<br/>  }</span><span id="062b" class="kr ks in kn b gy kx ku l kv kw">componentDidMount(){<br/>    fetch(this.state.url)<br/>    .then(response =&gt; response.json())<br/>    .then(data =&gt; data.slice(0,10))<br/>    .then(data =&gt; this.setState({emojis: data}))<br/>  }</span><span id="234f" class="kr ks in kn b gy kx ku l kv kw">render(){<br/>    return(<br/>      &lt;div&gt; <br/>        &lt;h1&gt; Hello &lt;/h1&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="b013" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我创建了一个表情容器，并把表情数据作为道具传入</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="e36b" class="kr ks in kn b gy kt ku l kv kw">&lt;EmojiContainer emojis = {this.state.emojis} /&gt;</span></pre><p id="8102" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在表情容器中，我映射每个表情符号，并为每个表情符号创建一个表情卡(以显示表情符号)</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="94ab" class="kr ks in kn b gy kt ku l kv kw">//EmojiContainer.js<br/>let emojis = this.props.emojis.map(emoji =&gt; &lt;EmojiCard emoji = {emoji} /&gt;)</span><span id="3e21" class="kr ks in kn b gy kx ku l kv kw">//EmojiCard.js<br/>&lt;h1&gt; {this.props.emoji.character} &lt;/h1&gt;</span></pre><p id="4d96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在表情卡中，我正在选择一个特定的表情，所以我添加了一个点击事件并运行了一个快速控制台日志</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="bbe8" class="kr ks in kn b gy kt ku l kv kw">&lt;div onClick={(e)=&gt; {<br/>     console.log(e.target)<br/>    }}&gt; {this.props.emoji.character} &lt;/div&gt;</span></pre><p id="a364" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过这种方式，我可以选择一个表情符号，这样就可以一次拖动多个表情符号到页面上</p><p id="be56" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我要设置div的样式，并将位置设置为absolute，这样它们就不固定在任何父DIV上，可以自由移动。</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="7f91" class="kr ks in kn b gy kt ku l kv kw">&lt;div style ={{<br/>      position: "absolute",<br/>      top: 100,<br/>      left: 200,<br/>      border: "3px solid #73AD21"</span><span id="bf7d" class="kr ks in kn b gy kx ku l kv kw">}}</span></pre><p id="cf32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我将为定位X+Y坐标添加状态，并将它们的初始值设置为100</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="9791" class="kr ks in kn b gy kt ku l kv kw">state={<br/>  selectedEmoji: "",<br/>  elementX: 100, <br/>  elementY: 100<br/> }<br/>  //change the style from hardcoded numbers to reflect state<br/>  top: this.state.elementY + 'px',<br/>  left: this.state.elementX + 'px',</span></pre><p id="c7bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我要将onClick更改为名为onDragOver的React事件。这里的想法是，由于浏览器让我们访问页面的鼠标位置，当我们拖动时，让我们将elementY和elementX的状态设置为页面上鼠标的位置。这是我最初的假设，经过一些修补，它实际上是可行的…</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="20d4" class="kr ks in kn b gy kt ku l kv kw">onDragOver={(e)=&gt; {<br/>     e.stopPropagation();<br/>     e.preventDefault();<br/>     const yAxis = e.pageY<br/>     const xAxis = e.pageX</span><span id="17c3" class="kr ks in kn b gy kx ku l kv kw">this.setState({elementY: yAxis})<br/>    }}&gt; {this.props.emoji.character}</span></pre><p id="c8c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这很简单…为了让你看清楚，我们从防止拖动时自动发生的一些默认行为开始，然后通过将y轴和x轴设置为页面上用户鼠标的值来定义它们。我们正在设置状态，我们定义的轴，并在拖动时自动调整页面的样式和位置。</p><p id="5693" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我现在遇到了一个小问题，就是如何选择表情符号。我认为这是因为表情符号读起来像字符串而不是图像，这使得它们很难拖动</p><p id="00e5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据我的理解和我目前的方法，我不确定这个演示是否还能继续工作，因为字符串是不可拖动的。也许我可以创建一个放置表情符号的div，使其不可见，然后拖动它而不是表情符号…</p><p id="efeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">原来绳子根本不是问题！事实上，错误在于我在创建div时没有将draggable设置为true。如果我们继续设置它</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="df99" class="kr ks in kn b gy kt ku l kv kw">&lt;div draggable="true" className = "rectangle" style ={{<br/>      position: "absolute",<br/>      top: this.state.elementY + 'px',<br/>      left: this.state.elementX + 'px',<br/>   }}onDragOver={(e)=&gt; {<br/>    console.log(e)<br/>     e.stopPropagation();<br/>     e.preventDefault();<br/>     const yAxis = e.pageY <br/>     const xAxis = e.pageX</span><span id="a6fc" class="kr ks in kn b gy kx ku l kv kw">this.setState({elementY: yAxis})<br/>    }}&gt; {this.props.emoji.character} &lt;/div&gt;<br/>   &lt;/div&gt;</span></pre><p id="1847" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在可以上下拖动表情符号。现在，我只对Y轴进行操作，以确保正常工作，一旦设置好，我将从X轴开始</p><figure class="ki kj kk kl gt lb gh gi paragraph-image"><div class="gh gi la"><img src="../Images/bdbcc3e968c7a3edcc556073d4fc0e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/1*-avq_NDYsU8DNKS_JsQYxg.gif"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Dragging on the Y Axis</figcaption></figure><p id="b99b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">太棒了，现在Y轴开始工作了。我们可以从X轴开始，添加下面几行代码</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="99aa" class="kr ks in kn b gy kt ku l kv kw">//setting the x-axis to the mouse position of the mouse on the page<br/>const xAxis = e.pageX</span><span id="2e6d" class="kr ks in kn b gy kx ku l kv kw">//set state to the mouse position<br/>this.setState({elementX: xAxis})</span><span id="e21b" class="kr ks in kn b gy kx ku l kv kw">//update the style 'left' from the staet<br/>left: this.state.elementX + 'px',</span></pre><p id="c084" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经设置了X轴，我们应该有完全的权限来拖动我们的表情符号在页面上！</p><figure class="ki kj kk kl gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/3b99684e9b024965fa594eaf72891b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jzE_bNvwz_lb7DSOJMMz4w.gif"/></div></div></figure><p id="f807" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你的表情符号终于免费了！</p><p id="6d8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里有一个小问题，我似乎无法解决，但是当设置状态时，你需要从鼠标位置减去10。如果你对如何解决这个问题有任何想法，请在评论中告诉我！</p><p id="9774" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">直到下周，</p><p id="efa0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安迪(男子名ˌ等于Andrew)</p></div></div>    
</body>
</html>