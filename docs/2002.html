<html>
<head>
<title>Drastically reducing your stylesheet size with Tailwind and PurgeCSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tailwind和PurgeCSS大幅减小样式表的大小</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/drastically-reducing-your-stylesheet-size-with-tailwind-and-purgecss-bcda729b6dc3?source=collection_archive---------6-----------------------#2020-05-11">https://javascript.plainenglish.io/drastically-reducing-your-stylesheet-size-with-tailwind-and-purgecss-bcda729b6dc3?source=collection_archive---------6-----------------------#2020-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f91bb24fbeedad64c118bb3ac854bc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2TDzYZoBvEZioIPA.png"/></div></div></figure><p id="381e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://medium.com/javascript-in-plain-english/adding-tailwind-support-to-a-nrwl-nx-workspace-with-angular-and-storybook-bf890ea882e" rel="noopener">之前的一篇文章</a>中，我已经解释了如何用Angular和Storybook在Nrwl NX工作区中安装<a class="ae kw" href="http://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> Tailwind </a>。</p><p id="5b48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种设置很好，但是有一个主要问题:样式表包的大小。在我的项目中，它超过2MB。我不知道你怎么想，但是2MB的CSS感觉像是<em class="kx">一大堆</em>。</p><p id="f608" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将解释什么是PurgeCSS 以及如何利用它来大幅减小样式表的大小。</p><h1 id="919e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">问题是</h1><p id="0395" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">为什么我最后得到了2MB的样式表？我当然没有在我的申请中介绍那么多风格。</p><p id="ebd3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们使用像Bootstrap或Tailwind这样的CSS框架时，实际上有成千上万的内置样式我们没有使用。在顺风的情况下，情况更糟，因为它会根据自己的配置生成大量的样式。例如，向顺风配置添加单一颜色意味着添加大量规则，如bg-newColor-100、bg-newColor-200、text-newColor-100、text-newColor-200等等。</p><p id="11f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">顺风的许多其他设置也是如此。我们不想改变顺风，因为它很好，因为我们希望所有这些风格都可以使用。但是，如果我们不使用它们，我们不希望它们仍然存在于样式表中。</p><p id="e24f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看如何解决这个问题。</p><h1 id="2750" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">采购</h1><p id="2763" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">PurgeCSS 是一个专用于查找/删除未使用的CSS的工具。</p><p id="5fc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它以非常简单的方式工作。一旦集成到项目的构建管道中，它将扫描:</p><ul class=""><li id="77bb" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">我们所依赖的CSS文件</li><li id="31b1" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated"><em class="kx">内容</em>文件是我们喂它的</li></ul><p id="bc48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过扫描CSS文件，它将识别所有存在的选择器。然后，通过扫描内容文件(例如，我们项目代码中的JS/TS/HTML/CSS文件)，它将识别实际使用了哪些CSS选择器。</p><p id="5d8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了识别哪些CSS选择器被真正使用，PurgeCSS使用了它所谓的<a class="ae kw" href="https://purgecss.com/extractors.html" rel="noopener ugc nofollow" target="_blank">提取器</a>。提取器是简单的函数，它将文件的内容作为输入，并返回CSS选择器的数组。</p><p id="4d86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦完成，PurgeCSS就可以将使用的选择器列表与可用的选择器列表进行比较，并识别出所有不需要的选择器。</p><p id="e1e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PurgeCSS可以用不同的方式<a class="ae kw" href="https://purgecss.com/configuration.html#configuration-file" rel="noopener ugc nofollow" target="_blank">配置</a>。在我们的例子中，我们将使用Tailwind本身公开的配置(详见下一节)。</p><p id="273c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有几个选项需要注意:</p><ul class=""><li id="9d72" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">css:指向要分析的CSS的文件名和/或<a class="ae kw" href="https://github.com/isaacs/node-glob/blob/master/README.md#glob-primer" rel="noopener ugc nofollow" target="_blank"> globs </a>的数组(即，应该被<em class="kx">清理的CSS</em></li><li id="7c6c" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">content:指向要分析的项目内容的文件名和/或globs的数组(即，在其中识别实际使用的内容)</li><li id="4b94" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">defaultExtractor:自定义PurgeCSS的默认选择器提取器</li><li id="3be1" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">提取器:提取器函数的数组；其中每一个都是具有一组扩展名(即，它可以处理的文件类型)和提取器函数的对象。这可以用来获得更好的清理结果(即，如果PurgeCSS没有找到/清理它应该找到的所有东西)</li></ul><p id="fda8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有更多的选项可以进一步清理字体、CSS变量等等。你可以在这里查看:<a class="ae kw" href="https://purgecss.com/configuration.html#options" rel="noopener ugc nofollow" target="_blank">https://purgecss.com/configuration.html#options</a></p><h1 id="9a5d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">轻如鸿毛</h1><p id="093a" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">既然我正在写这篇文章，你可能会猜到，是的，PurgeCSS可以帮助我们移除未使用的顺风样式。</p><p id="a361" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实上，Tailwind对PurgeCSS 有<a class="ae kw" href="https://tailwindcss.com/docs/controlling-file-size/" rel="noopener ugc nofollow" target="_blank">一流的支持；它直接集成它，并通过它的配置文件公开它的特性。</a></p><p id="bd67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是我如何配置PurgeCSS is我的项目:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="73cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，在配置中有一个恰当的称为“purge”的部分。通过它，我们实际上是在配置PurgeCSS。</p><p id="5d9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">内容选项确实是PurgeCSS的内容选项。通过它，我将PurgeCSS指向我的项目的所有内容文件。由于这是一个带有Angular应用程序的Nrwl NX工作区，我简单地将它指向“apps”和“libs”文件夹下的所有html/scss/ts文件。这样，PurgeCSS应该能够找到我正在使用的所有规则。</p><p id="7af4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在顺风的情况下，不需要配置“css”选项；默认情况下，Tailwind会为我们做这件事。注意，它当然只考虑顺风CSS规则。您也可以将PurgeCSS用于其他CSS库，但是我不会在这里讨论这个。</p><p id="5a9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一个设置“option”可用于进一步配置PurgeCSS。在上面的例子中，我启用了PurgeCSS的“rejected”和“printRejected”设置，这允许我对PurgeCSS所做的事情进行故障诊断。</p><p id="8851" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我使用PurgeCSS的“白名单模式”选项来排除角形CDK和角形材质使用的选择器前缀，目前它们仍在我的项目中使用。</p><p id="1671" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我们甚至不需要编写提取器函数；顺风为我们做了这一切。</p><p id="4034" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了这个配置，PurgeCSS将在应用程序的<em class="kx">生产</em>版本生成时完成它的工作。在我的例子中，CSS样式表从2MB变成了更合理的125KB。</p><h1 id="64a7" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Webpack生产模式</h1><p id="613c" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">关于这种配置，还有最后一件事需要了解。正如我所说的，PurgeCSS将只在生产构建中执行。这样做的原因是PurgeCSS真的很密集/很慢。我们只是不希望它在开发期间运行。</p><p id="51b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了确定是否应该启用PurgeCSS，我们依赖于Webpack的“mode”设置。</p><p id="8aca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了配置它，我在package.json文件中修改了生产构建脚本:</p><pre class="mp mq mr ms gt mv mw mx my aw mz bi"><span id="41ab" class="na kz iq mw b gy nb nc l nd ne">"build:prod:web": "NODE_ENV=production nx run web:build --prod",</span></pre><p id="8eab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在要求NX构建“web”应用程序的生产版本之前，上面简单地将NODE_ENV变量设置为“production”。</p><p id="9fa9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我利用Webpack配置中的环境变量来启用生产模式:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6f49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您在上面看到的，如果NODE_ENV变量设置为“production ”,那么我相应地设置了Webpack的模式选项。</p><h1 id="42ba" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="2edd" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在本文中，我解释了为什么我们使用Tailwind时需要清理CSS样式表，以及如何利用PurgeCSS来完成这项工作。</p><p id="ff15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于Tailwind对PurgeCSS的内置支持，这真的很容易集成/配置。</p><p id="f9c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">配置PurgeCSS之后，我们的样式表从2MB变成了~125KB，这就好多了。应该可以进一步优化，但这已经足够我目前的需求了。</p><p id="0e50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天到此为止！</p><p id="7af1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> PS </strong>:如果你想学习大量关于软件开发、Web开发、TypeScript、Angular、React、Vue、Kotlin、Java、Docker/Kubernetes和其他很酷的主题的其他很酷的东西，那么不要犹豫去<a class="ae kw" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">拿一本我的书</a>并订阅<a class="ae kw" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的简讯</a>！</p><h2 id="d247" class="na kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated"><strong class="ak">简明英语团队的笔记</strong></h2><p id="7572" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">你知道我们有四种出版物吗？给他们一个follow来表达爱意:<a class="ae kw" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="ka ir">JavaScript in Plain English</strong></a><a class="ae kw" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ka ir">AI in Plain English</strong></a><a class="ae kw" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ka ir">UX in Plain English</strong></a><a class="ae kw" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ka ir">Python in Plain English</strong></a><strong class="ka ir"/>—谢谢，继续学习！</p><p id="7f83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我们总是有兴趣帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kw" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">submissions @ plain English . io</strong></a><strong class="ka ir"/>，附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>