<html>
<head>
<title>The Express.js Response Object — More Ways to Send</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Express.js响应对象—更多发送方式</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/guide-to-the-express-response-object-more-ways-to-send-4091224978e4?source=collection_archive---------3-----------------------#2020-03-04">https://javascript.plainenglish.io/guide-to-the-express-response-object-more-ways-to-send-4091224978e4?source=collection_archive---------3-----------------------#2020-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2eabbefa2ea4fec41dd1dcab6261239b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8hYRxs-rZA8u0U38"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jannerboy62?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nick Fewings</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="04d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Express response对象允许我们向客户端发送响应。</p><p id="1a9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以发送各种响应，比如字符串、JSON和文件。此外，除了主体之外，我们还可以向客户端发送各种标头和状态代码。</p><p id="898b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何设置头和发送状态代码，包括设置头的<code class="fe lb lc ld le b">set</code>方法、设置响应状态代码的<code class="fe lb lc ld le b">status</code>、设置<code class="fe lb lc ld le b">Content-Type</code>头值的<code class="fe lb lc ld le b">type</code>方法和设置<code class="fe lb lc ld le b">Vary</code>头值的<code class="fe lb lc ld le b">vary</code>方法。</p><h1 id="a02e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">方法</h1><h2 id="95e0" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源集(字段[，值])</h2><p id="ba98" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">set</code>方法在发送响应之前设置响应头。</p><p id="d08d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="a3fc" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="22bc" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.set({<br/>    'Content-Type': 'text/plain',<br/>    'Content-Length': '100'<br/>  })<br/>    .send();<br/>})<br/>app.listen(3000);</span></pre><p id="c3ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们向<code class="fe lb lc ld le b">/</code>发出请求时，我们得到<code class="fe lb lc ld le b">Content-Length</code>头被设置为100，而<code class="fe lb lc ld le b">Content-Type</code>被设置为<code class="fe lb lc ld le b">text/plain</code>。</p><p id="5ed6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，我们必须调用<code class="fe lb lc ld le b">send</code>来发送响应。</p><p id="e58a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用Postman这样的HTTP客户端来验证这一点。</p><h2 id="980d" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源状态(代码)</h2><p id="2f32" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们可以调用<code class="fe lb lc ld le b">status</code>方法在发送响应之前添加一个状态代码。</p><p id="25c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="42ce" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="9926" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.status(400).send('Bad Request');<br/>})</span><span id="694d" class="md lg iq le b gy ng nd l ne nf">app.listen(3000);</span></pre><p id="7ee8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到显示的<code class="fe lb lc ld le b">Bad Request</code>和400响应代码。</p><h2 id="fd10" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源类型(类型)</h2><p id="75f6" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated"><code class="fe lb lc ld le b">type</code>方法将<code class="fe lb lc ld le b">Content-Type</code> HTTP头设置为由<code class="fe lb lc ld le b">mime.lookup()</code>方法从指定类型的<code class="fe lb lc ld le b">node-mime</code>包中确定的MIME类型。</p><p id="1858" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe lb lc ld le b">type</code>包含<code class="fe lb lc ld le b">/</code>字符，那么它将<code class="fe lb lc ld le b">Content-Type</code>设置为<code class="fe lb lc ld le b">type</code>。</p><p id="ae83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此方法不发送响应。</p><p id="4e7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="1a10" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="ef0b" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res.type('.html').send();<br/>})<br/>app.listen(3000);</span></pre><p id="dc38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe lb lc ld le b">Content-Type</code>响应头的值是<code class="fe lb lc ld le b">text/html; charset=utf-8</code>。</p><p id="04d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="3d6e" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="eb8f" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res.type('.png').send();<br/>})<br/>app.listen(3000);</span></pre><p id="7c33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们得到<code class="fe lb lc ld le b">Content-Type</code>的值是<code class="fe lb lc ld le b">image/png</code>而不是<code class="fe lb lc ld le b">text/html</code>。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/9f1c45efeafbb67af9c7bded5458430d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tfqdDhV2NxNU0W_1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@reskp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jametlene Reskp</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="3ea1" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">分辨率变化(字段)</h2><p id="41f9" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">如果这个字段还不存在的话，<code class="fe lb lc ld le b">vary</code>方法会将它添加到<code class="fe lb lc ld le b">Vary</code>响应头中。</p><p id="e94c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="b037" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const path = require('path');<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="f5df" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res.vary('User-Agent').send();<br/>})<br/>app.listen(3000);</span></pre><p id="7a6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe lb lc ld le b">Vary</code>响应头设置为<code class="fe lb lc ld le b">User-Agent</code>。</p><p id="96df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">Vary</code>头让我们可以进行内容协商，这是一种用相同的URL提供不同种类数据的机制。</p><p id="aacc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用户代理可以指定什么最适合服务器。</p><p id="b4a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">Vary</code>头指示哪些头用于内容协商。</p><p id="5abc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我们将<code class="fe lb lc ld le b">Vary</code>头设置为<code class="fe lb lc ld le b">User-Agent</code>，我们的应用程序根据浏览器的用户代理使用<code class="fe lb lc ld le b">User-Agent</code>头来提供不同种类的内容。</p><h1 id="80f4" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="70ab" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated"><code class="fe lb lc ld le b">set</code>方法让我们在发送响应之前设置头部。它接受一个带有我们想要发送的响应头的对象。</p><p id="aa18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">status</code>方法用于在发送之前设置响应状态代码。我们可以用响应体来链接它。</p><p id="6a41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">type</code>方法用于设置<code class="fe lb lc ld le b">Content-Type</code>标题值。返回的MIME-type由来自<code class="fe lb lc ld le b">node-mime</code>的<code class="fe lb lc ld le b">mime.lookup()</code>方法确定。</p><p id="d21f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置<code class="fe lb lc ld le b">Vary</code>标题值的<code class="fe lb lc ld le b">vary</code>方法。<code class="fe lb lc ld le b">Vary</code>头用于内容协商，根据<code class="fe lb lc ld le b">Vary</code>头的值指定的字段提供不同的内容。</p></div></div>    
</body>
</html>