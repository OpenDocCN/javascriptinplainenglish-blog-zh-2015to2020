<html>
<head>
<title>How to develop, test, run and publish npm packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何开发、测试、运行和发布npm包</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-develop-test-run-and-publish-an-npm-module-react-and-webpack-f436adb54bbb?source=collection_archive---------9-----------------------#2020-05-09">https://javascript.plainenglish.io/how-to-develop-test-run-and-publish-an-npm-module-react-and-webpack-f436adb54bbb?source=collection_archive---------9-----------------------#2020-05-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/b90cd0f848a1299eb2bf38145d2771a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*UnwFMi9Bs3-YVC0XGeTx_g.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">keep it modular</figcaption></figure><figure class="jv jw jx jy gt jo"><div class="bz fp l di"><div class="jz ka l"/></div></figure><p id="50b1" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">发布npm模块有一些好处。将代码组织成模块化的<strong class="kd io"> npm </strong>包将有助于整理代码库，鼓励重用，并且可以成为团队之间甚至不同架构的项目之间更好的共享方式(<a class="ae kz" href="https://blog.engineyard.com/integrating-react-with-backbone" rel="noopener ugc nofollow" target="_blank">将react组件重新绑定到主干类</a>)！</p><p id="179d" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">因此，以下是实现这一目标的关键步骤:</p><ol class=""><li id="20ca" class="la lb in kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">设置一个以npm构建为中心的项目——您的模块报告，</li><li id="aa64" class="la lb in kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">使用本地测试运行*和并行测试运行**两种技术，在开发过程中测试运行npm模块。</li></ol><p id="5e24" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">3.将npm模块注册并发布到nmp js。</p><p id="7f57" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">*临时react-DOM+index.html设置，以将其作为应用程序模块目录运行</p><p id="5cba" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">* *将您的-module作为node_module加载到另一个应用程序的上下文中-您的-app-repo</p><h2 id="e044" class="lo lp in bd lq lr ls dn lt lu lv dp lw km lx ly lz kq ma mb mc ku md me mf mg bi translated">1.设置模块报告—用于发布npm模块的react项目</h2><p id="49a8" class="pw-post-body-paragraph kb kc in kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky ig bi translated">使用yarn或npm设置<strong class="kd io"> your-module-repo </strong>，它将包含构建模块的设置。</p><p id="63c9" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">您不需要react-dom，因为发布的模块将以组件而不是应用程序的形式出现。但是，对于本地测试运行目的，在作为普通react应用程序开发时，使用react-dom和public/index.html来呈现模块组件是很方便的。</p><p id="9492" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">创建一个轻量级react项目，并将其结构化为包含<strong class="kd io"> lib、</strong> <strong class="kd io"> src </strong>和临时<strong class="kd io"> public </strong>文件夹，如下所示:</p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/d20882140b0ab8eeda907644b560f002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wErbxHJ2nPpsZdatFLL3LQ.png"/></div></div></figure><p id="35b9" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">接下来安装<strong class="kd io"> webpack </strong>、<strong class="kd io"> webpack-cli </strong>(以及您可能用于您的-module-repo的任何加载程序)。</p><p id="f524" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">setup<strong class="kd io">web pack . config . JS</strong>用于将react代码转换为JS——它将成为npm模块(位于lib/index.js):</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="494a" class="lo lp in ms b gy mw mx l my mz">var path = require('path')</span><span id="0a0f" class="lo lp in ms b gy na mx l my mz">module.exports = {</span><span id="3e50" class="lo lp in ms b gy na mx l my mz">  mode: 'production', </span><span id="bf40" class="lo lp in ms b gy na mx l my mz">  entry: './src/index.js',</span><span id="6c4a" class="lo lp in ms b gy na mx l my mz">  output: {</span><span id="cb71" class="lo lp in ms b gy na mx l my mz">    path: path.resolve(__dirname, <strong class="ms io">'lib'</strong>),</span><span id="5af4" class="lo lp in ms b gy na mx l my mz">    filename: 'index.js',</span><span id="8960" class="lo lp in ms b gy na mx l my mz">    libraryTarget: 'commonjs2'</span><span id="ad04" class="lo lp in ms b gy na mx l my mz">  },</span><span id="c356" class="lo lp in ms b gy na mx l my mz">  module: {</span><span id="7d15" class="lo lp in ms b gy na mx l my mz">    rules: [</span><span id="e3eb" class="lo lp in ms b gy na mx l my mz">       // your modules rules, loaders for js, css, and others...</span><span id="513a" class="lo lp in ms b gy na mx l my mz">    ]</span><span id="d584" class="lo lp in ms b gy na mx l my mz">  },</span><span id="50f0" class="lo lp in ms b gy na mx l my mz">  externals: {</span><span id="675b" class="lo lp in ms b gy na mx l my mz">    react: 'commonjs react'</span><span id="d7dd" class="lo lp in ms b gy na mx l my mz">  }</span><span id="f49d" class="lo lp in ms b gy na mx l my mz">}</span></pre><p id="9447" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">确保您安装了路径和<em class="nb">其他加载器</em>，它们在您的-module-repo webpack设置中作为编译js、css和其他文本资源的规则被引用。</p><p id="975a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这就是我在<strong class="kd io"> webpack.config.js </strong>中的配置的最终结果:</p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nc"><img src="../Images/5dca87073d6dd714679a710c80ddabca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHYagX-snPBN54SLgXxqvA.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Configure your webpack.config.js for npm module build into lib/index.js</figcaption></figure><p id="226a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">接下来—让我们设置<strong class="kd io">package . JSON</strong>—NPM发布的主要负载。确保提供主要关键字，例如:<strong class="kd io">名称、主要、版本、作者、关键字、对等依赖</strong>和构建<strong class="kd io">脚本。</strong></p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nd"><img src="../Images/f249458ccc708611b9c0a7ab07653fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*62vsw4NbqnhagctB0juSNg.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">configure your package.json for npm module build and publishing</figcaption></figure><p id="1f38" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在让我们用组件填充<strong class="kd io"> src/index.js </strong>，该组件应该成为公开可用的npm模块。在我的例子中，它看起来像这样:</p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ne"><img src="../Images/2d79f4557685cd8e00c2bbc6c5797a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IT7r3OtpN0xAR3SXs4mPOQ.png"/></div></div></figure><p id="d5c0" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">至此，3个主<strong class="kd io"> webpack.config.js </strong>、<strong class="kd io"> package.json </strong>和<strong class="kd io"> src/index.js </strong>都已设置好，运行命令时有望顺利运行:</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="dd99" class="lo lp in ms b gy mw mx l my mz">yarn build:npm</span></pre><p id="035b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">然后检查<strong class="kd io">lib/index . js</strong>——此时应该填充大量JS代码。</p><h2 id="bb81" class="lo lp in bd lq lr ls dn lt lu lv dp lw km lx ly lz kq ma mb mc ku md me mf mg bi translated">2.本地测试运行、并行测试运行和测试🚀🚀🚀</h2><p id="55b8" class="pw-post-body-paragraph kb kc in kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky ig bi translated">希望有时间编写一些单元/集成测试并看到它们通过。</p><p id="79e8" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">希望您已经使用了临时react-dom安装和您的-module-repo中的public/index.html文件来将模块组件本地呈现为app(如果该部分已经完成，请确保删除react-dom和public/index.html)。最重要的是，希望一切运行、构建和执行顺利。</p><p id="636b" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我很难过打破它——但这些还不足以真正看到当它作为一个小“砖块”被导入到另一个应用程序中时，该模块会播放得很好。</p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/837484b7460339edd13998e3272ffc12.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*zccpCLr9I0rg_6oFJeSzQQ.gif"/></div></figure><p id="8925" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">不过不要担心——你可以做一个很好的测试，它会揭示“应用中的模块”的动态，并会节省你很多时间，因为你不需要将模块重新发布到npmjs.com 100多次🙃。</p><h2 id="27ce" class="lo lp in bd lq lr ls dn lt lu lv dp lw km lx ly lz kq ma mb mc ku md me mf mg bi translated">在并行应用程序(您的应用程序)中测试运行您的模块:</h2><p id="2232" class="pw-post-body-paragraph kb kc in kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky ig bi translated">在将模块发布到npm之前，使用另一个应用程序项目来模拟安装您的模块:</p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ng"><img src="../Images/0911cf6256cc9a1c2f49cf0d914849a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hytaomnAwNO9HlBVH5Rk3A.png"/></div></div></figure><p id="bee1" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">切换到<strong class="kd io"> your-app-repo，</strong>从那里<strong class="kd io">T5】使用<em class="nb">纱添加</em>和<strong class="kd io"> your-module-repo的完整路径。这将把您的-module-repo添加到node_modules，就像它是一个npm模块一样。所以步骤是:</strong></strong></p><p id="9fcd" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">a)将您的模块添加到您的应用程序:</p><p id="cd2a" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在您的-app-repo的根目录中运行命令，将您的-module-repo添加为仿npm模块:</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="ed0c" class="lo lp in ms b gy mw mx l my mz">yarn add /Users/&lt;your_name&gt;/Projects/your-module-repo/</span></pre><p id="71e2" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这将需要一分钟时间，因为您的-module-repo已添加，并且安装依赖项需要时间。</p><p id="4fe7" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">b)在您的-app-repo源代码中导入您的-模块。</p><p id="46ec" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在your-app-repo中，导入faux-npm模块，通过package.json中给出的名称引用它。</p><p id="41ea" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在您的-app-repo/src/index.js中，我的情况是这样的:</p><figure class="jv jw jx jy gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nh"><img src="../Images/0d4fd920fe395cbf4de9948ae6b3f984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gvNgrUxfEEphegi2_FVLZw.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">test the integration of your module by adding it to a completely different app and run it locally</figcaption></figure><p id="7288" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在，运行你的-app-repo应该可以揭示你的-module集成得有多好。不要因为错误而气馁…我个人经历了多次调整，直到每个细节都到位🌟。</p><h1 id="0093" class="ni lp in bd lq nj nk nl lt nm nn no lw np nq nr lz ns nt nu mc nv nw nx mf ny bi translated">3.向npmjs.com注册并发布你的模块</h1><p id="0406" class="pw-post-body-paragraph kb kc in kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky ig bi translated">我们快到了😁。感谢本地测试和并行测试——发布模块应该是1或2个游戏实例😎。</p><p id="5171" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">如果你还没有注册，首先去npmjs.com注册。请务必确认您收件箱中的电子邮件地址，以便能够发布到npmjs.com</p><p id="4cb5" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">下一步在你的-模块-回购添加和闪亮的自述文件，将成为你的npmjs.com/package/your-module-name.的脸</p><p id="a929" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">然后，确保您的模块是最新版本:</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="03d5" class="lo lp in ms b gy mw mx l my mz">yarn build:npm</span></pre><p id="53ef" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">运行以下命令后，使用相关凭据通过终端登录npm:</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="4245" class="lo lp in ms b gy mw mx l my mz">npm login</span></pre><p id="dde8" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">并将您的模块发布到npm:</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="1e2f" class="lo lp in ms b gy mw mx l my mz">npm publish</span></pre><p id="9676" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">就这样，希望顺利通过。您可以查看更多信息:</p><pre class="jv jw jx jy gt mr ms mt mu aw mv bi"><span id="c3b4" class="lo lp in ms b gy mw mx l my mz">npm info your-module-name</span></pre><p id="1625" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">出版的模块应可在npmjs.com/package/your-module-name.获得</p><p id="8b1c" class="pw-post-body-paragraph kb kc in kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我希望你喜欢，请鼓掌并订阅🥂</p><h1 id="38cb" class="ni lp in bd lq nj nk nl lt nm nn no lw np nq nr lz ns nt nu mc nv nw nx mf ny bi translated">来自简明英语团队的说明</h1><p id="3ce2" class="pw-post-body-paragraph kb kc in kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky ig bi translated">简明英语刚刚推出了一个YouTube频道！我们希望您现在就通过<a class="ae kz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kd io">订阅来支持我们！</strong>T3】</a></p></div></div>    
</body>
</html>