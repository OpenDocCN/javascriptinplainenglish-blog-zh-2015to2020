<html>
<head>
<title>How to Build a Checkbox Tree with Angular FormArray</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建具有角度数组的复选框树</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-checkbox-tree-with-angular-formarray-eeb972ee41f7?source=collection_archive---------5-----------------------#2020-08-31">https://javascript.plainenglish.io/building-a-checkbox-tree-with-angular-formarray-eeb972ee41f7?source=collection_archive---------5-----------------------#2020-08-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/dc1589963a39bd52c62cd83f9e62855d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vESxsHLNXiGHNPDg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fotis Fotopoulos</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="83a6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您想了解如何实现单选按钮树，您可以查看以下链接:</p><div class="ky kz gp gr la lb"><a href="https://medium.com/@ramya.bala221190/building-a-radio-button-tree-using-angular-formarray-b30c4c49e65c" rel="noopener follow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">使用角度公式构建单选按钮树</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">我在许多web应用程序中发现了单选按钮树结构。这个故事展示了你可以…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">medium.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jt lb"/></div></div></a></div><p id="0add" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">实现复选框树与单选按钮树非常相似，但略有不同。</p><p id="19d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是我们将使用的数据。这是一系列从<strong class="kc io">书籍中导出的物品</strong></p><figure class="lq lr ls lt gt jo"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="85ec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每一个对象都描述了书的类型，一些用这种风格写的书的作者，以及他们写的书。</p><p id="b190" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以上数据以复选框树格式填充，如下所示。我们还打印了表单的价值。</p><figure class="lq lr ls lt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/d1395a8bd3fb35161ffba2bfede937bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXW0oy2SPFLu-4VjnkOtUw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Checkbox Tree</figcaption></figure><p id="a3af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> AppComponent模板:</strong></p><figure class="lq lr ls lt gt jo"><div class="bz fp l di"><div class="lu lv l"/></div></figure><ol class=""><li id="0c4f" class="lx ly in kc b kd ke kh ki kl lz kp ma kt mb kx mc md me mf bi translated">从<strong class="kc io">图书中导出的数组<strong class="kc io">图书列表</strong>，ts </strong>对应下面的表格<strong class="kc io">图书数组</strong>。</li></ol><pre class="lq lr ls lt gt mg mh mi mj aw mk bi"><span id="0fca" class="ml mm in mh b gy mn mo l mp mq">&lt;ng-container <strong class="mh io">formArrayName=”booksArray”</strong>&gt;</span></pre><p id="e6ed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.books数组中的每个对象都包含两个属性:类型和作者；类型是一个字符串，作者是一个对象数组。</p><p id="b770" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以每个对象都是一个<strong class="kc io"> FormGroup </strong>，<strong class="kc io">型字符串</strong>对应<strong class="kc io">型FormControl </strong>，<strong class="kc io">作者数组</strong>对应<strong class="kc io">作者数组</strong>。</p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="2fef" class="mu mm in mh b be mv mw l mx mq">&lt;ng-container formArrayName=”booksArray”&gt;<br/>&lt;ul&gt;<br/>&lt;li *ngFor=”let x of booksFormArray.controls; let i = index” <br/>[formGroupName]=”i”&gt;<br/>&lt;i #bookType appToggleChevron class=”fa fa-angle-double-right”&gt;<br/>&lt;input type=”text” formControlName=”type” /&gt;<br/>&lt;/i&gt;<br/>&lt;ng-container formArrayName=”authors”&gt;</span></pre><p id="d4e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.在作者数组中，我们又有了两个属性的对象:名字和书籍；名字是一个字符串，书籍是一个字符串数组。</p><p id="3093" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以每个对象都是一个<strong class="kc io"> FormGroup </strong>，<strong class="kc io"> name property </strong>对应<strong class="kc io"> name FormControl </strong>，<strong class="kc io"> books array </strong>对应<strong class="kc io"> select FormArray </strong>。</p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="a8ba" class="mu mm in mh b be mv mw l mx mq">&lt;li *ngFor=”let y of returnAuthors(x); let j = index” [formGroupName]=”j”&gt;<br/>&lt;i #authorName appToggleChevron class=”fa fa-angle-double-right”&gt;<br/>&lt;input type=”text” formControlName=”name” /&gt;<br/>&lt;/i&gt;<br/>&lt;ng-container formArrayName=”select”&gt;</span></pre><p id="6d56" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.最后，属性书<strong class="kc io">的每个元素都是一个字符串。所以每个元素都是<strong class="kc io"> FormControl。</strong></strong></p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="0bc2" class="mu mm in mh b be mv mw l mx mq">&lt;ul [ngClass]=”[authorName.classList.contains(‘fa-angle-double-right’)? ‘close’: ‘open’]”&gt;<br/>&lt;li *ngFor=”let z of returnBooks(y); let m = index”&gt;<br/>&lt;input type=”checkbox” formControlName=”{{ m }}” [value]=”z.value”/&gt;<br/>{{ data[i].authors[j].books[m] }}<br/>&lt;/li&gt;<br/>&lt;/ul&gt;</span></pre><p id="2dc2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们来看看<strong class="kc io"> AppComponent类</strong>:</p><figure class="lq lr ls lt gt jo"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="c4c9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们从<strong class="kc io">书籍中导出的数据是一个对象数组。我们已经将这个对象数组存储在属性<strong class="kc io">数据</strong>中。</strong></p><p id="a750" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此我们将首先使用<strong class="kc io"> FormArray </strong>构建数组，命名为<strong class="kc io">book array</strong>，如下图所示。数组被初始化为[]。</p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="3739" class="mu mm in mh b be mv mw l mx mq">ngOnInit() {<br/>this.checkBoxForm = this.fb.group({<br/>booksArray: this.fb.array([]),<br/>});<br/>this.displayBooks();<br/>}</span></pre><p id="99b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">属性数据</strong>中的每个book对象对应一个FormGroup，基于属性值，该对象中的每个属性对应一个form control/FormArray/form group。</p><p id="49fb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面的<strong class="kc io"> displayBooks() </strong>将把<strong class="kc io">属性数据</strong>中的每个book对象映射到一个FormGroup。该映射通过<strong class="kc io"> createBookFormGroup()完成。</strong>该方法以图书对象为论据。</p><p id="20d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">映射的结果是存储在变量<strong class="kc io"> transformedBooks </strong>中的FormGroups数组。然后使用<strong class="kc io"> setControl()将<strong class="kc io">转换后的图书</strong>设置为形式数组<strong class="kc io">图书数组</strong>的值。</strong></p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="0b0f" class="mu mm in mh b be mv mw l mx mq">displayBooks() {<br/>let transformedBooks = this.data.map((book: any) =&gt;<br/>this.createBookFormGroup(book)<br/>);<br/>this.radioForm.setControl(‘booksArray’, this.fb.array(transformedBooks));<br/>}</span></pre><pre class="my mg mh mr bn ms mt bi"><span id="4b42" class="mu mm in mh b be mv mw l mx mq">createBookFormGroup(book: any) {<br/>return this.fb.group({<br/>type: [book.type],<br/>authors: this.fb.array(this.loadAuthors(book.authors)),<br/>});<br/>}</span></pre><p id="0b02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> createBookFormGroup() </strong>返回一个带有2个FormControls的新FormGroup。每个FormGroup包含一个名为<strong class="kc io"> type </strong>的FormControl和一个名为<strong class="kc io"> authors </strong>的FormArray。</p><p id="28f3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">FormControl <strong class="kc io"> type </strong>包含书的类型，而FormArray <strong class="kc io"> authors </strong>也是一个对象数组，其中每个对象包含作者的名字和作者写的书。</p><p id="5e40" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">格式数组<strong class="kc io"> authors </strong>由<strong class="kc io"> loadAuthors() </strong>填充，它将book对象的<strong class="kc io"> authors属性</strong>作为参数。</p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="02a8" class="mu mm in mh b be mv mw l mx mq">loadAuthors(authorsList: any) {<br/>return authorsList.map((author: any) =&gt; this.createAuthorFormGroup(author));<br/>}</span></pre><pre class="my mg mh mr bn ms mt bi"><span id="7c24" class="mu mm in mh b be mv mw l mx mq">createAuthorFormGroup(author: any) {<br/>return this.fb.group({<br/>name: [author.name],<br/>select: this.fb.array(this.loadBooks(author.books)),<br/>});<br/>}</span></pre><p id="6783" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们正在做和以前非常相似的事情。我们将每个author对象映射到一个新的FormGroup。映射是通过<strong class="kc io">createAuthorFormGroup()</strong>完成的，它将author对象作为参数。映射的结果是一个FormGroups数组，它被返回给调用者以填充<strong class="kc io"> authors </strong> FormArray。</p><p id="e669" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述方法返回的每个FormGroup包含2个form control:form control-<strong class="kc io">name</strong>和一个FormArray- <strong class="kc io"> select。</strong></p><p id="ca12" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">FormControl <strong class="kc io"> name </strong>对应于<strong class="kc io"> authors属性</strong>数组中的<strong class="kc io"> name属性</strong>，FormArray <strong class="kc io"> select </strong>对应于authors数组中的数组<strong class="kc io">属性books </strong>。</p><p id="3d15" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">格式<strong class="kc io">选择</strong>由<strong class="kc io"> loadBooks </strong>()初始化，它以作者对象的<strong class="kc io"> books属性</strong>作为参数</p><pre class="lq lr ls lt gt mg mh mr bn ms mt bi"><span id="a994" class="mu mm in mh b be mv mw l mx mq">loadBooks(books: any) {<br/>return books.map((book: any) =&gt; new FormControl(false));<br/>}</span></pre><p id="ae0e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们只是将<strong class="kc io"> books属性</strong>数组中的每本书映射到一个FormControl，它的<strong class="kc io">初始值为false </strong>。这意味着所有的复选框最初都不会被选中。在<strong class="kc io"> books属性</strong>数组中，我们有一个对应于每本书的复选框。</p><p id="f2b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设您选中了几个复选框，那么表单的值将会更新如下。请观察<strong class="kc io">选择属性的变化，对于已检查的书籍，该属性的值已从true变为false。</strong></p><figure class="lq lr ls lt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/4ba34c4baef21a9714c02409ec07a539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1SIDvRASwq9aCQXSwG8hw.png"/></div></div></figure><p id="df96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查下面的整个工作:</p><div class="ky kz gp gr la lb"><a href="https://stackblitz.com/edit/angular-ivy-ktqkbv?file=src/app/app.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd io gy z fp lg fr fs lh fu fw im bi translated">角状常春藤(分叉)- StackBlitz</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">一个基于rxjs，tslib，zone.js，font-awesome，@angular/core，@angular/forms，@angular/common的angular-cli项目…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">stackblitz.com</p></div></div><div class="lk l"><div class="mz l lm ln lo lk lp jt lb"/></div></div></a></div><p id="0ea0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="na">更多内容看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="na">plain English . io</em></strong></a></p></div></div>    
</body>
</html>