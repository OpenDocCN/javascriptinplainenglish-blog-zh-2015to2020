<html>
<head>
<title>Node.js Best Practices — Security and Structure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js最佳实践—安全性和结构</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-best-practices-security-and-structure-936b4ad32af3?source=collection_archive---------5-----------------------#2020-08-05">https://javascript.plainenglish.io/node-js-best-practices-security-and-structure-936b4ad32af3?source=collection_archive---------5-----------------------#2020-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/41a00927f2afa29c8f49717367895680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7n4sG4EKkEwUnCcE"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@spktwo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">George Bonev</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0b15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="602d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如果我们正在编写一个Web应用程序，请使用<code class="fe lz ma mb mc b">Helmet</code></h1><p id="33ce" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">如果我们正在写一个网络应用程序，我们应该使用头盔。</p><p id="640f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有几项功能，包括:</p><ul class=""><li id="2ff9" class="mi mj iq kf b kg kh kk kl ko mk ks ml kw mm la mn mo mp mq bi translated">添加XSS保护</li><li id="6a44" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">用<code class="fe lz ma mb mc b">X-Frame-Options</code>防止点击劫持</li><li id="16ec" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">强制所有连接成为HTTPS</li><li id="2b27" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">设置<code class="fe lz ma mb mc b">Context-Security-Policy</code>标题</li><li id="3832" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">禁用<code class="fe lz ma mb mc b">X-Powered-By</code>响应头，这样攻击者就无法缩小我们用来编写应用程序的库的范围。</li></ul><p id="38ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">头盔将为所有这些选项设置合理的默认值。</p><p id="8379" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过运行以下命令来安装它:</p><pre class="mw mx my mz gt na mc nb nc aw nd bi"><span id="2ce5" class="ne lc iq mc b gy nf ng l nh ni">npm install helmet</span></pre><p id="45b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的Express应用程序中，我们可以通过编写以下内容来使用中间件:</p><pre class="mw mx my mz gt na mc nb nc aw nd bi"><span id="6196" class="ne lc iq mc b gy nf ng l nh ni">const helmet = require('helmet');<br/>app.use(helmet());</span></pre><h1 id="3e9b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">监控我们的应用</h1><p id="f00b" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">如果我们正在运行我们的应用程序，那么我们需要监控它。</p><p id="c6ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们的应用程序出现故障，并且没有快速的解决方案，用户会不高兴。</p><p id="4068" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们需要监控我们的应用程序并提醒每个人，以便我们可以快速恢复运行。</p><p id="ff22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，<a class="ae kc" href="https://keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> KeyMetrics.io </a>与PM2集成，以检查应用程序的健康状况。</p><p id="3487" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还提供了一个仪表板，向我们显示它何时启动或未启动。</p><p id="be85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以检查延迟和事件。</p><h1 id="ddca" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试我们的代码</h1><p id="5b1a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用自动化测试来测试我们的代码，这样当我们修改代码的时候就可以安心了。</p><p id="d65c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们自动快速运行，因此我们不必亲自检查应用程序的每个部分。</p><p id="43ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该在修复错误时添加测试，并定期运行我们的测试。</p><p id="a080" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有几种方法可以进行测试。</p><p id="63d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用摩卡、茶、Jest或Jasmine来运行它们。</p><p id="cfb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们都很受欢迎，并提供相同的功能。</p><p id="b573" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建发出请求的测试，我们可以使用Supertest来发出请求并检查结果。</p><h1 id="3ce7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">按组件构建解决方案</h1><p id="5800" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们应该通过组件来构建我们的项目。</p><p id="717d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们以后就能找到他们。</p><p id="61f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果一个项目没有结构，很容易迷失方向。</p><p id="d7d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该把代码分成模块。</p><h1 id="7223" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将我们的组件分层，并保持Express在其边界内</h1><p id="dec9" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们应该只对应用程序的控制器部分使用Express。</p><p id="fbf9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">业务逻辑应该在它们自己的模块中，以便更好地组织我们的应用程序。</p><p id="bcf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，每个模块和功能都做自己的事情。</p><p id="74b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将不同的部分混合在一起会使它们难以测试和维护。</p><h1 id="c9b0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将常用工具包装成NPM包</h1><p id="4ed5" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">如果我们有在多个项目中使用的公共事物，我们应该把它们放在它们自己的包中。</p><p id="c4ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">日志记录、加密等常见功能。应该在他们自己的包裹里。</p><p id="d9f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们只需更改一个包来更新功能。</p><h1 id="6bfa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将Express“应用程序”和“服务器”分开</h1><p id="4b0f" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们的Express应用程序不应该是一个大文件。</p><p id="0efb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">入口点应该与应用程序的其他部分分开。</p><p id="d3a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个大文件会让一切都变慢。</p><p id="5717" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">API应该在<code class="fe lz ma mb mc b">app.js</code>中，网络代码应该在<code class="fe lz ma mb mc b">www</code>中。</p><p id="f33e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果API声明很大，也可以将其拆分成组件。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/c7c9139c66aae9af7bd4a2bfa96fd4cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZENgfmkLt_RxAzLY"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lightupphotos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Cristina Anne Costello</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="4de2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="1989" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以更好地组织我们的应用程序。</p><p id="70ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以采取措施来提高安全性和监控我们的应用程序。</p><h2 id="24d4" class="ne lc iq bd ld nk nl dn lh nm nn dp ll ko no np lp ks nq nr lt kw ns nt lx nu bi translated">简单英语的JavaScript</h2><p id="a953" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>