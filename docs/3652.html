<html>
<head>
<title>Webpack 5 Builds for AWS Lambda Functions with TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Webpack 5使用TypeScript为AWS Lambda函数构建</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/webpack-5-builds-for-aws-lambda-functions-with-typescript-6603533c85cb?source=collection_archive---------4-----------------------#2020-10-15">https://javascript.plainenglish.io/webpack-5-builds-for-aws-lambda-functions-with-typescript-6603533c85cb?source=collection_archive---------4-----------------------#2020-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/1126458c36d680acc809305b3e1e7edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUlz3-MiGEkY9Sz4b8R6Vg.png"/></div></div></figure><div class=""/><p id="9e43" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在之前的一篇帖子中，我写了关于每天午夜作为AWS Lambda函数运行的<a class="ae kw" href="https://blog.dennisokeeffe.com/blog/2020-10-05-self-destructing-tweets/" rel="noopener ugc nofollow" target="_blank">自毁推文</a>。</p><p id="4b8e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然那篇文章是关于代码本身的，但大多数AWS CDK基础设施信息已经写在以前的一篇文章中，关于<a class="ae kw" href="https://blog.dennisokeeffe.com/blog/2020-06-22-cdk-lambda-to-send-slack-message/" rel="noopener ugc nofollow" target="_blank">发送无服务器Slack消息</a>，演示如何在cron计时器上运行AWS Lambda。</p><p id="fff9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天的帖子将是一个将这些联系在一起的简短概述:它展示了我如何将Twitter帖子中的TypeScript代码与节点模块捆绑在一起，并为部署做准备。</p><h2 id="239c" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">文件夹结构</h2><p id="ee61" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我在这里做假设。我通常为Lambdas设置的最“复杂”的设置是用TypeScript编写它们，并用Babel进行翻译。</p><p id="67c3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">鉴于这将是大多数人熟悉的立场，让我们一起工作。</p><p id="6244" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是我的大多数lambdas在函数文件夹中的外观:</p><p id="57b1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://gist.github.com/okeeffed/9b1e7edc86caff76179d434850f063c0.js" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/okeeffed/9 B1 e 7 EDC 86 caff 76179d 434850 f 063 c 0 . js</a></p><figure class="lv lw lx ly gt is"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="4bed" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能还注意到我有一个<code class="fe mb mc md me b">index.ts</code>和<code class="fe mb mc md me b">index.local.ts</code>文件。在我的项目中，<code class="fe mb mc md me b">index.ts</code>通常是lambda的入口点，这里的<code class="fe mb mc md me b">index.local.ts</code>文件通常只用于本地开发，在这里我将lambda处理程序换成让我运行的代码。</p><p id="2123" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">两者一般都从另一个文件(这里表示为<code class="fe mb mc md me b">function.ts</code>)导入主函数，然后调用它。</p><blockquote class="mf mg mh"><p id="4169" class="jy jz mi ka b kb kc kd ke kf kg kh ki mj kk kl km mk ko kp kq ml ks kt ku kv ij bi translated">Webpack稍后会将所有内容打包到一个文件中，所以我可以按照自己认为合适的方式构建文件夹。<br/>还要注意:正如Maximilian在评论中指出的，如果您的npm包需要二进制文件，那么将节点模块捆绑到Webpack的输出中并不总是一个好主意。这同样适用于任何需要在运行时动态导入的构建。使用您的判断是否将您的节点模块捆绑到Webpack构建中，但是我将写另一篇关于使用Lambda层的文章，以避开构建单个输出的需求。</p></blockquote><h2 id="757b" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">设置您自己的项目</h2><p id="4c97" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在包含TypeScript lambda的新npm项目中，我们需要添加所需的Babel和Webpack依赖项:</p><p id="f8a0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://gist.github.com/okeeffed/83313ff75f314653c67760251571320d.js" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/okeeffed/83313 ff 75 f 314653 c 67760251571320d . js</a></p><figure class="lv lw lx ly gt is"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h2 id="276e" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">Babel运行命令文件</h2><p id="b052" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在<code class="fe mb mc md me b">.babelrc</code>内部增加以下内容:</p><p id="0538" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://gist.github.com/okeeffed/6640da43291ded9bf3ea0fbc88105d0c.js" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/okeffed/6640 da 43291 DD 9 BF 3 ea 0 FBC 88105d 0 c . js</a></p><figure class="lv lw lx ly gt is"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h2 id="0f8d" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">设置TypeScript</h2><p id="467a" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">这一部分需要根据具体情况进行调整，但我为Twitter bot提供的配置如下:</p><p id="828f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://gist.github.com/okeeffed/2f2ce20124863b1b0b2ff1153158b01b.js" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/okeffed/2f2 ce 20124863 B1 b 0 B2 ff 1153158 b01b . js</a></p><figure class="lv lw lx ly gt is"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h2 id="f538" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">Webpack</h2><p id="6508" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在这个例子中，我期望您使用的是Webpack 5。</p><p id="44d0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mb mc md me b">webpack.config.js</code>中:</p><p id="c94b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://gist.github.com/okeeffed/d63721ddc9715a181a5129cf14d00955.js" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/okeffed/d 63721 DDC 9715 a 181 a 5129 cf 14d 00955 . js</a></p><figure class="lv lw lx ly gt is"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="0528" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们告诉Webpack将<code class="fe mb mc md me b">src/index.ts</code>设置为入口点并转换为<code class="fe mb mc md me b">commonjs</code>。</p><p id="fe09" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们设置了Babel和Cache加载程序来测试和编译从该入口点找到的任何<code class="fe mb mc md me b">ts</code>或<code class="fe mb mc md me b">js</code>文件。</p><p id="03b3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设我们没有使用避免绑定节点模块的Node Externals，那么所需的任何节点模块也将被编译到输出中。</p><p id="fa45" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着在<code class="fe mb mc md me b">dist/index.js</code>的输出，其中运行我们的项目没有节点模块安装，这是完美的AWS Lambda！</p><h2 id="620d" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">运行内部版本</h2><p id="3835" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">一个<code class="fe mb mc md me b">"build": "webpack"</code>到你的<code class="fe mb mc md me b">"scripts"</code>钥匙在<code class="fe mb mc md me b">package.json</code>文件里，你就可以滚了！</p><p id="0849" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe mb mc md me b">npm run build</code>，让Webpack发挥它的魔力，然后在<code class="fe mb mc md me b">dist/index.js</code>中看到单文件输出。</p><h2 id="692e" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">测试项目</h2><p id="b5d8" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在部署AWS CDK之前，我使用<a class="ae kw" href="https://github.com/ashiina/lambda-local" rel="noopener ugc nofollow" target="_blank"> lambda-local </a>来测试构建。它的目标是Nodejs，这是完美的类型脚本/JavaScript项目！</p><p id="ac94" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按照网站上的说明进行安装并试一试！如果一切顺利，您就可以对自己的部署充满信心。</p><h2 id="911b" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">结论</h2><p id="83d0" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">本文仅关注构建过程。正如介绍中所提到的，我的其他一些文章将涉及编写lambda函数和实际的AWS CDK部署。</p><h2 id="cbf6" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">资源和进一步阅读</h2><ol class=""><li id="5d2a" class="mm mn jb ka b kb lq kf lr kj mo kn mp kr mq kv mr ms mt mu bi translated"><a class="ae kw" href="https://blog.dennisokeeffe.com/blog/2020-10-05-self-destructing-tweets/" rel="noopener ugc nofollow" target="_blank">自毁微博</a></li><li id="663a" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated"><a class="ae kw" href="https://blog.dennisokeeffe.com/blog/2020-06-22-cdk-lambda-to-send-slack-message/" rel="noopener ugc nofollow" target="_blank">发送无服务器空闲消息</a></li><li id="6c1f" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated"><a class="ae kw" href="https://github.com/ashiina/lambda-local" rel="noopener ugc nofollow" target="_blank">λ-local</a></li></ol><p id="7549" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mi">图片来源:</em> <a class="ae kw" href="https://unsplash.com/@jessbaileydesigns" rel="noopener ugc nofollow" target="_blank"> <em class="mi">杰斯贝利</em> </a></p><p id="fc94" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mi">原贴于我的</em> <a class="ae kw" href="https://blog.dennisokeeffe.com/blog/2020-10-15-webpack-for-lambdas/" rel="noopener ugc nofollow" target="_blank"> <em class="mi">博客</em> </a> <em class="mi">。</em></p></div></div>    
</body>
</html>