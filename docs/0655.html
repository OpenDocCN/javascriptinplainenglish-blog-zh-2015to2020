<html>
<head>
<title>React Native — Native Modules Callbacks in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应本地Swift中的本地模块回调</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-native-modules-callbacks-in-swift-db627876e20f?source=collection_archive---------3-----------------------#2019-11-22">https://javascript.plainenglish.io/react-native-native-modules-callbacks-in-swift-db627876e20f?source=collection_archive---------3-----------------------#2019-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0c9b607c5e4b3d6b212fc9706f9ac4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MM8LYY1XVd4vjIXllJAq0Q.jpeg"/></div></div></figure><h1 id="ca3d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="253f" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">回调是在运行本机函数后将数据发送回React Native的一种很好的方式。但这并不是使用它们的唯一原因。在我的例子中，我将扩展我之前关于本机模块的教程，我们将创建一个函数，通过使用React Native <strong class="ky ir">回调</strong>返回一个布尔值，无论音频文件是否正在播放。</p><p id="729e" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在前面的教程中，组件一安装，音乐就开始播放。现在，我们将创建一个按钮，当按下时调用回调。onPress函数将调用一个Swift函数，返回播放器是否正在播放音频文件！</p><h1 id="cd00" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建按钮</h1><p id="03aa" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">打开示例文件夹中的<strong class="ky ir"> App.js </strong>文件。</p><p id="b577" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在我们的渲染函数中，我们将创建一个按钮，当按下它时，将调用一个名为isPlaying的本地函数。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="49f4" class="mj jz iq mf b gy mk ml l mm mn">render() {<br/>   return (<br/>      &lt;View style={styles.container}&gt;<br/>         &lt;Text style={styles.welcome}&gt;☆AudioHelper example☆&lt;/Text&gt;                     </span><span id="a724" class="mj jz iq mf b gy mo ml l mm mn">         &lt;TouchableOpacity<br/>            onPress={() =&gt; AudioHelper.isPlaying((error, data) =&gt; {<br/>               if (error) { <br/>                  console.log(error);<br/>               } else {<br/>                  console.log(data);<br/>               }<br/>           })}<br/>         &gt;</span><span id="cb42" class="mj jz iq mf b gy mo ml l mm mn">            &lt;Text style={{backgroundColor: "#DDD", padding: 5}}&gt;<br/>                 Is song playing?<br/>            &lt;/Text&gt;<br/>         &lt;/TouchableOpacity&gt;<br/>      &lt;/View&gt;);<br/>}</span></pre><p id="a205" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">不要忘记导入顶部的<strong class="ky ir"> TouchableOpacity </strong>，如果文件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9079" class="mj jz iq mf b gy mk ml l mm mn">import React, { Component } from 'react';<br/>import { StyleSheet, Text, View, <strong class="mf ir">TouchableOpacity</strong> } from 'react-native';<br/>import AudioHelper from 'react-native-audio-helper';</span></pre><p id="5aa0" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">现在让我们转到原生iOS和swift部分。使用XCode打开示例项目。iOS目录下有一个项目文件。</p><p id="f0c1" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">我们将编辑两个文件。AudioHelper.m和AudioHelper.swift .所以，我们要做的第一件事就是在React Native和swift之间建立桥梁。打开<strong class="ky ir"> AudioHelper.m </strong>文件。</p><p id="11ca" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在<strong class="ky ir">playSound RCT _外部_方法</strong> : <code class="fe mp mq mr mf b">RCT_EXTERN_METHOD(isPlaying(RCTResponseSenderBlock)callback)</code>下面添加这一行</p><p id="4b7d" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">现在我们能够创建我们的swift函数来检查我们的音频文件是否正在播放。</p><p id="b7fd" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在<strong class="ky ir"> AudioHelper.swift </strong>文件中，我们将创建与上面的<strong class="ky ir">RCT _外部_方法</strong>的定义相匹配的函数。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="91d9" class="mj jz iq mf b gy mk ml l mm mn"><strong class="mf ir">@objc(isPlaying:)<br/>func</strong> isPlaying(<strong class="mf ir">_</strong> callback: RCTResponseSenderBlock) {<br/>   <strong class="mf ir">if</strong> (player != <strong class="mf ir">nil</strong>) {<br/>      callback([player!.isPlaying])<br/>   }<br/>}</span></pre><p id="9d09" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">这个函数首先检查音频播放器是否存在:</p><p id="5060" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><code class="fe mp mq mr mf b">if player != nil</code></p><p id="6467" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">如果有播放器，调用React本机回调函数，返回一个包含布尔isPlaying的数组。</p><p id="f3d2" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated"><code class="fe mp mq mr mf b">callback([player!.isplaying])</code></p><p id="81d4" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">我从苹果文档<a class="ae lu" href="https://developer.apple.com/documentation/avfoundation/avaudioplayer" rel="noopener ugc nofollow" target="_blank">这里</a>得到了可用函数和属性的列表。这是我在回调函数<a class="ae lu" href="https://developer.apple.com/documentation/avfoundation/avaudioplayer/1390139-isplaying" rel="noopener ugc nofollow" target="_blank">这里</a>中返回的属性。</p><h1 id="23c5" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">复试</h1><p id="051e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">React本机桥被认为是异步的，只有两种方式将结果传递回React本机项目。</p><ul class=""><li id="0279" class="ms mt iq ky b kz lv ld lw lh mu ll mv lp mw lt mx my mz na bi translated">复试</li><li id="29f4" class="ms mt iq ky b kz nb ld nc lh nd ll ne lp nf lt mx my mz na bi translated">事件发射器</li></ul><p id="4d4f" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">回调是两者中比较容易的。它允许您的React本机应用程序运行本机iOS / Android功能，并期望返回某种数据。</p><h2 id="2e85" class="mj jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">包扎</h2><p id="8c9e" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这只是一个让你开始使用React本机回调的简单例子。如果你还没有看完第一个教程，我建议你从第一个<a class="ae lu" href="https://medium.com/javascript-in-plain-english/react-native-native-modules-with-swift-6768ea03b3f" rel="noopener">开始。它将为您创建一个React本机模块打下更多的基础。</a></p></div></div>    
</body>
</html>