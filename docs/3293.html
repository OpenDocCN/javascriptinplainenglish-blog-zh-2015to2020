<html>
<head>
<title>DIY Multilanguage In JavaScript Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript项目中的DIY多语言</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/diy-multilanguage-in-javascript-project-65f8aa91a506?source=collection_archive---------5-----------------------#2020-09-16">https://javascript.plainenglish.io/diy-multilanguage-in-javascript-project-65f8aa91a506?source=collection_archive---------5-----------------------#2020-09-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="09b7" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">java描述语言</h2><div class=""/><div class=""><h2 id="f453" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">让我们用这个简单的方法来国际化我们的webapp</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/60d75768882e9585ec09177ca3f0a6c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6noY84syC5PVLAWo"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@belart84?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artem Beliaikin</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ccf5" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">当我们开发一个想要在全球范围内发布的webapp时，我们必须考虑到很多人不会说我们的语言。如果他们不理解我们，我们可能会失去一大块用户。</p><p id="afb9" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在我从事JavaScript项目的经验中，我尽可能以最简单的方式改进了管理多种语言的过程，在这种方式下，我可以在更短的时间内添加新的语言或编辑现有的字符串，并且错误更少。</p><h1 id="9dbb" class="ly lz in bd ma mb mc md me mf mg mh mi kc mj kd mk kf ml kg mm ki mn kj mo mp bi translated">如何管理不同的语言</h1><p id="cfb5" class="pw-post-body-paragraph lc ld in le b lf mq jx lh li mr ka lk ll ms ln lo lp mt lr ls lt mu lv lw lx ig bi translated">在本教程中，我们将学习如何创建一个插件，带来一个语言文件，解析它，并返回所需的字符串在用户的语言。</p><p id="1b30" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">语言文件(在我们的例子中称为<em class="mv"> strings.js </em>)是一个默认导出的JavaScript对象。该对象可能具有与具有相同结构的其他对象相同的属性。这是我们<em class="mv"> strings.js </em>的一个例子:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="14e9" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">import </strong>months <strong class="mx ix">from </strong>"./months";</span><span id="16bc" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">export default</strong> {<br/>  <strong class="mx ix">account</strong>: {<br/>    en: "Account",<br/>    es: "Usuario",<br/>    it: "Utente"<br/>  },<br/>  <strong class="mx ix">appName</strong>: "My Project",<br/>  <strong class="mx ix">cancel</strong>: {<br/>    en: "Cancel",<br/>    es: "Cancelar",<br/>    it: "Annulla"<br/>  },<br/>  <strong class="mx ix">months</strong><br/>};</span></pre><p id="a25f" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">而这就是导入文件<em class="mv"> months.js </em>的内容:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="b391" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">export default</strong> {<br/>  <strong class="mx ix">january</strong>: {<br/>    en: "January",<br/>    es: "Enero",<br/>    it: "Gennaio"<br/>  },<br/>  <strong class="mx ix">february</strong>: {<br/>    en: "February",<br/>    es: "Febrero",<br/>    it: "Febbraio"<br/>  },<br/>  <strong class="mx ix">march</strong>: {<br/>    en: "March",<br/>    es: "Marzo",<br/>    it: "Marzo"<br/>  },<br/>  <strong class="mx ix">april</strong>: {<br/>    en: "April",<br/>    es: "Abril",<br/>    it: "Aprile"<br/>  },<br/>  <strong class="mx ix">may</strong>: {<br/>    en: "May",<br/>    es: "Mayo",<br/>    it: "Maggio"<br/>  },<br/>  <strong class="mx ix">june</strong>: {<br/>    en: "June",<br/>    es: "Junio",<br/>    it: "Giugno"<br/>  },<br/>  <strong class="mx ix">july</strong>: {<br/>    en: "July",<br/>    es: "Julio",<br/>    it: "Luglio"<br/>  },<br/>  <strong class="mx ix">august</strong>: {<br/>    en: "August",<br/>    es: "Agosto",<br/>    it: "Agosto"<br/>  },<br/>  <strong class="mx ix">september</strong>: {<br/>    en: "September",<br/>    es: "Septiembre",<br/>    it: "Settembre"<br/>  },<br/>  <strong class="mx ix">october</strong>: {<br/>    en: "October",<br/>    es: "Octubre",<br/>    it: "Ottobre"<br/>  },<br/>  <strong class="mx ix">november</strong>: {<br/>    en: "November",<br/>    es: "Noviembre",<br/>    it: "Novembre"<br/>  },<br/>  <strong class="mx ix">december</strong>: {<br/>    en: "December",<br/>    es: "Diciembre",<br/>    it: "Dicembre"<br/>  }<br/>};</span></pre><h1 id="beca" class="ly lz in bd ma mb mc md me mf mg mh mi kc mj kd mk kf ml kg mm ki mn kj mo mp bi translated">lang插件</h1><p id="cfe4" class="pw-post-body-paragraph lc ld in le b lf mq jx lh li mr ka lk ll ms ln lo lp mt lr ls lt mu lv lw lx ig bi translated">因此，为了将我们的字符串以所选语言交付给用户，我们必须在一个新文件<em class="mv"> lang.js </em>中创建一个函数，我们称之为<em class="mv"> getStrings </em>。该函数将解析之前声明的<em class="mv"> strings.js </em>对象，并返回一个只包含所选语言字符串的对象。例如，如果我选择“it”(意大利语)，返回的对象将是:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="dac8" class="nb lz in mx b gy nc nd l ne nf">{<br/>  <strong class="mx ix">account</strong>: "Utente"<br/>  <strong class="mx ix">appName</strong>: "My Project",<br/>  <strong class="mx ix">cancel</strong>: "Annulla"<br/>  <strong class="mx ix">months</strong>: {<br/>    <strong class="mx ix">january</strong>: "Gennaio",<br/>    <strong class="mx ix">february</strong>: "Febbraio",<br/>    <strong class="mx ix">march</strong>: "Marzo",<br/>    <strong class="mx ix">april</strong>: "Aprile",<br/>    <strong class="mx ix">may</strong>: "Maggio",<br/>    <strong class="mx ix">june</strong>: "Giugno",<br/>    <strong class="mx ix">july</strong>: "Luglio",<br/>    <strong class="mx ix">august</strong>: "Agosto",<br/>    <strong class="mx ix">september</strong>: "Settembre"<br/>    <strong class="mx ix">october</strong>: "Ottobre",<br/>    <strong class="mx ix">november</strong>: "Novembre",<br/>    <strong class="mx ix">december</strong>: "Dicembre"<br/>  }<br/>}</span></pre><p id="943f" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这是<em class="mv"> getStrings </em>函数，它需要语言对象和所选语言作为输入参数:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="8540" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">const </strong>getStrings = (<em class="mv">string</em>, <em class="mv">lang</em>) =&gt; {<br/>  <strong class="mx ix">let </strong>res = {};</span><span id="efaa" class="nb lz in mx b gy ng nd l ne nf">  <strong class="mx ix">Object</strong>.entries(string).forEach(([<em class="mv">key</em>, <em class="mv">value</em>]) =&gt;<br/>    res[<em class="mv">key</em>] = !value[<em class="mv">lang</em>] &amp;&amp; <strong class="mx ix">typeof </strong>value === <strong class="mx ix">"object"</strong><br/>      ? getStrings(value, lang)<br/>      : value[<em class="mv">lang</em>] || value<br/>  );</span><span id="be3b" class="nb lz in mx b gy ng nd l ne nf">  <strong class="mx ix">return </strong>res;<br/>};</span></pre><p id="a7c2" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们遍历对象属性，如果值是一个字符串或包含所选语言作为属性的对象，我们就返回它。</p><p id="58c1" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">否则，我们调用<em class="mv"> getStrings </em>函数(递归地)将值作为输入传递，当然也是所选的语言。</p><h1 id="1db1" class="ly lz in bd ma mb mc md me mf mg mh mi kc mj kd mk kf ml kg mm ki mn kj mo mp bi translated">检索当前用户语言并在项目中使用</h1><p id="4e4c" class="pw-post-body-paragraph lc ld in le b lf mq jx lh li mr ka lk ll ms ln lo lp mt lr ls lt mu lv lw lx ig bi translated">大多数时候，用户不会手动选择他们的语言，因为我们可以从浏览器设置中获得。为此，我们将下面几行添加到<em class="mv"> lang.js </em>中:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="8806" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">const </strong>langs = [<br/>  "en",<br/>  "es",<br/>  "it"<br/>];</span><span id="7d7e" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">let </strong>curLang = <strong class="mx ix">navigator.language</strong>.split(<strong class="mx ix">"-"</strong>)[0];<br/>!langs.includes(curLang) &amp;&amp; (curLang = <strong class="mx ix">"en"</strong>);</span></pre><p id="5092" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">使用<em class="mv">navigator . language</em>native API，我们可以获得主要用户语言，如果没有找到，我们默认为“en”。可用的语言在ISO 639–1标准中定义。</p><p id="682f" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">然后，在文件的结尾，我们导出返回的对象:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="8fcd" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">import </strong>strings <strong class="mx ix">from </strong>"./strings";</span><span id="4af0" class="nb lz in mx b gy ng nd l ne nf">// previous code</span><span id="f393" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">export default</strong> getStrings(strings, curLang);</span></pre><p id="0d88" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在，您已经准备好在您的项目中使用它了:只需导入<em class="mv"> lang.js </em>文件，并以如下方式选择字符串:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="5a39" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">import </strong>_s <strong class="mx ix">from </strong>"./lang";</span><span id="8aa3" class="nb lz in mx b gy ng nd l ne nf">document.write(_s.cancel); // prints Annulla<br/>document.write(_s.month.september); // prints Settembre</span></pre><p id="e1af" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><em class="mv"> lang.js </em>的完整代码:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="9442" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">import </strong>strings <strong class="mx ix">from </strong>"./strings";</span><span id="db8d" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">const </strong>langs = [<br/>  "en",<br/>  "es",<br/>  "it"<br/>];</span><span id="d94e" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">let </strong>curLang = <strong class="mx ix">navigator.language</strong>.split(<strong class="mx ix">"-"</strong>)[0];<br/>!langs.includes(curLang) &amp;&amp; (curLang = <strong class="mx ix">"en"</strong>);</span><span id="3941" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">const </strong>getStrings = (<em class="mv">string</em>, <em class="mv">lang</em>) =&gt; {<br/>  <strong class="mx ix">let </strong>res = {};</span><span id="5768" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">  Object</strong>.entries(string).forEach(([<em class="mv">key</em>, <em class="mv">value</em>]) =&gt;<br/>    res[<em class="mv">key</em>] = !value[<em class="mv">lang</em>] &amp;&amp; <strong class="mx ix">typeof </strong>value === <strong class="mx ix">"object"</strong><br/>      ? getStrings(value, lang)<br/>      : value[<em class="mv">lang</em>] || value<br/>  );</span><span id="8dfc" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">  return </strong>res;<br/>};</span><span id="9ff3" class="nb lz in mx b gy ng nd l ne nf"><strong class="mx ix">export default</strong> getStrings(strings, curLang);</span></pre><h1 id="20a7" class="ly lz in bd ma mb mc md me mf mg mh mi kc mj kd mk kf ml kg mm ki mn kj mo mp bi translated">提示:向字符串添加变量</h1><p id="ee42" class="pw-post-body-paragraph lc ld in le b lf mq jx lh li mr ka lk ll ms ln lo lp mt lr ls lt mu lv lw lx ig bi translated">如果我们想在字符串中添加变量，我们可以创建一个新函数并导出它。例如，我们称之为<em class="mv">格式字符串</em>:</p><pre class="km kn ko kp gt mw mx my mz aw na bi"><span id="5d4b" class="nb lz in mx b gy nc nd l ne nf"><strong class="mx ix">export const</strong> formatString = (<em class="mv">s</em>, <em class="mv">variables</em>) =&gt; {<br/>  <strong class="mx ix">const </strong>regex = new RegExp(<br/>    '{(' + Object.keys(variables).join('|') + ')}',<br/>    'g'<br/>  );</span><span id="ef56" class="nb lz in mx b gy ng nd l ne nf">  <strong class="mx ix">return </strong>s.replace(<em class="mv">regex</em>, (<em class="mv">m</em>, <em class="mv">i</em>) =&gt; variables[i] || m);<br/>};</span></pre><p id="4193" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">要使用它，我们必须执行以下步骤:</p><ol class=""><li id="de18" class="nh ni in le b lf lg li lj ll nj lp nk lt nl lx nm nn no np bi translated">将字符串添加到<em class="mv"> strings.js </em>中；例如<code class="fe nq nr ns mx b">greetings: "Hi, {username}"</code></li><li id="3cee" class="nh ni in le b lf nt li nu ll nv lp nw lt nx lx nm nn no np bi translated">导入<em class="mv"> formatString </em>函数，使用方法如下:<code class="fe nq nr ns mx b">formatString(_s.greetings, {username: "Andrea"})</code></li></ol><h1 id="eedc" class="ly lz in bd ma mb mc md me mf mg mh mi kc mj kd mk kf ml kg mm ki mn kj mo mp bi translated">结论</h1><p id="5b8a" class="pw-post-body-paragraph lc ld in le b lf mq jx lh li mr ka lk ll ms ln lo lp mt lr ls lt mu lv lw lx ig bi translated">如果你对这篇文章有任何问题，或者你想提出修改建议，欢迎写评论或者直接联系我。</p><p id="4d45" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">一如既往，我为我的英语道歉，但这不是我的母语。</p><p id="167e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">谢谢大家，关注我更多文章！</p></div><div class="ab cl ny nz hr oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ig ih ii ij ik"><p id="a9b1" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix">以下是我的一些其他文章:</strong></p><div class="of og gp gr oh oi"><a href="https://medium.com/javascript-in-plain-english/how-to-create-a-router-in-svelte-ce66c10275fe" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ix gy z fp on fr fs oo fu fw iw bi translated">如何创建一个苗条的路由器</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">我们可以避免不必要的包装</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kv oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://medium.com/javascript-in-plain-english/create-reusable-svelte-components-for-your-page-layouts-9593b1a60b08" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ix gy z fp on fr fs oo fu fw iw bi translated">为你的页面布局创建可重用的苗条组件</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">了解如何构建一个可以跨页面使用的组件</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kv oi"/></div></div></a></div></div><div class="ab cl ny nz hr oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ig ih ii ij ik"><h2 id="fcb0" class="nb lz in bd ma oy oz dn me pa pb dp mi ll pc pd mk lp pe pf mm lt pg ph mo it bi translated">简单英语的JavaScript</h2><p id="9a7d" class="pw-post-body-paragraph lc ld in le b lf mq jx lh li mr ka lk ll ms ln lo lp mt lr ls lt mu lv lw lx ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae lb" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="le ix">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="le ix">！</strong></p></div></div>    
</body>
</html>