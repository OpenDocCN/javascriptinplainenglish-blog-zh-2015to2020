<html>
<head>
<title>Introduction to Nuxt Socket.IO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nuxt套接字简介。超正析象管(Image Orthicon)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-nuxt-socket-io-b78c5322d389?source=collection_archive---------1-----------------------#2019-10-22">https://javascript.plainenglish.io/introduction-to-nuxt-socket-io-b78c5322d389?source=collection_archive---------1-----------------------#2019-10-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4883" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TL；DR — <a class="ae ki" href="https://npmjs.com/package/nuxt-socket-io" rel="noopener ugc nofollow" target="_blank"> nuxt-socket-io </a>是<a class="ae ki" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt </a>框架的一个模块，允许您轻松配置io:即配置您的套接字。IO客户端一次，然后使用它们。它与<a class="ae ki" href="https://vuex.vuejs.org" rel="noopener ugc nofollow" target="_blank"> Vuex </a>配合得很好，因此您可以将传入的数据直接流式传输到您的应用程序状态。本文解释了如何使用它。</p><p id="5c58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">免责声明:我是nuxt-socket-io模块的作者。</p></div><div class="ab cl kj kk hr kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ig ih ii ij ik"><p id="9648" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">先决条件:(按顺序列出)</p><ol class=""><li id="4df6" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh kv kw kx ky bi translated"><a class="ae ki" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> VueJS </a>:渐进式JS框架。对于不耐烦的人:专注于组件和计算属性。忽略安装指南，因为安装Nuxt(下一个项目符号)将安装VueJS。</li><li id="2fe4" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh kv kw kx ky bi translated"><a class="ae ki" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt </a>:渐进式<strong class="jm io"> VueJS </strong>框架，便于组织和维护您的VueJS应用程序。不耐烦者:用<code class="fe le lf lg lh b">npm i -g npx</code>安装npx。然后用<code class="fe le lf lg lh b">npx create-nuxt-app</code>创建您的Nuxt应用程序，并按照提示进行操作。阅读<a class="ae ki" href="https://nuxtjs.org/guide/modules" rel="noopener ugc nofollow" target="_blank">模块指南</a>可能会有所帮助，但不是完全必需的。</li><li id="03b1" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh kv kw kx ky bi translated"><a class="ae ki" href="https://socket.io/" rel="noopener ugc nofollow" target="_blank">插座。IO </a>:网络实时IO引擎</li></ol><p id="c803" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">推荐读数:</p><ul class=""><li id="209c" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh li kw kx ky bi translated"><a class="ae ki" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vuex </a>:【全球】应用程序状态管理。如需了解核心概念，请访问此处。不过，出于实际目的，最好了解Nuxt如何与Vuex交互，以帮助简化开发。也就是说，如果使用Nuxt，请以“Nuxt方式”配置您的商店(参见下一个项目符号)。</li><li id="7dcc" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated"><a class="ae ki" href="https://nuxtjs.org/guide/vuex-store" rel="noopener ugc nofollow" target="_blank"> Nuxt Vuex Configuration </a>:商店在“商店”文件夹中管理。一旦你掌握了窍门，就很简单了。</li><li id="6c5c" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated">“<a class="ae ki" href="https://medium.com/@richard.e.schloss/rethinking-web-io-c7efbde0657e?sk=7f24b427802782acd933fc4a05093a58" rel="noopener">重新思考Web IO </a>”:解释本模块开发背后的动机</li></ul></div><div class="ab cl kj kk hr kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ig ih ii ij ik"><p id="a82b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从很高的层面来看，<code class="fe le lf lg lh b">nuxt-socket-io</code>是一个Nuxt模块，它包装了流行的<code class="fe le lf lg lh b">socket.io-client</code>。虽然想要直接使用该客户端可能很诱人，但您可能会发现自己必须在多个位置设置配置并重复执行其他常见任务。如果可能的话，开发人员希望努力提高效率和可维护性:代码更少，重复更少，完成更多更快。<code class="fe le lf lg lh b">nuxt-socket-io</code>模块允许您配置<code class="fe le lf lg lh b">nuxt.config.js</code>文件中的几乎所有内容，但仍然为您提供了<code class="fe le lf lg lh b">socket.io-client</code>实例，因此您可能已经熟悉的所有API方法都可以使用。对你来说更容易，对我来说维护插件也更容易。</p><p id="d752" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用该模块的<strong class="jm io">优点</strong>是:</p><ol class=""><li id="213c" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh kv kw kx ky bi translated">直接在nuxt.config.js文件中用有意义的名称配置多个IO套接字。轻松地指定一个默认值，否则列表中的第一个套接字将是默认值。在设计组件时，您可能有兴趣看看数据注入组件后的样子。有多种选择，但是一个简单的选择可能是配置一个“测试”套接字，将虚拟数据注入到组件中。当注入的数据量很大时，这可能特别有用。</li><li id="3ab6" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh kv kw kx ky bi translated">直接在<code class="fe le lf lg lh b">nuxt.config.js</code>中配置Vuex选项。</li></ol><ul class=""><li id="69f5" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh li kw kx ky bi translated">当您的应用程序收到某些事件时，您可能希望简单地触发Vuex突变或动作。即，当数据进入时，它被写入应用程序状态。当元件需要这些数据时，只需从Vuex存储器中读取即可。</li><li id="08a8" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated">当Vuex状态改变时，您可能希望某些状态属性的改变触发通知<em class="lj">返回</em>给IO服务器。毕竟，谁说反应必须局限于浏览器？</li><li id="c603" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated">它与您已经在存储文件夹中配置的内容配合良好。</li></ul><p id="53a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">安装</strong>:(简单)</p><pre class="lk ll lm ln gt lo lh lp lq aw lr bi"><span id="d982" class="ls lt in lh b gy lu lv l lw lx">npm i -S nuxt-socket-io</span></pre><p id="1316" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">注册模块</strong>:</p><p id="3bd7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe le lf lg lh b">nuxt.config.js</code>中，只需将其添加到模块列表中:</p><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/182a800a69d9cef41bbc4dce81d9b5f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*9KeUbvUM-5iF1MrvhHgCvg.jpeg"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Module Registration</figcaption></figure><p id="f134" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦注册，<code class="fe le lf lg lh b">$nuxtSocket</code>将被注入到<code class="fe le lf lg lh b">context</code>中，这样你就可以轻松地在你的应用中使用它。但是，为了使用它，您还必须配置模块选项:</p><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/1380589e1b0f43e4f1891b03af90361a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6LiUdwtWDdTJXJArdF4-Q.jpeg"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Module Options</figcaption></figure><p id="1cff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">配置</strong></p><p id="777a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是每个插座所需的<em class="lj">和</em>:</p><ul class=""><li id="1c00" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh li kw kx ky bi translated"><strong class="jm io"> url </strong>:客户端需要一个可以连接的IO服务器</li></ul><p id="6bd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下是<em class="lj">推荐的</em>:</p><ul class=""><li id="5048" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh li kw kx ky bi translated"><strong class="jm io">默认</strong>:指定默认插座。如果您不小心为多个套接字设置了此布尔值，将使用第一个找到的默认值。</li><li id="4018" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated"><strong class="jm io">名称</strong>:将用于查找所请求的套接字的名称。如果未提供名称，则默认设置为“true”的套接字。如果既没有设置名称也没有设置默认值，将使用第一个套接字。</li><li id="1ea6" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated"><strong class="jm io">vuex</strong>:IO事件到vuex突变/动作/发射回的映射。</li></ul><p id="bdc0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于上述示例，将会发生以下情况:</p><ul class=""><li id="6ef7" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh li kw kx ky bi translated"><strong class="jm io">突变:</strong>IO客户端收到事件“progress”时，会触发Vuex“examples/SET _ PROGRESS”突变，并将事件的数据传递给突变。(相反，如果选项只是字符串“examples/SET_PROGRESS”，那么当接收到<em class="lj">事件时，就会触发变异)</em></li><li id="3978" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated"><strong class="jm io">动作:</strong>当IO客户端接收到事件“聊天消息”时，它将触发Vuex动作“‘格式_消息’”。同样，如果只指定了字符串“FORMAT_MESSAGE ”,那么它将被视为事件名称和Vuex动作。</li><li id="97de" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh li kw kx ky bi translated"><strong class="jm io"> emitBacks: </strong>当Vuex属性“examples/sample”改变时，它将发出<em class="lj"> back </em>带有该属性数据的“examples/sample”事件。当Vuex属性“examples/sample2”发生变化时，它会将<em class="lj">映射的</em>事件与该属性的数据一起发送回IO服务器。<code class="fe le lf lg lh b">nuxt-socket-io</code>模块提供了一个实用程序来帮助映射这个状态数据，这样您的组件就可以很容易地使用它。见下文。</li></ul><p id="b911" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个例子中，商店被配置为“store”文件夹中的“Nuxt way”。所以，<code class="fe le lf lg lh b">store/index.js</code>包含“根商店”，而<code class="fe le lf lg lh b">store/examples.js</code>包含“示例商店”。</p><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ml"><img src="../Images/14fbc04d742ffde89759ef0eccaa758d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Tawof12V9uGFFoMj0eAUw.jpeg"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Root store configuration: When FORMAT_MESSAGE action is dispatched, it’s handled here</figcaption></figure><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/9759d4e0e5d341ee8e5b3b33ff7716b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*ohv4g586789_ySpaCW8GQQ.jpeg"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">“Examples” store config. When state mutations are committed, it’s handled here.</figcaption></figure><p id="86d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">用法</strong></p><p id="2fa8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">好了，所有无聊的工作都完成了！但是模块的想法是你只需要做一次；维护应该很简单。现在，在您的Vue组件中使用该模块变得轻而易举。以下是一些例子:</p><ol class=""><li id="6f5a" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh kv kw kx ky bi translated">第<code class="fe le lf lg lh b">index.vue</code>页:</li></ol><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/26ccb06b1b218b9ffeb2d595b13a7ecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*YX9lJn2qUdqnrEueDm7JmA.jpeg"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Index Page</figcaption></figure><p id="0201" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">索引页面使用<code class="fe le lf lg lh b">mapState</code>助手将<code class="fe le lf lg lh b">this.chatMessages</code>绑定到存储在Vuex中的<code class="fe le lf lg lh b">chatMessages</code>。为了在商店中更新<code class="fe le lf lg lh b">chatMessages</code>，我们需要实例化一个套接字。IO客户端。我们在<code class="fe le lf lg lh b">mounted()</code>生命周期挂钩中这样做。注意，我没有指定使用什么名称。通过省略，将使用默认插座，该插座设置了<code class="fe le lf lg lh b">vuex</code>选项。我也可以在<code class="fe le lf lg lh b">$nuxtSocket</code>中指定<code class="fe le lf lg lh b">name: home</code>来获得相同的实例。<code class="fe le lf lg lh b">$nuxtSocket</code>函数也接受一个通道作为选项，所有其他选项将作为<a class="ae ki" href="https://socket.io/docs/client-api/#new-Manager-url-options" rel="noopener ugc nofollow" target="_blank">连接选项</a>传递给底层<code class="fe le lf lg lh b">socket.io-client</code>。所以，<code class="fe le lf lg lh b">reconnection: false</code>才会荣幸。</p><p id="2cb7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">虽然Vuex的便利性可能很好，但您可能并不总是希望您的数据存在于全球范围内；您只希望它在您的组件范围内。在这种情况下，<code class="fe le lf lg lh b">$nuxtSocket</code>实例是一个<code class="fe le lf lg lh b">socket.io-client</code>，所以您可以像预期的那样直接使用它:使用<code class="fe le lf lg lh b">.emit</code>方法并在回调中接收数据。这正是在<code class="fe le lf lg lh b">getMessage()</code>方法中正在做的事情。</p><p id="786b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.第<code class="fe le lf lg lh b">examples.vue</code>页:</p><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/4bb512c604852ad74e9dd473da7c63b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*Z16ZCwuKzNods0WuyvOKgQ.jpeg"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Example of examples.vue page</figcaption></figure><p id="f62f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回想一下vuex选项，除了突变之外，我们还指定了“发射回”。因为vuex的<code class="fe le lf lg lh b">mapState</code>是“缺省的getter”，如果想要双向绑定，必须提供一个setter。有两种方法可以完成同样的事情。</p><ol class=""><li id="035a" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh kv kw kx ky bi translated">该模块提供了一个“mapState2Way”实用程序，可以从<code class="fe le lf lg lh b">nuxt-socket-io/utils/common</code>或<code class="fe le lf lg lh b">nuxt-socket-io/utils/esm</code>导入。前者是“CommonJS”格式，另一个是“ESM”格式。为了在计算属性“sample”之间建立双向绑定，<code class="fe le lf lg lh b">mapState2Way</code>方法需要将Vuex属性映射到执行更新的变异。所以在这里，当Vuex的“examples/sample”属性改变时，我们希望提交“examples/SET_SAMPLE”变异。</li><li id="c5b2" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh kv kw kx ky bi translated">这是一种更加手动的方法，但是给出了实用程序正在做什么的想法。当我们想要将组件的sample2属性绑定到Vuex sample2属性时，getter会直接返回它。当我们想要更新属性时，我们提交“examples/SET_SAMPLE2”变异。</li></ol><p id="1243" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">边做边学</strong></p><ol class=""><li id="ae98" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh kv kw kx ky bi translated">克隆git回购:<a class="ae ki" href="https://github.com/richardeschloss/nuxt-socket-io" rel="noopener ugc nofollow" target="_blank">https://github.com/richardeschloss/nuxt-socket-io</a></li><li id="8aeb" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh kv kw kx ky bi translated">运行开发服务器:<code class="fe le lf lg lh b">npm run dev</code></li><li id="e87a" class="kq kr in jm b jn kz jr la jv lb jz lc kd ld kh kv kw kx ky bi translated">在<a class="ae ki" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">玩app http://localhost:3000</a></li></ol><p id="fa67" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">抓错了？自从这篇文章发表以来，事情已经并将会发生变化。最有可能的是，Git repo拥有最新的入门信息，而更全面的文档可以在这里找到:<a class="ae ki" href="https://nuxt-socket-io.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://nuxt-socket-io . net lify . app</a>。</p><p id="2218" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">结论</strong></p><p id="5e6a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如上所述，Nuxt-socket-io模块允许socket.io-client轻松集成和配置到您的Nuxt应用程序中。它使IO事件很容易直接映射到应用程序状态，但也公开了套接字。IO客户端API，如果你想使用它。希望这篇文章和实际的模块能够有所帮助。</p><p id="929d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下一篇:<a class="ae ki" href="https://medium.com/javascript-in-plain-english/nuxt-socket-io-how-namespaces-config-may-make-your-life-insanely-easier-5d6947d2f9da?source=your_stories_page---------------------------" rel="noopener"> Nuxt-Socket。IO:名称空间配置如何让你的生活变得无比简单</a></p><p id="cd9a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">信用/鸣谢</strong></p><ul class=""><li id="06f4" class="kq kr in jm b jn jo jr js jv ks jz kt kd ku kh li kw kx ky bi translated"><a class="ae ki" href="https://github.com/SebastianLuebke" rel="noopener ugc nofollow" target="_blank"> Sebastian Lubke </a>:用于打开请求Vuex选项支持的问题。</li></ul></div></div>    
</body>
</html>