<html>
<head>
<title>Building a React Native Component Library with Storybook.JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Storybook构建React原生组件库。射流研究…</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-react-native-component-library-with-storybook-js-76db79ceb359?source=collection_archive---------0-----------------------#2019-07-20">https://javascript.plainenglish.io/building-a-react-native-component-library-with-storybook-js-76db79ceb359?source=collection_archive---------0-----------------------#2019-07-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5ac8f454624e7725772a04f33d4add78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8QMnd4uSVlWwKyGa"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@henry_be?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Henry Be</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2dcb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在过去的几个月里，我一直在使用一个遗留的React本地代码库，我在使用该代码库时面临的一个更大的问题是，不同UI组件的关注点没有清晰的分离。</p><p id="2a1e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">没有为单元格、行和表格提供单独的、可测试的组件来呈现数据表，而是使用一个具有呈现功能的组件来创建较小的组件，以构建较大的组件。</p><p id="28f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有鉴于此，我目前正在做的工作之一是创建这些独立的组件，并制作纯组件，即没有任何内部状态的组件。</p><p id="10fa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了使代码库更容易使用，我将这些较小的纯组件抽象到它们自己的库中，这些库将包含自己的文档和测试，并允许核心应用程序专注于处理状态并向纯组件提供数据以进行渲染。</p><p id="fd19" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这种方法还允许另一个团队完全专注于应用程序的UI和UX方面，并且通过建立组件所期望的道具的合同，将这些更改集成到主应用程序中应该没有问题。</p><p id="7fe9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了帮助在UI开发和应用程序开发团队之间建立共同的理解，我使用了<a class="ae jz" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank"> Storybook.js来呈现组件，作为一个交互式的风格指南。</a></p><h1 id="8171" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置组件库</h1><p id="d436" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">该库是一个新的npm项目，但它最终将由主应用程序使用，因此有一些事情需要考虑:</p><ul class=""><li id="fb53" class="mb mc in kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">主应用程序中使用的React版本(作为对等依赖项添加)</li><li id="5cd1" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">主应用程序中使用的生命周期管理(第三方组件可能会导致问题)</li><li id="ab4c" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">由于主应用程序是私有应用程序，如何在不上传到公共npm repo的情况下安装库</li></ul><h2 id="4f4a" class="mp kz in bd la mq mr dn le ms mt dp li kl mu mv lm kp mw mx lq kt my mz lu na bi translated">创建新的React本机项目</h2><p id="5bce" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">为了开始构建这个库，我需要建立一个新的React Native项目。</p><p id="9b61" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了做到这一点，我使用了<code class="fe nb nc nd ne b"><a class="ae jz" href="https://www.npmjs.com/package/create-react-native-app" rel="noopener ugc nofollow" target="_blank">create-react-native-app</a></code>(在全球安装之后)，它给了我一个基础项目。</p><p id="703b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我还安装了<a class="ae jz" href="https://docs.expo.io/versions/latest/workflow/expo-cli/" rel="noopener ugc nofollow" target="_blank"> Expo CLI工具，以便使用Expo </a>运行应用程序，因为组件库目前不使用非JS代码。</p><p id="1f9a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦我有了一个运行的React本地应用，就该开始设置storybook了。</p><h2 id="357b" class="mp kz in bd la mq mr dn le ms mt dp li kl mu mv lm kp mw mx lq kt my mz lu na bi translated">添加故事书</h2><p id="1a36" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">设置storybook最简单的方法是全局安装S <a class="ae jz" href="https://www.npmjs.com/package/@storybook/cli" rel="noopener ugc nofollow" target="_blank"> torybook CLI，然后运行</a> <code class="fe nb nc nd ne b"><a class="ae jz" href="https://www.npmjs.com/package/@storybook/cli" rel="noopener ugc nofollow" target="_blank">getstorybook</a></code> <a class="ae jz" href="https://www.npmjs.com/package/@storybook/cli" rel="noopener ugc nofollow" target="_blank">命令</a>，它会为您的项目完成设置Storybook的所有艰苦工作。</p><p id="5158" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我只需将<code class="fe nb nc nd ne b">export default from './storybook';</code>添加到<code class="fe nb nc nd ne b">App.js</code>中，当我运行应用程序时，Expo会处理剩下的事情。</p><h2 id="5ee3" class="mp kz in bd la mq mr dn le ms mt dp li kl mu mv lm kp mw mx lq kt my mz lu na bi translated">添加组件</h2><p id="1bb9" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">一旦我建立并运行了故事书，我就可以添加组件了。</p><p id="0f85" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我使用组件库的目标是创建纯粹的无状态组件，因为这些组件更容易测试，也更容易组合。</p><p id="28f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我为组件创建了一个<code class="fe nb nc nd ne b">src</code>文件夹，这将是创建库和添加我的第一个组件时打包的文件夹。</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">An example of a pure component — there’s no state</figcaption></figure><p id="c936" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我在根级别创建了一个<code class="fe nb nc nd ne b">__tests__</code>文件夹，并为该组件创建了一个快照测试来验证渲染逻辑。</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Snapshot test for the input component</figcaption></figure><p id="7f5a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我为组件创建了一个故事，它将显示在展示组件的故事书中。</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Story showing the search input</figcaption></figure><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/0aa20e3ae4709de572a50cf888ada6b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JXiu48xU6eUMnTde4DHXEw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Input pokemon rendered in Storybook</figcaption></figure><h1 id="2f6a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">流程的改进</h1><p id="08f8" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">当我开始构建组件库时，我发现了一些改进过程的方法。</p><p id="bd4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了减少测试和故事书中重复代码的数量，我决定使用<a class="ae jz" href="https://www.npmjs.com/package/@storybook/addon-storyshots" rel="noopener ugc nofollow" target="_blank">story shots——故事书的一个插件，负责快照测试</a>。</p><p id="9b92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不完全确定Storyshots是正确的方法，但是因为它将所有快照捆绑到一个大文件中，我更喜欢对此进行更多的控制，以便在测试下的组件和快照文件之间有一个清晰的映射。</p><p id="9597" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了帮助测试和显示Storybook中的组件，我创建了一个<code class="fe nb nc nd ne b">data</code>文件夹，其中包含要传递给组件的数据对象。</p><p id="d174" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这允许我有一个存放所有数据的地方，然后导入我需要在测试和故事中使用的对象。</p><h2 id="5ed4" class="mp kz in bd la mq mr dn le ms mt dp li kl mu mv lm kp mw mx lq kt my mz lu na bi translated">处理情态动词</h2><p id="aa3e" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">其中一个较难解决的问题是如何显示一个模态组件，因为模态组件将覆盖在故事书的用户界面上，如果没有办法管理可见性状态，故事书就无法使用。</p><p id="97ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将这种类型的功能添加到故事中，并不像声明一个布尔变量来保存值并通过Storybook的函数进行更改那样简单，因为当值更改时，story book不会重新呈现组件。相反，你需要一个状态管理插件来保存这个值。</p><p id="d9bd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">story book dump 247/story book-state和<a class="ae jz" href="https://www.npmjs.com/package/@sambego/storybook-state" rel="noopener ugc nofollow" target="_blank"> sambego/storybook-state有两个状态插件。</a></p><p id="00fb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我发现dump247遇到了一个bug，由于React Native版本Storybook中的一个竞争条件，它试图访问一个尚未设置的值，但爆炸了，但<a class="ae jz" href="https://www.npmjs.com/package/@sambego/storybook-state" rel="noopener ugc nofollow" target="_blank"> sambego/storybook-state插件非常有效</a>。</p><p id="d799" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用storybook-state插件，我可以创建一个初始的按钮组件，当它被点击时会显示出模态组件，然后我可以在按下关闭按钮时关闭模态组件。</p><figure class="nf ng nh ni gt jo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Adding state to story to render Modal on button press</figcaption></figure><figure class="nf ng nh ni gt jo gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/e5864ae695e9138aa3b92767e7496286.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/1*_DoHKgGnGmM5kE3aPE4Bkg.gif"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Modal launching on button press in Storybook</figcaption></figure><h1 id="c682" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">摘要</h1><p id="66ee" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">通过将UI组件抽象到一个库中，我已经能够消除原始代码库的大部分复杂性，并且由于关注点的分离，使UI组件和主要应用程序代码库更加集中。</p><p id="87ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，UI组件现在有一个单独的位置，可以在主应用程序状态之外显示它们，这意味着具有更多基于设计的背景的团队成员可以自由地试验UI，而不必担心破坏主应用程序。</p><h2 id="b61c" class="mp kz in bd la mq mr dn le ms mt dp li kl mu mv lm kp mw mx lq kt my mz lu na bi translated"><strong class="ak">简明英语团队的笔记</strong></h2><p id="9feb" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">你知道我们有四种出版物吗？给他们一个关注来表达爱意吧:<a class="ae jz" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="kc io">JavaScript in Plain English</strong></a>，<a class="ae jz" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kc io">AI in Plain English</strong></a>，<a class="ae jz" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kc io">UX in Plain English</strong></a>，<a class="ae jz" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kc io">Python in Plain English</strong></a><strong class="kc io"/>—谢谢，继续学习！</p><p id="2fca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，我们总是有兴趣帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae jz" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">submissions @ plain English . io</strong></a><strong class="kc io"/>，并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>