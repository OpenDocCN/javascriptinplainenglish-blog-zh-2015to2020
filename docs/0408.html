<html>
<head>
<title>React Redux for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适合初学者的React Redux</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-redux-for-beginners-d51b46cb6d58?source=collection_archive---------1-----------------------#2019-10-08">https://javascript.plainenglish.io/react-redux-for-beginners-d51b46cb6d58?source=collection_archive---------1-----------------------#2019-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7c70" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过本实践教程，了解什么是Redux，如何在React项目中配置和使用它。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e166256f3ae408bf7209111f564eed3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VeM-5lsAtrrJ4jXH96h5kg.png"/></div></div></figure><h2 id="b731" class="kr ks iq bd kt ku kv dn kw kx ky dp kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">在React应用程序中，信息从父元素向子元素单向流动。</h2><p id="fc95" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">在下面的例子中，我们有一个应用程序的例子，用户可以检查他们最喜欢的电影。请注意，MovieList组件可以访问一个API，该API返回要在屏幕上显示的电影列表。当我们想要访问一部特定的电影时，我们可以通过Props将数据传递给电影组件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/cfd05feb923d73001a773d933344dccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*8J3KdB2s7suVaKkK_GgmAg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Search component can't access data</figcaption></figure><p id="406d" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">当我们想使用搜索栏时，问题就出现了。请注意，它在我们的组件树中位于MovieList的同一层，因此我们无法在这两个组件之间共享数据。为了解决这个问题，我们必须将数据存储在两者的父组件中，在本例中是App。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/b836b651c15de3c9fcd2de7db31fc36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*bx2DwjoK9G98uM8Qsjkypg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">States of application inside App component</figcaption></figure><p id="4072" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">现在Search和MovieList都可以访问数据，但这是处理这种情况的最佳方式吗？</p><p id="c395" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">将电影列表信息保留在应用程序中没有多大意义，因为这些信息对该组件没有任何意义(它存在的唯一原因是允许与搜索组件共享数据)。另一个要点是，这里我们讨论的是一个5组件应用程序。想象一下这样一种情况，我们的应用程序不断增长，我们需要管理几十个组件。保持它的有序会非常复杂，那么如何解决这个问题呢？</p><p id="a592" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">让我们在应用程序中创建一个全局状态，这样所有组件都可以从中访问数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/08c00886e92bbe81b7790b5080ebf294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*oA7N17vj1ul9lAD9EjhwPQ.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Application with global state</figcaption></figure><p id="dd43" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">首先，我们需要了解从现在开始将要用到的四个概念:</p><ul class=""><li id="9f06" class="ms mt iq lp b lq ml lt mm la mu le mv li mw mf mx my mz na bi translated"><strong class="lp ir"> STORE → </strong>这是我们应用程序的全局状态。</li><li id="be52" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf mx my mz na bi translated"><strong class="lp ir">动作→ </strong>与名字所暗示的相反，动作并没有执行的逻辑，它们是返回一个对象或动作名称的函数，要用一个可选的有效负载来执行。</li><li id="23c3" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf mx my mz na bi translated"><strong class="lp ir">减速器→ </strong>减速器是实际执行我们行动的人。基本上，他们有一个开关，可以根据用户通知的动作来决定我们的应用程序要做什么。</li><li id="e11d" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf mx my mz na bi translated"><strong class="lp ir">调度员→ </strong>调度员负责调用动作。</li></ul><p id="249a" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">这些概念是脸书创建的称为Flux的架构的一部分，Redux是该架构的实现，其工作方式如下:</p><ol class=""><li id="76d4" class="ms mt iq lp b lq ml lt mm la mu le mv li mw mf ng my mz na bi translated">组件调用调度程序</li><li id="4f84" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf ng my mz na bi translated">调度员触发操作</li><li id="d0ae" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf ng my mz na bi translated">Reducer监听动作，并根据调用的动作在我们的应用程序中执行更改</li><li id="b7eb" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf ng my mz na bi translated">Reducer更新存储(应用程序全局状态)</li><li id="8348" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf ng my mz na bi translated">组件根据存储值更新它们的值</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/98ed50b82793095edb7a13377beedb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*TxwaXEPXW6nBcxM1BkwQxg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Flux architecture</figcaption></figure><p id="52dd" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">动作和缩减器使用发布者/订阅者模式工作。在底层，被调用的动作发布一个被reducers监听的对象。基于这些对象的属性，reducers执行某些操作并更新存储，其中包含应用程序的全局状态。</p><p id="d87c" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">我知道这听起来令人困惑，但我保证当我们去实践时会更容易理解！</p><p id="a223" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">让我们用下面的例子来理解如何在我们的项目中配置和使用Redux:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/ee3f35315e8d351eb4c876f402d65d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWKh5PFcbjwQmBsMjE-UQQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">App interface</figcaption></figure><p id="469f" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">这个超级简单的应用程序将由两个组件(Header和Content)构成，这两个组件共享用户登录时的信息和总数。正如我们前面看到的，在同一级别的两个组件之间共享这些状态的最佳方式是使用存储。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/9f7d23f97cb33578c215aca3c7b575af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*CO3bswudFFtZVOYrru7fiA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">App components</figcaption></figure><p id="8622" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">我假设如果你正在学习Redux，那是因为你已经对React的基础有了一些了解。在本教程中，我不会详细介绍我们将使用的两个组件(Header和Content)的实现，也不会介绍如何使用GlobalStyle的样式组件，而是专注于Redux的配置和使用。如果你感兴趣，我有另一篇文章<a class="ae nk" href="https://medium.com/javascript-in-plain-english/how-to-build-reusable-layouts-in-react-js-daf8adcbca79" rel="noopener">解释如何建立这个结构。</a></p><p id="8b38" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">组件的创建及其风格化非常简单，只是为了教学目的，正因为如此，我相信你在理解最终可用的代码时不会有任何困难。</p><h1 id="050a" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">配置Redux</h1><p id="6c99" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">我们需要做的第一件事是在我们的项目中配置Redux。</p><p id="62e2" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">让我们安装以下库:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="fbdf" class="kr ks iq nx b gy ob oc l od oe">yarn add redux react-redux</span></pre><p id="b643" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">安装完成后，我们需要创建这个文件夹结构来组织我们的代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/43874aa9aa110d1e74189daa945ce335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96FUI9bExmQXrCiXEF393Q.png"/></div></div></figure><p id="57e8" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">存储文件夹将包含关于Redux的所有必要信息。</p><ul class=""><li id="3ac9" class="ms mt iq lp b lq ml lt mm la mu le mv li mw mf mx my mz na bi translated"><code class="fe og oh oi nx b">index.js</code>文件将负责设置我们的存储，并允许组件访问它们的值。</li><li id="50f6" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf mx my mz na bi translated">在modules文件夹中，我们将根据它们的功能来分离我们的操作和reducers。在这种情况下，我们有认证动作和计数动作。</li><li id="4556" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf mx my mz na bi translated">每个模块的文件夹内都有它的动作和减少器。</li><li id="c700" class="ms mt iq lp b lq nb lt nc la nd le ne li nf mf mx my mz na bi translated">最后，我们将有一个名为rootReducer的文件。这是一个通常用来描述redux方法的名称，该方法采用多个redux并将它们组合成一个对象。我们将在后面看到，当我们创建商店时，它只接受一个缩减器，我们使用这个函数来解决这个问题。</li></ul><h1 id="5be8" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">创建操作</h1><p id="3db6" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">让我们从动作文件开始。基本上，它们包含返回一个对象的函数，这个对象将被reducers听到。在这些对象中，我们通常发送两个值:<code class="fe og oh oi nx b">type</code>和<code class="fe og oh oi nx b">payload</code>。</p><p id="9963" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">Type是reducer将会听到的键，以确定将执行哪个动作，因此它需要是唯一的。在type中，我喜欢在动作名之前传递模块名，因为这样更容易调试，我们将在后面看到。</p><p id="768f" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">Payload是可选的，在它里面我们可以传递参数给reducer。</p><p id="9552" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated"><code class="fe og oh oi nx b">./src/store/modules/auth/actions.js</code>:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="8c1f" class="kr ks iq nx b gy ob oc l od oe">export function login() {<br/>  return {<br/>    type: "@auth/LOGIN"<br/>  };<br/>}</span><span id="f3e3" class="kr ks iq nx b gy oj oc l od oe">export function logout() {<br/>  return {<br/>    type: "@auth/LOGOUT"<br/>  };<br/>}</span></pre><p id="a218" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated"><code class="fe og oh oi nx b">./src/store/modules/count/actions.js</code>:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="b4f6" class="kr ks iq nx b gy ob oc l od oe">export function increment(number) {<br/>  return {<br/>    type: "@auth/INCREMENT",<br/>    payload: number<br/>  };<br/>}</span><span id="b79d" class="kr ks iq nx b gy oj oc l od oe">export function decrement(number) {<br/>  return {<br/>    type: "@auth/DECREMENT",<br/>    payload: number<br/>  };<br/>}</span></pre><h1 id="cd95" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">创建减速器</h1><p id="f48f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">Reducers将有一个初始状态，我们将根据应用程序触发的动作来改变它，总是使用类型参数作为键。</p><p id="42f9" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">在这个文件中，我们将使用一个名为immer的库来帮助我们管理应用程序状态的变化，因为始终值得记住的是，React状态是不可变的。如果你想知道更多细节，你可以查看他们提供的<a class="ae nk" href="https://github.com/immerjs/immer" rel="noopener ugc nofollow" target="_blank">大文档</a>！</p><p id="89ed" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">要安装immer，只需使用以下命令:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="e087" class="kr ks iq nx b gy ob oc l od oe">yarn add immer</span></pre><p id="880f" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">检查以下减速器的实施情况。</p><p id="312f" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated"><code class="fe og oh oi nx b">./src/store/modules/auth/reducers.js</code>:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="724f" class="kr ks iq nx b gy ob oc l od oe">import produce from "immer";</span><span id="898e" class="kr ks iq nx b gy oj oc l od oe">const INITIAL_STATE = {<br/>  signed: false<br/>};</span><span id="ce66" class="kr ks iq nx b gy oj oc l od oe">export default function auth(state = INITIAL_STATE, action) {<br/>  return produce(state, draft =&gt; {<br/>    switch (action.type) {<br/>      case "@auth/LOGIN":<br/>        draft.signed = true;<br/>        break;<br/>      case "@auth/LOGOUT":<br/>        draft.signed = false;<br/>        break;<br/>      default:<br/>    }<br/>  });<br/>}</span></pre><p id="ffed" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated"><code class="fe og oh oi nx b">./src/store/modules/count/reducers.js</code>:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="70f8" class="kr ks iq nx b gy ob oc l od oe">import produce from "immer";</span><span id="7e70" class="kr ks iq nx b gy oj oc l od oe">const INITIAL_STATE = {<br/>  counter: 0<br/>};</span><span id="5c94" class="kr ks iq nx b gy oj oc l od oe">export default function auth(state = INITIAL_STATE, action) {<br/>  return produce(state, draft =&gt; {<br/>    switch (action.type) {<br/>      case "@auth/INCREMENT":<br/>        draft.counter += action.payload;<br/>        break;<br/>      case "@auth/DECREMENT":<br/>        draft.counter -= action.payload;<br/>        break;<br/>      default:<br/>    }<br/>  });<br/>}</span></pre><p id="3411" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">注意，reducer是一个接收状态和动作的函数(包含我们前面看到的类型和有效负载)。</p><p id="e750" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">如果我们的存储仍然是空的，我们的INITIAL_STATE将发挥作用，用我们定义的默认值填充它。</p><p id="56cd" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">从我们的reducer返回调用我们从immer内部导入的<code class="fe og oh oi nx b">produce</code>。请注意，该生成器获取一个状态并返回一个草稿。在这个草稿中，我们添加了一个开关来根据类型选择动作，并用相应的值修改状态。注意，这个草稿包含了我们状态的一个副本，可以修改(immer为我们处理它，并最终返回带有我们想要更改的值的状态)。</p><h1 id="1ba7" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">组合减速器</h1><p id="eed2" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">当我们创建商店时，我们需要传递一个reducer作为参数。为了解决这个问题，让我们创建文件<code class="fe og oh oi nx b">./src/store/modules/rootReducer.js</code>。在里面，我们将使用redux的<code class="fe og oh oi nx b">combineReducers</code>方法，它将负责组合我们所有的reducers并返回一个值添加到存储中。</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="d037" class="kr ks iq nx b gy ob oc l od oe">import { combineReducers } from "redux";</span><span id="8391" class="kr ks iq nx b gy oj oc l od oe">import auth from "./auth/reducer";<br/>import count from "./count/reducer";</span><span id="ab63" class="kr ks iq nx b gy oj oc l od oe">export default combineReducers({<br/>  auth,<br/>  count<br/>});</span></pre><h1 id="2bfd" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">创建商店</h1><p id="c333" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">配置redux的最后一步是创建存储，将我们的reducers配置作为参数传递到文件<code class="fe og oh oi nx b">./src/store/index.js</code>中。为此，我们将使用redux的<code class="fe og oh oi nx b">createStore</code>方法。</p><p id="3a86" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">此外，我们将使用一个名为<a class="ae nk" href="https://github.com/zalmoxisus/redux-devtools-extension" rel="noopener ugc nofollow" target="_blank"> Redux Devtools </a>的调试工具，它将帮助我们识别正在调用的操作(相信我，它将使您的应用程序调试变得更加容易)。要安装redux devtools，只需按照他们页面上的教程，非常简单！我使用谷歌Chrome，直接从Chrome网上商店安装。</p><p id="0815" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">现在，让我们安装redux devtools库，它将帮助我们进行设置:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="2830" class="kr ks iq nx b gy ob oc l od oe">yarn add redux-devtools-extension</span></pre><p id="fc4b" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">我们将向<code class="fe og oh oi nx b">createStore</code>函数传递两个参数:我们的<code class="fe og oh oi nx b">rootReducer</code>(它包含所有的reducers)和一个名为<code class="fe og oh oi nx b">enhancer</code>的新参数，在这里我们将通知我们想要添加到存储中的其他特性，例如中间件或持久性(我们将在以后的帖子中讨论这些设置)。</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="416e" class="kr ks iq nx b gy ob oc l od oe">import { createStore } from "redux";<br/>import { devToolsEnhancer } from "redux-devtools-extension";</span><span id="0907" class="kr ks iq nx b gy oj oc l od oe">import rootReducer from "./modules/rootReducer";</span><span id="1cbf" class="kr ks iq nx b gy oj oc l od oe">const enhancer =<br/>  process.env.NODE_ENV === "development" ? devToolsEnhancer() : null;</span><span id="d4ee" class="kr ks iq nx b gy oj oc l od oe">const store = createStore(rootReducer, enhancer);</span><span id="64f9" class="kr ks iq nx b gy oj oc l od oe">export default store;</span></pre><p id="cf68" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">注意，配置非常简单，只有在开发环境中，增强器才应该存在。我们可以通过检查NODE_ENV环境变量来控制这一点。当我们使用create-react-app创建我们的应用程序时，如果我们使用参数<code class="fe og oh oi nx b">start</code>启动我们的应用程序，它就具有开发价值。当我们构建我们的应用程序时，这个值变成了<code class="fe og oh oi nx b">production</code>。</p><h1 id="fb68" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">在我们的组件和商店之间搭建桥梁</h1><p id="7a0d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">还记得我在这篇文章的开头提到React中的信息是单向流动的吗？使用Redux，我们将保持相同的模式，将所有组件包装在一个名为<code class="fe og oh oi nx b">Provider</code>的<code class="fe og oh oi nx b">react-redux</code>组件中。该组件将把我们之前设置的商店作为属性。</p><p id="5eec" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">因为我们应用程序中的其他所有东西都比提供者低一个级别，所以所有组件都可以访问商店中的值。</p><p id="b211" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated"><code class="fe og oh oi nx b">./src/App.js</code>文件将如下所示:</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="8f25" class="kr ks iq nx b gy ob oc l od oe">import React from "react";<br/>import { Provider } from "react-redux";</span><span id="8fd1" class="kr ks iq nx b gy oj oc l od oe">import Content from "./components/Content";<br/>import Header from "./components/Header";</span><span id="f66a" class="kr ks iq nx b gy oj oc l od oe">import store from "./store";</span><span id="f3bf" class="kr ks iq nx b gy oj oc l od oe">import GlobalStyle from "./styles/global";</span><span id="5403" class="kr ks iq nx b gy oj oc l od oe">function App() {<br/>  return (<br/>    &lt;Provider store={store}&gt;<br/>      &lt;Header /&gt;<br/>      &lt;Content /&gt;<br/>      &lt;GlobalStyle /&gt;<br/>    &lt;/Provider&gt;<br/>  );<br/>}</span><span id="21cd" class="kr ks iq nx b gy oj oc l od oe">export default App;</span></pre><h1 id="7c34" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">从存储中检索值</h1><p id="d7a3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">为了访问存储值，我们将使用react-redux中一个名为useSelector的函数。以Header组件为例，我们能够从存储内部检索这两个值，并将它们添加到JSX。如果这些值改变了，我们的组件会用新的值再次呈现！</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="7a9f" class="kr ks iq nx b gy ob oc l od oe">import React from "react";<br/>import { useSelector } from "react-redux";</span><span id="0f65" class="kr ks iq nx b gy oj oc l od oe">import { Container } from "./styles";</span><span id="b29f" class="kr ks iq nx b gy oj oc l od oe">export default function Header() {<br/>  const count = useSelector(state =&gt; state.count.counter);<br/>  const signed = useSelector(state =&gt; state.auth.signed);</span><span id="360b" class="kr ks iq nx b gy oj oc l od oe">  return (<br/>    &lt;Container signed={signed}&gt;<br/>      &lt;h1&gt;Logged in: {String(signed)}&lt;/h1&gt;<br/>      &lt;h1&gt;Total count: {count}&lt;/h1&gt;<br/>    &lt;/Container&gt;<br/>  );<br/>}</span></pre><h1 id="51ae" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">触发动作</h1><p id="a031" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">我们需要执行的最后一步是触发动作来改变存储中的状态。现在我们将以内容组件为例。注意，除了<code class="fe og oh oi nx b">useSelector</code>，我们还从reactRedux内部导入了<code class="fe og oh oi nx b">useDispatch</code>。此外，我们需要从各自的文件中导入我们的操作。</p><p id="31cf" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">我们使用useSelector重复了在Header组件中执行的相同过程来检索商店状态，并使用<code class="fe og oh oi nx b">useDispatch</code>创建了一个dispatch，它将负责触发我们的操作，正如我们在开头的图表中看到的那样。</p><pre class="kg kh ki kj gt nw nx ny nz aw oa bi"><span id="b2f5" class="kr ks iq nx b gy ob oc l od oe">import React from "react";<br/>import { useSelector, useDispatch } from "react-redux";</span><span id="6f57" class="kr ks iq nx b gy oj oc l od oe">import { Container } from "./styles";</span><span id="7235" class="kr ks iq nx b gy oj oc l od oe">import { login, logout } from "../../store/modules/auth/actions";<br/>import { increment, decrement } from "../../store/modules/count/actions";</span><span id="1bcd" class="kr ks iq nx b gy oj oc l od oe">export default function Main() {<br/>  const count = useSelector(state =&gt; state.count.counter);<br/>  const signed = useSelector(state =&gt; state.auth.signed);<br/>  const dispatch = useDispatch();</span><span id="be11" class="kr ks iq nx b gy oj oc l od oe">  return (<br/>    &lt;Container&gt;<br/>      &lt;h1&gt;Total count: {count}&lt;/h1&gt;</span><span id="0b42" class="kr ks iq nx b gy oj oc l od oe">      &lt;div&gt;<br/>        &lt;button onClick={() =&gt; dispatch(decrement(2))}&gt;-2&lt;/button&gt;<br/>        &lt;button onClick={() =&gt; dispatch(increment(2))}&gt;+2&lt;/button&gt;<br/>      &lt;/div&gt;</span><span id="821d" class="kr ks iq nx b gy oj oc l od oe">      {signed ? (<br/>        &lt;button onClick={() =&gt; dispatch(logout())}&gt;LOGOUT&lt;/button&gt;<br/>      ) : (<br/>        &lt;button onClick={() =&gt; dispatch(login())}&gt;LOGIN&lt;/button&gt;<br/>      )}<br/>    &lt;/Container&gt;<br/>  );<br/>}</span></pre><p id="be60" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">请注意，在按钮的<code class="fe og oh oi nx b">onClick</code>功能中，我们通过调度来触发我们的操作。在<code class="fe og oh oi nx b">increment</code>和<code class="fe og oh oi nx b">decrement</code>动作中，我们将一个值作为参数传递。</p><p id="ac79" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">将dispatch放在arrow函数中是非常重要的，这样只有当用户单击按钮时它才会被调用，否则每当组件被渲染时它们都会被触发，这将最终在您的代码中生成一个无限循环(如果发生这种情况，react会触发一个错误)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/f9329b1e9ff1f9c87ea0a02e88ae485b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkR4LxVImWmAZW1YB258JQ.png"/></div></div></figure><h1 id="87f2" class="nl ks iq bd kt nm nn no kw np nq nr kz jw ns jx ld jz nt ka lh kc nu kd ll nv bi translated">结论</h1><p id="b8f6" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv la lw lx ly le lz ma mb li mc md me mf ij bi translated">Redux一开始可能看起来很混乱，但是不要被它吓到，只要稍微练习一下，你就会发现它并没有那么复杂。我希望这个简短的教程可以帮助你理解在许多项目中出现的这种架构背后的概念。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="e8bc" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">你可以在codesandebox.io中查看这个项目的完整实现:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="on om l"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Project implementation on codesandbox.io</figcaption></figure><p id="ed14" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">如果你有兴趣更多地了解我是如何构建这个应用程序的，你可以查看我的其他文章，其中我展示了<a class="ae nk" href="https://medium.com/javascript-in-plain-english/how-to-build-reusable-layouts-in-react-js-daf8adcbca79?source=your_stories_page---------------------------" rel="noopener">如何在React JS </a>中构建可重用布局，以及<a class="ae nk" href="https://medium.com/javascript-in-plain-english/how-to-build-reusable-layouts-in-react-js-daf8adcbca79?source=your_stories_page---------------------------" rel="noopener">如何在React JS </a>中构建可重用布局。</p><p id="cf6e" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv la mn lx ly le mo ma mb li mp md me mf ij bi translated">希望这篇教程能对你的项目有所帮助！感谢阅读！</p></div></div>    
</body>
</html>