<html>
<head>
<title>CRUD in Deno with MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MongoDB的Deno中的CRUD</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/crud-in-deno-with-mongodb-b2fcda8ff4d7?source=collection_archive---------5-----------------------#2020-05-26">https://javascript.plainenglish.io/crud-in-deno-with-mongodb-b2fcda8ff4d7?source=collection_archive---------5-----------------------#2020-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c36811e5d49018ac0a5df6e189737f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTzAWv6PYX44Vx66FqZkfQ.jpeg"/></div></div></figure><p id="cf65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Deno是javascript和typescript的一个安全的T4运行时。它是由NodeJS的幕后策划者Ryan Dahl创建的。我写了一篇关于Deno的介绍文章，你可以在这里找到<a class="ae kw" href="https://medium.com/swlh/is-deno-the-new-node-5cdcc5a29154" rel="noopener"/>。我强烈建议在这之前查看一下，了解一下Deno是如何工作的。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="df94" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">介绍</h1><p id="a838" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在本帖中，我们将创建基本的CRUD来开始使用Deno。我们还将集成mongo来保存我们的数据。</p><p id="019b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于Deno中不需要package.json或任何npm包(<em class="mh">它使用被引用为URL或文件路径的模块</em>)，我们将通过创建我们的<strong class="ka ir"> server.ts </strong>直接开始:</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="1dd5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从模块URL导入了<strong class="ka ir">应用程序</strong>，并用它启动了一个服务器。</p><p id="4e11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行时使用:<code class="fe mo mp mq mr b">deno run --allow-net server.ts</code></p><p id="bf5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，它在端口3000上启动服务器。您可以导航到<a class="ae kw" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>来运行您的服务器。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="649d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最好将应用程序路由与主服务器文件分开。让我们添加一个<strong class="ka ir"> routes.ts </strong>文件，我们将在其中定义我们所有的应用程序路线-</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="7483" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以将它导入我们的<strong class="ka ir"> server.ts </strong>:</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="de5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重新启动服务器。导航到localhost:3000/api/posts，你会看到<strong class="ka ir"> </strong> <code class="fe mo mp mq mr b">hello there</code> <strong class="ka ir"> </strong>打印的<strong class="ka ir">。</strong></p><p id="732f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，每次文件更改时，您都必须重启服务器。如果我们也能在Deno中拥有类似node mon(node . js中用于重启服务器的包)的东西，那岂不是太棒了。事实证明，实际上有一个名为denon的包，它在Deno中的作用与Node.js中的nodemon完全相同。</p><p id="087d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在继续之前，让我们通过运行以下命令来安装denon:</p><pre class="mi mj mk ml gt ms mr mt mu aw mv bi"><span id="c324" class="mw lf iq mr b gy mx my l mz na">deno install --allow-read --allow-run --allow-write -f --unstable <a class="ae kw" href="https://deno.land/x/denon/denon.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/x/denon/denon.ts</a></span></pre><p id="3668" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你可以用<code class="fe mo mp mq mr b">denon run --allow-net server.ts</code>运行你的服务器，denon会在任何文件改变时重新启动服务器。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="915c" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak"> MongoDB </strong></h1><p id="a842" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">创建一个文件<strong class="ka ir"> db.ts </strong>并添加以下代码:</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="c7e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在本地建立我们的数据库，并创建一个名为<strong class="ka ir"> deno_db </strong>的数据库。我们稍后将在控制器中导入这个文件。</p><p id="c8f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个mongo包目前有点不稳定，需要某些标志才能工作。因此，在终端中退出您的服务器，并使用以下命令重新启动它:</p><pre class="mi mj mk ml gt ms mr mt mu aw mv bi"><span id="4130" class="mw lf iq mr b gy mx my l mz na"><strong class="mr ir">denon run --allow-net --allow-plugin --unstable --allow-read --allow-write server.ts</strong></span></pre><h2 id="fc8b" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated">帖子界面</h2><p id="37cc" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们还将为我们的文档使用一个Post接口。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="cd44" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">路线</strong></h1><p id="05c7" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">让我们定义我们将在<strong class="ka ir"> routes.ts </strong>中使用的所有路线:</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="cb5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将在上面导入的一个单独的文件<strong class="ka ir"> controller.ts </strong>中为我们的路由定义事件处理程序的逻辑。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="2155" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">控制器</strong></h1><p id="3e78" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">以下是<strong class="ka ir">控制器的代码:</strong></p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="e35c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来分解控制器文件:</p><ul class=""><li id="ac38" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated">我们导入了之前创建的数据库实例和post接口</li><li id="9036" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated">然后，我们在<strong class="ka ir"> deno_db中创建了一个集合<strong class="ka ir">帖子</strong>。</strong></li><li id="683a" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated">之后，我们为不同的路由定义了处理程序。我们使用mongoDB特定的命令，如<strong class="ka ir"> find()、findOne()、updateOne() </strong>等来操作数据库。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="07b6" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">测试路线</h1><p id="aa7c" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在应用其他操作之前，我们先保存一些帖子。</p><p id="71fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请在Postman客户端中尝试一下:</p><h2 id="a059" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated">邮政</h2><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/016a9d9d49b2a7d1b71c96c009769983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJtVUAE70av8Q9POF4lUFg.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Post endpoint</figcaption></figure><h2 id="eae6" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated">得到</h2><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/e910a2c56fd957e10ea28177199b05db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUB5a5u1J8vtEWeKCUEjLQ.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Get all posts</figcaption></figure><h2 id="92e6" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated">获取(单个帖子)</h2><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/f43a1984d23461a45b74530833d4dabf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJeG9K2mVX_CGDvjUqgu3w.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Get single post</figcaption></figure><h2 id="e5e2" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated">放</h2><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/df6e2e82f475b814d02b18566c6a1221.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98xi1klL6AMaMZp_m1X55g.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Update post</figcaption></figure><h2 id="b6e8" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated"><strong class="ak">删除</strong></h2><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/321fe238bbcc00b4bd455dbcde82f6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OvolQReg_Qk38tCcd7Ljsg.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Delete a post</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/803610e81fbcf08399729010b3392532.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*pObAGwaJMcGqnNV6ycnZ6g.gif"/></div></figure><p id="391a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是全部。我们已经成功地创建了一个具有所有CRUD功能的deno服务器，并将数据保存在mongo中。当然，还有需要改进的地方，比如在路线中增加错误处理，但我会让你们去探索。</p><p id="5627" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是代码的github链接:<a class="ae kw" href="https://github.com/ATakaSKY/denoMongo" rel="noopener ugc nofollow" target="_blank">https://github.com/ATakaSKY/denoMongo</a></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="f2dc" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">资源</h1><div class="ok ol gp gr om on"><a href="https://deno.land/" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">deno——JavaScript和TypeScript的安全运行时。</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">Deno是一个简单、现代和安全的JavaScript和TypeScript运行时，它使用V8并内置于Rust中。</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">德诺.兰德</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb jw on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://github.com/denosaurs/denon" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">天龙/天龙</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">denon是nodemon的deno替代品，提供了打包的功能和易于使用的体验。天龙不需要…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div><div class="ow l"><div class="pc l oy oz pa ow pb jw on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://github.com/manyuanrong/deno_mongo" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">满园荣/德诺_蒙戈</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">deno_mongo是一个为deno开发的MongoDB数据库驱动，基于rust的官方库包。因为…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div><div class="ow l"><div class="pd l oy oz pa ow pb jw on"/></div></div></a></div><p id="692d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/Caesar2011/denotrain/tree/master" rel="noopener ugc nofollow" target="_blank">https://github.com/Caesar2011/denotrain</a></p><h2 id="0829" class="mw lf iq bd lg nb nc dn lk nd ne dp lo kj nf ng ls kn nh ni lw kr nj nk ma nl bi translated"><strong class="ak">用简单英语写的便条</strong></h2><p id="27ba" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？你可以在我们的主页<a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">plain English . io</strong></a>找到所有这些信息——关注我们的出版物并<a class="ae kw" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">订阅我们的YouTube频道</strong> </a> <strong class="ka ir">来表达你的爱吧！</strong></p></div></div>    
</body>
</html>