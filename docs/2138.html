<html>
<head>
<title>The simple Guide for React Native Camera</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应原生相机简单指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-simple-guide-for-react-native-camera-b81f5b2ac158?source=collection_archive---------4-----------------------#2020-05-23">https://javascript.plainenglish.io/the-simple-guide-for-react-native-camera-b81f5b2ac158?source=collection_archive---------4-----------------------#2020-05-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bf0b7cf7e2f1c827c8b9bff382614fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83oq7y_lltj37CqEiOjRfg.jpeg"/></div></div></figure><p id="8240" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">捕捉记忆！智能手机中的摄像头让我们能够快速捕捉生活中的精彩瞬间。我们很可能再也回不到的时刻，但我们可以用照片和视频的形式安全地捕捉它们。因此，我们渴望通过最喜爱的移动应用程序与我们所爱的人分享这一精彩时刻。</p><p id="f6b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">构建您的下一个移动应用程序时，您可能希望添加捕捉照片和视频的功能。您也可能不确定如何实现这一点。嗯，不用再看了，因为我们最近已经在我们的<a class="ae kw" href="https://www.instamobile.io/mobile-templates/social-networks/" rel="noopener ugc nofollow" target="_blank">社交应用</a>中实现了这个功能。你可能想看看我们是如何用React Native无缝实现相机功能的。</p><p id="7ceb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将在这里描述在React Native中捕获照片和视频的基本实现。</p><h2 id="22de" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">必需的包</h2><p id="965e" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">对于这个项目，我们将使用:</p><ul class=""><li id="f8c1" class="lv lw iq ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka ir">世博相机</strong>。捕捉照片和视频需要这个包。</li><li id="3485" class="lv lw iq ka b kb me kf mf kj mg kn mh kr mi kv ma mb mc md bi translated"><strong class="ka ir"> expo-av </strong>。在这里，我们将从该模块导入视频来播放我们录制的视频。</li></ul><p id="31c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以继续安装这两个软件包了。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="4fe2" class="kx ky iq mo b gy ms mt l mu mv">$yarn add expo-camera expo-av</span></pre><p id="2e5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="88cd" class="kx ky iq mo b gy ms mt l mu mv">$npm install expo-camera expo-av</span></pre><h2 id="a846" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">实现相机功能</h2><p id="720c" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">将camera组件添加到项目的视图中非常简单。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="327f" class="kx ky iq mo b gy ms mt l mu mv">import React, { useState, useRef, useEffect } from "react";<br/>import {<br/>  StyleSheet,<br/>  Dimensions,<br/>  View,<br/>  Text,<br/>  TouchableOpacity,<br/>  SafeAreaView,<br/>} from "react-native";<br/>import { Camera } from "expo-camera";<br/>import { Video } from "expo-av";<br/><br/>const WINDOW_HEIGHT = Dimensions.get("window").height;<br/><br/>const closeButtonSize = Math.floor(WINDOW_HEIGHT * 0.032);<br/>const captureSize = Math.floor(WINDOW_HEIGHT * 0.09);<br/><br/>export default function App() {<br/>  const [hasPermission, setHasPermission] = useState(null);<br/>  const [cameraType, setCameraType] = useState(Camera.Constants.Type.back);<br/>  const [isPreview, setIsPreview] = useState(false);<br/>  const [isCameraReady, setIsCameraReady] = useState(false);<br/>  const [isVideoRecording, setIsVideoRecording] = useState(false);<br/>  const [videoSource, setVideoSource] = useState(null);<br/>  const cameraRef = useRef();<br/><br/>  useEffect(() =&gt; {<br/>    (async () =&gt; {<br/>      const { status } = await Camera.requestPermissionsAsync();<br/>      setHasPermission(status === "granted");<br/>    })();<br/>  }, []);<br/><br/>  const onCameraReady = () =&gt; {<br/>    setIsCameraReady(true);<br/>  };<br/><br/>  const takePicture = async () =&gt; {<br/>    if (cameraRef.current) {<br/>      const options = { quality: 0.5, base64: true, skipProcessing: true };<br/>      const data = await cameraRef.current.takePictureAsync(options);<br/>      const source = data.uri;<br/>      if (source) {<br/>        await cameraRef.current.pausePreview();<br/>        setIsPreview(true);<br/>        console.log("picture source", source);<br/>      }<br/>    }<br/>  };<br/><br/>  const recordVideo = async () =&gt; {<br/>    if (cameraRef.current) {<br/>      try {<br/>        const videoRecordPromise = cameraRef.current.recordAsync();<br/><br/>        if (videoRecordPromise) {<br/>          setIsVideoRecording(true);<br/>          const data = await videoRecordPromise;<br/>          const source = data.uri;<br/>          if (source) {<br/>            setIsPreview(true);<br/>            console.log("video source", source);<br/>            setVideoSource(source);<br/>          }<br/>        }<br/>      } catch (error) {<br/>        console.warn(error);<br/>      }<br/>    }<br/>  };<br/><br/>  const stopVideoRecording = () =&gt; {<br/>    if (cameraRef.current) {<br/>      setIsPreview(false);<br/>      setIsVideoRecording(false);<br/>      cameraRef.current.stopRecording();<br/>    }<br/>  };<br/><br/>  const switchCamera = () =&gt; {<br/>    if (isPreview) {<br/>      return;<br/>    }<br/>    setCameraType((prevCameraType) =&gt;<br/>      prevCameraType === Camera.Constants.Type.back<br/>        ? Camera.Constants.Type.front<br/>        : Camera.Constants.Type.back<br/>    );<br/>  };<br/><br/>  const cancelPreview = async () =&gt; {<br/>    await cameraRef.current.resumePreview();<br/>    setIsPreview(false);<br/>    setVideoSource(null);<br/>  };<br/><br/>  const renderCancelPreviewButton = () =&gt; (<br/>    &lt;TouchableOpacity onPress={cancelPreview} style={styles.closeButton}&gt;<br/>      &lt;View style={[styles.closeCross, { transform: [{ rotate: "45deg" }] }]} /&gt;<br/>      &lt;View<br/>        style={[styles.closeCross, { transform: [{ rotate: "-45deg" }] }]}<br/>      /&gt;<br/>    &lt;/TouchableOpacity&gt;<br/>  );<br/><br/>  const renderVideoPlayer = () =&gt; (<br/>    &lt;Video<br/>      source={{ uri: videoSource }}<br/>      shouldPlay={true}<br/>      style={styles.media}<br/>    /&gt;<br/>  );<br/><br/>  const renderVideoRecordIndicator = () =&gt; (<br/>    &lt;View style={styles.recordIndicatorContainer}&gt;<br/>      &lt;View style={styles.recordDot} /&gt;<br/>      &lt;Text style={styles.recordTitle}&gt;{"Recording..."}&lt;/Text&gt;<br/>    &lt;/View&gt;<br/>  );<br/><br/>  const renderCaptureControl = () =&gt; (<br/>    &lt;View style={styles.control}&gt;<br/>      &lt;TouchableOpacity disabled={!isCameraReady} onPress={switchCamera}&gt;<br/>        &lt;Text style={styles.text}&gt;{"Flip"}&lt;/Text&gt;<br/>      &lt;/TouchableOpacity&gt;<br/>      &lt;TouchableOpacity<br/>        activeOpacity={0.7}<br/>        disabled={!isCameraReady}<br/>        onLongPress={recordVideo}<br/>        onPressOut={stopVideoRecording}<br/>        onPress={takePicture}<br/>        style={styles.capture}<br/>      /&gt;<br/>    &lt;/View&gt;<br/>  );<br/><br/>  if (hasPermission === null) {<br/>    return &lt;View /&gt;;<br/>  }<br/><br/>  if (hasPermission === false) {<br/>    return &lt;Text style={styles.text}&gt;No access to camera&lt;/Text&gt;;<br/>  }<br/><br/>  return (<br/>    &lt;SafeAreaView style={styles.container}&gt;<br/>      &lt;Camera<br/>        ref={cameraRef}<br/>        style={styles.container}<br/>        type={cameraType}<br/>        flashMode={Camera.Constants.FlashMode.on}<br/>        onCameraReady={onCameraReady}<br/>        onMountError={(error) =&gt; {<br/>          console.log("cammera error", error);<br/>        }}<br/>      /&gt;<br/>      &lt;View style={styles.container}&gt;<br/>        {isVideoRecording &amp;&amp; renderVideoRecordIndicator()}<br/>        {videoSource &amp;&amp; renderVideoPlayer()}<br/>        {isPreview &amp;&amp; renderCancelPreviewButton()}<br/>        {!videoSource &amp;&amp; !isPreview &amp;&amp; renderCaptureControl()}<br/>      &lt;/View&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>}<br/><br/>const styles = StyleSheet.create({<br/>  container: {<br/>    ...StyleSheet.absoluteFillObject,<br/>  },<br/>  closeButton: {<br/>    position: "absolute",<br/>    top: 35,<br/>    left: 15,<br/>    height: closeButtonSize,<br/>    width: closeButtonSize,<br/>    borderRadius: Math.floor(closeButtonSize / 2),<br/>    justifyContent: "center",<br/>    alignItems: "center",<br/>    backgroundColor: "#c4c5c4",<br/>    opacity: 0.7,<br/>    zIndex: 2,<br/>  },<br/>  media: {<br/>    ...StyleSheet.absoluteFillObject,<br/>  },<br/>  closeCross: {<br/>    width: "68%",<br/>    height: 1,<br/>    backgroundColor: "black",<br/>  },<br/>  control: {<br/>    position: "absolute",<br/>    flexDirection: "row",<br/>    bottom: 38,<br/>    width: "100%",<br/>    alignItems: "center",<br/>    justifyContent: "center",<br/>  },<br/>  capture: {<br/>    backgroundColor: "#f5f6f5",<br/>    borderRadius: 5,<br/>    height: captureSize,<br/>    width: captureSize,<br/>    borderRadius: Math.floor(captureSize / 2),<br/>    marginHorizontal: 31,<br/>  },<br/>  recordIndicatorContainer: {<br/>    flexDirection: "row",<br/>    position: "absolute",<br/>    top: 25,<br/>    alignSelf: "center",<br/>    justifyContent: "center",<br/>    alignItems: "center",<br/>    backgroundColor: "transparent",<br/>    opacity: 0.7,<br/>  },<br/>  recordTitle: {<br/>    fontSize: 14,<br/>    color: "#ffffff",<br/>    textAlign: "center",<br/>  },<br/>  recordDot: {<br/>    borderRadius: 3,<br/>    height: 6,<br/>    width: 6,<br/>    backgroundColor: "#ff0000",<br/>    marginHorizontal: 5,<br/>  },<br/>  text: {<br/>    color: "#fff",<br/>  },<br/>});</span></pre><p id="0c04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加完这段代码后，我们应该准备好相机显示了。确保您在实际设备上运行它。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/ed59ab28dec8101bfa92481d54f4ce89.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/0*ISCaHuQGMrf_XJtF.png"/></div></figure><p id="a542" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的实现非常简单，逻辑被分解为以下核心方法:</p><p id="d225" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们分析组成我们的相机项目的逻辑的核心方法之前，我们应该注意我们在哪里显示了“相机”组件实例(<strong class="ka ir"> &lt;相机……/&gt;</strong>)。</p><p id="a5ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，我们将已经定义好的<strong class="ka ir"> cameraRef </strong>传递给我们的相机组件的ref prop。</p><p id="c41a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样，我们现在可以在之前传递给Ref属性的<strong class="ka ir"> cameraRef </strong>上访问漂亮的方法，如<strong class="ka ir"> takePictureAsync() </strong>、<strong class="ka ir"> recordAysnc() </strong> …。这种方法将是帮助我们实现预期目标的关键，如拍照、录像等。</p><ul class=""><li id="9b18" class="lv lw iq ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka ir">oncamaready()</strong>。实现这个回调方法的目的是决定相机何时准备好拍摄照片或视频。您应该注意到，在以任何形式捕获图片之前，检查是否调用了该方法是很重要的。</li><li id="c478" class="lv lw iq ka b kb me kf mf kj mg kn mh kr mi kv ma mb mc md bi translated"><strong class="ka ir">拍照()</strong>。在相机组件实例(Camera ref . current . takePictureAsync)的ref上调用的“takePictureAsync()”的帮助下，我们能够用这种方法成功地捕获一张图片。</li><li id="35ea" class="lv lw iq ka b kb me kf mf kj mg kn mh kr mi kv ma mb mc md bi translated"><strong class="ka ir"> recordVideo() </strong>。这个方法类似于takePicture()方法。通过我们的capture组件的onLongPress回调触发，我们借助recordAsync方法以视频的形式捕捉瞬间，该方法也在Camera组件实例(cameraRef.current.recordAsync())的ref上调用。</li><li id="93a7" class="lv lw iq ka b kb me kf mf kj mg kn mh kr mi kv ma mb mc md bi translated"><strong class="ka ir"> stopVideoRecording() </strong>。该方法由用户触发以停止视频记录。</li><li id="71d0" class="lv lw iq ka b kb me kf mf kj mg kn mh kr mi kv ma mb mc md bi translated"><strong class="ka ir"> switchCamera() </strong>。该方法在ur设备的前后摄像头之间切换。</li><li id="4501" class="lv lw iq ka b kb me kf mf kj mg kn mh kr mi kv ma mb mc md bi translated"><strong class="ka ir"> cancelPreview() </strong>。这种方法取消任何形式的照片或视频预览，无论是照片还是视频。</li></ul><p id="d7a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有的渲染方法，比如<strong class="ka ir">renderCancelPreviewButton()</strong>，<strong class="ka ir"> renderVideoPlayer() </strong> …只是简单地渲染一个组件，以便在你的手机屏幕上显示。</p><p id="e432" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们呈现任何要显示的组件之前，我们通过在Camera组件的实例上调用“requestPermissionsAsync”来请求必要的权限(Camera.requestPermissionsAsync())。此方法在useEffect方法中调用。我们的useEffect方法只有在组件被初始安装时才会被触发。</p><p id="3240" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经实现了一个简单的条件渲染，使用我们的组件进行显示。这里，只有在预览时，我们才呈现一个cancel按钮，以便在照片或视频被捕获后取消预览。我们在录音的时候会渲染一个指示器。一个视频播放器后，视频已被记录，我们有一个视频源。</p><p id="b236" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只有当我们没有视频源并且没有预览时，我们才呈现一个捕获按钮。</p><p id="56bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户点击捕获按钮进行记录。</p><p id="7c3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户也可以按住捕捉按钮来录制视频。按out停止录制并预览录制的视频。</p><p id="e521" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按下翻转文本切换相机。</p><p id="cc6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一张图片胜过千言万语，在你的应用程序中拥有捕捉照片和视频的能力是一个重要的功能。照片和视频被认为是新的键盘，传达更多文字无法捕捉的信息。</p><p id="750c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记得查看我们的任何<a class="ae kw" href="https://www.instamobile.io/mobile-templates/social-networks/" rel="noopener ugc nofollow" target="_blank">演示应用</a>，看看我们是如何超越这个特性的基本实现的。</p><p id="2f1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mx">原载于2020年5月23日</em><a class="ae kw" href="https://www.instamobile.io/react-native-tutorials/capturing-photos-and-videos-with-the-camera-in-react-native/" rel="noopener ugc nofollow" target="_blank"><em class="mx">https://www . insta mobile . io</em></a><em class="mx">。</em></p></div></div>    
</body>
</html>