<html>
<head>
<title>JavaScript Events Handlers — onvisibilitychange event, onanimationcancel and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript事件处理程序— onvisibilitychange事件、onanimationcancel等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-events-handlers-onvisibilitychange-event-onanimationcancel-and-more-de974c205ed5?source=collection_archive---------3-----------------------#2020-01-21">https://javascript.plainenglish.io/javascript-events-handlers-onvisibilitychange-event-onanimationcancel-and-more-de974c205ed5?source=collection_archive---------3-----------------------#2020-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn js jt ju jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi jr"><img src="../Images/dc7ff935a4cddd67b5b00b001462ce6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f4By4gxvwQyW5HIv"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Photo by <a class="ae kg" href="https://unsplash.com/@ggvasalia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">George Gvasalia</a> on <a class="ae kg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="faad" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在JavaScript中，事件是应用程序中发生的动作。它们是由各种事情触发的，比如输入、提交表单、调整大小等元素变化，或者应用程序运行时发生的错误等。我们可以分配事件处理程序来处理这些事件。发生在DOM元素上的事件可以通过为相应事件的DOM对象的属性分配一个事件处理程序来处理。在本文中，我们查看了标准的<code class="fe jn jo jp jq b">onvisibilitychange</code>事件，以及非标准的<code class="fe jn jo jp jq b">onanimationcancel</code>、<code class="fe jn jo jp jq b">onanimationend</code>和<code class="fe jn jo jp jq b">onanimationiteration</code>事件。</p><h1 id="3986" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">视觉变化</h1><p id="0a7b" class="pw-post-body-paragraph kh ki iq kj b kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le ij bi translated"><code class="fe jn jo jp jq b">onvisibilitychange</code>是一个事件处理程序，当<code class="fe jn jo jp jq b">visibilitychange</code>事件被触发并到达对象时运行。我们定义自己的事件处理函数，然后将它设置为这个属性。例如，我们可以编写以下代码来记录当前页面的可见性:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="0a6f" class="mq lg iq jq b gy mr ms l mt mu">document.onvisibilitychange = (event) =&gt; {<br/>  console.log("Visibility changed!");<br/>  console.log(event);<br/>};</span></pre><p id="fcdc" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">对象有事件的细节。我们应该可以看到<code class="fe jn jo jp jq b">event</code>对象的<code class="fe jn jo jp jq b">type</code>属性是<code class="fe jn jo jp jq b">'visibilitychange’</code>。</p><h1 id="a800" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">onanimationcancel</h1><p id="4ef1" class="pw-post-body-paragraph kh ki iq kj b kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le ij bi translated">通过<code class="fe jn jo jp jq b">onanimationcancel</code>事件，我们可以在<code class="fe jn jo jp jq b">animationcancel</code>事件发生时附加一个事件处理程序，也就是当CSS动画意外中止时，比如当我们停止运行动画而没有触发<code class="fe jn jo jp jq b">animationend</code>事件时，这可能发生在动画名称被更改、动画被删除，或者当它直接或通过CSS中的更改被隐藏时。<code class="fe jn jo jp jq b">onanimationcancel</code>仅在Firefox中触发。例如，如果我们有以下HTML代码来创建一个框和一个隐藏该框的按钮:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="9860" class="mq lg iq jq b gy mr ms l mt mu">&lt;button id='hide-button'&gt;<br/>  Hide Box<br/>&lt;/button&gt;</span><span id="df6c" class="mq lg iq jq b gy mv ms l mt mu">&lt;div id='container'&gt;<br/>  &lt;div id='box'&gt;</span><span id="27a0" class="mq lg iq jq b gy mv ms l mt mu">  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="9cb1" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后，我们添加以下CSS来设置盒子的样式，并将大小更改为100 x 100像素，并创建动画:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="e127" class="mq lg iq jq b gy mr ms l mt mu">#box {<br/>  width: 100px;<br/>  height: 100px;<br/>  left: 0;<br/>  top: 0;<br/>  border: 1px solid red;<br/>  margin: 0;<br/>  position: relative;<br/>  background-color: red;<br/>  display: block;<br/>  justify-content: center;<br/>  animation: 5s slideBox;<br/>}</span><span id="ea76" class="mq lg iq jq b gy mv ms l mt mu">#container {<br/>  height: 500px;<br/>}</span><span id="af4d" class="mq lg iq jq b gy mv ms l mt mu"><a class="ae kg" href="http://twitter.com/keyframes" rel="noopener ugc nofollow" target="_blank">@keyframes</a> slideBox {<br/>  from {<br/>    left: 0;<br/>    top: 0;<br/>  }</span><span id="5bc0" class="mq lg iq jq b gy mv ms l mt mu">  to {<br/>    left: calc(100% - 100px);<br/>    top: calc(100% - 100px)<br/>  }<br/>}</span></pre><p id="b6bd" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在上面的CSS中，最初我们把盒子放在页面的左上角，并用红色填充。我们有<code class="fe jn jo jp jq b">slideBox</code>动画序列，通过在每一帧中向右滑动100个像素和向下滑动100个像素，从页面的左上角到右下角喜爱这个框。</p><p id="d506" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后，我们添加以下JavaScript代码:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="b604" class="mq lg iq jq b gy mr ms l mt mu">const hideButton = document.getElementById('hide-button');<br/>const box = document.getElementById('box');</span><span id="76df" class="mq lg iq jq b gy mv ms l mt mu">document.onanimationcancel = () =&gt; {<br/>  console.log('Animation cancelled unexpectedly');<br/>};</span><span id="46cc" class="mq lg iq jq b gy mv ms l mt mu">hideButton.onclick = () =&gt; {<br/>  box.style.display = 'none';<br/>}</span></pre><p id="fc62" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后，当我们点击“隐藏框”按钮，然后我们得到“动画意外取消”记录在Firefox中。当点击“隐藏框”按钮时，不会触发<code class="fe jn jo jp jq b">animationcancel</code>事件，所以它似乎没有跨浏览器的一致实现。</p><figure class="mi mj mk ml gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi mw"><img src="../Images/71d6a39a605e88e2f51a0258d7dd77b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z_d5B3JeSJ0GF2Fy"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Photo by <a class="ae kg" href="https://unsplash.com/@steveroe_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Steven Roe</a> on <a class="ae kg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7db4" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">onanimationend</h1><p id="e407" class="pw-post-body-paragraph kh ki iq kj b kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le ij bi translated"><code class="fe jn jo jp jq b">onanimationend</code>属性是一个属性，我们可以将它的值设置为一个事件处理函数，该函数在<code class="fe jn jo jp jq b">animationend</code>事件被触发时被触发。当CSS动画达到其活动周期的末尾时触发，活动周期是动画持续时间的总和乘以动画迭代次数和动画延迟。例如，如果我们有以下HTML代码:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="24d2" class="mq lg iq jq b gy mr ms l mt mu">&lt;div id='container'&gt;<br/>  &lt;div id='box'&gt;</span><span id="a3c0" class="mq lg iq jq b gy mv ms l mt mu">  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="d1be" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后，我们添加以下CSS来设置盒子的样式，并将大小更改为100 x 100像素，并创建动画:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="1965" class="mq lg iq jq b gy mr ms l mt mu">#box {<br/>  width: 100px;<br/>  height: 100px;<br/>  left: 0;<br/>  top: 0;<br/>  border: 1px solid red;<br/>  margin: 0;<br/>  position: relative;<br/>  background-color: red;<br/>  display: block;<br/>  justify-content: center;<br/>  animation: 5s slideBox;<br/>}</span><span id="ec3a" class="mq lg iq jq b gy mv ms l mt mu">#container {<br/>  height: 500px;<br/>}</span><span id="810e" class="mq lg iq jq b gy mv ms l mt mu"><a class="ae kg" href="http://twitter.com/keyframes" rel="noopener ugc nofollow" target="_blank">@keyframes</a> slideBox {<br/>  from {<br/>    left: 0;<br/>    top: 0;<br/>  }</span><span id="ebd9" class="mq lg iq jq b gy mv ms l mt mu">  to {<br/>    left: calc(100% - 100px);<br/>    top: calc(100% - 100px)<br/>  }<br/>}</span></pre><p id="f7bb" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在上面的CSS中，最初我们把盒子放在页面的左上角，并用红色填充。我们有<code class="fe jn jo jp jq b">slideBox</code>动画序列，通过在每一帧中向右滑动100像素和向下滑动100像素，从页面的左上角到右下角爱上这个盒子。</p><p id="aa74" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后，我们可以添加以下JavaScript代码，通过我们的<code class="fe jn jo jp jq b">onanimationend</code>事件处理程序记录<code class="fe jn jo jp jq b">animationend</code>事件:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="ee0a" class="mq lg iq jq b gy mr ms l mt mu">const box = document.getElementById('box');</span><span id="29d6" class="mq lg iq jq b gy mv ms l mt mu">document.onanimationend = () =&gt; {<br/>  console.log('Animation ended');<br/>};</span></pre><p id="d22f" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">注意这个事件处理程序只在Firefox上工作，因为这个事件的实现还没有被标准化，所以我们不应该期望这个事件被触发和事件处理函数被调用。</p><h1 id="6b10" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">onanimationiteration</h1><p id="925d" class="pw-post-body-paragraph kh ki iq kj b kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le ij bi translated">为了在CSS动画运行时做一些事情，我们可以通过给属性分配一个事件处理函数来使用<code class="fe jn jo jp jq b">onanimationiteration</code>属性。当<code class="fe jn jo jp jq b">animationiteration</code>事件被触发时，我们分配给这个属性的事件处理程序将被调用。</p><p id="fbfb" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">当CSS动画的一次迭代结束，另一次迭代开始时，触发<code class="fe jn jo jp jq b">animationiteration</code>。</p><p id="dac1" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">该事件不会与<code class="fe jn jo jp jq b">animationend</code>事件同时触发，如果动画迭代计数为1，它也不会被触发。如果我们设置正在被动画化的元素的<code class="fe jn jo jp jq b">animation-iteration-count</code>属性，使元素重复动画化，那么这个事件将被触发。例如，如果我们在HTML代码中有和以前一样的box <code class="fe jn jo jp jq b">div</code>元素:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="7b45" class="mq lg iq jq b gy mr ms l mt mu">&lt;div id='container'&gt;<br/>  &lt;div id='box'&gt;</span><span id="bf21" class="mq lg iq jq b gy mv ms l mt mu">  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="c495" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">但是我们通过添加<code class="fe jn jo jp jq b">animation-iteration-count</code>属性来改变CSS代码:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="7a05" class="mq lg iq jq b gy mr ms l mt mu">#box {<br/>  width: 100px;<br/>  height: 100px;<br/>  left: 0;<br/>  top: 0;<br/>  border: 1px solid red;<br/>  margin: 0;<br/>  position: relative;<br/>  background-color: red;<br/>  display: block;<br/>  justify-content: center;<br/>  animation: 5s slideBox;<br/>  animation-iteration-count: 5;<br/>}</span><span id="4cf8" class="mq lg iq jq b gy mv ms l mt mu">#container {<br/>  height: 500px;<br/>}</span><span id="3ab3" class="mq lg iq jq b gy mv ms l mt mu"><a class="ae kg" href="http://twitter.com/keyframes" rel="noopener ugc nofollow" target="_blank">@keyframes</a> slideBox {<br/>  from {<br/>    left: 0;<br/>    top: 0;<br/>  }</span><span id="36c8" class="mq lg iq jq b gy mv ms l mt mu">  to {<br/>    left: calc(100% - 100px);<br/>    top: calc(100% - 100px)<br/>  }<br/>}</span></pre><p id="6656" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后切换JavaScript代码，使用以下代码将事件处理程序设置为<code class="fe jn jo jp jq b">onanimationiteration</code>属性:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="2134" class="mq lg iq jq b gy mr ms l mt mu">const box = document.getElementById('box');</span><span id="0c2e" class="mq lg iq jq b gy mv ms l mt mu">let iterationCount = 0;</span><span id="3dce" class="mq lg iq jq b gy mv ms l mt mu">document.onanimationiteration = () =&gt; {<br/>  console.log('Animation is running');<br/>  iterationCount++;;<br/>  console.log(iterationCount);<br/>};</span></pre><p id="ad71" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后在Firefox中，我们应该看到以下记录:</p><pre class="mi mj mk ml gt mm jq mn mo aw mp bi"><span id="86c7" class="mq lg iq jq b gy mr ms l mt mu">Animation is running</span><span id="b5d0" class="mq lg iq jq b gy mv ms l mt mu">1</span><span id="18ab" class="mq lg iq jq b gy mv ms l mt mu">Animation is running</span><span id="fd14" class="mq lg iq jq b gy mv ms l mt mu">2</span><span id="f418" class="mq lg iq jq b gy mv ms l mt mu">Animation is running</span><span id="980b" class="mq lg iq jq b gy mv ms l mt mu">3</span><span id="46fd" class="mq lg iq jq b gy mv ms l mt mu">Animation is running</span><span id="5b90" class="mq lg iq jq b gy mv ms l mt mu">4</span></pre><p id="f531" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我们看到每次动画运行时<code class="fe jn jo jp jq b">iterationCount</code>的值增加1，所以事件处理程序由火狐中的<code class="fe jn jo jp jq b">animationiteration</code>事件触发运行。这个事件是一个实验性的事件，只是到目前为止在火狐中才有，和我们看到的其他动画事件一样，这是一个正在进行的工作。</p><p id="1940" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><code class="fe jn jo jp jq b">onvisibilitychange</code>是当<code class="fe jn jo jp jq b">visibilitychange</code>事件被触发并到达物体时运行的事件处理程序。这是一个标准事件，适用于大多数现代浏览器。</p><p id="71d9" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">当从它开始的页面不可见时，我们可以用它来记录情况，反之亦然。</p><p id="04fa" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后我们看了非标准的<code class="fe jn jo jp jq b">onanimationcancel</code>、<code class="fe jn jo jp jq b">onanimationend</code>和<code class="fe jn jo jp jq b">onanimationiteration</code>，它们只有在和Firefox一起使用时才会被触发。</p><p id="0df0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">其他浏览器不运行这些事件处理程序，我们可以推断相应的<code class="fe jn jo jp jq b">animationcancel</code>、<code class="fe jn jo jp jq b">animationend</code>和<code class="fe jn jo jp jq b">animationiteration</code>事件没有被触发。</p><p id="0e47" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">这些事件仅在CSS动画期间当动画意外取消时才会在火狐上触发，比如当动画结束时被动画元素突然移除，以及当动画重复时。</p></div></div>    
</body>
</html>