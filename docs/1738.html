<html>
<head>
<title>Fixing the “can’t resolve all parameters” exception with Angular DI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用角度DI修复“无法解析所有参数”异常</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/fixing-the-cant-resolve-all-parameters-exception-with-angular-di-1091af1b080?source=collection_archive---------1-----------------------#2020-04-18">https://javascript.plainenglish.io/fixing-the-cant-resolve-all-parameters-exception-with-angular-di-1091af1b080?source=collection_archive---------1-----------------------#2020-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8ffa" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">昨天，在应用程序中实现一个新服务时，我偶然发现了一个令人困惑的问题</h2></div><p id="beaf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将解释它是什么以及如何解决它…</p><h1 id="9522" class="lb lc iq bd ld le lf lg lh li lj lk ll jw lm jx ln jz lo ka lp kc lq kd lr ls bi translated">问题是</h1><p id="145a" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">创建角度服务是我经常做的事情，不会忘记如何做。正如我在上一篇文章中所解释的，我通常更喜欢为我的服务定义接口和实现。</p><p id="c2a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">多亏了一个<a class="ae ly" href="https://angular.io/api/core/InjectionToken" rel="noopener ugc nofollow" target="_blank">注入器</a>允许我注入接口，但更重要的是，在我的测试中很容易模拟出依赖关系。我并不是说这是不可能的，但是我发现这种方法更加简洁明了。</p><p id="d719" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这正是我所做的，只是意识到在应用程序启动期间出现了依赖注入错误。显然，安格尔找不到我新定义的服务。很奇怪，因为我只是用了同样的方法。</p><p id="32b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">错误如下所示:</p><p id="bc68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无法解析QuillConfigurationDirective的所有参数:[对象对象]，(？).</p><p id="847e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">(？)表示Angular无法解析构造函数的第二个参数:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2bb9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像往常一样，我在使用Angular的<a class="ae ly" href="https://angular.io/api/core/inject" rel="noopener ugc nofollow" target="_blank"> Inject </a>装潢师的注射令牌。没有什么不寻常的事情…</p><p id="2738" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我检查了所有的东西。多次……但找不到原因。</p><p id="a372" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的注射令牌定义正确，将字符串映射到类型:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="0864" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的服务正确设置了<a class="ae ly" href="https://angular.io/api/core/Injectable" rel="noopener ugc nofollow" target="_blank">可注射</a>装饰器:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="219a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的模块的forRoot静态方法中正确声明了一个提供程序:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="31f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的应用程序的根模块中正确调用了forRoot方法:</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="9281" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那会是什么呢？？！</p><p id="90b3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很明显，错误在于上面的代码示例。</p><h1 id="9313" class="lb lc iq bd ld le lf lg lh li lj lk ll jw lm jx ln jz lo ka lp kc lq kd lr ls bi translated">快速(臭虫丑陋)的解决方法</h1><p id="742f" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">在花了一点时间试图了解根本原因后，我决定尝试其他的方法。</p><p id="3042" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过删除InjectionToken并简单地使用providen:root，问题确实得到了解决。</p><p id="eb15" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但这不是解决方案，只是一种变通方法。</p><p id="0499" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然，它给了我一个提示:问题实际上是在注射层面，无论是在“声明”方面，还是在注射方面。</p><h1 id="c769" class="lb lc iq bd ld le lf lg lh li lj lk ll jw lm jx ln jz lo ka lp kc lq kd lr ls bi translated">根本原因和正确的解决方案</h1><p id="6084" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">在谷歌了一会儿后，我偶然发现了下面的<a class="ae ly" href="https://stackoverflow.com/questions/37997824/exception-cant-resolve-all-parameters" rel="noopener ugc nofollow" target="_blank"> SO问题</a>，这(像往常一样)给了我解决方案:这是进口的问题！</p><p id="a329" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该错误确实是由我的核心模块中的以下导入引起的:</p><pre class="lz ma mb mc gt mg mh mi mj aw mk bi"><span id="f416" class="ml lc iq mh b gy mm mn l mo mp">import { CORE_QUILL_EDITOR_CONFIGURATION_SERVICE } from "@app/core";<br/>import { QuillEditorConfigurationServiceImpl } from "@app/core";</span></pre><p id="adbe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事情是模块中的<strong class="kh ir">元素应该使用属于同一个模块的元素的相对导入；它们永远不应该通过模块的公共API桶</strong>导入。</p><p id="8f9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个导入的问题是，如果依赖于服务的东西首先被加载到桶中(直接或不直接)，那么DI系统将会失败，因为服务还没有被声明，因此不能被解析…</p><p id="3e86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我被不正确的汽车进口咬了好几次，更普遍的是，被桶咬了。也难怪棱角队不再那么喜欢桶了(阿发克)。</p><p id="dff8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以最终，固定进口只是相对的:</p><pre class="lz ma mb mc gt mg mh mi mj aw mk bi"><span id="2ec7" class="ml lc iq mh b gy mm mn l mo mp">import { CORE_QUILL_EDITOR_CONFIGURATION_SERVICE } from "./services/quill-editor-configuration.service.constants";<br/>import { QuillEditorConfigurationServiceImpl } from "./services/quill-editor-configuration.service";</span></pre><p id="f953" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从那以后，再也没有注射的问题了！唷。</p><p id="2de1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，此解决方案可能并不适用于所有情况。如果两个元素之间存在循环依赖，那么解决方案可能是使用一个<a class="ae ly" href="https://angular.io/api/core/forwardRef" rel="noopener ugc nofollow" target="_blank"> forwardRef </a>。</p><h1 id="25d5" class="lb lc iq bd ld le lf lg lh li lj lk ll jw lm jx ln jz lo ka lp kc lq kd lr ls bi translated">结论</h1><p id="e29c" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">在本文中，我们已经看到了导入问题有多隐蔽，造成了像这样难以理解的问题。</p><p id="fe55" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的总体建议是，总体上要非常小心进口和桶。不要盲目相信你的IDE不幸的是，有时它会在不应该的时候从桶中导入元素，从而产生问题。</p><p id="c6f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天到此为止！</p><p id="d1f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PS:如果你想学习大量关于TypeScript、Angular、React、Vue和其他酷主题的其他酷东西，那么不要犹豫<a class="ae ly" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">拿一本我的书</a>并订阅<a class="ae ly" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的简讯</a>！</p><h2 id="a812" class="ml lc iq bd ld mq mr dn lh ms mt dp ll ko mu mv ln ks mw mx lp kw my mz lr na bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="d21b" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物，表达对它们的爱:<a class="ae ly" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kh ir"/></a><a class="ae ly" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kh ir">UX</strong></a><a class="ae ly" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kh ir">Python</strong></a><strong class="kh ir"/>——谢谢，继续学习！</p><p id="3d6c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae ly" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir">submissions @ plain English . io</strong></a><strong class="kh ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/d54c503fed9baf4f4b8850d896a7cf8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RTc2DKWGdrFDLES_.png"/></div></div></figure></div></div>    
</body>
</html>