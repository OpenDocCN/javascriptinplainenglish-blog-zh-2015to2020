<html>
<head>
<title>Getting Started with Serverless Architectures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器架构入门</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-serverless-architectures-fortune-cookie-example-ae12071a7a79?source=collection_archive---------5-----------------------#2020-08-09">https://javascript.plainenglish.io/getting-started-with-serverless-architectures-fortune-cookie-example-ae12071a7a79?source=collection_archive---------5-----------------------#2020-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="34cd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">幸运饼干的例子</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9e50ec3492501d739783e6aa130bc078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZHTJYX73DF6dSVkhAoHJzA.gif"/></div></div></figure><p id="8e27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为什么要为简单的请求租用整个服务器呢？对于大多数网站来说，传统的服务器通常99%的时间都是空闲的，直到有人需要一些服务来执行。那么，为什么不具备只在需要时使用服务器的能力呢？这是为什么无服务器架构在最近的开发世界中被追求和推广的许多基本动机之一。</p><ul class=""><li id="48e3" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt ir">按需处理:</strong>你只需为处理你的请求的时间付费并使用服务器的资源。如果你的服务器每天只被利用了500毫秒，这就是你使用服务器的时间，这就是你被计费的时间。</li><li id="a60e" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir">减少路由开销:</strong>像AWS这样的无服务器提供商拥有web界面，可以非常详细地配置您的无服务器端点。这减少了您通常必须为自己设置的服务器执行的大量路由开销。</li><li id="a900" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir">强制模块化:</strong>无服务器架构是一组可以被调用的小模块。这为您提供了一个可以很好伸缩的模块化开发架构。</li></ul><p id="d3ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">了解了好处之后，让我们对我使用无服务器架构编写的幸运cookie示例进行案例研究。我将使用AWS作为无服务器架构提供商。</p><p id="8479" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成案例研究后，您应该对如何开发无服务器架构并将其连接到您的前端应用程序有了深入的了解。</p><p id="419c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mb">本案例研究假设您对AWS有所了解。我将尽力解释AWS无服务器架构设置的所有步骤。源代码可以在</em><a class="ae mc" href="http://github.com/ahmedsakr/fortune-cookie-serverless" rel="noopener ugc nofollow" target="_blank"><em class="mb">http://github.com/ahmedsakr/fortune-cookie-serverless</em></a>查看</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi md"><img src="../Images/27709e26d1edef9a2a49fce087fedec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZQqQFLWJLJtPX5YZLGooQ.png"/></div></div></figure><h1 id="c19d" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">什么是λ？</h1><p id="cfde" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la my lc ld le mz lg lh li na lk ll lm ij bi translated">Lambdas是无服务器架构的支柱。把lambdas看作是你的服务器(少)后端的独立部分。它们只是JavaScript程序，被执行来完成一个明确定义的任务。在我们的用例中，我为我的无服务器架构定义了1 lambda，它在每次被调用时都会抛出不同的运气！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="819b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">λ实现非常简单:它从一组预定义的运气中返回一个随机的运气。你的lambdas可以是执行复杂操作的非常复杂的程序:图像上传/下载、注册/登录用户、数据库操作等等。</p><h1 id="d121" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">整个画面</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/36584c0fa4796ff3fa38de71d7265262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pl6QiI54Cw0ueweSmZiDjw.png"/></div></div></figure><p id="210d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个幸运cookie应用程序不仅仅显示它存储在客户端的字符串列表。它调用一个跨源AWS lambda，请求它给它一笔财富，等待它做出响应，然后将响应显示给用户。</p><p id="9f20" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在深入了解所有3个阶段的细节之前，让我们先大致了解一下使用案例:</p><ul class=""><li id="33c1" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt ir">用户点击“请求发财”。</strong>调用JavaScript处理程序向AWS API网关端点发送HTTP GET。</li><li id="9d2b" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir"> API网关调用</strong> <code class="fe nd ne nf ng b"><strong class="kt ir">requestFortune</strong></code> <strong class="kt ir"> lambda(函数)</strong>。这部分完全可以通过AWS web界面进行配置。</li><li id="e38f" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir"> Lambda返回一笔财富给JavaScript处理程序。</strong>JavaScript处理程序接收响应体中的财富，并将其显示在页面上。</li></ul><p id="e7e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在实现无服务器架构的过程中，每一个环节都扮演着重要的角色。让我们研究一下我是如何连接每个阶段来完成无服务器架构的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/2927a51b0ff64e1180835ef224c52468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNi7jNeh9PSfzS26KMwsLw.png"/></div></div></figure><h1 id="2574" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated"><strong class="ak">分派HTTP方法</strong></h1><p id="6eee" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la my lc ld le mz lg lh li na lk ll lm ij bi translated">如果您曾经编写过与express服务器交互的前端应用程序，或者使用过REST APIs，那么您应该对此很熟悉。从服务器迁移到无服务器架构时，设计方面没有任何变化。</p><p id="65ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是点击“请求财富”时调用的处理程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="56a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个<strong class="kt ir"> HTTP GET </strong>方法被发送到AWS API网关端点，该端点公开了我们前面讨论过的<code class="fe nd ne nf ng b">requestFortune</code> lambda。一旦得到响应，它就用响应中收到的数据替换<code class="fe nd ne nf ng b">fortune-text</code>元素！</p><p id="8128" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就完成了客户端显示运气的逻辑。现在我们需要讨论如何将lambda上传到AWS，并从API网关执行，该网关提供一个端点，如上面的<code class="fe nd ne nf ng b">fortune.js</code>所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/067e05b151dfc04012d6ae2fddd80705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQkfzK7XU-nV8dw1beEZYw.png"/></div></div></figure><h1 id="6d5b" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">将lambda上传到AWS</h1><p id="0a21" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la my lc ld le mz lg lh li na lk ll lm ij bi translated">我使用了<code class="fe nd ne nf ng b">serverless</code> npm包将你的lambda上传到AWS。这是我用来配置幸运cookie lambda的yml文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0723" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个YAML文件指定了指导AWS如何构建我的CloudFormation堆栈的某些配置。如果您对此不熟悉，不要担心，因为没有必要理解无服务器架构。你所要做的就是将lambda文件上传到AWS供我们调用。</p><h1 id="ca69" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">创建和配置API网关</h1><p id="9893" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la my lc ld le mz lg lh li na lk ll lm ij bi translated">现在我们的lambda在AWS上可用了，我们希望向API网关端点公开它的用法，类似于上面<code class="fe nd ne nf ng b">fortune.js</code>中使用的那个。</p><p id="1005" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用API网关接口，我创建了一个支持GET方法的REST API。我链接了我新上传的lambda，以便在REST API收到GET请求时调用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/e20eb806b0719a67a9feb42f554840e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOQAKdP4X67zxDaz5_4-bg.png"/></div></div></figure><p id="5fd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成后，我部署了我的API，并收到了以下端点，HTTP GET方法可以发送到该端点以调用lambda:</p><pre class="kg kh ki kj gt nj ng nk nl aw nm bi"><span id="2c4a" class="nn mf iq ng b gy no np l nq nr"><a class="ae mc" href="https://a9vymko126.execute-api.ca-central-1.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank">https://a9vymko126.execute-api.ca-central-1.amazonaws.com/test</a></span></pre><h1 id="27f9" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated"><strong class="ak">就这样！我的项目现在没有服务器了！</strong></h1><p id="681b" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la my lc ld le mz lg lh li na lk ll lm ij bi translated">我的lambda现在是通过API gateway部署的，我有一个REST API url，我可以发送GET请求来接收fortune作为响应。</p><p id="954b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了这些设置，我现在:</p><ul class=""><li id="a802" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">只有当有人为了财富而调用lambda时才运行服务器</li><li id="d3db" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">只为lambda执行所花费的时间付费。</li></ul><p id="bf6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是在申请多种运气后的网络选项卡:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/f26a8c07fc117b5e310ce84264e0d0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VAxtiCywYZrKERo8ZWeQLw.png"/></div></div></figure><p id="934b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">平均来说，我的应用程序只需要<strong class="kt ir"> 30毫秒</strong>就可以从lambda发送一个财富请求！这不是很棒吗？</p><p id="e689" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最棒的是AWS每月为<strong class="kt ir">提供100万次免费的lambda调用。</strong>对于使用服务器资源的应用程序，您甚至不需要支付任何费用。</p></div></div>    
</body>
</html>