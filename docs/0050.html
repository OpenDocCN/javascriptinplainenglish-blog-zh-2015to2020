<html>
<head>
<title>Demystifying mapStateToProps for beginners to React and Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭秘mapStateToProps，供初学者反应和还原</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/demystifying-mapstatetoprops-for-beginners-to-react-and-redux-27136721a3c6?source=collection_archive---------4-----------------------#2018-11-19">https://javascript.plainenglish.io/demystifying-mapstatetoprops-for-beginners-to-react-and-redux-27136721a3c6?source=collection_archive---------4-----------------------#2018-11-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e167" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">从我自己的教学经验来看，<code class="fe kc kd ke kf b">mapStateToProps</code>和<code class="fe kc kd ke kf b">connect</code>的概念对于初学者来说是最难理解和重复的。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/c74b754c9e031d45600231af58667f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCSXAi9OnqytvWiiuw5O0A.png"/></div></div></figure><p id="dccd" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io">TLDR；去看看Dan Abramov在connect.js 上的<a class="ae lo" href="https://gist.github.com/gaearon/1d19088790e70ac32ea636c025ba424e" rel="noopener ugc nofollow" target="_blank">解释。</a></strong></p><h2 id="12fc" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">介绍</h2><p id="d69c" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated"><code class="fe kc kd ke kf b">mapStateToProps</code>是一个函数。<code class="fe kc kd ke kf b">connect</code>是高阶成分。那有帮助吗？可能不会，但请记住这一点。至少这一个:</p><blockquote class="mn mo mp"><p id="ae3b" class="ks kt mq ku b kv kw jo kx ky kz jr la mr lc ld le ms lg lh li mt lk ll lm ln ig bi translated"><code class="fe kc kd ke kf b">mapStateToProps</code>是一个函数。</p></blockquote><h2 id="ceea" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">使用</h2><p id="d5b7" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">如果你正在学习React和Redux，你可能已经见过很多次了:</p><pre class="kh ki kj kk gt mu kf mv mw aw mx bi"><span id="c1e6" class="lp lq in kf b gy my mz l na nb">export default connect(mapStateToProps)(MyComponent);</span></pre><p id="6e40" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们把它分解成更小的代码片段和一些伪代码。</p><pre class="kh ki kj kk gt mu kf mv mw aw mx bi"><span id="3e2a" class="lp lq in kf b gy my mz l na nb">const ConnectedComponent = connect(mapStateToProps)(MyComponent);<br/>export default ConnectedComponent;</span></pre><p id="20d9" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">首先，<code class="fe kc kd ke kf b">connect</code>创建一个新的React组件，它是导出的组件。</p><pre class="kh ki kj kk gt mu kf mv mw aw mx bi"><span id="8a2c" class="lp lq in kf b gy my mz l na nb">import MyComponent from './MyComponent';</span><span id="cb67" class="lp lq in kf b gy nc mz l na nb">//...<br/>&lt;MyComponent test="hello" /&gt;</span></pre><p id="06c9" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里要记住的最重要的事情是，即使你从<code class="fe kc kd ke kf b">./MyComponent</code>导入，你也没有使用你直接编写的组件。您实际上正在使用<code class="fe kc kd ke kf b">connect</code>创建的组件:<code class="fe kc kd ke kf b">ConnectedComponent</code>。</p><h2 id="663f" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">说明</h2><p id="7623" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">这个新组件有什么特别之处？通过添加额外的道具来表演一些魔术。</p><p id="1423" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">当你使用<code class="fe kc kd ke kf b">&lt;MyComponent test="hello" /&gt;</code>时，你实际上是在做<code class="fe kc kd ke kf b">&lt;ConnectedComponent test="hello" /&gt;</code>。您的<code class="fe kc kd ke kf b">MyComponent</code>正在<code class="fe kc kd ke kf b">ConnectedComponent</code>内部使用:</p><pre class="kh ki kj kk gt mu kf mv mw aw mx bi"><span id="910c" class="lp lq in kf b gy my mz l na nb"><em class="mq">// in the ConnectedComponent</em><br/>render() {<br/><em class="mq">  // This is NOT how actually works. Keep up with me for now.</em><br/>  return &lt;MyComponent { ...this.props } /&gt;;<br/>}</span></pre><p id="3dc1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">一旦清楚了你创建的组件<code class="fe kc kd ke kf b">MyComponent</code>实际上在别的地方被使用，我们就可以使用一些魔法了。有趣的是，在<code class="fe kc kd ke kf b">ConnectedComponent</code>中，我们可以访问一些东西:</p><ul class=""><li id="ef93" class="nd ne in ku b kv kw ky kz lb nf lf ng lj nh ln ni nj nk nl bi translated"><code class="fe kc kd ke kf b">store</code>:Redux店。也就是说，我们可以访问<code class="fe kc kd ke kf b">getState</code>。</li><li id="645c" class="nd ne in ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><code class="fe kc kd ke kf b">mapStateToProps</code>:您在创建<code class="fe kc kd ke kf b">ConnectedComponent</code>时使用的函数。</li></ul><p id="da81" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们使用它们:</p><pre class="kh ki kj kk gt mu kf mv mw aw mx bi"><span id="8ada" class="lp lq in kf b gy my mz l na nb"><em class="mq">// in the ConnectedComponent</em><br/>render() {<br/><em class="mq">  // as stated above, we have access to the Redux Store</em><br/>  const reduxState = store.getState();<br/><em class="mq">  // Here comes the cool part!</em><br/>  const moreProps = mapStateToProps(reduxState, this.props);<br/><em class="mq">  // The return value of the FUNCTION `mapStateToProps` will be   passed as props to the component.</em><br/>  return &lt;MyComponent { ...this.props } { ...moreProps } /&gt;;<br/>}</span></pre><p id="0454" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在<code class="fe kc kd ke kf b">ConnectedComponent</code>内部，我们传递给<code class="fe kc kd ke kf b">connect</code>的函数<code class="fe kc kd ke kf b">mapStateToProps</code>正在被使用。参数为Redux状态，道具传递给<code class="fe kc kd ke kf b">ConnectedComponent</code>。在这种情况下是<code class="fe kc kd ke kf b">{ test: 'hello' }</code>。</p><p id="cbcb" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><code class="fe kc kd ke kf b">mapStateToProps</code>的重要部分是返回值。它返回的值将作为道具传递给<code class="fe kc kd ke kf b">MyComponent</code>。这就是为什么<code class="fe kc kd ke kf b">mapStateToProps</code>的返回值需要是一个对象。</p><h2 id="13f4" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">结论</h2><p id="9840" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">使用<code class="fe kc kd ke kf b">connect</code>创建一个新组件。这就是它被称为高阶元件的原因。</p><p id="7020" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这个新组件调用我们的<code class="fe kc kd ke kf b">mapStateToProps</code>函数和我们传递给<code class="fe kc kd ke kf b">connect</code>的<code class="fe kc kd ke kf b">MyComponent</code>。</p><p id="dbd8" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这个新的<code class="fe kc kd ke kf b">ConnectedComponent</code>可以访问Redux存储，这就是为什么它可以使用<code class="fe kc kd ke kf b">getState</code>来获取状态，并在调用我们的<code class="fe kc kd ke kf b">mapStateToProps</code>函数时传递它。</p><h2 id="0dbb" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">警告</h2><p id="3cac" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">这个解释没有涉及到<code class="fe kc kd ke kf b">connect</code>的第二个参数，这个参数叫做<code class="fe kc kd ke kf b">mapDispatchToProps</code>。也不是对<code class="fe kc kd ke kf b">connect</code>的完整解释。</p><p id="e7a5" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如需进一步解释，请查看本文开头提到的丹·阿布拉莫夫的解释。是<code class="fe kc kd ke kf b">connect</code>的终极解释。一旦你理解了这一点，你就可以开始了。</p><p id="d98f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io">感谢阅读，快乐编码！</strong></p><p id="9bdb" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果你喜欢这篇文章，可以考虑加入我在GIMTEC的时事通讯。</p><div class="nr ns gp gr nt nu"><a href="https://www.gimtec.io/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">GIMTEC</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">训练营后教育。我希望在我完成训练营时就拥有的每周时事通讯和课程。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">www.gimtec.io</p></div></div><div class="od l"><div class="oe l of og oh od oi kq nu"/></div></div></a></div></div></div>    
</body>
</html>