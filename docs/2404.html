<html>
<head>
<title>Unit Test your React app with Jest, Jest-dom &amp; Enzyme</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest、Jest-dom和Enzyme对React应用进行单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/are-you-not-testing-your-react-app-instantly-test-with-jest-enzyme-a-reactjs-2020-tutorial-e9ce0182d66d?source=collection_archive---------2-----------------------#2020-06-21">https://javascript.plainenglish.io/are-you-not-testing-your-react-app-instantly-test-with-jest-enzyme-a-reactjs-2020-tutorial-e9ce0182d66d?source=collection_archive---------2-----------------------#2020-06-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5291" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你曾经想测试你的React应用<em class="kl"> </em>却找不到时间来设置它？按照我将在本教程中向你展示的步骤，你也可以像专业人士一样立即开始测试你的应用程序。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/af911cdcdf0178d090881ab34fd1e968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3G6HTZ9h3HcVBi08pSyH2A.gif"/></div></div></figure><p id="7da1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就最终结果而言。我们将构建这个自定义计算器组件，并对其进行测试；</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ky"><img src="../Images/fc6f14a211e68dab93a8be0d83ae6936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbdmoU7vklJ20ynYAdIcCA.png"/></div></div></figure><p id="a3e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是Jest？</strong></p><div class="kz la gp gr lb lc"><a href="https://github.com/facebook/jest" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd ir gy z fp lh fr fs li fu fw ip bi translated">脸书/杰斯特</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">令人愉快的JavaScript测试。在GitHub上创建一个帐户，为脸书/jest的发展做出贡献。</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">github.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq kw lc"/></div></div></a></div><p id="a0f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jest是一个JavaScript单元测试框架。它可以用于任何JavaScript项目。你正在做一个打字项目吗，点击这里查看我的Jest TS文章<a class="ae lr" href="https://medium.com/react-courses/unit-testing-react-typescript-app-with-jest-jest-dom-enzyme-11f52487aa18" rel="noopener"/>。</p><p id="9e21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jest是测试运行器、断言库和模拟库，如果需要的话，还可以提供快照。</p><ul class=""><li id="3b11" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">开发者就绪:全面的JavaScript测试解决方案。适用于大多数JavaScript项目。</li><li id="dc19" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">即时反馈:快速、交互式的观察模式只运行与更改的文件相关的测试文件。</li><li id="7d3b" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">快照测试:捕获大型对象的快照，以简化测试并分析它们如何随时间变化。</li></ul><p id="af3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">笑话文件:<a class="ae lr" href="https://jestjs.io/docs/en/tutorial-react" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/tutorial-react</a></p><p id="1726" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是Jest-dom </strong></p><p id="a2d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b"><a class="ae lr" href="https://github.com/testing-library/jest-dom" rel="noopener ugc nofollow" target="_blank">jest-dom</a></code>是一个使用自定义匹配来扩展Jest的库，使得对DOM元素的断言更加容易。</p><p id="7274" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">jest-dom 不需要使用React测试库，但是它使得编写我们的测试更加方便。</p><p id="a324" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">jest-DOM doc:<a class="ae lr" href="https://noriste.github.io/reactjsday-2019-testing-course/book/intro-to-react-testing/jest-dom.html" rel="noopener ugc nofollow" target="_blank">https://no riste . github . io/react jsday-2019-testing-course/book/intro-to-react-testing/jest-DOM . html</a></p><p id="4d23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">酶是什么？</strong></p><div class="kz la gp gr lb lc"><a href="https://github.com/enzymejs/enzyme" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd ir gy z fp lh fr fs li fu fw ip bi translated">酶/酶</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">React的JavaScript测试实用程序。在GitHub上创建一个帐户，为enzymejs/enzyme development做出贡献。</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">github.com</p></div></div><div class="ll l"><div class="mk l ln lo lp ll lq kw lc"/></div></div></a></div><p id="543b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Enzyme是一个JavaScript测试实用程序<strong class="jp ir">，专为React </strong>而构建，使测试React组件的输出变得更加容易。您还可以操纵、遍历和以某种方式模拟给定输出的运行时。</p><p id="6431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Enzyme的API旨在通过模仿jQuery的DOM操作和遍历API来实现直观和灵活。</p><blockquote class="ml mm mn"><p id="5228" class="jn jo kl jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">注意:酵素可以不用Jest，但是需要搭配其他单元测试框架。</p></blockquote><p id="eb70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酶文档:<a class="ae lr" href="https://airbnb.io/enzyme/docs/api/" rel="noopener ugc nofollow" target="_blank">https://airbnb.io/enzyme/docs/api/</a></p><h1 id="607a" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">您为什么要学习Jest &amp;酵素？</h1><p id="f306" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">Jest + Jest-dom +酶+ React =在您的React项目中完成测试能力</p><p id="9ec7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jest和酶很好地结合在一起，提供灵活和创造性的测试能力。</p><p id="7abf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是一些有趣的事实:</p><ol class=""><li id="a11c" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk nu ly lz ma bi translated">脸书使用Jest测试服务和反应应用程序。</li><li id="5312" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk nu ly lz ma bi translated"><a class="ae lr" href="https://medium.com/react-courses/follow-this-tutorial-and-become-a-react-developer-in-5-minutes-a-2020-tutorial-e3709513b51e" rel="noopener">Create-reaction-App</a>与Jest &amp;一起上市；它不需要单独安装。</li><li id="74d5" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk nu ly lz ma bi translated">酶工具由Airbnb创建</li></ol><blockquote class="ml mm mn"><p id="d273" class="jn jo kl jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">如果您认为测试既昂贵又耗时？不测试会花费，但从长远来看，可能会花费更多。</p></blockquote><p id="5322" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您知道吗，质量保证和软件测试公司QualiTest对1000多名美国人进行的一项调查表明，如果遇到错误或小故障，88%的人会放弃应用程序？</p><ul class=""><li id="d631" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">大约51%的人说，如果他们每天至少遇到一个臭虫，他们可能会完全停止使用一个应用程序。</li><li id="ec20" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">32%的受访者表示，他们可能会在遇到小故障时就放弃应用。</li></ul><h1 id="2bea" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">您如何学习Jest &amp;酵素？</h1><p id="cb31" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">为了帮助您理解Jest &amp;酶系统，我将本教程中的过程分解为三个步骤；</p><ul class=""><li id="0c14" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">第1步— <strong class="jp ir">设置。</strong>设置&amp;配置我们的项目</li><li id="3b6a" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">第2步— <strong class="jp ir">编写代码</strong>计算器自定义组件</li><li id="532d" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">第3步-<strong class="jp ir">检测代码</strong>。</li></ul><p id="a35e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想更好地理解我们正在使用的库，我也在教程的最后放了一些隐藏的东西。</p><h1 id="a0a0" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">我们开始吧</h1><p id="6ded" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">先决条件—</p><p id="c919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的教程认为你有一些反应知识。如果你不这样做，我有一篇文章让你对反应有一个基本的了解。</p><p id="e94c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那篇文章会让你很快振作起来。按照本教程中的步骤，使用<em class="kl"> create-react-app </em>在几分钟内获得一个React项目并实现功能；按照本教程&amp;在几分钟内成为ReactJS开发者-</p><div class="kz la gp gr lb lc"><a href="https://medium.com/react-courses/follow-this-tutorial-and-become-a-react-developer-in-5-minutes-a-2020-tutorial-e3709513b51e" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd ir gy z fp lh fr fs li fu fw ip bi translated">遵循本教程&amp;在几分钟内立即成为ReactJS开发人员——2020教程</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">如果您曾经想学习反应，但找不到时间或害怕它？按照我将要向你展示的步骤去做…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">medium.com</p></div></div><div class="ll l"><div class="nv l ln lo lp ll lq kw lc"/></div></div></a></div><h1 id="ff56" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">第1步-设置和配置我们的项目</h1><p id="d69d" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">让我们在终端建立我们的项目<code class="fe mg mh mi mj b">hello-jest-enzyme.</code>；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="4876" class="oa ms iq mj b gy ob oc l od oe">$ npx create-react-app hello-jest-enzyme<br/>$ cd hello-jest-enzyme</span></pre><p id="5e51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于酶，我们想安装React 16适配器(这是最新版本，我正在使用，但这可能会随着您阅读本文的时间而改变)，我们还需要安装<code class="fe mg mh mi mj b">react-test-renderer</code>以便我们可以将reactor组件渲染为纯JavaScript对象，而不依赖于DOM或本地移动环境，这将是有帮助的，因为我们将拍摄快照；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="b767" class="oa ms iq mj b gy ob oc l od oe">$ npm i enzyme enzyme-adapter-react-16 react-test-renderer --save-dev</span></pre><p id="0c91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用Jest的快照测试特性来自动将JSON树的副本保存到一个文件中，并检查我们的测试，它没有改变。在这里阅读更多关于这个特性:<a class="ae lr" href="https://reactjs.org/docs/test-renderer.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/test-renderer.html</a></p><p id="d44f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们想让我们的生活更容易，所以我们将安装<code class="fe mg mh mi mj b">enzyme-to-json</code>库；https://github.com/adriantoine/enzyme-to-json#readme:这样我们的代码可以被简化。查看我的引擎盖下部分了解更多详情。</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="76ce" class="oa ms iq mj b gy ob oc l od oe">$ npm i enzyme-to-json --save-dev</span></pre><p id="f3ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将创建我们想要测试的React组件；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="43fc" class="oa ms iq mj b gy ob oc l od oe">$ mkdir -p src/components<br/>$ touch src/components/Calculator.js<br/>$ touch src/components/Calculator.css</span></pre><p id="e667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的计算器，我将使用macOS内置的计算器作为我的图形与图像映射来映射每个键，所以我们把图像变成一个可点击的按钮。我将使用一个react-image-mapper，所以让我们也把它添加到我们的库中；</p><p id="3103" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">$ <code class="fe mg mh mi mj b">npm i react-image-mapper@latest --save</code></p><p id="4cee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酷，我们设置我们的项目并安装所有的库来开始我们的项目。✌️</p><h1 id="81d7" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">步骤2 —创建我们的定制组件</h1><p id="c60f" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">在代码级别，我正在创建一个计算器自定义组件。我所做的是截屏macOS计算器，然后使用一个在线工具映射(image-map.net)我的图像到一个可点击的地图区域。</p><p id="f8ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在设置一个状态来包含我的输出，这两个数字是我和操作员一起工作的。看一看；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="ee5e" class="oa ms iq mj b gy ob oc l od oe">// src/components/Calculator.js</span><span id="6ccf" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">import </strong>React, { Component } <strong class="mj ir">from </strong>"react";<br/><strong class="mj ir">import </strong>ImageMapper <strong class="mj ir">from </strong>'react-image-mapper';<br/><strong class="mj ir">import </strong>'./Calculator.css';</span><span id="fcce" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">export const </strong>URL = 'calculator.jpg';<br/><strong class="mj ir">export const </strong>MAP = {<br/>    name: "my-map",<br/>    areas: [<br/>        {<br/>            name: "0", shape: "rect", coords: [3,387,227,474]<br/>        },<br/>        {<br/>            name: "1", shape: "rect", coords: [2,291,112,382]<br/>        },<br/>        {<br/>            name: "2", shape: "rect", coords: [116,290,227,382]<br/>        },<br/>        {<br/>            name: "3", shape: "rect", coords: [342,382,232,290]<br/>        },<br/>        {<br/>            name: "4", shape: "rect", coords: [3,194,111,290]<br/>        },<br/>        {<br/>            name: "5", shape: "rect", coords: [115,193,227,290]<br/>        },<br/>        {<br/>            name: "6", shape: "rect", coords: [231,194,343,290]<br/>        },<br/>        {<br/>            name: "7", shape: "rect", coords: [4,97,111,191]<br/>        },<br/>        {<br/>            name: "8", shape: "rect", coords: [115,99,227,191]<br/>        },<br/>        {<br/>            name: "9", shape: "rect", coords: [231,98,343,191]<br/>        },<br/>        {<br/>            name: "+", shape: "rect", coords: [348,291,463,382]<br/>        },<br/>        {<br/>            name: "-", shape: "rect", coords: [348,195,463,290]<br/>        },<br/>        {<br/>            name: "*", shape: "rect", coords: [348,98,463,191]<br/>        },<br/>        {<br/>            name: "/", shape: "rect", coords: [348,3,463,93]<br/>        },<br/>        {<br/>            name: "=", shape: "rect", coords: [348,387,463,474]<br/>        }<br/>    ]<br/>}</span><span id="b002" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">export default class </strong>Calculator <strong class="mj ir">extends </strong>Component {</span><span id="216a" class="oa ms iq mj b gy of oc l od oe">    constructor(props) {<br/>        <strong class="mj ir">super</strong>(props)<br/>        <strong class="mj ir">this</strong>.state = {<br/>            output: 0,<br/>            operatorType: '',<br/>            number1: 0,<br/>            number2: -1<br/>        }<br/>    }</span><span id="78e0" class="oa ms iq mj b gy of oc l od oe">    startOver = () =&gt; {<br/>        <strong class="mj ir">this</strong>.setState({<br/>            operatorType: '',<br/>            number1: 0,<br/>            number2: -1,<br/>            output: 0<br/>        });<br/>    };</span><span id="e51e" class="oa ms iq mj b gy of oc l od oe">    calculateTwoNumbers = (num1, num2, operator) =&gt; {<br/>        <strong class="mj ir">let </strong>retVal = 0;<br/>        <strong class="mj ir">switch </strong>(operator) {<br/>            <strong class="mj ir">case </strong>'+':<br/>                retVal = num1 + num2;<br/>                <strong class="mj ir">break</strong>;<br/>            <strong class="mj ir">case </strong>'-':<br/>                retVal = num1 - num2;<br/>                <strong class="mj ir">break</strong>;<br/>            <strong class="mj ir">case </strong>'*':<br/>                retVal = num1 * num2;<br/>                <strong class="mj ir">break</strong>;<br/>            <strong class="mj ir">case </strong>'/':<br/>                retVal = num1 / num2;<br/>                <strong class="mj ir">break</strong>;<br/>            <strong class="mj ir">default</strong>:<br/>                alert('Operator not recognized');<br/>        }<br/>        <strong class="mj ir">return </strong>retVal;<br/>    }</span><span id="179e" class="oa ms iq mj b gy of oc l od oe">    clicked = (btnName) =&gt; {<br/>        <strong class="mj ir">switch </strong>(btnName) {<br/>            <strong class="mj ir">case </strong>'-':<br/>            <strong class="mj ir">case </strong>'*':<br/>            <strong class="mj ir">case </strong>'/':<br/>            <strong class="mj ir">case </strong>'+':<br/>                <strong class="mj ir">this</strong>.setState({<br/>                    operatorType: btnName,<br/>                    number1: (Number(<strong class="mj ir">this</strong>.state.output))<br/>                });<br/>                <strong class="mj ir">break</strong>;<br/>            <strong class="mj ir">case </strong>'=':<br/>                <strong class="mj ir">this</strong>.setState({<br/>                    output: <strong class="mj ir">this</strong>.calculateTwoNumbers(<strong class="mj ir">this</strong>.state.number1, Number(<strong class="mj ir">this</strong>.state.output), <strong class="mj ir">this</strong>.state.operatorType)<br/>                });<br/>                <strong class="mj ir">break</strong>;<br/>            <strong class="mj ir">default</strong>:<br/>                <strong class="mj ir">let </strong>isFirstDigitNumber2 = (<strong class="mj ir">this</strong>.state.operatorType &amp;&amp; <strong class="mj ir">this</strong>.state.number2 === -1);<br/>                <strong class="mj ir">this</strong>.setState({<br/>                    number2: isFirstDigitNumber2 ? 0 : <strong class="mj ir">this</strong>.state.number2,<br/>                    output: isFirstDigitNumber2 ? Number(btnName) : Number(<strong class="mj ir">this</strong>.state.output + btnName)<br/>                });<br/>        }<br/>    };</span><span id="af56" class="oa ms iq mj b gy of oc l od oe">    render() {<br/>        <strong class="mj ir">return </strong>(<br/>            &lt;div&gt;<br/>                &lt;a href="http://twitter.com/elieladelrom" className="follow"&gt;@elieladelrom&lt;/a&gt;<br/>                &lt;h1 className="title"&gt;{<strong class="mj ir">this</strong>.props.componentTitle} - Version #{<strong class="mj ir">this</strong>.props.version}&lt;/h1&gt;<br/>                &lt;p&gt;<br/>                    &lt;button onClick={<strong class="mj ir">this</strong>.startOver}&gt;Start Over&lt;/button&gt;<br/>                &lt;/p&gt;<br/>                &lt;div className="output" class="calculator-output"&gt;{<strong class="mj ir">this</strong>.state.output}&lt;/div&gt;<br/>                &lt;ImageMapper src={URL} map={MAP}<br/>                             onClick={area =&gt; <strong class="mj ir">this</strong>.clicked(area.name)}<br/>                /&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>}</span></pre><p id="03dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mg mh mi mj b">jsx</code>方面，我用我的twitter处理程序添加了一个div，这看起来像是无耻的自我推销，但除此之外，我想把它包括进来给你看一些测试。同样的按钮将允许我们重新开始，我们将设置一个标题作为道具。</p><p id="6ff9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<code class="fe mg mh mi mj b">CSS</code>，我正在创建一个类来格式化我的输出；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="3bba" class="oa ms iq mj b gy ob oc l od oe">// src/components/Calculator.css</span><span id="c98e" class="oa ms iq mj b gy of oc l od oe">.calculator-output<br/>{<br/>    background:url('/calculator-input.jpg') no-repeat right top;<br/>    color:#fff;<br/>    font-size:50px;<br/>    width: 464px;<br/>    height: 120px;<br/>    text-align: center;<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>}</span></pre><p id="9dec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要更新我们的App.js，以包含我们的自定义组件；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="f081" class="oa ms iq mj b gy ob oc l od oe">// src/App.js</span><span id="9190" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">import </strong>React <strong class="mj ir">from </strong>'react';<br/><strong class="mj ir">import </strong>'./App.css';<br/><strong class="mj ir">import </strong>Calculator <strong class="mj ir">from </strong>"./components/Calculator";</span><span id="a774" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">function </strong>App() {<br/>  <strong class="mj ir">return </strong>(<br/>    &lt;div className="App"&gt;<br/>      &lt;Calculator componentTitle={"Online Calculator"} version={"0.01-beta"}/&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="9a11" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">export default </strong>App;</span></pre><p id="2fab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这样，跑；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="dea6" class="oa ms iq mj b gy ob oc l od oe">$ npm start</span></pre><p id="4ada" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有一个基本的计算器😊。请注意，我没有映射所有的计算器键和功能，只是基本的，但是可以随意完成它们。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi og"><img src="../Images/842ab67c9daab8302f6cb5d417613b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*E7LVtpt83vtUX7zwrLx06A.gif"/></div></div></figure><h1 id="7805" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">步骤3 —测试代码</h1><p id="e35b" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">首先，我们将设置我们的测试环境，打开<code class="fe mg mh mi mj b">src/setupTests.js</code>:</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="05b5" class="oa ms iq mj b gy ob oc l od oe"><strong class="mj ir">// </strong>src/setupTests.js</span><span id="a833" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">import </strong>{ configure } <strong class="mj ir">from </strong>'enzyme';<br/><strong class="mj ir">import </strong>Adapter <strong class="mj ir">from </strong>'enzyme-adapter-react-16'</span><span id="a3e3" class="oa ms iq mj b gy of oc l od oe">configure({ adapter: <strong class="mj ir">new </strong>Adapter() });</span></pre><p id="85f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">快照测试你的酵素包</strong></p><p id="a757" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新您的<code class="fe mg mh mi mj b">package.json</code>:</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="5abf" class="oa ms iq mj b gy ob oc l od oe">// src/<!-- -->package.json<br/>..<br/>"jest": {<br/>  "snapshotSerializers": ["enzyme-to-json/serializer"]<br/>},<br/>..</span></pre><p id="2c5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我使用的是Create-React-App，所以不需要安装jest，它是现成的。另外，请注意，对于Enzyme，该命令反映了我们的React版本:enzyme-adapter-react-16。</p><p id="342f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe mg mh mi mj b">src/App.test.js </code> -我们在这里的测试是为了确保我们的组件包含在我们的应用程序中；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="3da5" class="oa ms iq mj b gy ob oc l od oe">// src/App.test.js</span><span id="e11c" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">import </strong>{ shallow } <strong class="mj ir">from </strong>"enzyme";<br/><strong class="mj ir">import </strong>Calculator <strong class="mj ir">from </strong>"./components/Calculator";</span><span id="c648" class="oa ms iq mj b gy of oc l od oe">test(‘should render Calculator’, () =&gt; {<br/>    <strong class="mj ir">const </strong>wrapper = shallow(&lt;App /&gt;);<br/>    <strong class="mj ir">const </strong>calculator = wrapper.find(Calculator);</span><span id="4384" class="oa ms iq mj b gy of oc l od oe">expect(calculator.exists()).toBe(<strong class="mj ir">true</strong>);<br/>})</span></pre><p id="1cee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要运行我们的测试，我们的模板项目已经配备了处理一切的测试脚本，只需运行run test命令；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="81fa" class="oa ms iq mj b gy ob oc l od oe">$ npm run test</span></pre><p id="e124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，</p><p id="b35f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建我们的计算器组件测试文件:</strong></p><p id="057f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jest将在以下任何位置查找测试文件:</p><ul class=""><li id="4dc7" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated"><code class="fe mg mh mi mj b">__tests__</code>文件夹中带有<code class="fe mg mh mi mj b">.js</code>后缀的文件。</li><li id="dd17" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">带有<code class="fe mg mh mi mj b">.test.js</code>后缀的文件。</li><li id="22b5" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">后缀为<code class="fe mg mh mi mj b">.spec.js</code>的文件。</li></ul><p id="3077" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将使用<code class="fe mg mh mi mj b">Calculator.spec.js </code>,我喜欢. spec.js，因为它是Angular等其他框架的标准。</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="25a1" class="oa ms iq mj b gy ob oc l od oe">$ touch src/components/Calculator.spec.js</span></pre><p id="2903" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的组件测试文件中，我们可以测试一些东西，首先导入React，我们将使用的<code class="fe mg mh mi mj b">Enzyme</code>API(<code class="fe mg mh mi mj b">shallow</code>和<code class="fe mg mh mi mj b">mount</code>)和我们的定制组件<code class="fe mg mh mi mj b">Calculator</code>；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="3a73" class="oa ms iq mj b gy ob oc l od oe">// src/components/Calculator.spec.js</span><span id="5cdf" class="oa ms iq mj b gy of oc l od oe"><strong class="mj ir">import </strong>React <strong class="mj ir">from </strong>"react";<br/><strong class="mj ir">import </strong>{ shallow, mount } <strong class="mj ir">from </strong>"enzyme";<br/><strong class="mj ir">import </strong>Calculator <strong class="mj ir">from </strong>"./Calculator";</span></pre><p id="7bd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试套件快照</strong></p><p id="d587" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从创建一个测试套件开始。测试套件创建了一个将几个测试组合在一起的块。我们可以列出所有我们想要包含的测试。</p><p id="8f91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在测试套件中，我只设置了一个测试，来设置我们的快照，但是您可以包括其他快照，以防您有其他相关的助手、实用程序；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="2d94" class="oa ms iq mj b gy ob oc l od oe">// describe(name, fn) creates a block that groups together several related tests in one "test suite".<br/>describe('Calculator Snapshots', () =&gt; {<br/>    it('should render our Snapshots correctly', () =&gt; {<br/>        <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>        expect(wrapper).toMatchSnapshot();<br/>    });<br/>});</span></pre><p id="3669" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，检查你的文件夹，注意这个脚本为我们创建了一个<code class="fe mg mh mi mj b">__snapshots__ folder</code>来观察变化；</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/f6651afee177904a0cce56168777b699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*nTXV8Lyo45Dw1JU6HaTJMQ.png"/></div></figure><p id="1e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们更改代码时，test live特性会告诉我们更新快照，只需点击<code class="fe mg mh mi mj b">u</code>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oi"><img src="../Images/b79bf6126c0a3fc41e6e6e32afaa01aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KwHC3mtf8Zd_iewTFMdliQ.png"/></div></div></figure><p id="354e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">非交互组件的单一测试</strong></p><p id="e93b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要为非交互组件创建一个单独的测试，我们可以测试我无耻的自我推销Twitter账户。我们为自定义组件创建了一个<code class="fe mg mh mi mj b">wrapper</code>,并且可以使用带有<code class="fe mg mh mi mj b">find</code>方法的<code class="fe mg mh mi mj b">shallow</code>来访问我们的<code class="fe mg mh mi mj b">a</code>链接dom标签中的<code class="fe mg mh mi mj b">text</code>字段；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="deda" class="oa ms iq mj b gy ob oc l od oe">// non-interactive components - using it (single test)<br/>it('should render the link url', () =&gt; {<br/>    <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>    <strong class="mj ir">const </strong>a = wrapper.find('a');<br/>    <strong class="mj ir">const </strong>result = a.text();</span><span id="b3d4" class="oa ms iq mj b gy of oc l od oe">    expect(result).toBe('@elieladelrom');<br/>});</span></pre><p id="99e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试组件道具</strong></p><p id="6579" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了测试我们从主入口点<code class="fe mg mh mi mj b">App.js</code>传来的标题上的道具，类似于我们之前的测试，我们设置了一个包装器，并根据我们注入的数据检查<code class="fe mg mh mi mj b">h1</code>文本；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="a8e9" class="oa ms iq mj b gy ob oc l od oe">// it(is aliased by test so it does the same thing as it)<br/>test('should render component title', () =&gt; {<br/>    <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator componentTitle={'Online Calculator'} version={'0.01-beta'}/&gt;);<br/>    <strong class="mj ir">const </strong>title = wrapper.find('h1.title').text();</span><span id="2812" class="oa ms iq mj b gy of oc l od oe">    expect(title).toBe('Online Calculator - Version #0.01-beta');<br/>});</span></pre><blockquote class="ml mm mn"><p id="49d7" class="jn jo kl jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">注意:为了创建一个单独的测试，你可以使用<code class="fe mg mh mi mj b"><em class="iq">test</em></code>关键字代替<code class="fe mg mh mi mj b"><em class="iq">it</em></code>关键字——这是一样的，<code class="fe mg mh mi mj b"><em class="iq">it</em></code>只是一个别名。想给你们俩看看。</p></blockquote><p id="a4db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试交互按钮</strong></p><p id="5dee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于交互式组件，我们可以使用<code class="fe mg mh mi mj b">simulate</code>，来模拟用户点击按钮的手势。然后，我们可以比较输出中的结果，我们正在重新开始，输出应该清晰；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="9f66" class="oa ms iq mj b gy ob oc l od oe">test('Testing output indirectly - should clean our result box clicking clear', () =&gt; {<br/>    <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>    <strong class="mj ir">const </strong>output = wrapper.find('div.output').text();<br/>    <strong class="mj ir">const </strong>btn = wrapper.find('button');</span><span id="3fc8" class="oa ms iq mj b gy of oc l od oe">    expect(output).toBe("0");</span><span id="81a5" class="oa ms iq mj b gy of oc l od oe">    btn.simulate('click');<br/>    <strong class="mj ir">const </strong>output_2 = wrapper.find('div.output').text();<br/>    expect(output_2).toBe("0");<br/>});</span></pre><p id="8b9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">直接测试功能的测试套件</strong></p><p id="427a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时候我们需要直接测试功能。看一下我在这里创建了一个测试套件来测试我的<code class="fe mg mh mi mj b">calculateTwoNumbers</code>。在测试套件中，我可以测试所有不同的操作符；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="dfa7" class="oa ms iq mj b gy ob oc l od oe">describe('Testing Calculator calculateTwoNumbers testsuite directly', () =&gt; {<br/>    test('Testing calculateTwoNumbers Directly - add', () =&gt; {<br/>        <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>        <strong class="mj ir">const </strong>instance = wrapper.instance();<br/>        expect(instance.calculateTwoNumbers(1, 2, '+')).toBe(3);<br/>    });<br/>    test('Testing calculateTwoNumbers Directly - multiple', () =&gt; {<br/>        <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>        <strong class="mj ir">const </strong>instance = wrapper.instance();<br/>        expect(instance.calculateTwoNumbers(2, 2, '*')).toBe(4);<br/>    });<br/>});</span></pre><p id="e41d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，<code class="fe mg mh mi mj b">wrapper</code>上的<code class="fe mg mh mi mj b">instance()</code>属性非常强大，因为我们可以访问我们的方法。</p><p id="fb50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试交互按钮和我们的状态</strong></p><p id="c0eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe mg mh mi mj b">instance()</code>，我们也可以测试我们的状态。例如，这里有一个测试来检查我们是否点击了<code class="fe mg mh mi mj b">1</code>按钮，输出会产生<code class="fe mg mh mi mj b">1</code>。</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="4bd3" class="oa ms iq mj b gy ob oc l od oe">test('test clicked calculator button method', () =&gt; {<br/>    <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>    <strong class="mj ir">const </strong>instance = wrapper.instance();<br/>    instance.clicked('1');<br/>    expect( wrapper.state('output')).toBe(1);<br/>});</span></pre><p id="e112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用Mount测试自定义组件；</strong></p><p id="a705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了测试我们的react-image-mapper，我们可以使用<code class="fe mg mh mi mj b">jest-canvas-mock</code>来访问所有的画布模拟属性，否则，我们将得到这个平均误差；</p><p id="ac23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b">TypeError: Cannot set property ‘fillStyle’ of null</code></p><p id="5ccf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装库<code class="fe mg mh mi mj b">jest-canvas-mock</code>；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="ae7c" class="oa ms iq mj b gy ob oc l od oe">$ npm i — save-dev jest-canvas-mock</span></pre><p id="f446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并将库包含在我们的测试中；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="a341" class="oa ms iq mj b gy ob oc l od oe">require('jest-canvas-mock');</span></pre><p id="ffa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看一看，进行一个测试来确保我们的地图区域产生一个指针光标；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="9746" class="oa ms iq mj b gy ob oc l od oe"><strong class="mj ir">import </strong>ImageMapper <strong class="mj ir">from </strong>'react-image-mapper';<br/><strong class="mj ir">import </strong>{ URL, MAP } <strong class="mj ir">from </strong>"./Calculator";<br/>require('jest-canvas-mock');</span><span id="1099" class="oa ms iq mj b gy of oc l od oe">describe('when onClick prop is provided', () =&gt; {<br/>    it('map styles should have "cursor:pointer"', () =&gt; {<br/>        <strong class="mj ir">const </strong>wrapper = mount(&lt;ImageMapper src={URL} map={MAP} onClick={() =&gt; {}} /&gt;);<br/>        <strong class="mj ir">const </strong>mapStyles = wrapper.find('map').get(0).props.style;</span><span id="a370" class="oa ms iq mj b gy of oc l od oe">        expect(mapStyles).toMatchObject({"cursor": "pointer"});<br/>        wrapper.unmount();<br/>    });<br/>});</span></pre><p id="edd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，使用<code class="fe mg mh mi mj b">mount</code> <code class="fe mg mh mi mj b">enzyme</code> API，我们需要在完成后卸载包装器；<code class="fe mg mh mi mj b">wrapper.unmount();</code></p><p id="3bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">mount API在DOM中挂载组件，所以需要在每次测试后<code class="fe mg mh mi mj b">.unmount()</code>来停止相互影响的测试。</p><p id="2cca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">利用间谍进行测试</strong></p><p id="f426" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们的应用程序增长，我们可能需要与异步数据交互，Jest有内置功能来处理模拟数据和功能。</p><ul class=""><li id="f365" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">看看更高级的测试题目，如间谍和嘲弄<a class="ae lr" href="https://jestjs.io/docs/en/jest-object" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/jest-object</a></li></ul><p id="f6f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可能会发布另一个帖子并展示高级用例测试，但现在，只看一个简单的刺探我们的<code class="fe mg mh mi mj b">startOver</code>函数的测试；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="900e" class="oa ms iq mj b gy ob oc l od oe">test('spy', () =&gt; {<br/>    <strong class="mj ir">const </strong>wrapper = shallow(&lt;Calculator /&gt;);<br/>    <strong class="mj ir">const </strong>instance = wrapper.instance();<br/>    jest.spyOn(instance, 'startOver');<br/>    wrapper.find('button').simulate('click');<br/>    expect(wrapper.state('output')).toBe(0);<br/>});</span></pre><p id="47e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们所有的测试套件和存根都准备好了，你应该期待以下测试输出；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="a2fa" class="oa ms iq mj b gy ob oc l od oe">Test Suites: 2 passed, 2 total<br/>Tests: 10 passed, 10 total<br/>Snapshots: 1 passed, 1 total<br/>Time: 58.27s<br/>Ran all test suites.</span></pre><p id="d88e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">👏</p><h1 id="e995" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">引擎盖下的东西</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oj"><img src="../Images/69f5cb4f04edda870db6cf87ec4f6eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5-6LOMexAMzF0f1svZ8uA.png"/></div></div></figure><p id="ccde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有很多内幕👩🏻‍💻。我想指出一些可以帮助你的事情；</p><p id="c813" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酶包括三种渲染方法。我们用了<code class="fe mg mh mi mj b">Mount</code>和<code class="fe mg mh mi mj b">Shallow</code>，但是还有<code class="fe mg mh mi mj b">Render</code>。</p><ul class=""><li id="eefa" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated"><strong class="jp ir">装上</strong>——<a class="ae lr" href="https://enzymejs.github.io/enzyme/docs/api/mount.html" rel="noopener ugc nofollow" target="_blank">https://enzymejs.github.io/enzyme/docs/api/mount.html</a></li><li id="1ba5" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated"><strong class="jp ir">浅浅</strong>——<a class="ae lr" href="https://enzymejs.github.io/enzyme/docs/api/shallow.html" rel="noopener ugc nofollow" target="_blank">https://enzymejs.github.io/enzyme/docs/api/shallow.html</a></li><li id="9160" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated"><strong class="jp ir">渲染</strong>——<a class="ae lr" href="https://enzymejs.github.io/enzyme/docs/api/render.html" rel="noopener ugc nofollow" target="_blank">https://enzymejs.github.io/enzyme/docs/api/render.html</a></li></ul><p id="9eb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装</strong></p><ul class=""><li id="6fb6" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">包括子组件的完整DOM呈现。</li><li id="088c" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">非常适合需要与DOM API交互或使用React生命周期方法的组件的用例。</li><li id="71e3" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">允许访问直接传递到根组件的属性(包括默认属性)和传递到子组件的属性。</li></ul><p id="dc01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">浅</strong></p><ul class=""><li id="7a27" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">仅渲染单个组件，不渲染子组件。这对于隔离纯单元测试的组件很有用。它防止子组件中的更改或错误。</li><li id="76ab" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated"><code class="fe mg mh mi mj b">shallow</code>组件默认访问生命周期方法</li><li id="1459" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">不能访问传入根组件的道具，但是可以访问传入子组件的道具，并且可以测试传入根组件的道具的<em class="kl">效果</em>。</li><li id="9142" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">当我们调用<code class="fe mg mh mi mj b">shallow(&lt;Calculator /&gt;)</code>时，我们测试的是<code class="fe mg mh mi mj b">Calculator</code> <em class="kl">呈现的</em>——而不是我们传递给<code class="fe mg mh mi mj b">shallow</code>的元素</li></ul><p id="1f13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">渲染</strong></p><ul class=""><li id="c279" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">呈现为静态HTML，包括子级。</li><li id="3b89" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">它无权访问<code class="fe mg mh mi mj b">React</code>生命周期方法。</li><li id="f069" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">使用的资源比其他API少，但功能较少。</li></ul><p id="8045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">酶转json </strong></p><p id="3c23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的代码中，我们使用了<em class="kl"> </em> <code class="fe mg mh mi mj b"><em class="kl">enzyme-to-json,</em></code>但是为什么呢？</p><p id="9ac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样做是为了我们的快照比较有一个比Enzyme现成的内部组件表示更好的组件格式。</p><p id="f84c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在使用快照时,<code class="fe mg mh mi mj b">snapshotSerializers</code> API允许我们编写更少的代码并消除重复。在将组件传递给Jest的快照匹配器之前，我们不需要每次用<code class="fe mg mh mi mj b">.toJson()</code>创建组件时都进行序列化；</p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="73aa" class="oa ms iq mj b gy ob oc l od oe">expect(toJson(rawRenderedComponent)).toMatchSnapshot();</span></pre><p id="f6f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们添加了我们的<code class="fe mg mh mi mj b"><em class="kl">package.json</em></code></p><pre class="kn ko kp kq gt nw mj nx ny aw nz bi"><span id="f42f" class="oa ms iq mj b gy ob oc l od oe">"snapshotSerializers": ["enzyme-to-json/serializer"],</span></pre><p id="5b53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们能够将由<code class="fe mg mh mi mj b">Enzyme</code>创建的组件传递给Jest <em class="kl"> </em> <code class="fe mg mh mi mj b"><em class="kl">.toMatchSnapshot()</em></code> <em class="kl"> </em>，而不使用<code class="fe mg mh mi mj b">toJson</code>语法<em class="kl">。</em></p><p id="3017" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">笑话比赛</strong></p><p id="3381" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们编写测试时，我们需要检查我们的测试值是否满足某些条件。API让我们可以访问几个“匹配”，让我们验证不同的东西。</p><p id="767d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jest方面，预期的API为大多数用户提供了足够的选项:<a class="ae lr" href="https://jestjs.io/docs/en/expect" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/expect</a>。然而，如果你找不到你想要的，检查Jest社区<a class="ae lr" href="https://github.com/jest-community/jest-extended" rel="noopener ugc nofollow" target="_blank"> jest-extended </a>寻找更多匹配，或者如果你找不到你需要的，创建你自己的。</p><h1 id="0749" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">让我们回顾一下</h1><p id="f121" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">在本文中，我将这个过程分为三个步骤；</p><ul class=""><li id="0e4a" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">步骤1 — <strong class="jp ir">设置。</strong>设置&amp;配置我们的项目</li><li id="4537" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">第二步— <strong class="jp ir">编写代码。</strong>计算器自定义组件</li><li id="22e0" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">步骤3 — <strong class="jp ir">测试代码</strong>。</li></ul><p id="b0ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想更好地理解我们正在使用的库，我还在教程的最后给了你一些额外的“幕后”东西。✌️</p><h1 id="d624" class="mr ms iq bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">从这里去哪里</h1><p id="99ba" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">你用的是TypeScript吗？我已经使用TypeScript创建了相同的示例，<a class="ae lr" href="https://medium.com/react-courses/unit-testing-react-typescript-app-with-jest-jest-dom-enzyme-11f52487aa18?sk=225b2c9ac788e78221ae969dbd901f2e" rel="noopener">请看一下。</a></p><ul class=""><li id="4cdc" class="ls lt iq jp b jq jr ju jv jy lu kc lv kg lw kk lx ly lz ma bi translated">你可以从这里下载完整的项目:<a class="ae lr" href="https://github.com/EliEladElrom/react-tutorials" rel="noopener ugc nofollow" target="_blank">https://github.com/EliEladElrom/react-tutorials</a></li><li id="e0a9" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">在YouTube上跟随这个教程:<a class="ae lr" href="https://youtu.be/ViaHrgbGhRs" rel="noopener ugc nofollow" target="_blank">https://youtu.be/ViaHrgbGhRs</a></li><li id="6448" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">你正在做一个打字项目吗，点击这里查看我的文章<a class="ae lr" href="https://medium.com/react-courses/unit-testing-react-typescript-app-with-jest-jest-dom-enzyme-11f52487aa18" rel="noopener">。</a></li><li id="e353" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">看我其他的媒介文章比如——<a class="ae lr" href="https://medium.com/blockchain-developer/angular-9-vs-react-16-a-2020-showdown-2b0b8aa6c8e9" rel="noopener">Angular 9 vs React 16——你该挑什么？2020年摊牌</a></li><li id="bd72" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">笑话:https://jestjs.io/docs/en/tutorial-react<a class="ae lr" href="https://jestjs.io/docs/en/tutorial-react" rel="noopener ugc nofollow" target="_blank"/></li><li id="7e15" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">jest-DOM doc:<a class="ae lr" href="https://noriste.github.io/reactjsday-2019-testing-course/book/intro-to-react-testing/jest-dom.html" rel="noopener ugc nofollow" target="_blank">https://no riste . github . io/react jsday-2019-testing-course/book/intro-to-react-testing/jest-DOM . html</a></li><li id="1581" class="ls lt iq jp b jq mb ju mc jy md kc me kg mf kk lx ly lz ma bi translated">酵素文档:<a class="ae lr" href="https://airbnb.io/enzyme/docs/api/" rel="noopener ugc nofollow" target="_blank">https://airbnb.io/enzyme/docs/api/</a></li></ul></div></div>    
</body>
</html>