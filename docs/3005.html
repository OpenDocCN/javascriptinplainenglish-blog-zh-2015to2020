<html>
<head>
<title>Node.js Tips — Run Commands, Response Headers, Read Files, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js提示—运行命令、响应头、读取文件等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-tips-run-commands-response-headers-read-files-and-more-77f2b98dc0d3?source=collection_archive---------7-----------------------#2020-08-17">https://javascript.plainenglish.io/node-js-tips-run-commands-response-headers-read-files-and-more-77f2b98dc0d3?source=collection_archive---------7-----------------------#2020-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/59d505246008ac6bfbf0c8aefa2e0429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aPzbKVsvm4rKSHD4"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@strandman?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andreas Strandman</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3b29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写节点应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些编写节点应用程序时常见问题的解决方案。</p><h1 id="ea70" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Node.js同步执行系统命令</h1><p id="4572" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以与<code class="fe me mf mg mh b">child_process</code>模块同步运行系统命令。</p><p id="5d1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e30b" class="mq lc iq mh b gy mr ms l mt mu">const execSync = require('child_process').execSync;<br/>const code = execSync('ls');</span></pre><p id="3333" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们运行<code class="fe me mf mg mh b">execSync</code>来运行我们想要的命令。</p><h1 id="7bac" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">去掉标题X-Powered-By:Express</h1><p id="b767" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">app.disable</code>方法移除<code class="fe me mf mg mh b">X-Powered-By</code>标头。</p><p id="dab2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="40f4" class="mq lc iq mh b gy mr ms l mt mu">app.disable('x-powered-by');</span></pre><p id="4868" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">阻止将<code class="fe me mf mg mh b">x-powered-by</code>报头添加到响应中。</p><p id="6300" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cb29" class="mq lc iq mh b gy mr ms l mt mu">app.set('x-powered-by', false);</span></pre><p id="33a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">做同样的事情。</p><h1 id="496c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">向运行JavaScript文件的my package.json文件添加自定义脚本</h1><p id="b1ed" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以将脚本添加到<code class="fe me mf mg mh b">package.json</code>文件的<code class="fe me mf mg mh b">scripts</code>部分。</p><p id="f460" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b6bc" class="mq lc iq mh b gy mr ms l mt mu">"scripts": {<br/>  "start": "node app.js",<br/>},</span></pre><p id="2c17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以运行<code class="fe me mf mg mh b">npm start</code>来运行它。</p><h1 id="a119" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用Node.js生成唯一ID</h1><p id="3ce4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了使创建惟一id变得容易，我们可以添加<code class="fe me mf mg mh b">uuid</code>包来帮助我们创建UUIDs。</p><p id="681f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们运行:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fa26" class="mq lc iq mh b gy mr ms l mt mu">npm install uuid</span></pre><p id="0c25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5b83" class="mq lc iq mh b gy mr ms l mt mu">const { v1: uuidv1 } = require('uuid');<br/>const id = uuidv1();</span></pre><p id="f7ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建v1 UUID。</p><p id="abdb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3e89" class="mq lc iq mh b gy mr ms l mt mu">const { v4: uuidv4 } = require('uuid');<br/>const id = uuidv4();</span></pre><p id="1388" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建v4 UUID。</p><p id="bf43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用<code class="fe me mf mg mh b">crypto</code>模块创建一个唯一的ID。然而，它不会是UUID。</p><p id="6f35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d9c8" class="mq lc iq mh b gy mr ms l mt mu">const crypto = require("crypto");<br/>const id = crypto.randomBytes(16).toString("hex");</span></pre><p id="049d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">id</code>会是一个32位的字符串。</p><h1 id="3ad9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用Node.js替换文件中的字符串</h1><p id="f4e7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">readFile</code>和<code class="fe me mf mg mh b">writeFile</code>把内容替换成新的内容。</p><p id="81b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5550" class="mq lc iq mh b gy mr ms l mt mu">const fs = require('fs');<br/>const someFile = './file.txt';</span><span id="022f" class="mq lc iq mh b gy mv ms l mt mu">fs.readFile(someFile, 'utf8', (err, data) =&gt; {<br/>  if (err) {<br/>    return console.log(err);<br/>  }</span><span id="727a" class="mq lc iq mh b gy mv ms l mt mu">  const result = data.replace('old string', 'new string');<br/>  fs.writeFile(someFile, result, 'utf8', (err) =&gt; {<br/>    if (err) {<br/>      return console.log(err);<br/>    }<br/>  });<br/>});</span></pre><p id="3909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">someFile</code>是文件的路径。</p><p id="3bcd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">fs.readFile</code>来读取UTF-8编码的文件。</p><p id="6b45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在回调中，我们得到了<code class="fe me mf mg mh b">data</code>，它包含了内容。</p><p id="d36d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">replace</code>将<code class="fe me mf mg mh b">data</code>中的<code class="fe me mf mg mh b">'old string'</code>替换为<code class="fe me mf mg mh b">'new string'</code>。</p><p id="5e1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">writeFile</code>用新内容写文件。</p><p id="01e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要<code class="fe me mf mg mh b">utf8</code>编码来表明它是一个文本文件。</p><p id="fab0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">err</code>如果在两个回调中都遇到，将会有错误对象。</p><h1 id="3da1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">修复“process.env.NODE_ENV未定义”错误</h1><p id="d46e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过运行以下命令来设置<code class="fe me mf mg mh b">NODE_ENV</code>的值:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="aa98" class="mq lc iq mh b gy mr ms l mt mu">SET NODE_ENV=development</span></pre><p id="20f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Windows或:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="92ae" class="mq lc iq mh b gy mr ms l mt mu">export NODE_ENV=development</span></pre><p id="16d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Linux中设置<code class="fe me mf mg mh b">NODE_ENV</code>环境变量。</p><p id="5e6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，当我们在运行这些命令之后运行我们的应用程序时,<code class="fe me mf mg mh b">process.env.NODE_ENV</code>被设置为<code class="fe me mf mg mh b">'development'</code>。</p><p id="a853" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以在运行脚本之前，在<code class="fe me mf mg mh b">scripts</code>部分放置一个脚本来设置<code class="fe me mf mg mh b">NODE_ENV</code>。</p><p id="1fdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="11c5" class="mq lc iq mh b gy mr ms l mt mu">"scripts": {<br/>  "start": "set NODE_ENV=development &amp;&amp; node app.js"<br/>}</span></pre><p id="9742" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">package.json</code>。</p><h1 id="48c5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在Express.js资产上设置响应头</h1><p id="9651" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以调用<code class="fe me mf mg mh b">res.set</code>来设置Express资产的标题。</p><p id="d507" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e5e7" class="mq lc iq mh b gy mr ms l mt mu">res.set('Content-Type', 'text/plain');</span></pre><p id="f57c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中第一个参数是标题键，第二个参数是标题值。</p><p id="c753" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以在一个对象中传递来设置多个头:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="aa1a" class="mq lc iq mh b gy mr ms l mt mu">res.set({<br/>  'Content-Type': 'text/plain',<br/>  'Content-Length': '123'<br/>})</span></pre><p id="6d02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们一次设置<code class="fe me mf mg mh b">Content-Type</code>和<code class="fe me mf mg mh b">Content-Length</code>。</p><p id="6cba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">res.header</code>方法是<code class="fe me mf mg mh b">res.set</code>的别名。</p><p id="f9cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要向现有的响应头添加更多的头，我们可以使用<code class="fe me mf mg mh b">res.append</code>方法。</p><p id="2df3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6c48" class="mq lc iq mh b gy mr ms l mt mu">res.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly')</span></pre><p id="72b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为cookie附加了一个响应头。</p><h1 id="7f60" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将文本文件读入节点应用程序中的数组</h1><p id="036a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要将文本文件读入节点应用程序中的数组，我们可以使用<code class="fe me mf mg mh b">readFile</code>方法。</p><p id="00ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7d14" class="mq lc iq mh b gy mr ms l mt mu">const fs = require('fs');</span><span id="a117" class="mq lc iq mh b gy mv ms l mt mu">fs.readFile('file.txt', (err, data) =&gt; {<br/>  if (err) {<br/>    return console.log(err);<br/>  }<br/>  const array = data.toString().split("\n");<br/>  for(const a of array) {<br/>    console.log(a);<br/>  }<br/>});</span></pre><p id="9d42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了以同步的方式读取它，我们可以使用<code class="fe me mf mg mh b">readFileSync</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d7a8" class="mq lc iq mh b gy mr ms l mt mu">constfs = require('fs');</span><span id="620c" class="mq lc iq mh b gy mv ms l mt mu">const array = fs.readFileSync('file.txt').toString().split("\n");<br/>for(const a of array) {<br/>  console.log(a);<br/>}</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/90c89c2e6d9df97252be877f82e6f83f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ynTtBWNJrTwzmkIg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@davidclode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">David Clode</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="3ef2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2f59" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在运行节点应用程序之前设置环境变量。</p><p id="ce6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以通过各种方式读取文件。</p><p id="cff4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">child_process</code>模块在节点应用程序中运行命令。</p><p id="ddd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以通过多种方式设置响应头。</p><h2 id="26a3" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">简单英语的JavaScript</h2><p id="7477" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅解码，我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>