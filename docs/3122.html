<html>
<head>
<title>React: Record a Webcam Video and Upload it to S3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应:录制一段网络视频并上传到S3</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-recording-a-webcam-video-and-uploading-it-to-s3-90f26865e292?source=collection_archive---------6-----------------------#2020-08-31">https://javascript.plainenglish.io/react-recording-a-webcam-video-and-uploading-it-to-s3-90f26865e292?source=collection_archive---------6-----------------------#2020-08-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="afbb" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">简短但详细的指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/3013b1ea4b6c1bce81c175fe6fac8466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LN0oL7ldxdnWyFRHGS_EeA.png"/></div></div></figure><p id="9120" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">还记得20年前，在电子邮件上使用彩色字体被视为令人兴奋的事情吗？人们很快就习惯了电子邮件的“新常态”，颜色不再令人兴奋。所以人们开始加入图片，然后是你的名字，最近是个性化的内容来适应你。但这种循环一直在继续，我们现在已经习惯了在电子邮件中加入个性化内容。</p><p id="e02f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">那么下一步是什么？邮件里有什么感觉很新鲜？嵌入式视频！</p><p id="2ff0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">将涵盖哪些内容:</strong></p><ol class=""><li id="f2a4" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated">使用网络摄像头在React中录制视频</li><li id="4aa6" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">从网站访问AWS资源</li><li id="ba0e" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">上传视频到S3 &amp;获得公共链接</li></ol><h1 id="958c" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated"><strong class="ak">用React录制网络摄像头视频</strong></h1><h2 id="0ab9" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated">要求:</h2><ul class=""><li id="ff56" class="lk ll in kq b kr nc ku nd kx ne lb nf lf ng lj nh lq lr ls bi translated">通过网络摄像头录制视频和音频</li><li id="736d" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj nh lq lr ls bi translated">录制时获得视频的实时反馈</li><li id="9829" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj nh lq lr ls bi translated">录制后有回放选项</li></ul><p id="d28a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae ni" href="https://www.npmjs.com/package/react-video-recorder" rel="noopener ugc nofollow" target="_blank"> React Video Recorder </a>是一个高度可配置的轻量级皮肤，覆盖了<a class="ae ni" href="https://www.npmjs.com/package/styled-components" rel="noopener ugc nofollow" target="_blank">风格组件的</a>视频组件。它提供了一个实用工具工具箱，可以根据您的需求定制录制和<a class="ae ni" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank"> blob </a>，例如MimeType、回放选项和图像叠加。这些都记录在他们的Github上。</p><h2 id="600c" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated"><strong class="ak">反应元件</strong></h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="1c8f" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated"><strong class="ak">创建您的AWS资源</strong></h1><h2 id="62e8" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated"><strong class="ak">创建S3存储桶</strong></h2><p id="7118" class="pw-post-body-paragraph ko kp in kq b kr nc jo kt ku nd jr kw kx nl kz la lb nm ld le lf nn lh li lj ig bi translated">从<a class="ae ni" href="https://console.aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> AWS S3控制台</a>中，您可以创建您的铲斗。要在AWS帐户之外公开和查看视频链接，您必须关闭默认选项<code class="fe no np nq nr b">Block All Public Access</code>。</p><h2 id="efbe" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated">亚马逊认知</h2><p id="63ad" class="pw-post-body-paragraph ko kp in kq b kr nc jo kt ku nd jr kw kx nl kz la lb nm ld le lf nn lh li lj ig bi translated">当在浏览器中使用AWS SDK时，最好使用Amazon Cognito身份池，因为它提供了临时凭证，您可以在其中指定用户可以访问哪些资源。用户可以作为来宾(未经身份验证)或经过身份验证的用户访问您的AWS资源。在这篇文章中，我们将关注客人，但是如果你想了解更多关于认证用户的信息，你可以<a class="ae ni" href="https://docs.aws.amazon.com/cognito/latest/developerguide/switching-identities.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="e576" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您可以从<a class="ae ni" href="https://eu-west-1.console.aws.amazon.com/cognito/federated" rel="noopener ugc nofollow" target="_blank">控制台</a>创建您的Amazon Cognito身份池。创建身份池时，勾选框<code class="fe no np nq nr b">Enable access to unauthenticated users</code>以允许用户无需登录即可访问资源。</p><p id="1e64" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下一页将允许您选择希望通过IAM策略授予用户访问权限的资源。默认情况下，用户有权访问Cognito services &amp; analytics，因此我们需要允许访问S3。在每个角色下，单击策略文档上的编辑，并添加以下内容:</p><p id="1a8f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">确保用您的铲斗名称替换<code class="fe no np nq nr b">&lt;bucketname&gt;</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="d852" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们添加到现有文档中的惟一内容是能够将对象添加到特定的S3存储桶中。良好的做法是只授予限制潜在攻击者造成的任何损害所需的最低访问权限。创建身份池后，您还可以通过<a class="ae ni" href="https://console.aws.amazon.com/iam/home" rel="noopener ugc nofollow" target="_blank"> IAM控制台</a>添加此权限。</p><h1 id="14b3" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated"><strong class="ak">上传到S3 </strong></h1><p id="49aa" class="pw-post-body-paragraph ko kp in kq b kr nc jo kt ku nd jr kw kx nl kz la lb nm ld le lf nn lh li lj ig bi translated">您首先必须将<a class="ae ni" href="https://www.npmjs.com/package/aws-sdk" rel="noopener ugc nofollow" target="_blank"> AWS SDK </a>安装到React应用程序中。</p><h2 id="ac79" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated"><strong class="ak">认证</strong></h2><p id="b78d" class="pw-post-body-paragraph ko kp in kq b kr nc jo kt ku nd jr kw kx nl kz la lb nm ld le lf nn lh li lj ig bi translated">现在，我们可以添加我们的身份池。从<a class="ae ni" href="https://eu-west-1.console.aws.amazon.com/cognito/federated" rel="noopener ugc nofollow" target="_blank"> Amazon Cognito身份池控制台</a>点击你刚刚创建的池，然后进入<code class="fe no np nq nr b">Sample Code</code>。这将为您提供一个类似于下面的代码片段，其中包含您的身份池的唯一标识符。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="1b7b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">配置S3 </strong></p><p id="e3db" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">AWS SDK默认为最新版本的S3客户端。虽然大多数时候这是您的首选，但是如果API发生变化，这可能会导致问题。为了避免这种情况，您可以将S3 API版本全局锁定到特定版本。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="e456" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">要访问您的S3存储桶，您需要创建它的一个实例，该实例将允许您使用身份池中的用户凭据执行CRUD操作。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="7dcc" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated">将视频添加到S3</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c6c9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这里有几个属性需要分解:</p><ul class=""><li id="e390" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj nh lq lr ls bi translated"><strong class="kq io">键:</strong>要保存到S3的文件的名称。该键还考虑使用正斜杠(/)的文件结构，因此要将其保存到特定文件夹，可以使用folder1/folder2/video.mp4。</li><li id="fbe7" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj nh lq lr ls bi translated"><strong class="kq io">正文:</strong>要上传的内容。</li><li id="c8cd" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj nh lq lr ls bi translated"><strong class="kq io">内容类型:</strong>这告诉亚马逊内容是什么格式。当通过S3提供的公共URL访问视频时，播放时需要它。</li><li id="d847" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj nh lq lr ls bi translated"><strong class="kq io"> ACL: </strong>亚马逊的访问控制列表(ACL)指定了对象上设置的权限。就像创建S3存储桶一样，存储桶中的对象默认为非公共的。要允许公开访问URL，需要将其设置为<code class="fe no np nq nr b">public-read</code>。</li></ul><h1 id="76f7" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated"><strong class="ak">全部放在一起</strong></h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7d13" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">添加后，您的S3存储桶将包含您的视频，其URL遵循可公开共享的格式<code class="fe no np nq nr b">https://&lt;bucketname&gt;.&lt;region&gt;.amazonaws.com/&lt;videoname&gt;</code>。</p><h2 id="a0f3" class="mq lz in bd ma mr ms dn me mt mu dp mi kx mv mw mk lb mx my mm lf mz na mo nb bi translated">需要考虑的要点</h2><ol class=""><li id="68cf" class="lk ll in kq b kr nc ku nd kx ne lb nf lf ng lj lp lq lr ls bi translated">如果你计划在真实的站点上使用它，这个域必须有一个SSL证书。这是浏览器上的设计，因为通过HTTP传输网络摄像头内容是危险的。</li><li id="02c0" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">如果你只想将公共视频发送给一个用户，并且不希望视频被轻易发现，我建议你至少在名字前加一个<a class="ae ni" href="https://www.npmjs.com/package/uuid" rel="noopener ugc nofollow" target="_blank"> UUID </a>。</li></ol><p id="0320" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="ns">更多内容请看</em><a class="ae ni" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ns">plain English . io</em></strong></a></p></div></div>    
</body>
</html>