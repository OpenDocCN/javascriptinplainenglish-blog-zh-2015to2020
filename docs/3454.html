<html>
<head>
<title>Build a Simple Referral System With Node.js and MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js和MySQL构建一个简单的推荐系统</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-simple-referral-system-with-nodejs-and-mysql-3164de2e7818?source=collection_archive---------1-----------------------#2020-09-30">https://javascript.plainenglish.io/build-a-simple-referral-system-with-nodejs-and-mysql-3164de2e7818?source=collection_archive---------1-----------------------#2020-09-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5d11" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过推荐计划获得更多关于您下一个项目的注册</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c6aa30e03eb8f9eef8739a6c07bcf6c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6b-Xkhk7h1imoXMY"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@bewakoofofficial?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bewakoof.com Official</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="72ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">推荐项目无处不在。几乎在任何时候，你注册一个新的SaaS产品或订阅一个热门的新电子邮件简讯，你会得到一个推荐链接，你可以与他人分享一个特殊的奖金。</p><p id="4725" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建一个推荐项目是为你的产品获得社会证明的一个不可思议的方法。有人注册，其他人看到他们这样做，反过来他们也更有可能注册。</p><blockquote class="lp"><p id="3efc" class="lq lr in bd ls lt lu lv lw lx ly lo dk translated">“[社会证明]描述了一种心理和社会现象，其中人们模仿他人的行为，试图在给定的情况下采取行动。”</p></blockquote><p id="d5b2" class="pw-post-body-paragraph kt ku in kv b kw lz jo ky kz ma jr lb lc mb le lf lg mc li lj lk md lm ln lo ig bi translated">在制作我最新的产品<a class="ae ks" href="https://shelf.news/?ref=ea8d222" rel="noopener ugc nofollow" target="_blank">货架的时候(看看吧！)</a>，我实现了一个自定义的推荐程序，想分享一下我是怎么做的。</p><h1 id="8a53" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">这个计划</h1><p id="fabc" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">对于这个项目，我将使用Node.js/Expressjs服务器和MySQL数据库。您可以自由使用任何web服务器+数据库组合，因为同样的原则也适用。</p><p id="e021" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">节点服务器需要执行以下操作:</p><ul class=""><li id="932a" class="nb nc in kv b kw kx kz la lc nd lg ne lk nf lo ng nh ni nj bi translated">呈现带有电子邮件注册的网页</li><li id="a396" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">为每个注册的用户生成唯一的推荐代码</li><li id="d42b" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">将推荐代码返回给客户，以便显示</li></ul><p id="9cc5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">…数据库需要保存所有注册用户的列表，包括以下信息:</p><ul class=""><li id="8a41" class="nb nc in kv b kw kx kz la lc nd lg ne lk nf lo ng nh ni nj bi translated">电子邮件地址</li><li id="b3d2" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">推荐代码<em class="np">(他们的唯一代码)</em></li><li id="c6a9" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">推荐人<em class="np">(他们用来注册的代码，如果有的话)</em></li><li id="10c2" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">添加时间</li></ul><h1 id="fe6b" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">关系型数据库</h1><p id="304e" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">对于这个简单的推荐系统，我们只需要一个可以保存四样东西的数据库:用户的电子邮件地址、他们唯一的推荐代码、推荐他们的人的代码以及他们被添加的时间。</p><p id="3162" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我用以下模式创建了我的表:</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="5b6f" class="nv mf in nr b gy nw nx l ny nz">CREATE TABLE `users` (<br/> `id` INT(11) NOT NULL AUTO_INCREMENT,<br/> `email` VARCHAR(255) NOT NULL,<br/> `referral_code` VARCHAR(255) NOT NULL,<br/> `referrer` VARCHAR(255),<br/> `time_added` TIMESTAMP NOT NULL DEFAULT 'CURRENT_TIMESTAMP',<br/> PRIMARY KEY (`id`)<br/>);</span></pre><p id="a9a6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">无论您在何处或以何种方式设置数据库，请确保跟踪其凭据，以便我们稍后可以通过Node.js应用程序访问它。您将需要:</p><ul class=""><li id="67ca" class="nb nc in kv b kw kx kz la lc nd lg ne lk nf lo ng nh ni nj bi translated">数据库名称</li><li id="6253" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">数据库主机</li><li id="fe0c" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">数据库用户</li><li id="44bd" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">数据库密码</li></ul><h1 id="8a7e" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">Node.js + Expressjs</h1><p id="cceb" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">我将首先使用带有<code class="fe oa ob oc nr b"><a class="ae ks" href="https://expressjs.com/en/starter/generator.html" rel="noopener ugc nofollow" target="_blank">express-generator</a></code>的EJS视图引擎创建一个名为<code class="fe oa ob oc nr b">referral-program</code>的简单快速项目。</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="a5ee" class="nv mf in nr b gy nw nx l ny nz"><strong class="nr io">express --view=ejs referral-program</strong></span><span id="bb71" class="nv mf in nr b gy od nx l ny nz">create : referral-program/<br/>create : referral-program/public/<br/>create : referral-program/public/javascripts/<br/>create : referral-program/public/images/<br/>create : referral-program/public/stylesheets/<br/>create : referral-program/public/stylesheets/style.css<br/>create : referral-program/routes/<br/>create : referral-program/routes/index.js<br/>create : referral-program/routes/users.js<br/>create : referral-program/views/<br/>create : referral-program/views/error.ejs<br/>create : referral-program/views/index.ejs<br/>create : referral-program/app.js<br/>create : referral-program/package.json<br/>create : referral-program/bin/<br/>create : referral-program/bin/www</span><span id="b54e" class="nv mf in nr b gy od nx l ny nz">change directory:<br/>$ cd referral-program</span><span id="b43b" class="nv mf in nr b gy od nx l ny nz">install dependencies:<br/>$ npm install</span><span id="5082" class="nv mf in nr b gy od nx l ny nz">run the app:<br/>$ DEBUG=referral-program:* npm start</span></pre><p id="e5b7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">按照指示，我们可以使用以下命令运行该项目:</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="fc38" class="nv mf in nr b gy nw nx l ny nz">cd referral-program<br/>npm install<br/>npm start</span></pre><p id="2ec5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦你运行了，通过访问<code class="fe oa ob oc nr b">localhost:3000</code>来确认一切正常。您应该会看到一个页面，上面写着“欢迎快递”</p><h2 id="3d62" class="nv mf in bd mg oe of dn mk og oh dp mo lc oi oj mq lg ok ol ms lk om on mu oo bi translated">用户界面</h2><p id="60b1" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">在<code class="fe oa ob oc nr b">index.ejs</code>文件中，我们需要一些代码来呈现email &amp; referral code输入字段和一个submit按钮，用一点Javascript(本例中是jQuery)将数据提交给我们的服务器。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="2d49" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里,<code class="fe oa ob oc nr b">script</code>标记中的jQuery将使用来自电子邮件和推荐代码输入框的数据向<code class="fe oa ob oc nr b">/</code>路由提交一个AJAX POST请求。您可以立即提交您的电子邮件进行测试；您应该会得到一个404 Not Found错误，因为我们还没有在该路由上实现POST处理程序。然而，当该路由被实现时，您可以看到，一旦成功，它将向用户提示他们的唯一推荐链接。</p><p id="8b82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您使用像我这样的代码，那么您的主页应该是这样的:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi or"><img src="../Images/e19d0abe36406a3259f90ee23d2f5f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*qZDtVPKJdCzNnSQ8-p3Q7A.png"/></div></figure><h2 id="9a34" class="nv mf in bd mg oe of dn mk og oh dp mo lc oi oj mq lg ok ol ms lk om on mu oo bi translated">属国</h2><p id="e813" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">让我们从安装来自<strong class="kv io"> npm </strong>的一些依赖项开始后端工作。</p><p id="2c96" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将需要:</p><ul class=""><li id="3b09" class="nb nc in kv b kw kx kz la lc nd lg ne lk nf lo ng nh ni nj bi translated"><code class="fe oa ob oc nr b">mysql</code>与我们的MySQL数据库交互</li><li id="2d2e" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated"><code class="fe oa ob oc nr b">dotenv</code>用于从<strong class="kv io">访问环境变量。环境</strong>文件</li><li id="5458" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated"><code class="fe oa ob oc nr b">shortid</code>用于生成简短、URL友好的推荐代码</li></ul><p id="e927" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用以下命令安装它们:</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="b7a0" class="nv mf in nr b gy nw nx l ny nz">npm i mysql<br/>npm i dotenv<br/>npm i <!-- -->shortid</span></pre><h2 id="d073" class="nv mf in bd mg oe of dn mk og oh dp mo lc oi oj mq lg ok ol ms lk om on mu oo bi translated">app.js</h2><p id="081f" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">我们需要对我们项目的<code class="fe oa ob oc nr b">app.js</code>文件做一个小小的调整。在文件的最顶部，在其他任何内容之前，添加以下行:</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="d1c4" class="nv mf in nr b gy nw nx l ny nz">require('dotenv').config();</span></pre><p id="225a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这将允许我们稍后使用<code class="fe oa ob oc nr b">process.env.VARIABLE_NAME</code>来访问环境变量。</p><h2 id="83ae" class="nv mf in bd mg oe of dn mk og oh dp mo lc oi oj mq lg ok ol ms lk om on mu oo bi translated">创建环境变量</h2><p id="ca4b" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">在项目的根目录下创建一个名为<code class="fe oa ob oc nr b">.env</code>的文件，并将您的MySQL数据库凭证放入其中。您的文件应该如下所示:</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="7b43" class="nv mf in nr b gy nw nx l ny nz">DB_USER=your_database_username<br/>DB_PASS=your_database_password<br/>DB_NAME=your_database_name<br/>DB_HOST=your_database_host</span></pre><h2 id="e55c" class="nv mf in bd mg oe of dn mk og oh dp mo lc oi oj mq lg ok ol ms lk om on mu oo bi translated">“邮政/”路线</h2><p id="ccf4" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">我们告诉我们的表单将所有条目作为POST请求提交到<code class="fe oa ob oc nr b">/</code>路由，所以现在让我们定义那里发生了什么。这条路线需要:</p><ol class=""><li id="fc09" class="nb nc in kv b kw kx kz la lc nd lg ne lk nf lo os nh ni nj bi translated">阅读用户提交的数据:电子邮件和推荐人</li><li id="d1b3" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo os nh ni nj bi translated">生成用户可以共享的唯一推荐代码</li><li id="8430" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo os nh ni nj bi translated">将提交的内容放入数据库</li><li id="486c" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo os nh ni nj bi translated">将推荐代码返回给客户</li></ol><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="op oq l"/></div></figure><h1 id="6ee4" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">恭喜你！🥳</h1><p id="4f62" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">你已在你的应用中成功实施了推荐计划！</p><p id="dba8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了测试它，重新启动您的节点服务器(<code class="fe oa ob oc nr b">ctrl+c</code>停止它，然后<code class="fe oa ob oc nr b">npm start</code>再次启动)并重新访问<code class="fe oa ob oc nr b">localhost:3000</code>。提交您的电子邮件地址，您应该会看到一个弹出窗口，显示您的唯一推荐链接。然后，如果您使用该推荐代码进行另一次提交，您将看到该代码记录在数据库中。</p><p id="3125" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你遇到任何麻烦，你可以查看我的GitHub repo中的完整代码:<a class="ae ks" href="https://github.com/adboio/nodejs-referral-program" rel="noopener ugc nofollow" target="_blank">https://github.com/adboio/nodejs-referral-program</a></p><h1 id="d9f6" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">进一步的想法</h1><p id="6042" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">这里提出的想法是一个简单的推荐系统的核心，但是从这里你把它带到哪里取决于你自己！下面是我在最新产品<a class="ae ks" href="https://shelf.news/?ref=ea8d222" rel="noopener ugc nofollow" target="_blank"> Shelf </a>中如何使用推荐程序的一些灵感:</p><ul class=""><li id="b2c9" class="nb nc in kv b kw kx kz la lc nd lg ne lk nf lo ng nh ni nj bi translated">我将推荐代码表示为推荐链接，例如https://shelf.news/?ref=ea8d222的<a class="ae ks" href="https://shelf.news/?ref=ea8d222" rel="noopener ugc nofollow" target="_blank"/>。当用户使用其中一个链接访问站点时，推荐代码会自动随POST请求一起发送，以便跟踪。这样，他们就不必真的输入推荐代码了。</li><li id="d929" class="nb nc in kv b kw nk kz nl lc nm lg nn lk no lo ng nh ni nj bi translated">推荐更多人使用该应用的用户在等待列表中的位置会更靠前。这是通过计算每个用户有多少推荐，并以这种方式排序来实现的。</li></ul><p id="3c55" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">回复我，让我知道你打算如何在你的下一个项目中使用推荐计划！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ot"><img src="../Images/787be6c671be8d345dc786dad8729ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-sOyyG8NoRbKpCG_y4Cmw@2x.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank">Subscribe to Decoded, our official YouTube channel!</a></figcaption></figure></div></div>    
</body>
</html>