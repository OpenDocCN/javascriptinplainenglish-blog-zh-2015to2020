# å¦‚ä½•ç”¨ JavaScript å†™æ‰¿è¯º

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/truly-understanding-promises-in-javascript-cb31ee487860?source=collection_archive---------1----------------------->

![](img/290cc03c43741205f989e421e4b65149.png)

Photo by [rawpixel](https://unsplash.com/@rawpixel?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

> [ç‚¹å‡»è¿™é‡Œåœ¨ Linkedin ä¸Šåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼](https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.linkedin.com%2Fpulse%2Ftruly-understanding-promises-javascript-ashay-mandwarya%2F%3Fpublished%3Dt)

å‡ ä¹æ‰€æœ‰ä½¿ç”¨è¿‡ JavaScript çš„äººéƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šå¯¹å®ƒåˆçˆ±åˆæ¨ã€‚JavaScript å°±åƒé‚£ä¸ªæœ‰æ—¶ä»¤äººæ²®ä¸§çš„å¥³æœ‹å‹ï¼Œä½†å¥¹èº«ä¸Šæœ‰ä¸€äº›è®©æˆ‘ä»¬å¥½å¥‡çš„ä¸œè¥¿ã€‚JavaScript æœ‰å¤§é‡æœ‰è¶£çš„ä¸»é¢˜å’Œæ¦‚å¿µå¯ä»¥æ¢ç´¢ã€‚å…ˆè¯´å…¶ä¸­ä¸€ä¸ªâ€”â€”æ‰¿è¯ºã€‚

![](img/9121a1753aff091932c748a29463f1ee.png)

Photo by [Judeus Samson](https://unsplash.com/@judeussamson?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

> å°±åƒæ²¡æœ‰å¯¹è¯çš„èœ˜è››ä¾ ç”µå½±æ˜¯ä¸å®Œæ•´çš„ï¼Œå¼ºå¤§çš„åŠ›é‡ä¼´éšç€å·¨å¤§çš„è´£ä»»
> 
> æ²¡æœ‰ä¸€ç¯‡åŸºäºæ‰¿è¯ºçš„æ–‡ç« æ˜¯å®Œæ•´çš„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å£°æ˜æ‰¿è¯ºä¼šè®©ä½ å…äºè¢«å¬å›çš„ç—›è‹¦ã€‚

ä½†æ˜¯æ‰¿è¯ºè¿˜ä¸æ­¢è¿™äº›ï¼Œæˆ‘å°†å‘ä½ ä»¬å±•ç¤ºã€‚

JavaScript æ˜¯ä¸€ç§åŒæ­¥ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯å› ä¸ºæœ‰äº†å›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒåƒå¼‚æ­¥ç¼–ç¨‹è¯­è¨€ä¸€æ ·å·¥ä½œã€‚

# **æ‰¿è¯º**

javascript ä¸­çš„æ‰¿è¯ºä¸ç°å®ç”Ÿæ´»ä¸­çš„æ‰¿è¯ºéå¸¸ç›¸ä¼¼ã€‚

![](img/ebb98c03111a9ad98f92e22fd9ee6cc0.png)

Definition of promise -Google

1.  ä½œå‡ºæ‰¿è¯ºåï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å…³äºæŸäº‹çš„ä¿è¯ï¼Œå¹¶æ®æ­¤åˆ¶å®šè®¡åˆ’ã€‚
2.  å®ƒä»¬å¯ä»¥ä¿ç•™ï¼Œä¹Ÿå¯ä»¥è¢«ç ´åã€‚
3.  æˆ‘ä»¬ä¸èƒ½ç«‹å³é‡‡å–è¡ŒåŠ¨ã€‚åªæœ‰åœ¨æ‰¿è¯ºå…‘ç°ä¹‹åã€‚

æ ¹æ® [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) :

`**Promise**`å¯¹è±¡è¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆ(æˆ–å¤±è´¥)åŠå…¶ç»“æœå€¼ã€‚

ç©å¼„æ‰¿è¯ºæœ‰ä¸¤ä¸ªéƒ¨åˆ†-

1.  æ‰¿è¯ºçš„äº§ç”Ÿ
2.  æ‰¿è¯ºçš„å¤„ç†

# åˆ›é€ 

æ‰¿è¯ºæœ‰åŸºæœ¬çš„è“å›¾

```
new Promise( /* executor */ function(resolve, reject) { ... } );
                                                               --MDN
```

æ‰§è¡Œå‡½æ•°(executor)æ¥å—ä¸¤ä¸ªå‚æ•°`resolve` å’Œ`reject` ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åˆæ˜¯å›è°ƒå‡½æ•°ã€‚æ‰¿è¯ºç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼Œä¹Ÿç§°ä¸ºé˜»å¡ä»£ç ï¼Œä¾‹å¦‚ DBã€I/O æˆ– API è°ƒç”¨ï¼Œè¿™äº›è°ƒç”¨ç”± executor å‡½æ•°æ‰§è¡Œã€‚ä¸€æ—¦å®Œæˆï¼Œå®ƒè¦ä¹ˆåœ¨æˆåŠŸæ—¶è°ƒç”¨ resolve å‡½æ•°ï¼Œè¦ä¹ˆåœ¨å‡ºé”™æ—¶è°ƒç”¨ reject å‡½æ•°ã€‚

ç®€å•çš„ä¾‹å­

```
let promise = new Promise(function(resolve, reject) {if(promise_kept)
  resolve("done");else
  reject(new Error("â€¦"));

});
```

å¯ä»¥çœ‹å‡ºï¼Œ*æ‰¿è¯ºä¸ä¼šç«‹å³è¿”å›å€¼ã€‚å®ƒç­‰å¾…æˆåŠŸæˆ–å¤±è´¥ï¼Œç„¶åç›¸åº”åœ°è¿”å›ã€‚è¿™ä½¿å¾—å¼‚æ­¥æ–¹æ³•åƒåŒæ­¥æ–¹æ³•ä¸€æ ·è¿”å›å€¼ã€‚å¼‚æ­¥æ–¹æ³•ä¸æ˜¯ç«‹å³è¿”å›å€¼ï¼Œè€Œæ˜¯æ‰¿è¯ºè¿”å›å€¼*ã€‚

ä¸Šé¢ä¸€æ®µè¯´æ¸…æ¥šäº†ä¸€ä»¶äº‹ï¼Œ*å®ƒæœ‰çŠ¶æ€ï¼*

æ‰¿è¯ºå¯ä»¥æ˜¯è¿™äº›çŠ¶æ€ä¹‹ä¸€-

1.  ***å¾…å®šâ€”*** è¿™æ˜¯æ‰¿è¯ºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„åˆå§‹çŠ¶æ€ã€‚æ—¢ä¸æ»¡è¶³ä¹Ÿä¸æ‹’ç»ã€‚
2.  ***å…‘ç°äº†â€”*** è®¸è¯ºæˆåŠŸäº†ã€‚
3.  ***æ‹’ç»â€”*** è®¸è¯ºå¤±è´¥ã€‚

è¿™äº›å·æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œæ‰€ä»¥æˆ‘å°±ä¸èµ˜è¿°äº†ã€‚ä¸‹é¢æ˜¯æˆªå›¾ï¼Œä¾›å‚è€ƒã€‚

![](img/2f74ce55e216b23b1057f21afdb6aa3e.png)

# å¤„ç†å’Œæ¶ˆè´¹æ‰¿è¯º

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ‰¿è¯ºæ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æ‰¿è¯ºæ˜¯å¦‚ä½•è¢«æ¶ˆè´¹çš„ã€‚

```
const isDone = new Promise()
//...

const checkIfDone = () => {
  isDone
    .then(ok => {
      console.log(ok)
    })
    .catch(err => {
      console.error(error)
    })
}
```

è·‘æ­¥ã€‚checkIfDone()å°†æ‰§è¡Œ isDone()æ‰¿è¯ºï¼Œå¹¶ä½¿ç”¨ then å›è°ƒç­‰å¾…å®ƒè§£å†³ã€‚å¦‚æœæœ‰é”™è¯¯ï¼Œå°†åœ¨ catch å—ä¸­å¤„ç†ã€‚

# è¿é”æ‰¿è¯º

ä¸€ä¸ªæ‰¿è¯ºå¯ä»¥è½¬åŒ–ä¸ºå¦ä¸€ä¸ªæ‰¿è¯ºï¼Œå½¢æˆä¸€ä¸ªæ‰¿è¯ºé“¾ã€‚å¦‚æœä¸€ä¸ªäººè¾œè´Ÿäº†æ‰€æœ‰å…¶ä»–äººã€‚é“¾æ¥ä¸ Promise ç»“åˆèµ·æ¥éå¸¸å¼ºå¤§ï¼Œå› ä¸ºå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ä»£ç ä¸­äº‹ä»¶çš„é¡ºåºã€‚

```
new Promise(function(resolve, reject) {

  setTimeout(() => resolve(1), 1000); 

}).then(function(result) { 

  alert(result); 
  return result * 3;

}).then(function(result) { 

  alert(result); 
  return result * 4;

}).then(function(result) {

  alert(result); 
  return result * 6;

});
```

æ‰€æœ‰çš„æ“ä½œéƒ½å°†ç»“æœè¿”å›ç»™ä¸‹ä¸€ä¸ª`then()`å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°é“¾å®Œæˆã€‚é“¾ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ è¿”å›æœ€ç»ˆç»“æœã€‚

# ç»“è®º

è¿™åªæ˜¯ JavaScript æ‰¿è¯ºçš„ä¸€ä¸ªåŸºæœ¬è¦ç‚¹ã€‚å¦‚æœä»¥æ­£ç¡®çš„æ–¹å¼å’Œåœ¨æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨ï¼Œæ‰¿è¯ºå¯ä»¥åšå¾—æ›´å¤šã€‚

å¸Œæœ›ä½ å–œæ¬¢é˜…è¯»ã€‚åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘

ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘

![](img/4d3476c89e650a0b9c0920e2511f45d3.png)

Source: Google