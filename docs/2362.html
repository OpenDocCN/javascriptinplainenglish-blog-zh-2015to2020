<html>
<head>
<title>6 Must-Know Things About Cross-Origin Resource Sharing (CORS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于跨源资源共享的6件必知之事(CORS)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/6-must-know-things-about-cross-origin-resource-sharing-cors-aaca9703c904?source=collection_archive---------0-----------------------#2020-06-17">https://javascript.plainenglish.io/6-must-know-things-about-cross-origin-resource-sharing-cors-aaca9703c904?source=collection_archive---------0-----------------------#2020-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/69749b504d0d17e422edcb05fd39ae8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8tSdpkiL3S_FzVzt"/></div></div></figure></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><h2 id="cebf" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">TLDR；</h2><p id="d06e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated">由于<strong class="ld ir">同源政策，没有<strong class="ld ir"> CORS，</strong>网站<strong class="ld ir">被</strong>限制只能<strong class="ld ir">访问</strong>来自同一域名的</strong>资源。换句话说，如果没有CORS，我们无法请求Spotify(不同来源的服务器)提供的API数据，因为我的网站<code class="fe lw lx ly lz b">www.gplee.com</code>与<code class="fe lw lx ly lz b">www.spotify.com</code>不是同一个来源</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dc2e990cef27496b1b6e49aae5a4824d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kM6K7zCGS5s_ZRRg.png"/></div></div></figure><p id="d86a" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">总之，<strong class="ld ir"> CORS </strong>比纯粹的同源请求允许更多的自由和功能，但比简单地允许所有跨源请求更安全</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/0a05a5a6ea8fb22e4f05f005aa5572aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8kwaoYbUogBBAhnS.png"/></div></div></figure><h1 id="ee61" class="mk kg iq bd kh ml mm mn kk mo mp mq kn mr ms mt kr mu mv mw kv mx my mz kz na bi translated">1.什么是跨源资源共享(CORS)？</h1><p id="b9ce" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated">CORS是一种<strong class="ld ir">安全机制</strong>，允许来自一个域或来源的网页访问不同域的资源(<strong class="ld ir">跨域请求)</strong></p><p id="5b67" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">如果没有像CORS这样的功能，网站就会被限制只能通过所谓的同源策略访问来自同一来源的资源</p><p id="e9cf" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">经常有这样的情况，你需要对<code class="fe lw lx ly lz b">https://api.mydomain.com</code>或<code class="fe lw lx ly lz b">https://mydomain</code>进行AJAX(即Axios)调用，整合你的Node.js服务器或一些第三方字体或分析提供商，如Google Analytics。<strong class="ld ir">跨源资源共享(CORS) </strong>支持这些跨域请求</p><blockquote class="nb"><p id="53d7" class="nc nd iq bd ne nf ng nh ni nj nk lv dk translated">允许跨域请求，绕过同源策略</p></blockquote><figure class="nm nn no np nq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/e60d77acd499ce978c4f12774d454fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OPUSWkDOjilkA9Ai.png"/></div></div></figure><h1 id="9e0a" class="mk kg iq bd kh ml mm mn kk mo mp mq kn mr ms mt kr mu mv mw kv mx my mz kz na bi translated">2.什么是<strong class="ak">同源政策？</strong></h1><p id="ce68" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated"><strong class="ld ir">同源策略</strong>是一个关键的安全机制，它限制从一个源加载的文档或脚本如何与另一个源的资源交互</p><p id="8de3" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">它有助于隔离潜在的<strong class="ld ir">恶意</strong>文档，减少可能的攻击媒介，如<strong class="ld ir"> CSRF攻击</strong></p><blockquote class="nb"><p id="c4fa" class="nc nd iq bd ne nf ng nh ni nj nk lv dk translated">同源策略是web应用的安全模型</p></blockquote><figure class="nm nn no np nq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/67754263376d75ad7d1d25ff4c2607e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LxbUXHyTwk11hwG-.png"/></div></div></figure><h1 id="706c" class="mk kg iq bd kh ml mm mn kk mo mp mq kn mr ms mt kr mu mv mw kv mx my mz kz na bi translated">3.什么是跨域漏洞？</h1><p id="e50d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated"><strong class="ld ir">同源策略</strong>通过将HTTP调用限制在同一来源(即浏览器选项卡的域)，关闭了一些黑客后门，如跨站点请求伪造(CSRF) (CSRF令牌仍然是必要的)</p><p id="7104" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">浏览器允许网站以cookies的形式将信息存储在客户的计算机上</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/cee1f1d6632eadec84ec06297d36e0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*72mpzLAyUKxj1kbG.png"/></div></div></figure><p id="ddbb" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">饼干的优点【在CORS的背景下】</strong></p><ul class=""><li id="aa6b" class="ns nt iq ld b le me li mf ko nu ks nv kw nw lv nx ny nz oa bi translated">浏览器存储cookie(如cookie的名称、创建时间、用户信息等信息)，因此每当用户向可访问该cookie的域发出请求时，cookie就会被发送到该域的服务器</li><li id="1ac5" class="ns nt iq ld b le ob li oc ko od ks oe kw of lv nx ny nz oa bi translated">不需要不断从服务器检索用户信息；方便我们在客户端(用户的浏览器)存储和检索信息</li></ul><pre class="ma mb mc md gt og lz oh oi aw oj bi"><span id="e9f1" class="kf kg iq lz b gy ok ol l om on">Cookie: cookiename=chocolate;<br/>Domain=.bakery.com; <br/>Path=/ [//  ;otherDdata]</span></pre><p id="e4ed" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">饼干的缺点【在CORS的语境下】</strong></p><ul class=""><li id="d131" class="ns nt iq ld b le me li mf ko nu ks nv kw nw lv nx ny nz oa bi translated"><code class="fe lw lx ly lz b">malicious-site.com</code>可以在用户不知情的情况下将这些cookies发送给<code class="fe lw lx ly lz b">your-bank.com</code></li><li id="3e5f" class="ns nt iq ld b le ob li oc ko od ks oe kw of lv nx ny nz oa bi translated">如果您访问了恶意网站，并且没有同源策略，恶意用户可以下订单从您的帐户向他的帐户转移1000美元，您可能不喜欢这样😞</li></ul></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><h1 id="8148" class="mk kg iq bd kh ml oo mn kk mo op mq kn mr oq mt kr mu or mw kv mx os mz kz na bi translated">4.“起源”的定义是什么？</h1><p id="58bf" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated">在这一点上，有人可能想知道<strong class="ld ir">起源</strong>的定义🤔</p><p id="e62c" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">来源</strong>包括协议、域和端口的组合。换句话说，</p><p id="4b98" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">以下URL是不同的来源</p><pre class="ma mb mc md gt og lz oh oi aw oj bi"><span id="da79" class="kf kg iq lz b gy ok ol l om on"><a class="ae ot" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a> vs. https://www.<strong class="lz ir">api</strong>.google.com</span><span id="66cb" class="kf kg iq lz b gy ou ol l om on"><a class="ae ot" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank">http://localhost:9000</a> vs. <a class="ae ot" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></span></pre><p id="7028" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">虽然以下URL是相同的来源</p><pre class="ma mb mc md gt og lz oh oi aw oj bi"><span id="71b7" class="kf kg iq lz b gy ok ol l om on"><a class="ae ot" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank">http://w</a>ww.example.com/dir/page.html <br/>vs. <br/><a class="ae ot" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank">http://w</a>ww.example.com/dir/page2.html</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ov"><img src="../Images/b25d6ae73534a0dea088c4be9d0be2ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w3Jqz8mW2HZG_y-r.png"/></div></div></figure></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><h1 id="85b4" class="mk kg iq bd kh ml oo mn kk mo op mq kn mr oq mt kr mu or mw kv mx os mz kz na bi translated">5.CORS是如何运作的</h1><p id="460d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated">有两种类型的CORS请求</p><ol class=""><li id="2c50" class="ns nt iq ld b le me li mf ko nu ks nv kw nw lv ow ny nz oa bi translated">简单的请求</li><li id="c98f" class="ns nt iq ld b le ob li oc ko od ks oe kw of lv ow ny nz oa bi translated">预检请求</li></ol><p id="8257" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir"> 1。简单的请求</strong></p><p id="6027" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">不需要飞行前请求的CORS请求</p><p id="5b96" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第一步</strong></p><p id="f0e8" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">向<code class="fe lw lx ly lz b">https://www.mydomain.com</code>打开的浏览器标签向<code class="fe lw lx ly lz b">https://api.domains.com/widgets</code>发起AJAX请求<code class="fe lw lx ly lz b">GET</code></p><p id="724b" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第二步</strong></p><p id="de90" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">除了添加像<code class="fe lw lx ly lz b">Host</code>这样的头之外，浏览器还会自动为跨源请求添加<code class="fe lw lx ly lz b">Origin</code>请求头</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="7e20" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第三步</strong></p><p id="6384" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">服务器检查<code class="fe lw lx ly lz b">Origin</code>请求头。如果允许原始值，它将<code class="fe lw lx ly lz b">Access-Control-Allow-Origin</code>设置为请求报头<code class="fe lw lx ly lz b">Origin</code>中的值</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="f7a9" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第四步</strong></p><p id="94a1" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">当浏览器收到响应时，浏览器会检查<code class="fe lw lx ly lz b">Access-Control-Allow-Origin</code>标题，看它是否与选项卡的原点匹配</p><p id="7bfe" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">否则，响应将被阻止</p><pre class="ma mb mc md gt og lz oh oi aw oj bi"><span id="1059" class="kf kg iq lz b gy ok ol l om on"><strong class="lz ir">Access-Control-Allow-Origin: * </strong>allows all origins<br/>--&gt; a large security risk</span></pre><p id="871a" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir"> 2。预检请求</strong></p><p id="f566" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">预触发请求是一种CORS请求，在发送请求之前，浏览器需要发送一个<strong class="ld ir">预触发</strong>请求，请求被<strong class="ld ir">预触发以询问服务器是否允许原始CORS请求继续进行</strong></p><p id="6595" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">如果</strong>出现以下情况，任何CORS请求都必须被预先审核</p><ul class=""><li id="80f1" class="ns nt iq ld b le me li mf ko nu ks nv kw nw lv nx ny nz oa bi translated"><strong class="ld ir"> AJAX调用将JSON数据发布到REST API，意思是</strong> <code class="fe lw lx ly lz b"><strong class="ld ir">Content-Type</strong></code> <strong class="ld ir">头是</strong> <code class="fe lw lx ly lz b"><strong class="ld ir">application/json</strong></code> <strong class="ld ir"> → RESTful API请求</strong></li><li id="803a" class="ns nt iq ld b le ob li oc ko od ks oe kw of lv nx ny nz oa bi translated">AJAX调用一个API，该API使用一个令牌来验证请求头中的API，如<code class="fe lw lx ly lz b">Authorization</code> → <strong class="ld ir">使用令牌授权请求</strong></li></ul><p id="9aa9" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第一步</strong></p><p id="fb0a" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">浏览器首先发送<code class="fe lw lx ly lz b">OPTIONS</code>请求(也称为预检请求)</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="75f1" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第二步</strong></p><p id="ec7c" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">服务器返回指定允许的HTTP方法和头。如果最初的CORS请求打算发送列表中没有的报头或HTTP方法，<strong class="ld ir">失败</strong></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="dcd6" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第三步</strong></p><p id="ace6" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">由于<strong class="ld ir">头和方法</strong>通过了检查<code class="fe lw lx ly lz b">200 OK</code>，浏览器发送原始的CORS请求(请求中的<code class="fe lw lx ly lz b">Origin</code>头)</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="d696" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第四步</strong></p><p id="8f6f" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">响应在<code class="fe lw lx ly lz b">Access-Control-Allow-Origin</code>标题中有正确的来源，因此检查通过，控制权交还给浏览器选项卡</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><h1 id="a330" class="mk kg iq bd kh ml mm mn kk mo mp mq kn mr ms mt kr mu mv mw kv mx my mz kz na bi translated">6.如何使用Node.js实现CORS</h1><p id="9192" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated"><em class="oz">*对于语言和后端框架，实现请求头以设置CORS是不同的* </em></p><p id="da6b" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">我们将使用Node.js / Express。</p><p id="5663" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated"><strong class="ld ir">第一步</strong></p><p id="bdb9" class="pw-post-body-paragraph lb lc iq ld b le me lg lh li mf lk ll ko mg ln lo ks mh lq lr kw mi lt lu lv ij bi translated">安装CORS中间件:</p><pre class="ma mb mc md gt og lz oh oi aw oj bi"><span id="36de" class="kf kg iq lz b gy ok ol l om on">$ npm install cors</span></pre><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ox oy l"/></div></figure><h1 id="a3a7" class="mk kg iq bd kh ml mm mn kk mo mp mq kn mr ms mt kr mu mv mw kv mx my mz kz na bi translated">就是这样！</h1></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><h2 id="0f2a" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="c127" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae ot" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir">订阅我们的YouTube频道</strong> </a> <strong class="ld ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>