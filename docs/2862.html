<html>
<head>
<title>Building a Calendar Heatmap with SVG and React.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SVG和React.js构建日历热图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-calendar-heatmap-with-svg-and-react-js-6751b19a2d95?source=collection_archive---------4-----------------------#2020-07-30">https://javascript.plainenglish.io/building-a-calendar-heatmap-with-svg-and-react-js-6751b19a2d95?source=collection_archive---------4-----------------------#2020-07-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="cb12" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">跳舞句法</h2><div class=""/><div class=""><h2 id="839b" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">通过数据可视化支持情感自我意识</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7dc25ab8a16f9573f75258304c5e5c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kidklsO9gEqsnXm1l9hBQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">A Calendar — Photo by <a class="ae lb" href="https://unsplash.com/@nhillier" rel="noopener ugc nofollow" target="_blank">Nick Hiller</a> on Unsplash.</figcaption></figure><h1 id="51b3" class="lc ld in bd le lf lg lh li lj lk ll lm kc ln kd lo kf lp kg lq ki lr kj ls lt bi translated">介绍</h1><p id="8a75" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">2016年，在我大学一年半后，我暂停了我的学术计划，以便在我们的母亲无法照顾我的弟弟妹妹。我的一些非常棒的朋友帮助我，最终收养了她(实际上我也是！).</p><p id="2d82" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">在我们稳定下来后，我有一种强烈的冲动，想回去学些除了舞蹈以外的东西，最终我去了熨斗学校。我已经有五年没有在类似学校的环境中生活了，所以管理压力和自我照顾是很困难的。我与自我保健意识的斗争启发我开发了一个应用程序来帮助人们更好地管理他们的保健。</p><p id="22d4" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">在为我的应用程序做前期规划时，我联系了我在脸书的朋友，问他们喜欢和不喜欢自我保健应用程序的什么。几分钟内我收到了60多封回复。这些回复帮助我的应用形成了一些用户故事。一个特别的回答是:</p><blockquote class="mv mw mx"><p id="c2c9" class="lu lv my lw b lx mq jx lz ma mr ka mc mz ms mf mg na mt mj mk nb mu mn mo mp ig bi translated">如果有某种简单的数据可视化工具来显示你每天的感受会很酷，这样你就可以跟踪它，并知道什么时候你需要花更多的时间给自己。像日历这样简单的东西，你用颜色来表示情绪，比如黄色=焦虑，等等。</p></blockquote><p id="1603" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">我认为这将是超级酷的，在阅读这个建议的时候，我不太知道我将如何做，我害怕在编程中使用日期，但我开始完成它，所以让我们做吧！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/0c6c34377adce1d1bfcfc1df49b758e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFd4cpcJqT8EP69-TKkc-Q.png"/></div></div></figure><h1 id="10d8" class="lc ld in bd le lf lg lh li lj lk ll lm kc ln kd lo kf lp kg lq ki lr kj ls lt bi translated">有趣的部分</h1><h2 id="cf0e" class="nd ld in bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls it bi translated">最有价值球员</h2><p id="5706" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">为了做到这一点，我知道我需要记录一些事情:</p><ul class=""><li id="fc78" class="no np in lw b lx mq ma mr md nq mh nr ml ns mp nt nu nv nw bi translated">用户可以从感觉列表中选择</li><li id="37db" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp nt nu nv nw bi translated">每种感觉被映射到该感觉的显示颜色</li><li id="2dce" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp nt nu nv nw bi translated">一个动态的、功能性的日历，当感觉被报告时，在给定的一天显示感觉的颜色</li></ul><p id="1213" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">我决定最小可行产品，或“滑板”版本，将我的感觉分为“需求满足”和“需求未满足”两类→然后是母词类别→然后是高度具体的感觉词。我这样做是为了支持一个用户深化他们的<em class="my">情感粒度</em>(读作:具体理解)。例如，报告你感到被授权比自信更有用、更具体。我做了一些研究，从217个感觉词开始。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oc"><img src="../Images/7d59d2a35b18814bec555ec67a88f3bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqqFQrvcixnigB4VtpEOJg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">A portion of the 217 words I collected</figcaption></figure><p id="ad56" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">我还决定，既然我有这么多单词，我将只把颜色分配给两个最高级别的类别，满意和不满意。这将使事情变得简单，我计划在未来的重构中做更多的研究，寻找更好的词，并将颜色映射到感觉上。</p><h2 id="32aa" class="nd ld in bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls it bi translated">环境</h2><p id="5230" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">我使用Ruby on Rails作为后端API，PostgreSQL作为我的数据库。我的前端客户端使用React.js。</p><h2 id="410d" class="nd ld in bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls it bi translated">准备SVG</h2><p id="22bf" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">对于我的项目，我很高兴与两位设计师<a class="od oe ep" href="https://medium.com/u/4d2e5b0cbc9f?source=post_page-----6751b19a2d95--------------------------------" rel="noopener" target="_blank"> Anna Wu </a>和<a class="od oe ep" href="https://medium.com/u/86339748ded5?source=post_page-----6751b19a2d95--------------------------------" rel="noopener" target="_blank"> Kendra Jenel </a>合作。他们为我创造了这个图形:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi of"><img src="../Images/99120250febf7a48a71b4976b8c1f7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SVSCfzhr0fy5Jx3ZkdlDvA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Ex. 1 Concept Calendar with colored squares to indicate feelings reported</figcaption></figure><p id="8857" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">从Figma导出为SVG后，我编辑了SVG，使单元格具有相同的空白填充颜色，并调整了第一个突出显示Ex中当前日期的单元格的大小。1.现在看起来是这样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi og"><img src="../Images/76a2a21dc43210ee7fdb2a812f18640e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*inK8GcoFfwINE9ufYzbBeQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Blank Concept Calendar</figcaption></figure><p id="41d5" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">从那里我转到<a class="ae lb" href="https://svg2jsx.com/" rel="noopener ugc nofollow" target="_blank"> SVGtoJSX </a>以便快速将该SVG转化为反应组分。您必须这样做，因为并非所有SVG属性在JSX都有效。例如:笔画宽度=有效SVG，笔画宽度=有效JSX。</p><p id="6a8c" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">SVGtoJSX还允许您切换标识的存在，确定您想要一个函数组件还是类组件，以及记忆和切换单引号或双引号。</p><p id="c45a" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">毕竟，我们有一个反应组件可以使用。</p><p id="df4e" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">目前，显示的月份是一个SVG <code class="fe oh oi oj ok b">&lt;path&gt;</code>，这意味着它不是文本，而是作为一系列属性绘制，告诉客户在哪里、如何以及绘制什么。</p><pre class="km kn ko kp gt ol ok om on aw oo bi"><span id="0258" class="nd ld in ok b gy op oq l or os">&lt;path id="July" d="M160.477 32.18C159.673 32.18 158.929 32.024 158.245 31.712C157.573 31.388 157.021 30.938 156.589 30.362L157.921 28.76C158.617 29.72 159.451 30.2 160.423 30.2C161.731 30.2 162.385 29.426 162.385 27.878V21.362H157.903V19.4H164.725V27.752C164.725 29.228 164.365 30.338 163.645 31.082C162.925 31.814 161.869 32.18 160.477 32.18ZM177.097 22.388V32H174.955V30.776C174.595 31.208 174.145 31.544 173.605 31.784C173.065 32.012 172.483 32.126 171.859 32.126C170.575 32.126 169.561 31.772 168.817 31.064C168.085 30.344 167.719 29.282 167.719 27.878V22.388H169.969V27.572C169.969 28.436 170.161 29.084 170.545 29.516C170.941 29.936 171.499 30.146 172.219 30.146C173.023 30.146 173.659 29.9 174.127 29.408C174.607 28.904 174.847 28.184 174.847 27.248V22.388H177.097ZM180.043 18.644H182.293V32H180.043V18.644ZM194.247 22.388L189.747 32.774C189.327 33.818 188.817 34.55 188.217 34.97C187.617 35.402 186.891 35.618 186.039 35.618C185.559 35.618 185.085 35.54 184.617 35.384C184.149 35.228 183.765 35.012 183.465 34.736L184.365 33.08C184.581 33.284 184.833 33.446 185.121 33.566C185.421 33.686 185.721 33.746 186.021 33.746C186.417 33.746 186.741 33.644 186.993 33.44C187.257 33.236 187.497 32.894 187.713 32.414L187.875 32.036L183.681 22.388H186.021L189.045 29.498L192.087 22.388H194.247Z" fill="black"/&gt;,</span></pre><p id="ac26" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">为了控制显示哪个月，我制作了这些路径的数组和一个基于状态渲染那个月的函数<code class="fe oh oi oj ok b">&lt;path&gt;</code>。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Github gist showing the SVG Calendar Month paths</figcaption></figure><p id="e725" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">重构点:我可能会在以后回来，把它变成一个对象，用当前月份作为获取月份路径的关键。</p><p id="9103" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">最后，我给所有日历的SVG矩形一个日期属性设置为<code class="fe oh oi oj ok b">"blank",</code>，然后我将<code class="fe oh oi oj ok b">&lt;rect&gt;&lt;/rect&gt;</code>节点包装成代表周的行组。然后给每一行<code class="fe oh oi oj ok b">&lt;g&gt;&lt;/g&gt;</code>一个id，并将整个日历包装成一组，给它一个id和<code class="fe oh oi oj ok b">onClick</code>事件监听器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/0c6c34377adce1d1bfcfc1df49b758e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFd4cpcJqT8EP69-TKkc-Q.png"/></div></div></figure><h1 id="88a4" class="lc ld in bd le lf lg lh li lj lk ll lm kc ln kd lo kf lp kg lq ki lr kj ls lt bi translated">日历功能</h1><h2 id="543f" class="nd ld in bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls it bi translated">设置</h2><p id="7f2e" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">我采取的第一步是定义一些状态来跟踪当天、当月和当年。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Github gist showing some initial code setup</figcaption></figure><p id="02c1" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">在每个功能中，我定义了一个常数<code class="fe oh oi oj ok b">date</code>并将其设置为等于<code class="fe oh oi oj ok b">new Date()</code>。根据市场发展网络:</p><blockquote class="mv mw mx"><p id="6f51" class="lu lv my lw b lx mq jx lz ma mr ka mc mz ms mf mg na mt mj mk nb mu mn mo mp ig bi translated">JavaScript <code class="fe oh oi oj ok b"><strong class="lw ix">Date</strong></code>对象以独立于平台的格式表示时间中的某个时刻。<code class="fe oh oi oj ok b">Date</code>对象包含表示自1970年1月1日UTC以来的毫秒数的<code class="fe oh oi oj ok b">Number</code>。</p></blockquote><p id="c2dd" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">当我写这篇文章时，今天是7月29日星期三，所以不带参数调用<code class="fe oh oi oj ok b">new Date()</code>给我一个今天日期的date对象，时间是我发起date()调用的时间。它以人类可读的格式显示GMT偏移和我的本地时区。</p><pre class="km kn ko kp gt ol ok om on aw oo bi"><span id="da1f" class="nd ld in ok b gy op oq l or os">new Date()<br/>//=&gt; Wed Jul 29 2020 13:07:23 GMT-0700 (Pacific Daylight Time)</span></pre><p id="d56e" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">我之所以使用<code class="fe oh oi oj ok b">toLocaleString</code>方法，是为了让这种方法适应不同时区的未来，但我可能会在以后对其进行重构。</p><p id="886d" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">下一步是获取给定月份的第一天和给定月份的天数。</p><p id="e2af" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">我在Medium上找到了<a class="ae lb" href="https://medium.com/@nitinpatel_20236/challenge-of-building-a-calendar-with-pure-javascript-a86f1303267d" rel="noopener">Nitin Patel</a>的这篇博文，它帮助我找到了如何获得这些数据的方法(谢谢！).Patel正在使用原始CSS和JavaScript生成他们的整个日历，这非常酷，所以来看看这个额外的挑战吧。</p><pre class="km kn ko kp gt ol ok om on aw oo bi"><span id="e439" class="nd ld in ok b gy op oq l or os">// 1. Get days in given month, for given year.</span><span id="b2c3" class="nd ld in ok b gy ov oq l or os">       daysInMonth = (iMonth, iYear) =&gt; {<br/>         return 32 - new Date(iYear, iMonth, 32).getDate();<br/>       }</span><span id="ee93" class="nd ld in ok b gy ov oq l or os">a. new Date(2020, 0, 32)<br/>//=&gt; Sat Feb 01 2020 00:00:00 GMT-0800 (Pacific Standard Time)</span><span id="4399" class="nd ld in ok b gy ov oq l or os">b. new Date(2020, 0, 32).getDate()<br/>//=&gt; 1</span><span id="14b7" class="nd ld in ok b gy ov oq l or os">c. 32 - 1 <br/>//=&gt; 31</span><span id="c596" class="nd ld in ok b gy ov oq l or os">//Jan 31st!</span><span id="27c6" class="nd ld in ok b gy ov oq l or os">// 2. Get first day in given month, for given year.</span><span id="2b85" class="nd ld in ok b gy ov oq l or os">       let firstDay = (new Date(year, month)).getDay();</span><span id="9e58" class="nd ld in ok b gy ov oq l or os">a. new Date(2020, 0)<br/>//=&gt; Wed Jan 01 2020 00:00:00 GMT-0800 (Pacific Standard Time)</span><span id="265c" class="nd ld in ok b gy ov oq l or os">b. (new Date(2020, 0)).getDay();<br/>//=&gt; 3</span><span id="4a71" class="nd ld in ok b gy ov oq l or os">//Wednesday!</span></pre><p id="d5a3" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">在函数1中，<code class="fe oh oi oj ok b">new Date(iYear, iMonth, 32).getDate()</code>返回当月第一天之后第32天的数值。JavaScript从0开始计算月份，方法<code class="fe oh oi oj ok b">getDay()</code>返回星期几，也从0开始计算。我们从32中减去这个数字，得到上个月的最后一天。</p><blockquote class="mv mw mx"><p id="79a9" class="lu lv my lw b lx mq jx lz ma mr ka mc mz ms mf mg na mt mj mk nb mu mn mo mp ig bi translated"><strong class="lw ix">注意:</strong>所有设置状态和填充日历的函数都在<code class="fe oh oi oj ok b">componentDidMount</code>内调用。</p></blockquote><pre class="km kn ko kp gt ol ok om on aw oo bi"><span id="fac2" class="nd ld in ok b gy op oq l or os">componentDidMount(){</span><span id="6409" class="nd ld in ok b gy ov oq l or os">this.setMonth()</span><span id="9d40" class="nd ld in ok b gy ov oq l or os">this.setYear()</span><span id="49b8" class="nd ld in ok b gy ov oq l or os">this.setCurrent()</span><span id="0b94" class="nd ld in ok b gy ov oq l or os">this.populateCalendar(new Date().getFullYear(), new Date().getMonth())</span><span id="da9a" class="nd ld in ok b gy ov oq l or os">}</span></pre><p id="2c0d" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">现在我已经完成了这个初始设置，我可以继续用日期填充日历了。</p><h2 id="a759" class="nd ld in bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls it bi translated">回环-脱环！</h2><p id="5c53" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">现在是有趣的部分:循环！</p><p id="4edb" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">首先，我向我构造函数添加一个引用，并将该引用附加到代表月份的<code class="fe oh oi oj ok b">&lt;g&gt;&lt;/g&gt;</code>上。React refs为我们提供了一种引用和访问DOM节点的方法。您可以通过调用<code class="fe oh oi oj ok b">this.namedRef</code>上的<code class="fe oh oi oj ok b">.current</code>来访问附加的节点。</p><pre class="km kn ko kp gt ol ok om on aw oo bi"><span id="dd44" class="nd ld in ok b gy op oq l or os">constructor(props){<br/>   super(props)<br/>   this.monthRef = React.createRef()<br/>}</span><span id="4529" class="nd ld in ok b gy ov oq l or os">...further down in file</span><span id="b37c" class="nd ld in ok b gy ov oq l or os">&lt;g id="month" ref={this.monthRef} onClick={this.handleClick}&gt;<br/>...Week rows and Day Rectangles<br/>&lt;/g&gt;</span></pre><p id="5374" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">现在，我将定义我的函数，它将接受一个数字年和月，并定义我将需要开始我的loopalooza的变量。这是代码，下面是一步一步的操作。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Github gist showing the code to loop over the calendar nodes.</figcaption></figure><h2 id="2450" class="nd ld in bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls it bi translated">逐步地</h2><ol class=""><li id="ed33" class="no np in lw b lx ly ma mb md ow mh ox ml oy mp oz nu nv nw bi translated">使用for循环遍历整个月份，<code class="fe oh oi oj ok b">cal.current.children</code>将返回一个HTMLCollection，这是我们表示周的行。行迭代的每一步都将把我们带到新的一周。</li><li id="ae37" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">定义一个代表当前迭代周的子日的变量<code class="fe oh oi oj ok b">&lt;rect&gt;&lt;/rect&gt;</code>。</li><li id="7daa" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">再次遍历该周，定义一个变量来表示当前迭代日<code class="fe oh oi oj ok b">&lt;rect&gt;&lt;/rect&gt;</code>。</li><li id="d3a7" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">现在我们已经迭代了整个结构，我们可以开始在每个<code class="fe oh oi oj ok b">&lt;rect&gt;&lt;/rect&gt;.</code>上填充日期属性</li><li id="4d10" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">检查我们是否在第一次迭代，第二次迭代的数值是否小于<code class="fe oh oi oj ok b">firstDay</code>的值。如果为真，则继续迭代。这将使每个矩形上的日期属性“空白”，直到我们找到一周中合适的一天开始赋值。</li><li id="05ae" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">检查<code class="fe oh oi oj ok b">date</code>变量的数值是否大于<code class="fe oh oi oj ok b">daysInMonth</code>函数返回的数值。如果是真的，我们已经完成了赋值，我们可以打破循环。我们将在循环之外增加<code class="fe oh oi oj ok b">date</code></li><li id="f401" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">在嵌套循环的当前步骤访问<code class="fe oh oi oj ok b">currentCell</code>的属性，并用<code class="fe oh oi oj ok b">date</code>变量的值更新日期值。</li><li id="ccde" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">检查<code class="fe oh oi oj ok b">date</code>、<code class="fe oh oi oj ok b">month</code>、<code class="fe oh oi oj ok b">year</code>的值在状态下是否等同于今天的日期，如果是，则调整<code class="fe oh oi oj ok b">currentCell</code>的样式，突出当月的当天。由于高亮显示是矩形周围的黑色轮廓，我不得不减小矩形的大小并绘制轮廓，这将使我的矩形向上移动2.5像素，向左移动3像素。该块中的最后两行将重新定位单元格，使其与其他单元格正确对应。</li><li id="3633" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">对于我们的下一个技巧，即让我们进入更大事物的部分，我们将定义两个变量来存储满意和不满意类别感觉的计数，并映射用户报告的感觉。</li><li id="a82c" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">在地图中，定义一个变量来保存感觉对象，这是过滤与用户感觉的<code class="fe oh oi oj ok b">“feeling_id”</code>匹配的特定感觉ID的感觉列表的结果</li><li id="6fa3" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated">定义一个读取用户感觉的<code class="fe oh oi oj ok b">“created_at”</code>属性的变量，并获取记录创建日期的数字日号<code class="fe oh oi oj ok b">.getUTCDate()</code>。</li></ol><p id="e06e" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">#11非常重要。在我的开发环境中，PostgreSQL会将我的“created_at”日期存储为UTC(协调世界时)的表示形式，格式为YYYY-MM-DD-HH:MM:SS:MS，但是在JavaScript方面，我的记录被转换为ISO8601格式字符串，如下所示:<code class="fe oh oi oj ok b">2020–07–01T02:32:21.580Z</code></p><p id="eb61" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">“T”将日期与时间分开，“Z”代表“祖鲁语”，表示UTC时间零偏移的区域名称。看看这个例子。</p><pre class="km kn ko kp gt ol ok om on aw oo bi"><span id="a2ff" class="nd ld in ok b gy op oq l or os">Rails/PostGresQL:</span><span id="ed7d" class="nd ld in ok b gy ov oq l or os">Records "created_at" stored as UTC:</span><span id="268a" class="nd ld in ok b gy ov oq l or os">2020-07-01 02:32:21.580076</span><span id="4693" class="nd ld in ok b gy ov oq l or os">Parse in JS (local time is the default):<br/>new Date(“2020-07-01 02:32:21.580076”)</span><span id="b45d" class="nd ld in ok b gy ov oq l or os">//=&gt; Wed Jul 01 2020 02:32:21 GMT-0700 (Pacific Daylight Time)<br/></span><span id="f2ea" class="nd ld in ok b gy ov oq l or os">The same Record's "created_at" on the JavaScript side in ISO8601 format:</span><span id="a6df" class="nd ld in ok b gy ov oq l or os">2020–07–01T02:32:21.580Z</span><span id="4a3e" class="nd ld in ok b gy ov oq l or os">Parse in JS:<br/>new Date(“2020–07–01T02:32:21.580Z”)</span><span id="ec37" class="nd ld in ok b gy ov oq l or os">//=&gt; Tue Jun 30 2020 19:32:21 GMT-0700 (Pacific Daylight Time)</span><span id="3c72" class="nd ld in ok b gy ov oq l or os">Uh oh! We've lost the offset and it thinks it's the previous day</span><span id="b84d" class="nd ld in ok b gy ov oq l or os">new Date("2020-07-01T02:32:21.580Z").getDate()</span><span id="9042" class="nd ld in ok b gy ov oq l or os">//=&gt; 30</span><span id="7eb2" class="nd ld in ok b gy ov oq l or os">Fixed!</span><span id="d544" class="nd ld in ok b gy ov oq l or os">new Date("2020-07-01T02:32:21.580Z").getUTCDate()</span><span id="1066" class="nd ld in ok b gy ov oq l or os">//=&gt; 1</span></pre><p id="9986" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">我们需要指定不是假设本地时间，而是希望基于UTC计算日期，因此调用<code class="fe oh oi oj ok b">.getUTCDate</code>会给出不受时区限制的正确日期。</p><p id="2c78" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">12.既然我们的日期已经被正确解析，我们可以检查一下<code class="fe oh oi oj ok b">currentCell</code>的新日期值是否等同于用户报告感受的<code class="fe oh oi oj ok b">“created_at”</code>日期。</p><p id="f0f5" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">13.使用三元组来增加当天满足或不满足的计数</p><p id="a486" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">14.最后，我们可以通过比较<code class="fe oh oi oj ok b">satisfiedCount</code>和<code class="fe oh oi oj ok b">unsatisfiedCount</code>来检查选择<code class="fe oh oi oj ok b">currentCell</code>的填充颜色。让我们打开调试器，看看这个宝贝是如何工作的！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/9b7e4da2970b40d044625043270502b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*zSjJDjeqp7XyQAMluEb_3Q.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Stepping through the iterations to watch the calendar populate.</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/0c6c34377adce1d1bfcfc1df49b758e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFd4cpcJqT8EP69-TKkc-Q.png"/></div></div></figure><h1 id="d450" class="lc ld in bd le lf lg lh li lj lk ll lm kc ln kd lo kf lp kg lq ki lr kj ls lt bi translated">结论</h1><p id="e642" class="pw-post-body-paragraph lu lv in lw b lx ly jx lz ma mb ka mc md me mf mg mh mi mj mk ml mm mn mo mp ig bi translated">我们成功了！这真的很有趣，也很有挑战性。我感到特别高兴的是，我对如何在JavaScript中处理日期有了更好的理解。我有一些未来的重构，但我很高兴它现在正在工作。</p><p id="4b1f" class="pw-post-body-paragraph lu lv in lw b lx mq jx lz ma mr ka mc md ms mf mg mh mt mj mk ml mu mn mo mp ig bi translated">你引以为豪的建筑是什么？有什么问题吗？请在评论中告诉我！</p><ol class=""><li id="66d4" class="no np in lw b lx mq ma mr md nq mh nr ml ns mp oz nu nv nw bi translated"><a class="ae lb" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/Date" rel="noopener ugc nofollow" target="_blank">日期构造器— MDN </a></li><li id="e728" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated"><a class="ae lb" href="https://en.wikipedia.org/wiki/ISO_8601" rel="noopener ugc nofollow" target="_blank"> ISO8601 —维基百科</a></li><li id="1afb" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated"><a class="ae lb" href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" rel="noopener ugc nofollow" target="_blank">协调世界时—维基百科</a></li><li id="6a49" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated"><a class="ae lb" href="https://www.timeanddate.com/time/gmt-utc-time.html" rel="noopener ugc nofollow" target="_blank"> GMT与UTC —时间和日期</a></li><li id="6137" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated"><a class="ae lb" href="https://medium.com/@nitinpatel_20236/challenge-of-building-a-calendar-with-pure-javascript-a86f1303267d" rel="noopener">用纯JavaScript构建日历的挑战</a>——<a class="od oe ep" href="https://medium.com/u/fae9d84f67cb?source=post_page-----6751b19a2d95--------------------------------" rel="noopener" target="_blank">Nitin Patel</a></li><li id="b63e" class="no np in lw b lx nx ma ny md nz mh oa ml ob mp oz nu nv nw bi translated"><a class="ae lb" href="https://svg2jsx.com/" rel="noopener ugc nofollow" target="_blank"> SVGtoJSX </a></li></ol></div></div>    
</body>
</html>