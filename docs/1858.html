<html>
<head>
<title>The Practical Guide to React Testing Library with TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript反应测试库的实用指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-practical-guide-to-start-react-testing-library-with-typescript-d386804a018?source=collection_archive---------1-----------------------#2020-04-29">https://javascript.plainenglish.io/the-practical-guide-to-start-react-testing-library-with-typescript-d386804a018?source=collection_archive---------1-----------------------#2020-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/09f889bfdd1bfc9ac2853fd8cc6464be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbiK9pdSzunrPBcOrFFF9A.png"/></div></div></figure><p id="7818" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个人都知道编写测试对于软件开发来说非常重要。它使我们能够以更少的错误更快地修改代码。</p><p id="171b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">说到前端，<code class="fe kw kx ky kz b">React Testing Library</code>越来越受欢迎，因为与<code class="fe kw kx ky kz b">enzyme</code>相比，它更容易测试React钩子。然而，用TypeScript解释它的文章并不多。</p><p id="4608" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以本指南主要关注如何用<code class="fe kw kx ky kz b">React Testing Library</code>用TypeScript编写测试。</p><p id="fd89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想了解React测试库的其他主题，请参考下面的文章。</p><ul class=""><li id="d687" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/javascript-in-plain-english/how-to-write-the-basic-aaa-pattern-tests-with-react-testing-library-and-typescript-6836173d656b" rel="noopener">如何用React测试库和TypeScript编写测试:今天实现基本的AAA测试模式</a></li><li id="4184" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/@egctoru/how-to-setup-react-testing-library-for-material-ui-styled-component-with-typescript-556decbcbb55" rel="noopener">如何用TypeScript为材质UI样式的组件设置React测试库</a></li><li id="9eaa" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/@egctoru/snapshots-of-material-ui-styled-component-with-react-testing-library-and-typescript-d82d7d926d2c" rel="noopener">带有React测试库和类型脚本的材质UI样式组件的快照</a></li></ul><h1 id="b04f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">反应测试库</h1><p id="bf04" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">它是由在PayPal工作的Kent C Dodds创建的，他是前端TDD的先驱。React测试库的首要原则是</p><blockquote class="ms mt mu"><p id="823c" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated">你的测试越像你的软件被使用的方式，它们就越能给你信心。</p></blockquote><p id="dab6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它的意图是你的测试应该像用户如何操作一样工作，而不是你的应用程序如何实现。</p><p id="7044" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">React测试库包(名为<code class="fe kw kx ky kz b">@testing-library/react</code>)是<code class="fe kw kx ky kz b">@testing-library</code>家族中的一员。家族的核心库，<code class="fe kw kx ky kz b">@testing-library/dom</code>提供了React、Anguler、Vue的通用API。但是如果使用React之类的框架，就要使用包装器库，<code class="fe kw kx ky kz b">@testing-library/react</code>。</p><p id="64e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于一个测试框架，它说React测试库可以在任何测试框架中工作。另一方面，因为许多文章和人都在用它来开玩笑，所以本指南也用JEST。</p><h1 id="c4fa" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">设置演示应用程序</h1><p id="c1b3" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">因为自己编码比较好，所以准备了一个演示应用，叫我的口袋妖怪。</p><p id="04ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">科技栈在下面。</p><ul class=""><li id="c8ba" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">反应</li><li id="d86f" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated">以打字打的文件</li><li id="70b2" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated">反应路由器</li><li id="a24f" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated">Redux</li><li id="b348" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated">材料-用户界面</li><li id="1c24" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated">其他(webpack、babel、eslint、prettier、<a class="ae lj" href="https://pokeapi.co/" rel="noopener ugc nofollow" target="_blank"> PokéAPI </a>)</li></ul><p id="126f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我想解释如何用Redux、react-router和Material-UI编写测试，所以tech stack有点复杂。</p><p id="a33e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以浏览Pokedex，添加喜欢的口袋妖怪为<code class="fe kw kx ky kz b">My Pokemons</code>。</p><ul class=""><li id="2785" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">主页:“/”</li></ul><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/af19a6e06b75add405c6d63f90162a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7aWxOr-TnSpFLDHnQCcwSw.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Home</figcaption></figure><ul class=""><li id="8695" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">pokedex:“/口袋妖怪”</li></ul><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/476912d6fd5641bfb0a1cfe0f408c024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Z0pyKbPk8vGYgM2H4oeJA.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Pokedex</figcaption></figure><ul class=""><li id="1940" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">口袋妖怪详细信息:"/口袋妖怪/:id "</li></ul><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/a0a2347aa83ef0bc48fcf9a98edbac60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HjecfdItJTNZb00mL9mUaQ.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Pokemon Detail</figcaption></figure><ul class=""><li id="dbf0" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">我的口袋妖怪:“/我的_口袋妖怪”</li></ul><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/59f1676fdd9f822e50385a5df7cbe109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tB-ms6p9n-58Ia5VHRXilg.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">My Pokemons</figcaption></figure><p id="1ab1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您愿意，请复制此回购。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="e559" class="np lq iq kz b gy nq nr l ns nt">git clone <a class="ae lj" href="https://github.com/egurinko/react-testing-library-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/egurinko/react-testing-library-demo.git</a></span></pre><h1 id="309a" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">安装软件包</h1><p id="739f" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">让我们为React-Testing-Library添加包。你需要的在下面。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="373c" class="np lq iq kz b gy nq nr l ns nt">yarn add -D <a class="ae lj" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react <a class="ae lj" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/jest-dom jest</span></pre><p id="f1a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">@testing-library/jest-dom</code>为JEST提供自定义DOM匹配器。这让你的考试生活变得更容易。</p><p id="a5b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于TypeScript，应该添加一些包。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="7b57" class="np lq iq kz b gy nq nr l ns nt">yarn add -D ts-jest <a class="ae lj" href="http://twitter.com/types/jest" rel="noopener ugc nofollow" target="_blank">@types/jest</a> <a class="ae lj" href="http://twitter.com/types/testing-library__react" rel="noopener ugc nofollow" target="_blank">@types/testing-library__react</a> <a class="ae lj" href="http://twitter.com/types/testing-library__jest-dom" rel="noopener ugc nofollow" target="_blank">@types/testing-library__jest-dom</a></span></pre><p id="ce0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">@types</code>包是每个包的类型文件。<code class="fe kw kx ky kz b">ts-jest</code>是TypeScript的JEST预处理器。它使您能够进行类型检查。</p><h1 id="9c64" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">设置</h1><p id="4550" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">先设置Jest和TypeScript！只需运行下面的一个命令。它使用TypeScript设置创建一个jest配置文件(jest.config.js)。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="90ca" class="np lq iq kz b gy nq nr l ns nt">yarn ts-jest config:init</span></pre><p id="ab91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在编写测试之前，如果需要，请添加<code class="fe kw kx ky kz b">eslint</code>设置，因为<code class="fe kw kx ky kz b">eslint</code>不知道测试框架代码。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="da09" class="np lq iq kz b gy nq nr l ns nt">// .eslintrc.json</span><span id="fedd" class="np lq iq kz b gy nu nr l ns nt">{<br/>  ...<br/>  "env": {<br/>    "browser": true,<br/>    "jest": true       // ADD THIS<br/>  }<br/>  ...<br/>}</span></pre><p id="b9df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们写第一个测试。因为我想在src目录下创建测试文件，所以请创建一个名为<code class="fe kw kx ky kz b">__test__</code>的测试目录。JEST自动检测出<code class="fe kw kx ky kz b">__test__</code>下的文件是测试文件。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="cac2" class="np lq iq kz b gy nq nr l ns nt">// src/__test__/integration/first.spec.ts</span><span id="ccf0" class="np lq iq kz b gy nu nr l ns nt">it('runs the first test', () =&gt; {<br/>  expect(true).toBe(true);<br/>});</span></pre><p id="9c6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为通常会创建其他类型的文件，如配置、模拟，所以我通常为纯测试文件创建集成目录。</p><p id="4cc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要轻松运行JEST测试，我推荐你创建如下的yarn脚本。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="b234" class="np lq iq kz b gy nq nr l ns nt">// package.json</span><span id="0c89" class="np lq iq kz b gy nu nr l ns nt">....</span><span id="9bbb" class="np lq iq kz b gy nu nr l ns nt">"scripts": {<br/>  ....<br/>  "check-types": "tsc",<br/>  "test": "jest"<br/>}</span><span id="8563" class="np lq iq kz b gy nu nr l ns nt">....</span></pre><p id="79b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">准备好进行第一次测试了。去做吧！</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="daf5" class="np lq iq kz b gy nq nr l ns nt">yarn test</span><span id="9bac" class="np lq iq kz b gy nu nr l ns nt">$ jest<br/> PASS  src/__test__/integration/first.spec.ts<br/>  ✓ runs the first test (2ms)</span><span id="43c9" class="np lq iq kz b gy nu nr l ns nt">Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   0 total<br/>Time:        2.141s, estimated 3s<br/>Ran all test suites.<br/>✨  Done in 3.50s.</span></pre><p id="e10c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜🎉🎉</p><h1 id="e5d0" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">用React测试库编写第一个测试</h1><p id="8da1" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">上面的测试不是React测试库的测试。这只是一个玩笑测试。所以让我们用React测试库写一个简单的组件测试。</p><p id="4b31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的口袋妖怪回购里最简单的组件就是<code class="fe kw kx ky kz b">src/components/NotFound.tsx</code>。它只有普通的html标签和文本。没有Redux，没有Material UI，没有react-router，但是有TypeScript。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="d1e8" class="np lq iq kz b gy nq nr l ns nt">// <!-- -->src/components/NotFound.tsx</span><span id="68c0" class="np lq iq kz b gy nu nr l ns nt">import React from 'react';</span><span id="6d0d" class="np lq iq kz b gy nu nr l ns nt">const NotFound: React.FC&lt;{}&gt; = () =&gt; (<br/>  &lt;div&gt;<br/>    &lt;h1&gt;Not Found&lt;/h1&gt;<br/>    &lt;h1&gt;404&lt;/h1&gt;<br/>  &lt;/div&gt;<br/>);</span><span id="f4eb" class="np lq iq kz b gy nu nr l ns nt">export default NotFound;</span></pre><p id="7cb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以请将第一个测试重命名为notFound.spec.tsx，并编写一个简单的测试。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="c341" class="np lq iq kz b gy nq nr l ns nt">// src/__test__/notFound.spec.tsx</span><span id="9961" class="np lq iq kz b gy nu nr l ns nt">import * as React from 'react';<br/>import { render, RenderResult } from '@testing-library/react';<br/>import NotFound from '../../components/NotFound';</span><span id="7db9" class="np lq iq kz b gy nu nr l ns nt">let documentBody: RenderResult;</span><span id="b6e3" class="np lq iq kz b gy nu nr l ns nt">describe('&lt;NotFound /&gt;', () =&gt; {<br/>  beforeEach(() =&gt; {<br/>    documentBody = render(&lt;NotFound /&gt;);<br/>  });</span><span id="e10b" class="np lq iq kz b gy nu nr l ns nt">  it('shows not found message', () =&gt; {<br/>    expect(documentBody.getByText('Not Found')).toBeInTheDocument();<br/>    expect(documentBody.getByText('404')).toBeInTheDocument();<br/>  });<br/>});</span></pre><p id="7494" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b"><a class="ae lj" href="https://testing-library.com/docs/react-testing-library/api#render" rel="noopener ugc nofollow" target="_blank">render</a></code> API将你传递的组件呈现为<code class="fe kw kx ky kz b">document.body</code>下的一个参数。它返回<code class="fe kw kx ky kz b">RenderResult</code>。如果你对<code class="fe kw kx ky kz b">RenderResult</code>更感兴趣，请自行查看。您可以了解使用<code class="fe kw kx ky kz b">render</code> API可以做什么。</p><p id="a5d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来测试一下。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/6a7071a06e69be4138d32cfbd4a04ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCCZxs92Bsa31qE6RHgv6A.png"/></div></div></figure><p id="dbfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯🤔上面写着<code class="fe kw kx ky kz b">using the wrong test environment. Consider using the "jsdom" test environment</code>。因为jest.config.js中当前环境设置为<code class="fe kw kx ky kz b">node</code>。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="e2b3" class="np lq iq kz b gy nq nr l ns nt">// jest.config.js</span><span id="2b21" class="np lq iq kz b gy nu nr l ns nt">module.exports = {<br/>  preset: 'ts-jest',<br/>  testEnvironment: 'node',<br/>};</span></pre><p id="0cf0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是节点环境不能处理DOM。所以请把<code class="fe kw kx ky kz b">testEnvironment</code>改成<code class="fe kw kx ky kz b">jsdom</code>。</p><p id="a5e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仍然出现错误🤔</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/8d2af09cab2a9df00e7b4777d1b42e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0R48kYD8lr0-LgYBxEaHw.png"/></div></div></figure><p id="aad5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为<code class="fe kw kx ky kz b">toBeInTheDocument</code> matcher来自<code class="fe kw kx ky kz b">@testing-library/jest-dom</code>。如果导入<code class="fe kw kx ky kz b">@testing-library/jest-dom</code>，测试将会成功。</p><p id="a452" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，在所有文件中编写重要的句子是没有效率的。因此，让我们创建一个JEST配置来实现全局导入<code class="fe kw kx ky kz b">@testing-library/jest-dom</code>。</p><p id="86e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，请创建配置文件。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="a792" class="np lq iq kz b gy nq nr l ns nt">// src/__test__/config/importJestDOM.ts</span><span id="fbb5" class="np lq iq kz b gy nu nr l ns nt">import '@testing-library/jest-dom';</span></pre><p id="52fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并将文件添加到jest.config.js的<code class="fe kw kx ky kz b">setupFilesAfterEnv</code>中，如下所示。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="dded" class="np lq iq kz b gy nq nr l ns nt">// jest.config.js<br/>module.exports = {<br/>  preset: 'ts-jest',<br/>  testEnvironment: 'jsdom',<br/>  setupFilesAfterEnv:['&lt;rootDir&gt;/src/__test__/config/importJestDOM.ts']<br/>};</span></pre><p id="b572" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用setupFilesAfterEnv，您可以在执行每个测试文件之前运行任何模块。</p><p id="e25c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在第一个考验就要通过了！！</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="79a3" class="np lq iq kz b gy nq nr l ns nt">PASS  src/__test__/integration/notFound.spec.tsx<br/>  &lt;NotFound /&gt;<br/>    ✓ shows not found message (23ms)</span><span id="db20" class="np lq iq kz b gy nu nr l ns nt">Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   0 total<br/>Time:        1.48s, estimated 4s<br/>Ran all test suites.<br/>✨  Done in 2.58s.</span></pre><h1 id="5f8e" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">固定文本的快照测试</h1><p id="3b5d" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">如果你想在应用程序中测试固定文本，你不必在测试中编写固定文本，因为你必须在应用程序和测试中管理固定文本。</p><p id="4e8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，快照测试是有效的。您获取组件快照并提交给GitHub。如果更改了固定文本，只需更新快照并再次提交即可。</p><p id="47e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代码本身非常简单。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="e11a" class="np lq iq kz b gy nq nr l ns nt">// src/__test__/integration/notFound.spec.tsx</span><span id="11e8" class="np lq iq kz b gy nu nr l ns nt">.....</span><span id="dc41" class="np lq iq kz b gy nu nr l ns nt">describe('&lt;NotFound /&gt;', () =&gt; {<br/>  beforeEach(() =&gt; {<br/>    documentBody = render(&lt;NotFound /&gt;);<br/>  });</span><span id="4f12" class="np lq iq kz b gy nu nr l ns nt">  it('matches snapshot', () =&gt; {<br/>    const { baseElement } = documentBody;<br/>    expect(baseElement).toMatchSnapshot();<br/>  });<br/>})</span></pre><p id="f777" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你再也不用在测试中写固定的文本了。</p><p id="cae8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您第一次运行快照测试时，<code class="fe kw kx ky kz b">__snapshot__</code>目录和<code class="fe kw kx ky kz b">.snap</code>文件将如下创建。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="3815" class="np lq iq kz b gy nq nr l ns nt">// src/__test__/integration/__snapshots__/notFound.spec.tsx.snap</span><span id="ca0e" class="np lq iq kz b gy nu nr l ns nt">exports[`&lt;NotFound /&gt; matches snapshot 1`] = `<br/>  &lt;body&gt;<br/>    &lt;div&gt;<br/>      &lt;div&gt;<br/>        &lt;h1&gt;Not Found&lt;/h1&gt;<br/>        &lt;h1&gt;404&lt;/h1&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;<br/>`;</span></pre><p id="831b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你更新一些东西时，你的测试会失败。但是如果是有意的更改，您可以使用<code class="fe kw kx ky kz b">--updateSnapshot</code>选项运行测试并提交它。</p><p id="e35c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">※注意<br/>快照测试非常容易，但是对于大组件来说有一些缺点。如果你想知道有效的快照，请点击链接</p><div class="nx ny gp gr nz oa"><a href="https://kentcdodds.com/blog/effective-snapshot-testing" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">有效的快照测试</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">我想我最近一直在尝试，我保证这篇时事通讯以后会深入研究更多的东西。但是…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">kentcdodds.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo jw oa"/></div></div></a></div><h1 id="aff9" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">额外:处理静态资产</h1><p id="787b" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">因为<code class="fe kw kx ky kz b">NotFound</code>的例子没有样式表和图片这样的静态资产。但是如果你用它们测试一个组件，它会失败，因为jest不能解析。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/f2b96e318d50e206ff5194c6b574dae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26fizE2HDNbeYeASUdx4tw.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Error with static assets</figcaption></figure><p id="f753" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了避免这种错误，您应该模仿静态资产。</p><div class="nx ny gp gr nz oa"><a href="https://jestjs.io/docs/en/webpack#handling-static-assets" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">与webpack Jest一起使用</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Jest可以用在使用[web pack](https://web pack . js . org/)管理资产、样式和编译的项目中…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">jet js . io</p></div></div><div class="oj l"><div class="oq l ol om on oj oo jw oa"/></div></div></a></div><p id="37bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本例中，创建模拟文件。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="4011" class="np lq iq kz b gy nq nr l ns nt">// src/__test__/mock/styleMock.ts</span><span id="6679" class="np lq iq kz b gy nu nr l ns nt">export default {};</span><span id="8b4b" class="np lq iq kz b gy nu nr l ns nt">// src/__test__/mock/fileMock.ts</span><span id="5132" class="np lq iq kz b gy nu nr l ns nt">export default "test-file-stub";</span></pre><p id="8626" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并在<code class="fe kw kx ky kz b">jest.config.js</code>的moduleNameMapper中使用它们。ModuleNameMapper用您指定的内容替换了一些模块。</p><pre class="na nb nc nd gt nl kz nm nn aw no bi"><span id="bb3d" class="np lq iq kz b gy nq nr l ns nt">// jest.config.js</span><span id="6f3f" class="np lq iq kz b gy nu nr l ns nt">module.exports = {<br/>  preset: 'ts-jest',<br/>  testEnvironment: 'jsdom',<br/>  setupFilesAfterEnv: ['&lt;rootDir&gt;/src/__test__/config/importJestDOM.ts'],<br/>  moduleNameMapper: {<br/>    "\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$": "&lt;rootDir&gt;/src/__test__/mock/fileMock.ts",<br/>    "\\.(css|less)$": "&lt;rootDir&gt;/src/__test__/mock/styleMock.ts"<br/>  }<br/>};</span></pre><p id="df07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用这个选项，您可以将静态资产包含到您的测试中🎉</p></div><div class="ab cl or os hu ot" role="separator"><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow"/></div><div class="ij ik il im in"><p id="1527" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文重点介绍如何用TypeScript设置JEST和React测试库，并运行第一个测试。因为我写了其他关于React测试库的文章，喜欢的话可以去看看。</p><ul class=""><li id="dddd" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/javascript-in-plain-english/how-to-write-the-basic-aaa-pattern-tests-with-react-testing-library-and-typescript-6836173d656b" rel="noopener">如何用React测试库和类型脚本编写测试:今天实现基本的AAA测试模式</a></li><li id="b85f" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/@egctoru/how-to-setup-react-testing-library-for-material-ui-styled-component-with-typescript-556decbcbb55" rel="noopener">如何用TypeScript设置材质UI风格组件的React测试库</a></li><li id="014b" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/@egctoru/snapshots-of-material-ui-styled-component-with-react-testing-library-and-typescript-d82d7d926d2c" rel="noopener">带有React测试库和类型脚本的材质UI样式组件的快照</a></li></ul><p id="63b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢大家！</p><h2 id="87d3" class="np lq iq bd lr oy oz dn lv pa pb dp lz kj pc pd md kn pe pf mh kr pg ph ml pi bi translated">参考</h2><ul class=""><li id="5424" class="la lb iq ka b kb mn kf mo kj pj kn pk kr pl kv lf lg lh li bi translated"><a class="ae lj" href="https://testing-library.com/" rel="noopener ugc nofollow" target="_blank">测试库</a></li><li id="0631" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated"><a class="ae lj" href="https://jestjs.io/en/" rel="noopener ugc nofollow" target="_blank">笑话</a></li><li id="9e90" class="la lb iq ka b kb lk kf ll kj lm kn ln kr lo kv lf lg lh li bi translated"><a class="ae lj" href="https://github.com/kulshekhar/ts-jest" rel="noopener ugc nofollow" target="_blank"> ts-jest </a></li></ul><h2 id="0efd" class="np lq iq bd lr oy oz dn lv pa pb dp lz kj pc pd md kn pe pf mh kr pg ph ml pi bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="0e63" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">我们已经推出了三种新的出版物！为我们的新出版物献上一点爱心吧，请跟随他们:<a class="ae lj" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ka ir">AI in Plain English</strong></a>，<a class="ae lj" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ka ir">UX in Plain English</strong></a>，<a class="ae lj" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ka ir">Python in Plain English</strong></a><strong class="ka ir"/>——谢谢，继续学习！</p><p id="4261" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至:<a class="ae lj" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">submissions @ plain English . io</strong></a><strong class="ka ir"/>，使用您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>