<html>
<head>
<title>How to compare huge CSV files in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中比较巨大的CSV文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-compare-csv-files-with-millions-records-using-javascript-a2654a88c376?source=collection_archive---------0-----------------------#2020-03-20">https://javascript.plainenglish.io/how-to-compare-csv-files-with-millions-records-using-javascript-a2654a88c376?source=collection_archive---------0-----------------------#2020-03-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="73af" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何开始用JavaScript测试大数据</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/3f8303e704ffbeb65b384b0549af8b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hf9xbXIxf4OZtWKDm8z25w.png"/></div></div></figure><h2 id="7183" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">有没有在比较和验证包含数百万条记录的大型csv文件的内容时遇到过困难？</h2><p id="30d1" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">在我参与的大数据项目中，这一直是一个挑战。</p><p id="2e59" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">在本文中，我们将查看简单的nodejs代码，以便在几秒钟内比较如此大的文件。</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="959d" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">开始创建新的目录&amp; cd到新的目录中</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="1633" class="ko kp in mq b gy mu mv l mw mx">mkdir csv-file-comparison</span><span id="3ab1" class="ko kp in mq b gy my mv l mw mx">cd csv-file-comparison</span></pre><p id="a989" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">假设您已经在系统上安装了一个nodejs。执行以下命令初始化npm项目</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="5d4c" class="ko kp in mq b gy mu mv l mw mx">npm init -y</span></pre><p id="53a0" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">安装从本地驱动器读取文件所需的fs包</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="ad43" class="ko kp in mq b gy mu mv l mw mx">npm install fs</span></pre><p id="df63" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">创建新文件，并将其命名为csvcomparison.js</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="1b92" class="ko kp in mq b gy mu mv l mw mx">touch csvcomparison.js</span></pre><p id="bd76" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">在您最喜欢的编辑器中打开CSV coma监狱. js并复制以下代码</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">csvcomparison.js</figcaption></figure><p id="f272" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">为基本文件和辅助文件创建readStream，并使用JSON objects key magic来比较它们。</p><p id="ad4d" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">将下面的代码复制到第36行之后。<code class="fe nf ng nh mq b"><strong class="lm io">generateDeltaFile</strong></code>函数有两个参数</p><p id="fa5e" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><em class="ni">第一个参数</em> —要比较的基础文件</p><p id="8a73" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><em class="ni">第二个参数</em> —与基本文件进行比较的第二个文件</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="db93" class="ko kp in mq b gy mu mv l mw mx">(async () =&gt; {</span><span id="e8a3" class="ko kp in mq b gy my mv l mw mx">    console.time("csv comparison time taken");</span><span id="ccfc" class="ko kp in mq b gy my mv l mw mx">    console.log(await generateDeltaFile('./base-file.csv',    './secondary-file.csv'))</span><span id="bc19" class="ko kp in mq b gy my mv l mw mx">    console.timeEnd("csv comparison time taken")</span><span id="f2d6" class="ko kp in mq b gy my mv l mw mx">})()</span></pre><p id="e1b5" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">确保base-file.csv和secondary-file.csv放在<code class="fe nf ng nh mq b">csv-file-comparison</code>目录中。假设这两个csv文件是有百万条记录的大数据文件。</p><p id="29c5" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">执行下面的代码来调用函数，生成一个记录不匹配的新文件。</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="2673" class="ko kp in mq b gy mu mv l mw mx">node --max_old_space_size=4096 csvcomparison.js</span></pre><p id="ee88" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">这应该会在<code class="fe nf ng nh mq b">csv-file-comparison</code>目录中生成一个新文件<code class="fe nf ng nh mq b">difference.csv</code>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/38e5c97ec642119f9b84bae6e409398b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6ohIJz0skrU4s7zm39tUw.png"/></div></div></figure><p id="328f" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">对于具有4百万条记录和3列的csv文件，这种方法大约需要8秒钟。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/48403cdde4c7534ca69e1a8088caa3b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZcN76qEsacJuQrwxsB64A.png"/></div></div></figure></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="bddf" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">更多细节请查看我的git上的代码</p><div class="nl nm gp gr nn no"><a href="https://github.com/puneetpunj/utilities/blob/master/csvcomparison.js" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd io gy z fp nt fr fs nu fu fw im bi translated">puneetpunj/公用事业</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">这个repo包含了对bash、aws等有用的工具——puneetpunj/utilities</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc km no"/></div></div></a></div></div></div>    
</body>
</html>