<html>
<head>
<title>React Tips — Errors and Redux, Commas Separated List, and Detect Page Navigation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应提示-错误和冗余，逗号分隔列表，并检测页面导航</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-tips-errors-and-redux-commas-separated-list-and-detect-pag-1dc6565febe?source=collection_archive---------12-----------------------#2020-07-27">https://javascript.plainenglish.io/react-tips-errors-and-redux-commas-separated-list-and-detect-pag-1dc6565febe?source=collection_archive---------12-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/78afe521634592cfe631df4aeed50dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7_iagy2jmuZdLOyc"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@bonniekdesign?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bonnie Kittle</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f6a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的React应用程序的技巧。</p><h1 id="0e3c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用React路由器检测用户离开页面</h1><p id="94e0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">React路由器有一个<code class="fe me mf mg mh b">Prompt</code>组件，让我们用一条消息阻止导航。</p><p id="20af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d734" class="mq lc iq mh b gy mr ms l mt mu">import { Prompt } from 'react-router'</span><span id="2b13" class="mq lc iq mh b gy mv ms l mt mu">const App  = () =&gt; (<br/>  &lt;React.Fragment&gt;<br/>    &lt;Prompt<br/>      when={shouldBlockNavigation}<br/>      message='Are you sure you want to leave?'<br/>    /&gt;<br/>    {/* more components */}<br/>  &lt;/React.Fragment&gt;<br/>)</span></pre><p id="f617" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">Prompt</code>,它接受一个带有布尔表达式的<code class="fe me mf mg mh b">when</code>提示，指示我们何时想要阻止导航。</p><p id="8c21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">message</code>是用户试图离开时显示的消息。</p><p id="2a19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将阻止任何事情，但不刷新或关闭页面。</p><p id="ab55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了阻止刷新或关闭，我们必须根据导航是否被阻止，将<code class="fe me mf mg mh b">onbeforeunload</code>属性设置为不同的值。</p><p id="2462" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7c25" class="mq lc iq mh b gy mr ms l mt mu">componentDidUpdate = () =&gt; {<br/>  if (shouldBlockNavigation) {<br/>    window.onbeforeunload = () =&gt; true<br/>  } else {<br/>    window.onbeforeunload = undefined<br/>  }<br/>}</span></pre><p id="f759" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果在刷新或关闭浏览器标签时导航应该被阻止，那么我们将它<code class="fe me mf mg mh b">window.onbeforeunload</code>设置为一个返回<code class="fe me mf mg mh b">true</code>的函数。</p><p id="ee2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们将其设置为<code class="fe me mf mg mh b">undefined</code>。</p><h1 id="c0db" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免React中的额外包装<div/></h1><p id="5433" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用一个片段来避免在组件之外包装一个额外的div。</p><p id="3f0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8e57" class="mq lc iq mh b gy mr ms l mt mu">render() {<br/>  return (<br/>    &lt;React.Fragment&gt;<br/>      &lt;ChildA /&gt;<br/>      &lt;ChildB /&gt;<br/>      &lt;ChildC /&gt;<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>}</span></pre><p id="f74b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5d7d" class="mq lc iq mh b gy mr ms l mt mu">render() {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;ChildA /&gt;<br/>      &lt;ChildB /&gt;<br/>      &lt;ChildC /&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span></pre><h1 id="f624" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">处理react-redux中的提取错误</h1><p id="68c8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用redux-thunk创建一个异步动作，调用<code class="fe me mf mg mh b">dispatch</code>在出错时调度同步动作。</p><p id="da46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="12f0" class="mq lc iq mh b gy mr ms l mt mu">export function getData() {<br/>  return dispatch =&gt; {<br/>    dispatch({type: FETCH });</span><span id="a12f" class="mq lc iq mh b gy mv ms l mt mu">    httpClient.get('/data')<br/>      .then(res =&gt; {<br/>        dispatch({ type: FETCH_SUCCESS, data: res.body });<br/>      })<br/>      .catch(error =&gt; {<br/>        dispatch({type: FAILED });             <br/>        dispatch({type: ADD_ERROR, error });      <br/>      });<br/>  };<br/>}</span></pre><p id="7f3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个thunk，它获取数据并调用<code class="fe me mf mg mh b">dispatch</code>来分派各种动作。</p><p id="c70e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的<code class="fe me mf mg mh b">errors</code>减速器中，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4fde" class="mq lc iq mh b gy mr ms l mt mu">function errors(state = [], action) {<br/>  switch (action.type) {<br/>    case ADD_ERROR:<br/>      return [...state, action.error];<br/>    case REMOVE_ERROR:<br/>      return state.filter((error, i) =&gt; i !== action.index);<br/>    default:<br/>      return state;<br/>  }<br/>}</span></pre><p id="7fb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个<code class="fe me mf mg mh b">errors</code>减速器，它有一个<code class="fe me mf mg mh b">ADD_ERROR</code>箱用来增加误差，另一个箱用来消除给定的误差。</p><p id="ce12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下代码将<code class="fe me mf mg mh b">errors</code>状态映射到props:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5e8c" class="mq lc iq mh b gy mr ms l mt mu">export default connect(<br/>  state =&gt; ({<br/>    errors: state.errors,<br/>  })<br/>)(App);</span></pre><p id="228f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中<code class="fe me mf mg mh b">App</code>是反应元件。</p><h1 id="c704" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">告诉运行时在浏览器中运行的React版本</h1><p id="25b9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以获取<code class="fe me mf mg mh b">React.version</code>属性来获取运行在浏览器中的React版本。</p><p id="9cbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7209" class="mq lc iq mh b gy mr ms l mt mu">npm view react version<br/>npm view react-native version</span></pre><p id="7468" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以获得React版本。</p><p id="5562" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">require(‘React’).version</code>也管用。</p><h1 id="a4e0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用React路由器删除浏览器中的/#/</h1><p id="4ff3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要用React Roytee从URL中删除散列符号，我们可以使用<code class="fe me mf mg mh b">BrowserRouter</code>作为路由根标签。</p><p id="59db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8f95" class="mq lc iq mh b gy mr ms l mt mu">import BrowserRouter from 'react-router/BrowserRouter'</span><span id="98f4" class="mq lc iq mh b gy mv ms l mt mu">ReactDOM.render (( <br/>  &lt;BrowserRouter&gt;<br/>   {//...}<br/>  &lt;BrowserRouter&gt; <br/>), document.body);</span></pre><p id="cd70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要重写URL以重定向到<code class="fe me mf mg mh b">index.html</code>，这样我们在加载或刷新页面时就不会出错:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="01cf" class="mq lc iq mh b gy mr ms l mt mu"># Setting up apache options<br/>AddDefaultCharset utf-8<br/>Options +FollowSymlinks -MultiViews -Indexes<br/>RewriteEngine on</span><span id="83a5" class="mq lc iq mh b gy mv ms l mt mu"># Defining the rewrite rules<br/>RewriteCond %{SCRIPT_FILENAME} !-d<br/>RewriteCond %{SCRIPT_FILENAME} !-f</span><span id="bcdb" class="mq lc iq mh b gy mv ms l mt mu">RewriteRule ^.*$ ./index.html</span></pre><p id="b369" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个配置是针对Apache服务器的。</p><h1 id="f109" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用map和reduce渲染由逗号分隔的React组件</h1><p id="d7f3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过将条目映射到组件来呈现带有<code class="fe me mf mg mh b">map</code>和<code class="fe me mf mg mh b">join</code>的React组件。</p><p id="e3ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用<code class="fe me mf mg mh b">reduce</code>在组件之间放置逗号。</p><p id="4010" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="80db" class="mq lc iq mh b gy mr ms l mt mu">class CommaList extends React.Component {<br/>  render() {<br/>     &lt;div&gt;<br/>        {this.props.data<br/>          .map(t =&gt; &lt;span&gt;{t}&lt;/span&gt;)<br/>          .reduce((combined, curr) =&gt; [combined, ', ', curr])}<br/>     &lt;/div&gt;<br/>  }<br/>}</span></pre><p id="adfe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到了<code class="fe me mf mg mh b">data</code>道具，这是一个数组。</p><p id="307c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">map</code>将它们映射到组件。</p><p id="c9b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">reduce</code>在已经用逗号连接的组件之间添加逗号，这些组件存储在<code class="fe me mf mg mh b">combined </code>中，新组件存储在<code class="fe me mf mg mh b">curr</code>中。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/8526f5891e26bacab03a8c7044be9f71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vf6mAJXl3f2dVqma"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@ohaikatherine?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Katherine McAdoo</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f74f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="8a9e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在React路由器中检测用户离开页面的情况。</p><p id="a6b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">reduce</code>将逗号分隔的组件组合成一个数组。</p><p id="5ae0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，当Redux出现错误时，我们可以调度操作。</p><h1 id="d197" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">简单英语的JavaScript</h1><p id="a06a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果是这样，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>