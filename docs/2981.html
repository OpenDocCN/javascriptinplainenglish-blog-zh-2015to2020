<html>
<head>
<title>Creating a Smooth Sign In and Logout Experience with React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Native创建流畅的登录和注销体验</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-smooth-sign-in-and-logout-experience-with-react-native-62e5deffbff?source=collection_archive---------0-----------------------#2020-08-14">https://javascript.plainenglish.io/creating-a-smooth-sign-in-and-logout-experience-with-react-native-62e5deffbff?source=collection_archive---------0-----------------------#2020-08-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="b3c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个简短的教程中，我将展示如何使用React导航和React上下文以流畅和自然的方式处理应用程序认证。</p><p id="50a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我之前写的题为<a class="ae ki" href="https://medium.com/@henkcorporaal/how-to-build-animated-login-screens-with-react-native-edb81cb500aa" rel="noopener"> <em class="kj">如何用React Native </em> </a>构建动画登录屏幕的教程的后续。</p><p id="23b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里给你一个我们将要建立的印象:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi kk"><img src="../Images/f02fc8e9feac503fff11ddcdfb47e078.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/1*ad9iufjlhDw3Od955zQhBg.gif"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Life with a mac keyboard with stuck keys</figcaption></figure></div><div class="ab cl kw kx hr ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ig ih ii ij ik"><p id="d6f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> React Native Starter Kit </strong>:这个登录界面是取自<em class="kj">React Native Share Starter Kit</em>的一个样本，可以在这里购买<a class="ae ki" href="https://market.nativebase.io/view/react-native-share-app-theme" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c4e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> React原生资源:</strong>想访问这个项目的源代码和其他React原生资源？然后<a class="ae ki" href="http://knowlephant.com" rel="noopener ugc nofollow" target="_blank">注册我的简讯</a>。</p></div><div class="ab cl kw kx hr ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ig ih ii ij ik"><p id="48aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">在我们开始之前，重要的是要认识到本教程只是前端的，不会涉及后端认证验证和令牌生成。</em></p><h1 id="b981" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用全手柄容器视图组件让您的生活变得轻松</h1><p id="4b4d" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">一个典型的应用程序有许多动作，这些动作出现在整个应用程序的许多屏幕上。我在想:</p><ul class=""><li id="3bbc" class="mg mh in jm b jn jo jr js jv mi jz mj kd mk kh ml mm mn mo bi translated">背景图像</li><li id="f102" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated">键盘避免视图</li><li id="2511" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated">触摸以消除键盘交互</li><li id="4096" class="mg mh in jm b jn mp jr mq jv mr jz ms kd mt kh ml mm mn mo bi translated">加载视图</li></ul><p id="fc22" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">等等。等等..</p><p id="be48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为什么不将这些功能组合在一个handle-all ContainerView组件中，该组件可以在整个应用程序中重用？这至少是我在大多数应用程序中处理所有这些功能的方式。</p><p id="e1ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这类组件的主要挑战是，当我们不知道这些组件的形状和状态时，如何从屏幕上呈现子组件。</p><p id="89b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于有经验的开发人员来说，解决方案似乎很简单。但是每个人都有第一次…</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e7ae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…因此，解决方案是呈现儿童道具，这在您的应用程序调用的任何组件上都可用。</p><blockquote class="mw mx my"><p id="27e2" class="jk jl kj jm b jn jo jp jq jr js jt ju mz jw jx jy na ka kb kc nb ke kf kg kh ig bi translated">……<code class="fe nc nd ne nf b">this.props.children</code>的作用是当<strong class="jm io">调用</strong>一个组件时，它用来显示你在开始和结束标签之间包含的任何内容。</p><p id="621c" class="jk jl kj jm b jn jo jp jq jr js jt ju mz jw jx jy na ka kb kc nb ke kf kg kh ig bi translated">参见:<a class="ae ki" href="https://codeburst.io/a-quick-intro-to-reacts-props-children-cb3d2fce4891" rel="noopener" target="_blank">React的道具快速介绍.儿童</a></p></blockquote><p id="7756" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还要注意React Native如何为iOS和Android不同地处理<em class="kj"> KeyboardAvoidingView </em>组件，这不是很好，但上述解决方案似乎是目前的常见做法。</p><p id="221a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还要注意放置在<em class="kj"> TouchableWithoutFeedback </em>和其他子视图之间的视图组件。我的经验是，React本机可触摸组件有时会弄乱设置给其子组件的样式。</p><h1 id="e981" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用React上下文在登录和主屏幕之间导航</h1><p id="6118" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">也许这个标题似乎关闭。毕竟，使用React Native最受欢迎的导航API的典型导航操作将通过调用:</p><pre class="kl km kn ko gt ng nf nh ni aw nj bi"><span id="3ec6" class="nk le in nf b gy nl nm l nn no">navigation.navigate(“ScreenName”);</span></pre><p id="434a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是这种方法并不适用于在认证屏幕和应用程序主屏幕之间导航的情况。</p><p id="bea9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么，我们应该如何处理这种情况呢？</p><p id="62f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">答案既简单又有点复杂。</p><p id="50b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最容易的部分是简单地对应用程序中现有的身份验证标记执行检查，并根据它的存在呈现一个navigationStack或另一个。</p><p id="20c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">困难的部分是为我们的应用程序设置状态管理。这样，我们可以调度登录和注销操作，并从我们应用程序的任何屏幕更新我们的应用程序状态。我们需要访问我们的应用程序的状态，因为一旦我们收到它，它将是我们的身份验证令牌存储的地方。</p><p id="f5aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以让我们从简单的部分开始:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="f8ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…显然，这段代码不会运行，但我们会很快修复它。</p><p id="7bc7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个解决方案的伟大之处在于，一旦状态改变导致<em class="kj"> RootStackScreen </em>重新呈现，React Navigation就会立即处理导航动画。</p><h1 id="57dd" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用上下文设置商店</h1><p id="9765" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">接下来是本教程中更复杂的部分。目标是让登录按钮的按下引发一系列事件，最终导致<em class="kj"> RootStackScreen </em>的重新呈现，并由于更新的authToken状态而导航到Home。</p><p id="640e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们通过以下步骤来简化这一过程:</p><p id="2857" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤1: </strong>一旦我们按下登录按钮，我们就将一个动作对象分派给一个包含动作类型和用户认证数据的reducer。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7cc4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(注意，对于<em class="kj"> handleLogoutPress </em>实现，您可以在主屏幕中应用类似的设置。)</p><p id="9131" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤2:</strong>reducer执行类型检查，并用新的认证令牌更新状态(或者在注销时删除令牌)。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7a8f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤3: </strong>该状态更新强制重新呈现所有消耗状态的组件。这一切之所以成为可能，是因为我们将用商店组件覆盖所有屏幕…</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="06cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">…它返回保存我们的应用程序状态的上下文提供程序。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="77d3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，<em class="kj">NavigationContainerStack</em>成为整个应用程序的基本组件，因此可以访问我们的存储中的所有值。</p><p id="e7cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">步骤5: </strong>随着状态更新，我们的<strong class="jm io"> RootNavigationStack </strong>也将更新，我们可以执行现有的令牌检查(并在登录和主屏幕之间来回导航)。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="25ba" class="ld le in bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">应用程序启动时存储和检查身份验证凭据</h1><p id="7471" class="pw-post-body-paragraph jk jl in jm b jn mb jp jq jr mc jt ju jv md jx jy jz me kb kc kd mf kf kg kh ig bi translated">很好，前端登录和注销看起来工作得很好。但是，如果我们每次重新打开应用程序时都不需要提供我们的验证信息，那不是很好吗？</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi kk"><img src="../Images/75d2c58286b57dc9808f67b39374d63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/1*Oc6xy2lMI33VP-F_zOcJeQ.gif"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Something like this, perhaps?</figcaption></figure><p id="4dcb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">实际上，实现相对简单。expo-secure-store API在这里帮助了我们，因为它使我们能够在我们的设备上保存authToken的加密值。</p><p id="8bd0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们实现以下两个快速步骤，让这一切发生。</p><p id="0fbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第一步:</strong>成功登录后，用<strong class="jm io"> SecureStore </strong>存储新的authToken。你能想到实施这一步骤的最佳地点吗？</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="498b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第二步:</strong>在应用启动时使用SecureStore检查现有令牌。在哪里？我们进行所有其他令牌检查的地方:<em class="kj"> RootNavigationStack。</em></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e3e5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">仅此而已。我希望你发现这个前端登录教程是有用的。接下来，我将展示如何向您的应用程序添加社交登录。</p></div></div>    
</body>
</html>