<html>
<head>
<title>Debouncing with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript去抖</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/debouncing-with-javascript-420363f02176?source=collection_archive---------4-----------------------#2020-05-31">https://javascript.plainenglish.io/debouncing-with-javascript-420363f02176?source=collection_archive---------4-----------------------#2020-05-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6d01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从一些通用的琐事开始，去抖源于计算机硬件领域。电子设备中经常使用去抖技术来避免弹跳。弹跳是用于描述两种金属接触时触发的多个信号的术语。</p><p id="997b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在软件和web应用程序开发的环境中，去抖动可以有效地提高前端应用程序的性能。任何在浏览器端涉及复杂计算的事情都可以通过去抖动来简化或推迟一段时间。</p><p id="f75d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">例如，在调整浏览器窗口大小时获取它的坐标涉及频繁的复杂计算。使用去抖动可以最小化计算量。然而，有一种更好的方法来处理这种特殊情况——节流。虽然节流是一个值得单独在博客上发表的主题，但是去抖动最著名的用例之一是控制API调用速率。在这篇文章中，我们将演示一种使用普通JavaScript实现去抖动的方法。</p><p id="bdd8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设您的web应用程序中有一个搜索栏，它根据用户类型过滤搜索结果。通过动态过滤搜索结果，您可以为用户节省一些时间，消除多余的按钮点击，并提供更好的整体用户体验。但是，这是有代价的。您的应用服务器必须承担的成本。</p><p id="fdbe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您有使用JavaScript的经验，第一个要实现的方法是在每次击键时放置一个事件监听器。您可能会跳转到用事件侦听器来挂钩搜索栏。</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="e180" class="kr ks in kn b gy kt ku l kv kw">&lt;input type="text" onkeyup="getSearchResultsFromAPI()"&gt;</span></pre><p id="4174" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">事件侦听器应该会进行API调用。</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="d7b9" class="kr ks in kn b gy kt ku l kv kw">function getSearchResultsFromAPI(){<br/>  console.log('Making an API call..')<br/> }</span></pre><p id="a2ab" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我鼓励你尝试这样做，并思考这样做可能产生的问题。对于像“苹果iPhone”这样的基本查询，这将触发14个API调用。如果你的产品规模扩大了，(我真诚地希望如此)你会有成千上万的用户每分钟发送数百个web请求。这肯定会让您的应用服务器不堪重负。</p><p id="7089" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了减少这些web请求，我们可以使用去抖。去抖采用了一种相当简单的方法。它不是在每次击键时都发送一个HTTP调用，而是等待一段时间(比如说0.2秒)，然后只有在这0.2秒内没有其他击键时才发送一个HTTP请求。慢慢地再读最后一行。</p><p id="2aaf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果两次击键之间的时间少于0.2秒，计时器将重置。如果你输入的速度很快，很有可能你只会对完整的搜索查询提出1或2个请求。</p><p id="8f9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我制作了一个基本的React应用程序来演示这一点。链接可以在这里找到<a class="ae kx" href="http://sumit.cc/Debounce/" rel="noopener ugc nofollow" target="_blank">，Github上的代码可以在这里</a>找到<a class="ae kx" href="https://github.com/sumitmukhija/Debounce/" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="ki kj kk kl gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ky"><img src="../Images/febf16164cb2ada3129a8d159fc57194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15U9OiCC-w26s5c-Oef7jA.png"/></div></div></figure><p id="5b43" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一个普通的JavaScript实现</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="c45d" class="kr ks in kn b gy kt ku l kv kw">const debounce = (funcToExecute, executeAfter) =&gt; {        <br/>       let timer;        <br/>       return function(){<br/>            clearTimeout(timer);            <br/>            const context = this;            <br/>            const args = arguments;            <br/>            timer = setTimeout(()=&gt;{<br/>                    funcToExecute.apply(context, args)}<br/>                    , executeAfter);                       <br/>       }      <br/>}</span></pre><p id="0a3e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们首先创建一个高阶箭头函数，它有两个参数，一个是要执行的函数，另一个是以毫秒表示时间的数字(executeAfter)。这是我们希望在两次连续击键之间等待的时间。我们声明一个计时器。</p><p id="dc62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们创建一个内部函数。这是返回的函数。该函数清除现有的定时器。第一次计时器将是未定义的，这一行将没有任何影响。我们接着捕捉和争论。最后，我们使用setTimeout函数初始化计时器，并调用apply函数，该函数是我们作为参数传入的。我们希望setTimeout在我们作为第二个参数传递的毫秒数之后触发回调。</p><p id="c4cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面的JavaScript函数可以被调用为</p><pre class="ki kj kk kl gt km kn ko kp aw kq bi"><span id="c288" class="kr ks in kn b gy kt ku l kv kw">debounce(() =&gt; this.makeAPICall(), 300);</span></pre><p id="4b90" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是我要做的一切。您的web应用程序上的搜索栏现在应该发出更少的调用，我鼓励您使用开发人员工具的网络选项卡来检查这一点。我希望你喜欢这篇文章。</p><figure class="ki kj kk kl gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lg"><img src="../Images/9fb07c16b12d629309d7bcaf059a45d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zWvHcBb1LKfoZH5W.jpeg"/></div></div></figure></div><div class="ab cl lh li hr lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ig ih ii ij ik"><h2 id="f0ea" class="kr ks in bd lo lp lq dn lr ls lt dp lu jv lv lw lx jz ly lz ma kd mb mc md me bi translated"><strong class="ak">用简单英语写的便条</strong></h2><p id="d99b" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">你知道我们有四份出版物和一个YouTube频道吗？你可以在我们的主页<a class="ae kx" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> plainenglish.io </strong> </a>上找到所有这些——关注我们的出版物并<a class="ae kx" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">订阅我们的YouTube频道</strong> </a> <strong class="jm io">来表达你的爱吧！</strong></p></div></div>    
</body>
</html>