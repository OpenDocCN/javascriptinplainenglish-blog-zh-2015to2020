<html>
<head>
<title>Testing Async Redux Actions with Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest测试异步Redux操作</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/testing-async-redux-actions-with-jest-3bde5dd88607?source=collection_archive---------2-----------------------#2019-08-02">https://javascript.plainenglish.io/testing-async-redux-actions-with-jest-3bde5dd88607?source=collection_archive---------2-----------------------#2019-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b2dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好！！！我想写这个故事，是因为背后还有一个很搞笑的故事。所以，这要追溯到2年前，当我第一次被引入React，然后为actions和reducers编写单元测试用例时，我差一点！！…我想说，在我用Axios测试一些异步调用之前，我几乎可以应付自如。我搜索了整个互联网，试图找到最好的方法来做到这一点，但它真的花了我很多时间来理解如何通过它。</p><p id="c790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以今天我想分享我是如何做到的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/c5bd0729e83365889c1cff3ba2d56d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oe9IpvDL-I958aiHJ6Lidg.jpeg"/></div></div></figure><p id="0a32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们一步一步来:</p><blockquote class="kx ky kz"><p id="6367" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">redux中的异步动作是什么？</p></blockquote><p id="62ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过Redux使用异步动作的标准方式是使用<a class="ae le" href="https://github.com/gaearon/redux-thunk" rel="noopener ugc nofollow" target="_blank"> Redux Thunk中间件</a>。它在一个名为<code class="fe lf lg lh li b">redux-thunk</code>的独立包中。我们将在稍后解释中间件一般是如何工作的<a class="ae le" href="https://redux.js.org/advanced/middleware" rel="noopener ugc nofollow" target="_blank">；现在，您只需要知道一件重要的事情:通过使用这个特定的中间件，动作创建者可以返回一个函数，而不是一个动作对象。这样，动作创建者就变成了一个</a><a class="ae le" href="https://en.wikipedia.org/wiki/Thunk" rel="noopener ugc nofollow" target="_blank"> thunk </a>。</p><p id="aa11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我们来举个例子:</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lj lk l"/></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Async Action with redux</figcaption></figure><p id="b621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的要点中，我们有一个从虚拟api返回一些数据的方法。在返回一个响应后，发送一个类型和一个有效载荷，我们将测试它。</p><p id="0c2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们设置测试文件:</p><p id="21b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤1 </strong>把你的动作和类型拿到测试文件中进行测试:</p><pre class="km kn ko kp gt lp li lq lr aw ls bi"><span id="93d0" class="lt lu iq li b gy lv lw l lx ly">// action types<br/>import { GET_ALL_ITEMS } from '../compare.types'; </span><span id="4f1a" class="lt lu iq li b gy lz lw l lx ly">//action to mock<br/>import { loadItemData } from '../compare.action';</span></pre><p id="a05d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤:2 </strong>导入configureStore和thunk来测试我们的异步方法:</p><pre class="km kn ko kp gt lp li lq lr aw ls bi"><span id="e31a" class="lt lu iq li b gy lv lw l lx ly">// import configureStore to create a mock store where we will dispatch our actions<br/>import configureStore from 'redux-mock-store';</span><span id="6d2a" class="lt lu iq li b gy lz lw l lx ly">//import thunk middle to make our action asynchronous<br/>import thunk from 'redux-thunk';</span></pre><p id="cd96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤3 </strong>导入MockAdapter和thunk来测试我们的异步方法:</p><pre class="km kn ko kp gt lp li lq lr aw ls bi"><span id="fcc6" class="lt lu iq li b gy lv lw l lx ly">// important:  this i have used to mock the axios call<br/>import MockAdapter from 'axios-mock-adapter';</span><span id="a027" class="lt lu iq li b gy lz lw l lx ly">// import axios dependency<br/>import axios from 'axios';</span></pre><p id="326a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤:4 </strong>初始化存储、中间件、模拟存储和thunk</p><pre class="km kn ko kp gt lp li lq lr aw ls bi"><span id="e9e1" class="lt lu iq li b gy lv lw l lx ly">// initialise middlewares<br/>const middlewares = [thunk]; </span><span id="84ab" class="lt lu iq li b gy lz lw l lx ly">// initialise MockStore which is only the configureStore method which take middlewares as its parameters<br/>const mockStore = configureStore(middlewares); </span><span id="2078" class="lt lu iq li b gy lz lw l lx ly">//creating a mock instance from the MockAdapter of axios<br/>const mock = new MockAdapter(axios); const store = mockStore({});</span></pre><p id="a6ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤4: 启动测试套件</p><pre class="km kn ko kp gt lp li lq lr aw ls bi"><span id="5184" class="lt lu iq li b gy lv lw l lx ly">describe('Testing loadItemData()', () =&gt; { });</span></pre><p id="b932" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤5: </strong>清除商店中正在运行的任何操作</p><pre class="km kn ko kp gt lp li lq lr aw ls bi"><span id="ff92" class="lt lu iq li b gy lv lw l lx ly">describe('Testing loadItemData()', () =&gt; { <br/>   beforeEach(() =&gt; { // Runs before each test in the suite             store.clearActions();    });<br/>});</span></pre><p id="5138" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第六步:</strong>模仿你的get call，调度你的行动</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="1457" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！！！希望你已经学会了如何用Jest和Axios测试异步api调用。</p><p id="a573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！如果你有任何问题，请随时联系rajrock38@gmail.com，通过LinkedIn联系我，或者通过Medium和Twitter关注我。</p><p id="a1d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得这篇文章很有帮助，给它一些掌声会很有意义👏并分享出来帮别人找！并欢迎在下方发表评论。</p></div></div>    
</body>
</html>