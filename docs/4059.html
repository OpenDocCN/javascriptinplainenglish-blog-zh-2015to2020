<html>
<head>
<title>Running a Node.js Application on an Apache Production Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Apache生产服务器上运行Node.js应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/running-a-nodejs-application-on-an-apache-production-server-4d3cca078f94?source=collection_archive---------3-----------------------#2020-11-13">https://javascript.plainenglish.io/running-a-nodejs-application-on-an-apache-production-server-4d3cca078f94?source=collection_archive---------3-----------------------#2020-11-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e53007e6c76814fe6d5622474ae28927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSXLnDxdLPuJF4H62mQsVw.png"/></div></div></figure><p id="05fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我希望在发布我的NodeJS应用程序时找到的文章。</p><p id="1970" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我刚刚在生产服务器上部署了一个新的NodeJS应用程序，然后点击go。它工作了，很好，但是它只能通过<em class="kw"> localhost:3000 </em>访问，而我没有访问权限。</p><p id="20b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">"你如何通过一个域访问localhost:3000？"我以为。</p><p id="83d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>本文是在您有一些Linux终端经验、有ssh访问您的live服务器环境并设置了NodeJS的基础上撰写的。</p><h1 id="6eaf" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在Apache环境中使用虚拟主机将域指向NodeJS应用程序</h1><p id="2f0b" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">当在谷歌上搜索时，我真的很难找到这个问题的帮助，主要是因为解决方案只会使用一个你可能不熟悉的短语，我知道我肯定不熟悉。</p><p id="e2fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将需要设置一个<strong class="ka ir"> Apache代理虚拟主机。</strong>您还需要在您的服务器上安装Apache的mod_proxy。</p><p id="69d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还有一个问题，因为我希望是HTTPS。</p><p id="bc6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这包括在我的NodeJS应用程序中启用HTTPS模块，在我的生产服务器上生成2个证书文件，然后在我的应用程序和虚拟主机文件中引用它们。</p><p id="ab48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我当前的虚拟主机文件，因为它在我的服务器上。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2946" class="mj ky iq mf b gy mk ml l mm mn">&lt;VirtualHost *:443&gt;</span><span id="65bb" class="mj ky iq mf b gy mo ml l mm mn">ProxyPreserveHost On</span><span id="79c8" class="mj ky iq mf b gy mo ml l mm mn">#Don't include the brackets when adding your domain<br/>ServerAlias [domain alias so www.mydomain.com for example]<br/>ServerName [domain so mydomain.com]</span><span id="a12d" class="mj ky iq mf b gy mo ml l mm mn">&lt;Proxy *&gt;<br/> Order deny,allow<br/> Allow from all<br/>&lt;/Proxy&gt;</span><span id="d7e3" class="mj ky iq mf b gy mo ml l mm mn">SSLEngine on<br/>SSLProxyEngine On</span><span id="dd0c" class="mj ky iq mf b gy mo ml l mm mn">SSLCertificateFile    [path/to]/server.cert<br/>SSLCertificateKeyFile [path/to]/server.key</span><span id="9cb2" class="mj ky iq mf b gy mo ml l mm mn">SSLProxyVerify none</span><span id="83ed" class="mj ky iq mf b gy mo ml l mm mn">SSLProxyCheckPeerCN off<br/>SSLProxyCheckPeerName off<br/>SSLProxyCheckPeerExpire off</span><span id="502a" class="mj ky iq mf b gy mo ml l mm mn">ProxyPass / <a class="ae mp" href="https://127.0.0.1:3000/" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:[your port number]/</a><br/>ProxyPassReverse / <a class="ae mp" href="https://127.0.0.1:3000/" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:</a><a class="ae mp" href="https://127.0.0.1:3000/" rel="noopener ugc nofollow" target="_blank">[your port number]</a><a class="ae mp" href="https://127.0.0.1:3000/" rel="noopener ugc nofollow" target="_blank">/</a></span><span id="2514" class="mj ky iq mf b gy mo ml l mm mn">&lt;/VirtualHost&gt;</span></pre><p id="fd9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将需要创建为。您的apache2站点可用文件夹中的conf文件。</p><p id="463c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，运行下面的命令，确保这确实是保存apache2站点配置的地方(不同的Linux风格在不同的地方存放它们的apache文件),并将上面的虚拟主机示例复制到其中。</p><p id="69eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新与您的应用相关的部分。还有，我用的是nano。请使用您选择的文本编辑器。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="570b" class="mj ky iq mf b gy mk ml l mm mn">sudo nano /etc/apache2/sites-available/[my domain].conf</span></pre><p id="76dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后启用新的。conf文件并使用以下命令重新启动apache:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="3e0d" class="mj ky iq mf b gy mk ml l mm mn">sudo a2ensite [my domain].conf<br/>sudo service apache2 restart</span></pre><p id="3633" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您的应用程序已经启动并运行，那么您<em class="kw">现在应该</em>能够进入您在。conf文件夹并查看您的新站点。如果你不能确保你的路径是正确的，你已经把整个网站复制到你的服务器上，并且你已经安装了所有必要的扩展等等。</p><p id="fe17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>在基于Linux的系统上创建证书密钥非常简单，只需搜索“在Linux上创建证书”。</p><h1 id="da66" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用PM2管理生产中的应用程序</h1><p id="15ef" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在生产环境中运行您的站点对于任何环境设置来说都是令人担忧的，但是，当然，开发人员会助您一臂之力。</p><p id="898f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PM2是一个守护进程管理器，可以真正证明它在生产环境中的价值，如果你愿意，你可以在你所有的环境中使用它。</p><p id="6717" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过npm安装</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a1ba" class="mj ky iq mf b gy mk ml l mm mn">npm install pm2 -g</span></pre><p id="70c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发现PM2做了这么多，我有点敬畏它。</p><p id="54d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让它如此强大的一个原因是您可以定制生态系统配置文件来满足您的需求。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="028c" class="mj ky iq mf b gy mk ml l mm mn">module.exports = {<br/>  apps: [{<br/>    script: "app.js",<br/>    watch: ["server", "client"],<br/>    // Delay between restart<br/>    watch_delay: 1000,<br/>    ignore_watch : ["node_modules", "client/img"],<br/>    watch_options: {<br/>      "followSymlinks": false<br/>    }<br/>  }]<br/>}</span></pre><p id="4d11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这使您能够真正深入了解您的设置，并让您的应用程序完全按照您想要的方式工作。</p><p id="8184" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有一些简单易用的功能。</p><p id="97cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用一个使用PM2的名称启动应用程序:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c186" class="mj ky iq mf b gy mk ml l mm mn">pm2 start app.js --name Production Server</span></pre><p id="c856" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看您在PM2运行的应用程序:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="350d" class="mj ky iq mf b gy mk ml l mm mn">pm2 list</span></pre><p id="ab27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看与您的应用程序相关的日志:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="95c0" class="mj ky iq mf b gy mk ml l mm mn">pm2 log</span></pre><p id="08b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw">注意:</em> </strong> <em class="kw">此外，您可以使用一个</em><a class="ae mp" href="https://www.loggly.com/solution/apache-log-analyzer/" rel="noopener ugc nofollow" target="_blank"><em class="kw">Apache logs viewer</em></a><em class="kw">工具来获得有关Apache服务器的健康和性能的信息仪表板。</em></p><p id="e108" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重新启动应用程序:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="77ba" class="mj ky iq mf b gy mk ml l mm mn">pm2 restart [process number]<br/>or<br/>pm2 restart app.js</span></pre><p id="d966" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果服务器因为某种原因重启，将PM2添加到服务器启动过程中，PM2会告诉你如何完成剩下的工作:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="3718" class="mj ky iq mf b gy mk ml l mm mn">pm2 startup</span></pre><p id="1992" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以整天谈论PM2，但是他们的文档有你需要的一切，所以我建议你自己去看看它能做什么。前往<a class="ae mp" href="https://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank">https://pm2.keymetrics.io/</a>了解这个令人印象深刻的工具的更多信息。</p><h2 id="01d3" class="mj ky iq bd kz mq mr dn ld ms mt dp lh kj mu mv ll kn mw mx lp kr my mz lt na bi translated">就是这样！</h2><p id="b967" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我希望本指南对在生产环境中运行Node.js应用程序有所帮助。</p><p id="63ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有任何问题或帮助，请联系我们。</p><p id="d78a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请查看我的其他一些文章。</p><div class="nb nc gp gr nd ne"><a rel="noopener  ugc nofollow" target="_blank" href="/5-lessons-i-learned-teaching-myself-nodejs-74b5f6967dcf"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">我自学NodeJS时学到的5课</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">用了10年的灯堆，我觉得是时候尝试新的东西了。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nn l"><div class="no l np nq nr nn ns jw ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://medium.com/the-digital/how-to-get-over-90-on-google-pagespeed-insights-a85255ac9a05" rel="noopener follow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">如何在Google Pagespeed Insights上获得90分</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">除了个人走私之外，为什么还要在Chrome的Lighthouse扩展中尝试100个呢…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">medium.com</p></div></div><div class="nn l"><div class="nt l np nq nr nn ns jw ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a rel="noopener  ugc nofollow" target="_blank" href="/using-sharp-in-nodejs-to-output-resize-and-crop-images-on-the-fly-f8b150989760"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">在Node.js中使用Sharp来输出、调整大小和裁剪图像</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">这是开发人员梦寐以求的工具。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nn l"><div class="nu l np nq nr nn ns jw ne"/></div></div></a></div><p id="ea98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">更多内容看</em> <a class="ae mp" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>