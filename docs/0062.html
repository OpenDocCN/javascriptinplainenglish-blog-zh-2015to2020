<html>
<head>
<title>How to write Promises in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript写承诺</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/truly-understanding-promises-in-javascript-cb31ee487860?source=collection_archive---------1-----------------------#2019-01-07">https://javascript.plainenglish.io/truly-understanding-promises-in-javascript-cb31ee487860?source=collection_archive---------1-----------------------#2019-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/290cc03c43741205f989e421e4b65149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HzIsEP4u4N4D9AZL"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="ka kb kc"><p id="1c8c" class="kd ke kf kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><a class="ae jz" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.linkedin.com%2Fpulse%2Ftruly-understanding-promises-javascript-ashay-mandwarya%2F%3Fpublished%3Dt" rel="noopener ugc nofollow" target="_blank">点击这里在Linkedin上分享这篇文章！</a></p></blockquote><p id="0205" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">几乎所有使用过JavaScript的人都在某种程度上对它又爱又恨。JavaScript就像那个有时令人沮丧的女朋友，但她身上有一些让我们好奇的东西。JavaScript有大量有趣的主题和概念可以探索。先说其中一个——承诺。</p><figure class="lg lh li lj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lf"><img src="../Images/9121a1753aff091932c748a29463f1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nFleO7RuVXJ-WVc9"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@judeussamson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Judeus Samson</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="lk"><p id="4637" class="ll lm in bd ln lo lp lq lr ls lt lb dk translated">就像没有对话的蜘蛛侠电影是不完整的，强大的力量伴随着巨大的责任</p><p id="4148" class="ll lm in bd ln lo lu lv lw lx ly lb dk translated">没有一篇基于承诺的文章是完整的，因为它没有声明承诺会让你免于被召回的痛苦。</p></blockquote><p id="69b6" class="pw-post-body-paragraph kd ke in kg b kh lz kj kk kl ma kn ko lc mb kr ks ld mc kv kw le md kz la lb ig bi translated">但是承诺还不止这些，我将向你们展示。</p><p id="ffb5" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">JavaScript是一种同步编程语言，但是因为有了回调函数，我们可以让它像异步编程语言一样工作。</p><h1 id="620e" class="me mf in bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated"><strong class="ak">承诺</strong></h1><p id="190d" class="pw-post-body-paragraph kd ke in kg b kh nc kj kk kl nd kn ko lc ne kr ks ld nf kv kw le ng kz la lb ig bi translated">javascript中的承诺与现实生活中的承诺非常相似。</p><figure class="lg lh li lj gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ebb98c03111a9ad98f92e22fd9ee6cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*UcJSj8vyeAB_zgojmACsKw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Definition of promise -Google</figcaption></figure><ol class=""><li id="606e" class="ni nj in kg b kh ki kl km lc nk ld nl le nm lb nn no np nq bi translated">作出承诺后，我们会得到关于某事的保证，并据此制定计划。</li><li id="b3dd" class="ni nj in kg b kh nr kl ns lc nt ld nu le nv lb nn no np nq bi translated">它们可以保留，也可以被破坏。</li><li id="59c0" class="ni nj in kg b kh nr kl ns lc nt ld nu le nv lb nn no np nq bi translated">我们不能立即采取行动。只有在承诺兑现之后。</li></ol><p id="13fb" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">根据<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank"> MDN </a>:</p><p id="1e23" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated"><code class="fe nw nx ny nz b"><strong class="kg io">Promise</strong></code>对象表示异步操作的最终完成(或失败)及其结果值。</p><p id="05e3" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">玩弄承诺有两个部分-</p><ol class=""><li id="2127" class="ni nj in kg b kh ki kl km lc nk ld nl le nm lb nn no np nq bi translated">承诺的产生</li><li id="d4f7" class="ni nj in kg b kh nr kl ns lc nt ld nu le nv lb nn no np nq bi translated">承诺的处理</li></ol><h1 id="1843" class="me mf in bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">创造</h1><p id="46af" class="pw-post-body-paragraph kd ke in kg b kh nc kj kk kl nd kn ko lc ne kr ks ld nf kv kw le ng kz la lb ig bi translated">承诺有基本的蓝图</p><pre class="lg lh li lj gt oa nz ob oc aw od bi"><span id="3b1a" class="oe mf in nz b gy of og l oh oi">new Promise( /* executor */ function(resolve, reject) { ... } );<br/>                                                               --MDN</span></pre><p id="e0aa" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">执行函数(executor)接受两个参数<code class="fe nw nx ny nz b">resolve </code>和<code class="fe nw nx ny nz b">reject </code>，这两个参数又是回调函数。承诺用于处理异步操作，也称为阻塞代码，例如DB、I/O或API调用，这些调用由executor函数执行。一旦完成，它要么在成功时调用resolve函数，要么在出错时调用reject函数。</p><p id="a737" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">简单的例子</p><pre class="lg lh li lj gt oa nz ob oc aw od bi"><span id="4e9f" class="oe mf in nz b gy of og l oh oi">let promise = new Promise(function(resolve, reject) {</span><span id="4030" class="oe mf in nz b gy oj og l oh oi">if(promise_kept)<br/>  resolve("done");</span><span id="f760" class="oe mf in nz b gy oj og l oh oi">else<br/>  reject(new Error("…"));<br/>  <br/>});</span></pre><p id="9948" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">可以看出，<em class="kf">承诺不会立即返回值。它等待成功或失败，然后相应地返回。这使得异步方法像同步方法一样返回值。异步方法不是立即返回值，而是承诺返回值</em>。</p><p id="b627" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">上面一段说清楚了一件事，<em class="kf">它有状态！</em></p><p id="db31" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">承诺可以是这些状态之一-</p><ol class=""><li id="ff47" class="ni nj in kg b kh ki kl km lc nk ld nl le nm lb nn no np nq bi translated"><strong class="kg io"> <em class="kf">待定— </em> </strong>这是承诺执行过程中的初始状态。既不满足也不拒绝。</li><li id="0c4f" class="ni nj in kg b kh nr kl ns lc nt ld nu le nv lb nn no np nq bi translated"><strong class="kg io"> <em class="kf">兑现了— </em> </strong>许诺成功了。</li><li id="ac01" class="ni nj in kg b kh nr kl ns lc nt ld nu le nv lb nn no np nq bi translated"><strong class="kg io"> <em class="kf">拒绝— </em> </strong>许诺失败。</li></ol><p id="0890" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">这些州是不言自明的，所以我就不赘述了。下面是截图，供参考。</p><figure class="lg lh li lj gt jo gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/2f74ce55e216b23b1057f21afdb6aa3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*JaE8Vjaa4J3GF50xHl8B5A.png"/></div></figure><h1 id="b26f" class="me mf in bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">处理和消费承诺</h1><p id="aaa4" class="pw-post-body-paragraph kd ke in kg b kh nc kj kk kl nd kn ko lc ne kr ks ld nf kv kw le ng kz la lb ig bi translated">在上一节中，我们看到了承诺是如何产生的，现在让我们看看承诺是如何被消费的。</p><pre class="lg lh li lj gt oa nz ob oc aw od bi"><span id="e14d" class="oe mf in nz b gy of og l oh oi">const isDone = new Promise()<br/>//...<br/><br/>const checkIfDone = () =&gt; {<br/>  isDone<br/>    .then(ok =&gt; {<br/>      console.log(ok)<br/>    })<br/>    .catch(err =&gt; {<br/>      console.error(error)<br/>    })<br/>}</span></pre><p id="c966" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">跑步。checkIfDone()将执行isDone()承诺，并使用then回调等待它解决。如果有错误，将在catch块中处理。</p><h1 id="71af" class="me mf in bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">连锁承诺</h1><p id="71de" class="pw-post-body-paragraph kd ke in kg b kh nc kj kk kl nd kn ko lc ne kr ks ld nf kv kw le ng kz la lb ig bi translated">一个承诺可以转化为另一个承诺，形成一个承诺链。如果一个人辜负了所有其他人。链接与Promise结合起来非常强大，因为它让我们能够控制代码中事件的顺序。</p><pre class="lg lh li lj gt oa nz ob oc aw od bi"><span id="549a" class="oe mf in nz b gy of og l oh oi">new Promise(function(resolve, reject) {<br/><br/>  setTimeout(() =&gt; resolve(1), 1000); <br/><br/>}).then(function(result) { <br/><br/>  alert(result); <br/>  return result * 3;<br/><br/>}).then(function(result) { <br/><br/>  alert(result); <br/>  return result * 4;<br/><br/>}).then(function(result) {<br/><br/>  alert(result); <br/>  return result * 6;<br/><br/>});</span></pre><p id="58d4" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">所有的操作都将结果返回给下一个<code class="fe nw nx ny nz b">then()</code>函数，这个过程一直持续到链完成。链中的最后一个元素返回最终结果。</p><h1 id="cdf2" class="me mf in bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">结论</h1><p id="3755" class="pw-post-body-paragraph kd ke in kg b kh nc kj kk kl nd kn ko lc ne kr ks ld nf kv kw le ng kz la lb ig bi translated">这只是JavaScript承诺的一个基本要点。如果以正确的方式和在正确的地方使用，承诺可以做得更多。</p><p id="80b9" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi translated">希望你喜欢阅读。在推特上关注我</p><p id="1df8" class="pw-post-body-paragraph kd ke in kg b kh ki kj kk kl km kn ko lc kq kr ks ld ku kv kw le ky kz la lb ig bi">👏👏👏👏👏👏👏</p><figure class="lg lh li lj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ol"><img src="../Images/4d3476c89e650a0b9c0920e2511f45d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/1*emRzBhzQ4KZqG_yi4rzq8A.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Source: Google</figcaption></figure></div></div>    
</body>
</html>