<html>
<head>
<title>Creating a simple time tracker with watchOS Shortcuts and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用watchOS快捷方式和Node.js创建一个简单的时间跟踪器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-simple-time-tracker-with-watchos-shortcuts-and-nodejs-9733ad361dfd?source=collection_archive---------7-----------------------#2020-09-23">https://javascript.plainenglish.io/creating-a-simple-time-tracker-with-watchos-shortcuts-and-nodejs-9733ad361dfd?source=collection_archive---------7-----------------------#2020-09-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="aa6d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在我的Apple Watch上轻轻一点，追踪时间变得前所未有的简单。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/24fe6befbbd161999434caf27831dd15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*c_Bw5zgBSM7JEhBjGprcdQ.gif"/></div></figure><p id="7654" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果你只是想看看这个项目的代码，点击这里查看GitHub repo！随意克隆它&amp;让它成为你自己的。T3】</p><p id="b18c" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在过去的几个月里，我所有的工作都是以小时为基础的，不是兼职就是合同。</p><p id="cad2" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">一开始，我非常努力地用电子表格记录我的时间……但这并没有持续很久。在我意识到之前，我已经开始在文本文件中记录我的时间，然后最终只使用我的Notes应用程序。这个过程使得报告时间和计费客户最近变得一团糟。</p><p id="fbad" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我一直试图找到一种方便的方法来跟踪我的时间，而不会占用太多时间——我想我可以建立一个网络应用程序，并使用带有触摸屏的树莓Pi来跟踪事情，或者也许我可以在我的桌子上贴满NFC标签，扫描它们来开始/停止跟踪某些活动的时间。或者甚至是一个小木箱，里面有我想追踪的所有东西的按钮？</p><p id="ff3f" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">然后，iOS 14和watchOS 7发布了，我发现了<a class="ae lg" href="https://apps.apple.com/us/app/shortcuts/id915249334" rel="noopener ugc nofollow" target="_blank">快捷键</a>。我肯定这对你们大多数人来说不是什么大新闻，但是我一直都没有意识到它的存在。</p><p id="474e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">因此，我决定创建一个可以在我的手表表面上运行的快捷方式，搭配一个小的Nodejs web应用程序，来记录我正在进行的各种项目的时间。</p><h1 id="0984" class="li lj in bd lk ll lm ln lo lp lq lr ls jt lt ju lu jw lv jx lw jz lx ka ly lz bi translated">最终结果</h1><p id="72cb" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">如果你只是想看看，这里有一个快速演示。<a class="ae lg" href="https://github.com/adboio/time-tracking" rel="noopener ugc nofollow" target="_blank">你也可以在GitHub </a>上看到web应用的源代码。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/1abe95e06f6b53c5db5e3a49a0ff05e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWJeMLZcZ3w6p4erL-CU7Q.jpeg"/></div></div></figure><p id="e3a2" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在我选择一个选项后，一个事件被保存到一个数据库中，这样我就能准确地知道我每天何时开始&amp;何时停止每个项目的工作。</p><p id="2c1f" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我最终得到了类似这样的数据，我计划创建一个很酷的web界面来查看它。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h1 id="2dbe" class="li lj in bd lk ll lm ln lo lp lq lr ls jt lt ju lu jw lv jx lw jz lx ka ly lz bi translated">第0步:计划</h1><p id="c829" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">目标是能够点击我的表盘上的图标，从菜单中选择一个项目，开始或停止跟踪给定活动的时间。然后，我将能够在以后查看数据，以计算在每个项目上花费的时间。</p><p id="fd52" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">为了做到这一点，我需要做到以下几点:</p><ol class=""><li id="c596" class="mm mn in km b kn ko kq kr kt mo kx mp lb mq lf mr ms mt mu bi translated">创建一个能够处理发布请求并向数据库添加跟踪事件的web应用程序</li><li id="0f01" class="mm mn in km b kn mv kq mw kt mx kx my lb mz lf mr ms mt mu bi translated">创建一个快捷方式(与watchOS兼容),可以显示菜单并向服务器发出POST请求</li></ol><h1 id="fd63" class="li lj in bd lk ll lm ln lo lp lq lr ls jt lt ju lu jw lv jx lw jz lx ka ly lz bi translated">第一步:网络应用</h1><p id="5852" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">我决定先解决更耗时的部分:网络应用。</p><p id="13bc" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我的首选技术是Nodejs + Expressjs + MySQL，所以我创建了一个新的Express项目，并在Raspberry Pi上启动了一个MySQL服务器。在这篇文章中，我不会详细介绍如何设置这些东西，但是有很多很棒的资源可以用来学习如何设置。</p><h2 id="91f4" class="na lj in bd lk nb nc dn lo nd ne dp ls kt nf ng lu kx nh ni lw lb nj nk ly nl bi translated">数据库ˌ资料库</h2><p id="e28c" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">我想出的MySQL数据库模式没什么特别的；只有一个带有<code class="fe nm nn no np b">id</code>、<code class="fe nm nn no np b">time</code>、<code class="fe nm nn no np b">type</code> ( <code class="fe nm nn no np b">0</code>表示开始，<code class="fe nm nn no np b">1</code>表示停止)和<code class="fe nm nn no np b">activity</code>字段的表格。您可以使用这段SQL来创建表:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="2917" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">一旦添加了一些数据，该表将如下所示:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h2 id="9a0b" class="na lj in bd lk nb nc dn lo nd ne dp ls kt nf ng lu kx nh ni lw lb nj nk ly nl bi translated">按指定路线发送</h2><p id="0ce9" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">web应用程序本身实际上只有两项工作:处理向数据库添加跟踪事件的POST请求，以及呈现包含数据的简单网页。在本文中，我们将主要关注前者——您可以创造性地显示数据！:)</p><p id="539f" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我创建了一个用于处理请求的<code class="fe nm nn no np b">/track</code> route，它有两个函数用于获取/设置数据库中的事件，还有一些简单的逻辑用于判断请求是要“开始”还是“停止”跟踪活动。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="7038" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">您可能会注意到这个路由还实现了一些定制的中间件，即<code class="fe nm nn no np b">authHandler.checkApiKey</code>函数，它的功能正如其听起来一样:检查每个请求的授权头中是否有有效的API键，以确保没有恶意请求通过。如果你有兴趣，<a class="ae lg" href="https://github.com/adboio/time-tracking/blob/master/helper/authHandler.js" rel="noopener ugc nofollow" target="_blank">你可以在这里查看代码</a>。</p><h2 id="6087" class="na lj in bd lk nb nc dn lo nd ne dp ls kt nf ng lu kx nh ni lw lb nj nk ly nl bi translated">主办；主持</h2><p id="6c42" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">一旦服务器开始运行，我们需要它在真实的互联网上可用，以便快捷方式(或其他任何东西)能够向它发出请求。</p><p id="1f56" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">你可以通过Heroku这样的服务很容易地做到这一点，或者甚至在Raspberry Pi上托管你自己的网络服务器。</p><p id="40ef" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">为了时间和简单，也因为我已经有了一个帐户，我选择使用<a class="ae lg" href="https://ngrok.com" rel="noopener ugc nofollow" target="_blank"> ngrok </a>来托管我的应用程序。<code class="fe nm nn no np b">ngrok</code>允许您将所有web流量从公共ngrok.io域转发到您机器上运行的本地web服务器。我一直在使用ngrok测试web应用程序，所以我已经有了一个付费帐户，可以提供我需要的所有功能。</p><p id="4797" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">当Pi启动时，我使用<code class="fe nm nn no np b">pm2</code>在端口3000上启动我的节点服务器，并使用自定义域启动<code class="fe nm nn no np b">ngrok</code>。所以，每次我打开我的Raspberry Pi，ngrok和节点服务器都会开始运行，允许来自公共互联网的请求访问我的应用程序。</p><h1 id="66ec" class="li lj in bd lk ll lm ln lo lp lq lr ls jt lt ju lu jw lv jx lw jz lx ka ly lz bi translated">步骤2:捷径</h1><p id="300f" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">现在我已经有了一个服务器，它接受来自公共URL的POST请求，我可以创建一个iOS快捷方式来发出这些请求。</p><p id="4f50" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我创建了一个名为Time Tracker的快捷方式，并通过显示我可能想要跟踪的项目列表来启动它。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nq"><img src="../Images/b2d09a70d420e238fab85fc5bb341582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMslXdOhbwMVD4Mv_8LiVQ.png"/></div></div></figure><p id="9d8b" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">当我选择一个时，活动的唯一“代码”从字典中选择并保存到一个名为<code class="fe nm nn no np b">choice</code>的变量中，因此它最终可以在POST请求中传递。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nr"><img src="../Images/1bdcabe93c4a98db41922b2338ea0ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQtSRxezDqkls-A_CPCSEA.png"/></div></div></figure><p id="661b" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">最后，用<code class="fe nm nn no np b">choice</code>变量构造URL，并使用POST动作和带有API键的授权头执行“从URL获取内容”动作。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ns"><img src="../Images/9d7ed909bde33bffc76d5eaf59560c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbU3YWGJ6o-zlSBk9OUmeA.png"/></div></div></figure><h1 id="9d0c" class="li lj in bd lk ll lm ln lo lp lq lr ls jt lt ju lu jw lv jx lw jz lx ka ly lz bi translated">第三步:把它放到Apple Watch上！</h1><p id="81a9" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">有趣的是把所有这些联系在一起！</p><p id="be51" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在Watch应用程序中，您可以自定义显示在watchface上的所有复杂功能，从watchOS 7开始，这些复杂功能可以与快捷方式关联。</p><p id="b606" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">点击你的表盘，选择你想要快捷键的位置，然后选择你的新快捷键。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nt"><img src="../Images/170bab7aff18dd74c91483d1b678f656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ghfad_18iCxThfL_-gRLKQ.png"/></div></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nu"><img src="../Images/159bc2aebc50e2918f82ca7f5813894a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MZrlO6v9f4cosNru7DrKw.jpeg"/></div></div></figure><h1 id="9f21" class="li lj in bd lk ll lm ln lo lp lq lr ls jt lt ju lu jw lv jx lw jz lx ka ly lz bi translated">就是这样！</h1><p id="2bbc" class="pw-post-body-paragraph kk kl in km b kn ma jo kp kq mb jr ks kt mc kv kw kx md kz la lb me ld le lf ig bi translated">这(希望)解决了我现在的时间跟踪问题，我希望你能学到一些新东西，或者为你的下一个项目获得一些灵感。</p><p id="1772" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您对构建有任何疑问，或者在尝试创建自己的构建时需要帮助，请随时联系我们。:)</p></div></div>    
</body>
</html>