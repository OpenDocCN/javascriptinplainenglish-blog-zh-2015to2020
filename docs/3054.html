<html>
<head>
<title>Recoil.js &amp; simple global state</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反冲. js &amp;简单全局状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/recoil-js-simple-global-state-d84100b3d535?source=collection_archive---------4-----------------------#2020-08-24">https://javascript.plainenglish.io/recoil-js-simple-global-state-d84100b3d535?source=collection_archive---------4-----------------------#2020-08-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/39fd538afd9d47ace6d4cec3a838238d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nVMi9R8llhyAHhZPDAfuAQ.jpeg"/></div></div></figure><p id="1b89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在其最简单的实现中，反冲允许您在React应用程序中保存全局状态，然后从任何组件使用或更新它。</p><p id="cd10" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">反冲之所以大放异彩，是因为它使用起来非常简单，而且启动和运行它只需要很少的代码。反冲消除了传递道具的长路径，并且与Redux等其他全局状态库不同，设置时几乎没有学习曲线或样板代码。</p><p id="7e6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">今天，我们将建立一个应用程序，演示如何简单的反冲设置和使用。</p><p id="96bd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">本指南假设您的计算机上安装了Node ≥8.10和NPM ≥ 5.6，并且您可以轻松使用React。使用React钩子的经验将使这变得更加容易。</em></p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="cb7e" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">基本反冲功能和挂钩:</h1><p id="81a2" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">在构建我们的示例应用程序之前，我们应该熟悉一些函数和钩子。<code class="fe me mf mg mh b">Atom</code>、<code class="fe me mf mg mh b">useRecoilState()</code>、<code class="fe me mf mg mh b">useRecoilValue()</code>和<code class="fe me mf mg mh b">selector</code>。</p><h2 id="0c52" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated"><strong class="ak">原子</strong></h2><p id="7a4c" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">一个<code class="fe me mf mg mh b">atom</code>代表一个单一的状态，可以从任何组件读取或写入。每当atom更新时，订阅它的所有组件都会更新。当创建一个原子时，给它一个惟一的键(在所有原子和选择器中都是惟一的)和一个默认值(通常是一个空字符串或对象)。</p><pre class="mu mv mw mx gt my mh mz na aw nb bi"><span id="f758" class="mi lc in mh b gy nc nd l ne nf">const dataAtom = atom({<br/>   key: 'dataAtom',<br/>   default: '',<br/>});</span></pre><h2 id="bb58" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated"><strong class="ak"> useRecoilState() </strong></h2><p id="bf88" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">当需要读写atom时，导入并使用这个钩子。把你的atom传给<code class="fe me mf mg mh b">useRecoilState()</code>。在我们的重构任务中，我们将分配一个变量用于调用我们的状态，一个用于更新它。</p><p id="fd13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe me mf mg mh b">const [data, setData] = useRecoilState(dataAtom)</code></p><h2 id="09f5" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated"><strong class="ak"> useRecoilValue() </strong></h2><p id="2184" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">当你需要读取一个原子的值而不是写入它的时候，使用这个钩子。</p><p id="f258" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe me mf mg mh b">const myData = useRecoilValue(dataAtom);</code></p><h2 id="3e05" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated"><strong class="ak">选择器</strong></h2><p id="92a9" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">一个<code class="fe me mf mg mh b">selector</code>代表一段派生状态。基本上，它允许你调用一个原子，转换状态，并返回它。请注意，您不是在选择器中更新状态。</p><pre class="mu mv mw mx gt my mh mz na aw nb bi"><span id="f6f0" class="mi lc in mh b gy nc nd l ne nf">const cowboyHatTip = selector ({<br/>    key: 'cowboyHatTip', // unique<br/>    get: ({get}) =&gt; {<br/>        const data = get(myData);<br/>        return data + " pardner"<br/>    }<br/>})</span><span id="2e1e" class="mi lc in mh b gy ng nd l ne nf">// assuming you are holding "howdy" in your myData state, <br/>// <!-- -->cowboyHatTip<!-- --> will return<br/>// "howdy pardner"<br/></span></pre><h1 id="3dce" class="lb lc in bd ld le nh lg lh li ni lk ll lm nj lo lp lq nk ls lt lu nl lw lx ly bi translated">我们来树立一个榜样吧！</h1><p id="7c29" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated"><em class="kt">查看</em> <a class="ae nm" href="https://github.com/Josh-Gotro/Recoil_Tutorial" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> Github资源库</em> </a> <em class="kt">以查看完整的演示，或者跟随并构建您自己的版本。</em></p><p id="2da3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在你的终端上，创建一个React应用程序，随便你给它起什么名字(我的名字叫反冲骨架)。</p><pre class="mu mv mw mx gt my mh mz na aw nb bi"><span id="7770" class="mi lc in mh b gy nc nd l ne nf">npx create-react-app recoil-skeleton</span></pre><p id="c51b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">安装反冲。(如果使用纱线，用<code class="fe me mf mg mh b">yarn</code>替换<code class="fe me mf mg mh b">npm</code>)</p><pre class="mu mv mw mx gt my mh mz na aw nb bi"><span id="04d8" class="mi lc in mh b gy nc nd l ne nf">npm install recoil</span></pre><p id="648e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe me mf mg mh b">cd</code>放入您新创建的应用文件夹，并在您喜欢的文本编辑器中打开它。</p><p id="1915" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从您的终端运行<code class="fe me mf mg mh b">npm start</code>,这样您就可以在浏览器中实时看到您的更改。</p><p id="4310" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">清除掉大部分的<code class="fe me mf mg mh b">App.js</code>，从<code class="fe me mf mg mh b">import logo from './logo.svg';</code>和我们<code class="fe me mf mg mh b">return()</code>里面的所有东西开始。您剩下的应该是这样的:</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">Note, this won’t compile just yet!</figcaption></figure><p id="33f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用反冲状态的组件需要<code class="fe me mf mg mh b">&lt;RecoilRoot&gt;&lt;/RecoilRoot&gt;</code>在父树的某个地方，在这种情况下，我们将在<code class="fe me mf mg mh b">App.js</code>左右添加它。我们现在也可以创建一些组件并添加它们。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1233" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们导入反冲工具并开始使用它们。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="8e5d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">导入<code class="fe me mf mg mh b">RecoilRoot</code>、<code class="fe me mf mg mh b">atom</code>、<code class="fe me mf mg mh b">useRecoilState</code>、<code class="fe me mf mg mh b">useRecoilValue</code>和<code class="fe me mf mg mh b">selector</code>。</p><p id="2cb0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个<code class="fe me mf mg mh b">atom</code>。我们给它一个键<code class="fe me mf mg mh b">textState</code>，给它一个空字符串作为默认值。</p><p id="e735" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个组件(<code class="fe me mf mg mh b">whoAmI</code>)，并设置我们的<code class="fe me mf mg mh b">useRecoilState()</code>，这样我们就可以调用并更新我们刚刚创建的atom。</p><p id="15c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你熟悉React钩子，这个语法应该看起来很熟悉:)</p><p id="e3af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在我们的<code class="fe me mf mg mh b">WhoAmI</code>组件中创建了一个<code class="fe me mf mg mh b">&lt;input&gt;</code>，它将我们的当前状态显示为值(<code class="fe me mf mg mh b">text</code>)。请记住，我们将<code class="fe me mf mg mh b">text</code>指定为变量，它代表了<code class="fe me mf mg mh b">textState</code>原子的当前状态。</p><p id="4119" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe me mf mg mh b">text</code>当前状态为空字符串。我们希望它将状态设置为当前用户输入的状态，所以让我们设置一个简单的<code class="fe me mf mg mh b">onChange</code>事件监听器来为我们处理这个问题。我们的<code class="fe me mf mg mh b">onChange</code>监听器会将任何输入更改发送到我们的<code class="fe me mf mg mh b">onChange</code>函数，该函数使用<code class="fe me mf mg mh b">setText()</code>来更新我们的状态。</p><h2 id="c9fb" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated">我们有国家！</h2><p id="0949" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">伸展你的腿，微笑，也许听一些肯尼·罗杰斯来庆祝你的成功。休息之后，我们将在一些兄弟组件中调用这个新创建的状态。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt no l"/></div></figure><p id="cb70" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们将从编写状态的组件以及两个兄弟组件中调用我们的状态。在每个兄弟组件中，我们将使用一个<code class="fe me mf mg mh b">selector</code>来转换数据并显示它。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="9aa6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们接受用户输入，并以大写形式返回。</p><p id="b664" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第二个例子中，我们将拆分输入，颠倒它的顺序，然后重新组合它。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="9202" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们可以构建我们的兄弟组件并调用选择器。我们使用<code class="fe me mf mg mh b">useRecoilValue()</code>是因为我们在调用我们的状态，而不是改变它。</p><p id="1217" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！看到下面的gif看到你所有的努力都有了回报！</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/8f299cae21f2e80d273057d79962bd07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*4-6QecwgB40U2995kfaqGg.gif"/></div></figure><p id="8119" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我添加了一些HTML/CSS来将兄弟姐妹分隔到他们自己的列中，并添加了一些颜色。</p><h1 id="ab89" class="lb lc in bd ld le nh lg lh li ni lk ll lm nj lo lp lq nk ls lt lu nl lw lx ly bi translated">最终注释:</h1><h2 id="0e46" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated"><strong class="ak"> <em class="nv">效果挂钩</em> </strong></h2><p id="ed2b" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">反冲是可能的，因为反作用钩。钩子让我们更喜欢功能组件而不是类。如果这是你第一次尝试class-lite或classless应用程序，那么你会想要熟悉钩子，特别是reactions ' Effect Hook。<code class="fe me mf mg mh b">useEffect()</code>代替<code class="fe me mf mg mh b">componendDidMount()</code>、<code class="fe me mf mg mh b">componentDidUpdate()</code>、<code class="fe me mf mg mh b">componentWillUnmount()</code>。</p><p id="4711" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">权衡是一个净赢，但效果挂钩需要一些注意，特别是在编写清理方法以防止内存泄漏时。这些<a class="ae nm" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank">文档</a>很容易理解，值得一读。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="38f7" class="mi lc in bd ld mj mk dn lh ml mm dp ll kg mn mo lp kk mp mq lt ko mr ms lx mt bi translated"><strong class="ak"> <em class="nv">重构重构重构</em> </strong></h2><p id="ffed" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">在这个演示中，我们的逻辑and都是用<strong class="jx io"> App.js </strong>写的。虽然这个<em class="kt">起作用</em>，但是对于一个管理更多状态的更大的应用程序，你可能想要保持一个或多个单独的文件来保存这些文件，以防止混乱并便于访问！</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="2690" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里找到本教程的GitHub库，在这里查看反冲. js文档<a class="ae nm" href="https://recoiljs.org/docs/introduction/getting-started" rel="noopener ugc nofollow" target="_blank">。请随时在joshuagauthreaux@gmail.com联系我，或者通过我的网站联系joshgotro.com。</a></p><p id="54e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="kt">感谢您的宝贵时间，保重！</em> </strong></p></div></div>    
</body>
</html>