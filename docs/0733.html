<html>
<head>
<title>Check if a variable is a JavaScript object</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">检查变量是否是JavaScript对象</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-check-if-a-variable-is-an-object-and-nothing-else-not-an-array-a-set-etc-a3987ea08fd7?source=collection_archive---------4-----------------------#2019-12-03">https://javascript.plainenglish.io/javascript-check-if-a-variable-is-an-object-and-nothing-else-not-an-array-a-set-etc-a3987ea08fd7?source=collection_archive---------4-----------------------#2019-12-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8e72" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">除此之外什么也没有(不是数组、集合等。)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bbbab6fc99628470add15052bb51d73c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-25KB7EbSHjv70HXrdl6w.png"/></div></div></figure><p id="ed10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我目前正在做一个项目，在这个项目中，我们将某些值存储为字符串或对象。根据值的类型，我们将以不同的方式处理它。尽管这里我们只希望处理一个字符串或一个对象，但我想编写一个健壮的通用函数，它将显式地确定一个值是否是一个普通的JavaScript对象。我想处理基于JavaScript对象的其他数据结构(如数组、集合、null等)将返回false的边缘情况，因为它们不仅仅是一个普通的对象。</p><p id="0c51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">经过一番挖掘，我找到了多个可能的答案，并做了一些TDD来选择正确的答案，因为我想确保我能想到的所有情况都包括在内。我将编写并测试一个<code class="fe ln lo lp lq b">isObject</code>函数。</p><h1 id="5542" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">项目设置</h1><p id="8e2e" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">我们这里不需要疯狂花哨的东西。一个文件夹包含两个文件就足够了:</p><ul class=""><li id="cd4e" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated"><code class="fe ln lo lp lq b">isObject.js</code></li><li id="f0f2" class="mo mp iq kt b ku mx kx my la mz le na li nb lm mt mu mv mw bi translated"><code class="fe ln lo lp lq b">isObject.test.js</code></li></ul><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="b3bc" class="ng ls iq lq b gy nh ni l nj nk">mkdir isObject &amp;&amp; cd isObject<br/>touch isObject.js &amp;&amp; touch isObject.test.js</span></pre><p id="18b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还需要一个测试库(以及编写现代JS的Babel支持)。<br/>我将使用<a class="ae nl" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>，因为它易于设置和使用。</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="705d" class="ng ls iq lq b gy nh ni l nj nk">yarn init<br/>yarn add jest -D<br/>yarn add --dev babel-jest @babel/core @babel/preset-env</span></pre><p id="7556" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一个<code class="fe ln lo lp lq b">babel.config.js</code>文件。</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="68b8" class="ng ls iq lq b gy nh ni l nj nk">module.exports = {<br/>  presets: [<br/>    [<br/>      '@babel/preset-env',<br/>      {<br/>        targets: {<br/>          node: 'current',<br/>        },<br/>      },<br/>    ],<br/>  ],<br/>};</span></pre><p id="33ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在<a class="ae nl" href="https://jestjs.io/docs/en/getting-started" rel="noopener ugc nofollow" target="_blank"> Jest官方文档</a>中找到所有的Jest设置。</p><h1 id="1dc3" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">TDD基础</h1><p id="26da" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">现在让我们写一个虚拟函数</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8b69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在测试。我们希望我们的函数能够在不执行任何预先检查的情况下测试任何值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="92a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们正在测试<code class="fe ln lo lp lq b">string</code>和<code class="fe ln lo lp lq b">object</code>类型，这是我们肯定会遇到最多的情况，但也是为了确保我们的函数能够处理边缘情况。</p><p id="a347" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行测试套件:</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="d0fb" class="ng ls iq lq b gy nh ni l nj nk">jest isObject.test.js</span></pre><p id="97f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它应该会失败。</p><h1 id="d0f8" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">解决方法</h1><p id="5aa1" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">现在让我们实现我们的<code class="fe ln lo lp lq b">isObject</code>函数。</p><h2 id="b24e" class="ng ls iq bd lt no np dn lx nq nr dp mb la ns nt md le nu nv mf li nw nx mh ny bi translated">类型of</h2><p id="31ae" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">我想到的第一个解决方案是用<code class="fe ln lo lp lq b">typeof</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ff59" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行测试。</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="b42e" class="ng ls iq lq b gy nh ni l nj nk">jest isObject.test.js</span></pre><p id="80f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它失败了。</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="b440" class="ng ls iq lq b gy nh ni l nj nk">FAIL  ./isObject.test.js<br/>  isObject<br/>    ✓ String (3ms)<br/>    ✓ Object (1ms)<br/>    ✕ Array (6ms)<br/>    ✕ Set<br/>    ✕ Date (1ms)<br/>    ✓ Undefined<br/>    ✕ Null</span></pre><p id="2e9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">typeof</code>的问题在于<code class="fe ln lo lp lq b">typeof [] === 'object'</code>其实就是<code class="fe ln lo lp lq b">true</code>。为什么？因为在Javascript中数组实际上是对象。布景、日期等也是如此。</p><p id="0845" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">需要注意的有趣事情:</p><ul class=""><li id="7633" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated"><code class="fe ln lo lp lq b">typeof undefined</code>不是<code class="fe ln lo lp lq b">object</code>。是<code class="fe ln lo lp lq b">undefined</code>。</li><li id="2939" class="mo mp iq kt b ku mx kx my la mz le na li nb lm mt mu mv mw bi translated"><code class="fe ln lo lp lq b">typeof null</code>是一个<code class="fe ln lo lp lq b">object</code>虽然。</li></ul><h2 id="59fc" class="ng ls iq bd lt no np dn lx nq nr dp mb la ns nt md le nu nv mf li nw nx mh ny bi translated">实例of</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d587" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">结果是:</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="b9bb" class="ng ls iq lq b gy nh ni l nj nk">FAIL  ./isObject.test.js<br/>  isObject<br/>    ✓ String (3ms)<br/>    ✓ Object (1ms)<br/>    ✕ Array (2ms)<br/>    ✕ Set<br/>    ✕ Date (1ms)<br/>    ✓ Undefined<br/>    ✓ Null</span></pre><p id="294f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这稍微好一点(<code class="fe ln lo lp lq b">null</code>和<code class="fe ln lo lp lq b">undefied</code>被以同样的方式处理)，但是对于我们的一些情况仍然失败。为什么？因为<code class="fe ln lo lp lq b">instanceof</code>检查指定的原型(这里是<code class="fe ln lo lp lq b">Object</code>)是否出现在原型链中的任何地方。</p><p id="a605" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如上所述，<code class="fe ln lo lp lq b">array</code>实际上是JavaScript中的<code class="fe ln lo lp lq b">object</code>,所以:</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="46d4" class="ng ls iq lq b gy nh ni l nj nk">[] instanceof Array  // true<br/>[] instanceof Object // true</span></pre><p id="49f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有趣的是:</p><ul class=""><li id="1e4c" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated"><code class="fe ln lo lp lq b">null</code>是<code class="fe ln lo lp lq b">object</code>类型，但不是<code class="fe ln lo lp lq b">object</code>的实例</li></ul><h2 id="b454" class="ng ls iq bd lt no np dn lx nq nr dp mb la ns nt md le nu nv mf li nw nx mh ny bi translated">构造器</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="5ef8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它失败了。又来了。</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="0432" class="ng ls iq lq b gy nh ni l nj nk">FAIL  ./isObject.test.js<br/>  isObject<br/>    ✓ String (3ms)<br/>    ✓ Object (1ms)<br/>    ✓ Array<br/>    ✓ Set<br/>    ✓ Date<br/>    ✕ Undefined (1ms)<br/>    ✕ Null</span></pre><p id="5898" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">快到了！这一次是因为<code class="fe ln lo lp lq b">undefined</code>和<code class="fe ln lo lp lq b">null</code>没有<code class="fe ln lo lp lq b">constructor</code>属性，但是它适用于所有其他类型。我们可以这样想:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="60e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这样做的工作，但它迫使我们检查特定的值，这是我想避免的事情。我不想通过排除所有其他可能性来猜测一个变量的<code class="fe ln lo lp lq b">type</code>。</p><p id="a0fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">经过一番研究，我找到了我需要的东西。</p><h1 id="fc55" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">Object.prototype.toString.call()</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="e3e8" class="ng ls iq lq b gy nh ni l nj nk">PASS  ./isObject.test.js<br/>  isObject<br/>    ✓ String (3ms)<br/>    ✓ Object<br/>    ✓ Array (1ms)<br/>    ✓ Set<br/>    ✓ Date<br/>    ✓ Undefined<br/>    ✓ Null</span></pre><p id="6373" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正是我需要的。</p><p id="20fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">toString()</code>方法返回一个表示对象的字符串。例如这里它为一个<code class="fe ln lo lp lq b">array</code>返回什么:</p><pre class="kg kh ki kj gt nc lq nd ne aw nf bi"><span id="3a15" class="ng ls iq lq b gy nh ni l nj nk">Object.prototype.toString.call([]) // [object Array]</span></pre><p id="f497" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这样我确定我处理的是一个<code class="fe ln lo lp lq b">object</code>而不是别的！</p><h2 id="ed98" class="ng ls iq bd lt no np dn lx nq nr dp mb la ns nt md le nu nv mf li nw nx mh ny bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="32dc" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae nl" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kt ir">AI in Plain English</strong></a><a class="ae nl" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kt ir">UX in Plain English</strong></a><a class="ae nl" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kt ir">Python in Plain English</strong></a><strong class="kt ir"/>—谢谢，继续学习！</p><p id="b9b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae nl" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">submissions @ plain English . io</strong></a><strong class="kt ir"/>，使用您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>