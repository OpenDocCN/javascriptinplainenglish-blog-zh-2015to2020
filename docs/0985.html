<html>
<head>
<title>Angular: How to support IE11</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular:如何支持IE11</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-how-to-support-ie11-d3b8c3d3494e?source=collection_archive---------2-----------------------#2020-01-10">https://javascript.plainenglish.io/angular-how-to-support-ie11-d3b8c3d3494e?source=collection_archive---------2-----------------------#2020-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d577f8fc3ce7bfff2242ad83bbffa822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R4YpDSvcS1FE9Tjk.jpg"/></div></div></figure><p id="2d69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将向你展示我用Angular支持Internet Explorer 11的步骤。前半部分将快速显示您需要采取的步骤，后半部分将对这些步骤进行更详细的分解，以便任何希望了解更多信息的人使用。最后，我将添加一些在实际应用中可能出现的额外技巧。</p><h1 id="9767" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">💪让我们完成它</h1><h1 id="9942" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">🎯步骤1 —瞄准ES5</h1><p id="3c03" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">IE11最多只支持ES5。因此，我们必须更新我们的<code class="fe lz ma mb mc b">tsconfig.json</code>。<br/>更新<code class="fe lz ma mb mc b">compilerOptions</code>中的<code class="fe lz ma mb mc b">target</code>属性，以匹配以下内容(如果尚未匹配):</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="e11e" class="ml kx iq mc b gy mm mn l mo mp">"compilerOptions": {<br/>    "target": "es5"<br/>}</span></pre><h1 id="79ba" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">🌐步骤2 —更新<code class="fe lz ma mb mc b">broswerlist</code></h1><p id="93ca" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">打开你的<code class="fe lz ma mb mc b">browserlist</code>文件，并更改行<code class="fe lz ma mb mc b">not IE 9-11</code>以匹配:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="39d6" class="ml kx iq mc b gy mm mn l mo mp">not IE 9-10<br/>IE 11</span></pre><h1 id="62b9" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">🔧步骤3-聚合填充</h1><p id="865a" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果您或您的任何依赖项使用ES6+的特性，您将需要填充这些特性。CoreJS包含在Angular install中，可用于您需要的大多数聚合填充。</p><p id="7402" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开您的<code class="fe lz ma mb mc b">polyfills.ts</code>文件，将以下内容放在顶部的<code class="fe lz ma mb mc b">BROWSER POLYFILLS</code>下:</p><p id="5a69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要速战速决<strong class="ka ir"> <em class="mq">(不推荐)</em> </strong>:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="9f73" class="ml kx iq mc b gy mm mn l mo mp">import 'core-js';</span></pre><p id="e93f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">否则，请尝试辨别您需要什么聚合填充。我发现这些涵盖了我的用例:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="5184" class="ml kx iq mc b gy mm mn l mo mp"><em class="mq">import</em> 'core-js/es6/symbol';<br/><em class="mq">import</em> 'core-js/es6/object';<br/><em class="mq">import</em> 'core-js/es6/function';<br/><em class="mq">import</em> 'core-js/es6/parse-int';<br/><em class="mq">import</em> 'core-js/es6/parse-float';<br/><em class="mq">import</em> 'core-js/es6/number';<br/><em class="mq">import</em> 'core-js/es6/math';<br/><em class="mq">import</em> 'core-js/es6/string';<br/><em class="mq">import</em> 'core-js/es6/date';<br/><em class="mq">import</em> 'core-js/es6/regexp';<br/><em class="mq">import</em> 'core-js/es6/map';<br/><em class="mq">import</em> 'core-js/es6/weak-map';<br/><em class="mq">import</em> 'core-js/es6/set';<br/><em class="mq">import</em> 'core-js/es6/array';<br/><em class="mq">import</em> 'core-js/es7/array'; <em class="mq">// for .includes()</em></span></pre><p id="e8db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要做的下一部分是在<code class="fe lz ma mb mc b">polyfills.ts</code>顶部附近找到下面的行:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="e3a8" class="ml kx iq mc b gy mm mn l mo mp">/** IE10 and IE11 requires the following for NgClass support on SVG elements */ <br/>// import 'classlist.js'; // Run `npm install --save classlist.js`.</span></pre><p id="bd29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按照指示运行:<br/> <code class="fe lz ma mb mc b">npm install --save classlist.js</code></p><p id="5ba0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后取消对导入的注释:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="1c56" class="ml kx iq mc b gy mm mn l mo mp">/** IE10 and IE11 requires the following for NgClass support on SVG elements */ <br/>import ' classlist.js ' ; // Run `npm install --save classlist.js`.</span></pre><p id="1972" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果使用角形材料或<code class="fe lz ma mb mc b">@angular/platform-browser/animations</code>中的<code class="fe lz ma mb mc b">AnimationBuilder</code>,则找到以下线条:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="7332" class="ml kx iq mc b gy mm mn l mo mp">// import 'web-animations-js'; <br/>// Run `npm install --save web-animations-js`.</span></pre><p id="dd88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">取消import语句的注释并运行<code class="fe lz ma mb mc b">npm install --save web-animations-js</code>。</p><p id="de00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的最终<code class="fe lz ma mb mc b">polyfills.ts</code>文件应该类似于:</p><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h1 id="5264" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">✅完成</h1><p id="3a64" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">就是这样！你应该可以走了！🚀🚀</p><p id="d521" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你很可能会遇到更多的问题。其中一些将在本文的后半部分讨论。</p><h1 id="e41a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">🤯但是为什么呢？</h1><p id="63bf" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在我们深入探讨可能出现的其他问题之前，让我们快速浏览一下上面每个步骤的原因。</p><ul class=""><li id="6584" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated">目标ES5:非常简单，IE11只支持ES5或更低版本。因此，TypeScript需要将您的代码转换成ES5兼容代码。</li><li id="7c4f" class="mt mu iq ka b kb nc kf nd kj ne kn nf kr ng kv my mz na nb bi translated">Browserlist:这是一个有趣的问题。我们需要声明我们支持IE 11，但是如果我们不支持IE 9或ie10，同样重要的是明确声明我们不支持它们，否则differential loader会包含很多废话。_(谢谢<a class="ae nh" href="https://twitter.com/wescopeland_" rel="noopener ugc nofollow" target="_blank">@威斯科普兰德_ </a>的建议)_</li><li id="9f9a" class="mt mu iq ka b kb nc kf nd kj ne kn nf kr ng kv my mz na nb bi translated">poly fills——我们使用的一些库或编写的代码依赖于IE11不支持的ECMAScript版本的功能，因此我们需要使用变通方法手动为ES5提供这一功能。这将允许使用现代功能的代码继续正确工作。<em class="mq">(注意:每个聚合填充都会增加束的大小，因此在选择要导入的聚合填充时要小心)</em></li></ul><h1 id="b617" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">💡一些附加提示</h1><p id="b739" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">好了，写这篇文章的动机来自于在我们的绿色应用中支持IE11的任务。尤其令人痛苦的是，这是一个事后想法，然后强调了与支持IE11的兼容性问题:</p><h2 id="c826" class="ml kx iq bd ky ni nj dn lc nk nl dp lg kj nm nn lk kn no np lo kr nq nr ls ns bi translated">第三方依赖需要支持ES5</h2><p id="e1d8" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这一点很快就变得很明显，因为错误很容易被显示到控制台中。但这确实凸显了一个有趣的问题。</p><p id="c0b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们想在我们的应用程序中包含一个新的依赖项或库，我们需要确保它构建并支持ES5，否则，我们必须跳过它。这可能会限制我们未来的选择，这从来都不是理想的。</p><h2 id="59e0" class="ml kx iq bd ky ni nj dn lc nk nl dp lg kj nm nn lk kn no np lo kr nq nr ls ns bi translated">IE11不支持CSS自定义属性</h2><p id="ecc8" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这很快变成了地狱。IE11不支持CSS自定义属性，比如<code class="fe lz ma mb mc b">--primary-color: blue;</code>，这意味着我们的主题化解决方案可能会失败。</p><p id="ecb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经过大量的调查，我发现<em class="mq">可以被聚合填充，但是，我发现的聚合填充很慢，对束的大小有很大的影响，并且不完全完美。缺少功能，例如在一行中包含多个自定义属性等问题。</em></p><p id="582e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它们也不适用于我们的特定用例以及我们的主题化解决方案，后者依赖于自定义属性的运行时设置。</p><p id="de7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的解决方案来自于<a class="ae nh" href="https://www.npmjs.com/package/css-vars-ponyfill" rel="noopener ugc nofollow" target="_blank"> css-vars-ponyfill </a>，它允许在运行时设置全局定制属性。可怕的🔥🔥</p><h2 id="2ad6" class="ml kx iq bd ky ni nj dn lc nk nl dp lg kj nm nn lk kn no np lo kr nq nr ls ns bi translated">在IE11中设置<code class="fe lz ma mb mc b">style</code>属性</h2><p id="ed5b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">IE11只允许用它支持的CSS属性设置DOM元素的<code class="fe lz ma mb mc b">style</code>属性。<br/>例如，进行如下操作:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="749e" class="ml kx iq mc b gy mm mn l mo mp">document.body.style = '--primary-color: blue; font-size: 18px';</span></pre><p id="b44c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果在接下来的IE11上，输了<code class="fe lz ma mb mc b">--primary-color: blue</code>。</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="8551" class="ml kx iq mc b gy mm mn l mo mp">&lt;body style="font-size: 18px"&gt;&lt;/body&gt;</span></pre><h2 id="bc42" class="ml kx iq bd ky ni nj dn lc nk nl dp lg kj nm nn lk kn no np lo kr nq nr ls ns bi translated">flexbox支持引起的样式问题</h2><p id="a8ef" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">IE11确实支持flexbox，但它对如何支持非常挑剔。我注意到，如果我想使用<code class="fe lz ma mb mc b">flex: 1;</code>来允许一个元素填充剩余的空间，在IE11上我必须设置完整的flex属性:<code class="fe lz ma mb mc b">flex: 1 0 auto;</code>或类似的东西。</p><h2 id="48d2" class="ml kx iq bd ky ni nj dn lc nk nl dp lg kj nm nn lk kn no np lo kr nq nr ls ns bi translated">在IE11中运行DevTools与zone.js冲突</h2><p id="10c5" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">没错。出于某种原因，当你在IE11上运行<code class="fe lz ma mb mc b">ng serve</code>的同时打开开发工具会导致与<code class="fe lz ma mb mc b">zone.js</code>的冲突；</p><p id="7404" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要解决这个问题，你需要为zone添加一个全局<code class="fe lz ma mb mc b">ZONE FLAG</code>来执行一些额外的代码。</p><p id="e156" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你在<code class="fe lz ma mb mc b">polyfills.ts</code>做这个。找到<code class="fe lz ma mb mc b">zone.js</code>导入并添加如下内容，如下所示:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="a6da" class="ml kx iq mc b gy mm mn l mo mp">(window as any).__Zone_enable_cross_context_check = true; import 'zone.js/dist/zone'; <em class="mq">// Included with Angular CLI.</em></span></pre><h1 id="3931" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">😭结论</h1><p id="af75" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在这一周里，我并不喜欢尝试让它工作。现在我有了它的支持；我觉得很有成就💪。<br/>希望这篇文章能在将来给某人省点痛苦！</p><p id="134d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你从阅读这篇文章中有所收获，也许是你以前不知道的花絮。</p><p id="9d9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果有任何问题，欢迎在下面提问或在Twitter上联系我:<a class="ae nh" href="https://twitter.com/FerryColum" rel="noopener ugc nofollow" target="_blank"> @FerryColum </a>。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="106b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq">最初发布于2020年1月10日</em><a class="ae nh" href="https://dev.to/coly010/angular-how-to-support-ie11-4924" rel="noopener ugc nofollow" target="_blank"><em class="mq">https://dev . to</em></a><em class="mq">。</em></p></div></div>    
</body>
</html>