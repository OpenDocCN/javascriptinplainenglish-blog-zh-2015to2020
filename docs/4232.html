<html>
<head>
<title>Processing Excel Files with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript处理Excel文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/processing-excel-files-with-javascript-fb329da960f8?source=collection_archive---------10-----------------------#2020-11-26">https://javascript.plainenglish.io/processing-excel-files-with-javascript-fb329da960f8?source=collection_archive---------10-----------------------#2020-11-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b06b03cb6e03ee4c11b2ed80e75bb66b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lNECCVZSDwyhdZsN.png"/></div></div></figure><p id="418b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我用NodeJS做很多事情。当我想用JavaScript创建一个库存系统时，我考虑了其他选择。因为程序是供个人使用的，所以编写UI来编辑数据没有什么价值。我决定使用电子表格。起初我使用Google Sheets，但我总是在保存文件后将其导出。事情会变得不同步。非常烦人而且容易出错。</p><p id="a83b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">尽管我更愿意使用开源软件，但Excel仍然是最简单的解决方案。不幸的是，Excel电子表格是XLSX文件。XLSX是一种相当复杂的XML格式，很难解析。我寻找一个NPM模块来读取XLSX文件，但没有找到一个我喜欢的。</p><p id="4a14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在绞尽脑汁之后，我意识到R(<a class="ae kt" href="https://www.r-project.org/" rel="noopener ugc nofollow" target="_blank">https://www.r-project.org/</a>)是专门为处理各种来源的表格数据而设计的。我决定写一个简单的R脚本来进行转换。</p><p id="7a99" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">R包可以将XLSX文件读入一个表中。假设数据不包含制表符，表格可以输出到制表符分隔值(TSV)文件。用JavaScript很容易解析TSV文件。</p><p id="da64" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从命令行使用以下R程序将完成转换:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="419a" class="lg lh in kx b gy li lj l lk ll">require('readxl')<br/>a &lt;- readxl::read_xlsx("inventory_data.xlsx")<br/>write.table(a, file = "inventory_data.txt", sep = "\t", na = "", quote = FALSE, row.names = FALSE)</span></pre><p id="c16e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">保存到<code class="fe ku kv kw kx b">xltotsv.R</code>。使用以下命令从命令行执行该程序:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="6dd8" class="lg lh in kx b gy li lj l lk ll">R -f xltotsv.R</span></pre><p id="dd8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此时，可以使用NodeJS将TSV文件读入一个数组，并将行拆分成字段。甚至可以使用第一行作为对象的属性。有NPM软件包可以做到这一点，但它相当简单。让我们创建一个<code class="fe ku kv kw kx b">getDB()</code>函数来返回数据库和字段名:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="3fc5" class="lg lh in kx b gy li lj l lk ll">// Location Container Box Item Qty Value<br/>import fs from 'fs';</span><span id="98c4" class="lg lh in kx b gy lm lj l lk ll">// convert TSV to JSON using first line as field names<br/>function getDB() {<br/>  const invTSV = fs.readFileSync('inventory_data.txt', 'utf-8');<br/>  const lines = invTSV.split('\n');<br/>  const fields = lines[0].replace('\r', '').split('\t').slice(0, 6);<br/>  const db = [];<br/>  for (let i = 1; i &lt; lines.length; i++) {<br/>    const line = lines[i].replace('\r', '');<br/>    const entry = {};<br/>    for (let j = 0; j &lt; fields.length; j++) {<br/>      const values = line.split(/ *\t/g);<br/>      entry[fields[j]] = values[j];<br/>    }<br/>    db.push(entry);<br/>  }<br/>  return {db, fields};<br/>}</span></pre><p id="79db" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过在每行末尾的换行符处“拆分”长字符串，可以很容易地将每行转换为数组中的行。</p><p id="d879" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">TSV文件是DOS格式的，所以需要去掉<code class="fe ku kv kw kx b">\r</code>字符。</p><p id="7675" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个例子中，使用<code class="fe ku kv kw kx b">{}</code>创建JSON对象，然后使用<code class="fe ku kv kw kx b">[attribute]</code>符号添加属性，将每一行转换成一个对象。这就用熟悉的JSON符号创建了对象:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="2c7c" class="lg lh in kx b gy li lj l lk ll">{attribute:"value"}</span></pre><p id="23d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">处理对象数组现在是使用数组方法的简单事情，比如<code class="fe ku kv kw kx b">map</code>、<code class="fe ku kv kw kx b">forEach</code>等。</p><p id="936d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此时，我将数组保存为一个JSON文件，并将其用于任何我想做的事情。对于我的库存程序，我使用React Native编写了一个移动应用程序，并使用Expo发布。数据是从AWS检索的，所以我可以从任何地方访问它。有必要保护对JSON文件的访问。我如何编写移动应用程序和使用AWS有些复杂，我将在以后的文章中公布我使用的方法。</p></div><div class="ab cl ln lo hr lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ig ih ii ij ik"><p id="2a0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lu">原载于2020年11月26日</em><a class="ae kt" href="https://focusedforsuccess.com/processing-excel-files-with-javascript/" rel="noopener ugc nofollow" target="_blank"><em class="lu">【https://focusedforsuccess.com】</em></a><em class="lu">。</em></p></div></div>    
</body>
</html>