<html>
<head>
<title>React Native: Firebase email authentication in an Expo project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">react Native:Expo项目中的Firebase电子邮件认证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890?source=collection_archive---------2-----------------------#2020-08-04">https://javascript.plainenglish.io/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890?source=collection_archive---------2-----------------------#2020-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e27b123d74b8ac771cbfe8c0b6176852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xUCE_IJKKdEIcD66VMctg.png"/></div></div></figure><p id="5138" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw">更新</em> </strong>:一旦你完成了这些，请阅读我的“扩展”教程，学习如何在Expo项目中添加Google登录到Firebase =&gt;</p><div class="kx ky gp gr kz la"><a href="https://popeating.medium.com/react-native-firebase-adding-google-authenticaton-in-an-expo-project-2-ed20cb440732" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">React Native: Firebase在Expo项目中添加谷歌认证(#2)</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">请注意:这篇文章是我上一篇文章的扩展，所以这里显示的代码只是部分的…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">popeating.medium.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jw la"/></div></div></a></div><p id="b03d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我学习React Native应用程序开发的过程中，我决定尝试制作一个小型的包含应用程序，它将服务于一个独特的任务，一个自包含的登录系统，使用Firebase Auth，使用(目前)电子邮件/密码登录方法。</p><p id="817b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使这款应用只是一个框架，我也试图让它在界面/可用性方面尽可能完整，在界面上使用react-native-paper组件，如果支持的话启用黑暗主题，添加翻译和其他小改动。我试图用现代的方式编码，所以我利用了上下文和状态挂钩，当然，这段代码并不完美，我会继续在https://github.com/popeating/FirebaseLogin的GitHub <a class="ae lp" href="https://github.com/popeating/FirebaseLogin" rel="noopener ugc nofollow" target="_blank">上更新它。</a></p><h1 id="dafa" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">这个应用程序如何工作</h1><p id="9552" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">基本上，该应用程序由两个导航堆栈中的3个屏幕组成。一个堆栈保存登录和注册(尚未实现)屏幕，一个堆栈保存登录用户的主屏幕。应用程序启动时，<em class="kw">正在加载</em>状态为活动状态，并且<em class="kw">用户将</em>状态记录为假；它将显示一个页面加载器，在此期间，我们将使用useEffect检查Firebase用户状态:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="e38d" class="nc lr iq my b gy nd ne l nf ng">Firebase.auth().onAuthStateChanged((user) =&gt; {…})</span></pre><p id="d0f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果它改变并返回一个用户，那么我们根据用户对象的存在将<em class="kw"> isLoading </em>设置为false，将<em class="kw"> userLogged </em>设置为true或false。这两个值的组合允许我们显示正确的堆栈。<br/>如果用户登录，堆栈显示主屏幕(实际上只有一个退出按钮和一个切换主题的按钮)，如果用户没有登录，它显示登录屏幕，还有一个注册屏幕的链接。<br/>我构建这个项目是为了将来在需要用户登录的更大的应用程序中实现。这个应用程序也没有错误凭证的错误消息和其他容易实现的东西(代码被注释)</p><h1 id="bd37" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">先决条件</h1><p id="f3da" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">在开始编码之前，我在Firebase(<a class="ae lp" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.firebase.google.com/</a>)上创建了一个新项目，并添加了认证服务，我选择了电子邮件/密码作为登录方式，我还创建了一个测试用户:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/010d54ebc7af15f6cef17fb4c82d9ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blg5UQH0SDv_4YZMtjJ_jA.png"/></div></div></figure><p id="aff1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我从项目设置中复制了Firebase配置(左上角的齿轮图标)</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/8cb2919bf88a57ea58fd59a1dd9adc96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPAQ5005ctOylyDIvY7n4A.png"/></div></div></figure><p id="0e03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在世博会开始了一个新项目:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="de07" class="nc lr iq my b gy nd ne l nf ng">expo init FirebaseLogin</span></pre><p id="88d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且我安装了一些我计划使用的模块(这个项目只需要firebase、navigation和Constants，但是我也安装了localization和react-native-paper)</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="1230" class="nc lr iq my b gy nd ne l nf ng">expo install firebase<br/>npm install react-native-paper<br/>expo install expo-localization<br/>npm install i18n-js<br/>expo install expo-constants<br/>npm install @react-navigation/native<br/>//navigation dependencies<br/>expo install react-native-gesture-handler react-native-reanimated react-native-screens react-native-safe-area-context @react-native-community/masked-view</span></pre><p id="2636" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">配置app.json以包含Firebase conf</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="177a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦app.json包含了Firebase配置，就可以导入到其他文件中；例如，我们在项目的根目录下创建一个文件，在那里我们根据配置初始化Firebase应用程序，然后我们可以在其他屏幕和组件中导入这个初始化</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4a5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我们将使用上下文(为了使函数和对象可用于多个组件，我们创建了一个可用于以后导入的上下文，它将被称为mainContext，并将被用作周围的提供者:</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="bc34" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">App.js</h1><p id="c7b1" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">这将是我们的应用程序的切入点，让我们开始导入一些东西，没有什么花哨的只是所需的模块，和一些定义</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3e35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，仍然在App.js中，我们可以继续构建应用程序</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="2f1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，应用程序不会运行，因为我们仍然缺少屏幕，让我们添加它们</p><h1 id="274b" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">HomeScreen.js</h1><p id="e41f" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">这是用户登录后将看到的屏幕，它非常简单，只有一个带有退出按钮和切换主题按钮的空白页面；两个onPress动作都激活了一个函数，该函数通过上下文<br/>对屏幕可用。当前用户来自<em class="kw">firebase . auth()</em>̶i̶t̶̶c̶a̶n̶̶a̶l̶s̶o̶̶b̶e̶̶r̶e̶a̶d̶̶f̶r̶o̶m̶̶c̶o̶n̶t̶e̶x̶t̶，我坚持使用它，因为用户并不总是出现在上下文中(我认为这是因为一切都是异步的)</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/aa95321cffa96e8e6abbacf24c22de91.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*GZh1geCaDqbTMo9yqL0NoA.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">This is how the Home looks like</figcaption></figure><h1 id="c917" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">LoginScreen.js</h1><p id="8ff4" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">这里也没有什么奇特的，一个简单的表单，接受电子邮件和密码(更新和管理，但钩状态)，执行一个功能“抓取”从上下文，它还包含一个链接导航到注册屏幕</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/0b584ecfb6e7daca39a86963ad0fafe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*L9RUI1GpHoP5U0-N-tV13g.png"/></div></figure><h1 id="6c22" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">SignUpScreen.js</h1><p id="11f1" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">注册屏幕只需使用Firebase API创建一个新用户，并在创建时登录该用户</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/914d6a050a56f798a7214b843b15a793.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*Gad4QpA_IqJQpxkvCi5hLA.png"/></div></figure><h1 id="6b87" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">其他有用的东西</h1><p id="33fa" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">我添加了几个我总是很难实现的细节，以方便使用。<br/>例如，包含键盘的屏幕被括在</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="825e" class="nc lr iq my b gy nd ne l nf ng">&lt;TouchableWithoutFeedback onPress={() =&gt; Keyboard.dismiss()}&gt;</span><span id="d4dc" class="nc lr iq my b gy nq ne l nf ng">//CODE</span><span id="e72b" class="nc lr iq my b gy nq ne l nf ng">&lt;/TouchableWithoutFeedback&gt;</span></pre><p id="c5ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，如果您在文本输入之外单击，键盘将会关闭</p><h2 id="f8d1" class="nc lr iq bd ls nr ns dn lw nt nu dp ma kj nv nw me kn nx ny mi kr nz oa mm ob bi translated">翻译</h2><p id="abfe" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">为了让翻译工作，我使用了以下“框架”:</p><ul class=""><li id="51cd" class="oc od iq ka b kb kc kf kg kj oe kn of kr og kv oh oi oj ok bi translated">创建一个本地化实用程序，如下所示:</li></ul><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="6cec" class="nc lr iq my b gy nd ne l nf ng">//utils/localization.js<br/>import * as Localization from 'expo-localization';<br/>import loc from 'i18n-js';</span><span id="556e" class="nc lr iq my b gy nq ne l nf ng">//Get the device language<br/>loc.locale = Localization.locale; </span><span id="6fe3" class="nc lr iq my b gy nq ne l nf ng">//Create as many translation you need<br/>import en from '../locale/en';<br/>import it from '../locale/it'; </span><span id="6c99" class="nc lr iq my b gy nq ne l nf ng">loc.fallbacks = true;<br/>loc.translations = { it,  en,}; </span><span id="7bbd" class="nc lr iq my b gy nq ne l nf ng">export default loc;</span></pre><ul class=""><li id="1a93" class="oc od iq ka b kb kc kf kg kj oe kn of kr og kv oh oi oj ok bi translated">创建本地化字典</li></ul><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="ff02" class="nc lr iq my b gy nd ne l nf ng">//locale/en.js<br/>export default {<br/> mappa: 'Map'<br/> clickme: 'Click me',<br/> home: 'Home',<br/> notifiche: 'Notifications',<br/> entra: 'Login',<br/> loginButton: 'Login',<br/> signupButton: 'Sign Up',<br/> noaccount: 'Sign up here',<br/> signup: 'Sign Up',<br/> nome: 'Full name',<br/> signout: 'Sign out',<br/> theme: 'Switch theme',<br/>};</span></pre><ul class=""><li id="c735" class="oc od iq ka b kb kc kf kg kj oe kn of kr og kv oh oi oj ok bi translated">在组件中使用本地化字符串</li></ul><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="d817" class="nc lr iq my b gy nd ne l nf ng">//Component.js<br/>import loc from '../utils/localization';</span><span id="8b26" class="nc lr iq my b gy nq ne l nf ng">...</span><span id="27f0" class="nc lr iq my b gy nq ne l nf ng">&lt;Text&gt;{loc.t('clickme')}&lt;/Text&gt;</span></pre><h1 id="36d1" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">待办事项</h1><p id="dd7b" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">如果登录凭证错误或其他类型的错误，登录页面不会显示错误，登录仅在手机在线时有效(当然),但不检查互联网是否可用，代码肯定会得到优化</p><h1 id="770d" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">需要帮助吗？</h1><p id="45bf" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">这个项目需要帮助吗？在https://github.com/popeating/FirebaseLogin<a class="ae lp" href="https://github.com/popeating/FirebaseLogin" rel="noopener ugc nofollow" target="_blank">下载完整的项目</a></p><p id="5e02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在lennaz@gmail.com联系我</p></div></div>    
</body>
</html>