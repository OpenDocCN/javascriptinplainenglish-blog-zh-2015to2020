<html>
<head>
<title>Use Angular Style Environment Config in NestJS or Any NodeJs App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在NestJS或任何NodeJs应用程序中使用Angular样式的环境配置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-angular-style-environment-config-file-in-nestjs-app-d29aafda989c?source=collection_archive---------5-----------------------#2020-08-16">https://javascript.plainenglish.io/use-angular-style-environment-config-file-in-nestjs-app-d29aafda989c?source=collection_archive---------5-----------------------#2020-08-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b566" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个简单的、强类型的、延迟加载的解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2cbaf8c899ed9072f8156e7e11fb3354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3uiP7ZMRAExyoZOz"/></div></div></figure><p id="1727" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">管理Web应用程序的不同环境配置是一项基本任务。NestJS提供了一个现成的<a class="ae ln" href="https://docs.nestjs.com/techniques/configuration" rel="noopener ugc nofollow" target="_blank">配置包</a>，基于。环境文件。然而，我个人的偏好是使用Angular风格的环境配置文件。</p><p id="8cc6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文将描述一个简单的环境配置解决方案。该解决方案在一个NestJS应用程序中进行了说明，但它可以在任何NodeJs应用程序中工作。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="0765" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">特定于环境的默认配置</h2><p id="c749" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">配置文件结构如下所示。<em class="mt"> settings.json </em>包含带有默认值的基本配置，而<code class="fe mu mv mw mx b"><em class="mt">settings.[environment].json</em></code>存储可以覆盖默认值的特定于环境的配置。</p><pre class="kg kh ki kj gt my mx mz na aw nb bi"><span id="d904" class="lv lw iq mx b gy nc nd l ne nf">└──Project/src/environments/<br/>                   └──settings.json<br/>                   └──settings.prod.json<br/>                   └──settings.dev.json</span></pre><p id="e467" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了便于说明，下面列出了示例设置。</p><pre class="kg kh ki kj gt my mx mz na aw nb bi"><span id="a3b7" class="lv lw iq mx b gy nc nd l ne nf">// settings.json<br/>{<br/>  "apiUrl": "http://default-url",<br/>  "databaseName": "testDB",<br/>  "logLevel": "info"<br/>}</span><span id="2003" class="lv lw iq mx b gy ng nd l ne nf">// settings.dev.json<br/>{<br/>  "apiUrl": "http://test-url"<br/>}</span><span id="8661" class="lv lw iq mx b gy ng nd l ne nf">// settings.prod.json<br/>{<br/>  "apiUrl": "http://production-url",<br/>  "databaseName": "productionDB"<br/>}</span></pre></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="6ab7" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">设置模型</h2><p id="313a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">一个<em class="mt"> settingModel.ts </em>类表示配置模型。</p><pre class="kg kh ki kj gt my mx mz na aw nb bi"><span id="dc2d" class="lv lw iq mx b gy nc nd l ne nf">export class SettingModel {<br/>  databaseName: string;<br/>  apiUrl: string;<br/>  logLevel: 'info' | 'debug' | 'warning' | 'error';<br/>}</span></pre></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="bf73" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">加载配置</h2><p id="cab6" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">使用<em class="mt"> serverSetting.ts </em>加载配置。</p><pre class="kg kh ki kj gt my mx mz na aw nb bi"><span id="c7a4" class="lv lw iq mx b gy nc nd l ne nf">import * as prodSettings from './environments/settings.prod.json';<br/>import * as devSettings from './environments/settings.dev.json';<br/>import * as defaultSettings from './environments/settings.json';</span></pre><p id="0946" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe mu mv mw mx b">getServerSettings</code> <em class="mt"> </em>方法中，我们基于<code class="fe mu mv mw mx b"> <strong class="kt ir">NODE_ENV</strong></code> <strong class="kt ir"> </strong>全局变量加载环境特定的设置。请注意<code class="fe mu mv mw mx b">Object.assign</code>用于将默认设置与特定环境的设置对象合并。这对于本示例来说已经足够了，但是如果您的设置包含嵌套对象，这可能还不够。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/21db8d3669888fb6c8ca0a278bca04c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cy37cYdPNOPLThnPK07CIw.png"/></div></div></figure><p id="0939" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw mx b"><em class="mt">serverSetting.ts</em> </code>服务被设计成只加载设置一次。下面列出了完整的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="b6a5" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">使用配置</h2><p id="ad2d" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">这些配置可以在应用程序中使用，如下所示。</p><pre class="kg kh ki kj gt my mx mz na aw nb bi"><span id="4edf" class="lv lw iq mx b gy nc nd l ne nf">const settings = ServerSetting.getInstance().Settings;</span></pre><p id="a061" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们在不同的环境中运行应用程序时，结果如下。</p><pre class="kg kh ki kj gt my mx mz na aw nb bi"><span id="f672" class="lv lw iq mx b gy nc nd l ne nf">// When run in development mode<br/>{<br/>  apiUrl: '<a class="ae ln" href="http://test-url'" rel="noopener ugc nofollow" target="_blank">http://test-url'</a>,<br/>  databaseName: 'testDB',<br/>  logLevel: 'info' <br/>}<br/>// When run in production mode<br/>{<br/>  apiUrl: '<a class="ae ln" href="http://production-url'" rel="noopener ugc nofollow" target="_blank">http://production-url'</a>,<br/>  databaseName: 'productionDB',<br/>  logLevel: 'info' <br/>}</span></pre></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="5841" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">摘要</h2><p id="5d81" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">在Node.js中，通常使用全局变量<strong class="kt ir"> process.env </strong>，它包含环境的状态。然而，我不喜欢将特定于应用程序的配置合并到已经很大的全局变量对象中。</p><p id="3dd8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该解决方案是创建单一服务来管理应用程序配置的替代方案。强类型模型类中表示的设置是延迟加载的。因为所有配置都存储在JSON文件中，所以很容易通过CI/CD转换/覆盖敏感的生产设置，并且生产设置文件只能包含占位符。</p><p id="d177" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你觉得这篇文章有用，你也可以看看下面这篇文章。</p><div class="nk nl gp gr nm nn"><a rel="noopener  ugc nofollow" target="_blank" href="/angular-state-management-with-observable-service-pattern-27b18538f4c3"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">具有可观察服务模式的角度状态管理</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">Angular状态管理是任何Angular应用程序的核心，但没有放之四海而皆准的解决方案。</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob kp nn"/></div></div></a></div><p id="a507" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编程快乐！</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="ac8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mt">如果您还不是Medium、</em> <a class="ae ln" href="https://sunnysun-5694.medium.com/membership" rel="noopener"> <strong class="kt ir"> <em class="mt">的付费会员，您可以通过访问此链接</em> </strong> </a> <em class="mt">进行注册。你可以无限制地阅读媒体上的所有报道。我会收你一部分会员费作为介绍费。</em></p></div></div>    
</body>
</html>