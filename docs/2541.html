<html>
<head>
<title>Deploy using Github Actions on AWS Elastic BeanStalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS Elastic BeanStalk上使用Github操作进行部署</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deploy-using-github-actions-on-aws-elastic-beanstalk-c23ecd35776d?source=collection_archive---------2-----------------------#2020-07-04">https://javascript.plainenglish.io/deploy-using-github-actions-on-aws-elastic-beanstalk-c23ecd35776d?source=collection_archive---------2-----------------------#2020-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/75945c6b121ffe0b8d210f9269329e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Zhoq20rqfXzZp1fGSzJfQ.jpeg"/></div></div></figure><p id="f85f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将介绍使用Github操作在AWS Elastic BeanStalk上部署节点应用程序的过程。</p><p id="24f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然我一直在使用TravisCI进行部署，但是当我开始使用Github Actions时，我觉得已经没有回头路了。Github动作让你的web应用程序的部署变得超级简单❤.</p><h2 id="0032" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">什么是弹性豆茎？</h2><p id="2700" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">AWS Elastic Beanstalk是一个编排服务，它抽象出一些硬件资源和细节(例如设置AWS组件和容器)，同时仍然允许开发人员在操作系统和编程语言方面有一系列选择。Elastic Beanstalk采用自动扩展和弹性负载平衡来扩展和平衡工作负载。它以Amazon <a class="ae lu" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> CloudWatch </a>的形式提供工具来监控部署的应用程序的健康状况。由于依赖AWS S3和EC2，它还提供容量配置。</p><p id="ab25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您所要做的就是上传您的应用程序代码，而Elastic Beanstalk会负责部署、负载平衡和容量供应。只需一次点击，您就可以启动所有必要的应用服务器运行。Elastic Beanstalk服务本身是免费的，只对您实际使用的AWS资源收费。</p><h2 id="ab1a" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">什么是Github动作？</h2><p id="b29d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">GitHub动作让你有可能直接从GitHub库自动化你的软件开发工作流程。换句话说，<code class="fe lv lw lx ly b">you will be able to initiate the deployment of your application from the same place where your code is stored.</code></p><p id="94b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Github Actions的另一个伟大特性是，工作流可以在Github托管的机器上的Linux、macOS、Windows和容器中运行。Github Actions完全支持Elastic Beanstalk web应用程序，因此您可以直接从存储库中部署您的应用程序。</p><p id="91f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在本文中试图实现的管道是:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/0996af1919ec80f419f176c8e03b6601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a4gteAJboafqjoQvlNV-4w.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">CI/CD Pipeline</figcaption></figure><p id="e981" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了适当的操作，您就可以启动诸如无缝构建和部署Docker容器之类的功能。当您将操作组合到工作流中时，事件可以触发一系列复杂的流程以并行顺序运行，从而实现更具响应性的体系结构。</p><blockquote class="mi"><p id="6cc1" class="mj mk iq bd ml mm mn mo mp mq mr kv dk translated">自动化您从创意到生产的工作流程。</p></blockquote><h1 id="eff5" class="ms kx iq bd ky mt mu mv lb mw mx my le mz na nb lh nc nd ne lk nf ng nh ln ni bi translated">入门指南</h1><p id="3225" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated"><a class="ae lu" href="https://aws.amazon.com/elasticbeanstalk/" rel="noopener ugc nofollow" target="_blank"> Elastic Beanstalk </a>会在我们创建应用程序时自动为我们创建一个<a class="ae lu" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> EC2 </a>实例，这是我们的Node.js服务器托管的地方。</p><h2 id="3d70" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">设置弹性豆茎环境的步骤:</strong></h2><ol class=""><li id="74dc" class="nj nk iq ka b kb lp kf lq kj nl kn nm kr nn kv no np nq nr bi translated">为了设置弹性BeanStalk环境，我建议您阅读<a class="ae lu" href="http://bit.ly/deploy-angular-application-on-aws-beanstalk" rel="noopener ugc nofollow" target="_blank">配置EB环境的分步指南</a>直到步骤#9，您可以跳过负载平衡器步骤或观看AWS的视频<a class="ae lu" href="https://www.youtube.com/watch?v=xhc1boyBkJw" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="5ac0" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv no np nq nr bi translated">为了提高性能，您可以将代理服务器配置为从web应用程序内的一组目录中提供静态文件(例如，HTML或图像)。为了在EB上统计部署您的节点应用程序，您需要添加<em class="nx">。ebextensions/deploy.config文件:</em></li></ol><p id="39e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">遵循<a class="ae lu" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environment-cfg-staticfiles.html" rel="noopener ugc nofollow" target="_blank">此</a>获取更多信息，以静态方式提供您的文件。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="3c65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦设置了Beanstalk环境，您还可以在每次构建后在EB控制台中监控环境的健康状况:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/eeb1fe7c87e1c5391f726f6079595d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NB7-vk3Fh8AZy-t2LDXMWw.png"/></div></div></figure><h2 id="0f76" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">构建项目的步骤:</strong></h2><ol class=""><li id="8a41" class="nj nk iq ka b kb lp kf lq kj nl kn nm kr nn kv no np nq nr bi translated">安装依赖项来静态地服务于您的节点应用程序。</li></ol><pre class="ma mb mc md gt ob ly oc od aw oe bi"><span id="e55f" class="kw kx iq ly b gy of og l oh oi">npm i serve --save</span></pre><p id="f035" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.在节点应用程序的生产文件夹中，确保更改<code class="fe lv lw lx ly b">package.json</code>文件中的<code class="fe lv lw lx ly b">start</code>脚本。</p><pre class="ma mb mc md gt ob ly oc od aw oe bi"><span id="0144" class="kw kx iq ly b gy of og l oh oi">"scripts": {<br/>    "start": "serve -s build",<br/>}</span></pre><p id="e749" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你给它起了别的名字，用你的主服务器文件替换<code class="fe lv lw lx ly b">server.js</code>。这太有弹性了，Beanstalk知道使用哪个文件来启动您的服务器。</p><h2 id="d77c" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">创建您的Github Actions工作流的步骤:</strong></h2><ol class=""><li id="18f2" class="nj nk iq ka b kb lp kf lq kj nl kn nm kr nn kv no np nq nr bi translated">进入你的GitHub库，点击<strong class="ka ir">动作</strong>标签按钮。</li></ol><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/168cddcea39e26c2b46d3b8611ba7d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gjr1U4NklP7tuYEvPE9Pg.png"/></div></div></figure><p id="ed5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.点击<strong class="ka ir">右上角的</strong>按钮建立自己的工作流程，如下图所示。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/cb08f5a72f1dde6ce733c8381aad8c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpIpn4aGN1a_V6ZCCakCGQ.png"/></div></div></figure><p id="67fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.在编辑器中粘贴下面的代码片段并点击右上角的<strong class="ka ir">开始提交</strong>按钮。添加一些提交消息并点击<strong class="ka ir">提交新文件按钮。我已经添加了注释来解释这个工作流程的每个步骤。</strong></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="84c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，<code class="fe lv lw lx ly b">push and pull request events</code>触发了这个工作流，但是我们也可以让它在各种<a class="ae lu" href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows#webhook-events" rel="noopener ugc nofollow" target="_blank">其他事件</a>上触发。</p><p id="588f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.在你机器上的IDE中打开你的项目，从<code class="fe lv lw lx ly b">master</code>分支中提取更新的代码。</p><p id="b3e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.现在，转到您的存储库的<strong class="ka ir">设置</strong>选项卡，并在侧边菜单上选择<strong class="ka ir">机密。</strong>秘密是您的私有值，如AWS秘密密钥和访问密钥，它们不应该直接出现在您的代码中。</p><p id="963f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">6.点击<strong class="ka ir">添加新秘密</strong>按钮，添加您的AWS秘密密钥和访问密钥，推荐名称为<code class="fe lv lw lx ly b">AWS_ACCESS_KEY</code>和<code class="fe lv lw lx ly b">AWS_SECRET_KEY.</code></p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/6b80c3c501c6c4840d954743fc607370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWOTSTLWReZiYYfr8v4CVw.png"/></div></div></figure><p id="0b6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您成功配置了所有内容，您的工作流应该如下所示:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/cc92d2f2289251eb24965f9e19e1106c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ykneJ3qNZrg5iMfMLgdlRw.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Output of the pipeline</figcaption></figure><p id="f4ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样，用Github动作为您的节点项目创建您自己的CI/CD管道就这么简单。您只需要创建一个工作流文件来在云上部署您的节点项目。</p><p id="b4d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在以下位置找到工作流和EB配置文件:</p><div class="on oo gp gr op oq"><a href="https://github.com/anjy-07/micro-frontend/tree/master/react-charts" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">anjy-07/微前端</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">演示微前端原理的简单Github仪表板…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe jw oq"/></div></div></a></div></div></div>    
</body>
</html>