<html>
<head>
<title>Introduction to Programmatic Approach for Testing with Mocha</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍使用Mocha进行测试的编程方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-programmatic-approach-to-mocha-testing-framework-e10d1947148e?source=collection_archive---------2-----------------------#2020-03-29">https://javascript.plainenglish.io/introduction-to-programmatic-approach-to-mocha-testing-framework-e10d1947148e?source=collection_archive---------2-----------------------#2020-03-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="ad49" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Mocha框架的简单有效的自动化测试方法</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/6e9192b249fb793fa5d73455e659adae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0efv86xpRVn4SMWDZgeYQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Mocha — Testing Framework (simple, flexible, fun)</figcaption></figure><blockquote class="ks kt ku"><p id="97b2" class="kv kw kx ky b kz la jo lb lc ld jr le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">Mocha是一个功能丰富的JavaScript测试框架，运行在<a class="ae ls" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和浏览器中，使异步测试<em class="in">变得简单</em>和<em class="in">有趣</em>。Mocha测试连续运行，允许灵活和准确的报告，同时将未捕获的异常映射到正确的测试用例。托管在<a class="ae ls" href="https://github.com/mochajs/mocha" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p></blockquote><p id="971b" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">让我们从了解如何快速设置mocha框架并执行一个示例测试开始。请确保已经安装了<a class="ae ls" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> node.js </a>。</p><p id="50b5" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">打开你的终端，安装mocha和chai(断言库)包。</p><pre class="kd ke kf kg gt lw lx ly lz aw ma bi"><span id="9041" class="mb mc in lx b gy md me l mf mg">mkdir programmatic-mocha-framework &amp;&amp; cd programmatic-mocha-framework<br/>npm init -y<br/>npm i mocha chai</span><span id="695c" class="mb mc in lx b gy mh me l mf mg">//setup first test</span><span id="959f" class="mb mc in lx b gy mh me l mf mg">mkdir test<br/>touch test/sample-test.js</span></pre><p id="3af3" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">打开sample-test.js并粘贴以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">test/sample-test.js</figcaption></figure><p id="0858" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">更新<code class="fe mk ml mm lx b">package.json</code>中的<code class="fe mk ml mm lx b">scripts</code>。</p><pre class="kd ke kf kg gt lw lx ly lz aw ma bi"><span id="4d2b" class="mb mc in lx b gy md me l mf mg">"scripts": {<br/>   "test": "mocha"<br/>},</span></pre><p id="5677" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">通过运行<code class="fe mk ml mm lx b">npm run test</code>执行测试，当0–9的数字小于10时，将生成所有10个测试都通过的终端报告。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/70edf09a11a15e3573be268dd6151b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36S621h6BZsDmJCSbFD6Kw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Mocha Execution Results</figcaption></figure><h2 id="69ea" class="mb mc in bd mo mp mq dn mr ms mt dp mu lt mv mw mx lu my mz na lv nb nc nd ne bi translated"><strong class="ak">现在，让我们看看如何以</strong> <a class="ae ls" href="https://github.com/mochajs/mocha/wiki/Using-mocha-programmatically" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">程序化</strong> </a> <strong class="ak">的方式编写同样的测试。</strong></h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/c8d4b72438532cadf0a66e459988f1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DvXLUL4YqQHhrLEY"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ls" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae ls" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0c4c" class="ng mc in bd mo nh ni nj mr nk nl nm mu jt nn ju mx jw no jx na jz np ka nd nq bi translated">第一步</h1><p id="e398" class="pw-post-body-paragraph kv kw in ky b kz nr jo lb lc ns jr le lt nt lh li lu nu ll lm lv nv lp lq lr ig bi translated">通过运行<code class="fe mk ml mm lx b">mkdir lib &amp;&amp; touch lib/mocha-setup.js</code>在<code class="fe mk ml mm lx b">lib</code>文件夹中创建新的<code class="fe mk ml mm lx b">mocha-setup.js</code>。顾名思义，这将包含mocha测试所需的基本设置。该文件提供了创建新套件和测试的能力，并公开了执行它们的函数。</p><p id="4a5c" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">在将下面的代码复制到您的测试设置文件之前，安装基本设置所需的两个包<code class="fe mk ml mm lx b">npm i moment-timezone mochawesome</code></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">lib/mocha-setup.js</figcaption></figure><h1 id="7491" class="ng mc in bd mo nh ni nj mr nk nl nm mu jt nn ju mx jw no jx na jz np ka nd nq bi translated">第二步</h1><p id="71a0" class="pw-post-body-paragraph kv kw in ky b kz nr jo lb lc ns jr le lt nt lh li lu nu ll lm lv nv lp lq lr ig bi translated">创建实际测试套件和测试的时间。首先，让我们通过运行<code class="fe mk ml mm lx b">mkdir programmatic &amp;&amp; touch programmatic/sample-tests.js</code>创建一个新文件来放置这些样本测试。在该文件中，我们将:</p><ul class=""><li id="48e9" class="nw nx in ky b kz la lc ld lt ny lu nz lv oa lr ob oc od oe bi translated">在测试目录下添加相同的测试，但是以编程的方式</li><li id="b2df" class="nw nx in ky b kz of lc og lt oh lu oi lv oj lr ob oc od oe bi translated">在父套件下添加另一个测试套件，并在子套件中添加测试</li><li id="49ef" class="nw nx in ky b kz of lc og lt oh lu oi lv oj lr ob oc od oe bi translated">在父套件下添加测试目录</li></ul><p id="ee72" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">将以下代码复制到sample-tests.js</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">programmatic/sample-tests.js</figcaption></figure><h1 id="2f86" class="ng mc in bd mo nh ni nj mr nk nl nm mu jt nn ju mx jw no jx na jz np ka nd nq bi translated">第三步</h1><p id="627f" class="pw-post-body-paragraph kv kw in ky b kz nr jo lb lc ns jr le lt nt lh li lu nu ll lm lv nv lp lq lr ig bi translated">一旦所有的测试套件都设计好了，就该看看如何执行它们了。</p><p id="b781" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">创建新文件<code class="fe mk ml mm lx b">execute-test.js</code>并复制以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">execute-test.js</figcaption></figure><h1 id="130a" class="ng mc in bd mo nh ni nj mr nk nl nm mu jt nn ju mx jw no jx na jz np ka nd nq bi translated">第四步</h1><p id="68d2" class="pw-post-body-paragraph kv kw in ky b kz nr jo lb lc ns jr le lt nt lh li lu nu ll lm lv nv lp lq lr ig bi translated">更新<code class="fe mk ml mm lx b">package.json</code>，用以下代码替换<code class="fe mk ml mm lx b">scripts</code></p><pre class="kd ke kf kg gt lw lx ly lz aw ma bi"><span id="071d" class="mb mc in lx b gy md me l mf mg">"scripts": {<br/>     "test": "node execute-tests.js"<br/>},</span></pre><p id="ceff" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">让我们通过运行相同的命令<code class="fe mk ml mm lx b">npm run test</code>来执行测试。这将自动创建一个名为<code class="fe mk ml mm lx b">execution-report</code>的新文件夹，并将基于当前日期时间创建子文件夹。Mochawesome html和json可以在<code class="fe mk ml mm lx b">currentime</code>文件夹中找到。我已经执行了几次测试，因此有多个时间戳文件夹。您的整个目录将如下所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/e4dc5cc250790f992b718fed930430d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMJtvOh29oAwPNAQbxIW8g.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Programmatic Mocha Execution</figcaption></figure><p id="46c9" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">打开在最新时间戳文件夹<code class="fe mk ml mm lx b">22:03:03</code>下生成的mochawesome.html报告(名称会根据执行时间而改变)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/f0ac8802a233f6170ac3b7b10171d0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WD9_VEnEHlkONp1Zh_h_7Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Mochawesome Execution Report</figcaption></figure><p id="745c" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">就这样……在<code class="fe mk ml mm lx b">programmatic/sample-tests.js</code>中随意添加更多的测试</p></div><div class="ab cl ol om hr on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ig ih ii ij ik"><h1 id="0ec9" class="ng mc in bd mo nh os nj mr nk ot nm mu jt ou ju mx jw ov jx na jz ow ka nd nq bi translated">利益</h1><p id="322e" class="pw-post-body-paragraph kv kw in ky b kz nr jo lb lc ns jr le lt nt lh li lu nu ll lm lv nv lp lq lr ig bi translated">在研究这种方法时，我发现了一些好处:</p><ul class=""><li id="f833" class="nw nx in ky b kz la lc ld lt ny lu nz lv oa lr ob oc od oe bi translated">从实际框架中抽象出测试</li><li id="2022" class="nw nx in ky b kz of lc og lt oh lu oi lv oj lr ob oc od oe bi translated">集中管理框架设计，并让每个计划/项目的测试归档</li><li id="7ae2" class="nw nx in ky b kz of lc og lt oh lu oi lv oj lr ob oc od oe bi translated">允许动态驱动测试数据——这是优于传统mocha的关键优势之一。通过这种方式，您可以动态地从csv文件中读取数据，并迭代生成相同数量的测试，而不是在代码中提供硬编码的值</li><li id="d909" class="nw nx in ky b kz of lc og lt oh lu oi lv oj lr ob oc od oe bi translated">不同团队使用的整个框架的一个地方的变化</li><li id="7e96" class="nw nx in ky b kz of lc og lt oh lu oi lv oj lr ob oc od oe bi translated">我已经使用这种方法将文件上传到S3 bucket，并通过提升lib/mocha-setup.js并传递initiative name作为参数来区分报告文件，从而在失败时通过电子邮件发送通知。</li></ul><p id="fc63" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">更多信息请访问“<a class="ae ls" href="https://github.com/mochajs/mocha/wiki/Using-mocha-programmatically" rel="noopener ugc nofollow" target="_blank">以编程方式使用Mocha】</a></p></div><div class="ab cl ol om hr on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ig ih ii ij ik"><p id="68b9" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">代码可在我的git <a class="ae ls" href="https://github.com/puneetpunj/programmatic-mocha-framework" rel="noopener ugc nofollow" target="_blank">这里</a>获得。如果有任何反馈，请随时联系我。</p><p id="3fd1" class="pw-post-body-paragraph kv kw in ky b kz la jo lb lc ld jr le lt lg lh li lu lk ll lm lv lo lp lq lr ig bi translated">【JavaScript用简单英语写的一句话:我们总是对帮助推广优质内容感兴趣。如果你有一篇文章想用简单的英语提交给JavaScript，用你的Medium用户名给我们发邮件到<a class="ae ls" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>，我们会把你添加为作者。</p></div></div>    
</body>
</html>