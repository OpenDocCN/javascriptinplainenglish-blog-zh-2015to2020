<html>
<head>
<title>Refactoring Existing Redux w/ Redux Toolkit &amp; Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重构现有Redux w/ Redux Toolkit &amp; Hooks</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/refactoring-existing-redux-w-redux-toolkit-hooks-550a628d74a9?source=collection_archive---------4-----------------------#2020-12-27">https://javascript.plainenglish.io/refactoring-existing-redux-w-redux-toolkit-hooks-550a628d74a9?source=collection_archive---------4-----------------------#2020-12-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2d6ad108488a1132a42e73daf9f77b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgwhbe1hCKVbopjose0v5g.jpeg"/></div></div></figure><p id="cbaf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在今年的Reactathon上，我有幸看到的最酷的演示之一是马克·埃里克森(Mark Erickson)的演示。他在那里展示了一些现代Redux技术，特别是React工具包和曾经流行的钩子的使用。它启发我回去重构我的一些旧Redux代码，从使用‘connect’高阶组件到使用工具包。因此，如果你想重构Redux来利用它的钩子，我将通过一个简单的重构和Redux Toolkit的实现。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="867b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我将从一个基本的React应用程序开始，它内置了一些Redux‘connect’功能。出于演示的目的，这将是一个简单的商店应用程序与项目计数器。下面是包含Redux功能的三个主要文件的基本设置。Reducer、Index.js(出于本演示的目的，我在这里创建了我的商店)和App.js(通过它的props连接到商店的状态和调度):</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lb"><img src="../Images/8cbc9f54318660fcc47f50a3a5c36d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RFcDnFQjiW6puz6w6qTBA.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Reducer (left) &amp; Index.js (right)</figcaption></figure><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lk"><img src="../Images/1f6f54ca7fd3f54a059f74b3cca26a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVGhvk-n2jxSXeJLJ6lOCA.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">App.js</figcaption></figure><p id="6514" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里我们已经设置好了一切。我们的应用程序组件订阅了我们的Redux store，它是单个状态(itemCount ),并且有它的单个分派方法来增加itemCount的计数。这是一个简单的superrrr设置，通常在一个较大规模的应用程序中，你会看到一个包含所有不同调度功能的动作文件，这样它们就可以跨组件重用，但这对于一个简单的演示来说是很好的。</p><p id="29b8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，我们从哪里开始重构代码以利用Redux Toolkit，然后使用React-Redux挂钩呢？嗯，安装它可能是个好主意。</p><pre class="lc ld le lf gt ll lm ln lo aw lp bi"><span id="83f2" class="lq lr in lm b gy ls lt l lu lv">npm install --save @reduxjs/toolkit </span></pre><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/098e9c5263ce66831677efaf33470127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QLfvd6ugvhrfXkubspHjA.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">packlock.json for Redux-Toolkit</figcaption></figure><p id="74d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将安装工具包，其中有一些工具方便地捆绑在一起。这不包括React-Redux，如果你打算使用Redux的钩子(useSelector，useDispatch ),你仍然需要安装React-Redux。它还附带了immer、thunk和reselect，所有这些都很有用，对于React Toolkit在更大范围内发挥作用非常重要。但是我们稍后还会回到这些。现在，让我们从重构一些现有代码开始。</p><p id="6bce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们将把store.js文件添加到Redux文件夹中。现在，我们将把商店的创建从index.js移到这个文件中。使用Redux Toolkit方法configureStore，我们可以导入storeReducer并导出到index.js，这是一个完全配置的存储。如果我们有多个减速器，这也是我们可以组合它们的地方(想想组合减速器)。下面是重构后的代码，一定要注意导入中的变化。在store.js中，我们现在从@reduxjs/toolkit导入。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/4a6e90f26c5fc43335de74627098355f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75IUhahyLzep_-E1hr5CbQ.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">New Store.js (left) &amp; Refactored Index.js (right)</figcaption></figure><p id="1abc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经完成了这两个变化，我们将继续真正的魔术，这将是在我们的storeReducer。这里我们将利用我最喜欢的Redux工具包方法“createSlice”。这将本质上把我们的缩减器和动作结合在一起，形成一个状态的“切片”。首先，为了清楚起见，我将把reducer文件重命名为storeSlice.js，然后从store.js文件中修改我们的导入。接下来，我们将从使用createSlice声明一个新切片开始。然后，我们将使用以“名称”开始的键/值对对其进行一些配置，这将与“存储”保持一致。接下来，我们还将定义它的初始状态，对于我们来说，它只包括最初设置为零的itemCount。在initialState之后，我们定义了Redux Toolkit导出后的reducers，这些Redux Toolkit将转化为我们可以在整个应用程序中使用的调度操作。最终，它应该看起来像这样，我把前面的Reducer代码留在了右边，以供参考。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ly"><img src="../Images/2702fb4f81796804d0a2e39a3ebf455b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f16eQZ_xuOxLDN6UpkPtSQ.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Refactored reducer into storeSlice</figcaption></figure><p id="891a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上面，您还可以看到我们正在导出“increaseCount ”,作为storeSlice的一项操作。这是我们最终将在应用程序组件中调用的调度方法。这就剩下我们遗漏的最后一个导出，它处理订阅状态。既然我们正在重构“connect”方法，并且没有将我们的状态/分派映射到props，我们将使用钩子“useSelector”。因此，我们需要在导出storeSlice.reducer之前导出我们的状态(itemCount)。</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lz"><img src="../Images/e52da96792a5312b5401c59e09bd59b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G1RGH0-CxSYru1HC3gv6CA.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Final storeSlice.js</figcaption></figure><p id="d20e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">State.store.itemCount指向我们命名为“store”的片，然后在我们的initialState中将itemCount设置为零。当然，selectItemCount是导出的常规命名，您可以随意命名。现在，我们最后一次重构将发生在我们的应用程序组件中！</p><p id="3283" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以做的第一件事是删除所有的mapState和mapDispatch代码。“取消连接”我们的应用程序组件，并更改我们所有的导入，以便我们现在从react-redux导入我们将需要的两个挂钩(useSelector &amp; useDispatch)。然后，我们还将从store slice(selectItemCount &amp; increase count)中导入我们的特定状态和我们的操作。</p><p id="9839" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后一步是在组件中使用它们。我们使用“useSelector”声明一个变量，它将为我们的组件订阅redux存储的那一部分。然后，我们还通过调用组件中的钩子来声明我们的调度。然后，我们只需点击应用程序按钮，调用调度方法“increaseCount ”!</p><figure class="lc ld le lf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ma"><img src="../Images/2ffd3c426e684f781015892714a7222d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUH79qpwJ23fDxgtCEU9ag.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Refactor of App.js</figcaption></figure><p id="cc6d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你知道了！我们从本质上重构了我们所有的原始功能，从Redux的“连接”方法到我们新的Redux工具包。当然，这只是Redux工具包功能的皮毛。能够使用Immer在我们新创建的slice中轻松操作状态的功能允许直接操作状态，这与Redux以前的工作方式相比是一个巨大的变化。此外，Thunk也包含在Redux Toolkit中，它允许通常对API的异步调用。在接下来的博文中，我将对这个例子进行扩展，并添加一些更复杂的状态操作，甚至一些使用JavaScripts ' fetch '的调度调用的虚拟例子。</p><p id="1e2a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当然，如果你想更深入地了解Redux Toolkit的功能和“幕后”发生的事情，他们官方网站上提供的文档是一个不可思议的资源。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="ddd8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">【1】:Redux-Toolkit Docs(</em>【https://redux-toolkit.js.org/】T2)</p><p id="0faf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">【https://redux.js.org/】【2】:Redux Docs(<a class="ae mb" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"/>)</p><p id="af13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">【3】:React-Redux Docs(</em><a class="ae mb" href="https://react-redux.js.org/" rel="noopener ugc nofollow" target="_blank">https://react-redux.js.org/</a>)</p></div></div>    
</body>
</html>