<html>
<head>
<title>Getting started with Yarn 2: Ambiguous imports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">纱线2入门:模糊的进口</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-yarn-2-ambiguous-imports-a207773b269c?source=collection_archive---------11-----------------------#2020-07-05">https://javascript.plainenglish.io/getting-started-with-yarn-2-ambiguous-imports-a207773b269c?source=collection_archive---------11-----------------------#2020-07-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d2ff" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何解决使用Yarn 2时的模糊进口噩梦</h2></div><p id="37dc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，如果你像我一样，想开发一个在根目录中使用自定义配置的CLI/DevKit，你可能会遇到一个小问题。暧昧的电话。例如，当您的应用程序试图。从Yarn的角度来看，这是不明确的，因此产生了这些错误。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/e286cc1ddde6928f07044633ba386c6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0nR1JMnS33QnpWXO"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Photo by <a class="ae ls" href="https://unsplash.com/@punttim?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tim Gouw</a> on <a class="ae ls" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3196" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一个快速简单的补丁是设置<code class="fe ky kz la lb b">pnpMode: "loose"</code>来关闭这些错误，但是当然这是不安全的。在<a class="ae ls" href="https://github.com/yarnpkg/berry" rel="noopener ugc nofollow" target="_blank">纱线</a>上打开一个问题之后，mal提到了一个修复方法，就是使用Node.js的<code class="fe ky kz la lb b">module.createRequire</code>特性。按照医生的说法，在一个小时试图使用<code class="fe ky kz la lb b">import.meta.url</code>让它工作之后，我决定做我最擅长的事情:停止试图成为我梦想中的开发人员，做一个理性的开发人员。所以我在<code class="fe ky kz la lb b">.yarn/</code>下研究了Yarn Modern的本地插件代码。我用的配置文件是什么？ESLint，它有一个由Yarn开发的兼容性插件。于是我在<code class="fe ky kz la lb b">.yarn/sdks/eslint/bin/eslint.js</code>里找，找到了我需要的。那么，我是如何解决这个问题的呢？6行代码。但是在我们开始之前，让我们假设我们有下面的配置，来自我的WIP项目<a class="ae ls" href="https://github.com/Noderalis" rel="noopener ugc nofollow" target="_blank"> Noderalis </a>。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="363d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在这里有一些基本的功能，其中一些是为上下文添加的，以证明这是可行的。注意<code class="fe ky kz la lb b">console.log('Success!!!');</code>，因为它显示我们在导入后自动执行。这就是为什么我们不需要导出Noderalis的配置，因为它会在执行时自动创建它。最后，我添加了一个小对象<code class="fe ky kz la lb b">testy</code>，来展示我们可以抓取东西，就像普通的导入一样。那么我们如何解决这个问题呢？我们来看看代码！</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="6f5b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们使用<code class="fe ky kz la lb b">createRequire</code>和<code class="fe ky kz la lb b">createRequireFromPath</code>(后者已被否决，但有效)，然后我们使用<code class="fe ky kz la lb b">require('path/to/.pnp.js').setup()</code>，它设置环境来要求我们的脚本。这是一个手动步骤，我不能保证做任何事情，因为它应该只在没有检测到PNP版本时运行，但手动运行它是我的工作，所以它不会太痛。请记住，我的require指向它自己，因为它是唯一需要使用这个逻辑的文件，并且工作得非常好。然后我们像平常一样使用自定义逻辑导入我们的配置！</p><pre class="ld le lf lg gt lv lb lw lx aw ly bi"><span id="1798" class="lz ma in lb b gy mb mc l md me"><strong class="lb io">PS C:\...&gt;</strong> yarn node .\packages\noderalis-core\sources\ProjectConfiguration.js<br/>found package<br/>found noderalis<br/>C:\...\noderalis\.noderalis.js<br/>Success!!!<br/>Successfully created something<br/>found package<br/>found noderalis<br/>C:\...\noderalis\.noderalis.js<br/>req: [object Object]<br/>req: { testy: { name: 'Grim', age: 22 } }<br/>req: [object Object]<br/>req: { testy: { name: 'Grim', age: 22 } }<br/>req: undefined<br/>req: undefined<br/>{ testy: { name: 'Grim', age: 22 } }</span></pre><p id="819e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这有点啰嗦，但经过几个小时的敲打我的头，它仍然是受欢迎的！这给了我们很大的帮助，正如我们可以看到的,<code class="fe ky kz la lb b">Success!!!</code>告诉我们，我们导入的配置自动执行了！我们还可以看到我们导出的<code class="fe ky kz la lb b">testy</code>对象，并在导入时记录下来。但是为什么它要重复前几行呢？回头看看配置，它导入了<code class="fe ky kz la lb b">ProjectConfiguration</code>,这也是导入它的脚本，所以它触发了两次，但这只有在记录您的步骤时才明显，就像我在事情没有按预期运行时做的那样。谈到调试，我有点模拟。</p><p id="165c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总之，这就是解决这个小问题所需的全部内容！另一方面，即使在删除自定义代码以尝试重现原来的错误后，它也不会出错。所以我假设<code class="fe ky kz la lb b">.pnp.js =&gt; setup()</code>可能为我们缓存了解析器。</p></div></div>    
</body>
</html>