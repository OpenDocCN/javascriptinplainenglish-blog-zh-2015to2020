<html>
<head>
<title>How to use async function in React hooks useEffect (Typescript/JS)?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React hooks use effect(Typescript/JS)中使用异步函数？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-async-function-in-react-hook-useeffect-typescript-js-6204a788a435?source=collection_archive---------0-----------------------#2019-10-18">https://javascript.plainenglish.io/how-to-use-async-function-in-react-hook-useeffect-typescript-js-6204a788a435?source=collection_archive---------0-----------------------#2019-10-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/93f27fab7fd94927600c9ceef74a572e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BS8VLFWxKRBTnB8jf65FvA.png"/></div></div></figure><p id="1bb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">👾乍一看，您可能会想到做一些类似的事情，例如从远程API获取内容。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a7da" class="lf lg iq lb b gy lh li l lj lk">const MyFunctionnalComponent: React.FC = (props) =&gt; {<br/>  useEffect(async () =&gt; {<br/>   await loadContent();<br/>  }, []);</span><span id="fbce" class="lf lg iq lb b gy ll li l lj lk">  return &lt;div&gt;&lt;/div&gt;;<br/>}</span></pre><h2 id="bf43" class="lf lg iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">🤔这有什么不好？</h2><p id="74b0" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">如果你使用的是<strong class="ka ir">类型脚本</strong>，编译器应该会产生如下结果:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9438" class="lf lg iq lb b gy lh li l lj lk">Argument of type '() =&gt; Promise&lt;void&gt;' is not assignable to parameter of type 'EffectCallback'.</span></pre><p id="5eb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们通过异步函数的定义来看看为什么会出现这个错误:</p><blockquote class="mi mj mk"><p id="4a0c" class="jy jz ml ka b kb kc kd ke kf kg kh ki mm kk kl km mn ko kp kq mo ks kt ku kv ij bi translated">一个允许使用带有<code class="fe mp mq mr lb b">await</code>关键字的异步指令的函数，只要await关键字之后的承诺没有解决，该函数就会阻止语句执行…</p></blockquote><p id="588c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好吧看起来很棒…但是等等…</p><blockquote class="mi mj mk"><p id="dd12" class="jy jz ml ka b kb kc kd ke kf kg kh ki mm kk kl km mn ko kp kq mo ks kt ku kv ij bi translated">这个函数也将返回一个承诺，不管你是否显式地返回某个东西。如果您返回数据，它将被包装在函数将自动创建和返回的承诺的解析内容中。</p></blockquote><p id="ea32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">哼！你是从这里开始发现问题的吗？没有吗？让我们在这里阅读一下<strong class="ka ir">的使用效果</strong>钩子来获得更多信息:<a class="ae ms" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/hooks-reference.html#useeffect</a></p><blockquote class="mi mj mk"><p id="0066" class="jy jz ml ka b kb kc kd ke kf kg kh ki mm kk kl km mn ko kp kq mo ks kt ku kv ij bi translated">通常，效果会创建需要在组件离开屏幕之前清理的资源，例如订阅或计时器ID。为此，<strong class="ka ir">传递给</strong> <code class="fe mp mq mr lb b"><strong class="ka ir">useEffect</strong></code> <strong class="ka ir">的函数可能会返回一个清理函数</strong>。例如，创建订阅。</p></blockquote><p id="2761" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">📌使用异步函数使回调函数返回一个承诺，而不是一个清理函数。</strong></p><p id="24d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是编译器在Typescript中让步的原因。这种模式在普通JS中也不起作用，因为React不等待承诺。</p><h2 id="30a3" class="lf lg iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">💡如何处理useEffect中的异步代码？</h2><p id="a183" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">通过使用以下技术，我们将能够在我们的效果中使用异步功能:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="73f4" class="lf lg iq lb b gy lh li l lj lk">const MyFunctionnalComponent: React.FC = props =&gt; {<br/>  useEffect(() =&gt; {<br/>    <em class="ml">// Create an scoped async function in the hook<br/>    </em>async function anyNameFunction() {<br/>      await loadContent();<br/>    }</span><span id="d1b0" class="lf lg iq lb b gy ll li l lj lk"><em class="ml">    // Execute the created function directly<br/>    </em>anyNameFunction();<br/>  }, []);</span><span id="451f" class="lf lg iq lb b gy ll li l lj lk">return &lt;div&gt;&lt;/div&gt;;<br/>};</span></pre><p id="d919" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您的代码是安全的，因为您没有返回任何内容，编译器也停止了让步。</p><p id="feaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">🎬奖金/TLDR；📦</strong></p><p id="bcc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也可以用一个IIFE，效果同上。</p><p id="2fcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不知道什么是生活:<a class="ae ms" href="https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174" rel="noopener">我的朋友苏尼尔·桑德胡</a>在这里描述了它。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9759" class="lf lg iq lb b gy lh li l lj lk">const MyFunctionnalComponent: React.FC = props =&gt; {<br/>  useEffect(() =&gt; {<br/>    <em class="ml">// Using an IIFE<br/>    </em>(async function anyNameFunction() {<br/>      await loadContent();<br/>    })();<br/>  }, []);</span><span id="ce73" class="lf lg iq lb b gy ll li l lj lk">  return &lt;div&gt;&lt;/div&gt;;<br/>};</span></pre><p id="fb28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ms" href="https://codingspark.io" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> 🇫🇷STOP！你是法国人吗🥖？您也可以访问ici网站，接收法国的私人通讯🙂</strong></a></p></div></div>    
</body>
</html>