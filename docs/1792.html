<html>
<head>
<title>Add Cross-Field Form Validation with Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">添加带角度的跨字段表单验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-cross-field-form-validation-with-angular-5b68f1915d62?source=collection_archive---------2-----------------------#2020-04-23">https://javascript.plainenglish.io/add-cross-field-form-validation-with-angular-5b68f1915d62?source=collection_archive---------2-----------------------#2020-04-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/27e3754689625b773264d9b7c752db47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ALU3B4u-kI8quhKG"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jrduncan11?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">John Duncan</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ef99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Angular是Google制作的一个流行的前端框架。像其他流行的前端框架一样，它使用基于组件的架构来构建应用程序。</p><p id="c040" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何添加跨字段验证，以验证依赖于具有角度模板驱动和反应式表单的其他表单字段的表单字段。</p><h1 id="3da7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加到反应形式</h1><p id="b4ee" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过创建一个获取多个表单控件的验证器函数，然后将它们放入我们的表单组中，从而为反应式表单添加跨字段验证。</p><p id="9f18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以编写以下代码来添加跨字段验证器，以验证密码和确认密码字段的值是否匹配:</p><p id="fae1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.module.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f171" class="mq lc iq mh b gy mr ms l mt mu">import { BrowserModule } from "@angular/platform-browser";<br/>import { NgModule } from "@angular/core";<br/>import { ReactiveFormsModule } from "@angular/forms";<br/>import { AppComponent } from "./app.component";</span><span id="c0e5" class="mq lc iq mh b gy mv ms l mt mu">@NgModule({<br/>  declarations: [AppComponent],<br/>  imports: [BrowserModule, ReactiveFormsModule],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule {}</span></pre><p id="3330" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">password-validator.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5a69" class="mq lc iq mh b gy mr ms l mt mu">import { ValidationErrors, FormGroup, ValidatorFn } from "@angular/forms";</span><span id="95c5" class="mq lc iq mh b gy mv ms l mt mu">export const passwordValidator: ValidatorFn = (<br/>  control: FormGroup<br/>): ValidationErrors | null =&gt; {<br/>  const password = control.get("password").value;<br/>  const confirmPassword = control.get("confirmPassword").value;<br/>  return password &amp;&amp; confirmPassword &amp;&amp; password === confirmPassword<br/>    ? null<br/>    : { passwordsNotEqual: true };<br/>};</span></pre><p id="8d2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.component.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="685d" class="mq lc iq mh b gy mr ms l mt mu">import { Component } from "@angular/core";<br/>import { FormControl, FormGroup } from "@angular/forms";<br/>import { passwordValidator } from "./password-validator";</span><span id="906d" class="mq lc iq mh b gy mv ms l mt mu">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  user = { password: "", confirmPassword: "" };<br/>  userForm;</span><span id="82bb" class="mq lc iq mh b gy mv ms l mt mu">  ngOnInit() {<br/>    this.userForm = new FormGroup(<br/>      {<br/>        password: new FormControl(),<br/>        confirmPassword: new FormControl()<br/>      },<br/>      { validators: passwordValidator }<br/>    );<br/>  }<br/>}</span></pre><p id="fe2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.component.html</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="626d" class="mq lc iq mh b gy mr ms l mt mu">&lt;form [formGroup]="userForm"&gt;<br/>  &lt;input formControlName="password" required placeholder="Password" /&gt;<br/>  &lt;br /&gt;<br/>  &lt;input<br/>    formControlName="confirmPassword"<br/>    required<br/>    placeholder="Confirm Password"<br/>  /&gt;</span><span id="2bbd" class="mq lc iq mh b gy mv ms l mt mu">  &lt;div<br/>    *ngIf="userForm.errors?.passwordsNotEqual &amp;&amp; (userForm.touched || userForm.dirty)"<br/>  &gt;<br/>    Passwords don't match.<br/>  &lt;/div&gt;<br/>&lt;/form&gt;</span></pre><p id="5a13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有我们的<code class="fe me mf mg mh b">passwordValidator</code>函数:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="121d" class="mq lc iq mh b gy mr ms l mt mu">export const passwordValidator: ValidatorFn = (<br/>  control: FormGroup<br/>): ValidationErrors | null =&gt; {<br/>  const password = control.get("password").value;<br/>  const confirmPassword = control.get("confirmPassword").value;<br/>  return password &amp;&amp; confirmPassword &amp;&amp; password === confirmPassword<br/>    ? null<br/>    : { passwordsNotEqual: true };<br/>};</span></pre><p id="1afa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它获取输入的值，然后检查它们是否相同。如果不是，那么我们返回一个错误对象。否则，我们返回<code class="fe me mf mg mh b">null</code>。</p><p id="c31d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们在<code class="fe me mf mg mh b">AppComponent</code>中创建表单，如下所示:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="19e9" class="mq lc iq mh b gy mr ms l mt mu">this.userForm = new FormGroup(<br/>      {<br/>        password: new FormControl(),<br/>        confirmPassword: new FormControl()<br/>      },<br/>      { validators: passwordValidator }<br/>    );</span></pre><p id="60d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，交叉字段<code class="fe me mf mg mh b">passwordValidator</code>被添加到第二个参数的对象中。</p><p id="59bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们在模板中显示验证消息，如下所示:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5825" class="mq lc iq mh b gy mr ms l mt mu">&lt;div<br/>    *ngIf="userForm.errors?.passwordsNotEqual &amp;&amp; (userForm.touched || userForm.dirty)"<br/>  &gt;<br/>  Passwords don't match.<br/>&lt;/div&gt;</span></pre><p id="e917" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检查整个表单而不是单个控件的错误。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/4974e890a2669b1d429164094115332d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oQqA3VsURaERLLVH"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@berkaygumustekin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Berkay Gumustekin</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c10e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">向模板驱动的表单添加跨字段验证</h1><p id="329d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要向模板驱动的表单添加跨字段验证，我们必须向表单添加一个指令，该指令运行我们之前创建的跨表单验证器。</p><p id="8642" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以编写以下代码来检查密码和确认密码字段是否输入了相同的值:</p><p id="968b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.module.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f8c6" class="mq lc iq mh b gy mr ms l mt mu">import { BrowserModule } from "@angular/platform-browser";<br/>import { NgModule } from "@angular/core";<br/>import { FormsModule } from "@angular/forms";<br/>import { AppComponent } from "./app.component";<br/>import { PasswordValidatorDirective } from "./password.directive";</span><span id="e85e" class="mq lc iq mh b gy mv ms l mt mu">@NgModule({<br/>  declarations: [AppComponent, PasswordValidatorDirective],<br/>  imports: [BrowserModule, FormsModule],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule {}</span></pre><p id="cdb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.component.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="bab1" class="mq lc iq mh b gy mr ms l mt mu">import { Component } from "@angular/core";</span><span id="68af" class="mq lc iq mh b gy mv ms l mt mu">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  user = { password: "", confirmPassword: "" };</span><span id="09c8" class="mq lc iq mh b gy mv ms l mt mu">ngOnInit() {}<br/>}</span></pre><p id="8d3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">password-validator.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1897" class="mq lc iq mh b gy mr ms l mt mu">import { ValidationErrors, FormGroup, ValidatorFn } from "@angular/forms";</span><span id="947f" class="mq lc iq mh b gy mv ms l mt mu">export const passwordValidator: ValidatorFn = (<br/>    control: FormGroup<br/>): ValidationErrors | null =&gt; {<br/>    const password = control.value['password'];<br/>    const confirmPassword = control.value['confirmPassword'];<br/>    return password &amp;&amp; confirmPassword &amp;&amp; password === confirmPassword<br/>        ? null<br/>        : { passwordsNotEqual: true };<br/>};</span></pre><p id="57af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">password.directive.ts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c4ff" class="mq lc iq mh b gy mr ms l mt mu">import { Directive } from "@angular/core";<br/>import {<br/>  AbstractControl,<br/>  Validator,<br/>  NG_VALIDATORS,<br/>  ValidationErrors<br/>} from "@angular/forms";<br/>import { passwordValidator } from "./password-validator";</span><span id="1385" class="mq lc iq mh b gy mv ms l mt mu">@Directive({<br/>  selector: "[appPassword]",<br/>  providers: [<br/>    {<br/>      provide: NG_VALIDATORS,<br/>      useExisting: PasswordValidatorDirective,<br/>      multi: true<br/>    }<br/>  ]<br/>})<br/>export class PasswordValidatorDirective implements Validator {<br/>  validate(control: AbstractControl): ValidationErrors {<br/>    return passwordValidator(control);<br/>  }<br/>}</span></pre><p id="f7dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.component.html</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b48b" class="mq lc iq mh b gy mr ms l mt mu">&lt;form appPassword #userForm="ngForm"&gt;<br/>  &lt;input<br/>    name="password"<br/>    #password="ngModel"<br/>    [(ngModel)]="user.password"<br/>    required<br/>    placeholder="Password"<br/>  /&gt;<br/>  &lt;br /&gt;<br/>  &lt;input<br/>    name="confirmPassword"<br/>    #confirmPassword="ngModel"<br/>    [(ngModel)]="user.confirmPassword"<br/>    required<br/>    placeholder="Confirm Password"<br/>  /&gt;</span><span id="60c1" class="mq lc iq mh b gy mv ms l mt mu">  &lt;div<br/>    *ngIf="userForm.errors?.passwordsNotEqual &amp;&amp; (userForm.touched || userForm.dirty)"<br/>  &gt;<br/>    Passwords don't match.<br/>  &lt;/div&gt;<br/>&lt;/form&gt;</span></pre><p id="4d5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有以下验证器:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ebaa" class="mq lc iq mh b gy mr ms l mt mu">export const passwordValidator: ValidatorFn = (<br/>    control: FormGroup<br/>): ValidationErrors | null =&gt; {<br/>    const password = control.value['password'];<br/>    const confirmPassword = control.value['confirmPassword'];<br/>    return password &amp;&amp; confirmPassword &amp;&amp; password === confirmPassword<br/>        ? null<br/>        : { passwordsNotEqual: true };<br/>};</span></pre><p id="bdcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">control.value</code>访问要输入的值。然后，代码的其余部分保持与上一个示例相同。</p><p id="ad81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们添加了一个指令，以便在表单中使用验证器:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d29f" class="mq lc iq mh b gy mr ms l mt mu">@Directive({<br/>  selector: "[appPassword]",<br/>  providers: [<br/>    {<br/>      provide: NG_VALIDATORS,<br/>      useExisting: PasswordValidatorDirective,<br/>      multi: true<br/>    }<br/>  ]<br/>})<br/>export class PasswordValidatorDirective implements Validator {<br/>  validate(control: AbstractControl): ValidationErrors {<br/>    return passwordValidator(control);<br/>  }<br/>}</span></pre><p id="72de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它只是运行验证器函数。我们将该指令添加到了<code class="fe me mf mg mh b">AppModule</code>中，这样我们就可以在模板中使用它了。</p><p id="7e7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在模板中，我们将<code class="fe me mf mg mh b">appPassword</code>添加到表单中，并将<code class="fe me mf mg mh b">ngModel</code>指令和<code class="fe me mf mg mh b">name</code>属性添加到输入中，以实现数据绑定和验证。</p><p id="8f6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们还补充道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2ae8" class="mq lc iq mh b gy mr ms l mt mu">#userForm="ngForm"</span></pre><p id="c47b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为表单创建一个模板变量，以便我们可以检查输入下方的表单验证状态，并在输入值不匹配时显示消息。</p><p id="fc8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过书写来检查表格中的错误:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9616" class="mq lc iq mh b gy mr ms l mt mu">userForm.errors?.passwordsNotEqual &amp;&amp; (userForm.touched || userForm.dirty)</span></pre><p id="19ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只有当我们输入了由<code class="fe me mf mg mh b">userForm.touched</code>和<code class="fe me mf mg mh b">userForm.dirty</code>条件表示的内容时，我们才会检查。</p><h1 id="c2da" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="8a37" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用跨域表单验证器将跨域表单验证添加到表单中。</p><p id="2e19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于反应式表单，我们不需要指令。然而，对于模板驱动的表单，我们需要一个运行验证器的指令，这样我们就可以将验证器指令添加到模板中并运行验证器。</p><h2 id="421d" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="da5f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"> <strong class="kf ir"> AI in Plain English </strong> </a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>——谢谢，继续学习！</p><p id="3eb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，使用您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>