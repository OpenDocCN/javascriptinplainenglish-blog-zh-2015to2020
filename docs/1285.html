<html>
<head>
<title>Turning E2E Tests Into Web Scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">把E2E测试变成网络抓取</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/turning-e2e-tests-into-web-scraping-bd6a335ac2fb?source=collection_archive---------6-----------------------#2020-02-24">https://javascript.plainenglish.io/turning-e2e-tests-into-web-scraping-bd6a335ac2fb?source=collection_archive---------6-----------------------#2020-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7d6e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Cypress在REST API不存在的地方检索数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/11658367bf5b31654b1020bafe1b16c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2PaQ9kKBbJXcpiJL"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.webtips.dev/turning-e2e-tests-into-web-scraping"><div class="gh gi kw"><img src="../Images/c19cb3069af1beba3c93258d9fcfe139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*-PVzecNs3s4ZbJsdsgIsGA.png"/></div></a></figure><p id="8056" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">每个人都有梦想。对我一个密友的祖父母来说，那就是中彩票。他们着迷并决心要赢，不管要花多长时间。这就是为什么他们试图破解这个秘密，日以继夜地工作来制定这些年来完美的中奖号码。他们最终成功做到了——至少他们认为是。自1973年以来，他们一直在玩这个游戏——40多年来一直如此，希望赢得大奖，但仍在等待重大突破。</p><p id="ab7b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">那时我就在想——为什么不试着收集有史以来的中奖号码并检查一下几率呢？所以我去了匈牙利国家彩票的官方网站，那里有:空前的中奖号码。</p><p id="6b29" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当然，手动收集它们会非常繁琐，而且据我所知，我也没有可以与之交互的API，所以我转向了网络搜集:</p><blockquote class="lu"><p id="25fb" class="lv lw iq bd lx ly lz ma mb mc md ls dk translated">一种不使用API从网站提取数据的方法。</p></blockquote></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="d535" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">这个概念</h1><p id="03a2" class="pw-post-body-paragraph kx ky iq kz b la nd jr lc ld ne ju lf lg nf li lj lk ng lm ln lo nh lq lr ls ij bi translated">首先，我们将了解如何使用Cypress从HTML页面收集信息。问题中的页面如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/0bc19d96fba5beb57453fb00a626b6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nzc3NYfzfzmyu94ay_HUQw.png"/></div></div></figure><p id="9dee" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">游戏规则是:在1到90之间选5个不同的数字。对我们来说幸运的是，数据至少是预先格式化在表格中的。我重新命名了这些列，这样你就能理解我们所看到的。结果列表一直到1957年，总共有3287行。我们希望从每行的“<em class="lt">数字</em>”列中收集数字。</p><p id="47c4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然后我们想用它创建一个对象，最后保存到一个JSON文件中供以后重用。最后，我们可以检查5个数字中的一个是否被抽了多次。我们还可以检查哪些数字被选中的次数最多。</p><p id="c52c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因此，让我们从获取一切可以获取的东西并从中生成结构化数据开始。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="98af" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">生成内容</h1><p id="6d69" class="pw-post-body-paragraph kx ky iq kz b la nd jr lc ld ne ju lf lg nf li lj lk ng lm ln lo nh lq lr ls ij bi translated">首先，您想通过运行<code class="fe nj nk nl nm b"><a class="ae kv" href="https://www.npmjs.com/package/cypress" rel="noopener ugc nofollow" target="_blank">npm i cypress --save-dev</a></code>来设置Cypress。我还将启动脚本添加到我的<code class="fe nj nk nl nm b">package.json</code>文件中，这样我们就可以运行它，而不必键入完整的<code class="fe nj nk nl nm b">node_modules</code>路径:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="5099" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你想了解更多关于Cypress本身的知识，我有一个更深入的教程，你可以通过上面的链接找到它。</p><p id="3ba4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">完成这些之后，让我们创建一个新的测试文件，我们将在其中收集必要的信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="062a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">首先，我们要访问我们想要收集数据的页面。</p><p id="cdbc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我已经创建了一个<code class="fe nj nk nl nm b">results</code>数组，它将保存一个对象中的每一行以及我们需要的信息。然后我们遍历表格的每一行。我们想跳过第一行，因为它只包含<code class="fe nj nk nl nm b">th</code>元素，这就是为什么我们需要在最开始使用if语句。之后，我创建了两个变量，因为我们要多次访问这个元素:</p><ul class=""><li id="bb21" class="np nq iq kz b la lb ld le lg nr lk ns lo nt ls nu nv nw nx bi translated"><code class="fe nj nk nl nm b">$tr</code>是一个包装的JQuery对象，所以我们想用<code class="fe nj nk nl nm b">get(0)</code>获得底层的DOM属性。</li><li id="369a" class="np nq iq kz b la ny ld nz lg oa lk ob lo oc ls nu nv nw nx bi translated"><code class="fe nj nk nl nm b">rowElement.cells</code>是保存每列数据的<code class="fe nj nk nl nm b">HTMLCollection</code>。</li></ul><p id="2276" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">注意，因为没有我们可以选择的类，我们需要计算每一行的子元素。在此之后，我们应该得到以下结构化数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d6a83a132d2ef03d7aae4956c1f63646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*8ERs4v2_dD9COcYcZEBZSA.png"/></div></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="5248" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">保存到JSON</h1><p id="cae4" class="pw-post-body-paragraph kx ky iq kz b la nd jr lc ld ne ju lf lg nf li lj lk ng lm ln lo nh lq lr ls ij bi translated">我们可以通过将<code class="fe nj nk nl nm b">then</code>子句中的<code class="fe nj nk nl nm b">console.log</code>改为下面一行来轻松保存这些数据，以供以后重用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="c033" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这将在项目根目录下<code class="fe nj nk nl nm b">cypress.json</code>旁边创建一个文件。现在我们已经有了一切可用的东西，我们可以继续计算我们的赔率和破解秘密，以制定一套完美的中奖号码。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="9608" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">计算几率</h1><p id="73cc" class="pw-post-body-paragraph kx ky iq kz b la nd jr lc ld ne ju lf lg nf li lj lk ng lm ln lo nh lq lr ls ij bi translated">首先，让我们看看抽出的数字是否有任何重复。让我们首先创建一个只包含中奖号码的新数组，然后我们可以创建一个计算唯一值的函数。</p><p id="9f77" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为此，我在Chrome中打开了生成的JSON文件，并使用控制台来获得结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/ecb92e0be718ad943d1212836e51e5dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kq3W20i0nAzZfb5KW08rqA.png"/></div></div></figure><p id="322f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我正在使用<a class="ae kv" href="https://chrome.google.com/webstore/detail/json-viewer/gbmdgpbipfallnflgajpaliibnhdgobh?hl=hu" rel="noopener ugc nofollow" target="_blank"> JSON Viewer </a> Chrome扩展，所以我可以通过<code class="fe nj nk nl nm b">window.json</code>访问JSON对象。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/e02a8172f7c27e9788831e6f34361d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*olXb3fi0Kfd61DVAF7fnNA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The set of winning numbers represented in arrays</figcaption></figure><p id="f01d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">首先，我们遍历结果，并为每组中奖号码创建一个新数组。然后我们可以创建一个函数来计算出现次数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="5aa5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">对于每一组选择，我们检查它是否已经存在于<code class="fe nj nk nl nm b">counts</code>对象中。如果是，我们把它的值加1，否则我们把它加到对象上。在控制台中运行它，我们会得到下面的数字列表以及它们被抽取的次数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/272342d3d2dcd4009732e01ddbee22fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jwGeRmNNFq91mxjVTIpPWw.gif"/></div></div></figure><p id="96a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如你所见，在63年的时间里，甚至没有一组中奖号码被抽取过一次以上。那么被摘得最多的数字是什么呢？</p><p id="b8c2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">同样，我们可以创建一个包含所有中奖号码的新数组，然后计算它们的出现次数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/fee6cc8c3ad90f612b34b876a1fbfa27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*JnFIkLVa1WDJ54XiYmosPQ.png"/></div></figure><p id="bc9e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们可以像以前一样遵循相同的模式，只是这次我们可以使用spread操作符将数字数组分解为单个值。然后用同样的计数函数结合简单的<code class="fe nj nk nl nm b">sort</code>算法，我们可以得出:被挑选最多的数字是:<em class="lt"> 3，1，29，75，15。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/9971ff303add992e58627a4679cee849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcKqeWv-bN3xns5ai1oEqQ.png"/></div></div></figure><p id="1b6f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但是如果我们向下滚动到最少被选中的数字，88，即使这个数字已经被选中了145次。</p><p id="9b4e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">那么中彩票的几率有多大呢？我们知道，我们可以在90个不同的数字中进行选择，我们必须这样做5次。这给出了下面的公式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/3f6afc1bc169853a0f3e643df64e40c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvOW12fRcADvPlWCHqZavA.png"/></div></div></figure><p id="ed0b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">其中<code class="fe nj nk nl nm b">n</code>是我们可以选择的选项数量，<code class="fe nj nk nl nm b">k</code>是我们可以选择的数量。这给我们留下了:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/a70694b40b26de8ea72e9eac9b5d5af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-_ZQwrGBpsIuRlm9X2bzw.png"/></div></div></figure><p id="9f38" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在控制台中创建阶乘函数后，我们可以计算出，用我们选择的号码，我们大约有43，949，268分之一的机会赢得这种类型的彩票，这可能与我们的中奖机会一样随机。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="dbfe" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">结论</h1><p id="0170" class="pw-post-body-paragraph kx ky iq kz b la nd jr lc ld ne ju lf lg nf li lj lk ng lm ln lo nh lq lr ls ij bi translated">那么彩票中奖的秘诀是什么呢？—一个也没有。如果有的话，人们会成为百万富翁，彩票公司明天就会破产。你最好把这些钱投资到你自己，你的未来，你的家庭。</p><p id="8b7f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">正如我们所看到的，Cypress使得交互和从网页上收集信息变得非常容易。网络抓取的其他一些使用案例是什么？</p><h2 id="0947" class="ol mm iq bd mn om on dn mr oo op dp mv lg oq or mx lk os ot mz lo ou ov nb ow bi translated"><strong class="ak">例如，您可以:</strong></h2><ul class=""><li id="7420" class="np nq iq kz b la nd ld ne lg ox lk oy lo oz ls nu nv nw nx bi translated">从产品中收集信息进行比较</li><li id="0466" class="np nq iq kz b la ny ld nz lg oa lk ob lo oc ls nu nv nw nx bi translated">为机器学习收集训练数据</li><li id="910c" class="np nq iq kz b la ny ld nz lg oa lk ob lo oc ls nu nv nw nx bi translated">从社交媒体和论坛中提取数据进行情感分析</li></ul><p id="413f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">不胜枚举，前途无量。</p><p id="9ce5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你有网络抓取的经验吗？在没有API的情况下收集数据时，您有什么有价值的提示和技巧吗？请在评论中告诉我们。谢谢你的时间，祝你愉快。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://medium.com/@ferencalmasi/membership"><div class="gh gi pa"><img src="../Images/e66c4cd6d9849ac0bd245f3fc39b65c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ9xuLqLkbqUG65sgVB3gg.png"/></div></a></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.webtips.dev/how-to-e2e-test-your-application-with-cypress"><div class="gh gi pb"><img src="../Images/fa0f5f0dc8e7a5b302606b71156834ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*d2iJnwYg-E6v9bCgON1bvg.png"/></div></a></figure><h2 id="7a36" class="ol mm iq bd mn om on dn mr oo op dp mv lg oq or mx lk os ot mz lo ou ov nb ow bi translated">进一步阅读</h2><div class="pc pd gp gr pe pf"><a rel="noopener  ugc nofollow" target="_blank" href="/automate-web-scraping-with-an-easy-to-use-browser-extension-cb6073f1e61d"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd ir gy z fp pk fr fs pl fu fw ip bi translated">使用易于使用的浏览器扩展自动抓取网页</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">如何使用Listly，一个初学者友好的无代码工具，轻松实现web抓取过程的自动化。</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="po l"><div class="pp l pq pr ps po pt kp pf"/></div></div></a></div><p id="3b93" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="lt">更多内容请看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="lt">plain English . io</em></strong></a><em class="lt">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> <em class="lt">免费周报</em> </strong> </a> <em class="lt">。关注我们关于</em><a class="ae kv" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="lt">Twitter</em></strong></a><a class="ae kv" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="lt">LinkedIn</em></strong></a><em class="lt"/><a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="lt">YouTube</em></strong></a><em class="lt"/><a class="ae kv" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir"><em class="lt">不和</em> </strong> </a> <em class="lt">。</em></p></div></div>    
</body>
</html>