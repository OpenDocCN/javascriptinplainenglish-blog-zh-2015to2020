# RxJS 自定义可观察对象介绍

> 原文：<https://javascript.plainenglish.io/creating-custom-observable-with-rxjs-379692f08f76?source=collection_archive---------0----------------------->

## 如何用 RxJS 创建自定义的可观察对象

![](img/e78f5a0ade026f6cccc3ff62c41cb580.png)

*在我之前的文章中，我们讲过* ***RxJS*** *的基础知识。该库提供了许多创建可观察对象的方法。在本文中，我们将讨论用* ***方式创建自定义可观察对象*** *和* ***订阅自定义可观察对象*** *创建。*

*RxJS 的基础知识可以参考下面这篇文章。*

[](https://levelup.gitconnected.com/introduction-to-rxjs-3f17e1009527) [## RxJS 和反应式编程简介

### 反应式编程是 JavaScript 世界的新热点。在本文中，我们将讨论基础知识…

levelup.gitconnected.com](https://levelup.gitconnected.com/introduction-to-rxjs-3f17e1009527) 

**可观察对象**是维护一个被称为观察者的**依赖列表的对象，观察者被告知可观察对象的任何状态变化。对于每个可观测的状态变化，在观测器上调用一个方法。观察者认同可观察的事物并对事件做出反应。**

简单来说，你可以说:

1.  可观的是那些抛出一些值的人
2.  观察者是捕捉那些抛出的值的人

可观察对象可以发出以下事件:

1.  "**下一个**":事件用于从可观察值中发出下一个值。
2.  "**错误**":跟随一个事件用于通知观察者一些错误。
3.  “**完成**”:表示观察体已经完成发射数据。

让我们创建一个每秒钟发出一个随机值的可观察对象。这将是包含单个事件“下一个”的简单可观测值。然后，我们将扩展这个例子，把其他事件也包括在内。

在下面的例子中，我们使用“ **Observable.create** ”创建一个简单的观察者。该函数的参数是另一个接受“观察者”对象的函数。我们现在可以用一些随机数据在这个“观察者”对象上调用“下一个”函数。这就是我们创建一个简单的自定义可观察对象所需的全部内容。

现在，既然我们有了一个可用的可观察样本，我们现在可以创建一个简单的订阅者来订阅该可观察样本。由于上述可观察对象不会发出任何“错误”或“完全”事件，我们可以为其创建一个简单的观察器。下面是订阅可观察对象的代码

在上面的代码中，我们订阅了创建的可观察对象。我们可以通过使用`subscribe`函数来订阅可观察值。

subscribe 函数将一个函数作为其输入参数，以响应观察器发出的不同事件。在上面的场景中，我们向 subscribe 函数传递一个函数，因为 Observable 只是发出一个事件“next”。默认情况下，作为参数传递的函数将处理“下一个”事件。从 Observable 发出的数据由“value”参数中指定的函数捕获。然后，我们在控制台中显示该值。

下面是 jsFiddle 中的样例工作代码，它创建了一个简单的观察器，并通过简单的观察器订阅可观察对象。

被创造的可观察对象正在发射“下一个”事件以及一些包含随机数的数据。当我们使用“subscribe”函数订阅可观察对象时，我们传递的是一个单独的函数，默认情况下该函数将处理“next”事件。

Source: [https://jsfiddle.net/Mayankgupta688/5chg8ftn/](https://jsfiddle.net/Mayankgupta688/5chg8ftn/)

现在让我们给可观察对象和观察者增加一些复杂性。我们将期望每秒钟在控制台中连续生成并显示一个随机值。同样，我们将在可观测的“误差”和“完全”中引入其他事件。我们将扩展该功能，在随机值被 13 整除的情况下发出“错误”事件，如果值为 99，则发出“完整”事件。

此外，我们将创建一个订阅者来捕捉所有这些事件。

我们将在下面添加相同的代码，我们可以看到每秒钟后我们都在异步地发出值。在下面的代码中，我们可以看到我们在观察者对象上调用了“错误”、“完成”和“下一个”事件，这将引发与可观察对象不同的事件。

“完成”事件标志着观察的完成，“错误”事件标志着错误状态。如果在完成之前引发了“错误”事件，可观察对象将停止发出任何进一步的事件，并在没有发出“完成”事件的情况下终止。因此，如果生成的随机值为 13，下面的代码将终止并停止发出任何进一步的事件。

在上面的代码中，我们根据生成的随机数的值有条件地引发事件。由于观察器发出多种类型的事件，我们需要创建一个观察器，使它能够捕获观察器发出的所有类型的事件。

下面的代码是 Observer 的简单实现，它将订阅 Observable 并捕获所有这些事件。

在上面的代码中，我们向 subscribe 函数传递了 3 个函数，每一个都映射到从 Observable 引发的“next”、“error”和“complete”事件。订户可以捕获每个事件，并可以根据事件发出期间接收到的数据采取行动。请注意，如果观察器发生“完全”事件，我们不会发出任何数据。

现在您可以看到创建一个简单的自定义可观察对象是多么容易。在网页中，您可以观察到多个事件，如:

1.  DOM 事件可以使用 Observable 来处理
2.  来自 Ajax 数据的响应可以从可观察的流中提供
3.  以可观察数据流的形式提供数据列表。
4.  对输入数据流应用运算符并对其进行转换

我们将在另一篇文章中讨论创建可观察对象和应用操作符的其他方法。

我希望你喜欢这篇文章！

[](https://gitconnected.com/learn/javascript) [## 学习 JavaScript -最佳 JavaScript 教程(2019) | gitconnected

### 50 大 JavaScript 教程-免费学习 JavaScript。课程由开发人员提交并投票，从而实现…

gitconnected.com](https://gitconnected.com/learn/javascript) 

*更多内容尽在*[***plain English . io***](http://plainenglish.io/)