<html>
<head>
<title>Creating a custom Domain Specific Language for text input validation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为文本输入验证创建自定义的特定于域的语言</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/agl-your-dsl-in-the-web-c9f54595691b?source=collection_archive---------6-----------------------#2020-04-01">https://javascript.plainenglish.io/agl-your-dsl-in-the-web-c9f54595691b?source=collection_archive---------6-----------------------#2020-04-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e949" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当使用正则表达式是不够的</h2></div><p id="8a1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文本输入是许多web应用程序的主要部分。在许多情况下，需要对文本进行验证。也就是说，输入对于任何文本都是无效的，而是对于符合特定规则的文本才是有效的。</p><p id="4740" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在简单的情况下，可以使用正则表达式来验证文本，通过使用文本编辑器，如<a class="ae lb" href="https://ace.c9.io/" rel="noopener ugc nofollow" target="_blank"> Ace </a>或<a class="ae lb" href="https://microsoft.github.io/monaco-editor/" rel="noopener ugc nofollow" target="_blank"> Monaco </a>，可以通过错误标记和给文本着色向用户提供关于文本有效性的反馈。</p><p id="1106" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Ace和Monaco(以及其他web文本编辑器)都提供了添加“新语言”的机制。但是在这两种情况下，机制都很重要，并且主要基于正则表达式和特定于语言的代码。</p><p id="4246" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这很好，在许多情况下提供了所有需要的东西。然而，有时我们只是需要多一点。许多语言不能通过正则表达式进行解析。他们需要更高级的<a class="ae lb" href="https://en.wikipedia.org/wiki/Context-free_grammar" rel="noopener ugc nofollow" target="_blank">上下文无关语言</a>解析器。</p><h1 id="2874" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">问题是</h1><p id="4b83" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">为上下文无关语言创建解析器是一项复杂的编程任务，通常使用解析器生成器。有针对JavaScript 的解析器生成器。例如，<a class="ae lb" href="https://www.antlr.org/" rel="noopener ugc nofollow" target="_blank"> ANTLR </a>、<a class="ae lb" href="https://nearley.js.org/" rel="noopener ugc nofollow" target="_blank"> Nearley </a>或<a class="ae lb" href="https://pegjs.org/" rel="noopener ugc nofollow" target="_blank"> PEG.js </a>等等。</p><p id="8b16" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的经验是，即使有了解析器生成器，从你的语言的语法到支持它的编辑器的过程仍然是很重要的。通常我们想要一个编辑器，为语言提供基本的DSL支持，包括语法着色、自动完成建议、错误反馈和格式化。</p><p id="1426" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Eclipse编程的世界中，<a class="ae lb" href="https://www.eclipse.org/Xtext/" rel="noopener ugc nofollow" target="_blank"> Xtext </a>提供了这种能力。但是，尽管有一些初步的工作允许Xtext框架以基于web浏览器的编辑器为目标，但它从未真正起飞。我相信部分原因是因为生成过程太复杂，耗时太长，特别是因为运行时需要后端服务器。</p><h1 id="db4f" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">要求</h1><p id="3da7" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我们想要的是:</p><ol class=""><li id="2b0b" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">纯粹在浏览器中运行(仅前端)</li><li id="4ace" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">运行起来非常简单快捷(可能不需要生成代码)</li><li id="ae22" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">接受任何上下文无关的语法</li><li id="6938" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">对于几行(可能是一页)文本来说足够快了(假设语法是明确的)。</li></ol><h1 id="b37c" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">解决方案</h1><p id="9d48" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">好吧，我没有找到任何满足这些开箱即用的要求。所以，我自己写(实现)了一些东西。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/fa4c989f26450c57f0bd19018fc8f61e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*6z_3Hq5RZVRBcwNkWERdiw.png"/></div></figure><p id="8073" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我写了一个类似GLR的按需扫描的运行时解析器(也就是说，没有解析器生成器，你只需要在运行时给它一个语法)。这不是小事，我从学习不同的解析器算法中获得了很多乐趣(也有一些压力)。我尝试了几次都失败了。但最终产生了一些有用的东西。更好的是，它是用Kotlin通用代码编写的，所以它可以在任何Kotlin目标平台、JVM、Javascript等上运行。</p><p id="5edf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在将解析器集成到Ace和Monaco基于web的编辑器中时，我有了更多的压力(和一点乐趣)。这比我想象的要困难得多，主要是因为编辑器似乎不是按照这种方式设计的。然而，这是可能的，尽管我怀疑某个对这些编辑器的代码库更有知识的人可以改进事情。(随意投稿！)</p><h1 id="cc24" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">最终结果</h1><p id="d046" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">你可以看到最终结果的<a class="ae lb" href="https://info.itemis.com/demo/agl/editor" rel="noopener ugc nofollow" target="_blank">演示。它允许你编辑一个语法，定义风格规则，然后用那个语法写句子。全部在浏览器中，在运行时。</a></p><p id="9aca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果运气好的话，将来会添加更多的特性(比如格式规则)。</p><p id="8bb8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您需要任何使用帮助，如果您想做出改进，或者如果您对该主题有任何想法，请随时联系我。</p><p id="3cff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有一个<a class="ae lb" href="https://github.com/dhakehurst/net.akehurst.language" rel="noopener ugc nofollow" target="_blank"> github仓库</a>，里面有所有的代码，Apache 2.0许可证。</p><p id="888b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【JavaScript用简单英语写的一句话:我们总是乐于帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，请用你的Medium用户名发邮件到<a class="ae lb" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>给我们，我们会把你添加为作者。</p></div></div>    
</body>
</html>