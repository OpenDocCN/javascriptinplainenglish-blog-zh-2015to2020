<html>
<head>
<title>JavaScript Unit Test Best Practices — Names and Expects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript单元测试最佳实践—名称和期望</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-unit-test-best-practices-names-and-expects-e02540dc670d?source=collection_archive---------7-----------------------#2020-08-22">https://javascript.plainenglish.io/javascript-unit-test-best-practices-names-and-expects-e02540dc670d?source=collection_archive---------7-----------------------#2020-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e14773d2f5c9403ccf103112faf93766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jSNyqr0_MRmX83Wh"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jankolar?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Twitter: @jankolario</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="151e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序如何工作非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写JavaScript单元测试时应该遵循的一些最佳实践。</p><h1 id="26f1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">正确命名我们的测试</h1><p id="1400" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在测试中使用简洁、明确和描述性的名称。</p><p id="7037" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们知道我们在测试什么。</p><p id="19cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而不是写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0c16" class="mn lc iq mj b gy mo mp l mq mr">describe('employee app', () =&gt; {<br/>  it('returns an array', () =&gt; {<br/>  });</span><span id="aacf" class="mn lc iq mj b gy ms mp l mq mr">  // ...<br/>});</span></pre><p id="6872" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6a9f" class="mn lc iq mj b gy mo mp l mq mr">describe('employee app', () =&gt; {<br/>  it('returns a list of employees when initialized', () =&gt; {<br/>  });</span><span id="5791" class="mn lc iq mj b gy ms mp l mq mr">  it('should calculate the pay of an employee when initialized', () =&gt; {<br/>  });</span><span id="56f9" class="mn lc iq mj b gy ms mp l mq mr">// ...<br/>});</span></pre><p id="fb25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有工作单元、场景或内容，以及预期的行为。</p><p id="7667" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用这种格式:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4f56" class="mn lc iq mj b gy mo mp l mq mr">describe('[unit of work]', () =&gt; {<br/>  it('should [expected behaviour] when [scenario/context]', () =&gt; {<br/>  });<br/>});</span></pre><p id="cac7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1505" class="mn lc iq mj b gy mo mp l mq mr">describe('[unit of work]', () =&gt; {<br/>  describe('when [scenario/context]', () =&gt; {<br/>    it('should [expected behaviour]', () =&gt; {<br/>    });<br/>  });<br/>});</span></pre><p id="47cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3de5" class="mn lc iq mj b gy mo mp l mq mr">describe('employee app', () =&gt; {<br/>  describe('when initialized', () =&gt; {<br/>    it('returns a list of employees', () =&gt; {<br/>    });</span><span id="1a00" class="mn lc iq mj b gy ms mp l mq mr">    it('should calculate the pay of an employee', () =&gt; {<br/>    });<br/>  });</span><span id="e88a" class="mn lc iq mj b gy ms mp l mq mr">  // ...<br/>});</span></pre><h1 id="8f84" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不要注释掉测试</h1><p id="3479" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该注释掉测试。</p><p id="775e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它们太慢或者产生错误的结果，那么我们应该修正测试，使其更快更可靠。</p><h1 id="92b8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在我们的测试中避免逻辑</h1><p id="a226" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在测试中避免逻辑。</p><p id="98a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着我们应该避免条件和循环。</p><p id="4725" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">条件句可以让它选择任何路径。</p><p id="449b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">循环使我们的测试共享状态。</p><p id="714a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们不应该写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1ca2" class="mn lc iq mj b gy mo mp l mq mr">it('should get employee by id', () =&gt; {<br/>  const employees = [<br/>    { id: 1, name: 'james' },<br/>    { id: 2, name: 'may' },<br/>    { id: 3, name: 'mary' },<br/>    { id: 4, name: 'john' },<br/>    { id: 5, name: 'james' },<br/>  ]</span><span id="472e" class="mn lc iq mj b gy ms mp l mq mr">  for (const em of employees) {<br/>    expect(getEmployee(em.id).name).toBe(em.name);<br/>  }<br/>});</span></pre><p id="8265" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，我们将它们分成各自的<code class="fe mt mu mv mj b">expect</code>陈述:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2cb6" class="mn lc iq mj b gy mo mp l mq mr">it('should get employee by id', () =&gt; {<br/>  expect(getEmployee(1)).toBe('james');<br/>  expect(getEmployee(2)).toBe('may');<br/>  expect(getEmployee(3)).toBe('mary');<br/>  expect(getEmployee(4)).toBe('john');<br/>  expect(getEmployee(5)).toBe('james');<br/>});</span></pre><p id="e3d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有所有病例的清晰输出。</p><p id="5408" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以写出所有的案例作为自己的测试:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="799c" class="mn lc iq mj b gy mo mp l mq mr">it('should sanitize a string containing non-ASCII chars', () =&gt; {<br/>  expect(sanitizeString(`Avi${String.fromCharCode(243)}n`)).toBe('Avion');<br/>});</span><span id="1ce0" class="mn lc iq mj b gy ms mp l mq mr">it('should sanitize a string containing spaces', () =&gt; {<br/>  expect(sanitizeString('foo bar')).toBe('foo-bar');<br/>});</span><span id="48ce" class="mn lc iq mj b gy ms mp l mq mr">it('should sanitize a string containing exclamation signs', () =&gt; {<br/>  expect(sanitizeString('funny chars!!')).toBe('funny-chars-');<br/>});</span><span id="62f9" class="mn lc iq mj b gy ms mp l mq mr">it('should sanitize a filename containing spaces', () =&gt; {<br/>  expect(sanitizeString('file name.zip')).toBe('file-name.zip');<br/>});</span><span id="efdf" class="mn lc iq mj b gy ms mp l mq mr">it('should sanitize a filename containing more than one dot', () =&gt; {<br/>  expect(sanitizeString('my.name.zip')).toBe('my-name.zip');<br/>});</span></pre><h1 id="349d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不要写不必要的期望</h1><p id="bd68" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该写不必要的期望。</p><p id="2a70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果有没用过的东西，那我们就不应该添加。</p><p id="1f96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="07f1" class="mn lc iq mj b gy mo mp l mq mr">it('compute the number by multiplying and subtracting by 2', () =&gt; {<br/>  const multiplySpy = spyOn(Calculator, 'multiple').and.callThrough();<br/>  const subtractSpy = spyOn(Calculator, 'subtract').and.callThrough();</span><span id="fe39" class="mn lc iq mj b gy ms mp l mq mr">  const result = Calculator.compute(22.5);</span><span id="0d8d" class="mn lc iq mj b gy ms mp l mq mr">  expect(multiplySpy).toHaveBeenCalledWith(22.5, 2);<br/>  expect(subtractSpy).toHaveBeenCalledWith(45, 2);<br/>  expect(result).toBe(43);<br/>});</span></pre><p id="aace" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不需要间谍，因为我们正在测试计算的结果。</p><p id="8999" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7111" class="mn lc iq mj b gy mo mp l mq mr">it('compute the number by multiplying and subtracting by 2', () =&gt; {<br/>  const result = Calculator.compute(22.5);<br/>  expect(result).toBe(43);<br/>})</span></pre><p id="f1d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是测试结果，因为这是我们关心的。</p><p id="da3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不想检查实现细节。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/2cc6c498d83569fe3880ab7d3ef350b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QYalJt9IKA2nbclo"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@wwwynand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Wynand van Poortvliet</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c86d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="0e7b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该测试结果而不是实现细节。</p><p id="c295" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们应该正确地命名测试。</p><h2 id="b385" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">简明英语JavaScript</strong></h2><p id="c852" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到一切的链接plainenglish.io </strong> </a>！</p></div></div>    
</body>
</html>