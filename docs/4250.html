<html>
<head>
<title>Introduction to Firebase Storage #2: Retrieve &amp; Delete Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase存储简介#2:检索和删除文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-firebase-storage-2-retrieve-delete-files-3875f11e6a89?source=collection_archive---------5-----------------------#2020-11-28">https://javascript.plainenglish.io/introduction-to-firebase-storage-2-retrieve-delete-files-3875f11e6a89?source=collection_archive---------5-----------------------#2020-11-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4584" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，在这篇文章中，我们将从上一篇文章<a class="ae kl" href="https://victoria2666.medium.com/introduction-to-firebase-storage-1-upload-files-25e63a74a8c2?sk=43d07e7f5f4c7e474c4afb0bd2502372" rel="noopener">如何将文件上传到Firebase云存储</a>的地方继续。我们现在将学习如何从Firebase云存储中检索和删除文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/93b9ed4327557526de107f585ddf09dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dd_BDT0zN0pGILTlqCvjw.png"/></div></div></figure><h1 id="7ba8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">从Firebase中检索文件</h1><p id="668e" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">参考上一篇文章，了解如何设置Firebase云存储并创建我们将在本文中继续构建的项目。</p><h1 id="3071" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤1:创建allImages状态</h1><p id="3f97" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">初始化一个名为<code class="fe mb mc md me b">allImages</code>的数组。该数组将保存从Firebase中检索到的所有图像URL。</p><pre class="kn ko kp kq gt mf me mg mh aw mi bi"><span id="ee60" class="mj kz iq me b gy mk ml l mm mn">const [allImages, setImages] = useState([]);</span></pre><h1 id="224e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第二步:getFromFirebase</h1><p id="2b9e" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们创建一个名为<code class="fe mb mc md me b">getFromFirebase</code>的函数，它将处理从Firebase中检索所有文件。</p><p id="605e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此功能中，我们希望:</p><ul class=""><li id="aaff" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">1:参考我们的储物桶</li><li id="efd9" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">2:使用<code class="fe mb mc md me b">listAll()</code>获取里面所有的引用对象</li></ul><p id="00f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mb mc md me b">listAll()</code>返回对图像的引用，而不是图像本身。它有两个属性:<code class="fe mb mc md me b">items</code>和<code class="fe mb mc md me b">prefixes</code>。项目是图像引用，而前缀是文件夹，以防存储中有嵌套文件夹。</p><p id="0971" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个例子，当我在存储器中有8个图像时，<code class="fe mb mc md me b">listAll()</code>返回什么。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/379f03692c9a02639f5bf35f2bd840ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/0*55NuZ-XazR77Zvyp"/></div></figure><ul class=""><li id="452f" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">3:然后用<code class="fe mb mc md me b">forEach()</code>遍历每个<code class="fe mb mc md me b">items</code>引用，用<code class="fe mb mc md me b">getDownloadURL()</code>获取图像URL</li><li id="bf18" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">4:最后，用<code class="fe mb mc md me b">setImages()</code>将这个URL添加到<code class="fe mb mc md me b">allImages</code>数组中</li></ul><pre class="kn ko kp kq gt mf me mg mh aw mi bi"><span id="d3ca" class="mj kz iq me b gy mk ml l mm mn">const getFromFirebase = () =&gt; {<br/>    //1.<br/>    let storageRef = storage.ref();<br/>    //2.<br/>    storageRef.listAll().then(function (res) {<br/>        //3.<br/>        res.items.forEach((imageRef) =&gt; {<br/>          imageRef.getDownloadURL().then((url) =&gt; {<br/>              //4.<br/>              setImages((allImages) =&gt; [...allImages, url]);<br/>          });<br/>        });<br/>      })<br/>      .catch(function (error) {<br/>        console.log(error);<br/>      });<br/>  };</span></pre><h1 id="d5a2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第三步:显示图像</h1><p id="a630" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">然后，我们可以创建一个组件，在这个组件中，我们可以显示来自<code class="fe mb mc md me b">allImages</code>数组中的URL的图像。</p><pre class="kn ko kp kq gt mf me mg mh aw mi bi"><span id="48ea" class="mj kz iq me b gy mk ml l mm mn">&lt;div id="photos"&gt;<br/>     {allImages.map((image) =&gt; {<br/>        return (<br/>           &lt;div key={image} className="image"&gt;<br/>              &lt;img src={image} alt="" /&gt;<br/>              &lt;button onClick={() =&gt; deleteFromFirebase(image)}&gt;<br/>               Delete<br/>              &lt;/button&gt;<br/>           &lt;/div&gt;<br/>         );<br/>     })}<br/>&lt;/div&gt;</span></pre><p id="e133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在每张图片上，我们可以有一个删除按钮，允许用户删除他们点击的图片。让我们看看如何实现按钮的<code class="fe mb mc md me b">deletedFromFirebase()</code>。</p><h1 id="c87b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤4:从Firebase中删除</h1><p id="e274" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们的<code class="fe mb mc md me b">deleteFromFirebase</code>函数接受我们的图像URL作为参数，并从Firebase中删除该URL。</p><p id="060e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们实现该函数的方法:</p><ol class=""><li id="85a9" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk nd mu mv mw bi translated">使用<code class="fe mb mc md me b">refFromURL()</code>，我们可以从Firebase存储中获取我们想要删除的图像的图像引用。</li><li id="14d1" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk nd mu mv mw bi translated">然后使用<code class="fe mb mc md me b">.delete()</code>从Firebase中删除图像。</li><li id="689d" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk nd mu mv mw bi translated">最后，我们从我们的<code class="fe mb mc md me b">allImages</code>数组中删除这个URL。</li></ol><pre class="kn ko kp kq gt mf me mg mh aw mi bi"><span id="86f7" class="mj kz iq me b gy mk ml l mm mn">const deleteFromFirebase = (url) =&gt; {<br/>    //1.<br/>    let pictureRef = storage.refFromURL(url);<br/>   //2.<br/>    pictureRef.delete()<br/>      .then(() =&gt; {<br/>        //3.<br/>        setImages(allImages.filter((image) =&gt; image !== url));<br/>        alert("Picture is deleted successfully!");<br/>      })<br/>      .catch((err) =&gt; {<br/>        console.log(err);<br/>      });<br/>  };</span></pre><h1 id="c768" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">而结果呢！</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ne"><img src="../Images/c46bde5b1f89164573f303f059368f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVWUaSuSSEc3tRfbG3qh_Q.png"/></div></div></figure><p id="61b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我们上传、检索、显示和删除图像的方式！</p><p id="03d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查看我为这个教程做的项目，请访问repo <a class="ae kl" href="https://github.com/victoria-lo/photo-album" rel="noopener ugc nofollow" target="_blank">这里</a>。请阅读<a class="ae kl" href="https://firebase.google.com/docs/storage" rel="noopener ugc nofollow" target="_blank"> Firebase文档</a>了解更多信息。</p><p id="09e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读。我希望这是一个有帮助的2部分阅读，以帮助您开始使用Firebase云存储。一如既往，请不要犹豫，在下面的评论中分享你的想法。下次再见，干杯！</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="ac8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://lo-victoria.com】最初发表于<a class="ae kl" href="https://lo-victoria.com/introduction-to-firebase-storage-retrieve-delete-files" rel="noopener ugc nofollow" target="_blank"><em class="nm"/></a><em class="nm">。</em></p></div></div>    
</body>
</html>