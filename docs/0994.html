<html>
<head>
<title>Using Axios fetch from NASA API &amp; Using JS to Dynamically Display Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Axios从NASA API获取数据&amp;使用JS动态显示数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-axios-fetch-from-nasa-api-using-js-to-dynamically-display-data-ef896aa45da4?source=collection_archive---------2-----------------------#2020-01-11">https://javascript.plainenglish.io/using-axios-fetch-from-nasa-api-using-js-to-dynamically-display-data-ef896aa45da4?source=collection_archive---------2-----------------------#2020-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cef218d01cc5ade340c604fe424f456b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBOyEiICF6_FdxpbhPtnrA.png"/></div></div></figure><p id="15d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你知道美国宇航局有一个公众可访问的<a class="ae kw" href="https://api.nasa.gov/" rel="noopener ugc nofollow" target="_blank">API的图像和数据宝库吗？</a>访问非常简单——他们有一个有限使用的演示密钥，或者您可以注册一个帐户并获得自己的API密钥。在这篇博客中，我将使用demo键进行示例。</p><p id="1484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是关于如何使用<a class="ae kw" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>从API获取数据的指南——我将使用火星探测器的照片，处理错误，然后操纵DOM来显示结果。</p><p id="4207" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤1 — HTML表单&amp;访问元素</strong></p><p id="e9ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想让用户选择一个日期，然后使用该日期显示好奇号火星车的照片。在每个元素上，包含一个惟一的ID(或者多个元素的类名)。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6a0c" class="lg lh iq lc b gy li lj l lk ll">&lt;div&gt;<br/>  &lt;input id="date" type="date"&gt;<br/>  &lt;button id="button" href=""&gt;Submit&lt;/button&gt;<br/>&lt;/div&gt;</span></pre><p id="a5d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看起来像这样:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/95466d95d7bb4d06367f0c60d7ef103c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*Mldh-kdoYNwBfwjbOOvqhQ.png"/></div></figure><p id="3fce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们设置使用JavaScript来使用<code class="fe ln lo lp lc b">document.getElementById()</code>访问这些元素中的每一个，并将它们存储为一个变量。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2017" class="lg lh iq lc b gy li lj l lk ll">var datePicker = document.getElementById("date");<br/>var button = document.getElementById("button");</span></pre><p id="0c5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为额外的一步，我将添加<code class="fe ln lo lp lc b">datePicker.min = "2012-08-06"</code>,这样就没有选择2012年8月6日之前的日期的选项，那时好奇号首次登陆火星。</p><p id="9d2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤2 —使用Axios执行GET请求</strong></p><p id="c8e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先要做的是使用NPM或yarn安装axios，然后将行<code class="fe ln lo lp lc b">var axios = require('axios');</code>添加到将要编写代码的JS文件或组件的顶部。</p><p id="b676" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我从API文档中得知，通过执行一个请求来达到端点:'<a class="ae kw" href="https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=DATE&amp;api_key=DEMO_KEY" rel="noopener ugc nofollow" target="_blank">https://API . NASA . gov/mars-photos/API/v1/rovers/curiosity/photos？earth _ DATE = DATE&amp;API _ KEY = DEMO _ KEY</a>’，但是更改了日期部分以匹配用户输入。</p><p id="d577" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，让我们为日期创建变量，然后将日期作为模板文字插入URL。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="5edc" class="lg lh iq lc b gy li lj l lk ll">var date = datePicker.value;<br/>var url = `https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=${date}&amp;api_key=DEMO_KEY`;</span></pre><p id="3da6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记住使用反勾号，而不是引号或单引号！</p><p id="fa27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们希望GET请求在用户点击按钮时被触发，所以让我们将所有内容封装在一个监听该事件的函数中。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6684" class="lg lh iq lc b gy li lj l lk ll">button.addEventListener("click", function() {</span><span id="137f" class="lg lh iq lc b gy lq lj l lk ll">});</span></pre><p id="a613" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面所有的代码(和上面的变量)都在这个函数中。使用<code class="fe ln lo lp lc b">console.log</code>查看响应和变量设置是很有帮助的。在继续之前，测试所有东西，确保所有东西都连接正确。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="cf7a" class="lg lh iq lc b gy li lj l lk ll">button.addEventListener("click", function() {<br/>    var date = datePicker.value;<br/>    console.log(date)<br/>    var url = `https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?earth_date=${date}&amp;api_key=DEMO_KEY`;<br/>    console.log(url)<br/>});</span></pre><p id="e49c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用此通用格式来处理axios。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f829" class="lg lh iq lc b gy li lj l lk ll">axios.get(url)<br/>    .then(function(response) {<br/>        // handle success<br/>    })<br/>    .catch(function(error) {<br/>        // handle error<br/>    }));</span></pre><p id="581f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们看看返回的数据。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="97cc" class="lg lh iq lc b gy li lj l lk ll">function(response) {<br/>    console.log(response.status);<br/>        console.log(response.data);<br/>  }</span></pre><p id="7e28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在控制台中查看一下，并决定您想要使用响应的哪些部分。直接在浏览器中输入URL也有助于查看JSON。</p><p id="e675" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想展示其中一张照片，火星车名称，拍摄照片的相机，以及相应的火星溶胶。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0ba6" class="lg lh iq lc b gy li lj l lk ll">function(response){<br/>    var image = response.data.photos[0].img_src;<br/>        console.log(image)</span><span id="9997" class="lg lh iq lc b gy lq lj l lk ll">    var sol = response.data.photos[0].sol;<br/>        console.log(sol)</span><span id="0c4f" class="lg lh iq lc b gy lq lj l lk ll">    var cameraName = response.data.photos[0].camera.full_name; <br/>        console.log(cameraName)</span><span id="66e8" class="lg lh iq lc b gy lq lj l lk ll">    var roverName= response.data.photos[0].rover.name;<br/>    console.log(roverName);</span><span id="741c" class="lg lh iq lc b gy lq lj l lk ll">        var text = `The image below was taken by the ${cameraName} on the ${roverName} rover on Martian sol ${sol}.`;<br/>  };</span></pre><p id="71a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第三步——处理错误</strong></p><p id="afdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果用户选择了一个越界的日期，该怎么办？或者如果没有某一天的照片呢？就目前的情况而言，用户不会看到任何变化，但不会得到任何关于原因的警告。</p><p id="e698" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们将响应函数设置为仅在有响应时前进:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="3b34" class="lg lh iq lc b gy li lj l lk ll">axios.get(url)<br/>        .then(function(response) {<br/>            if (response)<br/>           // response code<br/>        });</span></pre><p id="0947" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果没有响应，添加逻辑:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f105" class="lg lh iq lc b gy li lj l lk ll">axios.get(url)<br/>        .then(function(response) {<br/>            if (response)<br/>                // response code<br/>        }).catch(error)<br/>    //error code<br/>        console.log(error)<br/>};</span></pre><p id="d5ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第4步——向DOM显示结果</strong></p><p id="b1ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们添加一些标记来显示结果。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8158" class="lg lh iq lc b gy li lj l lk ll">&lt;div id="results"&gt;&lt;/div&gt;</span><span id="2a7f" class="lg lh iq lc b gy lq lj l lk ll">&lt;img src="" id="image" alt="Mars Photo" width="300px" height=auto style="display: none"&gt;</span></pre><p id="e7ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于<code class="fe ln lo lp lc b">img</code>，添加你喜欢的任何属性，但是记住添加<code class="fe ln lo lp lc b">style="display: none"</code>，这样就不会出现损坏的图像。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/309c10d8884c751abd0c087bee7cfccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*PYB9Rf60o9vhu5NVI9Lxow.png"/></div></figure><p id="d190" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们使用IDs来访问元素。在JS文件中，在响应函数内添加:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="e7bd" class="lg lh iq lc b gy li lj l lk ll">document.getElementById("results").innerHTML = text;<br/>// sets the innerHTML of the div to the text results.<br/>document.getElementById("image").src = image;<br/>// adds the image URL to the src attribute<br/>document.getElementById("image").style.display = "block";<br/>// displays the image element</span></pre><p id="1553" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最终结果如下所示:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/0d965f4c26921d1516409db6fbaaedf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2X6n6Ud4pFiwZMeyqdVO1w.png"/></div></div></figure><p id="c2ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在误差函数中添加:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f7a8" class="lg lh iq lc b gy li lj l lk ll">var error = "Sorry, there are no photos on this date! Pick another.";<br/>document.getElementById("results").innerHTML = error;</span></pre><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/1c5129cef45b768b82927b587ee21c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d5JSp3QFBQJKZf73EWxscw.png"/></div></div></figure><p id="2cb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请参见并在此测试完整代码<a class="ae kw" href="https://codepen.io/rachelhawa/pen/XWJEXLL" rel="noopener ugc nofollow" target="_blank"/>，您可能需要更改API密钥——演示密钥每天只允许30个请求。</p></div></div>    
</body>
</html>