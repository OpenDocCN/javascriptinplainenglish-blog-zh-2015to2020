<html>
<head>
<title>JavaScript Unit Test Best Practices — Hooks and APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript单元测试最佳实践—钩子和API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-unit-test-best-practices-hooks-and-apis-3814d2a72f25?source=collection_archive---------7-----------------------#2020-08-23">https://javascript.plainenglish.io/javascript-unit-test-best-practices-hooks-and-apis-3814d2a72f25?source=collection_archive---------7-----------------------#2020-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/015b3fe2e259fc95a1ac3c75c42a8f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iTzVzsksq2cFQ7R-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@wideshot?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anders Wideskott</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4450" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序如何工作非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写JavaScript单元测试时应该遵循的一些最佳实践。</p><h1 id="0157" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">正确设置适用于所有相关测试的操作</h1><p id="ac93" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们在每次测试之前运行相同的东西，我们应该把它放在一个<code class="fe me mf mg mh b">beforeEach</code>钩子中。</p><p id="fa6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们在每次测试之前运行相同的代码，而不需要重复代码。</p><p id="914e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="89ff" class="mq lc iq mh b gy mr ms l mt mu">describe('Saving the user profile', () =&gt; {</span><span id="9020" class="mq lc iq mh b gy mv ms l mt mu">  beforeEach(() =&gt; {<br/>    login();<br/>  });</span><span id="f015" class="mq lc iq mh b gy mv ms l mt mu">  it('should save updated profile setting to database', () =&gt; {<br/>    //...</span><span id="f45d" class="mq lc iq mh b gy mv ms l mt mu">    expect(request.url).toBe('/profiles/1');<br/>    expect(request.method).toBe('POST');<br/>    expect(request.data()).toEqual({ username: 'james' });<br/>  });</span><span id="c615" class="mq lc iq mh b gy mv ms l mt mu">  it('should notify the user', () =&gt; {<br/>    //...<br/>  });<br/>});</span><span id="65d2" class="mq lc iq mh b gy mv ms l mt mu">  it('should redirect user', () =&gt; {<br/>    //...   <br/>  });<br/>});</span></pre><p id="e15d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，如果我们有一些代码需要在每次测试后运行，我们应该有一个<code class="fe me mf mg mh b">afterEach</code>钩子在每次测试后运行:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9a76" class="mq lc iq mh b gy mr ms l mt mu">describe('Saving the user profile', () =&gt; {</span><span id="5a23" class="mq lc iq mh b gy mv ms l mt mu">  beforeEach(() =&gt; {<br/>    login();<br/>  });</span><span id="3d18" class="mq lc iq mh b gy mv ms l mt mu">  afterEach( () =&gt; {<br/>    logOut();<br/>  });</span><span id="4607" class="mq lc iq mh b gy mv ms l mt mu">  it('should save updated profile setting to database', () =&gt; {<br/>    //...</span><span id="da43" class="mq lc iq mh b gy mv ms l mt mu">    expect(request.url).toBe('/profiles/1');<br/>    expect(request.method).toBe('POST');<br/>    expect(request.data()).toEqual({ username: 'james' });<br/>  });</span><span id="4b65" class="mq lc iq mh b gy mv ms l mt mu">  it('should notify the user', () =&gt; {<br/>    //...<br/>  });</span><span id="cd83" class="mq lc iq mh b gy mv ms l mt mu">  it('should redirect user', () =&gt; {<br/>    //...   <br/>  });<br/>});</span></pre><h1 id="2df1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">考虑在测试中使用工厂函数</h1><p id="96ee" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">工厂函数有助于减少安装代码。</p><p id="a3ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们使每个测试更具可读性，因为创建是在单个函数调用中完成的。</p><p id="9716" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且它们在创建新实例时提供了灵活性。</p><p id="abf3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="da00" class="mq lc iq mh b gy mr ms l mt mu">describe('User profile module', () =&gt; {<br/>  let user;</span><span id="a0e6" class="mq lc iq mh b gy mv ms l mt mu">  beforeEach(() =&gt; {<br/>    user = createUser('james');<br/>  });</span><span id="052b" class="mq lc iq mh b gy mv ms l mt mu">  it('should publish a topic "like" when like is called', () =&gt; {<br/>    spyOn(user, 'notify');<br/>    user.like();<br/>    expect(user.notify).toHaveBeenCalledWith('like', { count: 1 });<br/>  });</span><span id="a334" class="mq lc iq mh b gy mv ms l mt mu">  it('should retrieve the correct number of likes', () =&gt; {<br/>    user.like();<br/>    user.like();<br/>    expect(user.getLikes()).toBe(2);<br/>  });<br/>});</span></pre><p id="d526" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">createUser</code>函数，通过一次函数调用来创建一个用户。</p><p id="b29d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们不必为每个测试编写相同的设置代码。</p><p id="3170" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以在DOM测试中使用它们:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5a9d" class="mq lc iq mh b gy mr ms l mt mu">function createSearchForm() {<br/>  fixtures.inject(`&lt;div id="container"&gt;<br/>    &lt;form class="js-form" action="/search"&gt;<br/>      &lt;input type="search"&gt;<br/>      &lt;input type="submit" value="Search"&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;`);</span><span id="765d" class="mq lc iq mh b gy mv ms l mt mu">  const container = document.getElementById('container');<br/>  const form = container.getElementsByClassName('js-form')[0];<br/>  const searchInput = form.querySelector('input[type=search]');<br/>  const submitInput = form.querySelector('input[type=submit]');</span><span id="7a83" class="mq lc iq mh b gy mv ms l mt mu">  return {<br/>    container,<br/>    form,<br/>    searchInput,<br/>    submitInput<br/>  };<br/>}</span><span id="0766" class="mq lc iq mh b gy mv ms l mt mu">describe('search component', () =&gt; {<br/>  describe('when the search button is clicked', () =&gt; {<br/>    it('should do the search', () =&gt; {<br/>      const { container, form, searchInput, submitInput } = createSearchForm();<br/>      //...<br/>      expect(search.validate).toHaveBeenCalledWith('foo');<br/>    });</span><span id="2bcd" class="mq lc iq mh b gy mv ms l mt mu">    // ...<br/>  });<br/>});</span></pre><p id="af6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe me mf mg mh b">createSearchForm</code>函数中有搜索表单创建代码。</p><p id="d747" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在函数中，我们返回表单的DOM对象的各个部分，以便检查代码。</p><h1 id="5a5c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用测试框架的API</h1><p id="a963" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该利用测试框架的API。</p><p id="33c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就可以利用它的功能来简化测试。</p><p id="1c8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="983b" class="mq lc iq mh b gy mr ms l mt mu">fit('should call baz with the proper arguments', () =&gt; {<br/>  const foo = jasmine.createSpyObj('foo', ['bar', 'baz']);<br/>  foo.baz('baz');<br/>  expect(foo.baz).toHaveBeenCalledWith('baz');<br/>});</span><span id="2ee5" class="mq lc iq mh b gy mv ms l mt mu">it('should do something else', () =&gt; {<br/>  //...<br/>});</span></pre><p id="7f85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用茉莉。</p><p id="f898" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们窥探了存根函数，看看它们是否是用<code class="fe me mf mg mh b">createSpyObj</code>方法调用的。</p><p id="8d76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">fit</code>以便只运行第一个测试。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/30d72475cafbd230448faf392913038e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ELfVMas2DlE69LQu"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lyndaann1975?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lynda Hinton</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="21ab" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="c33e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该确定测试框架的API以使测试更容易。</p><p id="07fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们应该确保将重复的代码放在钩子中，以避免重复。</p><h2 id="c853" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="d96e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>找到所有内容的链接！</p></div></div>    
</body>
</html>