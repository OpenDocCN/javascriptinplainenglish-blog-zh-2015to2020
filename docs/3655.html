<html>
<head>
<title>User-Tracking With CSS Only</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">仅使用CSS进行用户跟踪</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/tracking-with-css-ec98e3d81046?source=collection_archive---------7-----------------------#2020-10-15">https://javascript.plainenglish.io/tracking-with-css-ec98e3d81046?source=collection_archive---------7-----------------------#2020-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4dc5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">设备类型、操作系统和网站上的动态</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a3c3881f3b583575f3f7e241b7bcd588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5AecJjiH3Z50F_BfOIaEYw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: The author</figcaption></figure><p id="c761" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">浏览器中的用户跟踪一次又一次地引起关于隐私和数据保护的讨论。谷歌分析(Google Analytics)这样的工具几乎可以找出一切——来源、语言、设备、保留时间等等。</p><p id="3c50" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是要获得一些有趣的信息，你不需要任何外部跟踪器——甚至不需要JavaScript。本文将向您展示如何跟踪用户行为，即使用户禁用了JavaScript。</p><h1 id="eadf" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">追踪器通常如何工作</h1><p id="b4b1" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">因此，规则是JavaScript用于这种分析工具——所以大多数信息非常容易阅读，并且可以立即发送到服务器。</p><p id="9ab3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这也是为什么浏览器中屏蔽追踪器工具的方式越来越多的原因。像Brave Browser这样的浏览器或某些chrome扩展会阻止google analytics这样的追踪器的加载。<br/>诀窍在于，例如，Google Analytics总是在外部集成，因此JavaScript来自Google CDN。用于嵌入的URL几乎总是相同的，因此很容易被屏蔽。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/13632455c8c4f57fac04761bd0c2b5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iyfFqlTl8QnmnHrYkI1wGg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: <a class="ae mp" href="https://brave.com/whats-brave-done-for-my-privacy-lately-episode1/#:~:text=One%20of%20many%20ways%20Brave,from%20recording%20your%20online%20activity." rel="noopener ugc nofollow" target="_blank">Brave Browser</a></figcaption></figure><p id="d761" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以跟踪几乎总是与JavaScript有关。即使你通过URL屏蔽了追踪器，网站所有者也可能在页面上嵌入了JavaScript代码。最强的保护是停用JavaScript——即使你为此付出的代价非常高。</p><p id="da35" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们仍然可以在没有JavaScript的情况下跟踪一些东西——使用一些CSS技巧，当然不是为了这个目的。让我们开始吧。</p><h1 id="bc95" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">找出设备类型</h1><p id="c010" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">每个web开发人员都应该知道媒体查询。有了它们，我们可以只在特定的屏幕条件下激活CSS代码。因此，我们可以为智能手机或平板电脑编写自己的查询。</p><p id="a352" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们所有CSS跟踪器背后的全部魔力是我们可以将URL作为值调用的属性。一个很好的例子是背景图像属性，它允许我们为元素设置背景图像。图像是从一个URL中检索的——在执行过程中第一次被请求，因此一个GET请求被发送到URL: <code class="fe mq mr ms mt b">background-image: url('/dog.png');</code></p><p id="e4d8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是最后，没有人强迫我们确保URL后面真的有图像。例如，服务器甚至不需要响应请求，但是我们仍然可以创建一个数据库条目来响应GET请求。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="ac5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为后端，我在这里使用Express.js服务器。它提供了一个简单的HTML网站；如果设备是智能手机，则调用/mobile-route。所以我们的后端是唯一使用JavaScript的地方。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="bc2b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的index.html中，我们有上面的CSS代码。只有当用户的设备与媒体查询相匹配时，才会请求背景图像。</p><p id="d496" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果智能手机现在调用页面，则执行媒体查询，请求背景图像，服务器输出它是智能手机——完全没有JavaScript。</p><p id="5248" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于我们没有回复图片，网站上的任何内容都不会改变。</p><h1 id="b50d" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">了解操作系统</h1><p id="5b7c" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">现在变得更疯狂了——我们可以用用户操作系统支持的字体大致找出用户的操作系统。在CSS中，我们可以创建回退，即指定多种字体。如果第一个在系统上不工作，浏览器将尝试第二个。</p><p id="5d6d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mq mr ms mt b">font-family: BlinkMacSystemFont, "Arial";</code> —当我将这段代码嵌入我们的网站时，我的Macbook使用了第一种字体——苹果标准字体，这种字体只在Mac OS上可用。在我的Windows PC上，使用Arial。</p><p id="fc9c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了字体外观，我们可以定义一个自定义字体，并为它指定一个源。Google Fonts的工作方式是一样的——如果我们在某个地方使用了已定义的字体，它必须首先从服务器加载。我们可以再用这个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="eabf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里我们为整个主体设置字体。从逻辑上讲，你只能使用一种字体。所以在Macbook上，使用的是第一种字体，系统自带的字体。在像Windows这样的所有其他系统上，我们检查字体是否存在。当然，这失败了，所以尝试下一种字体——我们自己定义的字体。它仍然需要从服务器加载，所以我们的CSS代码再次触发一个GET请求。</p><p id="0486" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因为<em class="mw"> Font2 </em>当然不是真正的字体，我们继续尝试——将使用Arial。尽管如此，我们仍然可以使用合理的字体——用户不会注意到任何事情。</p><h1 id="4877" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">跟踪元素</h1><p id="8fcf" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">到目前为止，我们所做的是在用户一到达网站就对信息进行评估。当然，我们也可以用CSS对个别事件做出反应。</p><p id="7f2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们可以使用例如悬停或活动事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="08ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当按钮悬停时，它再次尝试设置背景图像。再次发送GET-request。</p><p id="7852" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当点击按钮时，我们可以做同样的事情。在CSS中，这是活动事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="716d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还有一系列其他事件。例如，悬停事件对几乎每个元素都有效。所以理论上，我们可以跟踪用户的几乎每一个动作。</p><h2 id="e5f8" class="mx ls iq bd lt my mz dn lx na nb dp mb le nc nd md li ne nf mf lm ng nh mh ni bi translated">犹豫计数器</h2><p id="fcd0" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">只要多一点代码，我们还可以组合事件，了解更多信息，而不仅仅是发生了哪些事件。</p><p id="3a8f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于许多网站所有者来说，有趣的是看到用户在看到或悬停在某个元素上后犹豫了多长时间才点击它。通过下面的代码，我们可以测量用户悬停后点击所用的时间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="5af7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用户一悬停，计数器就开始计时。最后，我们花了几秒钟，直到点击。</p><p id="2da0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可能认为因为它嵌入在CSS代码中，所以可能不精确——但事实并非如此。请求很小，因此会立即到达服务器。我测试了几次，测量了时间——服务器最终给出的结果非常精确。</p><p id="7ba7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很可怕，不是吗？</p><h1 id="36c1" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">让整个事情变得更美丽</h1><p id="4d36" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">为了不被发现，使用不太明显的URL是有意义的。<br/>最后完整的前端代码大家都看得见。</p><p id="63a8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除了为单个路由使用如此明显的术语，您还可以使用自己想到的关键字—最终，只有前端的URL和后端的URL必须匹配。</p><p id="f475" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于上面的例子，我总是为GET请求使用我自己的路由。简单以便更容易理解。一种更优雅的方式是使用URL参数或查询，这在CSS中也适用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="1dc3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有关Express.js中查询和URL参数的详细教程，您可以在这里找到:</p><div class="nj nk gp gr nl nm"><a href="https://medium.com/javascript-in-plain-english/query-strings-url-parameters-d1a35b9a694f" rel="noopener follow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd ir gy z fp nr fr fs ns fu fw ip bi translated">Express.js中的查询与URL参数</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">区别以及何时使用</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">medium.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa kp nm"/></div></div></a></div><p id="946d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae mp" href="http://eepurl.com/hacY0v" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">加入我的简讯保持联系</strong> </a></p></div></div>    
</body>
</html>