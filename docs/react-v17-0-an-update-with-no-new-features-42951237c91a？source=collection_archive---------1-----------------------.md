# React v17.0:没有新特性的更新

> 原文：<https://javascript.plainenglish.io/react-v17-0-an-update-with-no-new-features-42951237c91a?source=collection_archive---------1----------------------->

## 没有增加新功能的主要新版本？

距离 React v16 首次发布已经过去了两年半。开发团队承诺更新 v17 对 React 的未来非常重要，但声称不会增加新功能。那到底是什么意思呢？React 怎么能声称要发布一个新的重要版本而不增加新特性呢？

## 逐步反应更新

过去的 React 更新总是导致旧版本被弃用。这可能会让团队难以置信地难以升级他们的 React 版本，尤其是在处理大型或被忽视的代码库时。因此，React 团队决定 v17 将为采用更新的新方法奠定基础。当 React v18 发布时，开发人员将能够选择只升级他们应用程序的一部分，而保持其他部分在 v17 上运行。如果您的应用程序正在积极维护或处于大规模生产中，React 建议不要这样做，但它可以帮助那些不积极维护应用程序或不需要将某些组件迁移到新版本的团队。未来，新的 React 版本不会抛弃这些应用，也不会要求大规模迁移。

![](img/4687b65b3e8dd3c4ec04fd5ca0d30066.png)

为了实现这种能力，React 团队花了一些时间重新设计事件系统。这些更新使得 React v17 成为一个主要版本，因为它可能会破坏许多应用程序。

## 事件不再附加到文档

与您可能想到的相反，React 没有将事件附加到单个元素上。相反，React 将每个事件类型的一个处理程序绑定到`document`节点。这种方法提高了具有大型元素树的应用程序的性能，还支持重放事件等功能。

在后台，React 可以捕获一个事件，并在将事件传播到组件树之前确定调用哪个组件。然而，在本地 Javascript 中，事件已经传播到了`document`级别。虽然这听起来不像是一个问题，但是当运行 React 的多个实例时，这个系统会崩溃。如果嵌套在另一个 React 应用程序中的 React 应用程序停止了事件的传播，父 React 应用程序仍将捕获事件。对于希望嵌套不同版本的 React 的开发人员来说，这是一个非常头疼的问题。您可能不会想到这种情况会发生在生产中，但是 Atom 代码编辑器在四年前[就遇到了这个问题](https://github.com/facebook/react/pull/8117)！

React 现在会将事件处理程序附加到 React 应用程序的根节点。这一改变将允许反应树之间的安全嵌套。当然，所有 React 实例都必须在版本 17 或更高版本上运行才能工作。这一更新也意味着 React 应用程序更容易嵌入到 jQuery 等其他框架中。正如所料，React 现在将阻止事件传播到 jQuery。

## 优化效果清理

在一个`useEffect`方法中返回一个清理函数来停止函数中运行的任何代码是相当常见的。过去，这种清理功能会在绘制下一帧之前同步运行。事实上，大多数应用程序并不需要延迟屏幕更新来运行清理方法。所以它们现在将在 React 渲染下一帧后异步运行。这将加快组件之间的切换时间。您仍然可以使用`useLayoutEffect`方法来运行阻塞渲染循环的清理方法。

## 不再有事件池

事件池令人难以置信地混乱，并且在现代浏览器上不提供任何优化。相反，当处理接收相同事件的多个组件时，它会导致一些奇怪的错误。一个事件处理程序可能将事件设置为 null，因此使用该事件的其他组件将遇到 null 变量错误。简而言之，新的 React 版本将允许在需要时访问事件字段。

React v17 可能不是 React 开发人员希望的功能丰富的更新。相反，这更像是一种思想上的更新。因此，虽然我们可能不会得到很酷的新组件或挂钩，但这些附加功能将在以后的更新中得到回报。你现在可以通过在 React 项目中运行`npm install react@17.0.0-rc.0 react-dom@17.0.0-rc.0`来尝试 React v17。