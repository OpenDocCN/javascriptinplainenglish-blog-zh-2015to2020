<html>
<head>
<title>Refactoring: 5 Steps to Improve Existing Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重构:改进现有代码的5个步骤</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-refactor-existing-code-70e9e5af4ce3?source=collection_archive---------7-----------------------#2020-07-14">https://javascript.plainenglish.io/how-to-refactor-existing-code-70e9e5af4ce3?source=collection_archive---------7-----------------------#2020-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/20ab0d1d0818e5198485eb440939f524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x6Oj5uI7u9KhI_av7kW7WQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">The hardest &amp; most frequent thing you’ll do as a developer</figcaption></figure><p id="ace4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">作为开发人员，您的大部分工作是更新现有代码。然而，并没有太多的指南或教程来教你如何成功地重构，以及应该寻找什么。</p><p id="3431" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我将分享一套简单的指导原则，当我不得不重构时，这些原则对我很有用。</p><h1 id="2de7" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么要重构？</h1><p id="638c" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">代码库变得难以理解的速度之快令人惊讶。并不是说最初的作者是糟糕的程序员。需求发生了变化，一些东西被添加进来。</p><p id="9178" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当时的决定似乎是合理的。重构规则1:责怪别人不会有任何帮助。</p><p id="d042" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么为什么要重构呢？</p><ul class=""><li id="8fdb" class="md me iq ke b kf kg kj kk kn mf kr mg kv mh kz mi mj mk ml bi translated">因为它使代码更容易理解，更容易理解的代码也更容易被下一个开发人员更新</li><li id="4c50" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">通常，它会使您的代码执行得更快</li><li id="2b82" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">它迫使你真正理解代码是如何工作的&amp;为什么它会这样工作，使你成为一个更好的开发者</li><li id="1bb6" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">未来，重构后的代码更加灵活。重用逻辑、常量和数据结构使得代码更容易扩展。</li></ul><h1 id="f16b" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么时候重构？</h1><p id="5e51" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我看到工程团队陷入了一个又一个重构的循环中。我如何决定什么值得我花时间去解决？</p><ul class=""><li id="28d5" class="md me iq ke b kf kg kj kk kn mf kr mg kv mh kz mi mj mk ml bi translated">永远假设你不会是下一个接触这个代码的人(或者未来——你会忘记代码是如何工作的)。现在，当你明白这是澄清它的最佳时机。</li><li id="8930" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">这并不意味着你必须重写它的基本工作原理(尽管你可能会这么做)。很多时候，清理一些东西并重命名其他东西会产生很大的不同。</li><li id="37c9" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">如果你被分配了一个特定的任务/任务单，不要重构你的任务单范围之外的代码。限制重构的范围。</li><li id="b8f7" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">你应该总是努力让代码比你发现的更好。</li></ul><p id="91d0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">什么时候应该寻找代码的味道和使代码更简单的方法？一直都是。</p><p id="c2e9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">什么时候你应该进行一次大规模的重构，这将触及代码库的许多部分？只有当你被明确地分配了任务并且得到了整个团队的支持时。</p><h1 id="1bdb" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">我最喜欢的5种重构试探法</h1><blockquote class="mr"><p id="ae64" class="ms mt iq bd mu mv mw mx my mz na kz dk translated">“启发式是解决问题或自我发现的任何方法，它采用的实际方法不能保证是最佳的、完美的或合理的，但足以达到一个直接的、短期的目标。”——维基百科</p></blockquote><p id="baf3" class="pw-post-body-paragraph kc kd iq ke b kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ng kx ky kz ij bi translated">虽然它们不会涵盖每一个可能的重构机会，但这5个启发法对我简化代码有很大帮助。</p><h1 id="3883" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1.进行测试</h1><p id="6807" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">当你重构某个东西时，第一步是<a class="ae nb" href="https://en.wikipedia.org/wiki/Test-driven_development" rel="noopener ugc nofollow" target="_blank">检查是否有针对这个功能的测试</a>。</p><p id="bc1d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">更改现有代码意味着您可能会破坏某些东西，因此在我们进行任何更改之前，我们希望了解原始代码产生的预期响应。</p><p id="413e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你没有测试，重构的第一步就是写测试。</p><h1 id="3b18" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">2.减少If/Else</h1><p id="61c9" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">任何时候你添加一个if语句到你的代码中，你增加了它的复杂性。下一个阅读它的人必须记住他们遇到的所有不同的可能的代码路径。</p><p id="39c0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">通常，通过将工作转移到提前返回的<a class="ae nb" href="https://stackoverflow.com/a/1804276" rel="noopener ugc nofollow" target="_blank">函数中也可以获得相同的结果</a>。</p><p id="8270" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae nb" href="https://maryrosecook.com/blog/post/a-practical-introduction-to-functional-programming" rel="noopener ugc nofollow" target="_blank">功能编程</a>的元素也将帮助<a class="ae nb" href="https://medium.com/swlh/stop-using-if-else-statements-f4d2323e6e4" rel="noopener">减少条件逻辑</a>。</p><p id="a6ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">理想情况下，你的代码不应该嵌套(缩进)超过几层。</p><h1 id="3c6d" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">3.使用变量名来阐明</h1><p id="5e2c" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">如果你的变量名不清楚、错误或者太普通，那么代码就更难阅读。</p><p id="5d2c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">通常，这是一场轻松的胜利。找到不好的变量名并用好的替换。</p><p id="f618" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此外，将复杂的条件逻辑转换为存储布尔值的变量。如果您调用函数只是为了查看它们是否有值，那么将它们保存为具有明确名称的变量:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="5e53" class="nq lb iq nm b gy nr ns l nt nu">has_thing = self.logic.find_the_thing(lookup, other_stuff)</span></pre><p id="46cf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">总是在寻找澄清和简化变量名的方法。命名是编码中最难的部分之一。</p><h1 id="c9b0" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">4.函数应该只做一件事</h1><p id="795c" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">当你写函数&amp;重构别人的函数时，请记住这一点。他们应该尽可能的沉默。</p><p id="ba87" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我昨天写了这个函数:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="e6ab" class="nq lb iq nm b gy nr ns l nt nu">def get_company_override_rate(self, date):<br/>    “”” Find the currency conversion rate for this time period “””<br/>    date = arrow.get(date)<br/>    rate = self.conversion_rates.get(date.format(‘YYYY-MM’))       <br/>    return rate</span></pre><p id="08de" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我并不是说这个函数是简单的顶峰。有更多的事情可以做得更简单。但是它很短，并且很快就能明白它是做什么的。</p><p id="4b1e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Python程序员会注意到，如果日期不在字典中，这个函数会返回<code class="fe nv nw nx nm b">None</code>。代码这样做是为了减少If/Else(见上面的#2 ),当这些小函数被链接在一起做更复杂的逻辑时。</p><p id="88ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">保持你的函数简单，让它们互相调用。</p><h1 id="8b26" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">5.在类/状态级别存储有用的信息</h1><p id="e7a1" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">如果你看到一个函数有很多参数，那么它可能需要一些类或状态对象。</p><p id="fab0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用<code class="fe nv nw nx nm b">this.state</code>或<code class="fe nv nw nx nm b">self.attribute</code>是常见的模式，尽管语法会根据您的语言而变化。</p><p id="05d7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当您在类实例上存储数据时，您可以在该类的不同方法之间引用该数据。然后，初始化类调用标准逻辑来填充这些值。</p><p id="dc74" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您将获得更加一致的结果，可以在许多地方重复使用，而无需重复。</p><h1 id="d621" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">凭直觉</h1><p id="29df" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">这些只是我发现有用的指导方针。最终，你工作的代码将会和我的有很大的不同，所以你只需要发展直觉，知道什么代码需要改变。</p><p id="7bfd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你在代码中嗅到一些可疑的东西，跟随你的直觉。几乎可以肯定的是，有些东西是可以改进的。</p><p id="3899" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">想深入了解重构吗？一定要读马丁·福勒的书——《重构:改进现有代码的设计》</p><p id="4c38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你使用更多的重构试探法吗？我很想听听他们的故事——使用评论或hello@bennettgarner.com</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="2b6f" class="la lb iq bd lc ld of lf lg lh og lj lk ll oh ln lo lp oi lr ls lt oj lv lw lx bi translated">关于班尼特</h1><p id="b15c" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我是一名用Python和JavaScript构建东西的web开发人员。</p><p id="1bb8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="ok">想要我关于web开发和成为更好的程序员的最佳内容吗？</em></p><p id="8d41" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="ok">我在邮件列表中分享我最喜欢的建议——没有垃圾邮件，没有推销内容，只有有用的内容。</em></p><p id="325a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">加入我的电子邮件系列中的500名其他开发人员。</p></div></div>    
</body>
</html>