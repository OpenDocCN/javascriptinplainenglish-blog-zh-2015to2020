<html>
<head>
<title>Lifecycle hooks are not enough with React Navigation in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生命周期挂钩对于React Native中的React导航是不够的</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lifecycle-hooks-are-not-enough-with-react-navigation-in-react-native-dc431624391?source=collection_archive---------4-----------------------#2020-05-17">https://javascript.plainenglish.io/lifecycle-hooks-are-not-enough-with-react-navigation-in-react-native-dc431624391?source=collection_archive---------4-----------------------#2020-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="684d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">也使用React导航库提供的这些事件和API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a9176e3e7e0924523c7ce6420d438aa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeRkLY7v04BdoL2-XIA2nQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">React Navigation-Photo by <a class="ae kv" href="https://unsplash.com/@dannayyyboi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Dan Chung</a> on <a class="ae kv" href="https://unsplash.com/s/photos/navigation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dbe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">React生命周期挂钩帮助我们检测呈现UI的各个阶段。在web中，我们经常使用<code class="fe ls lt lu lv b">useEffect</code> hook在渲染、改变指定变量和卸载时执行动作。然而，在React Native中使用React导航识别屏幕转换时，这还不够。</p><p id="a8fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我前段时间就面临这样的情况。我正在做的项目有一个<code class="fe ls lt lu lv b">Profile</code>屏幕和一个<code class="fe ls lt lu lv b">Settings</code>屏幕。可以在<code class="fe ls lt lu lv b">Settings</code>屏幕上更新个人资料详情。然而，当从<code class="fe ls lt lu lv b">Settings</code>屏幕导航回<code class="fe ls lt lu lv b">Profile</code>屏幕时，我仍然看到旧的过时信息，即使它已被设置为在渲染时获取配置文件数据。</p><p id="b9d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发生这种情况是因为React导航处理UI(屏幕)呈现的方式与React处理web上呈现的方式有很大不同。下面是解释。</p><ul class=""><li id="68f7" class="lw lx iq ky b kz la lc ld lf ly lj lz ln ma lr mb mc md me bi translated">当我们第一次导航到Profile屏幕时，它被推入导航堆栈。</li><li id="babe" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">然后我们导航到设置屏幕，导致设置屏幕也推入堆栈。由于配置文件屏幕没有从堆栈中弹出，所以它仍然是挂载的。</li><li id="699b" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">更新个人资料信息后，我们按“后退”按钮再次导航到个人资料屏幕。由于配置文件屏幕一直保持安装状态，为了导航到配置文件，设置被弹出堆栈，因此被卸载。</li><li id="ac12" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">但是，当导航到配置文件屏幕时，不会调用任何挂载方法，因为它已经被挂载了。因此，配置文件屏幕不执行任何数据提取，仍然向我们显示旧信息。</li></ul><p id="6d06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们需要使用替代品来避免这种行为。</p><p id="7d14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了<a class="ae kv" href="https://reactnavigation.org/" rel="noopener ugc nofollow" target="_blank"> React Navigation </a>提供的解决方案，克服这种困惑并不困难。</p><h2 id="9dcf" class="mk ml iq bd mm mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">聆听聚焦和模糊事件</h2><p id="1f94" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">React Navigation为我们提供了两个事件，<code class="fe ls lt lu lv b">focus</code>和<code class="fe ls lt lu lv b">blur</code>来分别检测进入一个新的屏幕和离开一个屏幕。使用这些方法，您可以成功地调用您的<code class="fe ls lt lu lv b">useEffect</code>中的业务逻辑。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="26a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们正在收听<code class="fe ls lt lu lv b">useEffect</code>中的<code class="fe ls lt lu lv b">Focus</code>事件。每次聚焦配置文件屏幕时，即配置文件屏幕可见时，会发生onFocus事件，并获取更新的配置文件数据。</p><p id="a56a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当卸载配置文件屏幕时，我们应该停止监听事件。这就是为什么我们通过在<code class="fe ls lt lu lv b">useEffect</code>中返回事件监听器来移除事件监听器。</p><p id="8a44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们也可以在屏幕失去焦点时触发一个功能。您可以通过监听<code class="fe ls lt lu lv b">Blur</code>事件来做到这一点，就像我们在上面的代码中监听<code class="fe ls lt lu lv b">Focus</code>事件一样。</p><p id="bffd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以用React导航的<code class="fe ls lt lu lv b">useFocusEffect</code>钩子做同样的事情，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h2 id="7497" class="mk ml iq bd mm mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">检查屏幕是否聚焦</h2><p id="ab33" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">React导航还提供了<code class="fe ls lt lu lv b">useIsFocused</code>钩子来检查屏幕是否被聚焦。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="c9af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们讨论了如何使用焦点和模糊事件侦听器来避免React Native中组件/屏幕呈现的一些混淆问题，使用React导航。</p><p id="098c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读…</p><p id="2cf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">资源:</strong></p><div class="nr ns gp gr nt nu"><a href="https://reactnavigation.org/docs/navigation-lifecycle" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">反应导航</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">在上一节中，我们使用了具有两个屏幕(主页和详细信息)的堆栈导航器，并学习了如何使用…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">reactnavigation.org</p></div></div></div></a></div><h1 id="5a92" class="od ml iq bd mm oe of og mp oh oi oj ms jw ok jx mv jz ol ka my kc om kd nb on bi translated"><strong class="ak">简明英语笔记</strong></h1><p id="b986" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">你知道我们推出了一个YouTube频道吗？我们制作的每个视频都旨在教给你一些新的东西。点击此处 查看我们，并确保订阅该频道😎</p></div></div>    
</body>
</html>