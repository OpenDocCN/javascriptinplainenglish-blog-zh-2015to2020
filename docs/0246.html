<html>
<head>
<title>ECMAScript 2019. Asynchronous iteration using “for-of”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ECMAScript 2019。使用“for-of”的异步迭代</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/ecmascript-2019-asynchronous-iteration-using-for-of-dc1893f99fd9?source=collection_archive---------1-----------------------#2019-09-05">https://javascript.plainenglish.io/ecmascript-2019-asynchronous-iteration-using-for-of-dc1893f99fd9?source=collection_archive---------1-----------------------#2019-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f3f3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用“for-of”循环异步迭代</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c8acfcedbf44c3eb75d0866b7f6de894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkNU694V-UgoSRNzfyVXIQ.jpeg"/></div></div></figure><p id="b8a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我想重点介绍ECMAScript 2019带来的另一个特性:<strong class="kt ir">异步迭代</strong>。这种类型的迭代基于<code class="fe ln lo lp lq b"><strong class="kt ir">for-of</strong></code> <strong class="kt ir">循环</strong>，它通常用于迭代数组中的一系列元素，从现在开始我们可以使用它来迭代异步元素，如<code class="fe ln lo lp lq b">Promises</code>。</p><p id="04b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们去看看吧！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="b1de" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">“for-of”循环</h1><p id="a46a" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">正如我在文章开头所评论的,<code class="fe ln lo lp lq b">for-of</code>循环允许我们遍历数组中包含的元素列表。例如:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/70c68d16d935602006fb8d6b79e479ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POrKim02oEkpEmvuKpE7xw.png"/></div></div></figure><p id="9f13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下，iterateArray函数通过在控制台上打印以下结果，将过去数组的元素作为参数进行同步迭代:</p><pre class="kg kh ki kj gt mw lq mx my aw mz bi"><span id="fa6a" class="na lz iq lq b gy nb nc l nd ne">item 10<br/>item 20<br/>item 30<br/>item 40<br/>item 50</span></pre><p id="75a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们看看，如果我们传递的不是一个数字数组，而是一个<strong class="kt ir">承诺</strong>数组，会发生什么:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/4f55b08f22ab456f1268ac600fe59c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfQOb_8_G8iooUMLOLuGuw.png"/></div></div></figure><p id="b06c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下，<code class="fe ln lo lp lq b">for-of</code>遍历数组，但是我们在屏幕上看到的是列表中的每个<code class="fe ln lo lp lq b">Promise</code>对象，而不是在其中解析的值。也就是说:</p><pre class="kg kh ki kj gt mw lq mx my aw mz bi"><span id="4a03" class="na lz iq lq b gy nb nc l nd ne">item: [object Promise]<br/>item: [object Promise]<br/>item: [object Promise]</span></pre><p id="69a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是<strong class="kt ir"> ECMAScript 2019 </strong>的到来变得重要的地方，因为它将允许我们异步地使用<code class="fe ln lo lp lq b">for-of</code>循环，正如我们将在下面看到的。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="8db4" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">使用“for-of”异步迭代</h1><p id="70df" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">正如我们在前面的例子中看到的，如果我们用<code class="fe ln lo lp lq b">for-of</code>循环迭代一个<code class="fe ln lo lp lq b">Promise</code>对象的数组，我们在每一步中得到的是未解析的对象，尽管一旦代码被异步执行，<em class="nf">希望</em>得到解析的值。</p><p id="89c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于ECMAScript 2019，这已经成为可能，因为从现在开始，可以在<code class="fe ln lo lp lq b">for-of</code>循环中添加<code class="fe ln lo lp lq b">await</code>关键字，以便异步迭代<strong class="kt ir">承诺</strong>的数组。这样，循环将在前进到下一个迭代之前等待迭代的承诺得到解决，从而允许我们使用解决的值:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/74266beb287c85cfec1129d6dba44f87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0rMLB1hsudWZQ0Tq7Djlg.png"/></div></div></figure><p id="a17a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于在示例的<code class="fe ln lo lp lq b">for-of</code>循环中使用了<code class="fe ln lo lp lq b">await</code>，我们现在将在控制台中得到:</p><pre class="kg kh ki kj gt mw lq mx my aw mz bi"><span id="d328" class="na lz iq lq b gy nb nc l nd ne"><br/>Promise One<br/>Promise Two<br/>Promise Three<br/></span></pre><p id="f0c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，Javascript的这一新特性在处理<strong class="kt ir">承诺</strong>列表时将非常有用，因为我们不需要为每个列表提供一个“<em class="nf">回调</em>”，但是我们可以使用<code class="fe ln lo lp lq b">for-of</code>循环对它们进行迭代，并直接获得它们求解的值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="46ae" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">承诺在循环中以什么顺序执行？</h1><p id="6a9f" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">使用<code class="fe ln lo lp lq b">for-of</code>循环异步工作时，需要知道的另一件重要事情是迭代的承诺以什么顺序被解析。也就是说，它们是按顺序解析的，或者循环将它们全部抛出并返回，这取决于获得值的速度。我们来看一个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/e176adc7b1fb56b11dbc62925046fd22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTBUfBCefp7ozC-grcJc1w.png"/></div></div></figure><p id="f8a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如你所见，第一个承诺花了10秒，第二个3秒，最后一个2秒。但是，我们在每个控制台上得到的输出与它们花费相同时间解决时的输出相同，即:</p><pre class="kg kh ki kj gt mw lq mx my aw mz bi"><span id="6482" class="na lz iq lq b gy nb nc l nd ne"><br/>Promise One<br/>Promise Two<br/>Promise Three</span></pre><p id="cc13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，<code class="fe ln lo lp lq b">for-of</code> <strong class="kt ir">循环</strong>异步工作时，它所做的是获得数组的第一个承诺，等待它解决，然后继续下一个<strong class="kt ir">允许我们控制它们的执行顺序。</strong></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="00d1" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论</h1><p id="6de2" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">正如你所看到的，渐渐地<strong class="kt ir"> Javascript </strong>为我们提供了更多的工具来改进异步函数的工作，就像在<code class="fe ln lo lp lq b">for-of</code>循环中使用<code class="fe ln lo lp lq b">await</code>一样。</p><p id="e93e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你想了解更多关于ECMAScript 2019带来的新奇事物，我留下一篇我写的关于<code class="fe ln lo lp lq b">Array.flat</code>函数的文章:</p><div class="ni nj gp gr nk nl"><a href="https://medium.com/@ger86/es2019-aplanar-arrays-en-javascript-con-array-flat-b9028a647734" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">ES2019。Javascript con Array.flat()中的平面数组</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">“展平数组”感谢es 2019 Hoy OS traigo an arti culo—receta sobre Javascript que de paso me servirápara…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kp nl"/></div></div></a></div></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="b9e5" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">你想收到更多这样的文章吗？</h1><p id="7367" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">如果你喜欢这篇文章，我鼓励你订阅我每周日发送的时事通讯，里面有类似的出版物和更多的推荐内容:👇👇👇</p><div class="ni nj gp gr nk nl"><a href="https://eepurl.us20.list-manage.com/subscribe?u=c14cad2102bcf33bf216cc69e&amp;id=2790da9378" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">拿铁和代码</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">这是一份最新的时事通讯，代码是recibirás cada domingo。——洛斯多斯乌尔蒂莫斯艺术博物馆……</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">eepurl.us20.list-manage.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz kp nl"/></div></div></a></div></div></div>    
</body>
</html>