<html>
<head>
<title>Upload Files with Multer on Server in Node.js and Express.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用服务器上的Multer在Node.js和Express.js中上传文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/uploading-files-using-multer-on-server-in-nodejs-and-expressjs-5f4e621ccc67?source=collection_archive---------0-----------------------#2020-03-23">https://javascript.plainenglish.io/uploading-files-using-multer-on-server-in-nodejs-and-expressjs-5f4e621ccc67?source=collection_archive---------0-----------------------#2020-03-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6f57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Multer是一个用于处理的Node.js中间件，主要用于上传文件。我将给出一个例子快速演示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/85b700549d96fa3dee1312962adcbf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G9HqFOtG_Vyaogqv"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@karlp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Karl Pawlowicz</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a96e" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">上传过程的幕后。</h1><p id="3dd0" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">文件上传流程是web客户端上传文件到服务器时，一般通过表单提交，编码为<code class="fe mc md me mf b">multipart/form-data</code>。Multer是用于Express和Node.js的中间件，当您的用户上传文件时，它可以很容易地处理这个<code class="fe mc md me mf b">multipart/form-data</code>。</p><h2 id="11d8" class="mg la in bd lb mh mi dn lf mj mk dp lj jv ml mm ln jz mn mo lr kd mp mq lv mr bi translated">什么是Multer？</h2><p id="4721" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">Multer是一个用于处理的Node.js中间件，主要用于上传文件。</p><h2 id="1db0" class="mg la in bd lb mh mi dn lf mj mk dp lj jv ml mm ln jz mn mo lr kd mp mq lv mr bi translated">软件要求</h2><ol class=""><li id="7f81" class="ms mt in jm b jn lx jr ly jv mu jz mv kd mw kh mx my mz na bi translated"><a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">Nod</a>e . js——node . js是基于<a class="ae ky" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank"> Chrome的V8 JavaScript引擎</a>构建的JavaScript运行时。</li><li id="5086" class="ms mt in jm b jn nb jr nc jv nd jz ne kd nf kh mx my mz na bi translated"><a class="ae ky" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank">Express</a>——用于<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>的快速、非个性化、极简的web框架</li><li id="c3be" class="ms mt in jm b jn nb jr nc jv nd jz ne kd nf kh mx my mz na bi translated"><a class="ae ky" href="https://www.npmjs.com/package/multer" rel="noopener ugc nofollow" target="_blank"> Multer </a> — Multer是一个用于处理的Node.js中间件，主要用于上传文件。</li><li id="83a2" class="ms mt in jm b jn nb jr nc jv nd jz ne kd nf kh mx my mz na bi translated"><a class="ae ky" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">Postman</a>—API开发的协作平台。</li></ol><h2 id="7870" class="mg la in bd lb mh mi dn lf mj mk dp lj jv ml mm ln jz mn mo lr kd mp mq lv mr bi translated">项目设置</h2><p id="ac00" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">我们将在这个项目中使用Node Express框架。当然，您需要安装Node。</p><p id="bbad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为我们的项目创建一个目录，导航到这个目录，并发出<code class="fe mc md me mf b">npm init</code>来创建一个<strong class="jm io">。json </strong>文件管理我们应用程序的所有依赖项</p><p id="3e1f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用npm命令安装所需的软件包:</p><pre class="kj kk kl km gt ng mf nh ni aw nj bi"><span id="f80b" class="mg la in mf b gy nk nl l nm nn">npm install --save express body-parser multer</span></pre><p id="558d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建Express服务器</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="5cf8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在配置服务器接受来自客户端的文件。</p><pre class="kj kk kl km gt ng mf nh ni aw nj bi"><span id="f905" class="mg la in mf b gy nk nl l nm nn">const multer  = require('multer');</span><span id="95c1" class="mg la in mf b gy nq nl l nm nn">/* We will upload the file on server local directory, not in database. We will store the directory path into the database. */</span></pre><p id="1706" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">以下配置用于在服务器上上传图像。</p><pre class="kj kk kl km gt ng mf nh ni aw nj bi"><span id="46f4" class="mg la in mf b gy nk nl l nm nn">const storage = multer.diskStorage({<br/>    destination: (req, file, cb) =&gt; {<br/>        cb(null, 'uploads');<br/>    },<br/>    filename: (req, file, cb) =&gt; {<br/>        console.log(file);<br/>        cb(null, Date.now() + path.extname(file.originalname));<br/>    }<br/>});</span><span id="d5c5" class="mg la in mf b gy nq nl l nm nn">const fileFilter = (req, file, cb) =&gt; {<br/>    if (file.mimetype == 'image/jpeg' || file.mimetype == 'image/png') {<br/>        cb(null, true);<br/>    } else {<br/>        cb(null, false);<br/>    }<br/>}</span><span id="7187" class="mg la in mf b gy nq nl l nm nn">const upload = multer({ storage: storage, fileFilter: fileFilter });</span></pre><p id="b83c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在创建一个接受我们的文件的路径。</p><pre class="kj kk kl km gt ng mf nh ni aw nj bi"><span id="f2c0" class="mg la in mf b gy nk nl l nm nn">//Upload route<br/>app.post('/upload', upload.single('image'), (req, res, next) =&gt; {<br/>    try {<br/>        return res.status(201).json({<br/>            message: 'File uploded successfully'<br/>        });<br/>    } catch (error) {<br/>        console.error(error);<br/>    }<br/>});</span></pre><p id="ce01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:首先在你的项目根目录下创建“<em class="nr">上传</em>目录。</p><p id="1b04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你也可以一次上传多个文件。</p><p id="a516" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用<code class="fe mc md me mf b">upload.array('images', 100)</code>就行了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/6cfde26ce51518fb71e50dd07ccd74e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PbgOPJWgICSHcYsGQY9Vw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Upload image</figcaption></figure><p id="a8dc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">数据类型应该是<code class="fe mc md me mf b">file</code>。如果你使用HTML表单，那么不要忘记表单中的<code class="fe mc md me mf b">enctype="multipart/form-data"</code>。</p><pre class="kj kk kl km gt ng mf nh ni aw nj bi"><span id="c321" class="mg la in mf b gy nk nl l nm nn">&lt;form method="POST" action="/upload" enctype="multipart/form-data"&gt;</span><span id="7bac" class="mg la in mf b gy nq nl l nm nn">&lt;div&gt; <br/>   &lt;label&gt;Select your profile picture:&lt;/label&gt; &lt;input type="file"   name="image" /&gt;<br/>&lt;/div&gt;</span><span id="f4f5" class="mg la in mf b gy nq nl l nm nn">&lt;div&gt; <br/>    &lt;input type="submit" name="btn_upload_profile_pic" value="Upload" /&gt; <br/>&lt;/div&gt;</span><span id="3214" class="mg la in mf b gy nq nl l nm nn">&lt;/form&gt;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/627f5f98cd28be1318efa3622cca379c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Tm_TqZ9vk54nckLSy_GTw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">File uploaded in folder /uploads</figcaption></figure><h2 id="9000" class="mg la in bd lb mh mi dn lf mj mk dp lj jv ml mm ln jz mn mo lr kd mp mq lv mr bi translated">密码</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="6518" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">谢谢大家！</p><p id="b074" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">快乐编码:)</p><p id="311f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ky" href="https://pprathameshmore.github.io/#" rel="noopener ugc nofollow" target="_blank">https://pprathamesmore . github . io</a>/</p></div></div>    
</body>
</html>