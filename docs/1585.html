<html>
<head>
<title>Add Basic Authentication to an Express App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向快速应用添加基本身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-basic-authentication-to-an-express-app-9536f5095e88?source=collection_archive---------1-----------------------#2020-04-04">https://javascript.plainenglish.io/add-basic-authentication-to-an-express-app-9536f5095e88?source=collection_archive---------1-----------------------#2020-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9f762fcdf491c5aa4e3e122cb2652f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JfjCVhiowZHtxbJ6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@patrickbrinksma?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Patrick Brinksma</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e3d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要向Express应用程序添加基本的身份验证功能，我们可以使用<code class="fe lb lc ld le b">express-basic-auth</code>包。</p><p id="1074" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了它，我们可以在我们的受保护路由的URL中检查给定的用户名和密码。</p><p id="4ef2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何使用它。</p><h1 id="9bdc" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">如何安装</h1><p id="ed0d" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lb lc ld le b">express-basic-auth</code>以节点包的形式提供，我们可以通过运行以下命令来安装它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="06a5" class="mq lg iq le b gy mr ms l mt mu">npm install express-basic-auth</span></pre><h1 id="4afe" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">基本用法</h1><p id="9908" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以如下使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="b2a6" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const basicAuth = require('express-basic-auth')<br/>const app = express();</span><span id="94e6" class="mq lg iq le b gy mv ms l mt mu">app.use(basicAuth({<br/>    users: { 'admin': 'supersecret' }<br/>}))</span><span id="d825" class="mq lg iq le b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send('authorized');<br/>});</span><span id="f6ee" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="64d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们在应用中包含了来自<code class="fe lb lc ld le b">express-basic-auth</code>的<code class="fe lb lc ld le b">basicAuth</code>中间件。</p><p id="3bbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用一个具有<code class="fe lb lc ld le b">users</code>属性的对象调用<code class="fe lb lc ld le b">app.use</code>，用户名作为键，相应的密码作为值。</p><p id="efc8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，如果我们向一个URL发出GET请求，比如:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="acf8" class="mq lg iq le b gy mr ms l mt mu">https://admin:supersecret@ThistleDarkExponents--five-nine.repl.co</span></pre><p id="edd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将得到<code class="fe lb lc ld le b">authorized</code>响应，因为用户名和密码与我们在应用程序的对象中列出的相匹配。</p><p id="a2ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们将得到一个401响应和一个可配置的主体，默认情况下是空的。</p><h1 id="14ec" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">自定义授权</h1><p id="2bf9" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们也可以传入我们自己的<code class="fe lb lc ld le b">authorizer </code>函数来检查我们想要的凭证。</p><p id="54a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当比较用户输入和sercet凭证时，我们不应该使用带有<code class="fe lb lc ld le b">==</code>或<code class="fe lb lc ld le b">===</code>的标准字符串比较，因为这将使我们的应用程序容易受到计时攻击。</p><p id="662d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计时攻击是一种旁道攻击，攻击者试图通过分析运行加密算法所需的时间来危害系统。</p><p id="5dfd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该使用软件包提供的<code class="fe lb lc ld le b">safeCompare</code>方法。</p><p id="1d84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，出于同样的原因，我们应该使用按位逻辑运算符而不是标准运算符。</p><p id="e022" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以使用以下内容:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="b4d4" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const basicAuth = require('express-basic-auth')<br/>const app = express();</span><span id="e76f" class="mq lg iq le b gy mv ms l mt mu">app.use(basicAuth({<br/>  authorizer: (username, password) =&gt; {<br/>    const userMatches = basicAuth.safeCompare(username, 'admin')<br/>    const passwordMatches = basicAuth.safeCompare(password, 'supersecret')<br/>    return userMatches &amp; passwordMatches<br/>  }<br/>}))</span><span id="b87f" class="mq lg iq le b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send('authorized');<br/>});</span><span id="7f7f" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="8f6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有一个函数，它调用<code class="fe lb lc ld le b">safeCompare</code>来分别匹配用户名和密码，然后使用and位运算符来组合2，以确保两者都是<code class="fe lb lc ld le b">true</code>。</p><h1 id="bf75" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">异步授权</h1><p id="2c40" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以将<code class="fe lb lc ld le b">authorizeAsync</code>选项设置为<code class="fe lb lc ld le b">true</code>，并将带有<code class="fe lb lc ld le b">cb</code>参数的回调函数设置为<code class="fe lb lc ld le b">authorizer</code>函数来异步检查凭证:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="ad85" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const basicAuth = require('express-basic-auth')<br/>const app = express();</span><span id="6543" class="mq lg iq le b gy mv ms l mt mu">app.use(basicAuth({<br/>  authorizer: (username, password, cb) =&gt; {<br/>    const userMatches = basicAuth.safeCompare(username, 'admin')<br/>    const passwordMatches = basicAuth.safeCompare(password, 'supersecret')<br/>    if (userMatches &amp; passwordMatches)<br/>      return cb(null, true)<br/>    else<br/>      return cb(null, false)<br/>  },<br/>  authorizeAsync: true,<br/>}))</span><span id="8aba" class="mq lg iq le b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send('authorized');<br/>});</span><span id="dc4d" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="fe37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们返回<code class="fe lb lc ld le b">cb</code>回调调用，而不是在我们的<code class="fe lb lc ld le b">authorizer</code>函数中直接返回结果。</p><h1 id="2b4b" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">未经授权的响应主体</h1><p id="c2f9" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以将<code class="fe lb lc ld le b">unauthorizedResponse</code>属性设置为一个函数，该函数返回一个我们希望在凭证检查失败时显示的响应。</p><p id="3699" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="841e" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const basicAuth = require('express-basic-auth')<br/>const app = express();<br/>app.use(basicAuth({<br/>  users: { 'admin': 'supersecret' },<br/>  unauthorizedResponse: (req) =&gt; {<br/>    return `unauthorized. ip: ${req.ip}`<br/>  }<br/>}))<br/>app.get('/', (req, res) =&gt; {<br/>  res.send('authorized');<br/>});<br/>app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="1887" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回类似这样的内容:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="15e2" class="mq lg iq le b gy mr ms l mt mu">unauthorized. ip: ::ffff:172.18.0.1</span></pre><p id="e1e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当基本身份验证失败时。</p><p id="8d0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe lb lc ld le b">unauthorizedResponse</code>设置为的函数接受Express request对象，因此我们可以在函数中使用该对象的任何属性。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/2fd579ee32a6d98c5d62a6aa94fa36c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iTSraNzbF9FOsocv"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@dankapeter?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Danka &amp; Peter</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="b72b" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">挑战</h1><p id="8cb9" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以让浏览器显示一个弹出窗口，这样用户可以通过向对象添加一个<code class="fe lb lc ld le b">challenge: true</code>选项来输入身份验证凭证。</p><p id="47af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们设置了<code class="fe lb lc ld le b">realm</code>来标识要进行身份验证的系统，并可用于保存质询的凭证，方法是传递一个静态或函数，该函数传递请求对象并预期返回质询:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="f6b8" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const basicAuth = require('express-basic-auth')<br/>const app = express();</span><span id="4ff6" class="mq lg iq le b gy mv ms l mt mu">app.use(basicAuth({<br/>  users: { 'admin': 'supersecret' },<br/>  challenge: true,<br/>  realm: 'foo',<br/>}))</span><span id="d322" class="mq lg iq le b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send('authorized');<br/>});</span><span id="2c2c" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="dfff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了上面的代码，当我们加载<code class="fe lb lc ld le b">/</code>页面时，我们应该会得到一个对话框来输入用户名和密码。</p><h1 id="3603" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="edf7" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">使用<code class="fe lb lc ld le b">express-basic-auth</code>包可以很容易地将基本认证添加到Express应用中。</p><p id="02fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它允许我们添加有效凭证的列表，或者使用一个函数来验证凭证。</p><p id="48bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以让用户输入用户名和密码，并在用户未经授权时显示自定义内容。</p><h2 id="36ff" class="mq lg iq bd lh mx my dn ll mz na dp lp ko nb nc lt ks nd ne lx kw nf ng mb nh bi translated"><strong class="ak">用简单的英语写的JavaScript的注释:</strong></h2><p id="dd93" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，用你的中级用户名发邮件到<a class="ae kc" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>给我们，我们会把你添加为作者。</p></div></div>    
</body>
</html>