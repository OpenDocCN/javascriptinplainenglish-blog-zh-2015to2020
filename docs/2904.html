<html>
<head>
<title>How To Connect MySQL And Auth To A Next.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将MySQL和Auth连接到Next.js应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/connect-mysql-and-authentication-on-next-js-761d12340e4f?source=collection_archive---------0-----------------------#2020-08-04">https://javascript.plainenglish.io/connect-mysql-and-authentication-on-next-js-761d12340e4f?source=collection_archive---------0-----------------------#2020-08-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="7053" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天，我们将把Next.js应用程序连接到MySQL数据库，并开发一个认证特性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/b683096b09039fa649ba0a07e90a57a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*Dhu6-_twNPmjH0vA0puPIA.png"/></div></figure><h1 id="d9c3" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">1.设置MySQL数据库</h1><p id="cc3b" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">首先，我会准备MySQL数据库进行连接。</p><p id="ed24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你已经安装了，你可以跳过这一步。只需在MySQL中创建一个名为“users”的数据库和表。</p><p id="4b90" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们安装“mysql”。我使用了“家酿”软件包管理器。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="ee51" class="ly kr in lu b gy lz ma l mb mc">$ brew install mysql</span></pre><p id="28c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">没有必要使用这种方法。根据操作系统或您的偏好，您可以使用不同的样式。</p><p id="75cc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装后，创建一个数据库和“用户”表。我用的是‘MySQL work bench’。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/530b52b4115485b619df10aa6c6d40b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIrswZEra_1aAWKi5f7Phg.png"/></div></div></figure></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="be6a" class="kq kr in bd ks kt mp kv kw kx mq kz la lb mr ld le lf ms lh li lj mt ll lm ln bi translated">2.克隆next.js身份验证示例</h1><p id="168f" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">如果数据库准备好了，我们需要一个next.js应用程序来连接数据库。</p><p id="f1ec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它还必须有一些关于认证的功能。但是从零开始开发认证特性需要太多的努力。这不是这篇文章的主要目的。</p><p id="0443" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们将使用next.js的官方示例“API-routes-Apollo-server-and-client-auth”。我们可以通过“npx”命令或“yarn”来克隆这个项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mu"><img src="../Images/207107fd4ece3931ac679a728fc8164f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jccb54-e5QtmUDEw8E8O3w.png"/></div></div></figure><p id="e183" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们看看' signup.js '文件中的注册函数组件。它接收来自用户的电子邮件和密码，并在提交时调用“handleSubmit”函数。</p><p id="15c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当提交事件发生时,' handleSubmit '函数请求' signUp '突变。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3150cbc964d02d739db9ae26938a3c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*floujofRwqHK19HGnYVHDw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">signup.js</figcaption></figure><p id="86e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果出现注册突变，解析器会创建一个新用户，因为该用户的密码在“apollo/resolvers”和“lib/user.js”中加密。</p><p id="5e14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">与此功能相同，“登录”和“注销”功能已经完成。它还支持会话管理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6e2e2e8becd4472397a9be021f1a539f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*Lmrfx2KeIPx12FFirQJN0A.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">resolvers.js</figcaption></figure></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h1 id="1fd5" class="kq kr in bd ks kt mp kv kw kx mq kz la lb mr ld le lf ms lh li lj mt ll lm ln bi translated">3.将下一台服务器连接到数据库</h1><p id="253a" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">现在要连接到MySQL，我们需要安装一个连接管理器。我们使用了“无服务器-mysql”。它是“mysql”模块的包装器。它支持“异步/等待”和监控连接。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="b8ef" class="ly kr in lu b gy lz ma l mb mc">$ yarn add serverless-mysql</span></pre><p id="4bbc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并创建一个“lib/db.js”文件。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="dd2f" class="ly kr in lu b gy lz ma l mb mc">// db.js</span><span id="5484" class="ly kr in lu b gy nb ma l mb mc">import mysql from 'serverless-mysql';</span><span id="b4cd" class="ly kr in lu b gy nb ma l mb mc">const db = mysql({</span><span id="b0e4" class="ly kr in lu b gy nb ma l mb mc">  config: {</span><span id="1d17" class="ly kr in lu b gy nb ma l mb mc">    host: process.env.MYSQL_HOST,</span><span id="7e14" class="ly kr in lu b gy nb ma l mb mc">    port: process.env.MYSQL_PORT,</span><span id="2c0d" class="ly kr in lu b gy nb ma l mb mc">    database: process.env.MYSQL_DATABASE,</span><span id="3bcc" class="ly kr in lu b gy nb ma l mb mc">    user: process.env.MYSQL_USER,</span><span id="f9df" class="ly kr in lu b gy nb ma l mb mc">    password: process.env.MYSQL_PASSWORD</span><span id="89c6" class="ly kr in lu b gy nb ma l mb mc">  }</span><span id="47e1" class="ly kr in lu b gy nb ma l mb mc">});</span><span id="6231" class="ly kr in lu b gy nb ma l mb mc">export default async function excuteQuery({ query, values }) {</span><span id="db0a" class="ly kr in lu b gy nb ma l mb mc">  try {</span><span id="9105" class="ly kr in lu b gy nb ma l mb mc">    const results = await db.query(query, values);</span><span id="9cd4" class="ly kr in lu b gy nb ma l mb mc">    await db.end();</span><span id="62b0" class="ly kr in lu b gy nb ma l mb mc">    return results;</span><span id="35e6" class="ly kr in lu b gy nb ma l mb mc">  } catch (error) {</span><span id="e4f4" class="ly kr in lu b gy nb ma l mb mc">    return { error };</span><span id="b85d" class="ly kr in lu b gy nb ma l mb mc">  }</span><span id="6cb3" class="ly kr in lu b gy nb ma l mb mc">}</span></pre><p id="3b7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要运行这段代码，我们必须设置env变量。如果你用过webpack，你会很熟悉。</p><p id="b475" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以通过制作' next.config.js '文件来定义这些变量。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="0e51" class="ly kr in lu b gy lz ma l mb mc">// next.config.js<br/></span><span id="1bd2" class="ly kr in lu b gy nb ma l mb mc">module.exports = {</span><span id="ca0f" class="ly kr in lu b gy nb ma l mb mc">  env: {</span><span id="6c68" class="ly kr in lu b gy nb ma l mb mc">    'MYSQL_HOST': '127.0.0.1',</span><span id="f76b" class="ly kr in lu b gy nb ma l mb mc">    'MYSQL_PORT': '3306',</span><span id="a1d9" class="ly kr in lu b gy nb ma l mb mc">    'MYSQL_DATABASE': {database_name},</span><span id="812b" class="ly kr in lu b gy nb ma l mb mc">    'MYSQL_USER': {user_name},</span><span id="04f8" class="ly kr in lu b gy nb ma l mb mc">    'MYSQL_PASSWORD': {user_password},</span><span id="2b5e" class="ly kr in lu b gy nb ma l mb mc">  }</span><span id="866a" class="ly kr in lu b gy nb ma l mb mc">}</span></pre><p id="2017" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，检查应用程序是否连接到数据库。从db.js导入' excuteQuery '并在' createUser '函数中调用它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">lib/user.js</figcaption></figure><p id="8afe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后输入“http://localhost:3000/signup”。如果您记下新用户的电子邮件和密码并提交，您可以看到新用户是在MySQL数据库中创建的。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="009e" class="ly kr in lu b gy lz ma l mb mc">mysql&gt; SELECT * FROM users;</span></pre><p id="4b85" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“签到”功能也不太难。我们只是使用“选择”查询，而不是“用户”常量变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ne"><img src="../Images/750cd44f24ae19a86610461efd5d3df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T9iS-i29fG8DW8dn1DOOSA.png"/></div></div></figure><p id="ba3f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以成功地使用身份验证功能了。</p><h2 id="b623" class="ly kr in bd ks nf ng dn kw nh ni dp la jv nj nk le jz nl nm li kd nn no lm np bi translated"><a class="ae nq" href="https://github.com/wkddngus5/nextjs-apollo-tutorial/tree/step5/connect-to-mysql" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> <em class="nr"> Github源代码</em> </strong> </a></h2></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="8e52" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ns">参。</em>T9】</strong></p><div class="nt nu gp gr nv nw"><a href="https://vercel.com/guides/deploying-next-and-mysql-with-vercel" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">使用MySQL数据库创建一个Next.js应用程序，该数据库使用Vercel - Vercel指南进行构建和部署</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">在本指南中，我们将带领您使用最流行的开源数据库创建和部署Next.js应用程序…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">vercel.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ko nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://nextjs.org/docs/api-reference/next.config.js/environment-variables" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">环境变量| Next.js</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">自从Next.js 9.4发布以来，我们现在有了更直观、更符合人体工程学的体验来添加环境…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">nextjs.org</p></div></div><div class="of l"><div class="ol l oh oi oj of ok ko nw"/></div></div></a></div></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><h2 id="8fc2" class="ly kr in bd ks nf ng dn kw nh ni dp la jv nj nk le jz nl nm li kd nn no lm np bi translated">进一步阅读</h2><div class="nt nu gp gr nv nw"><a rel="noopener  ugc nofollow" target="_blank" href="/i-built-a-serverless-live-chat-app-with-next-js-fauna-and-wundergraph-for-graphql-live-queries-b671d9646f6"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">我用Next.js、Fauna和WunderGraph为GraphQL实时查询构建了一个无服务器的实时聊天应用程序</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">使用无服务器技术创建可扩展的实时聊天应用程序的分步指南，来自…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="of l"><div class="om l oh oi oj of ok ko nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://plainenglish.io/blog/how-to-automate-aws-iam-best-practices-using-the-principle-of-least-privilege" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">如何使用最小特权原则自动化AWS IAM最佳实践</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">云是一项神奇的技术，可用于构建可扩展的应用程序，轻松提供对弹性计算的访问…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">简明英语. io</p></div></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://plainenglish.io/blog/which-database-should-you-use-for-your-next-js-app" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">Next.js应用程序应该使用什么数据库？</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">如果你在2022年要开发一个全栈应用，选择流行的Next.js会让你有95%的机会…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">简明英语. io</p></div></div><div class="of l"><div class="on l oh oi oj of ok ko nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://plainenglish.io/blog/how-to-build-a-graphql-ecommerce-app-from-scratch" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">如何从头开始构建一个GraphQL电子商务应用程序</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">这就是你要建造的东西！埃森哲的一项调查(19个国家的20，000多名消费者)发现，47%的人…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">简明英语. io</p></div></div><div class="of l"><div class="oo l oh oi oj of ok ko nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://blog.bitsrc.io/next-js-13-what-do-the-new-bleeding-edge-features-actually-do-d3e5fd418563" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">Next.js 13:新的前沿特性实际上是做什么的？</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">你听说过Next.js 13是一个游戏改变者，但是为什么？让我们看看有哪些新功能，有哪些变化，以及它们…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">blog.bitsrc.io</p></div></div><div class="of l"><div class="op l oh oi oj of ok ko nw"/></div></div></a></div></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="0288" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ns">更多内容请看</em><a class="ae nq" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ns">plain English . io</em></strong></a><em class="ns">。报名参加我们的</em> <a class="ae nq" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ns">免费周报</em> </strong> </a> <em class="ns">。关注我们关于</em><a class="ae nq" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ns">Twitter</em></strong></a><a class="ae nq" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ns">LinkedIn</em></strong></a><em class="ns"/><a class="ae nq" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ns">YouTube</em></strong></a><em class="ns"/><a class="ae nq" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ns">不和</em> </strong> </a> <em class="ns">。对增长黑客感兴趣？检查</em> <a class="ae nq" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ns">电路</em> </strong> </a> <em class="ns">。</em></p></div></div>    
</body>
</html>