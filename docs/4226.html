<html>
<head>
<title>Making a PWA with literally 1 line of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一行代码制作PWA</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-a-pwa-with-literally-1-line-of-code-106a0e9405c8?source=collection_archive---------4-----------------------#2020-11-26">https://javascript.plainenglish.io/making-a-pwa-with-literally-1-line-of-code-106a0e9405c8?source=collection_archive---------4-----------------------#2020-11-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1a9b5921a5f8974e755afe79c0a06ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSnjK0-k11MCgiB3n-ia1Q.jpeg"/></div></div></figure><p id="7853" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就在2020年变成一场全球闹剧之前，我召集了几个朋友，我们一起想出了一个简单的小应用程序的想法，我们认为它会有所帮助。我们的应用程序被谦逊地称为冠状病毒应用程序，最终有超过1500万人在使用它，我相信这是有史以来使用最广泛的冠状病毒应用程序之一。</p><p id="c848" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我喜欢网络。我喜欢艾滋。有什么不喜欢的，真的？使用PWA，您只需要管理一个代码库。你的应用在任何地方都有效。而且你也不用把自己辛辛苦苦赚来的30%的收入分给苹果和谷歌。</p><p id="41a0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是PWAs真的很奇怪。与此同时,<em class="ku">非常容易</em>开始，而<em class="ku">非常痛苦</em>一直进行下去。</p><h2 id="2e33" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">PWA二分法</h2><p id="fed6" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">创建一个JSON文件，命名为manifest.json，填写Google 推荐的字段<a class="ae kt" href="https://web.dev/add-manifest/" rel="noopener ugc nofollow" target="_blank">。然后创建一个JavaScript文件，将其命名为service-worker.js，</a><a class="ae kt" href="https://developers.google.com/web/fundamentals/primers/service-workers/registration" rel="noopener ugc nofollow" target="_blank">从您的客户端代码注册它</a>。你完了。你有一个PWA，它有点像单词。你花了几个小时去弄清楚所有的事情，花了30分钟去写代码。还不错。</p><p id="a977" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从这里开始，事情开始走下坡路。</p><p id="5e9b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设您想在代码中添加一个按钮，让用户在他们的设备上安装您的应用程序。作为参考，下面是<a class="ae kt" href="https://web.dev/customize-install/" rel="noopener ugc nofollow" target="_blank">谷歌建议如何做</a>。</p><blockquote class="lt lu lv"><p id="0cfa" class="jv jw ku jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">1.监听<code class="fe lz ma mb mc b">beforeinstallprompt</code>事件。</p><p id="d9dc" class="jv jw ku jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">2.保存<code class="fe lz ma mb mc b">beforeinstallprompt</code>事件，这样它可以在以后用来触发安装流程。</p><p id="4bd4" class="jv jw ku jx b jy jz ka kb kc kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ks ig bi translated">3.提醒用户您的PWA是可安装的，并提供一个按钮或其他元素来启动应用内安装流程。</p></blockquote><p id="bf11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感觉有点不舒服。但是很简单。</p><p id="ad27" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除了当你做了那件事，你已经完成了2%的工作。</p><p id="382f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Windows/Chrome上，<code class="fe lz ma mb mc b">beforeinstallprompt</code>有时也会在每个会话中发出几次。有时在应用程序安装完成后<em class="ku">。也就是说，依靠该事件，你可以要求用户安装应用程序…在他们安装之后。在iOS/Safari上，它根本不会被触发。所以你甚至没有机会告诉你的用户你的应用是可以安装的。</em></p><p id="1eb3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">甚至在Chrome上——当<code class="fe lz ma mb mc b">beforeinstallprompt</code>被触发时，意味着应用程序是可安装的。但是当它……<em class="ku">没有被解雇</em>又意味着什么呢？是不是意味着app不能安装了？还是已经安装了应用程序？在我等待<code class="fe lz ma mb mc b">beforeinstallprompt</code>到<em class="ku">触发</em>或者<em class="ku">不触发的时候，我应该怎么处理我的安装按钮呢？</em></p><p id="8f64" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者我们也可以谈谈<code class="fe lz ma mb mc b">appinstalled</code>事件。如果不是因为这个事件在iOS/Safari或Android/Samsung Internet上根本不会被触发，这真的很有用。安装应用程序后，您可能想要隐藏或禁用安装按钮。当你甚至不确定应用程序是否已经安装时，你该怎么做呢？</p><h2 id="21ed" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">这有点糟糕，但这不是任何人的错</h2><p id="af00" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">当谈到PWAs时，Google是参考。因此，如果您自己创建了一个，您可能会阅读他们的文档。这很好，除了它真的只对Chrome的有好处。</p><p id="dbde" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当然，这是公平的。你不能指望谷歌为不属于他们的浏览器写文档。</p><p id="9e8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">其实PWAs最大的优点也是它最大的弱点。由于应用程序生活在开放的网络上，没有人真正控制格式。当没有人控制时，事情往往会变得一团糟。</p><h2 id="1ccf" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">史上最无聊的轮子</h2><p id="574d" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">让冠状病毒应用程序成为PWA感觉非常笨拙。这么多边缘案件要处理。这么多奇怪的代码。同一个logo要创作这么多版本。</p><p id="d888" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">哦，是的，当我改变我的标志时会发生什么？我应该记住它在我的HTML文档的meta标记中，但也在我的JavaScript中的某个地方被引用，以动态创建iOS需要的资产吗？两年后我不会记得这件事。</p><p id="94cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在网络上……事情在发展。相当快。因此，如果明天苹果、三星或谷歌做出改变，我必须1-想办法确保我意识到这一点，2-相应地重写我的代码。</p><p id="737c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在构建冠状病毒应用程序时，我记得我经常想:<em class="ku">为什么我必须做所有这些工作？</em></p><p id="5f7a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我的PWA本质上只有4个变量:一个名称、一个域名、一种颜色和一个标志(我在这里简化了一点，但是你明白了)。我想告诉某人我的4个变量是什么。并且让那个<em class="ku">某人</em>弄清楚<em class="ku">其余的</em>。</p><p id="103a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">剩下的工作就是编写代码来解决一些无聊的问题，这些问题一定是其他地方的其他开发人员已经解决了的——而且很可能是以完全相同的方式。</p><p id="999c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">女士们先生们，这就是所谓的<em class="ku">重新发明轮子</em>。虽然重新发明一些轮子来了解事物的工作原理很有趣，但这个特殊的轮子一点也不有趣。也没有教会你任何有价值的东西。</p><h2 id="fb1a" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">这让我很生气。</h2><p id="f0f9" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">所以既然我下定决心要解决这个问题，我想我也可以试着为其他人解决这个问题。这正是我对进步人士T2所做的。</p><p id="35c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用Progressier，构建PWA正是我上面描述的内容。你告诉平台你的4个变量。就是这样。该软件在正确的位置以正确的大小生成正确的资产。当Google或Apple做出更改时，我们会更新我们的代码，而不是您的代码，因此您的网站上总是有最新的PWA实现。再见，维修。</p><p id="2566" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们回到上面的安装按钮例子。以下是如何使用Progressier的方法:</p><p id="3767" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lz ma mb mc b">&lt;button class="progressier-install-button"&gt;&lt;/button&gt;</code></p><p id="8059" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你不必处理用户在iOS上时发生的事情。或者其设备与PWAs不兼容。或者已经安装了您的应用程序。别管那些废话了。Progressier为您处理此事。就这样，你把<em class="ku">两周的工作</em>变成了<em class="ku"> 25秒的工作</em>。</p><p id="cec2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这只是Progressier所做的一个例子。它还可以自动跟踪应用程序的安装，让您设置规则来决定何时推广您的PWA安装，生成所有正确的徽标，等等。这还只是第一版。推送通知、离线、缓存策略、自动化应用商店提交——路线图中有很多非常酷的东西。</p><h2 id="f08a" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">准备好了吗？</h2><p id="3d1d" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">艾滋病人的美妙之处在于他们在任何地方都能工作。PWAs丑陋的一面是，实现这一点需要付出巨大的努力，而且大多没有记录在案。</p><p id="80ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以帮你自己一个忙，<a class="ae kt" href="https://progressier.com/signup" rel="noopener ugc nofollow" target="_blank">注册一个Progressier账户</a>，用它替换你的硬编码PWA实现，让我来替你处理那些无聊的事情。它只需要一行代码。占用你两分钟时间。还有你的0美元。</p><p id="712a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kt" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">订阅我们的YouTube频道</strong> </a> <strong class="jx io">获取更多类似内容！</strong></p></div></div>    
</body>
</html>