<html>
<head>
<title>How to Write a Cloud Function that Texts you Dad Jokes 😁</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写一个云函数来给你爸爸发笑话😁</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-write-a-cloud-function-that-texts-you-dad-jokes-a8e1f2a2dcdc?source=collection_archive---------6-----------------------#2020-06-27">https://javascript.plainenglish.io/how-to-write-a-cloud-function-that-texts-you-dad-jokes-a8e1f2a2dcdc?source=collection_archive---------6-----------------------#2020-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f42bd3f65b17c4fedeeabd7f33924c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eFgqgVd3DdI521kC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@sejadisruptivo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">DISRUPTIVO</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ab6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你喜欢爸爸的笑话吗？如果你每天都能收到一条关于爸爸的笑话短信，那不是很好吗？如果您的回答是肯定的，那么您一定会喜欢构建这个简单的项目！我们将编写并部署一个云功能，每天给你发一条随机的老爸笑话短信。</p><p id="8e76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们将使用Firebase云函数以及Twilio API来发送文本。如果您不熟悉这些工具，不要担心！我们将一步一步地讲解所有内容，以确保您理解所有内容。如果你被卡住了，可以在这里随意参考我完成的代码<a class="ae kc" href="https://github.com/wilstaley/daily-dad-jokes" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="dbf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，打开一个终端，导航到你想存储这个项目的地方，输入<code class="fe lb lc ld le b">mkdir daily-jokes</code>创建一个名为“每日笑话”的新目录。然后，您可以用cd进入这个新目录。</p><h2 id="03dc" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">正在初始化项目</h2><p id="6e7d" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">现在，在我们进入代码之前，让我们初始化一个Firebase项目。转到firebase.google.com的<a class="ae kc" href="http://firebase.google.com" rel="noopener ugc nofollow" target="_blank">然后点击右上角的‘转到控制台’。如果你还没有一个Firebase帐户，你可能需要创建一个，但是这应该很简单。一旦你在Firebase控制台上完成了，只要按照说明并阅读这篇文章就可以了。</a></p><p id="4437" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">进入控制台后，您应该会看到一个大的“ole”按钮来添加一个新项目，如下所示:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/28596b389d37907de277935715de901b.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*cWg1AJ4y5p_96KD0YESM-w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Firebase Add Project</figcaption></figure><p id="48a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">继续点击那个坏男孩！然后会提示您为新项目命名。我把我的命名为“每日老爸笑话”，但是你可以随意命名你的。然后你可以点击“继续”来启用谷歌分析，选择你想使用的谷歌账户，最后点击“创建项目”！</p><p id="d389" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将需要一些时间来初始化您的新项目，但一旦完成所有设置，您可以单击“继续”转到您的项目的概述页面。</p><p id="ea87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好的多基。现在我们已经在Firebase中初始化了一个项目，并准备开始破解一些代码。回到你的终点站。我们将使用Firebase CLI(命令行界面)来部署我们的功能！要安装CLI，请输入以下命令:<code class="fe lb lc ld le b">npm install -g firebase-tools</code></p><p id="fc13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，您需要安装<a class="ae kc" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>来运行这个命令😉。</p><p id="4d9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦安装完成，你就可以运行<code class="fe lb lc ld le b">firebase login</code>来登录你的谷歌账户。为了确保您已经正确连接了您的帐户，您可以运行<code class="fe lb lc ld le b">firebase projects:list</code>来显示您帐户中的所有项目。您应该在那里看到至少一个项目:我们刚刚创建的“日常爸爸笑话”项目！</p><p id="adbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们将运行<code class="fe lb lc ld le b">firebase init</code>在本地初始化项目。一旦你这样做了，它会问你你想在这个项目中使用哪些Firebase特性。对于这个项目，我们将只使用功能特性。您可以使用向下箭头导航到函数选项，然后按空格键选择函数，然后按enter确认您的选择。接下来，它会要求我们将这个目录与一个Firebase项目关联起来。因为我们已经使用Firebase在线控制台初始化了一个项目，所以我们可以选择“使用现有项目”。从这里，我们可以选择我们之前创建的日常爸爸笑话项目！然后我们被要求选择一种语言来编写我们的函数。我将在本教程中使用JavaScript。然后我们被问到是否要使用eslint来设计我们的代码。我将选择是，因为为什么不呢？最后，系统会询问我们是否愿意继续使用npm安装依赖项。我将选择yes，在安装完依赖项之后，我们已经初始化了Firebase项目！！！</p><p id="8684" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恭喜你！作为对本教程到此为止的奖励，这里有一个爸爸的笑话…</p><blockquote class="mi mj mk"><p id="fe58" class="kd ke ml kf b kg kh ki kj kk kl km kn mm kp kq kr mn kt ku kv mo kx ky kz la ij bi translated">我不会和velcro一起买任何东西。这完全是敲竹杠。</p></blockquote><p id="169a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在继续之前，我们还需要解决另一个大问题…</p><p id="96ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，Firebase的免费Spark计划不允许出站联网。但是我们需要这种用Twilio api发送文本的能力。所以在我们继续之前，我们需要回到你的浏览器，在我们项目的页面内升级到Blaze计划。您可以通过选择左侧面板底部的“修改”来完成此操作:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9981a8db956949ba4ff135160d950094.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*qvIUK2B9vDUOOXSGkRv4rQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Upgraded to Blaze Plan</figcaption></figure><p id="afd0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们完成了这些，我们就完成了所有的项目设置。</p><h2 id="a686" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">编写和部署云函数</h2><p id="2026" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">现在我们开始任何项目的有趣部分:编写代码！继续在您选择的文本编辑器中打开项目文件夹。如您所见，Firebase向我们的项目添加了一些初始文件。在“函数”文件夹中，你会找到一个<strong class="kf ir"> index.js </strong>文件。这是我们将添加云功能的地方。</p><p id="434e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要做的就是用我们的函数替换<strong class="kf ir"> index.js </strong>的内容。首先，让我们写一个函数来获取并返回一个爸爸的笑话。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/2ea8d0ae496287fb3be5e14400a9a2e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-8SipgEpAjgk706eE_lJw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Initial setup of cloud function</figcaption></figure><p id="212f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从这段代码开始。首先，我们需要火基函数。这是Firebase SDK创建云函数和设置触发器所需要的。接下来我们有<code class="fe lb lc ld le b">exports.sendDadJoke</code>。无论您在“导出”后添加什么，都将是您的云功能的名称。在这种情况下，我选择将我的命名为“<code class="fe lb lc ld le b">sendDadJoke</code>”，但是您可以将您的命名为其他名称。</p><p id="b497" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们有<code class="fe lb lc ld le b">functions.https.onRequest</code>。这是一种告诉Firebase无论何时向与该函数相关联的端点发出HTTP请求，我们都要触发该函数的方式。现在不要太担心这个…一旦我们实际部署了这个功能，我们会得到一个端点并进行测试。</p><p id="b125" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ml">旁注:你可能想知道为什么我们不使用</em> <code class="fe lb lc ld le b"><em class="ml">functions.pubsub.schedule</em></code> <em class="ml">让我们的云功能每天运行一次。原因是因为，我不想让这个功能花费我任何钱！根据文档，每个云调度程序作业每月花费0.10美元。虽然这不是很多钱，但我将向您展示一种免费设置cron-job的方法。如果您想了解更多关于如何使用这种方法调度云功能的信息，您可以阅读文档</em> <a class="ae kc" href="https://firebase.google.com/docs/functions/schedule-functions" rel="noopener ugc nofollow" target="_blank"> <em class="ml">此处</em> </a> <em class="ml">。</em></p><p id="289b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于这个设置，最后要注意的是回调函数。它将请求(req)和响应(res)作为参数。这也需要是一个异步函数，因为我们将进行一个api调用来获取一个爸爸笑话！</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><p id="f655" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了从api中获取一个爸爸笑话，我们需要axios模块。所以回到你的终端，cd到“功能”文件夹(节点模块所在的位置)并运行<code class="fe lb lc ld le b">npm install axios</code>。这将把axios作为一个依赖项添加到我们的项目中，我们可以在我们的云功能中使用它。</p><p id="a4d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以更新函数来获取并返回一个爸爸的笑话:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/a527fb487ea3888b4b3f5375240f1e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EUXQkse10VCfqLN6XZr8hw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Fetching and returning a dad joke</figcaption></figure><p id="0c7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在这里做的第一件事是需要axios。然后在回调内部，我们使用axios从<a class="ae kc" href="https://icanhazdadjoke.com" rel="noopener ugc nofollow" target="_blank">icanhazdaddjoke</a>API获得一个笑话。我们在请求中使用一个头，告诉api我们想要接收json数据。最后，我们从api的响应中提取笑话，并使用<code class="fe lb lc ld le b">res.send(joke)</code>将其发送回去。</p><p id="000e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太棒了。这看起来很棒。现在我们应该试着部署我们所拥有的，看看我们是否能得到一个爸爸的笑话。要部署我们的功能，请转到终端并运行<code class="fe lb lc ld le b">firebase deploy --only functions</code>。部署需要一些时间，但是一旦完成，您就可以在Firebase控制台中看到该功能。</p><p id="00c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从Firebase控制台中，选择您的daily dad jokes项目，然后在左栏中选择functions选项卡。从这里，您应该能够看到与您的项目相关的所有云功能。您应该会看到您的sendDadJoke函数列在这里。在“trigger”标题下，您可以看到该函数是在请求url时触发的。将提供的url复制到一个新选项卡中，然后按enter键。你应该看到一个爸爸的笑话出现在你的浏览器里！</p><h2 id="8ac0" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">用Twilio发送短信</h2><p id="4390" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">呜哇！我们现在有了一个工作云函数，可以获取并返回一个随机的老爸笑话！现在让我们来解决发短信的问题。为此，我们将使用Twilio api。如果你没有Twilio账户，你应该在这里:)创建一个<a class="ae kc" href="https://www.twilio.com/login" rel="noopener ugc nofollow" target="_blank"/></p><p id="a3f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于Twilio的伟大之处在于，当你注册时，他们会给你一些免费的积分(我相信是15美元)，这样你就可以测试他们的服务。如果你每天只给自己发一条短信，15美元够你用很长时间了。</p><p id="55ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你创建了一个Twilio帐户，有一些事情要做，包括验证你的个人电话号码和购买一个Twilio电话号码(不要担心！Twilio电话号码只需1美元，将从您的15美元信用点数中扣除)。我将带您了解如何做这些事情，但是Twilio已经有了一些关于如何做这些事情的很好的文档。你应该继续按照<a class="ae kc" href="https://www.twilio.com/docs/usage/tutorials/how-to-use-your-free-trial-account" rel="noopener ugc nofollow" target="_blank">这里</a>列出的“开始”步骤进行。</p><p id="85d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您查看Twilio关于使用Node.js发送sms文本的文档，会看到以下内容:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/715ea582a9a49642d1423ff045f951f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*IuXJ_AuCHd4BeTYPk3B9Qg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Sending an sms text with Twilio</figcaption></figure><p id="a3de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发送一条短信只需要这么少的代码，这真是太疯狂了！你只需要用你的accountSid和authToken要求Twilio，然后调用client.messages.create()。</p><p id="f8cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以让我们将这段代码添加到我们的云函数中！首先，我们需要通过运行<code class="fe lb lc ld le b">npm install twilio</code>来安装twilio node.js模块。然后，我们可以在代码中添加以下内容:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/62d07febfa1f650da9e4e9d1ac920fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ex124NJC5hCvUDfee0GX6Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Setup for twilio</figcaption></figure><p id="b2f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们为accountSid和authToken添加了一个常量变量。您可以在twilio仪表板主页的“项目信息”部分找到这些值。现在我们可以添加函数调用来发送文本消息…</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/a8df480aff31da4d6179cdfb5ffe074b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fZU_XZdt6_B2t4rEC7qTsw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Making our cloud function send a text</figcaption></figure><p id="2f27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只需要调用<code class="fe lb lc ld le b">client.messages.create()</code>。文本的主体将是我们之前获取的爸爸笑话。“发件人”属性将保存您的Twilio电话号码，“收件人”属性将保存您的个人电话号码。我还将整个事情包装在一个try-catch块中，因此如果在此过程中出现任何失败，我们将得到一条消息，说“发送您的爸爸笑话时出错”。</p><p id="8b5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以重复一些我们以前做过的步骤，看看这是否可行。只需运行命令<code class="fe lb lc ld le b">firebase deploy --only functions</code>。然后返回Firebase控制台，将您的函数的url复制并粘贴到一个新的选项卡中。当你按下回车键，并要求该网址，你应该看到一个爸爸的笑话出现在浏览器中，但你也应该收到这个笑话作为一个文本从你的Twilio号码！</p><p id="b2b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能会注意到邮件前面有这样一句话，“来自你的Twilio试用帐户-”。如果您使用的是Twilio试用帐户，这将自动添加到您的文本中。如果你像我一样，不介意那些额外的文字，你可以继续使用那个试用帐户…否则，你需要升级你的Twilio帐户。</p><p id="c85e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任务完成:我们已经正式编写了代码，可以给我们发一个随机的爸爸笑话…但是我们可以做一些事情来使这个程序变得更好！</p><h2 id="cd0d" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">添加Firebase环境变量</h2><p id="024f" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">虽然我们的功能目前工作得很好，但它确实有一个大禁忌。我们有敏感信息，如授权令牌和电话号码就在代码中！一般来说，当我们有敏感的信息时，比如api键，我们用一种叫做环境变量的东西把它们从代码中提取出来。环境变量是一种在运行代码的机器上存储一些信息的方法，而不是存储在代码本身中。因为我们的函数实际上是在Google的服务器上运行的，每当我们向提供的url发出请求时，Firebase就为我们提供了一种设置环境变量的方法！</p><p id="91ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用cli命令<code class="fe lb lc ld le b">firebase functions:config:set</code>，我们可以设置环境变量。</p><p id="a1bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以运行<code class="fe lb lc ld le b">firebase functions:config:set someservice.key="THE API KEY" someservice.id="THE CLIENT ID"</code>来设置两个环境变量。</p><p id="db40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用命令<code class="fe lb lc ld le b">firebase functions:config:get</code>来查看我们所有的环境变量。因此，如果我们在运行上面的示例“set”命令后运行这个“get”命令，我们将看到类似这样的内容:</p><pre class="me mf mg mh gt na le nb nc aw nd bi"><span id="99fa" class="lf lg iq le b gy ne nf l ng nh">{<br/>  "someservice": {<br/>    "key":"THE API KEY",<br/>    "id":"THE CLIENT ID"<br/>  }<br/>}<!-- --> </span></pre><p id="9854" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置这些时要记住一点:键只允许小写字母。记住这一点，让我们运行以下命令，为我们的Twilio帐户sid、auth token、Twilio电话号码和您的个人电话号码设置环境变量:</p><p id="f816" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">firebase functions:config:set twilio.sid="your_account_sid" twilio.token="your_auth_token" twilio.twilionum="your_twilio_number" twilio.mynum="your_personal_phone_number"</code></p><p id="88b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">哇，好长的命令啊！为了使更改生效，我们需要再次运行<code class="fe lb lc ld le b">firebase deploy --only functions</code>。但在此之前，让我们用对环境变量的引用来替换代码中的敏感数据。我们将这样做:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/13cec41557a64506dfaa33cc09ae4602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlt_aDD1yXJC831laPZTww.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Implement firebase environment variables</figcaption></figure><p id="132b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好的，看起来不错！现在，我们可以运行我们的deploy命令，并确保一切仍按预期工作。请再次访问该网址，确保您的手机仍能收到短信。此外，我们可以运行<code class="fe lb lc ld le b">firebase functions:config:get</code>，我们应该看到我们设置的所有变量。</p><p id="e5dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能想知道，“为什么要使用环境变量？”嗯，如果你正在编写客户端代码，你绝不会希望在你的代码中有敏感信息，因为任何人都可以访问它。此外，如果你想分享你的代码(比如在GitHub上)，你不希望每个人都可以访问你的敏感信息！简而言之，设置这些环境变量有助于保护我们的安全，是一种很好的安全措施。</p><h2 id="649a" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">设置Cron作业</h2><p id="55f5" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">好吧！这是我要和大家分享的最后一步。我们将设置一个cron-job，每天向我们的url发出一次请求。这样一来，我们不用动一根手指，就能直接在手机上收到爸爸的笑话。</p><p id="b7b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有很多方法可以设置cron-job，但是为了简单起见，我将使用<a class="ae kc" href="https://cron-job.org/en/" rel="noopener ugc nofollow" target="_blank">cron-job.org</a>。这个网站让你设置一个cron-job完全免费！你确实需要创建一个账户，但是非常简单，而且还是免费的。然而，我不建议将这个网站用于生产项目，因为如果这个网站关闭，你将会失去你设置的所有cron-jobs。</p><p id="6d8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你创建了一个帐户，转到成员页面，然后cron-jobs标签，并选择'创建cron-job '。给你的工作一个头衔。我要给我的取名为“给爸爸讲笑话”。然后，对于地址，从Firebase控制台函数触发器中复制并粘贴url。然后只需选择您希望cron-job运行的频率，并选择页面底部的“创建cronjob ”!</p><p id="09c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以一开始设置它每分钟运行一次，以确认它正在工作，然后返回并将其更改为每天在你喜欢的任何时间运行！</p><h2 id="a233" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated">结束语</h2><p id="ab77" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">恭喜你！你已经成功编写了一个云程序，它会给你发一个老爸笑话。您还学习了如何使用cron-job.org在给定的时间表触发该功能！现在你可以高枕无忧，每天享受老爸的笑话了。</p><p id="759a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想玩得更开心一点，你可以在手机中添加你的Twilio电话号码作为联系人，名字是“爸爸”。这样，看起来你爸爸真的在给你发愚蠢的笑话！</p><p id="e5a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还鼓励您考虑一下使用云功能和cron-job还能做些什么。这两个简单的工具打开了一个你可以做的很酷的项目的世界！也许你想给自己发些短信，而不是爸爸的笑话…无论如何，我很想听听你对可以用这些工具构建的独特项目的想法！如果你真的做了什么，请和我分享！我很想去看看！</p><p id="63d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢这个教程，并希望看到更多类似的内容，请考虑成为https://www.patreon.com/wilstaley的一名志愿者</p><h2 id="09db" class="lf lg iq bd lh li lj dn lk ll lm dp ln ko lo lp lq ks lr ls lt kw lu lv lw lx bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="60a4" class="pw-post-body-paragraph kd ke iq kf b kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> plainenglish.io </strong> </a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到它们订阅我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>