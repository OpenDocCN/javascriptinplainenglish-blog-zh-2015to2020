<html>
<head>
<title>Login Front end &amp; Back end on React &amp; Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React &amp; Rails上登录前端和后端</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/login-front-end-back-end-on-react-rails-5a9de1d6427f?source=collection_archive---------0-----------------------#2019-09-12">https://javascript.plainenglish.io/login-front-end-back-end-on-react-rails-5a9de1d6427f?source=collection_archive---------0-----------------------#2019-09-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7b8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我要创建一个简单的登录应用程序，连接前端和后端。让我们从我们的后端开始。我将使用rails，在rails中设置了一个新的API后，我在下面加入了用户表和用户模型。确保在您的表中使用password_digest，在您的模型中使用has_secure_password。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/a5722c834b3ff8362b9b283ccc752af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*GPC6w61bkxn_l_smp1KIMg.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">Users Table</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kx"><img src="../Images/e2af28633e9d3acfb46e74c5c2b2e987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCLHthbnMl1c3MT2VwDN1w.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">User Model</figcaption></figure><p id="407d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还确保取消了BCrypt的注释，并在rails中捆绑安装。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="f108" class="lh li iq ld b gy lj lk l ll lm">gem 'bcrypt', '~&gt; 3.1.7' </span><span id="1252" class="lh li iq ld b gy ln lk l ll lm">bundle install </span></pre><p id="6207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于登录，我在我的控制器中设置了以下内容，一个自定义的路由登录。我使用了身份验证密码，只有当您取消BCrypt Gem的注释并运行软件包安装时，才能再次使用该密码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lo"><img src="../Images/f0e76d5e76da0ee042f034391c2e6797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXLWnbbDgD9nOaS3ZV2O8Q.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">Auth Controller for Login</figcaption></figure><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="9b1a" class="lh li iq ld b gy lj lk l ll lm">post '/login', to: 'auth#login'</span></pre><p id="fa54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要记住的另一条信息是，在创建用户时，一旦设置了表，一定要使用password而不是password_digest来设置用户，这样就会在后端显示密码。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="4aa9" class="lh li iq ld b gy lj lk l ll lm">User.create(username: "Hitchcock", password: "Alfred", picture: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Alfred_Hitchcock_%281955%29.JPG/440px-Alfred_Hitchcock_%281955%29.JPG")</span></pre><p id="d1d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是password_digest将密码隐藏在数据库中。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="62af" class="lh li iq ld b gy lj lk l ll lm">{<br/><strong class="ld ir">id</strong>: 3,<br/><strong class="ld ir">username</strong>: "Hitchcock",<br/><strong class="ld ir">password_digest</strong>: "$2a$12$DxQSsWq2mKHWiRQ77TrRF.GYT0CPvcUc9iJC2O/062kD99l0xRyh.",<br/><strong class="ld ir">picture</strong>: "<a class="ae lp" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Alfred_Hitchcock_%281955%29.JPG/440px-Alfred_Hitchcock_%281955%29.JPG" rel="noopener ugc nofollow" target="_blank">https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Alfred_Hitchcock_%281955%29.JPG/440px-Alfred_Hitchcock_%281955%29.JPG</a>",<br/><strong class="ld ir">created_at</strong>: "2019-09-11T16:32:01.564Z",<br/><strong class="ld ir">updated_at</strong>: "2019-09-11T16:32:01.564Z"<br/>},</span></pre><p id="248a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就结束了后端。现在我把你带到前端。首先，这是我简单的登录表单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lq"><img src="../Images/b52cd8ad05b5a5ac595afca2fc446dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0YkTisdZl1pD4Sg9y995Q.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">Beautiful login page</figcaption></figure><p id="dc04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的树的顶部，我有一个App.js，它有两个孩子，Home.js和Login.js。在App.js中，我将把用户的状态设置为null。使用this.state.user的三元组，如果用户为空，将引导他们登录，否则将引导他们到主页。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lr"><img src="../Images/79638f88522c93afb409dbf07d98da9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHmBP2GToDErDvWec_UtHw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">App.js</figcaption></figure><p id="ba50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将同样的两个属性传递给login和home将允许用户登录或注销。这些属性是用户的当前状态，以及setUser，它将把用户的状态设置为home中的null。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ls"><img src="../Images/5503d8fcbac4fc143412298a29c9073b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwH8yIpxo3gJ3C3PsURhYg.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">Home.js</figcaption></figure><p id="6ee7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当按下注销按钮时，我的onClick事件句柄log out启动，并首先使用prop将用户设置为null。使用withRouter允许我将用户重定向回登录。对于登录，我有一个状态用户名和密码，可以用于我的表单上的值。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/97f3624992842b14422989693df17f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4lbUoQF3anJHuNSbQUseSg.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">Login.js</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lu"><img src="../Images/f73044dc1dc1df245662fb8e51633080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z_-jYSPlhdYL5Dug5rTVKw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">Login.js continued</figcaption></figure><p id="44d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">连接前端和后端当登录按钮被按下时，我运行一个获取到我在Ruby中设置的登录路径的操作，我将使用主体的状态，因为用户名和密码存在于后端。</p><p id="77ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">收到响应后，我将使用localStorage并将userId设置为已登录用户的用户Id。如果使用导航条并有许多页面来确保你的用户在所有这些页面上登录，这将是很有帮助的。我还回调了setUser，从响应中获取数据，并将user: null更改为当前登录的用户。最后再次使用withRouter，用户被重定向到可以注销的主页。</p><p id="27eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就完成了一个基本的登录。</p></div></div>    
</body>
</html>