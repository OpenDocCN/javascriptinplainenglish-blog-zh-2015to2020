<html>
<head>
<title>Preview an uploaded image with React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React预览上传的图像</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/preview-an-uploaded-image-with-react-21cc36bf46bd?source=collection_archive---------6-----------------------#2020-09-23">https://javascript.plainenglish.io/preview-an-uploaded-image-with-react-21cc36bf46bd?source=collection_archive---------6-----------------------#2020-09-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="75d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">很多时候，你会发现自己要求用户上传一张图片。呈现即将提交的图片的预览是一个好主意。这篇文章的很大一部分与React没有什么关系，更多的是与前端应用程序开发有关。唯一涉及ReactJS的部分是我们使用<code class="fe ki kj kk kl b">useState</code>钩子临时存储图像引用的部分。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/fac8c666a62fa3cb5c501abc85dc39c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0I65HacoQVGcbDxDLakYCw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">source: pexels</figcaption></figure><h1 id="b93a" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">选择图像</h1><p id="0076" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">直观地说，第一步是让用户选择一个图像。普通老式HTML中带有文件类型的输入标签帮助我们做到了这一点。下面的行将显示一个标题为“选择文件”的按钮。当我们点击这个按钮时，会出现一个文件选择对话框。</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="ddd5" class="mj ld in kl b gy mk ml l mm mn">&lt;input type="file"&gt;&lt;/input&gt;</span></pre><p id="6f5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，上面的代码片段允许用户选择任何扩展名的文件。为了限制用户选择图片，我们添加了如下约束</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="048d" class="mj ld in kl b gy mk ml l mm mn">&lt;input type="file" <strong class="kl io">accept="image/*"</strong>&gt;&lt;/input&gt;</span></pre><p id="f123" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意加粗的部分。这将对选择施加约束。它现在只允许那些图像类型的文件。我们可以进一步添加约束，这些约束只概述某些文件扩展名的使用，如下所示。</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="682d" class="mj ld in kl b gy mk ml l mm mn">&lt;input type="file" accept="image/png" /&gt;</span></pre><p id="fbeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击选择文件按钮，我们将会看到一个文件选择器对话框，如下图所示。根据设备或设备运行的操作系统，外观会有所不同。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mo"><img src="../Images/c7648d7472b0caa26a08eaccdec4e1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APm3xLbBpytFOfIB0FaOyQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">caption: Image picker</figcaption></figure><h1 id="27ef" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">获取图像</h1><p id="7cea" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">可以从事件中提取所选的图像。首先向输入标签添加一个<code class="fe ki kj kk kl b">onChange</code>处理程序，如下所示</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="631b" class="mj ld in kl b gy mk ml l mm mn">&lt;input type="file" <!-- -->accept="image/*" onChange={processImage}<!-- -->&gt;&lt;/input&gt;</span></pre><p id="1fea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码片段中，<code class="fe ki kj kk kl b">processImage</code>是一个提取图像的函数。</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="3d47" class="mj ld in kl b gy mk ml l mm mn">function processImage(event){<br/>   const imageFile = event.target.files[0];<br/>   const imageUrl = URL.createObjectURL(imageFile);<br/>}</span></pre><p id="d803" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上面函数中的第一个like将图像从事件中解包，下面一行为所选文件生成一个临时url。这个临时url可以用来显示图像。接下来，我们使用React状态来保存这个url。</p><p id="78c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从导入<code class="fe ki kj kk kl b">useState</code>开始，使用钩子存储文件url。</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="9fbd" class="mj ld in kl b gy mk ml l mm mn">import React, {useState} from 'React';</span><span id="0ab0" class="mj ld in kl b gy mp ml l mm mn">....</span><span id="3ad5" class="mj ld in kl b gy mp ml l mm mn">const [fileUrl, setFileUrl] = useState(null);</span></pre><p id="fd7f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意，<code class="fe ki kj kk kl b">fileUrl</code>的初始值是<code class="fe ki kj kk kl b">null</code>。修改<code class="fe ki kj kk kl b">onChange</code>处理程序来更新图像被选中时的状态。</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="55ce" class="mj ld in kl b gy mk ml l mm mn">function processImage(event){<br/>   const imageFile = event.target.files[0];<br/>   const imageUrl = URL.createObjectURL(imageFile);<br/><strong class="kl io">   setFileUrl(imageUrl)<br/></strong>}</span></pre><p id="c44d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">回想一下，当状态被更新时，界面也被更新。最后，使用<code class="fe ki kj kk kl b">img</code>标签和状态变量呈现图像。</p><pre class="kn ko kp kq gt mf kl mg mh aw mi bi"><span id="0ead" class="mj ld in kl b gy mk ml l mm mn">&lt;img src={fileUrl}&gt;</span></pre><p id="d496" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当页面第一次加载时，<code class="fe ki kj kk kl b">fileUrl</code>没有值，图像也不会显示。当图像被选中时，状态变量<code class="fe ki kj kk kl b">fileUrl</code>被设置为临时url。这种状态更新启动了用户界面更新。然而，这一次<code class="fe ki kj kk kl b">fileUrl</code>将不是<code class="fe ki kj kk kl b">null</code>，图像将被显示。</p><p id="e508" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将允许你在上传图片前给用户一个预览。如果您有任何疑问，请留下您的评论。</p></div></div>    
</body>
</html>