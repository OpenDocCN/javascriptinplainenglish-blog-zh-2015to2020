<html>
<head>
<title>Page Redirect With Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">盖茨比的页面重定向</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/all-about-redirect-with-gatsby-coding-for-profit-and-fun-d49561ff8b2b?source=collection_archive---------4-----------------------#2020-11-13">https://javascript.plainenglish.io/all-about-redirect-with-gatsby-coding-for-profit-and-fun-d49561ff8b2b?source=collection_archive---------4-----------------------#2020-11-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="8795" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">您想知道的关于Gatsby.js中的重定向的一切，以获得最佳用户体验</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/bd5916c32ad469c230e3da630663e916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eywqZKuRIxSokL3K"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@soymeraki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Javier Allegue Barros</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f1f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以你的网站和<a class="ae ks" href="https://www.gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank">盖茨比</a>一起愉快地运行着。然而，就像每一个数字产品一样，它必然会成长和发展。一个你可能没怎么考虑的变化是URL架构。</p><p id="611f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一篇以http://yourdomain.com/website-speed这样的网址开始的博客文章可能会被重定向到http://yourdomain.com/blog/how-to-make-your-website-faster.</p><p id="052d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另一种情况是，当你的内容吸引了大量的追随者，提示你为订阅者提供一个封闭的部分。</p><p id="fb85" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦它们进入您的主页，它们将被自动带到一个私人的仪表板页面。与此同时，登陆该私有路径的未经身份验证的用户将被导航到带有登录部分的主页。这是web应用程序中非常常见的设计模式。</p><p id="e21a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们如何将它付诸实施？请继续关注我，到本文结束时，您将构建一个生产就绪的重定向工作流，您可以将它插入到您设计的任何Gatsby应用程序中。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="e185" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">设置和部署新站点</h1><p id="ad86" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">点击此<a class="ae ks" href="https://app.netlify.com/start/deploy?repository=https://github.com/bytrangle/gatsby-redirect" rel="noopener ugc nofollow" target="_blank">链接</a>设置一个入门应用。这将:</p><ul class=""><li id="5b56" class="mt mu in kv b kw kx kz la lc mv lg mw lk mx lo my mz na nb bi translated">使用起始代码在您的帐户上创建一个新的Github repo</li><li id="0555" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">使用您的repo创建并部署一个新的Netlify站点</li></ul><p id="462d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦您的starter站点部署完毕，将您创建的新repo克隆到您的本地机器上。</p><p id="560e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nh ni nj nk b">git clone git@github.com:&lt;YOUR_USERNAME&gt;/gatsby-redirect.git</code></p><p id="88bd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用Netlify部署时，将<code class="fe nh ni nj nk b">gatsby-redirect</code>替换为您为repo设置的任何名称。</p><p id="d052" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后移到新文件夹，安装所有必需的依赖项。</p><p id="acf6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nh ni nj nk b">cd gatsby-redirect npm install</code></p><p id="e9d5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在您喜欢的代码编辑器中打开<code class="fe nh ni nj nk b">gatsby-redirect</code>。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="a15a" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">启用网络身份</h1><p id="ca7d" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">在我们的例子中，认证正是需要重定向的原因，为此我们将使用<a class="ae ks" href="https://docs.netlify.com/visitor-access/identity/" rel="noopener ugc nofollow" target="_blank"> Netlify Identity </a>服务。</p><p id="b47a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">访问您的Netlify仪表板，导航到您刚刚部署的站点。单击身份选项卡，然后单击启用身份按钮。</p><p id="0d74" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">否则，当你点击现场的“注册”按钮时，你会看到下面这个可怕的错误。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/e0b41c55b4ee9ba84affade5a5e6e086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LE9F07Uu_-ubY5wp.png"/></div></div></figure><p id="55d5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">启用Netlify Identity后，返回终端并启动开发站点。</p><p id="4305" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">前往<code class="fe nh ni nj nk b">[localhost:8000](http://localhost:8000)</code>，点击“注册”按钮。Netlify会自动检测到我们正在本地服务器上运行。粘贴您的生产站点的URL，然后单击“设置站点的URL”按钮。</p><p id="0198" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Netlify注册模式将再次加载。像往常一样注册，并检查你的电子邮件中是否有一封来自Netlify的确认邮件，看起来像这样。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/57508fc2668dd453e0929e686213e567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ghc2nXha7qsB3sNx.png"/></div></div></figure><p id="ac82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">单击确认链接，您将被引导至您的生产站点。打开您的浏览器历史记录，查找带有此模式的URL<code class="fe nh ni nj nk b">your-domain.netlify.app/#confirmation_token=&lt;TOKEN&gt;</code>。</p><p id="93aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">复制从散列开始到URL结尾的字符串，并将其添加到本地主机站点，如下所示:<code class="fe nh ni nj nk b">localhost:8000/#confirmation_token=&lt;TOKEN&gt;</code>。</p><p id="2d7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将字符串粘贴到地址栏并输入。这就是你如何在本地服务器上确认你的帐户。</p><p id="8d92" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您收到类似“验证您的帐户时出现错误”这样令人畏惧的通知，请不要担心切换回您的网络生活仪表板，并转到身份选项卡。如果你看到你的新账户，那才是最重要的。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="acdd" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">站点重定向的内幕</h1><p id="85cb" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">所有类型的重定向都可以分为两组:</p><ul class=""><li id="9d43" class="mt mu in kv b kw kx kz la lc mv lg mw lk mx lo my mz na nb bi translated">服务器端:服务器用30x状态码响应浏览器的请求。</li><li id="ed16" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">客户端:浏览器自己进行重定向(可以用HTML或JavaScript完成)。</li></ul><p id="ec05" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">传统上，每次您尝试访问某个URL时，您的浏览器都会向服务器发送一个GET请求。服务器回复一个特定的状态码，它是一个三位数。状态代码可以表示成功的响应，也可以表示错误。</p><p id="3914" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个过程被称为<em class="nn">服务器端渲染</em>。要进行服务器端重定向，您需要与服务器达成一项协议，即无论访问者何时访问具有特定模式的页面，服务器都会将他们发送到不同的URL，而不改变内容。例如，现在每次访问<code class="fe nh ni nj nk b">[gatsbyjs.org](http://gatsbyjs.org)</code>都会被重定向到<code class="fe nh ni nj nk b">gatsbyjs.com</code>。</p><p id="70d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">根据您的web服务器，有许多方法可以配置服务器端重定向。幸运的是，我们的站点部署到了Netlify，所以我们可以简单地为Gatsby安装官方的Netlify插件，并在<code class="fe nh ni nj nk b">gatsby-config.js</code>中添加几行代码进行重定向。</p><p id="8a0b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意，我传统上使用单词<em class="nn">是因为现在，不是每个URL访问都构成对服务器的请求。许多网络应用程序使用<em class="nn">客户端路由</em>，这意味着访问者可以访问应用程序中的不同链接，而无需向服务器发出任何请求。</em></p><p id="a794" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">客户端重定向有专门的库，但是在本教程中，我们将使用<code class="fe nh ni nj nk b">gatsby</code>包提供的<code class="fe nh ni nj nk b">navigate</code>帮助函数。它是<code class="fe nh ni nj nk b">window.location</code>的包装器。</p><p id="5b4a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">无论你喜欢称之为客户端渲染还是客户端路由，目标都是一样的:让web应用程序像桌面应用程序一样快速、简洁。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="d35c" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">如何区分服务器端重定向和客户端重定向</h1><p id="6f62" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">默认情况下，服务器端重定向比客户端更快，因为它是由服务器发出显式指令，不需要等待JavaScript加载。</p><p id="6b09" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，当你不知道什么是快或不快时，这可能没有多大意义。</p><p id="fb33" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是我能想到的最可靠的方法:</p><ul class=""><li id="acae" class="mt mu in kv b kw kx kz la lc mv lg mw lk mx lo my mz na nb bi translated">打开新的浏览器选项卡。</li><li id="476b" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">打开浏览器开发工具，然后单击网络选项卡。</li><li id="beef" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">点击清除图标以确保网络选项卡处于干净状态。</li><li id="2509" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">访问您已登录的web应用程序，该应用程序会将登录用户从主页重定向到受限页面。我知道的两个应用是<a class="ae ks" href="https://todoist.com/" rel="noopener ugc nofollow" target="_blank"> Todoist </a>和<a class="ae ks" href="https://ticktick.com/?language=en_US" rel="noopener ugc nofollow" target="_blank"> TickTick </a>。</li><li id="bc4e" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">查看网络选项卡。如果你在主页上看到第一个网络请求，例如<a class="ae ks" href="http://todoist.com" rel="noopener ugc nofollow" target="_blank">todoist.com</a>，带有一个30X的状态码，类型为Document/Redirect，后跟一个对私有路由todoist.com/app,的请求，这几乎可以肯定是服务器端重定向。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/e9a24ef3e3a5305b8f2e3e26d68e2f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7lyZ2nvBygGnWdWP.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Server-side redirect for Todoist</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/3d5a6fb7492ddb934a7603d0822d9095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w9mNuaa-iBDFbddk.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Server-side redirect for Ticktick</figcaption></figure><p id="0065" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另一方面，我的演示Gatsby应用程序使用客户端重定向，所以您只能看到来自<code class="fe nh ni nj nk b">localhost</code>的请求，而看不到<code class="fe nh ni nj nk b">localhost:8000/app</code>。JavaScript重定向不会触发对服务器的请求。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi np"><img src="../Images/d0561bbd9c8da6b8eac278d78c950c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QcAOFatd5f3BbQsh.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Client-side redirect from home page to /app route</figcaption></figure><p id="7d10" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">也就是说，在什么情况下应该使用哪个？</p><p id="dce3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通常，当您链接到站点内的其他页面时，客户端呈现用于站点内链接。此外，当您通过客户端呈现进行导航时，您可以节省对服务器的昂贵请求。你的用户不会在屏幕上看到闪光，总体来说，你的应用程序会看起来更快。</p><p id="cbe3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另一方面，服务器端重定向负责站点间链接:其他站点通过断开的链接导航到您的站点。你无法控制其他网站的JavaScript，从服务器上做是唯一的出路。</p><p id="9a14" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">总的来说，重定向不是一种非此即彼的情况。您应该在服务器端和客户端都做，以获得最佳的用户体验。设置服务器端重定向的方法因主机提供商而异，所以在本教程中，我们将重点关注客户端重定向。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="15fc" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">通过客户端重定向</h1><p id="936b" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">既然我们能够登录，我们可以添加一些逻辑，以便在Netlify Identity返回有效用户时重定向用户。</p><p id="de8f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">认证超出了本教程的范围。如果你想学习如何在用Gatsby构建的静态站点中实现即插即用的认证服务，请期待我的下一篇教程。</p><p id="2d72" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">长话短说，我们将整个Gatsby应用程序包装在一个母亲组件中，该组件将用户信息、Netlify身份对象和登录完成状态(对或错)传递给任何愿意收到她回复的孩子。</p><p id="59c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这两个子组件分别是<code class="fe nh ni nj nk b">src/pages/index.js</code>内部的<code class="fe nh ni nj nk b">LandingPage</code>组件和<code class="fe nh ni nj nk b">src/pages/app.js</code>导出的<code class="fe nh ni nj nk b">App</code>组件。</p><p id="e690" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个用户上下文包含两个值，一个是初始化Netlify身份小部件时检索到的用户对象，另一个是<code class="fe nh ni nj nk b">netlifyIdentity</code>对象。当用户未登录时，user对象返回null，而一个对象具有键值对，如id、JWT、电子邮件、全名等。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3a21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">理论上，客户端重定向非常简单。在<code class="fe nh ni nj nk b">LandingPage</code>组件中，您检查是否定义了用户，然后使用Gatsby的内置函数进行导航。否则，呈现公共信息，包括用于登录或注册的表单。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9cca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是我们的方法有两个明显的问题:</p><p id="edbd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，如果您现在运行<code class="fe nh ni nj nk b">gatsby build</code>，您将得到一个威胁性的错误:“窗口未定义”。这是因为<code class="fe nh ni nj nk b">navigate</code>方法使用幕后的<code class="fe nh ni nj nk b">window.location</code>进行重定向，而<code class="fe nh ni nj nk b">window</code>对象在服务器端构建期间不可用。</p><p id="a3fe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了解决这个问题，我们将使用React中的<code class="fe nh ni nj nk b">useEffect</code>钩子，仅在组件被渲染时触发<code class="fe nh ni nj nk b">navigate</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="f5fd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对<code class="fe nh ni nj nk b">app.js</code>文件做同样的事情。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="bb1d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这种方法的第二个问题是用户可能没有在浏览器上启用JavaScript。这种情况并不少见，尤其是当用户从一个有严格政策的公司网络访问你的应用时。这意味着我们还需要处理服务器端重定向。</p><p id="fbc2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">即使您的用户启用了JavaScript，服务器端重定向仍然是必要的，因为它总是更快，并且优先于客户端呈现。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="9e17" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">客户端重定向是不够的</h1><p id="81a0" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">最终，Gatsby生成的只是HTML、CSS和JavaScript文件。它不运行任何类型的服务器来响应生产中的浏览器请求。因此，您不能单独使用Gatsby来处理重定向。</p><p id="69b9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">打开您的主机文档，查看重定向部分。如果您使用Netlify作为您的主机，您可能会对基于角色的访问感兴趣。下面是引擎盖下发生的事情:</p><ul class=""><li id="160f" class="mt mu in kv b kw kx kz la lc mv lg mw lk mx lo my mz na nb bi translated">当用户具有特定角色时，您可以在重定向文档中指定重定向的内容和位置。例如，角色为“用户”的用户访问您的主页时，将被重定向到<code class="fe nh ni nj nk b">/app</code>路线。</li><li id="cdd3" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">当有人访问您的web应用程序时，身份验证服务被启动，它检查是否有一个具有“用户”角色的有效JSON web令牌。这两个条件都必须满足，重定向才会发生。</li><li id="1e2e" class="mt mu in kv b kw nc kz nd lc ne lg nf lk ng lo my mz na nb bi translated">如果是的话，用户会比他们意识到的更快地被指引到<code class="fe nh ni nj nk b">/app</code>路线。</li></ul><p id="0c18" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我想给你展示一下它的演示，但是基于角色的访问是商业计划的一个特点，所以好好探索Netlify吧。</p><p id="6f42" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">作为总结，下面是最终的客户端重定向工作流。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ns"><img src="../Images/4c95646aaf4193c14996e67431f554bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GpfX-Ca4aK7KHB-P.gif"/></div></div></figure><p id="69d3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有没有更好的办法用Gatsby做客户端重定向？请在评论中分享你的交易技巧。</p></div></div>    
</body>
</html>