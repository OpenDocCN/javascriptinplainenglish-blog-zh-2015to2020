<html>
<head>
<title>Let’s Clean Up: Ugly Try-Catches in JavaScript!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们清理一下:JavaScript中丑陋的尝试陷阱！</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-clean-up-ugly-try-catches-e4e1a53de500?source=collection_archive---------0-----------------------#2019-11-30">https://javascript.plainenglish.io/lets-clean-up-ugly-try-catches-e4e1a53de500?source=collection_archive---------0-----------------------#2019-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e0deb3f6ae898770fd3745501e5a57b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*349blDIDsCbOf9bV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@casparrubin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Caspar Camille Rubin</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4d95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们都去过那里。我们都使用了<code class="fe lb lc ld le b">await</code>对<code class="fe lb lc ld le b">async</code>的方法，忘记了把它们包装在<code class="fe lb lc ld le b">try-catch</code>里，只是为了被告知一个<code class="fe lb lc ld le b">Unhandled Error</code>😱</p><p id="e92c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但不仅仅是这些<code class="fe lb lc ld le b">aysnc</code>方法会抛出。也许我们使用了抛出的第三方库，或者我们设计我们的代码库的方式使得我们有意抛出错误以将错误处理提升几层。</p><p id="a715" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们继续将我们的调用包装到我们的<code class="fe lb lc ld le b">try-catch</code>块中的可抛出方法中。</p><p id="1b72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了。😍</p><p id="770d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🤔还是真的？</p><p id="2675" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在代码库中工作，你可以期望方法<code class="fe lb lc ld le b">throw</code>会导致你的逻辑被包裹在<code class="fe lb lc ld le b">try-catch</code>块中的情况。它还会导致其他代码设计问题。</p><p id="5ae2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看看下面的例子:</p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="7d76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如上所述，<code class="fe lb lc ld le b">myVar</code>变量不存在于<code class="fe lb lc ld le b">try</code>块之外。但是我们需要这种价值来延续我们的逻辑！！</p><p id="96d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以现在我们需要做一些不同的事情。<br/>怎么样:</p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><h1 id="d5d0" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi">🤮!</h1><p id="3fe3" class="pw-post-body-paragraph kd ke iq kf b kg mj ki kj kk mk km kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">不。我们不要这样做。</p><p id="60f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们所有的逻辑都封装在<code class="fe lb lc ld le b">try</code>块中。太丑了。<br/>此外，如果任何后续的方法调用抛出，我们确定要以同样的方式处理它们吗！？可能，但最有可能不是！</p><p id="a763" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，让我们试试别的…</p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="2697" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这有点好，但仍不完美。它仍然是丑陋的，因为<code class="fe lb lc ld le b">myVar</code>必须被声明，然后在不同的范围内几乎立即被初始化。当<code class="fe lb lc ld le b">myThrowableMethod</code>真的抛出时也会出现问题，因为执行将继续并尝试使用<code class="fe lb lc ld le b">myVar</code>！</p><p id="e71b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🐛警惕！</p><p id="a536" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以继续说下去，给出更多这些<code class="fe lb lc ld le b">try-catch</code>块会带来代码设计、可读性和可维护性问题的情况。</p><p id="2519" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，我会给你一个解决方案！</p><h1 id="0b9d" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">解决方案🚀</h1><p id="d05d" class="pw-post-body-paragraph kd ke iq kf b kg mj ki kj kk mk km kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">我写了一个小图书馆来正面解决这个问题:</p><h1 id="5b11" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">让我们欢迎<a class="ae kc" href="https://github.com/coly010/notry.git" rel="noopener ugc nofollow" target="_blank">不要尝试</a>到现场。🎉</h1><h1 id="d77c" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">什么是<code class="fe lb lc ld le b">no-try</code>？😱</h1><p id="b56e" class="pw-post-body-paragraph kd ke iq kf b kg mj ki kj kk mk km kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated"><code class="fe lb lc ld le b">no-try</code>是一个很小的库，它去掉了代码中的<code class="fe lb lc ld le b">try-catch</code>，提高了代码的可读性和可维护性，同时也有助于改进代码设计。</p><p id="ec42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它公开了两个功能。<code class="fe lb lc ld le b">noTry</code>、<code class="fe lb lc ld le b">noTryAsync</code>后者解析并返回承诺结果。</p><p id="8b39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不相信我？让我们更详细地看看它。</p><p id="7d2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，只需运行<code class="fe lb lc ld le b">npm i --save no-try</code></p><p id="7ba5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后将其添加到您的文件中:</p><p id="3bdd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在打字稿中:</p><p id="9b2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">import {noTry, noTryAsync} from "no-try";</code></p><p id="fec6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在JavaScript中:</p><pre class="lf lg lh li gt mo le mp mq aw mr bi"><span id="8c4e" class="ms lm iq le b gy mt mu l mv mw">const noTry = require('no-try').noTry;<br/>const noTryAsync = require('no-try').noTryAsync;</span></pre><p id="b547" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们重构上面的例子，使用<code class="fe lb lc ld le b">no-try</code>。</p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="8d1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有一个标准的错误处理函数，你可以把它提供给<code class="fe lb lc ld le b">noTry</code>，如果有错误发生，它会为你调用它！</p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="4ff5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！</p><p id="68cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们已经从代码中移除了<code class="fe lb lc ld le b">try-catch</code>块，防止了与块作用域变量相关的问题，同时也让我们的代码更具可读性，而不会牺牲我们想要的处理错误的灵活性。</p><p id="629d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在<a class="ae kc" href="https://github.com/coly010/notry.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上阅读更多关于<code class="fe lb lc ld le b">no-try</code>的内容。</p><p id="33d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在去清理你的代码吧！</p><p id="5494" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如有任何问题，欢迎在下方提问或在Twitter上联系我:<a class="ae kc" href="https://twitter.com/FerryColum" rel="noopener ugc nofollow" target="_blank"> @FerryColum </a>。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="7472" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ne">原发布于2019年11月30日</em><a class="ae kc" href="https://dev.to/coly010/let-s-clean-up-ugly-try-catches-5d4c" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://dev . to</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>