<html>
<head>
<title>Building a Simple Chat Application with Expo Push Notifications and React Native: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Expo推送通知和React Native构建一个简单的聊天应用程序:第1部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-simple-chat-application-with-expo-push-notifications-and-react-native-part-1-fb144d86a83e?source=collection_archive---------10-----------------------#2020-07-06">https://javascript.plainenglish.io/building-a-simple-chat-application-with-expo-push-notifications-and-react-native-part-1-fb144d86a83e?source=collection_archive---------10-----------------------#2020-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c59d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我最近在一个个人项目上使用了世博会通知，从那以后，我一直想在这个非常容易使用的工具上写点什么，但我一直没有找到合适的时间。无论如何，我决定用一个简单的聊天应用程序，因为我认为它可能很容易，我们可以方便地将整个事情分成一系列，每个不到一个小时。</p><p id="6ca4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">也就是说，这将是该系列的第一部分，第二部分将在下周的某个时候推出。</p><p id="de4e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">说够了，让我们进入正题。</p><p id="fc03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，这里的业务是建立一个简单的聊天应用程序有点像WhatsApp，我们将使用WebSockets，Expo平台上的React Native，Koa和后端的TypeORM。见鬼，也许我们甚至可以使用Twilio添加一点电话验证(只是也许)。</p><p id="9ee5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将从定义我们的整体架构和流程开始这一部分。下面是不是最设计，但我可以想出一些，所以我可以保持在一个小时以下。</p><h1 id="99fd" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">设计</h1><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/1430251e92a0840e4d02f4e769364699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fWkL06vqJ8HqUp1pOofGg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk">Design document</figcaption></figure><p id="3bc6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们浏览一下我们的设计</p><ol class=""><li id="e46b" class="lw lx in jm b jn jo jr js jv ly jz lz kd ma kh mb mc md me bi translated">首先，当用户登录时，我们将收集用户的expo推送令牌以及用户名和电话号码。然后我们将用户导航到主应用程序。</li><li id="e128" class="lw lx in jm b jn mf jr mg jv mh jz mi kd mj kh mb mc md me bi translated">每当用户打开主应用程序时，他们都通过WebSocket连接到服务器。在连接时，服务器会将连接对象存储在内存中的<a class="ae mk" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" rel="noopener ugc nofollow" target="_blank">映射</a>中。</li><li id="86fb" class="lw lx in jm b jn mf jr mg jv mh jz mi kd mj kh mb mc md me bi translated">客户端将构建消息JSON，它由消息文本、时间戳、接收者标识符、生成的GUID和生成的hash组成，使用GUID作为关键字，消息文本作为种子。我们将在设计的<em class="ml">上下文</em>中将<em class="ml">这个</em>对象称为JSON对象(双关语)。</li><li id="3f40" class="lw lx in jm b jn mf jr mg jv mh jz mi kd mj kh mb mc md me bi translated">根据保证交付的原则，构造的JSON对象将被临时保存到本地存储，然后在服务器确认收到后被删除。只有当消息被接收并持久化时，服务器才会确认接收。</li><li id="5a3b" class="lw lx in jm b jn mf jr mg jv mh jz mi kd mj kh mb mc md me bi translated">服务器将使用JSON对象中的接收者标识符来检索接收者的WebSocket连接对象。如果找到，这意味着用户很可能在线，否则用户很可能离线。<br/> a .如果用户在线，消息将通过找到的套接字<em class="ml">单播</em>给接收者。<br/> b .如果用户离线，我们将向已经注册的世博推送令牌触发世博推送通知。</li><li id="6b2b" class="lw lx in jm b jn mf jr mg jv mh jz mi kd mj kh mb mc md me bi translated">当接收客户端确认消息传递时，服务器会将传递报告发送回发送用户，实现传说中的<em class="ml">双滴答。</em></li></ol><p id="a712" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是总体设计，当然是简化的。请留下您的意见，告诉我们如何改进这个系统，但仍然保持它的超级简单，任何人都可以遵循。</p><p id="a140" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们将设计我们的数据库模型。我将在<a class="ae mk" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>之上使用<a class="ae mk" href="https://typeorm.io" rel="noopener ugc nofollow" target="_blank"> TypeORM </a>。你可以选择ORM和db组合，无论哪种方式都可以锻炼。也就是说，我们将继续设计我们的模型。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/e53114b5ba9c587067608b040d08928e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*pC1U_CTi70ZK9OpTbwLDRQ.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk">Model document. v1</figcaption></figure><p id="3631" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可能会迭代设计，因为文章将是交互式的，需求可能会发生变化。</p><h1 id="8a0d" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">代码</h1><p id="08dd" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">现在我们已经有了基本的设计和目标，让我们面对真正的交易。我们不会在这里使用TDD方法，因为我们的需求可能会随着时间的推移而改变，但是我们应该在系列的最后编写测试。</p><p id="0379" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将使用<a class="ae mk" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank">打字稿</a>来构建我们的项目。Typescript非常简单，如果你熟悉Javascript，你会发现适应它不费吹灰之力。</p><p id="82bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将从引导我们的后端和React本地项目并为两者创建Github库开始这一部分。继续安装<a class="ae mk" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">节点、NPM </a>、<a class="ae mk" href="https://www.postgresqltutorial.com/install-postgresql/" rel="noopener ugc nofollow" target="_blank"> PostresSQL </a>和<a class="ae mk" href="https://docs.expo.io/" rel="noopener ugc nofollow" target="_blank"> Expo </a>如果你还没有安装的话。对了，我以为我们把我们的聊天app叫做<em class="ml"> Heya！</em>。所以对于后端，我们将创建一个名为“heya-api”的空文件夹，并初始化它的基本要求。因此在这一点上，我们可以说我们的NPM需求将是<em class="ml"> typescript，typeorm </em>(这取决于PostgreSQL的<em class="ml"> pg </em>和类型分解的<em class="ml"> reflect-medata </em>。更多信息见文档)和<em class="ml"> ws </em>(用于WebSockets)。</p><pre class="lh li lj lk gt ms mt mu mv aw mw bi"><span id="c3e7" class="mx kj in mt b gy my mz l na nb">$ mkdir heya-api &amp;&amp; cd heya-api<br/>$ npm init -y<br/>$ npm install typescript @types/node --save-dev<br/>$ npm install typeorm reflect-metadata pg ws</span></pre><p id="334a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们运行下面的命令来初始化这个项目的typescript。</p><pre class="lh li lj lk gt ms mt mu mv aw mw bi"><span id="06a7" class="mx kj in mt b gy my mz l na nb">$ tsc --init</span></pre><p id="53ae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将为项目创建我们的typescript配置文件。在你的编辑器中打开文件<em class="ml"> tsconfig.json </em>并做一些修改。在第4行，我们将目标更改为“ES2017”。在第6行，取消对<em class="ml"> lib </em>的注释，并将值改为<em class="ml"> ["es6"] </em>。最重要的是，确保取消对<em class="ml"> experimentalDecorators </em>和<em class="ml"> emitDecoratorMetadata </em>的注释，因为您将需要这些标志用于TypeORM实体声明。我的最终配置如下:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="9b44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将继续初始化Git并创建一个<em class="ml">。gitignore </em>文件</p><pre class="lh li lj lk gt ms mt mu mv aw mw bi"><span id="888e" class="mx kj in mt b gy my mz l na nb">git init<br/>touch .gitignore</span></pre><p id="2bdf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的<em class="ml">的内容。gitignore </em>文件:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="09a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将继续把它推到master上，下周再继续。</p><p id="427e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们也将启动Expo应用程序。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ne"><img src="../Images/9f2c236800dec3b22d61115135f72cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XL55BPZzbGpp_1qOwGXQOw.gif"/></div></div></figure><p id="919f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">把这个也往上游推。在下一集，我们将专注于为我们的应用程序设计用户界面，甚至可能添加一些功能。如前所述，请留下您的评论，感谢阅读。</p><div class="nf ng gp gr nh ni"><a href="https://github.com/16kilobyte/heya-app" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">16kb/heya-app</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">在GitHub上创建一个帐户，为16kb/heya-app开发做贡献。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw lq ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://github.com/16kilobyte/heya-api" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">16千字节/heya-api</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">在GitHub上创建一个帐户，为16kb/heya-API开发做贡献。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw lq ni"/></div></div></a></div></div></div>    
</body>
</html>