<html>
<head>
<title>How to pass keys to React lists correctly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何正确地将键传递给反应列表</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-lists-and-keys-101-12d251982482?source=collection_archive---------4-----------------------#2020-09-23">https://javascript.plainenglish.io/react-lists-and-keys-101-12d251982482?source=collection_archive---------4-----------------------#2020-09-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b617" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">所以它不会导致意外的行为:反应列表和键101</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8af90ebf768a79a260acc698c8ead2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xtbLIfJ6KELkGYeVCnzSFg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@mattartz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Matt Artz</a> on <a class="ae ks" href="https://unsplash.com/s/photos/keys?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="74a1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通常在阅读文章或阅读React教程时，您会看到许多开发人员使用元素索引作为列表呈现键的例子。</p><p id="51cf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它保持了代码的简单和优雅，当然，也消除了您在控制台中看到的警告。但不幸的是，这是一种反模式。</p><blockquote class="lp"><p id="8cd5" class="lq lr in bd ls lt lu lv lw lx ly lo dk translated">"如果项目的顺序可能会改变，我们不建议对键使用索引。这可能会对性能产生负面影响，并可能导致组件状态出现问题。—根据<a class="ae ks" href="https://reactjs.org/docs/lists-and-keys.html" rel="noopener ugc nofollow" target="_blank"> React的文件</a>。</p></blockquote><p id="7694" class="pw-post-body-paragraph kt ku in kv b kw lz jo ky kz ma jr lb lc mb le lf lg mc li lj lk md lm ln lo ig bi translated">在本文中，我想向您展示在呈现列表时如何明智地使用关键道具，以及在向其传递索引时可能会遇到的问题。</p><h1 id="7314" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">React的列表和键</h1><p id="90fe" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">“key”是一个特殊的字符串属性，您需要在创建元素列表时包含它。</p><p id="9f85" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当试图在不传递一个<code class="fe nb nc nd ne b">key</code>属性的情况下呈现一个元素列表时，您会得到一个警告，提示您应该为列表项提供一个键。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/8e9c515e763a34a9108412a38f9c8f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LH4zSGvMmX9gRlxNptDMw.png"/></div></div></figure><p id="4d11" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">关键字有助于识别哪些项目已经更改、添加或删除。应该给数组内部的元素赋予键，以给元素一个稳定的标识。</p><p id="b783" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">选择一个键的最好方法是使用一个字符串，这个字符串在它的兄弟列表中唯一地标识一个列表项。</p><p id="3f86" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">大多数情况下，您会将数据中的id用作键。</p><h1 id="e3ea" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">问题是</h1><p id="e8dd" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">有时当用<code class="fe nb nc nd ne b">.map</code>呈现一个列表时，我们不会有唯一标识数组中每一项的ID。我们可以使用另一个属性作为键，但是如果它不一定是惟一的呢？</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/4e9719d7ccf6852ad8d9c3de3637806b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlieDBL3wWrGxW7hjI5ypA.png"/></div></div></figure><p id="94be" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在前面的示例中，键被设置为names数组中的名称，它有一个重复的值，并且键属性必须是惟一的。</p><p id="1d7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你看一下控制台，你应该可以看到一个新的警告遇到了两个孩子用同一把钥匙。</p><h1 id="d547" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">天真的解决方案</h1><p id="c1e3" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">传递给map方法的arrow函数接收第二个参数，它是当前迭代中元素的索引。</p><p id="640e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以在呈现列表时使用这个索引作为键，这样键就等于索引。这样，每一项都会收到一个唯一的键值，所以这就是如何使用索引值作为列表呈现的键。</p><p id="abd5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">让我告诉你，使用索引作为键，在某些情况下可能会导致一些严重的UI问题。</strong></p><blockquote class="lp"><p id="f2a5" class="lq lr in bd ls lt lu lv lw lx ly lo dk translated">根据React的文档,“当你没有稳定的id用于渲染项目时，你可以使用项目索引作为一个键作为最后的手段”。</p></blockquote><h1 id="8e6f" class="me mf in bd mg mh mi mj mk ml mm mn mo jt nj ju mq jw nk jx ms jz nl ka mu mv bi translated">一个例子！</h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nm ng l"/></div></figure><p id="e72c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个例子中，您可以看到使用<code class="fe nb nc nd ne b">.map</code>呈现的两个列表。</p><p id="ac04" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个列表(红色)接收索引作为键，第二个列表(绿色)接收每个元素的ID作为键。</p><p id="e9f1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以看到，通过单击其中一个按钮，颠倒列表的顺序，或者在开头添加一个元素，这两个列表的行为是不同的。</p><p id="a620" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们希望数字(id)和动物名称保持不变(0 —狗，1 —猫，等等)。</p><p id="efd4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">点击按钮反转列表，看红色的，可以看到数字和名字出乎意料地混合在一起。而绿色的表现良好。</p><p id="4176" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">同样，在列表的开头添加一个元素会导致红色列表中动物的id改变。</p><p id="5ebf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，如果你打开控制台，你会看到实际发生了什么。最初，这两个列表为每个元素呈现并记录动物的ID和名称。然后，通过点击其中的一个按钮，只有红色的列表，我们把它作为一个键传递给它，导致打印，也就是执行一个重新渲染。</p><p id="1e32" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">传递一个惟一的值会使我们正在呈现的列表像预期的那样运行。</p><h1 id="7f9a" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">什么时候可以用索引做键？</h1><p id="cb2f" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">现在你可能会问这个问题。如果使用索引作为关键字，会导致这样的问题，为什么这么多的文章或视频会证明这一点？事实证明，如果您的列表满足某些条件，您可以使用索引作为键:</p><ul class=""><li id="df1b" class="nn no in kv b kw kx kz la lc np lg nq lk nr lo ns nt nu nv bi translated"><strong class="kv io">列表中的项目没有唯一的ID </strong>。如果项目确实有唯一的ID，总是使用它。</li><li id="3458" class="nn no in kv b kw nw kz nx lc ny lg nz lk oa lo ns nt nu nv bi translated"><strong class="kv io">列表是一个静态列表，不会改变</strong>。例如，您永远不会在列表中添加或删除项目。</li><li id="8f11" class="nn no in kv b kw nw kz nx lc ny lg nz lk oa lo ns nt nu nv bi translated"><strong class="kv io">列表永远不会被重新排序或过滤</strong>。例如，基于列值的排序或基于用户输入的筛选。</li></ul><p id="752c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当您的列表不仅满足一个条件，而且满足所有三个条件时，您可以安全地将索引用作键。</p><p id="4bb7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">大多数情况下，您最终会拥有一个惟一的ID，或者列表会满足这三个条件。如果没有，您可以尝试一个为列表生成唯一ID的NPM包，或者尝试从一个现有的属性中散列出一个唯一值。</p><p id="0c76" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是底线是，尽量避免使用索引作为键，并把它作为最后的手段。</p><h1 id="c3d9" class="me mf in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">结论</h1><p id="563c" class="pw-post-body-paragraph kt ku in kv b kw mw jo ky kz mx jr lb lc my le lf lg mz li lj lk na lm ln lo ig bi translated">事实上，如果您没有指定key prop，React会使用索引作为键。当然，我们刚刚了解到，在某些情况下，这可能会是一场灾难。</p><blockquote class="lp"><p id="c321" class="lq lr in bd ls lt lu lv lw lx ly lo dk translated">"如果您选择不为列表项分配显式键，那么React将默认使用索引作为键。"—根据<a class="ae ks" href="https://reactjs.org/docs/lists-and-keys.html" rel="noopener ugc nofollow" target="_blank"> React的文档</a>。</p></blockquote><p id="8cc5" class="pw-post-body-paragraph kt ku in kv b kw lz jo ky kz ma jr lb lc mb le lf lg mc li lj lk md lm ln lo ig bi translated">好吧。我希望您现在已经很好地理解了React中的列表和键。</p><p id="d7b4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">祝您愉快！感谢阅读！🎾</p></div></div>    
</body>
</html>