# 如何编写漂亮的 React 代码

> 原文：<https://javascript.plainenglish.io/writing-beautiful-react-code-using-a-good-old-mate-ca1450c0dc06?source=collection_archive---------1----------------------->

## 寻找更好的创作 React 代码的方式

![](img/c6a6d85984c16f85d5ff60c80e772711.png)

Photo by [Sincerely Media](https://unsplash.com/@sincerelymedia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/computer-coffee?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText)

React 代码很难看。我不是在谈论框架的任何技术特征；我说的是直截了当的美学，代码在我屏幕上的样子，以及它唤起的感觉。

从这个意义上来说，代码美学不是开发人员习惯关心的东西。我们有更重要的担忧。审美是主观的，难以衡量，追求它的好处也不清楚。你不会经常看到一个开发人员在站着开会的时候举手告诉他们的同事他们不满意代码在他们屏幕上的样子。我不确定是否有人应该这样做，但我从不同的角度来看。

当我在做一个兼职项目时，我开始考虑 React 的美丽。正如大多数以编程为职业和爱好的程序员一样，工作和休闲的区别是由你享受的快乐程度来定义的。当然，我们的职业目标是让两者都变得无与伦比，尽管有时它们是如此，但当它们不是时，你仍然希望至少你的“放松编码”时间尽可能地愉快。

自然地，如果出于某种原因，React 让我不愉快，我想花时间为快乐而编码，那么显而易见的事情就是不要使用 React。大多数时候，我不知道。但是我们知道，代码有一个多面的视角:你有代码，人工制品，你输入到计算机的充满符号的行，但是你也有你的代码的结果，它的输出，你用编程语言表达的思想的现实生活的含义。我在乎，我可以从看到我的代码与现实世界的交互中获得同等甚至更大的乐趣。

结果是，有时，尽管我可能会发现一种编程语言、框架或工具看起来或用起来令人不愉快，但它是我需要看到我的代码在合理的时间内真正成形的语言。也许这是由于一些工具，围绕它创造东西的大社区，或者一些其他的技术特征。不管什么原因，我作为爱好的编码时间是稀缺的，尽管我希望它是令人愉快的，但我也想充分利用它，这意味着使用不总是符合我审美标准的东西。React 就是这种情况。

有一天，在思考这个话题时，出现了一个问题:我能在保持高生产率的同时写出美观的 React 代码吗？我知道这个问题在其他编程语言和框架中有非常有价值的答案。所有这些都会有不同程度的相同权衡，比如学习有多难，我还能从 React 生态系统中受益多少，围绕它的工具如何，等等。所有这些权衡都需要根据项目的目标进行不同的衡量。

我对这个问题的回答往往是别的什么没有反应。但每隔一段时间，你会比较每一个取舍；你从不同的角度看待你的项目；你试图重新思考你所设想的特性和你所拥有的需求；尽管如此，在一天结束时，反应将是你的答案。考虑到这些情况，我将原来的问题重新组织为:“在保持 React 代码不变的情况下，我能在多大程度上让我的 React 代码更易于查看？”

## “在保持 React 代码不变的情况下，我能在多大程度上让 React 代码更易于查看？”

为了开始回答这个问题，我创建了一个 Create React 应用程序项目，并以一个简单的 React 代码作为参考。我希望它至少有一点真实，但仍然足够简单，这样它就不会妨碍测试不同的东西。我选择了官方的 React 教程代码，你可以在这里找到:[井字游戏](https://codepen.io/gaearon/pen/gWWZgR?editors=0010)。

放大这段代码中最简单的 React 组件，即 Square 组件，我们会看到以下内容:

```
function Square(props) {
 return (
   <button className=”square” onClick={props.onClick}>
     {props.value}
   </button>
 );
}
```

这就是事情变得主观的地方:我觉得这段代码令人不快。同样，我不是在谈论这段代码的技术属性。当我说它很丑时，我试图表达它在我身上唤起的一系列感觉，这些感觉主要基于我自己对这个世界的总体经验和对编程的具体经验。正是从这个角度出发，我将继续说，让我尖叫的第一个问题是 JSX。

自从 JSX 问世以来，人们已经讨论了很多，但为了阐明我的观点，我将允许自己快速地考虑一下。JSX 很乱，但也是一个现实。它来自前端技术的自然发展，前端技术从一开始就有某种形式的 XML 语言来定义标记。与众不同的是，JSX 通常存在于您的 JavaScript 代码中。

与口语做一个粗略的比较，JSX 就好像说某种特定语言的人开始使用其他语言的一整套词汇和表达来表达自己。例如，当一个特定的主题是某个特定文化所固有的时候，这种情况经常发生。当文化之外的人，说着不同的语言，面对表达关于这个主题的想法的挑战时，他们经常缺乏词汇来处理它，求助于那些“产生”这个主题的人所说的语言作为解决它的方法。语言纯粹主义者很快就生气了，指出你怎么能在不需要外来词的情况下说出那些东西。但人们仍然会使用这些词，其中一些词最终会被纳入官方语言。JSX 诞生于 JavaScript 演讲者表达 UI 标记的需求。

根据语言使用者的类比，一些灵魂使用语言是为了审美的目的和自我表达的方式。诗人和文学作家一般都是这样。他们是如何看待外语单词的？毫无疑问，他们会对他们另眼相看。他们的观点与我的观点相似，因为他们从语言表达思想的能力来看待语言，同时也从美学的角度来看待语言。从这个角度来看，使用 JSX 是不必要的:它增加了噪音，无助于表达它所表达的思想。

所有这些都是说，我朝着更愉快的写作方式迈出的第一步是摆脱 JSX。

非 JSX 版本的按钮组件如下所示:

```
const e = React.createElement;
function Square({ onClick, value }) {
  return e(‘button’, { className: ‘square’, onClick }, value);
}
```

代码的统一性和简洁性带来了美学上的实质性改进。我们可以在没有 JSX 的道路上走得更远。我绝不是第一个讨论收养 JSX 的人。对它的厌恶可能和 JSX 本身一样古老。我敢打赌，它背后的原始团队至少有人说这是不必要的。你会发现很多关于为什么 JSX 很糟糕以及不使用它的好处的阅读。很高兴，你也会找到技术上合理的替代品。一个突出的例子是 Hyperscript，它是由 React 团队[在其文档](https://reactjs.org/docs/react-without-jsx.html)中推荐的。这是一个简单的工具，帮助您使用 JavaScript 构建超文本。它的 React 版本带来了比“createElement”更有吸引力的 API。我决定与一个叫做“hyperscript-helpers”的小型帮助程序库一起尝试，我发现这些工具非常有助于代码美观:

```
function Square({ onClick, value }) {
  return button({ className: ‘square’, onClick }, value);
}
```

替换 JSX 是应用于 React 代码美化的帕累托原则。很少的努力，很好的结果。如果想要更漂亮的代码，每个人都应该这样做。

继续探索在框架领域美化 React 代码的方法，我发现了一个死胡同。虽然我可以探索一些设计模式和简单的约定，但是它们需要在具体情况具体分析的基础上评估它们的技术含义，我正在寻找一些更通用的东西。所以下一步需要在 JavaScript 层。

JavaScript 是一种极其灵活的语言，这是一种众所周知的双刃剑。也是可以从美学角度去探讨的东西。有许多不同的方法可以编写有效的代码，有显著的风格差异和一些技术含义。许多工具将帮助你定制和执行你所做的风格选择，其中有一个是我非常喜欢的: [StandardJS](https://standardjs.com/) 。StandardJS 是一个工具，用于自动将一组合理的编码风格选择应用到代码中。在这些选择之间值得注意的美学含义是分号的排除。

我发现 JS 代码中的分号是一种不必要的噪音，我乐于承担不使用分号的风险。在我将 StandardJS 合并到我的参考示例中之后，留给我的是:

```
function Square ({ onClick, value }) {
  return button({ className: ‘square’, onClick }, value)
}
```

就 JavaScript 代码而言，这是我能得到的最好的了。回顾到目前为止我所做的事情，事情看起来还不错。实现的更改非常简单，可以很容易地集成到我的默认辅助项目 React 设置中。另一方面，这与我在不同语言中体验到的审美还是相差甚远。我已经讨论了其他语言的情况，重点是我想在 JS 世界中坚持使用 React。除非有什么东西能给 JavaScript 增添一些优雅的火花，同时仍然像 JavaScript 一样，否则我就离我设定的界限太远了。

“就像 JavaScript 一样。”当我试图发挥我的创造力去寻找不同的可能性时，这句话让我回到了十年前。我当时正在学习 web 开发，刚刚接触了 Ruby on Rails。当时，Rails 曾经内置了一种不同的 JavaScript，叫做 CoffeeScript。CoffeeScript 有一条黄金法则:“它只是 JavaScript。”既然如此，CoffeeScript 可能符合我的标准，所以我决定看看项目进展如何，并尝试一下。

我知道自从 ES5 以来，CoffeeScript 的一系列更好的特性被纳入了 JS 标准，所以从技术上讲，人们采用 CoffeeScript 的理由更少了。随着 transpilers 的出现，每个人都有能力使用甚至还不是标准的 JS 特性，即使是必须支持旧浏览器的开发人员现在也可以从最新的语言特性中受益。这使得 CoffeeScript 明显不如以前流行了。但是我的兴趣不是技术性的。我想找到一个令人愉快的美学解决方案，允许我编写看起来不错的 React 代码，同时仍然是 JavaScript，而不需要学习新的语言或框架。

查看文档，CoffeeScript 非常接近 JavaScript，以至于我可以忽略学习曲线，并且它在美观方面给代码带来了显著的改进。我曾怀疑它是否还能保持，但事实证明是这样的。最近一次发布是在今年年初。它的最新主要版本包含了新的 JS 特性，甚至支持 JSX。所以我决定将它集成到我的示例项目中。为此，我必须退出 Create React 应用程序配置，以便为 CoffeeScript 添加一个 Webpack 加载器。除此之外，转换相当简单。

这是人工按钮组件的最终代码看起来的样子:

```
Square = ({ onClick, value }) -> 
 button ‘.square’, { onClick }, value
```

如果你对整个代码最终是什么样子感到好奇，你可以在这里找到它。就美学而言，我认为这段代码是对我最初代码的巨大改进。语法简洁，看起来很干净。

关于追求美是如何追求更少，已经说了很多。我显然同意这一点。事实证明，我的美丽搜索基本上是搜索用更少的代码编写一段有表现力的 React 代码。CoffeeScript 带来的出色改进——以及其他语言的使用——是赋予本来没有意义的记号以价值。这种认识在结尾时似乎很明显，但在开始时并不明显。它的目的是在总体上增强弱势群体的力量。

从实用的角度来看，乍一看，采用这样的风格似乎不会影响工作效率。CoffeeScript 已经出现了一段时间，我希望它有一些像样的工具。在构建这个快速实验时，我没有感到意外。不过，有一件事可能会妨碍我完全采用它:将它与 TypeScript 一起使用的能力。我知道它是如何工作的，但我决定在这一点上停止探索。不管怎样，如果你喜欢这张图片，对采用类似的方法感兴趣，并且对它如何与 TypeScript 一起工作感到好奇，请让我知道。

感谢阅读。

***TL；DR:*** *从代码美学的角度来看，结合使用 Hyperscript 和 CoffeeScript 是编写漂亮的 React 代码的绝佳方式。*