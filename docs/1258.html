<html>
<head>
<title>Are magic numbers always magic in Programming?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编程中幻数总是幻的吗？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/is-magic-number-always-a-magic-number-c3b340b3f6cd?source=collection_archive---------4-----------------------#2020-02-19">https://javascript.plainenglish.io/is-magic-number-always-a-magic-number-c3b340b3f6cd?source=collection_archive---------4-----------------------#2020-02-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="54d3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">钝角值的重构如何让我们的代码更干净，更容易理解。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/47396abc80a56f25d74a5f0b9110cdb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*pEPsodjV92LGSznJa0gQCA.jpeg"/></div></figure><p id="36bf" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">什么实际上是一个神奇的数字？基本上，幻数是一种代码、密码或数字，具有某种“<em class="lj">幻</em>”，晦涩难懂但<em class="lj">重要的</em>意义。然而，仅仅从阅读源代码来看，并不清楚这是什么意思。</p><p id="5e73" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这就像找到了生命、宇宙和一切终极问题的答案。答案是:42。为什么是42？\_(ツ)_/</p><p id="5c3f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们回到计算机编程，想象我们得到一些<code class="fe ll lm ln lo b">code</code>:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="6193" class="lt lu iq lo b gy lv lw l lx ly">const response = await API.request();</span><span id="542d" class="lt lu iq lo b gy lz lw l lx ly">if (response.code === 5) {<br/>    // DO SOMETHING<br/>}</span></pre><p id="a68d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这里我们可以看到一个神奇的数字。<code class="fe ll lm ln lo b">5</code>意味着一些东西，但是看着源代码，我们真的不能说出那个特定值背后的秘密是什么。</p><p id="8117" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这可以很容易地重构为使用常量，这将使我们更好地理解正在发生什么以及逻辑是如何工作的:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="efe3" class="lt lu iq lo b gy lv lw l lx ly">const ALL_OK = 5;<br/>const response = await API.request();</span><span id="22bf" class="lt lu iq lo b gy lz lw l lx ly">if (response.code === ALL_OK) {<br/>    // DO SOMETHING<br/>}</span></pre><p id="959d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">突然，代码清晰多了！</p><p id="112c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">其他例子可以是:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="42c7" class="lt lu iq lo b gy lv lw l lx ly">const total = price * 1.22;</span></pre><p id="f93a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">同样，<code class="fe ll lm ln lo b">1.22</code>有一些意思，我们通常可以猜测它的意思，但是我们应该<em class="lj">知道</em>到底是什么意思。此外，相同的值可以出现在多个位置。如果我们需要改变它，那么我们只改变一行而不是许多行:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="012e" class="lt lu iq lo b gy lv lw l lx ly">const BASE_TAX = 1.22;</span><span id="55fc" class="lt lu iq lo b gy lz lw l lx ly">const total = price * BASE_TAX;<br/>...<br/>const itemPriceWithTax = itemPrice * BASE_TAX;</span></pre><p id="14e5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果我们知道什么是幻数，我们就可以重构所有代码，使之更加简洁。然而，我们不应该盲目地遵循<a class="ae lk" href="https://eslint.org/docs/rules/no-magic-numbers" rel="noopener ugc nofollow" target="_blank">不允许幻数</a>的规则！</p><p id="5b7d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以说不是所有的数字都是神奇的。例如，HTTP状态代码被很好地定义，并且假设所有代码维护者都有相同的理解，我们可以简单地直接使用这些代码:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="a105" class="lt lu iq lo b gy lv lw l lx ly">throw new HttpError(400, 'Something went wrong! Check your request');</span></pre><p id="9c81" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这种情况下,<code class="fe ll lm ln lo b">400</code>可以转换成常数，但实际上，我们真的觉得这很难理解吗？</p><p id="809d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">另一个不成熟的解决方案是用常量代替id。不好:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="d7bd" class="lt lu iq lo b gy lv lw l lx ly">const stations = [{id: 123}, {id: 456}];</span><span id="ab04" class="lt lu iq lo b gy lz lw l lx ly">const openStation = stations.filter(station =&gt; station.id !== 456);</span></pre><p id="350a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这里我们可以看到我们想要排除id为<code class="fe ll lm ln lo b">456</code>的某个站点，但是为什么这个站点被排除了呢？源代码不会给我们需要的答案。</p><p id="d517" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">稍微好一点:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="fcdb" class="lt lu iq lo b gy lv lw l lx ly">const EXCLUDED_STATIONS = [456];</span><span id="cae0" class="lt lu iq lo b gy lz lw l lx ly">const openStation = stations.filter(station =&gt; !EXCLUDED_STATIONS.includes(station.id));</span></pre><p id="7b27" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们正确地去掉了幻数，但是，我们仍然可以说，一两年后，如果有人进来负责代码维护，他们会发现很难理解为什么这个特定的站被排除在外？</p><p id="b8eb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这种情况下，简单的注释会有所帮助。显然，如果有另一个我们可以使用的属性会有很大的帮助:</p><pre class="kg kh ki kj gt lp lo lq lr aw ls bi"><span id="95e4" class="lt lu iq lo b gy lv lw l lx ly">const stations = [{id: 123, isOpen: true}, {id: 456, isOpen: false}];</span><span id="e303" class="lt lu iq lo b gy lz lw l lx ly">const openStation = stations.filter(station =&gt; station.isOpen);</span></pre><p id="e1f4" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然而，这是数据质量问题的一个例子。如果程序员不能依赖输入的数据，并且没有办法在第一时间纠正数据(例如，没有<code class="fe ll lm ln lo b">isOpen</code>属性)，那么不幸的是，我们需要引入一些黑客技术来解决这个问题。</p><h1 id="6bf6" class="ma lu iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="5506" class="pw-post-body-paragraph kn ko iq kp b kq mr jr ks kt ms ju kv kw mt ky kz la mu lc ld le mv lg lh li ij bi translated">一般来说，代码应该是干净的(说起来容易！)且自明。省略、幻数和用人类可读的常数代替是一个容易的胜利。</p><p id="b6b1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你总是不允许在代码中使用幻数吗？或者你认为这个规则有例外吗？请在下面的评论中告诉我！</p></div></div>    
</body>
</html>