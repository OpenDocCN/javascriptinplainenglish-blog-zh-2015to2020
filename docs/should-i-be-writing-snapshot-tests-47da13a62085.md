# ä½•æ—¶ç¼–å†™ç¬‘è¯å¿«ç…§æµ‹è¯•

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/should-i-be-writing-snapshot-tests-47da13a62085?source=collection_archive---------0----------------------->

## ä»å“ªé‡Œå¼€å§‹ï¼ŒçŸ¥é“ä½•æ—¶ä½¿ç”¨å®ƒä»¬

![](img/22f88b4ae08e4639cab0c245642c8888.png)

Photo by [Jakob Owens](https://unsplash.com/@jakobowens1?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

# å½“æˆ‘åœ¨ç ”ç©¶æµ‹è¯•æ¡†æ¶ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ä¸ React é›†æˆçš„æ¡†æ¶æ—¶ï¼ŒJest æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„é€‰æ‹©ã€‚

Jest çš„ç‰¹å¾ä¹‹ä¸€æ˜¯ä¸€ç§ç§°ä¸ºå¿«ç…§æµ‹è¯•çš„æ–°å·¥å…·ã€‚èµ·åˆï¼Œè¿™å¬èµ·æ¥å¾ˆæœ‰è¶£ï¼Œä½†åœ¨åšäº†æ›´å¤šçš„ç ”ç©¶å¹¶çœ‹åˆ°å¼€å‘è€…çš„è®¸å¤šä¸åŒæ„è§åï¼Œæˆ‘å˜å¾—è°¨æ…èµ·æ¥ã€‚

ä»¥ä¸‹æ˜¯æˆ‘ä»¬å›¢é˜Ÿå¯¹å¿«ç…§æµ‹è¯•çš„çœ‹æ³•ä»¥åŠæˆ‘ä»¬ä»ç»éªŒä¸­å­¦åˆ°çš„ä¸œè¥¿:

*   ä»€ä¹ˆæ—¶å€™å†™ï¼Œ
*   ä¸ºä»€ä¹ˆè¦å†™å®ƒä»¬ï¼Œ
*   å¦‚ä½•åˆ©ç”¨å®ƒä»¬æ¥é˜²æ­¢é€€åŒ–ï¼Ÿ

![](img/62c3b04466cedc0deb052741f013c89b.png)

React + Jest = a match made in heaven!

# å¿«ç…§æµ‹è¯•æ˜¯ Jest çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå…è®¸æ‚¨æµ‹è¯• Javascript å¯¹è±¡ã€‚

å®ƒä»¬ä¸ React ç»„ä»¶é…åˆè‰¯å¥½ï¼Œå› ä¸ºå½“æ‚¨æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ DOM è¾“å‡ºï¼Œå¹¶åœ¨æµ‹è¯•è¿è¡Œæ—¶åˆ›å»º*â€œå¿«ç…§â€*ã€‚è¿™äº›ç±»å‹çš„æµ‹è¯•æœ‰åŠ©äºé˜²æ­¢å›å½’ï¼Œå› ä¸ºå¦‚æœæœ‰ä»»ä½•ä¸œè¥¿å¯¼è‡´ç»„ä»¶æ”¹å˜ï¼Œè¿™ä¸ªæµ‹è¯•å°±ä¼šæŠ“ä½å®ƒã€‚æ ¹æ®æˆ‘ä»¬å›¢é˜Ÿçš„ç»éªŒï¼Œå½“æ‚¨å¯ä»¥å°†é“å…·ä¼ é€’ç»™åŠŸèƒ½ç»„ä»¶å¹¶æµ‹è¯•æœ‰é™æ•°é‡çš„æ¡ˆä¾‹æ—¶ï¼Œå¿«ç…§æµ‹è¯•æ˜¯æœ€æœ‰æ•ˆçš„ã€‚

## ä½•æ—¶å†™å…¥å¿«ç…§æµ‹è¯•

*   å¦‚æœç»„ä»¶ä¸ç»å¸¸æ›´æ–°
*   å¦‚æœä¸€ä¸ªç»„ä»¶ä¸æ˜¯å¤ªå¤æ‚
*   å¦‚æœå¾ˆå®¹æ˜“çœ‹åˆ°æ‚¨å®é™…æµ‹è¯•çš„å†…å®¹

è¿™äº›è§„åˆ™éå¸¸æ¨¡ç³Šï¼Œä½†åº”è¯¥å¯ä»¥å¾ˆå¿«å¸®åŠ©æ‚¨å†³å®šå¿«ç…§æµ‹è¯•æ˜¯å¦åˆé€‚ã€‚

å¦‚æœæ‚¨æœ‰ä¸€ä¸ªæµ‹è¯•ç»å¸¸æ›´æ–°çš„ç»„ä»¶çš„å¿«ç…§æµ‹è¯•ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸æ–­æ›´æ–°é™„å¸¦çš„æµ‹è¯•ã€‚å¦‚æœæ‚¨å…»æˆäº†åªæ›´æ–°è¿™äº›æµ‹è¯•è€Œä¸ä»”ç»†æ£€æŸ¥è¾“å‡ºæ–‡ä»¶çš„åä¹ æƒ¯ï¼Œè¿™äº›æµ‹è¯•å°±ä¼šå¤±å»å®ƒä»¬çš„ä»·å€¼ã€‚

å¦‚æœä¸€ä¸ªç»„ä»¶å¤ªå¤æ‚ï¼Œå°±å¾ˆéš¾ç¡®å®šå®é™…æµ‹è¯•çš„æ˜¯ä»€ä¹ˆã€‚å¦‚æœåœ¨æ¸²æŸ“ä¹‹å‰æœ‰å¤§é‡çš„ä¸šåŠ¡é€»è¾‘å’Œæ¡ä»¶è¯­å¥ï¼Œé‚£ä¹ˆæ²¡æœ‰ä½¿ç”¨è¯¥åŠŸèƒ½çš„äººæ€ä¹ˆçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ

ç¼–å†™å¿«ç…§æµ‹è¯•æ—¶è¦è®°ä½çš„æœ€é‡è¦çš„è§„åˆ™æ˜¯ç»™æµ‹è¯•å‘½åã€‚å¦‚æœæ‚¨ä¸èƒ½è½»æ¾å‡†ç¡®åœ°å‘½åæ‚¨çš„æµ‹è¯•ï¼Œå¾ˆå¯èƒ½å®ƒä¸åº”è¯¥æ˜¯å¿«ç…§æµ‹è¯•ã€‚

# å¿«ç…§æµ‹è¯•ç¤ºä¾‹

**spinner.spec.js** ä½¿ç”¨[ååº”-æµ‹è¯•-åº“](https://medium.com/@chrisgirard/testing-components-with-jest-and-react-testing-library-d36f5262cde2)

```
// Spinner component
const Spinner = props => (
 props.loading ?
  <div className={`icon icon-spin text-center ${props.size} ${props.color}} />
  : null)

export default Spinner;// Spinner spec
describe('Spinner snapshot test ', () => {
    it('should render a large blue spinner', () => {
        const props = {
            loading: true,
            size: "large",
            color: "blue"
        };const container = render(<Spinner {...props} />);
        expect(container.firstChild).toMatchSnapshot();
    })
})
```

**spinner.spec.js.snap**

```
// Jest Snapshot v1exports[`<Spinner /> Snapshot Tests renders as expected 1`] = `
<div
  class="icon icon-spin icon-large icon-blue"
/>
```

è¿™æ˜¯å‘ˆç°å¾®è°ƒå™¨ç»„ä»¶çš„å¿«ç…§æµ‹è¯•çš„ç®€å•ç¤ºä¾‹ã€‚æŸ¥çœ‹ã€‚æ•æ‰è¾“å‡ºæ–‡ä»¶å¹¶çœ‹åˆ°ä¸€ä¸ªæ¸…æ™°çš„æµ‹è¯•åç§°ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°æˆ‘ä»¬æœŸæœ›æ¸²æŸ“ä¸€ä¸ªå¤§çš„è“è‰²å¾®è°ƒå™¨ç»„ä»¶ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿«ç…§æµ‹è¯•çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæœ‰äººå°†å¾®è°ƒå™¨ä» div æ›´æ”¹ä¸º spanï¼Œæµ‹è¯•å°†å¤±è´¥ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç¼–å†™å¿«ç…§æµ‹è¯•ï¼Œæˆ‘ä»¬å¯èƒ½åªä¼šæ–­è¨€å¤§å°å’Œé¢œè‰²åº”ç”¨æ­£ç¡®ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªå¿«ç…§æ–­è¨€çš„ç¤ºä¾‹ã€‚å¦‚æœåŠ è½½æ˜¯å‡çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸åº”è¯¥æ¸²æŸ“ç»„ä»¶å¹¶è¿”å› nullã€‚

**spinner.spec.js**

```
it('should render a large blue spinner', () => {
    const props = {
        loading: true,
        size: "large",
        color: "blue"
    };const container = render(<Spinner {...props} />);
    expect(container.firstChild).toMatchSnapshot();
})it('should return null if loading is false', () => {
    const props = {
        loading: false
    };const container = render(<Spinner {...props} />);
    expect(container.firstChild).toMatchSnapshot();
})
```

**spinner.spec.js.snap**

```
// Jest Snapshot v1exports[`<Spinner /> should render a large blue spinner 1`] = `
<div
  class="icon icon-spin icon-large icon-blue"
/>;exports[`<Spinner /> should return null if loading is false 1`] = `
null;
```

çœ‹ spinner.spec.jsï¼Œä¸æ¸…æ¥šæµ‹è¯•çš„æ˜¯ä»€ä¹ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéªŒè¯ spinner.spec.js.snap æ–‡ä»¶å¹¶æ£€æŸ¥è¾“å‡ºå¦‚æ­¤é‡è¦ã€‚

# æ›´æ–°å¿«ç…§æµ‹è¯•

æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ›å»ºå¿«ç…§æµ‹è¯•æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª. snap å¼•ç”¨æ–‡ä»¶ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½é’ˆå¯¹è¿™ä¸ªæ–‡ä»¶è¿è¡Œæ‚¨çš„æµ‹è¯•ã€‚å¦‚æœæˆ‘ä»¬çš„ç»„ä»¶è¢«æ›´æ”¹ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨æ›´æ–°å¿«ç…§æµ‹è¯•ã€‚

```
jest --updateSnapshot
```

## èµ°å‘

å¸Œæœ›æ‚¨èƒ½ä»æˆ‘ä»¬çš„å¿«ç…§æµ‹è¯•ç»éªŒä¸­è·å¾—ä¸€äº›è¦ç‚¹å’Œå»ºè®®ã€‚å½“å°†è¿™ç§ç±»å‹çš„æµ‹è¯•å¼•å…¥åˆ°æ‚¨è‡ªå·±çš„é¡¹ç›®ä¸­æ—¶ï¼Œè¯·è®°ä½:

*   åˆ›å»ºå¹¶éµå¾ªæ‚¨è‡ªå·±çš„å…³äºä½•æ—¶ç¼–å†™å¿«ç…§æµ‹è¯•çš„è§„åˆ™
*   éªŒè¯ç»„ä»¶æ˜¯å¦åœ¨è¾“å‡ºæ–‡ä»¶ä¸­æ­£ç¡®å‘ˆç°
*   åœ¨ä»£ç å®¡æŸ¥ä¸­è¦ä¸¥æ ¼

æˆ‘ä»¬çš„å›¢é˜Ÿä½¿ç”¨ [React æµ‹è¯•åº“](https://medium.com/@chrisgirard/testing-components-with-jest-and-react-testing-library-d36f5262cde2)ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä¸­ä¸ä½¿ç”¨æµ…å±‚æ¸²æŸ“ã€‚å½“ç¼–å†™å¿«ç…§æµ‹è¯•æ—¶ï¼Œå¦‚æœæˆ‘ä»¬çš„çˆ¶ç»„ä»¶æœ‰è®¸å¤šå­ç»„ä»¶ï¼Œé‚£ä¹ˆè¿™äº›å­ç»„ä»¶ä¹Ÿä¼šè¢«æ¸²æŸ“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•æ¥å¿«é€ŸéªŒè¯æ•´ä¸ªç»„ä»¶æ˜¯å¦è¢«æ¸²æŸ“ï¼Œå¦ä¸€æ–¹é¢ï¼Œç”±æˆ‘ä»¬æ¥æ£€æŸ¥ç»„ä»¶æ˜¯å¦è¢«æ­£ç¡®æ¸²æŸ“ã€‚

é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿåœ¨å®¡æŸ¥è¿™äº›ç±»å‹çš„æµ‹è¯•æ—¶å˜å¾—æ›´åŠ ä¸¥æ ¼ã€‚æˆ‘ä»¬ç¡®åˆ‡åœ°çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–åŠå…¶åŸå› ã€‚æˆ‘ä»¬å€¾å‘äºç¼–å†™å¿«ç…§æµ‹è¯•ï¼Œä½œä¸ºå…±äº« React ç»„ä»¶çš„*æ€»æ‹¬*ã€‚

æ‹ç…§å¿«ä¹ï¼ğŸ“¸