<html>
<head>
<title>JavaScript Problems — Read JSON Files, Time Zone Offsets, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript问题—读取JSON文件、时区偏移等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-problems-read-json-files-time-zone-offsets-and-more-83740e588cbb?source=collection_archive---------12-----------------------#2020-06-27">https://javascript.plainenglish.io/javascript-problems-read-json-files-time-zone-offsets-and-more-83740e588cbb?source=collection_archive---------12-----------------------#2020-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/44c25cd82fff9a80be518a1dfcebfb0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hVysqg18v7AuWGoL"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@marinajune?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">marina</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7a46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写JavaScript应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些常见JavaScript问题的解决方案。</p><h1 id="49ed" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">读取节点应用程序中的JSON文件</h1><p id="d119" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">readFile</code>或<code class="fe me mf mg mh b">readFileSync</code>来读取文件。</p><p id="524c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们使用<code class="fe me mf mg mh b">JSON.parse</code>来解析读取的JSON。</p><p id="242c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a4ac" class="mq lc iq mh b gy mr ms l mt mu">const fs = require('fs');<br/>const obj = JSON.parse(fs.readFileSync('file', 'utf8'));</span></pre><p id="23ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">readFileSync</code>同步读取文件，以字符串形式返回文本数据。</p><p id="baf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们使用<code class="fe me mf mg mh b">JSON.parse</code>来解析数据。</p><p id="60fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想异步读取一个文件，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="371c" class="mq lc iq mh b gy mr ms l mt mu">const fs = require('fs');<br/>const obj;<br/>fs.readFile('file', 'utf8', (err, data) =&gt; {<br/>  if (err) throw err;<br/>  obj = JSON.parse(data);<br/>});</span></pre><p id="128b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文本字符串在<code class="fe me mf mg mh b">data</code>参数中，而不是返回值中。</p><h1 id="cc09" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">处理浮点数精度</h1><p id="d27b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果用浮点数做算术，可能会得到意想不到的结果。</p><p id="35a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="db8a" class="mq lc iq mh b gy mr ms l mt mu">0.1 * 0.2</span></pre><p id="02aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0ee1" class="mq lc iq mh b gy mr ms l mt mu">0.020000000000000004</span></pre><p id="12ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而不是0.02。</p><p id="f252" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们需要精确的结果，那么我们不能使用浮点运算的内置数字类型。</p><p id="0a7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想隐藏小数位，我们可以使用<code class="fe me mf mg mh b">toFixed</code>、<code class="fe me mf mg mh b">toPrecision</code>、<code class="fe me mf mg mh b">Math.trunc</code>、<code class="fe me mf mg mh b">Math.floor</code>或<code class="fe me mf mg mh b">Math.ceil</code>方法来隐藏小数位。</p><p id="2ce4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三种选择是只使用整数。</p><h1 id="01b0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用JavaScript获取图像大小</h1><p id="bbc3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">clientWidth</code>和<code class="fe me mf mg mh b">clientHeight</code>属性来获取图像的宽度和高度。</p><p id="5b8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="73e7" class="mq lc iq mh b gy mr ms l mt mu">const img = document.getElementById('image'); <br/>const width = img.clientWidth;<br/>const height = img.clientHeight;</span></pre><p id="9aa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们获取ID为<code class="fe me mf mg mh b">image</code>的img元素，并获取那些属性。</p><p id="6795" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有一个<code class="fe me mf mg mh b">Image</code>实例，我们可以得到<code class="fe me mf mg mh b">width</code>和<code class="fe me mf mg mh b">height</code>属性:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a4ad" class="mq lc iq mh b gy mr ms l mt mu">const img = new Image();<br/>img.onload = () =&gt; {<br/>  console.log(this.width, this.height);<br/>}<br/>img.src = 'http://placekitten.com/200/200'</span></pre><h1 id="4d15" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">转义HTML字符串</h1><p id="5bb2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用jQuery的<code class="fe me mf mg mh b">text</code>方法对HTML字符串进行转义。</p><p id="30ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2d9d" class="mq lc iq mh b gy mr ms l mt mu">const someHtmlString = "&lt;script&gt;alert('hi');&lt;/script&gt;";<br/>$("div").text(someHtmlString);</span></pre><p id="aa75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个包含JavaScript代码的字符串。</p><p id="a2f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">text</code>方法将返回字符串的转义版本。</p><p id="fcf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用转义的HTML内容替换div的内容。</p><h1 id="2db0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取客户端的时区偏移量</h1><p id="2747" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">Date</code>实例使用<code class="fe me mf mg mh b">getTimezoneOffset</code>方法从客户端计算机获取时区偏移量。</p><p id="63bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fc9e" class="mq lc iq mh b gy mr ms l mt mu">const offset = new Date().getTimezoneOffset();<br/>console.log(offset);</span></pre><p id="2f9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到以分钟为单位的偏移量。偏移量是UTC和当地时区之间的时差。</p><p id="5644" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它是UTC时间减去当前时区的时间。</p><p id="248b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">时区不能偏移一小时。有些时区，如纽芬兰时区，比UTC晚3.5小时。</p><h1 id="8013" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">访问Javascript对象的第一个属性</h1><p id="80f2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">Object.kets</code>方法访问JavaScript对象的第一个属性来获取对象的键。</p><p id="584c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一个数组，所以我们可以用index 0来获取索引。</p><p id="e275" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3c3f" class="mq lc iq mh b gy mr ms l mt mu">const obj = { foo: 'bar' };<br/>obj[Object.keys(obj)[0]];</span></pre><p id="6d9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe me mf mg mh b">Object.keys(obj)[0]</code>就是<code class="fe me mf mg mh b">'foo'</code>，所以我们得到<code class="fe me mf mg mh b">'bar'</code>。</p><p id="6abc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从ES2015开始保证密钥的顺序。非数字键应该按照插入顺序返回。</p><h1 id="9753" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在节点计算机中产生工作线程</h1><p id="0c15" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">cluster</code>模块在我们的机器中创建工人。</p><p id="3b48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6cfd" class="mq lc iq mh b gy mr ms l mt mu">const numCPUs = require('os').cpus().length;<br/>if (cluster.isMaster) {<br/>  for (let i = 0; i &lt; numCPUs; i++) {<br/>    cluster.fork();<br/>  }<br/>} else {<br/>  http.Server((req, res) =&gt; { ... }).listen(8000);<br/>}</span></pre><p id="c891" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果工作者不是主服务器，那么我们就产生一个新的HTTP服务器。</p><p id="30fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们通过调用<code class="fe me mf mg mh b">cluster.fork()</code>来产生工人。</p><p id="d83b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以在同一台机器上运行多个节点应用程序。</p><h1 id="a98f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">查看在元素上激发的事件</h1><p id="ae1f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要查看一个元素触发的事件，我们可以通过按F12进入开发控制台。</p><p id="a50d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们单击Sources选项卡。</p><p id="a59e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在右侧，我们通过BVreakpoints和exp[以及树展开事件监听器。</p><p id="551d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们点击我们想要收听的事件。</p><p id="34a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以与我们想要检查的元素进行交互，如果事件被触发，我们将从调试器中获得断点。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/e0a639c43e8fa8072d3380ebae6b3cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*prANy3CBS1AP_xBw"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@yucar?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">YUCAR FotoGrafik</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="bac3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="c0e7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用内置属性得到图像的尺寸。</p><p id="cdbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使调试更容易，我们可以在控制台中查看事件。</p><p id="9780" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JSON文件可以在节点应用中读取和解析。</p><h2 id="8027" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="578f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到它们订阅我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>