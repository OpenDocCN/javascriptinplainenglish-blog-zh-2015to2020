<html>
<head>
<title>Integrating MapBox with Next.js — the Cheaper Alternative to Google Maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">整合MapBox和next . js——谷歌地图的廉价替代品</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integrating-mapbox-with-next-js-the-cheaper-alternative-to-google-maps-460e4c2e6efc?source=collection_archive---------1-----------------------#2020-10-23">https://javascript.plainenglish.io/integrating-mapbox-with-next-js-the-cheaper-alternative-to-google-maps-460e4c2e6efc?source=collection_archive---------1-----------------------#2020-10-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1846" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用MapBox的搜索API和地图API构建一个带有可点击图钉的交互式地图</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c0300f0612536e9f284fc3926ab7181e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PhGDa3ZlSoR5EsRKy3OAw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@waldemarbrandt67w?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Waldemar Brandt</a> on <a class="ae ks" href="https://unsplash.com/s/photos/google-maps?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6a99" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最近，我一直致力于创建一个<a class="ae ks" href="https://sustaynably.com" rel="noopener ugc nofollow" target="_blank">生态旅游平台</a>，并发现自己需要用一些可点击的标记针来绘制地图(我们将在本教程中重现)。在搜索了互联网上可能的解决方案后，两个直接的选择出现了——谷歌地图和地图盒子。虽然我们大多数人都熟悉谷歌地图，因为它在我们的生活中无处不在，但我发现，将它集成到应用程序中并不理想。建立一个自举项目，我想保持成本最低，谷歌地图的<a class="ae ks" href="https://cloud.google.com/maps-platform/pricing" rel="noopener ugc nofollow" target="_blank">定价结构</a>将意味着成本将开始增加。</p><h1 id="22ac" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated"><strong class="ak">进入MapBox！</strong></h1><p id="e898" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">凭借具有竞争力的<a class="ae ks" href="https://www.mapbox.com/pricing/" rel="noopener ugc nofollow" target="_blank">定价结构</a>(网上前50，000个请求是免费的)和易于使用且记录良好的API，MapBox是谷歌地图的一个很好的替代品。它也是建立在开源地图项目<a class="ae ks" href="https://www.openstreetmap.org/" rel="noopener ugc nofollow" target="_blank"> OpenStreetMap </a>之上的。赢了，赢了！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/6c696e0638bf8cb16dc27b0b66ee5fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6KeyzKzi4JDJpXZV_4bew.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Comparison between MapBox and Google Maps. <a class="ae ks" href="https://www.mapbox.com/use-cases/store-locator/" rel="noopener ugc nofollow" target="_blank">Source</a>.</figcaption></figure><h1 id="4e66" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated"><strong class="ak">我们在建造什么？</strong></h1><p id="342e" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们将查询MapBox的搜索api，以获取一家名为Greggs的臭名昭著的咖啡店的一些位置，将我们的搜索集中在大伦敦地区。然后，我们将在我们的MapBox <code class="fe mn mo mp mq b">&lt;Map&gt;</code>组件中用一串可点击的标记来呈现这些地方。点击时，这些标记会显示一些可忽略的弹出窗口。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mr"><img src="../Images/9756610e061aa6fdacb1ed7b57f50d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9YWdT33rQihjv-5wxS8GQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The finished project will look something like this</figcaption></figure><h1 id="359d" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">我们来编码吧！</h1><h2 id="4111" class="ms lq in bd lr mt mu dn lv mv mw dp lz lc mx my mb lg mz na md lk nb nc mf nd bi translated">创建一个MapBox帐户以获取您的访问令牌</h2><p id="cd33" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">你需要做的第一件事是<a class="ae ks" href="https://account.mapbox.com/auth/signup/" rel="noopener ugc nofollow" target="_blank">创建一个MapBox帐户</a>，这样你就可以获得一个访问令牌。我们将使用这个令牌向各种MapBox APIs发出请求。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/50d22634dac022729c4953b52b8f7ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPb9R-60T5u5lbufuqdaaw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">This is usually the first thing you will see when you sign up for a MapBox account</figcaption></figure><p id="2927" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦有了访问令牌，就该建立自己的Next.js项目并集成MapBox提供的所有有趣功能了。</p><h2 id="fb07" class="ms lq in bd lr mt mu dn lv mv mw dp lz lc mx my mb lg mz na md lk nb nc mf nd bi translated">建立一个新的Next.js项目(如果您已经有了自己的项目，请跳过这一步)</h2><p id="9ba6" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">建立一个Next.js项目很简单，你可以按照<a class="ae ks" href="https://nextjs.org/learn/basics/create-nextjs-app" rel="noopener ugc nofollow" target="_blank">官方文档</a>中的说明或者运行下面的命令来建立一个新的Next.js项目(确保你已经安装了Node.js)。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="f3e5" class="ms lq in mq b gy nj nk l nl nm">npx create-next-app mapbox-project</span></pre><p id="fc89" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，cd进入<code class="fe mn mo mp mq b">mapbox-project</code>目录，并通过运行<code class="fe mn mo mp mq b">npm run dev</code>或<code class="fe mn mo mp mq b">yarn dev</code>来运行开发服务器。瞧啊。您的Next.js项目已经启动并运行了！</p><h2 id="4ef6" class="ms lq in bd lr mt mu dn lv mv mw dp lz lc mx my mb lg mz na md lk nb nc mf nd bi translated">设置地图框地图</h2><p id="8561" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">接下来，是时候在我们的项目中渲染一个MapBox地图了。我们通过添加一个由优步团队<code class="fe mn mo mp mq b">react-map-gl</code>编写的<a class="ae ks" href="https://github.com/visgl/react-map-gl" rel="noopener ugc nofollow" target="_blank">地图框库</a>来实现这一点。这包含一套用于MapBox的React组件。通过运行以下命令将此库添加到您的项目中:</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="e51d" class="ms lq in mq b gy nj nk l nl nm">yarn add react-mapbox-gl</span></pre><p id="4572" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这样，我们将创建一个位于<code class="fe mn mo mp mq b">components/Map.js</code>的地图组件。</p><p id="dfe2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建Map.js文件，并向其中添加以下代码:</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="beab" class="ms lq in mq b gy nj nk l nl nm">import { useState } from "react";<br/>import ReactMapGL from "react-map-gl";</span><span id="588c" class="ms lq in mq b gy nn nk l nl nm">export default function Map() {<br/>  const [viewport, setViewport] = useState({<br/>  width: "100%",<br/>  height: "100%",<br/>  <em class="no">// The latitude and longitude of the center of London<br/>  </em>latitude: 51.5074,<br/>  longitude: -0.1278,<br/>  zoom: 10<br/>});</span><span id="76d0" class="ms lq in mq b gy nn nk l nl nm">return &lt;ReactMapGL<br/>  mapStyle="mapbox://styles/mapbox/streets-v11"<br/>  mapboxApiAccessToken={process.env.MAPBOX_KEY}<br/>  {...viewport}<br/>  onViewportChange={(nextViewport) =&gt; setViewport(nextViewport)}<br/>  &gt;<br/>&lt;/ReactMapGL&gt;<br/>}</span></pre><p id="d652" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这还不行。Next.js最大的特性之一是它提供的服务器端渲染。然而，MapBox需要全局窗口对象才能正常工作。如果您在服务器端渲染您的应用程序，您将需要动态地将其导入到您的页面。这意味着不是像常规组件一样导入它，</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="faef" class="ms lq in mq b gy nj nk l nl nm">import Map from '../components/Map'</span></pre><p id="4687" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将不得不动态导入它。我们将通过使用Next.js <code class="fe mn mo mp mq b">dynamic imports</code>来做到这一点。</p><p id="8602" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在您的<code class="fe mn mo mp mq b">pages/index.js</code>文件中(或者您正在渲染地图组件的任何地方)添加以下代码。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="d516" class="ms lq in mq b gy nj nk l nl nm">const Map = dynamic(() =&gt; import("../components/Map"), {<br/>  loading: () =&gt; "Loading...",<br/>  ssr: false<br/>});</span></pre><p id="18f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这意味着我们的MapBox组件现在将有选择地呈现在客户端。完美！</p><p id="ba69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们现在唯一需要做的就是将MapBox的CSS文件添加到我们的项目中。最简单的方法是修改现有的<code class="fe mn mo mp mq b">_app.js</code>或者添加一个定制的<code class="fe mn mo mp mq b">_document.js</code>文件。然后在你的渲染函数中添加一个CSS到<code class="fe mn mo mp mq b">&lt;Head&gt;</code>的链接。你可以在他们的<a class="ae ks" href="https://docs.mapbox.com/mapbox-gl-js/api/" rel="noopener ugc nofollow" target="_blank"> API文档</a>中获得CSS文件的最新版本。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="da2f" class="ms lq in mq b gy nj nk l nl nm">&lt;head&gt;<br/>&lt;link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' /&gt;<br/>&lt;/head&gt;</span></pre><p id="2ffc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">完美。您的地图现在应该已经启动并运行了！让我们更进一步，尝试在地图上绘制一些可点击的大头针。</p><h2 id="2de7" class="ms lq in bd lr mt mu dn lv mv mw dp lz lc mx my mb lg mz na md lk nb nc mf nd bi translated">使用MapBox的搜索API获取地标列表</h2><p id="d558" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">MapBox有一个非常方便的地理编码API，你可以用它来获取一个位置列表，包括它们的纬度和经度。我们将获取伦敦Greggs(一家外卖快餐和咖啡店)的列表，并将它们作为图钉呈现在我们的地图上。</p><p id="8c46" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，让我们通过向Mapbox地理编码API添加一个简单的fetch调用来查询我们的列表。我们希望在伦敦的地理范围内进行搜索，并希望我们的搜索结果不超过10个(伦敦很大，伦敦人喜欢他们的格雷格素食香肠卷。我们不想被所有的可能性淹没！).MapBox的地理编码地点搜索API采用以下参数，以及一些附加的查询字符串。在这里阅读文档<a class="ae ks" href="https://docs.mapbox.com/api/search/" rel="noopener ugc nofollow" target="_blank"/>！</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="b3e6" class="ms lq in mq b gy nj nk l nl nm">/geocoding/v5/mapbox.places/<strong class="mq io">{search_text}</strong>.json</span></pre><p id="5d19" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将使用<code class="fe mn mo mp mq b">limit</code>查询参数将结果限制在10，使用<code class="fe mn mo mp mq b">bbox</code>参数指定伦敦的纬度和经度范围。</p><p id="0787" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">考虑到这一点，我们的搜索url将如下所示:</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="58d7" class="ms lq in mq b gy nj nk l nl nm">https://api.mapbox.com/geocoding/v5/mapbox.places/greggs.json?access_token=${process.env.MAPBOX_KEY}&amp;bbox=-0.227654%2C51.464102%2C0.060737%2C51.553421&amp;limit=10</span></pre><p id="3a92" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以使用这个url，在我们的页面中进行一个简单的获取调用。我们修改后的页面现在看起来像这样，</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="cc93" class="ms lq in mq b gy nj nk l nl nm">const Map = dynamic(() =&gt; import("../components/Map"), {<br/>  loading: () =&gt; "Loading...",<br/>  ssr: false<br/>});</span><span id="0b0d" class="ms lq in mq b gy nn nk l nl nm">const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/greggs.json?access_token=${process.env.MAPBOX_KEY}&amp;bbox=-0.227654%2C51.464102%2C0.060737%2C51.553421&amp;limit=10`;</span><span id="cbee" class="ms lq in mq b gy nn nk l nl nm">export default function IndexPage() {</span><span id="80f9" class="ms lq in mq b gy nn nk l nl nm">  const [locations, setLocations] = useState([]);</span><span id="a173" class="ms lq in mq b gy nn nk l nl nm">  useEffect(() =&gt; {<br/>    const fetchLocations = async () =&gt; {<br/>      await fetch(url).then((response) =&gt;<br/>        response.text()).then((res) =&gt; JSON.parse(res))<br/>      .then((json) =&gt; {<br/>        setLocations(json.features);<br/>      }).catch((err) =&gt; console.log({ err }));<br/>    };<br/>    fetchLocations();<br/>  }, []);</span><span id="1d34" class="ms lq in mq b gy nn nk l nl nm">  return (&lt;Container&gt;<br/>    &lt;Map /&gt;<br/>  &lt;/Container&gt;);<br/>}</span></pre><p id="6f87" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们现在有10个格雷格的位置列表！</p><h2 id="eb51" class="ms lq in bd lr mt mu dn lv mv mw dp lz lc mx my mb lg mz na md lk nb nc mf nd bi translated">使用我们的搜索结果在地图上呈现图钉</h2><p id="3982" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">现在我们有了一个地点列表，我们可以在地图上呈现这些地点。<code class="fe mn mo mp mq b">react-map-gl</code>带有一个方便的<code class="fe mn mo mp mq b">&lt;Marker&gt;</code>组件，使得我们的任务非常简单。首先，我们需要将这些位置传递给我们的<code class="fe mn mo mp mq b">&lt;Map&gt;</code>组件。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="fb88" class="ms lq in mq b gy nj nk l nl nm">return (&lt;Container&gt;<br/>    &lt;Map locations={locations} /&gt;<br/>  &lt;/Container&gt;);</span></pre><p id="7155" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，在我们的地图组件中，我们需要通过将这些位置的纬度和经度传递给<code class="fe mn mo mp mq b">&lt;Marker&gt;</code>组件来呈现每个位置的pin。</p><p id="6876" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们最终的地图组件看起来会像这样，</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="4327" class="ms lq in mq b gy nj nk l nl nm">import { useState } from "react";<br/>import ReactMapGL, { Marker } from "react-map-gl";</span><span id="8751" class="ms lq in mq b gy nn nk l nl nm">export default function Map({ locations }) {<br/>  const [viewport, setViewport] = useState({<br/>    width: "100%",<br/>    height: "100%",<br/>    <em class="no">// The latitude and longitude of the center of London<br/>    </em>latitude: 51.5074,<br/>    longitude: -0.1278,<br/>    zoom: 10<br/>  });</span><span id="1909" class="ms lq in mq b gy nn nk l nl nm">return &lt;ReactMapGL<br/>  mapStyle="mapbox://styles/mapbox/streets-v11"<br/>  mapboxApiAccessToken={process.env.MAPBOX_KEY}<br/>  {...viewport}<br/>  onViewportChange={(nextViewport) =&gt; setViewport(nextViewport)}<br/>  &gt;<br/>  {locations.map((location) =&gt; (<br/>    &lt;div key={location.id}&gt;<br/>      &lt;Marker<br/>      latitude={location.center[1]}<br/>      longitude={location.center[0]}<br/>      offsetLeft={-20}<br/>      offsetTop={-10}&gt;<br/>        &lt;span role="img" aria-label="push-pin"&gt;📌&lt;/span&gt;<br/>      &lt;/Marker&gt;<br/>    &lt;/div&gt;<br/>  ))}<br/>&lt;/ReactMapGL&gt;<br/>}</span></pre><h2 id="0a35" class="ms lq in bd lr mt mu dn lv mv mw dp lz lc mx my mb lg mz na md lk nb nc mf nd bi translated">使大头针可点击</h2><p id="542c" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们快到了！我们要做的最后一件事是添加一个带有地名的弹出窗口，以使这些地图完全发挥作用并具有交互性。同样，Mapbox附带了一个方便的<code class="fe mn mo mp mq b">Popup</code>组件，使得这一点很容易做到。我们将简单地向我们的pins添加一个onClick处理程序，它将捕获所选位置的细节，然后我们将把所选位置的纬度和经度传递给我们的<code class="fe mn mo mp mq b">&lt;Popup&gt;</code>组件。一会儿就清楚了！</p><p id="e05d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在地图组件中，添加一个<code class="fe mn mo mp mq b">useState</code>钩子来捕获所选位置。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="1a58" class="ms lq in mq b gy nj nk l nl nm">export default function Map({ locations }) {</span><span id="b4ed" class="ms lq in mq b gy nn nk l nl nm">  // UseState hook<br/>  const [selectedLocation, setSelectedLocation] = useState({})</span><span id="c797" class="ms lq in mq b gy nn nk l nl nm">  const [viewport, setViewport] = useState({<br/>    width: "100%",<br/>    height: "100%",<br/>    <em class="no">// The latitude and longitude of the center of London<br/>    </em>latitude: 51.5074,<br/>    longitude: -0.1278,<br/>    zoom: 10<br/>  });</span><span id="af3e" class="ms lq in mq b gy nn nk l nl nm">......</span></pre><p id="34ec" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们还将修改render块，添加一个onClick处理程序和我们刚刚提到的<code class="fe mn mo mp mq b">&lt;Popup&gt;</code>组件。</p><pre class="kd ke kf kg gt nf mq ng nh aw ni bi"><span id="bc30" class="ms lq in mq b gy nj nk l nl nm">......</span><span id="1db8" class="ms lq in mq b gy nn nk l nl nm">return &lt;ReactMapGL<br/>  mapStyle="mapbox://styles/mapbox/streets-v11"<br/>  mapboxApiAccessToken={process.env.MAPBOX_KEY}<br/>  {...viewport}<br/>  onViewportChange={(nextViewport) =&gt; setViewport(nextViewport)}<br/>  &gt;<br/>  {locations.map((location) =&gt; (<br/>    &lt;div key={location.id}&gt;<br/>      &lt;Marker<br/>      latitude={location.center[1]}<br/>      longitude={location.center[0]}<br/>      offsetLeft={-20}<br/>      offsetTop={-10}&gt;<br/>        &lt;a onClick={() =&gt; {<br/>          setSelectedLocation(location);<br/>        }}&gt;<br/>          &lt;span role="img" aria-label="push-pin"&gt;📌&lt;/span&gt;<br/>        &lt;/a&gt;<br/>      &lt;/Marker&gt;<br/>      {selectLocation.id === location.id ? (<br/>      &lt;Popup<br/>      onClose={() =&gt; setSelectedLocation({})}<br/>      closeOnClick={true}<br/>      latitude={location.center[1]}<br/>      longitude={location.center[0]}&gt;<br/>        {location.place_name}<br/>      &lt;/Popup&gt;) : (false)}<br/>    &lt;/div&gt;<br/>  ))}<br/>&lt;/ReactMapGL&gt;<br/>}</span></pre><p id="9bee" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mn mo mp mq b">&lt;Popup&gt;</code>组件接受一个onClose处理程序，该处理程序将selectedLocation设置为<code class="fe mn mo mp mq b">{}</code>。</p><p id="ae2d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">仅此而已！我们已经成功地绘制了一张地图，在地图上绘制了一些图钉，并成功地用弹出窗口点击它们！这是我们的最终结果:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mr"><img src="../Images/9756610e061aa6fdacb1ed7b57f50d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9YWdT33rQihjv-5wxS8GQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The finished project</figcaption></figure><p id="0e80" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我还为整个项目制作了一个<a class="ae ks" href="https://codesandbox.io/s/loving-frost-7nhgn" rel="noopener ugc nofollow" target="_blank">代码沙箱，所以如果有什么不合理的地方，请随意查看！</a></p><p id="b22d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">编码快乐！</p></div></div>    
</body>
</html>