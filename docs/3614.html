<html>
<head>
<title>Customize Auth0 with Rules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用规则自定义Auth0</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/customize-auth0-with-rules-cbc1f063d12e?source=collection_archive---------13-----------------------#2020-10-12">https://javascript.plainenglish.io/customize-auth0-with-rules-cbc1f063d12e?source=collection_archive---------13-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="15c9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用定制的JavaScript规则让Auth0为您的应用程序工作</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2c4992538e9a51b4de06c451fc426724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rwGC5TJ_pPl1KCqORy1Jgw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Made by the author in <a class="ae kv" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank">Canva</a></figcaption></figure><p id="2cf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您对在您的应用程序中使用Auth0感兴趣吗？担心它不够灵活，无法满足您的所有需求或要求？这是一个合理的担忧。现成的解决方案通常不够灵活，无法满足每个人的需求。幸运的是，Auth0提供了一种用JavaScript规则添加定制行为的简单方法。</p><p id="96f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Auth0的站点为规则提供了以下定义:<em class="ls">“规则是任意的JavaScript代码，可用于在对用户进行身份验证时扩展Auth0的默认行为。作为身份验证过程的最后一步，将按照下面显示的顺序为所有用户和客户端执行启用的规则。"</em></p><p id="2440" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个强大的概念，可以让Auth0满足您的需求。我使用Auth0来处理身份管理，同时为我工作的初创公司构建技术平台。到目前为止，它已经足够灵活，可以满足出现的每一个需求，并且它非常适合我们的全栈JavaScript开发。</p><p id="18c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将通过一些例子来说明如何使用这些规则，并展示一些可能性。</p><p id="3ebf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您对Auth0的更多介绍或者将Auth0集成到React应用程序或NodeJS API的指南感兴趣，请查看下面链接的我以前的文章。</p><div class="lt lu gp gr lv lw"><a href="https://medium.com/javascript-in-plain-english/securing-react-applications-with-auth0-333180f8ea06" rel="noopener follow" target="_blank"><div class="lx ab fo"><div class="ly ab lz cl cj ma"><h2 class="bd ir gy z fp mb fr fs mc fu fw ip bi translated">使用Auth0保护React应用程序</h2><div class="md l"><h3 class="bd b gy z fp mb fr fs mc fu fw dk translated">使用Auth0引导新React应用程序的指南</h3></div><div class="me l"><p class="bd b dl z fp mb fr fs mc fu fw dk translated">medium.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk kp lw"/></div></div></a></div><div class="lt lu gp gr lv lw"><a href="https://medium.com/javascript-in-plain-english/securing-a-node-js-api-with-auth0-7785a8f2c8e3" rel="noopener follow" target="_blank"><div class="lx ab fo"><div class="ly ab lz cl cj ma"><h2 class="bd ir gy z fp mb fr fs mc fu fw ip bi translated">使用Auth0保护Node.js API</h2><div class="md l"><h3 class="bd b gy z fp mb fr fs mc fu fw dk translated">使用Auth0设置Node.js API的指南</h3></div><div class="me l"><p class="bd b dl z fp mb fr fs mc fu fw dk translated">medium.com</p></div></div><div class="mf l"><div class="ml l mh mi mj mf mk kp lw"/></div></div></a></div></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="9bd3" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">这么多规则…</h1><p id="3252" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">Auth0提供了一个很长的规则模板列表，您可以使用它作为创建自己的定制规则的起点。列表相当大，其中一些选项包括:</p><ul class=""><li id="a05a" class="nq nr iq ky b kz la lc ld lf ns lj nt ln nu lr nv nw nx ny bi translated">从您自己的数据库添加用户角色</li><li id="f73a" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">基于您自己的自定义逻辑动态禁用注册</li><li id="b250" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">为空头像添加默认图片</li><li id="1ad1" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">用来自数据库或另一个提供商的信息丰富用户简档。</li><li id="5632" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">新注册后向CRM添加条目。例如Hubspot或Salesforce。</li><li id="4d19" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">在用户登录或注册时触发Zapier中的Zap。</li><li id="0a53" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">检查用户上次密码重置的日期。</li><li id="58a4" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">阻止或列入白名单的IP地址。</li><li id="fdc7" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">还有更多！</li></ul><p id="a278" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自己看看他们的模板列表，看看他们提供了多少选项。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="2b69" class="mt mu iq bd mv mw mx my mz na nb nc nd jw ne jx nf jz ng ka nh kc ni kd nj nk bi translated">是时候制定我们自己的规则了…</h1><p id="3d49" class="pw-post-body-paragraph kw kx iq ky b kz nl jr lb lc nm ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">在Auth0 admin控制面板中，我们将需要rules部分，以便我们可以开始创建自己的规则。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/db1b404d8a1983de96459b07475b460c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fOf25lgRqZJbcdvJ052YZQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Screenshot by the author</figcaption></figure><p id="37f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们需要单击右上角的create rule按钮。这将把我们带到可以从提供的列表中选择模板的地方。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/56bfa5d57293079ab6cf7171401653fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E69EqjdA4U6995tUfmmrHw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Screenshot by the author</figcaption></figure><p id="f5f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我们的第一个示例，我们希望选择“从SQL Server数据库添加用户角色”，如下图中突出显示的那样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/9e34430173528fc20828a8404f519ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKdmqXmKaIMMk9xt0mH-bw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Screenshot by the author</figcaption></figure><p id="a36e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将把我们带到一个带有脚本编辑器的屏幕，如下所示，默认情况下为该规则模板填充了以下代码。</p><p id="c780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我发现这个页面上提供的编辑器有时有点难以使用。为了解决这个问题，我通常将正在使用的脚本复制并粘贴到Visual Studio代码或其他文本编辑器中，进行我的更改，然后将其复制并粘贴回Auth0编辑器中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/8a8b7756b8e4302d042c14560fead32f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wRkLeeoU41-k7mnBP-eIXw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Screenshot by author</figcaption></figure><p id="f921" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是默认模板:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3a94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查当前用户是否已经验证了他们的电子邮件。如果是，它将查询已配置的SQL Server数据库，通过用户的电子邮件获取用户的角色列表。然后，我们将角色列表存储在键<code class="fe ok ol om on b"><a class="ae kv" href="https://example.com/roles." rel="noopener ugc nofollow" target="_blank">https://example.com/roles</a></code>下。请注意，您可能希望更新密钥以匹配您的域。</p><p id="9c33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们使用SQL Server作为数据库，那么我们就完成了。只要设置好适当的配置，我们就可以开始了。</p><p id="d9b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果我们不使用SQL Server数据库呢？如果我们使用PostgreSQL数据库呢？</p><p id="83cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果是这样的话，我们需要对这个脚本进行一些定制。与其使用<code class="fe ok ol om on b">tedious</code>包，我们不如使用类似于<code class="fe ok ol om on b">pg</code>的东西来与我们的PostgreSQL数据库接口。</p><p id="580c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们更新我们的示例以适应这种变化:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="2dc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常相似的想法，只是用pg实现来调用PostgreSQL数据库而不是SQL Server数据库。注意，您可以使用<code class="fe ok ol om on b">require</code>获取任何npm依赖项。Auth0将负责在执行时获取所有正确的依赖项。</p><p id="c711" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们所要做的就是点击保存按钮，我们的规则就更新了。请注意，当您在生产应用程序中使用它时，您会希望在进行更改之前对此进行测试。只要你点击保存，规则就会被应用，所以你要意识到这一点。</p><p id="19e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们完成规则的唯一步骤是为我们的数据库提供配置设置。您会注意到规则页面底部的设置部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/4973ac468798796807322c350e1d5eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APks8em8N0h4JuFDhfo8ow.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Screenshot by the author</figcaption></figure><p id="59f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要为上面截图中的4个键提供值:</p><ul class=""><li id="2ee8" class="nq nr iq ky b kz la lc ld lf ns lj nt ln nu lr nv nw nx ny bi translated"><code class="fe ok ol om on b">DATABASE_HOSTNAME</code></li><li id="5f87" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe ok ol om on b">DATABASE_USERNAME</code></li><li id="f5b4" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe ok ol om on b">DATABASE_PASSWORD</code></li><li id="5e75" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated"><code class="fe ok ol om on b">DATABASE_NAME</code></li></ul><p id="012b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这应该包括了我们实现第一个规则所需的一切！Auth0在管理站点中提供了优秀的测试工具，以确保您的所有规则脚本都如您所期望的那样工作。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="0e89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">这只是用Auth0的规则来描述服务，但我希望这能提供一些洞察力，让人们了解这对于扩展Auth0的默认功能有多么强大。感谢您的阅读！</em></p></div></div>    
</body>
</html>