<html>
<head>
<title>Exploring The New Image Component With Next.js 10</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js 10探索新的图像组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/exploring-the-new-image-component-with-next-js-10-cc0f70548886?source=collection_archive---------9-----------------------#2020-11-09">https://javascript.plainenglish.io/exploring-the-new-image-component-with-next-js-10-cc0f70548886?source=collection_archive---------9-----------------------#2020-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="io ip gp gr iq ir gh gi paragraph-image"><div class="ab gu cl is"><img src="../Images/715e9cf2a095992929c0f1ab3cf2235c.png" data-original-src="https://miro.medium.com/v2/0*CH2HVvvkn5KAUWGo"/></div></figure><div class=""/><p id="73fd" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Next.js发布了一个优化的<a class="ae ks" href="https://nextjs.org/docs/basic-features/image-optimization" rel="noopener ugc nofollow" target="_blank">图片组件</a>，它优化了图片在Next.js网站上的加载方式。用他们自己的话说:<em class="kt">“图像总是以避免累积布局偏移的方式呈现，这是谷歌将在搜索排名中使用的一个至关重要的核心网站。”— </em> <a class="ae ks" href="https://nextjs.org/docs/basic-features/image-optimization" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> Next.js图片文档</em> </a></p><p id="f432" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这篇文章中，我们将探索和尝试这个新组件，看看它是如何工作的。</p><h2 id="c66f" class="ku kv ix bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">入门指南</h2><p id="5ee2" class="pw-post-body-paragraph ju jv ix jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">我们将使用<code class="fe ls lt lu lv b">create-next-app</code>构建出项目:</p><figure class="lw lx ly lz gt ir"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h2 id="bc1f" class="ku kv ix bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">选择图像</h2><p id="cc24" class="pw-post-body-paragraph ju jv ix jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">为了这次特别的探索，我去了Unsplash，选择了一张我喜欢的图片。</p><p id="0d7b" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这种情况下，我选择了弗洛里安·奥利佛的水母形象。</p><figure class="lw lx ly lz gt ir gh gi paragraph-image"><div class="ab gu cl is"><img src="../Images/bf396bb343aca579eaa426b3b573ffd2.png" data-original-src="https://miro.medium.com/v2/0*X3hUhnk4Y1D8UCPP"/></div></figure><p id="2b60" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，我去了在线工具<a class="ae ks" href="https://squoosh.app/" rel="noopener ugc nofollow" target="_blank"> Squoosh </a>将图片的大小调整为800x1199，并用基础设置进行了优化。</p><p id="bb88" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这创建了78KB的映像优化版本，而原始的未优化版本为4.5MB</p><h2 id="6413" class="ku kv ix bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">更新主页以放入两个版本</h2><p id="3061" class="pw-post-body-paragraph ju jv ix jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">根据我在Next.js示例报告中看到的示例，我对其进行了修改，以显示优化和未优化的图像:</p><figure class="lw lx ly lz gt ir"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="f487" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本质上，这就是我玩它所需要的！</p><p id="4fe3" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将这个例子部署到<a class="ae ks" href="https://vercel.com" rel="noopener ugc nofollow" target="_blank"> Vercel </a>上，看看会有什么结果。</p><h2 id="f6f6" class="ku kv ix bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">探索结果</h2><p id="4626" class="pw-post-body-paragraph ju jv ix jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">第一次访问制作网站时，我注意到在加载图像时，有一个很好的空间供图像加载:</p><figure class="lw lx ly lz gt ir gh gi paragraph-image"><div class="ab gu cl is"><img src="../Images/983fd3bfd3565d54edd097f00d63c9b9.png" data-original-src="https://miro.medium.com/v2/0*Woj5q63AbeYgpNmM"/></div></figure><p id="93fd" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该空间与防止<a class="ae ks" href="https://web.dev/cls/" rel="noopener ugc nofollow" target="_blank">累积布局偏移</a>有关，如前所述，累积布局偏移是核心网的关键。</p><p id="38cd" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在第一次加载过程中，未优化的图像加载到页面需要大约17秒。这是因为Next.js在加载之前优化了图像。</p><p id="8ac5" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我犯了一个菜鸟错误，在项目的第一次加载期间没有打开<code class="fe ls lt lu lv b">Network</code>选项卡，因此时间本身并不完美，但在这里，我稍后重新部署了项目的网络选项卡，以显示与我的第一次加载类似的体验:</p><figure class="lw lx ly lz gt ir gh gi paragraph-image"><div class="ab gu cl is"><img src="../Images/57a5e9f6978e3ee3c867b8d10de7e7c6.png" data-original-src="https://miro.medium.com/v2/0*v3-vC6KfkENfBUpe"/></div></figure><p id="320e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi">.</p><blockquote class="mc md me"><p id="86f3" class="ju jv kt jw b jx jy jz ka kb kc kd ke mf kg kh ki mg kk kl km mh ko kp kq kr ij bi translated">注意:你可以看到这里的图像是从原始JPEG的4.5MB优化下来的，它是以<code class="fe ls lt lu lv b">webp</code>格式出现的，但优化后的大小远远大于后面显示的示例。我不能说为什么在重新部署项目时会发生这种情况，但鉴于图像针对设备和浏览器进行了优化，我会说这可能是由于在我的MacBook上重新部署和访问项目，分辨率比我的显示器高。</p></blockquote><p id="a4da" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">加载后，我们会看到如下所示的屏幕:</p><figure class="lw lx ly lz gt ir gh gi paragraph-image"><div class="ab gu cl is"><img src="../Images/840409f330b7c3ff044d2af6991942ae.png" data-original-src="https://miro.medium.com/v2/0*UE40XX8-40ebamOh"/></div></figure><p id="504e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">根据文档，缓存是这样工作的:<em class="kt">图像根据请求动态优化，并存储在</em> <code class="fe ls lt lu lv b"><em class="kt">&lt;distDir&gt;/cache/images</em></code> <em class="kt">目录中。优化的图像文件将为后续请求提供服务，直到到期。当发出的请求与缓存但已过期的文件匹配时，在生成新的优化映像和缓存新文件之前，缓存的文件将被删除。”</em></p><p id="6931" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">“过期(或者更确切地说是最大年龄)是由上游服务器的缓存控制头定义的。”</em></p><p id="2cb3" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">"如果在Cache-Control中找到s-maxage，则使用它。如果没有找到s-maxage，则使用max-age。如果没有找到最大年龄，则使用60秒。”</em></p><p id="8214" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以在我们的例子中，一旦图像在调用过程中被优化，它就会被缓存，随后的请求会非常快地加载我们需要的图像！这是我在重装时最初部署的网络:</p><figure class="lw lx ly lz gt ir gh gi paragraph-image"><div class="ab gu cl is"><img src="../Images/60aceb897b6905e08af62a07e145017c.png" data-original-src="https://miro.medium.com/v2/0*hUALn8bD42OvYSJN"/></div></figure><h2 id="eb13" class="ku kv ix bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">最后</h2><p id="346e" class="pw-post-body-paragraph ju jv ix jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">今天的帖子是关于在实际部署中使用未优化和优化的源映像来查看Next.js映像优化的效果。</p><p id="10dc" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">虽然这只是一个表面现象，但是使用Next.js 10图像优化可以看到的东西是令人难以置信的，这无疑是朝着帮助开发人员的正确方向迈出的一大步。</p><p id="0d8b" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">自从几年前遇到<a class="ae ks" href="https://github.com/stereobooster/react-ideal-image" rel="noopener ugc nofollow" target="_blank">react-ideal-image package</a>以来，我一直渴望看到这一领域的其他解决方案，而这无疑是其中一个遥遥领先的解决方案。</p><h2 id="c6ae" class="ku kv ix bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">资源和进一步阅读</h2><ol class=""><li id="41d4" class="mi mj ix jw b jx ln kb lo kf mk kj ml kn mm kr mn mo mp mq bi translated"><a class="ae ks" href="https://nextjs.org/docs/basic-features/image-optimization" rel="noopener ugc nofollow" target="_blank"> Next.js图像组件</a></li><li id="231c" class="mi mj ix jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated"><a class="ae ks" href="https://unsplash.com/photos/GVe30cQ8CWU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">弗洛里安·奥利佛——水母图片</a></li><li id="2799" class="mi mj ix jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated"><a class="ae ks" href="https://squoosh.app/" rel="noopener ugc nofollow" target="_blank"> Squoosh </a></li><li id="56aa" class="mi mj ix jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated"><a class="ae ks" href="https://github.com/vercel/next.js/tree/canary/examples/image-component" rel="noopener ugc nofollow" target="_blank"> Next.js图片示例</a></li><li id="b680" class="mi mj ix jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated"><a class="ae ks" href="https://web.dev/cls/" rel="noopener ugc nofollow" target="_blank">累计布局移位</a></li><li id="a789" class="mi mj ix jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated"><a class="ae ks" href="https://github.com/stereobooster/react-ideal-image" rel="noopener ugc nofollow" target="_blank">反应-理想-图像包</a></li></ol><p id="c6aa" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">形象功劳:</em><a class="ae ks" href="https://unsplash.com/@bmarcel" rel="noopener ugc nofollow" target="_blank">T5】bmarcelT7】</a></p><p id="21ef" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">原贴于我的</em> <a class="ae ks" href="https://blog.dennisokeeffe.com/blog/2020-11-08-nextjs-10-image-component/" rel="noopener ugc nofollow" target="_blank"> <em class="kt">博客</em> </a> <em class="kt">。</em></p></div></div>    
</body>
</html>