<html>
<head>
<title>How to design a URL Shortener web app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设计一个URL Shortener web应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-url-shortener-web-app-c782910b4d12?source=collection_archive---------9-----------------------#2020-04-17">https://javascript.plainenglish.io/how-to-create-a-url-shortener-web-app-c782910b4d12?source=collection_archive---------9-----------------------#2020-04-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="98e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我为数不多的系统设计教程之一，我将在接下来的几天里发布，我将告诉你在构建高度可扩展的分布式系统中良好的具体故障保护解决方案。</p><h2 id="b258" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">我们将要学习的内容简介:</h2><p id="1e70" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">在高流量系统中，设计一个系统总是一个重要的或最重要的因素。同时设计类似UrlShortener、票务应用程序或电子商务应用程序的东西，让数百万用户进行读写操作。您的系统应该能够平稳、高效、稳健地处理如此大的流量。因此，要做到这一点，我们需要设计我们的堆栈、工作流和系统。</p><p id="b7f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天我们要建立一个像tinyurl.com一样的网址缩短器。我们将会看到所有的算法都可以使用，它们的优缺点，以及最终哪个最适合这个系统。</p><p id="10ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，设计系统的第一个检查点是做出一些具体的假设:</p><p id="2cb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我们可以假设:url的长度可以是7个字符长，以及有多少点击将进入我们的系统。比方说，我们的系统将能够获得100万次点击/天，即3000万次点击/天，等等…</p><h2 id="195e" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">构建数据容量模型:</h2><p id="afd4" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">因此，为了构建我们的数据库，我们需要构建一个数据模型，该模型将由以下条目组成:</p><p id="784e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">长URL - 2KB大小</p><p id="134e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">短URL - 7个字符</p><p id="6ef2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建日期戳- 7字节</p><p id="de60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到期日期- 7字节</p><p id="c23f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很简单，对吧…不，当你想建立一个可扩展的系统时，这实际上并不简单。对于单个服务器系统，这很简单，但在现实生活中，这些系统应该是可伸缩的。</p><h2 id="4555" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">算法:</h2><p id="6746" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">现在我们来看实现逻辑部分。所以为了实现这一点..我们几乎可以使用两种算法:</p><p id="0dfa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lj"> base62 </em></p><p id="3063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lj"> MD5哈希</em></p><p id="39e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以以上两种算法都可以用来获得随机散列。我们使用base62，因为使用base62我们可以生成62⁷，即超过3万亿的字符串组合，与MD5哈希相同。MD5散列的一个小问题是，它给出了20–22个字符长的散列值，而要求只有7个字符，因此我们需要提取MD5散列值的前7个字符。暂时还可以…</p><h2 id="05b1" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">尝试使用base62和MD5哈希构建系统:</h2><p id="6844" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">首先，让我们试着用base62来构建这个系统:所以我们用我们的长url，比如:【www.abc.com/ayhasd/asdeqwe/qweqw?yusdsd=123123】T4&amp;kqwenoow</p><p id="ca58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将这个值传递给我们的base62服务，它将返回给我一个7字符的唯一键，如<strong class="jp ir"> an1132s </strong>，我们将把它传递给我们的url shortener域，并构建我们的短url，如<a class="ae lk" href="http://www.shorturl.com/an1132s" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">【www.shorturl.com/an1132s】</strong></a><strong class="jp ir"/>，点击后会将我们重定向到所需的长url。这对于单个系统来说工作得很好，但是假设当数百万用户使用该系统时，必须有一个具有并行处理或分片的系统，或者多个服务器来服务这些请求，而不是一个服务器。</p><p id="f871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在这种情况下，我们的问题就出现了。由于多个服务器为不同的请求提供服务，因此可能会出现两个服务器返回相同的7个字符的情况，对于两个不同的长URL，base62值是相同的。因此，如果我们使用NoSQL数据库，我们将不会有像INSERT IF这样的方法，也不会搜索数据库中是否存在该关键字，但我们会遇到损坏的项目或数据库冲突就是这种情况。</p><h2 id="0c92" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">试图用计数器解决问题:</h2><p id="48df" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">上面的问题可以用计数器来解决..还是可以？让我们试一试。</p><p id="3491" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这种不确定性，我们可以使用一个或两个计数器来跟踪或充当线程安全的唯一id生成器，这样我们就不会遇到重复的哈希值。因此，我们可以给一个计数器一个从100万到100万的范围值，给另一个计数器200万到300万的范围值。但是假设范围值在几个月之后耗尽，并且计数器服务不知道如何重置它，并且它将不会与另一个计数器通信，因为两个计数器都在不同的服务器中工作。这就是柜台服务的问题所在。</p><h2 id="1751" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">动物园管理员前来救援:</h2><p id="1102" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">我们可以用ZooKeeper来解决这个问题。但是什么是<a class="ae lk" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank">动物园管理员</a>？</p><p id="8167" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Zookeeper是一个配置管理分布式系统，它作为一个协调服务来管理注册到它的不同服务或服务器。简而言之，它就像一个中央集线器，与连接到它的不同节点进行通信。记住这一点，让我们画一个系统设计图来解决我们的伸缩问题。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/235c19e3d421888901c2e1ee3e3410ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VrkanHuPFSbG30u7QzlvvQ.png"/></div></div></figure><p id="8abd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，用户上传一个长url，该URL通过负载平衡器来确定将有效负载发送到哪个服务器。假设服务器1可以自由接受有效载荷，并且当它收到请求时，它递增其计数器，其范围从1百万到2百万，并且给该请求赋值。该请求随后被发送到base62服务，并获得其新的缩短的7个字符的密钥。</p><p id="8707" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Zookeeper在这里的主要工作是为每个服务器分配一个特定的计数器范围，并跟踪它的变化，这样就不会有重复的键或数据库冲突。</p><h2 id="a56b" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">让我们来衡量:</h2><p id="3762" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">假设服务器3在一段时间后关闭，那么它将删除Zookeeper服务中的条目，并再次将其取消分配。让我们向系统添加另一台服务器4，它将被分配到一个新的4m-5m范围。这就是我们如何在不停机的情况下轻松扩展和缩减系统的方法。因为Zookeeper是一个包含多个服务器的服务，所以它最终会成为一个安全系统。</p><p id="b36b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GitHub Repo的链接:</p><div class="lx ly gp gr lz ma"><a href="https://github.com/Rajdeepc/url-shortener-vue" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">Rajdeepc/url-shortener-vue</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">一个完整的E2E应用程序，以缩短您的网址，并保存在您的个人资料。它给你选择域名的灵活性…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">github.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo lv ma"/></div></div></a></div></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="2d48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！如果您有任何问题，请随时联系rajrock38@gmail.com，通过<a class="ae lk" href="https://www.linkedin.com/in/rajdeepcoder/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>与我联系，或者通过<a class="ae lk" href="https://medium.com/@rajrock38" rel="noopener"> Medium </a>和<a class="ae lk" href="https://twitter.com/rajrock38" rel="noopener ugc nofollow" target="_blank"> Twitter </a>关注我。</p><p id="2169" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得这篇文章很有帮助，给它一些掌声会很有意义👏并分享出来帮别人找！并欢迎在下方发表评论。</p><h2 id="26d6" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="4a78" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae lk" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jp ir">AI in Plain English</strong></a><a class="ae lk" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jp ir">UX in Plain English</strong></a><a class="ae lk" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jp ir">Python in Plain English</strong></a><strong class="jp ir"/>——谢谢，继续学习！</p><p id="ac05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae lk" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">submissions @ plain English . io</strong></a><strong class="jp ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>