<html>
<head>
<title>Change Detection triggered animations in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度变化检测触发的动画</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/animating-changes-in-angular-f7059bb5ae05?source=collection_archive---------0-----------------------#2019-06-28">https://javascript.plainenglish.io/animating-changes-in-angular-f7059bb5ae05?source=collection_archive---------0-----------------------#2019-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f9d49757e3771b03e958b880ec8a326d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WJz-eMad74c6OLV4"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pankaj Patel</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="31c1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Angular features pretty <a class="ae jd" href="https://angular.io/guide/animations" rel="noopener ugc nofollow" target="_blank">强大的工具包</a>创建CSS过渡和动画。但是有时我们需要一些简单的东西来让我们的网络应用看起来更有活力。在本文中，我们将介绍一种简单的方法，使用由变化检测周期触发的CSS转换来动画显示角度组件的变化。</p><p id="0b83" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在这里描述的方法可以应用于触发几乎任何类型的CSS动画，但我们将重点放在只是让我们的文本闪烁橙色，如果改变，我们不打算使用角度动画套件:</p><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lb"><img src="../Images/49d473ddfe664fb8072219db8e51e257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MvqixWw53ZYTJYYWMlQPxQ.gif"/></div></div></figure><p id="6729" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">开始吧！</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="68fc" class="ln lo jg bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">首先让我们创建基本的Angular应用程序:</h1><ul class=""><li id="884f" class="ml mm jg kf b kg mn kk mo ko mp ks mq kw mr la ms mt mu mv bi translated"><strong class="kf jh">使用</strong><a class="ae jd" href="http://www.stackblitz.com" rel="noopener ugc nofollow" target="_blank"><strong class="kf jh">【stackblitz.com】</strong></a><strong class="kf jh">:</strong>创建一个简单的角度app</li></ul><p id="8b96" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在你的现代浏览器中输入'<a class="ae jd" href="https://stackblitz.com/fork/angular" rel="noopener ugc nofollow" target="_blank"><em class="mw">https://stackblitz.com/fork/angular</em></a>'。这将分叉和引导简单(iest)角应用程序，你可以在线编辑。</p><ul class=""><li id="9b86" class="ml mm jg kf b kg kh kk kl ko mx ks my kw mz la ms mt mu mv bi translated"><strong class="kf jh">现在让我们添加一个按钮和一个方法，每次按下都会改变单词“Angular”:</strong></li></ul><p id="016e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们转到<em class="mw">app.component.html</em>，在<em class="mw"> app.component.ts: </em>中添加带有(click)事件的按钮，该事件将触发“buttonClicked()”方法</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="f34c" class="nf lo jg nb b gy ng nh l ni nj">&lt;hello name="{{ name }}"&gt;&lt;/hello&gt;<br/>&lt;button (click)="buttonClicked()"&gt;hit me&lt;/button&gt;</span></pre><p id="9dbb" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在app.component.ts中，我们实现了“buttonClicked”方法——它所做的只是在单词“Angular”上再添加一个“r”:</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="4a19" class="nf lo jg nb b gy ng nh l ni nj"><a class="ae jd" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'my-app',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent {<br/>  name = 'Angular';<br/>  buttonClicked() {<br/>    this.name += "r"<br/>  }<br/>}</span></pre><ul class=""><li id="b502" class="ml mm jg kf b kg kh kk kl ko mx ks my kw mz la ms mt mu mv bi translated">现在试着按一下按钮，你应该已经可以正常工作了:</li></ul><figure class="lc ld le lf gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lb"><img src="../Images/5309e3f3583fa84e4fee0634dd407939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_Zs5pRQ0HtcmSlryd02WLQ.gif"/></div></div></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="853c" class="ln lo jg bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">让我们以动画形式展示变化:</h1><p id="6639" class="pw-post-body-paragraph kd ke jg kf b kg mn ki kj kk mo km kn ko nk kq kr ks nl ku kv kw nm ky kz la ij bi translated">我们将使用简单的CSS过渡和关键帧来激活文本更新。正如您所注意到的，在我们的<em class="mw">app.component.html</em>中，我们有一个简单的“hello”组件，它的name属性绑定到app.component.ts的“name”属性(现在是单词“Angular”)——我们将在这个“hello”组件内部工作并更新它:</p><ul class=""><li id="5f8d" class="ml mm jg kf b kg kh kk kl ko mx ks my kw mz la ms mt mu mv bi translated">首先，让我们将类绑定[ngClass]添加到一个简单的对象“pulsingText”中，其中一个属性“pulsing”最初设置为false。现在将它设置为true将使我们的<h1>标签获得CSS类”。脉冲”添加到它。并且将其设置为“假”将移除这样的类:</h1></li></ul><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="0645" class="nf lo jg nb b gy ng nh l ni nj">import { Component, Input } from '<a class="ae jd" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/><a class="ae jd" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'hello',<br/>  template: `&lt;h1 [ngClass]="pulsingText"&gt;Hello {{name}}!&lt;/h1&gt;`,<br/>  styles: [`<br/>    .pulsing {<br/>        animation-iteration-count: 1;<br/>        animation: pulse 0.5s;<br/>        animation-direction: alternate;<br/>    }<br/>  `]<br/>})<br/>export class HelloComponent {<br/>  <a class="ae jd" href="http://twitter.com/Input" rel="noopener ugc nofollow" target="_blank">@Input</a>() name: string;<br/>  pulsingText = {<br/>    pulsing: false<br/>  }<br/>  ngOnChanges(changes) {<br/>    this.pulsingText.pulsing = true;<br/>  }<br/>}</span></pre><ul class=""><li id="6706" class="ml mm jg kf b kg kh kk kl ko mx ks my kw mz la ms mt mu mv bi translated">那我们补充一下。组件装饰器的“样式”部分中的脉动CSS类定义(如上所示)</li><li id="1935" class="ml mm jg kf b kg nn kk no ko np ks nq kw nr la ms mt mu mv bi translated">接下来，让我们添加Angular的生命周期钩子<a class="ae jd" href="https://angular.io/api/core/OnChanges" rel="noopener ugc nofollow" target="_blank"> ngOnChanges </a>，每次@Input的name值改变并触发添加类时都会调用这个钩子。脉动到我们的&lt; h1 &gt;标签</li><li id="639b" class="ml mm jg kf b kg nn kk no ko np ks nq kw nr la ms mt mu mv bi translated">最后，让我们添加关键帧动画(过渡),它将把我们更改的文本不透明度和颜色从初始状态更改为橙色/降低的不透明度，然后再返回:</li></ul><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="e8cc" class="nf lo jg nb b gy ng nh l ni nj">...<br/><a class="ae jd" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'hello',<br/>  template: `&lt;h1 [ngClass]="pulsingText"&gt;Hello {{name}}!&lt;/h1&gt;`,<br/>  styles: [`<br/>    .pulsing {<br/>        animation-iteration-count: 1;<br/>        animation: pulse 0.5s;<br/>        animation-direction: alternate;<br/>    }<br/>    <a class="ae jd" href="http://twitter.com/keyframes" rel="noopener ugc nofollow" target="_blank">@keyframes</a> pulse {<br/>    0% {<br/>        opacity: 1;<br/>        color: black<br/>    }<br/>    50% {<br/>        opacity: 0.3;<br/>        color: orange;<br/>    }<br/>    100% {<br/>        opacity: 1;<br/>        color: black;<br/>    }<br/>}<br/>  `]<br/>})<br/>...</span></pre><p id="bf20" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在你会看到，当应用程序加载时，转换被触发一次，但在点击按钮时仍然不起作用，这是因为我们需要删除一些东西。每次动画结束后，从我们的<h1>标签<strong class="kf jh">脉冲类。</strong></h1></p><p id="8942" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此我们可以使用(animationend)事件绑定:</p><pre class="lc ld le lf gt na nb nc nd aw ne bi"><span id="30aa" class="nf lo jg nb b gy ng nh l ni nj">&lt;h1 [ngClass]="pulsingText" (animationend)="pulsingText.pulsing=false"&gt;Hello {{name}}!&lt;/h1&gt;</span></pre><p id="d6b1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在按下按钮应该会触发动画(。添加了脉冲类)，然后在动画结束时，它将被重置。脉动类被移除)，以便在下一个改变检测周期中当“名称”改变时。脉冲类可以通过ngOnChanges再次重新添加，然后通过(animationend)事件再次移除。</p><p id="126c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以上只是一个模式，当然，对于一个真正的应用程序，你需要添加更多的“肉到骨头”(像检查这样的动画是否已经运行等)，但希望这是一个有用的技巧。</p><p id="458a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里是完整的stackblits.com app:<a class="ae jd" href="https://stackblitz.com/edit/angular-gzzs48" rel="noopener ugc nofollow" target="_blank">https://stackblitz.com/edit/angular-gzzs48</a></p><div class="ip iq gp gr ir ns"><a href="https://stackblitz.com/edit/angular-gzzs48?embed=1&amp;file=src/app/hello.component.ts" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jh gy z fp nx fr fs ny fu fw jf bi translated">angular-gzzs48 - StackBlitz</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">导出到Angular CLI的Angular应用程序的启动项目</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">stackblitz.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ix ns"/></div></div></a></div></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><p id="2ec3" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>