<html>
<head>
<title>Custom React Hook to Share State Between Browserâ€™s Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">è‡ªå®šä¹‰ReactæŒ‚é’©ä»¥åœ¨æµè§ˆå™¨çª—å£é—´å…±äº«çŠ¶æ€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/a-react-hook-to-share-state-between-browser-windows-a672470f66ff?source=collection_archive---------0-----------------------#2020-11-20">https://javascript.plainenglish.io/a-react-hook-to-share-state-between-browser-windows-a672470f66ff?source=collection_archive---------0-----------------------#2020-11-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/7b8902d04bbf4a749cdb5636bf45e0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nsscvGkyVfIZvHs4de3uIg.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@juanster?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Juan Davila</a> on <a class="ae ja" href="https://unsplash.com/t/nature?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="4d89" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æœ‰æ—¶åœ¨ä¸€ä¸ªå‰ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€çš„åŒä¸€ä¸ªåŸŸçš„å¤šä¸ªæ ‡ç­¾ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚è¿™ä¸ªç”¨ä¾‹çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ã€‚å‡è®¾æ‚¨æ‰“å¼€å¤šä¸ªé€‰é¡¹å¡æ¥æŸ¥çœ‹ä¸åŒçš„äº§å“ï¼Œå¹¶ä¸”åœ¨æŸ¥çœ‹æ—¶å°†è¿™äº›äº§å“æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ã€‚ä½ æ‰€æœŸæœ›çš„ç”¨é€”æ˜¯çœ‹åˆ°ä½ çš„è´­ç‰©è½¦åœ¨ä»»ä½•æ ‡ç­¾é¡µä¸Šæ›´æ–°ï¼</p><p id="1a4a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿™æ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºç¤ºä¾‹ã€‚åœ¨ä¸¤ä¸ªé€‰é¡¹å¡ä¸Šæ‰“å¼€è¿™ä¸ª<a class="ae ja" href="https://mostafa-drz.github.io/react-cross-windows-state/" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹åº”ç”¨ç¨‹åº</a>,å¹¶å°†å•†å“æ·»åŠ åˆ°æ‚¨çš„è´­ç‰©è½¦ä¸­ï¼æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œåº”ç”¨ç¨‹åºçš„çŠ¶æ€æ˜¯åœ¨æµè§ˆå™¨çš„é€‰é¡¹å¡ä¹‹é—´å…±äº«çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ</p><h2 id="b942" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">ä¸€ç‚¹èƒŒæ™¯:è·¨çª—å£äº¤æµ</h2><p id="237c" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">å¦‚æœä½ æƒ³åœ¨åŒä¸€ä¸ªåŸŸçš„å¤šä¸ªçª—å£ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•ã€‚è¿›è¡Œè¿™ç§é€šä¿¡çš„ä¸€äº›å¸¸è§æ–¹å¼æ˜¯<a class="ae ja" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="noopener ugc nofollow" target="_blank">çª—å£PostMessage API </a>ã€<a class="ae ja" href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" rel="noopener ugc nofollow" target="_blank">å¹¿æ’­é€šé“API </a>ä»¥åŠé€šè¿‡æœ¬åœ°å­˜å‚¨è¿›è¡Œé€šä¿¡ã€‚æˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­è®¨è®ºå‰ä¸¤ç§äº¤æµæ–¹å¼ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨ç½‘ä¸Šå’Œæ–‡æ¡£ä¸­æ‰¾åˆ°è¿™ä¸¤ç§æ–¹å¼çš„å¾ˆå¤šä¾‹å­ã€‚æˆ‘å°†é‡ç‚¹ä»‹ç»ä½¿ç”¨Localstorageè¿›è¡Œé€šä¿¡ï¼Œå› ä¸ºæˆ‘ä»¬ä¹Ÿå¸Œæœ›ä¿æŒæˆ‘ä»¬çš„çŠ¶æ€ï¼Œè¿™æ ·ä¸‹æ¬¡è®¿é—®é¡µé¢æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è®¿é—®çŠ¶æ€ã€‚</p><h2 id="fb76" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">å±€éƒ¨å­˜å‚¨å™¨</h2><p id="0bbf" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated"><a class="ae ja" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank">æœ¬åœ°å­˜å‚¨</a>æ˜¯æµè§ˆå™¨ä¸Šå¯ç”¨çš„å­˜å‚¨ä¹‹ä¸€ã€‚é€šè¿‡ä½¿ç”¨å®ƒæä¾›çš„ä¸€ä¸ªéå¸¸ç®€å•çš„APIï¼Œæ‚¨å¯ä»¥ç®€å•åœ°æ·»åŠ é¡¹ç›®å’Œè¯»å–å­˜å‚¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="28ab" class="ky kz jd mb b gy mf mg l mh mi">localStorage.setItem('name','mostafa')</span><span id="4a2e" class="ky kz jd mb b gy mj mg l mh mi">console.log(localStorage.getItem('name'))<br/>// mostafa</span></pre><p id="9d8a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªAPIéå¸¸å®¹æ˜“ä½¿ç”¨ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªé”®/å€¼ç»™<code class="fe mk ml mm mb b">localStorage.setItem</code>ï¼Œç„¶åç”¨è¿™ä¸ªé”®è°ƒç”¨<code class="fe mk ml mm mb b">localStorage.getItem</code>æ¥è·å–è¿™ä¸ªå€¼ã€‚<br/>ä½†æ˜¯ï¼Œå…³äºæœ¬åœ°å­˜å‚¨ï¼Œè¿˜æœ‰ä¸€ç‚¹æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„ä½¿ç”¨æ¡ˆä¾‹ä¸­ä½¿ç”¨ã€‚æ‚¨å¯ä»¥ç›‘å¬localStorageä¸­çš„æ‰€æœ‰æ›´æ”¹:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="9a36" class="ky kz jd mb b gy mf mg l mh mi">window.addEventListner('storage',(e)=&gt;{</span><span id="f8dd" class="ky kz jd mb b gy mj mg l mh mi">// Something has changed on localStorage <br/>})</span></pre><p id="cd9a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åœ¨<code class="fe mk ml mm mb b">storage</code>ä¸Šæ”¶åˆ°çš„äº‹ä»¶æœ‰å‡ ä¸ªå±æ€§ï¼Œå…¶ä¸­ä¸¤ä¸ªæ˜¯æˆ‘ä»¬éœ€è¦çš„:<code class="fe mk ml mm mb b">key</code>å’Œ<code class="fe mk ml mm mb b">newValue</code>ã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦åšçš„æ˜¯åœ¨æ¯ä¸ªé€‰é¡¹å¡ä¸Šè®¾ç½®ReactçŠ¶æ€ï¼Œæˆ‘ä»¬ä¹Ÿå°†å®ƒä¿å­˜åœ¨<code class="fe mk ml mm mb b">localStorag</code>ä¸­ï¼Œè¿™æ ·å…¶ä»–é€‰é¡¹å¡å°±å¯ä»¥ç›‘å¬è¿™ä¸ªå˜åŒ–å¹¶æ›´æ–°å®ƒä»¬è‡ªå·±çš„çŠ¶æ€ã€‚</p><h2 id="c1bf" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">æœ€ç»ˆè§£å†³æ–¹æ¡ˆä¹‹å‰çš„ä¸€ä¸ªå°ä¾‹å­</h2><p id="6085" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">è¿™æ˜¯ä¸€ä¸ªå°çš„Reactç»„ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºçš„ä¸åŒé€‰é¡¹å¡ä¹‹é—´å…±äº«çŠ¶æ€:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="545a" class="ky kz jd mb b gy mf mg l mh mi">import React, { useState, useEffect } from "react";</span><span id="3b8e" class="ky kz jd mb b gy mj mg l mh mi">function HelloStorage() {<br/>  const [name, setName] = useState("");</span><span id="fc01" class="ky kz jd mb b gy mj mg l mh mi">  useEffect(() =&gt; {<br/>    localStorage.setItem("name", name);<br/>  }, [name]);</span><span id="0665" class="ky kz jd mb b gy mj mg l mh mi">  useEffect(() =&gt; {<br/>    const onReceiveMessage = (e) =&gt; {<br/>      const { key, newValue } = e;<br/>      if (key === "name") {<br/>        setName(newValue);<br/>      }<br/>    };<br/>    window.addEventListener("storage", onReceiveMessage);<br/>    return () =&gt; {<br/>      window.removeEventListener("storage", onReceiveMessage);<br/>    };<br/>  }, []);</span><span id="8eaa" class="ky kz jd mb b gy mj mg l mh mi">const handleChange = (e) =&gt; {<br/>    setName(e.target.value);<br/>  };<br/>  return &lt;input value={name} onChange={handleChange} /&gt;;<br/>}</span></pre><p id="7c71" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ª<code class="fe mk ml mm mb b">useEffect</code>ï¼Œç¬¬ä¸€ä¸ªç›‘å¬æˆ‘ä»¬çŠ¶æ€çš„å˜åŒ–ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œå®ƒåœ¨localStorageä¸Šè®¾ç½®çŠ¶æ€ã€‚<br/>è¿˜æœ‰ç¬¬äºŒä¸ª<code class="fe mk ml mm mb b">useEfffect</code>ï¼Œå®ƒä¸º<code class="fe mk ml mm mb b">storage</code>æ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œæ¯æ¬¡å­˜å‚¨ä¸Šæœ‰å˜åŒ–æ—¶ï¼Œå®ƒæ£€æŸ¥å˜åŒ–çš„é”®ï¼Œå¦‚æœæ˜¯æˆ‘ä»¬çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒæ›´æ–°ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€ã€‚(åŸºæœ¬ä¸Šï¼Œè¿™æ„å‘³ç€å¦ä¸€ä¸ªé€‰é¡¹å¡æ›´æ–°äº†æ­¤çŠ¶æ€)</p><p id="535e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å‡ºç°çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬ä¼šé™·å…¥ä¸€ä¸ªå¾ªç¯å—ï¼ŸğŸ¤”å¦‚æœæˆ‘ä»¬éšç€æ¯ä¸ªæœ¬åœ°å­˜å‚¨çš„æ”¹å˜è€Œæ›´æ–°çŠ¶æ€ï¼Œé‚£ä¹ˆå¯¹äºæ”¹å˜çŠ¶æ€çš„é€‰é¡¹å¡æ¥è¯´ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯(æ›´æ–°çŠ¶æ€â€”&gt;æ›´æ–°æœ¬åœ°å­˜å‚¨â€”&gt;æ›´æ–°çŠ¶æ€)ï¼ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼æˆ‘ä»¬ä¸ä¼šé™·å…¥å¾ªç¯ã€‚å› ä¸º<code class="fe mk ml mm mb b">storage</code>äº‹ä»¶ä¸ä¼šåœ¨äº‹ä»¶çš„åŸç‚¹æ¿€å‘äº‹ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œæ”¹å˜çŠ¶æ€çš„é€‰é¡¹å¡æ²¡æœ‰å¾—åˆ°<code class="fe mk ml mm mb b">storage</code>äº‹ä»¶ï¼Œæ‰€ä»¥å”·ğŸ‘</p><p id="a47d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¦‚æœæ‚¨ç…§åŸæ ·è¿è¡Œè¿™æ®µä»£ç ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ¯æ¬¡æ‚¨æ‰“å¼€ä¸€ä¸ªæ–°çš„é€‰é¡¹å¡æ—¶ï¼Œæ–°çš„çŠ¶æ€éƒ½æ˜¯ç©ºçš„ï¼Œæ‚¨çŒœæ€ä¹ˆç€ï¼å®ƒå°†çŠ¶æ€è®¾ç½®ä¸ºè·¨é€‰é¡¹å¡çš„ç©ºå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™ä¸ªå°æ ·æœ¬ä»£ç ä¸­è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="384e" class="ky kz jd bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">è‡ªå®šä¹‰çš„ReactæŒ‚é’©ï¼Œç”¨äºåœ¨æµè§ˆå™¨é€‰é¡¹å¡ä¹‹é—´å…±äº«çŠ¶æ€</h2><p id="ec33" class="pw-post-body-paragraph ka kb jd kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘å‡è®¾æ‚¨ç†Ÿæ‚‰ReactæŒ‚é’©ä»¥åŠå¦‚ä½•æ„å»ºå®šåˆ¶çš„ReactæŒ‚é’©ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œæˆ‘æ¨èä½ çœ‹çœ‹Reactæ–‡æ¡£ä¸Šçš„<a class="ae ja" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">é’©å­éƒ¨åˆ†ã€‚</a></p><p id="052d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">é¦–å…ˆï¼Œè®©æˆ‘æŠŠæœ€ç»ˆç‰ˆæœ¬æ”¾åœ¨è¿™é‡Œï¼Œç„¶åæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="ddc7" class="ky kz jd mb b gy mf mg l mh mi">function useCrossTabState(stateKey,defaultValue){<br/>  const [state,setState] = useState(defaultValue)<br/>  const isNewSession = useRef(true)</span><span id="90af" class="ky kz jd mb b gy mj mg l mh mi">useEffect(()=&gt;{<br/>    if(isNewSession.current){<br/>      const currentState = localStorage.getItem(stateKey)<br/>      if(currentState){<br/>        setState(JSON.parse(currentState))<br/>      }else{<br/>         setState(defaultValue)<br/>      }<br/>      isNewSession.current=false<br/>      return<br/>    }<br/>    try{<br/>      localStorage.setItem(stateKey,JSON.stringify(state))<br/>    }catch(error){}<br/>  },[state,stateKey,defaultValue])</span><span id="c144" class="ky kz jd mb b gy mj mg l mh mi">useEffect(()=&gt;{<br/>    const onReceieveMessage = (e) =&gt; {<br/>     const {key,newValue} = e<br/>    if(key===stateKey){<br/>       setState(JSON.parse(newValue))<br/>    } <br/>    }<br/>    window.addEventListener('storage',onReceieveMessage)<br/>    return () =&gt; window.removeEventListener('storage',onReceieveMessage)<br/>  },[stateKey,setState])</span><span id="4097" class="ky kz jd mb b gy mj mg l mh mi">return [state,setState]<br/>}</span></pre><p id="43df" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘å–œæ¬¢React hooksçš„ä¸€ç‚¹æ˜¯ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æ„å»ºä¸€äº›å®šåˆ¶çš„é’©å­ï¼Œåœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œä»¥è·å¾—æ›´æ¨¡å—åŒ–å’Œæ›´å¹²å‡€çš„ä»£ç ã€‚</p><p id="c659" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¿™ä¸ªå®šåˆ¶é’©å­æ¥å—ä¸¤ä¸ªè¾“å…¥:<code class="fe mk ml mm mb b">stateKey</code>å’Œä¸€ä¸ª<code class="fe mk ml mm mb b">defaultValue</code>ã€‚åŸºæœ¬ä¸Šï¼Œ<code class="fe mk ml mm mb b">stateKey</code>æ˜¯æˆ‘ä»¬è°ƒç”¨<code class="fe mk ml mm mb b">localStorage.setItem</code>æ—¶æƒ³è¦ä½¿ç”¨çš„é”®ï¼Œå¦‚æœ<code class="fe mk ml mm mb b">localStorage</code>ä¸Šè¿˜æ²¡æœ‰è®¾ç½®å€¼ï¼Œé‚£ä¹ˆ<code class="fe mk ml mm mb b">defaultValue</code>æ˜¯çŠ¶æ€çš„é»˜è®¤å€¼ã€‚</p><p id="694a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘ä»¬ç°åœ¨è·³è¿‡<code class="fe mk ml mm mb b">isNewSession</code>æ¨¡å—ï¼Œå…ˆæ¥çœ‹çœ‹<code class="fe mk ml mm mb b">useEffect</code>:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="1caa" class="ky kz jd mb b gy mf mg l mh mi">useEffect(()=&gt;{<br/>    try{<br/>      localStorage.setItem(stateKey,JSON.stringify(state))<br/>    }catch(error){}<br/>  },[state,stateKey])</span></pre><p id="1db4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ç›¸åŒï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶éƒ½åœ¨localStorageä¸Šè®¾ç½®çŠ¶æ€ã€‚<br/>ç°åœ¨æˆ‘ä»¬éœ€è¦ç›‘å¬<code class="fe mk ml mm mb b">storage</code>å˜åŒ–ï¼Œå¦‚æœå˜åŒ–ä¸æˆ‘ä»¬çš„çŠ¶æ€æœ‰å…³ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„çŠ¶æ€:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="3ba5" class="ky kz jd mb b gy mf mg l mh mi">useEffect(()=&gt;{<br/>    const onReceieveMessage = (e) =&gt; {<br/>     const {key,newValue} = e<br/>    if(key===stateKey){<br/>       setState(JSON.parse(newValue))<br/>    } <br/>    }<br/>    window.addEventListener('storage',onReceieveMessage)<br/>    return () =&gt; window.removeEventListener('storage',onReceieveMessage)<br/>  },[stateKey,setState])</span></pre><p id="7f0d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ç±»ä¼¼äºæˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­æ‰€åšçš„ï¼Œé™¤äº†å®ƒæ›´çµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒçŠ¶æ€ä¸‹ä½¿ç”¨å®ƒã€‚</p><p id="62cd" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç°åœ¨æ¥è¯´è¯´<code class="fe mk ml mm mb b">isNewSession</code> blockæ˜¯åšä»€ä¹ˆçš„ï¼Ÿå¦‚æœä½ è¿˜è®°å¾—æˆ‘æåˆ°çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œè¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä½ æ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œæ–°æ ‡ç­¾æœ‰é»˜è®¤çŠ¶æ€(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²)ï¼Œå®ƒç”¨é»˜è®¤çŠ¶æ€æ›´æ–°å­˜å‚¨ï¼Œå®ƒä¼šè¦†ç›–æ ‡ç­¾å…±äº«çš„çŠ¶æ€ã€‚<br/>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è¿™æ˜¯å¦æ˜¯ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œç»„ä»¶æ˜¯å¦æ­£åœ¨è¢«æ¸²æŸ“ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å°±è·³è¿‡è®¾ç½®<code class="fe mk ml mm mb b">localStorage</code>çš„çŠ¶æ€ã€‚</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="58c2" class="ky kz jd mb b gy mf mg l mh mi">if(isNewSession.current){<br/>      const currentState = localStorage.getItem(stateKey)<br/>      if(currentState){<br/>        setState(JSON.parse(currentState))<br/>      }else{<br/>         setState(defaultValue)<br/>      }<br/>      isNewSession.current=false<br/>      return<br/>    }</span></pre><p id="07cb" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰é’©å­é‡å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¾‹å­:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="9b25" class="ky kz jd mb b gy mf mg l mh mi">import React from "react";<br/>import { useCrossTabState } from "./hooks";</span><span id="2df6" class="ky kz jd mb b gy mj mg l mh mi">function App() {<br/>  const [name, setName] = useCrossTabState("name", "");<br/>  const handleChange = (e) =&gt; {<br/>    setName(e.target.value);<br/>  };<br/>  return &lt;input value={name} onChange={handleChange} /&gt;;<br/>}</span><span id="d68c" class="ky kz jd mb b gy mj mg l mh mi">export default App;</span></pre><p id="26f0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è¯·è®°ä½ï¼ŒçŠ¶æ€é”®åœ¨åŸŸä¸­åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œä»¥é¿å…ä»»ä½•è¦†ç›–ã€‚</p><figure class="lw lx ly lz gt ip"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="7af0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä½ å¯ä»¥åœ¨æˆ‘çš„GitHubä¸Šçœ‹åˆ°ä½¿ç”¨è¿™ä¸ªé’©å­çš„å¦ä¸€ä¸ªä¾‹å­:<a class="ae ja" href="https://github.com/mostafa-drz/react-cross-windows-state" rel="noopener ugc nofollow" target="_blank">https://github.com/mostafa-drz/react-cross-windows-state</a></p></div><div class="ab cl mp mq hr mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ig ih ii ij ik"><p id="a6a7" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘å¸Œæœ›è¿™ä¸ªå®šåˆ¶é’©å­èƒ½å¸®åŠ©ä½ çš„é¡¹ç›®ï¼Œå¹¶ä¸”ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ã€‚è¯·ä¸è¦çŠ¹è±«ï¼Œä¸æˆ‘åˆ†äº«ä½ çš„æ„è§ï¼Œä½ ä¼šå¦‚ä½•æ”¹å–„è¿™ä¸ªè‡ªå®šä¹‰æŒ‚é’©ï¼Œæˆ–è€…å¦‚æœä½ æœ‰ä»»ä½•æƒ³æ³•ã€‚ğŸ»</p><p id="d76e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae ja" href="https://www.linkedin.com/in/mostafa-darehzereshki/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc je"> <em class="mw">è«æ–¯å¡”æ³•</em> </strong> </a></p></div></div>    
</body>
</html>