<html>
<head>
<title>Redirecting and Creating Protected Routes with React Router</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React路由器重定向和创建受保护的路由</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/redirecting-and-creating-protected-routes-with-react-router-1c0e2128cf3c?source=collection_archive---------3-----------------------#2020-04-13">https://javascript.plainenglish.io/redirecting-and-creating-protected-routes-with-react-router-1c0e2128cf3c?source=collection_archive---------3-----------------------#2020-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1ed33341e3f400b734c3f569b6fa24a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*boL4IBlKoDdQ59eT"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@sortino?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joshua Sortino</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="db87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React是一个用于创建前端视图的库。它有一个庞大的图书馆生态系统与之合作。此外，我们可以用它来增强现有的应用程序。</p><p id="b150" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要构建单页面应用程序，我们必须有某种方法将URL映射到React组件来显示。</p><p id="9454" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何重定向到不同的路由，并使用React路由器创建认证路由。</p><h1 id="401d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">再直接的</h1><p id="30b3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">Redirect</code>组件重定向到不同的路线。</p><p id="2726" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要以下道具:</p><ul class=""><li id="71e3" class="mi mj iq kf b kg kh kk kl ko mk ks ml kw mm la mn mo mp mq bi translated"><code class="fe me mf mg mh b">to</code> string prop —包含要重定向到的URL的字符串</li><li id="3c4e" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated"><code class="fe me mf mg mh b">to</code>对象属性——带有<code class="fe me mf mg mh b">pathname</code>、<code class="fe me mf mg mh b">search</code>查询参数和<code class="fe me mf mg mh b">state</code>的对象，带有可通过<code class="fe me mf mg mh b">this.props.location.state</code>访问的附加数据</li><li id="ab38" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated"><code class="fe me mf mg mh b">push</code> —如果<code class="fe me mf mg mh b">true</code>，则向历史添加新条目的布尔属性</li><li id="a81e" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated"><code class="fe me mf mg mh b">from</code> —要重定向的字符串属性。这只能用于在<code class="fe me mf mg mh b">Switch</code>外渲染<code class="fe me mf mg mh b">Rediect</code>时匹配位置</li><li id="7346" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated"><code class="fe me mf mg mh b">exact</code> —一个布尔属性，指示我们是否希望仅在URL完全匹配时重定向到该URL。</li><li id="78cb" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated"><code class="fe me mf mg mh b">strict</code> —一个布尔属性，用于在重定向到URL之前检查尾部斜杠是否匹配</li><li id="789d" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated"><code class="fe me mf mg mh b">sensitive</code> —指示重定向URL匹配是否必须区分大小写的布尔属性。</li></ul><p id="1b59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它来制作一个需要登录的受保护页面，如下所示:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="18a2" class="ne lc iq mh b gy nf ng l nh ni">import React from "react";<br/>import ReactDOM from "react-dom";<br/>import { BrowserRouter as Router, Switch, Route, Link } from "react-router-dom";<br/>import { useHistory, useLocation, Redirect } from "react-router";</span><span id="8cd3" class="ne lc iq mh b gy nj ng l nh ni">function PublicPage() {<br/>  return &lt;h3&gt;Public&lt;/h3&gt;;<br/>}</span><span id="6d5a" class="ne lc iq mh b gy nj ng l nh ni">function ProtectedPage() {<br/>  return &lt;h3&gt;Protected&lt;/h3&gt;;<br/>}</span><span id="b569" class="ne lc iq mh b gy nj ng l nh ni">function LoginPage() {<br/>  let history = useHistory();<br/>  let location = useLocation();<br/>  let { from } = location.state || { from: { pathname: "/" } };<br/>  let login = () =&gt; {<br/>    localStorage.setItem("loggedin", true);<br/>    history.replace(from);<br/>  };</span><span id="1af8" class="ne lc iq mh b gy nj ng l nh ni">  return (<br/>    &lt;div&gt;<br/>      &lt;button onClick={login}&gt;Log in&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="7a23" class="ne lc iq mh b gy nj ng l nh ni">function AuthButton() {<br/>  let history = useHistory();<br/>  return localStorage.getItem("loggedin") ? (<br/>    &lt;p&gt;<br/>      Welcome!{" "}<br/>      &lt;button<br/>        onClick={() =&gt; {<br/>          localStorage.clear();<br/>          history.push("/");<br/>        }}<br/>      &gt;<br/>        Sign out<br/>      &lt;/button&gt;<br/>    &lt;/p&gt;<br/>  ) : (<br/>    &lt;p&gt;You are not logged in.&lt;/p&gt;<br/>  );<br/>}</span><span id="038c" class="ne lc iq mh b gy nj ng l nh ni">function PrivateRoute({ children, ...rest }) {<br/>  return (<br/>    &lt;Route<br/>      {...rest}<br/>      render={({ location }) =&gt;<br/>        localStorage.getItem("loggedin") ? (<br/>          children<br/>        ) : (<br/>          &lt;Redirect<br/>            to={{<br/>              pathname: "/login",<br/>              state: { from: location }<br/>            }}<br/>          /&gt;<br/>        )<br/>      }<br/>    /&gt;<br/>  );<br/>}</span><span id="ccd1" class="ne lc iq mh b gy nj ng l nh ni">function App() {<br/>  return (<br/>    &lt;Router&gt;<br/>      &lt;AuthButton /&gt;<br/>      &lt;div&gt;<br/>        &lt;ul&gt;<br/>          &lt;li&gt;<br/>            &lt;Link to="/"&gt;Public Page&lt;/Link&gt;<br/>          &lt;/li&gt;<br/>          &lt;li&gt;<br/>            &lt;Link to="/private"&gt;Private Page&lt;/Link&gt;<br/>          &lt;/li&gt;<br/>        &lt;/ul&gt;</span><span id="627d" class="ne lc iq mh b gy nj ng l nh ni">        &lt;hr /&gt;<br/>        &lt;Switch&gt;<br/>          &lt;Route exact path="/"&gt;<br/>            &lt;PublicPage /&gt;<br/>          &lt;/Route&gt;<br/>          &lt;Route path="/login"&gt;<br/>            &lt;LoginPage /&gt;<br/>          &lt;/Route&gt;<br/>          &lt;PrivateRoute path="/private"&gt;<br/>            &lt;ProtectedPage /&gt;<br/>          &lt;/PrivateRoute&gt;<br/>        &lt;/Switch&gt;<br/>      &lt;/div&gt;<br/>    &lt;/Router&gt;<br/>  );<br/>}</span><span id="8c53" class="ne lc iq mh b gy nj ng l nh ni">const rootElement = document.getElementById("root");<br/>ReactDOM.render(&lt;App /&gt;, rootElement);</span></pre><p id="21e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有一个<code class="fe me mf mg mh b">PrivateRoute</code>组件，如果定义了<code class="fe me mf mg mh b">localStorage.get('loggedin')</code>的话，我们将显示开始和结束标记之间的内容。</p><p id="8906" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们通过呈现<code class="fe me mf mg mh b">Redirect</code>组件重定向到<code class="fe me mf mg mh b">Login</code>组件。</p><p id="b727" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过从道具中获取<code class="fe me mf mg mh b">path</code>并添加一个<code class="fe me mf mg mh b">render</code>道具，然后将该值设置为一个函数，如果定义了<code class="fe me mf mg mh b">localStorage.get('loggedin')</code>的话，该函数将呈现<code class="fe me mf mg mh b">children</code>道具。否则，我们呈现<code class="fe me mf mg mh b">Redirect</code>组件，将<code class="fe me mf mg mh b">to</code>设置为<code class="fe me mf mg mh b">/login</code>以返回登录页面。</p><p id="8d60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Login</code>组件有一个登录按钮，点击该按钮会将<code class="fe me mf mg mh b">loggedin</code>设置在本地存储器中。</p><p id="5a41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还有<code class="fe me mf mg mh b">AuthButton</code>来显示用户的身份验证状态，还有一个注销按钮来清除本地存储，并在点击时重定向回主页。</p><p id="682b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">App</code>中，我们添加了<code class="fe me mf mg mh b">Switch</code>中的所有路线，这样当我们点击<code class="fe me mf mg mh b">Link</code>时，我们就可以走我们期望的路线</p><p id="8d0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们列出了所有的路线，除了在<code class="fe me mf mg mh b">Switch</code>组件标签之间的私人路线。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/a2d3f10b9c17bd1046a40e72cc5400aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h_Uw_8eBrvzWB7lJ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@heftiba?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Toa Heftiba</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="fcc6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2029" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以呈现<code class="fe me mf mg mh b">Redirect</code>组件来重定向到一条路线。</p><p id="92bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用户没有登录或者没有满足其他条件，它对于定义我们想要对用户隐藏的受保护的路由是很有用的。</p><p id="c2f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了隐藏受保护的路由，我们可以创建一个返回<code class="fe me mf mg mh b">Route</code>对象的组件，在那里我们得到传入的<code class="fe me mf mg mh b">path</code>属性，然后我们添加一个<code class="fe me mf mg mh b">render</code>属性，如果满足某个条件，我们就在那里显示<code class="fe me mf mg mh b">props.children</code>，如果不满足，就重定向到登录页面。</p><h2 id="e2e7" class="ne lc iq bd ld nl nm dn lh nn no dp ll ko np nq lp ks nr ns lt kw nt nu lx nv bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="d722" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，用你的中级用户名发邮件到<a class="ae kc" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions@javascriptinplainenglish.com</strong></a>给我们，我们会把你添加为作者。</p><p id="b03d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还推出了三种新的出版物！请关注我们的新出版物:<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>——谢谢，继续学习！</p></div></div>    
</body>
</html>