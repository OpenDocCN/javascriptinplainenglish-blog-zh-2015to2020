<html>
<head>
<title>Vue 3 — Provide and Inject</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue 3 —提供和注入</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/vue-3-provide-and-inject-f30102de6fbb?source=collection_archive---------7-----------------------#2020-10-03">https://javascript.plainenglish.io/vue-3-provide-and-inject-f30102de6fbb?source=collection_archive---------7-----------------------#2020-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1273a0741b41a79155842b5fd7a3c6ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nMIf_Y9BW6oNvhdD"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@ecasap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Elaine Casap</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f23e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue 3处于测试阶段，可能会有变化。</p><p id="d5d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue 3是Vue前端框架的最新版本。</p><p id="1584" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它建立在Vue 2的普及性和易用性之上。</p><p id="577f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究用Vue 3提供和注入数据。</p><h1 id="f889" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提供和注射</h1><p id="fc2a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了使在深度嵌套的组件之间传递数据更容易，我们可以绕过props，使用<code class="fe me mf mg mh b">provide</code>属性来公开一些数据。</p><p id="7af0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用<code class="fe me mf mg mh b">inject</code>属性来获取数据。</p><p id="7c3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3525" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;blog-post&gt;&lt;/blog-post&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const app = Vue.createApp({});</span><span id="5212" class="mq lc iq mh b gy mv ms l mt mu">      app.component("blog-post", {<br/>        data() {<br/>          return {<br/>            post: { title: "hello world" }<br/>          };<br/>        },<br/>        provide: {<br/>          author: "james"<br/>        },<br/>        template: `<br/>          &lt;div&gt;<br/>            {{ post.title }}<br/>            &lt;blog-post-statistics&gt;&lt;/blog-post-statistics&gt;<br/>          &lt;/div&gt;<br/>        `<br/>      });</span><span id="70ea" class="mq lc iq mh b gy mv ms l mt mu">      app.component("blog-post-statistics", {<br/>        inject: ["author"],<br/>        template: `<br/>          &lt;p&gt;{{author}}&lt;/p&gt;<br/>        `,<br/>        created() {<br/>          console.log(this.author);<br/>        }<br/>      });</span><span id="87db" class="mq lc iq mh b gy mv ms l mt mu">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="1974" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">blog-post</code>和<code class="fe me mf mg mh b">blog-post-statistics</code>组件。</p><p id="64d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">blog-post</code>组件中，我们有带有<code class="fe me mf mg mh b">author</code>属性的<code class="fe me mf mg mh b">provide</code>属性。</p><p id="56b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们提供给子组件的数据。</p><p id="e194" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，在<code class="fe me mf mg mh b">blog-post-statistics</code>组件中，我们有一个<code class="fe me mf mg mh b">inject</code>属性，其中包含了我们想要获取的<code class="fe me mf mg mh b">provide</code>中的属性名数组。</p><p id="8cec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以<code class="fe me mf mg mh b">blog-post-statistics</code>中的<code class="fe me mf mg mh b">author</code>在模板中是<code class="fe me mf mg mh b">author</code>或者在组件方法中是<code class="fe me mf mg mh b">this.author</code>。</p><p id="aa83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，这不适用于Vue实例属性。</p><p id="6bf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="adae" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;blog-post&gt;&lt;/blog-post&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const app = Vue.createApp({});</span><span id="e234" class="mq lc iq mh b gy mv ms l mt mu">      app.component("blog-post", {<br/>        data() {<br/>          return {<br/>            post: { title: "hello world", author: "james" }<br/>          };<br/>        },<br/>        provide: {<br/>          post: this.post<br/>        },<br/>        template: `<br/>          &lt;div&gt;<br/>            {{ post.title }}<br/>            &lt;blog-post-statistics&gt;&lt;/blog-post-statistics&gt;<br/>          &lt;/div&gt;<br/>        `<br/>      });</span><span id="c7b2" class="mq lc iq mh b gy mv ms l mt mu">      app.component("blog-post-statistics", {<br/>        inject: ["post"],<br/>        template: `<br/>          &lt;p&gt;{{post.author}}&lt;/p&gt;<br/>        `,<br/>        created() {<br/>          console.log(this.post.author);<br/>        }<br/>      });</span><span id="5537" class="mq lc iq mh b gy mv ms l mt mu">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5a0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">则不会显示任何内容。</p><p id="3f5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要解决这个问题，我们必须将值传递给<code class="fe me mf mg mh b">provide</code>的属性，并将<code class="fe me mf mg mh b">provide</code>更改为一个函数:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="987a" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;blog-post&gt;&lt;/blog-post&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const app = Vue.createApp({});</span><span id="ed91" class="mq lc iq mh b gy mv ms l mt mu">      app.component("blog-post", {<br/>        data() {<br/>          return {<br/>            post: { title: "hello world", author: "james" }<br/>          };<br/>        },<br/>        provide() {<br/>          return {<br/>            author: this.post.author<br/>          };<br/>        },<br/>        template: `<br/>          &lt;div&gt;<br/>            {{ post.title }}<br/>            &lt;blog-post-statistics&gt;&lt;/blog-post-statistics&gt;<br/>          &lt;/div&gt;<br/>        `<br/>      });</span><span id="4ea9" class="mq lc iq mh b gy mv ms l mt mu">      app.component("blog-post-statistics", {<br/>        inject: ["author"],<br/>        template: `<br/>          &lt;p&gt;{{author}}&lt;/p&gt;<br/>        `,<br/>        created() {<br/>          console.log(this.author);<br/>        }<br/>      });</span><span id="dd08" class="mq lc iq mh b gy mv ms l mt mu">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="103f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在<code class="fe me mf mg mh b">provide</code>是<code class="fe me mf mg mh b">blog-post</code>组件的方法，而不是属性。</p><p id="2204" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们把我们想提供的东西返回给子组件。</p><h1 id="30ec" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用反应性</h1><p id="75f4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当我们更新子组件时，父组件中具有反应属性的更改不会反映在子组件中。</p><p id="94f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个问题可以通过将反应属性设置为计算属性来解决。</p><p id="6e6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a24d" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;counter&gt;&lt;/counter&gt;<br/>    &lt;/div&gt;<br/>    &lt;script&gt;<br/>      const app = Vue.createApp({});</span><span id="d0a0" class="mq lc iq mh b gy mv ms l mt mu">      app.component("counter", {<br/>        data() {<br/>          return {<br/>            count: 0<br/>          };<br/>        },<br/>        provide() {<br/>          return { count: Vue.computed(() =&gt; this.count) };<br/>        },<br/>        template: `<br/>          &lt;div&gt;<br/>            &lt;button @click='count++'&gt;increment&lt;/button&gt;<br/>            &lt;count-display&gt;&lt;/count-display&gt;<br/>          &lt;/div&gt;<br/>        `<br/>      });</span><span id="a6fb" class="mq lc iq mh b gy mv ms l mt mu">      app.component("count-display", {<br/>        inject: ["count"],<br/>        template: `<br/>          &lt;p&gt;{{count.value}}&lt;/p&gt;<br/>        `<br/>      });</span><span id="1c38" class="mq lc iq mh b gy mv ms l mt mu">      app.mount("#app");<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="f240" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个带有<code class="fe me mf mg mh b">provide</code>方法的<code class="fe me mf mg mh b">counter</code>组件，它返回一个带有<code class="fe me mf mg mh b">count</code>属性的对象。</p><p id="546d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它的值是一个计算属性，回调函数中返回了<code class="fe me mf mg mh b">this.count</code>。</p><p id="0fcb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，最新的值将被传播到子组件。</p><p id="4c4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">count-display</code>组件中，我们可以用<code class="fe me mf mg mh b">value</code>属性获取值。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/f29bfbace167772f98142fca1b92e7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o0h1D5l-PjnD-RVb"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@studioktr?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kate Remmer</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="3b5a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d29d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Provide和inject gives是一种不使用props将数据传递给深层嵌套组件的方法。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/787be6c671be8d345dc786dad8729ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-sOyyG8NoRbKpCG_y4Cmw@2x.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank">Subscribe to Decoded, our official YouTube channel!</a></figcaption></figure></div></div>    
</body>
</html>