# ä½¿ç”¨ Express & Node.js ä» Cookies å’Œè¡¨å•ä¸­è®¿é—®æ•°æ®

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/accessing-data-from-cookies-and-forms-using-express-node-js-c140c9f59f6d?source=collection_archive---------4----------------------->

## ä½¿ç”¨ Node.js äº†è§£ Express

## äº†è§£å¦‚ä½•é€šè¿‡ Cookies å’Œè¡¨å•ä»è¯·æ±‚å¯¹è±¡è·å–æ•°æ®

![](img/0b54b28e6f8dd169748bacbd01dbfb00.png)

Photo by [The Creative Exchange](https://unsplash.com/@thecreative_exchange) on Unsplash.

å¯¹äºæœ‰å…´è¶£å°† node ç”¨ä½œ web æœåŠ¡å™¨æˆ–è€…å°† WebSockets ä¸ Express ç»“åˆä½¿ç”¨çš„å¼€å‘äººå‘˜ã€‚è¿™ç¯‡æ–‡ç« ä¸€å®šä¼šå¯¹ä½ æœ‰ç›Šã€‚

***Express.js*** *ï¼Œæˆ–ç®€ç§°ä¸º* ***Express*** *ï¼Œæ˜¯ä¸€ä¸ªåç«¯ web åº”ç”¨æ¡†æ¶ï¼Œä¸º*[*node . js*](https://en.wikipedia.org/wiki/Node.js)*ï¼Œåœ¨ MIT è®¸å¯ä¸‹ä½œä¸ºå…è´¹å¼€æºè½¯ä»¶å‘å¸ƒã€‚å®ƒæ˜¯ä¸ºæ„å»º web åº”ç”¨ç¨‹åºå’Œ API è€Œè®¾è®¡çš„ã€‚å®ƒè¢«ç§°ä¸º Node.js çš„* [*äº‹å®ä¸Šçš„æ ‡å‡†*](https://en.wikipedia.org/wiki/De_facto_standard) *æœåŠ¡å™¨æ¡†æ¶â€”â€”Wikipedia.org*

# **åˆå§‹è®¾ç½®**

1.  ä½¿ç”¨ **npm init** å‘½ä»¤ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ª **package.json** æ–‡ä»¶ï¼Œè¦äº†è§£æ›´å¤šå…³äº NPM package . JSON çš„è§„èŒƒï¼Œä½ å¯ä»¥å»è¿™ä¸ª[é“¾æ¥](https://docs.npmjs.com/files/package.json)ï¼Œå¦åˆ™æŒ‰å›è½¦é”®ä¿ç•™é»˜è®¤é…ç½®ã€‚

```
 **npm init**
```

2.å®‰è£…[***Express***](https://expressjs.com/)å¹¶é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†å…¶æ·»åŠ åˆ°ä¾èµ–åˆ—è¡¨ä¸­:

```
**npm install express -- save**
```

3.å®‰è£…[***node mon***](https://nodemon.io/)ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç”¨ç¨‹åºï¼Œå®ƒä¼šç›‘è§†æ‚¨åœ¨æºæ–‡ä»¶ä¸­æ‰€åšçš„æ›´æ”¹ï¼Œå¹¶ä¼šè‡ªåŠ¨ä¸ºæ‚¨é‡å¯æœåŠ¡å™¨ã€‚è¿™åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¾ˆæœ‰å¸®åŠ©ï¼Œæ‰€ä»¥æ¯å½“æ‚¨æ·»åŠ ä¸€äº›æ›´æ”¹æ—¶ï¼Œæ‚¨ä¸éœ€è¦ä¸æ–­é‡å¯æœåŠ¡å™¨ã€‚

```
**npm install nodemon -- save**
```

4.å®‰è£… [***å¤´ç›”***](https://helmetjs.github.io/)â€”â€”è¿™æ˜¯ä¸€ä¸ª Express ä¸­é—´ä»¶ web æ¡†æ¶ã€‚é€šè¿‡é€‚å½“åœ°æä¾› HTTP å¤´ï¼ŒHelmet å¯ä»¥å¸®åŠ©ä¿æŠ¤ Express åº”ç”¨ç¨‹åºå…å—å„ç§å·²çŸ¥æ¼æ´çš„å½±å“ã€‚å¤´ç›”ç”± 11 ä¸ªè¾ƒå°çš„ä¸­é—´ä»¶å‡½æ•°ç»„æˆï¼Œè¿™äº›å‡½æ•°è®¾ç½®ä¸å®‰å…¨ç›¸å…³çš„ HTTP è¯·æ±‚å¤´ã€‚

```
**npm install helmet -- save**
```

5.ä¸ºäº†èƒ½å¤Ÿä» cookie ä¸­è·å–ä¿¡æ¯ï¼Œä½ éœ€è¦å®‰è£…ä¸€ä¸ª cookie è§£æå™¨**ã€‚**[***cookie-parser***](http://expressjs.com/en/resources/middleware/cookie-parser.html)æ˜¯ä¸€ä¸ª Express ä¸­é—´ä»¶å‡½æ•°ï¼Œè´Ÿè´£è§£æ Cookie å¤´ï¼Œå¹¶å°† Cookie æ•°æ®å…¬å¼€ä¸º *response.cookie* ã€‚

```
**npm install cookie-parser -- save**
```

6.å¯¹äºä½ çš„æ¨¡æ¿ï¼Œä½ éœ€è¦å®‰è£… EJSã€‚ [EJS](https://ejs.co/) æ˜¯ä¸€ç§ç®€å•çš„æ¨¡æ¿è¯­è¨€ï¼Œå¯ä»¥è®©ä½ ç”¨æ™®é€šçš„ Javascript ç”Ÿæˆ HTML æ ‡è®°ã€‚

```
**npm install ejs -- save**
```

7.åœ¨æ ¹ç›®å½•ä¸‹æ·»åŠ  ***index.js*** æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ä¸æ‚¨åœ¨ç”Ÿæˆ package.json æ—¶æŒ‡å®šä¸º*å…¥å£ç‚¹*çš„æ–‡ä»¶ç›¸åŒã€‚

```
**touch index.js**
```

8.é…ç½® ***package.json*** ã€‚å¦‚æœæ‚¨æƒ³æ›´æ”¹æ‚¨åœ¨ package.json ä¸­æŒ‡å®šä¸ºå…¥å£ç‚¹çš„æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥åœ¨*è„šæœ¬*éƒ¨åˆ†ä¸­æŒ‡å®šå®ƒã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ ***Nodemon*** ï¼Œæ‚¨éœ€è¦å°† start å‘½ä»¤çš„å±æ€§æ›´æ”¹ä¸º:

```
**â€œstartâ€: â€œnodemon index.jsâ€**
```

# ç›®å½•ç»“æ„

Express æ˜¯ä¸€ä¸ªéä¸ªäººåŒ–çš„ web æ¡†æ¶ï¼Œå› æ­¤ï¼Œåªè¦ä½ æä¾›æ­£ç¡®çš„è„šæœ¬è·¯å¾„ï¼Œæ–‡ä»¶å¤¹ç»“æ„å°†ä¸ä»…ä»…å½±å“åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œå°†æè¿°å¦‚ä½•ä»è¡¨å•å’Œ cookies ä¸­è®¿é—®æ•°æ®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œä½†å¦‚æœä½ æƒ³è¦ä¸€ä¸ªè¯¦ç»†å’Œå®Œæ•´çš„è„šæ‰‹æ¶ï¼Œä½ å¯èƒ½æƒ³ä½¿ç”¨ [Express generator](http://expressjs.com/en/starter/generator.html) ä»£æ›¿ã€‚

```
.
â”œâ”€â”€ public
â”‚   â””â”€â”€ stylesheets
â”‚       â””â”€â”€ styles.css
â”œâ”€â”€ views
â”‚   â”œâ”€â”€ login.ejs
â”‚   â””â”€â”€ welcome.ejs
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

# åœ¨ä¸»æ–‡ä»¶ä¸­

ç°åœ¨æ‚¨å·²ç»å®Œæˆäº†åº”ç”¨ç¨‹åºçš„è®¾ç½®ï¼Œæˆ‘ä»¬å°†å¼€å§‹åœ¨ *index.js* æ–‡ä»¶ä¸­æ·»åŠ æ‰€éœ€çš„è„šæœ¬ã€‚æˆ‘ä»¬å°†ä¸€è¡Œä¸€è¡Œåœ°æ£€æŸ¥ä»£ç ï¼Œæˆ‘å°†å°è¯•æ·»åŠ ä¸€ä¸ªè¯¦ç»†çš„è§£é‡Šï¼Œè¯´æ˜ä»£ç çš„ä½œç”¨å’Œç”¨é€”ã€‚

ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªå¸¸é‡ä¸­èµ‹å€¼ expressï¼Œå¹¶å£°æ˜äº†å¦ä¸€ä¸ªå¸¸é‡ *app* ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åå¯ä»¥è°ƒç”¨ Expressã€‚

```
**const express = require(â€˜expressâ€™);
const app = express();**
```

ç„¶åï¼Œæ‚¨å¿…é¡»æŒ‡å®šæ‚¨å°†ä½¿ç”¨çš„ç«¯å£ï¼Œè¯¥ç«¯å£åº”è¯¥æ˜¯ 1000 åŠä»¥ä¸Šï¼Œä»¥ä¾¿å®ƒçš„å·¥ä½œã€‚

```
**const port = 3000;
app.listen(port);**
```

Express æœ‰ä¸€ä¸ªå†…ç½®çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œä½ éœ€è¦æ·»åŠ å®ƒæ¥æŒ‡å®šä½ çš„é™æ€æ–‡ä»¶çš„ä½ç½®â€”â€”**pathã€‚ç”±äºå®ƒæ˜¯å†…ç½®çš„ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨åˆå§‹è®¾ç½®æ—¶ä¸éœ€è¦å®‰è£…å®ƒã€‚åªè¦æŠŠå®ƒå­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­å°±å¯ä»¥ä½¿ç”¨äº†ã€‚**

```
**const path = require(â€˜pathâ€™);**
```

ä¸ºå®‰å…¨è¿æ¥æ·»åŠ ä¸­é—´ä»¶ ***å¤´ç›”*** ä¹Ÿæ˜¯ä¹ æƒ¯å’Œæ ‡å‡†ã€‚

```
**const helmet = require(â€˜helmetâ€™);
app.use(helmet());**
```

ä½ å¿…é¡»è°ƒç”¨[***express . json()***](https://expressjs.com/en/4x/api.html#express.json)â€”è¿™æ˜¯ Express ä¸­å†…ç½®çš„ä¸­é—´ä»¶åŠŸèƒ½ï¼Œå®ƒä½¿ç”¨ JSON æœ‰æ•ˆè´Ÿè½½è§£æä¼ å…¥çš„è¯·æ±‚ï¼Œå¹¶åŸºäº*ä¸»ä½“è§£æå™¨*ã€‚

```
**app.use(express.json());**
```

ä»¥åŠ[***express . urlencoded(***](https://expressjs.com/en/4x/api.html#express.urlencoded)***)***â€”å®ƒè§£æ *urlencoded* ä¸»ä½“ï¼Œå¹¶ä¸”åªæŸ¥çœ‹*å†…å®¹ç±»å‹*ä¸*ç±»å‹*é€‰é¡¹åŒ¹é…çš„è¯·æ±‚ã€‚

```
**app.use(express.urlencoded());**
```

ä¸ºäº†åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ å’Œä½¿ç”¨é™æ€æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ Express å†…ç½®ä¸­é—´ä»¶â€”[***Express . static()***](https://expressjs.com/en/4x/api.html#express.static)ï¼Œå®ƒæ¥å—æ ¹å‚æ•°ï¼Œå³æ‚¨å°†æ”¾ç½®æ‰€æœ‰é™æ€èµ„äº§çš„æ–‡ä»¶å¤¹åç§°ã€‚åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬æ”¾åœ¨ **public** æ–‡ä»¶å¤¹ä¸­ã€‚

å¦‚æœæ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œå®ƒå°†æ‰§è¡Œå›è°ƒä¸­çš„ ***next()*** å‚æ•°ï¼Œç„¶åç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æ¥æ‰§è¡Œï¼Œå…è®¸å›é€€å’Œå †æ ˆï¼Œè€Œä¸æ˜¯æ˜¾ç¤º 404 å“åº”ã€‚

```
**app.use(express.static(â€˜publicâ€™));**
```

ç„¶åæˆ‘ä»¬éœ€è¦å®šä¹‰ä½¿ç”¨å“ªä¸ª javascript æ¨¡æ¿ï¼Œè¿˜æœ‰å…¶ä»–å¯ç”¨çš„ JS æ¨¡æ¿å¦‚ [***å¸•æ ¼***](https://pugjs.org/api/getting-started.html) *ï¼Œ* [***è½¦æŠŠ***](https://handlebarsjs.com/) *ï¼Œ**[*å°èƒ¡å­*](https://mustache.github.io/) *ã€‚*ä½†æ˜¯ï¼Œåœ¨è¿™ä¸ªåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ EJSã€‚*

```
***app.use(â€˜view engineâ€™, â€˜ejsâ€™);
app.use(â€˜viewsâ€™, path.join(__dirname, â€˜viewsâ€™));***
```

*åœ¨æ ¹é¡µé¢ä¸Šï¼Œæ‚¨ç°åœ¨åªéœ€æ˜¾ç¤º*â€˜å¥å…¨æ€§æ£€æŸ¥â€™*æ–‡æœ¬ã€‚ä»¥ç¡®ä¿æˆ‘ä»¬çš„é…ç½®å’Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç è¿è¡Œè‰¯å¥½ã€‚æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨*ç™»å½•*é¡µé¢ï¼Œå› æ­¤æ— éœ€åœ¨æ­¤é¡µé¢å‘ˆç°è¯¦ç»†ä¿¡æ¯ã€‚*

```
***app.get(â€˜/â€™, (response, request, next) => {
    app.send(â€˜Sanity checkâ€™);
});***
```

*æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†åˆå§‹è®¾ç½®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œå®ƒ:*

```
***npm start***
```

*ç„¶ååœ¨æµè§ˆå™¨ä¸­å¯¼èˆªåˆ°[**https://localhost:3000**](https://localhost:3000)**ã€‚æ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä¸ä¸‹é¢æˆªå›¾ç›¸åŒçš„é¡µé¢:***

***![](img/1953d65a912cd3c3a0f9cb00a1d08c7a.png)***

***View to the root page.***

# ***æ„å»ºè¡¨å•æ¨¡æ¿***

***æœ¬æ–‡çš„é‡ç‚¹æ˜¯æŒ‡å¯¼ä½ å¦‚ä½•ä»è¡¨å•å’Œ Cookie ä¸­è·å–æ•°æ®ï¼Œæ‰€ä»¥ä¸è¦æµªè´¹å¤ªå¤šæ—¶é—´è®¾è®¡æ¨¡æ¿ã€‚ä½ å¯ä»¥å‚è€ƒæˆ‘åœ¨è¿™ä¸ª[æ–‡ä»¶](https://github.com/foobearer/Express-Form-and-Cookies/blob/main/public/stylesheets/styles.css)ä¸­å†™çš„ CSSï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°***/public/style sheet****æ–‡ä»¶å¤¹ä¸­çš„ styles.css ä¸­ã€‚****

****å¯¹äºæ¨¡æ¿ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ *login.ejs* ï¼Œç„¶åå°†å…¶æ”¾åœ¨ **/views** æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :****

****![](img/cee8826561f784af82620e5797f213af.png)****

****login.ejs page template.****

****ä¸ºäº†è®©æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šçœ‹åˆ°ä¸Šé¢çš„æ¨¡æ¿ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ª get è¯·æ±‚ï¼Œå¦‚ä¸‹æ‰€ç¤º:****

****![](img/5131e192a0b766faeccb29c03e48978d.png)****

****index.js â€” adding get a request to display the login.ejs page.****

****å¤ªå¥½äº†ï¼Œç°åœ¨æ‚¨å¯ä»¥å¯¼èˆªåˆ°æµè§ˆå™¨å¹¶è¿›å…¥ç™»å½•é¡µé¢ã€‚[https://localhost:3000/log in](http://localhost:3000/login)ã€‚****

****![](img/073d916ee071734919018bc265817d30.png)****

****login page view.****

# ****ä» cookie ä¸­è·å–æ•°æ®****

****å¦‚æœæ‚¨è¿”å›å¹¶æ£€æŸ¥æˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„ç™»å½•è¡¨å•ï¼Œæ‚¨å°†çœ‹åˆ°åœ¨è¡¨å•æ ‡è®°çš„ ***action*** å±æ€§ä¸‹ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª***/process _ log in***è·¯å¾„ï¼Œè¯¥è·¯å¾„å°†æ‰§è¡Œæˆ‘ä»¬æ”¾åœ¨ POST è¯·æ±‚ä¸­çš„ä»£ç ã€‚æŒ‰ç…§ä¸‹é¢çš„å›¾åƒ:****

****![](img/7819aba6ecdf5e1ce617d8d27554f1ba.png)****

****index.js â€” post method to get data from the form and to save that inside a cookie.****

****å½“æ‚¨æŒ‰ä¸‹é¡µé¢ä¸Šçš„ç™»å½•æŒ‰é’®æ—¶ï¼Œæ‚¨åœ¨è¡¨å•ä¸­æä¾›çš„ç”¨æˆ·åå’Œå¯†ç å°†è¢«è½¬å‘åˆ°è¯·æ±‚ä¸»ä½“ã€‚****

****æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥éªŒè¯æˆ‘ä»¬æ˜¯å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¬¢è¿é¡µé¢è¿˜æ˜¯è¿”å›åˆ°ç™»å½•é¡µé¢ã€‚****

****åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè¦å°†è¿™äº›æ•°æ®ä¿å­˜åˆ° cookie ä¸­ï¼Œæˆ‘ä»¬åªéœ€æ·»åŠ :****

```
******response.cookie('username', username);******
```

****ä¸ºäº†ç¡®ä¿å®ƒæ­£å¸¸å·¥ä½œï¼Œæ£€æŸ¥é¡µé¢å¹¶å¯¼èˆªåˆ° ***åº”ç”¨*** é€‰é¡¹å¡ï¼Œç„¶åå•å‡»ä¾§è¾¹æ ä¸Šçš„ cookies:****

****![](img/0f22b752055f3ee53646570a83ea0a08.png)****

****Checking the data saved inside Cookies.****

****ä¸€æ—¦æ‚¨çš„ç”¨æˆ·å‡­è¯ä¸ *userdetails* å¯¹è±¡ä¸­çš„å‡­è¯ç›¸åŒ¹é…ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ° *welcome* é¡µé¢:****

****![](img/6d56a5c865d058194ec10db1725b4da5.png)****

****Welcome page view â€” https://localhost:3000/welcome:.****

# ****ä» Cookies ä¸­åˆ é™¤æ•°æ®****

****åˆ é™¤ cookie é‡Œé¢ä¿å­˜çš„æ•°æ®éå¸¸ç®€å•ã€‚æ‚¨åªéœ€è¦åœ¨ä¸‹é¢æ·»åŠ è¿™æ®µä»£ç ã€‚****

```
******response.clearCookie('username');******
```

****æœ€åä¸€éƒ¨åˆ†æ˜¯æ·»åŠ æ³¨é”€çš„ä»£ç ç‰‡æ®µã€‚****

****![](img/11335f18a4595c5ec9747fac00545807.png)****

****index.js â€” logout GET method.****

****å¦‚æœä½ çƒ­è¡·äºå­¦ä¹ å¹¶ä¸”æƒ³è¦è·å¾—è¿™ä¸ªåº”ç”¨ç¨‹åºçš„å®Œæ•´å‰¯æœ¬ï¼Œä½ å¯ä»¥åœ¨æˆ‘çš„ GitHub å¸æˆ·ä¸­å…‹éš†è¿™ä¸ª[åº“](https://github.com/foobearer/Express-Form-and-Cookies)ã€‚âœŒğŸ»ğŸ˜‰****

****ä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©å—ï¼Ÿåˆ«å¿˜äº†åœ¨è¯„è®ºåŒºç•™ä¸‹ä¸€äº›åé¦ˆã€‚****

## ****å‚è€ƒèµ„æ–™:****

****[å¿«é€’](https://expressjs.com/)****

****[å¤´ç›”](https://helmetjs.github.io/)****

****[NPM package . JSON è§„èŒƒ](https://docs.npmjs.com/files/package.json)****