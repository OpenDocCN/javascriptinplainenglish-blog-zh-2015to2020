<html>
<head>
<title>Connect a Relational DB and Backend with Node.js, Sequelize, PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js、Sequelize、PostgreSQL连接关系数据库和后端</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/nodejs-sequelize-postgresql-wire-up-a-relational-db-and-backend-f7d3c4587ed0?source=collection_archive---------6-----------------------#2020-11-02">https://javascript.plainenglish.io/nodejs-sequelize-postgresql-wire-up-a-relational-db-and-backend-f7d3c4587ed0?source=collection_archive---------6-----------------------#2020-11-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/13d74e6ebc2f760309f3ba8f0e1c1df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IeSwsPRwatj977yF"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@lucian_alexe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lucian Alexe</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="71c2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一位熨斗学校的教师曾经告诉我，当学习一门新的语言、库或框架时，它有助于建立一个你以前已经建立的项目想法。这就去掉了“<em class="ky">我必须想出一个好主意才能开始编码”</em>这样你就可以专注于学习新技术的语法和架构。</p><p id="2435" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是我在过去几周学习<a class="ae ja" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> node.js </a>的方法。</p><h2 id="9f7c" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">项目基础:</h2><p id="7524" class="pw-post-body-paragraph ka kb jd kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">这是一个DIY分享网站，你可以上传带有图片的制作说明，并与其他用户分享。将会有一个带有推送通知的喜欢和标签系统(最终)。</p><h2 id="1b70" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">我们今天要关注的是:</h2><p id="1f31" class="pw-post-body-paragraph ka kb jd kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">= &gt;让一个<a class="ae ja" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>服务器连接到我们的node.js后端。<br/> = &gt;添加Sequelize作为ORM来建立两个模型之间的关系<br/> = &gt;创建我们模型的几个实例，并将它们存储在DB中<br/> = &gt;使用<a class="ae ja" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠症</a>通过调用后端调用我们的DB实例，这样我们就可以看到我们的成功了</p><p id="a879" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建顺序化应用程序:</p><p id="f126" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将充分利用Sequelize CLI来帮助我们尽快完成Sequelize设置。我将留下一些链接来获取更多信息，包括命令的完整列表。</p><p id="b154" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先让我们启动一个节点应用程序并安装一些包。在您的项目目录中，运行以下命令:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="87f5" class="kz la jd mc b gy mg mh l mi mj">npm init -y<br/>npm install sequelize pg express</span></pre><p id="8d48" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这会生成一个package.json文件，然后将sequelize、express和postgreSQL包添加到我们的应用程序中。</p><p id="72c4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们初始化一个Sequelize项目，并在我们最喜欢的编辑器中打开目录(这里是VS代码)</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="34b5" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli init</span></pre><p id="8901" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要了解所有的Sequelize CLI命令，请看这里的<a class="ae ja" href="https://www.npmjs.com/package/sequelize-cli" rel="noopener ugc nofollow" target="_blank"/></p><p id="0f8f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们需要配置我们的Sequelize项目来使用Postgres db。在<code class="fe mk ml mm mc b">/config</code>目录中找到您的<code class="fe mk ml mm mc b">config.json</code>文件，并修改代码，如下所示。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="295a" class="kz la jd mc b gy mg mh l mi mj">{<br/>  "development": {<br/>    "database": "&lt;YOUR_PROJECT_NAME&gt;_development",<br/>    "dialect": "postgres"<br/>  },<br/>  "test": {<br/>    "database": "&lt;YOU_PROJECT_NAME&gt;_test",<br/>    "dialect": "postgres"<br/>  },<br/>  "production": {<br/>    "use_env_variable": "DATABASE_URL",<br/>    "dialect": "postgres",<br/>    "dialectOptions": {<br/>      "ssl": {<br/>        "rejectUnauthorized": false<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="693d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">env变量将允许我们稍后轻松地部署到Heroku。(另一篇博客中有更多相关内容)</p><p id="67da" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以使用Sequelize CLI来创建Postgres DB。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="e04a" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli db:create</span></pre><h2 id="b8a8" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">定义我们的模型并添加测试api的种子数据</h2><p id="68a7" class="pw-post-body-paragraph ka kb jd kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">我的应用程序有两个启动模型，用户和项目。每个项目将有一个用户，一个用户可以有许多项目。让我们首先创建用户，因为他们不需要另一个模型来创建实例。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="7bbe" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli mode:generate --name User --attributes firstName:string,lastName:string</span></pre><p id="563f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">* *如果出现错误，请确保属性标志中没有空格。这将导致失败**</p><p id="c6ec" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行模型:生成自动创建我们的模型文件和我们的迁移文件，并带有我们指定的属性。如果您忘记了<code class="fe mk ml mm mc b">/models/user.js</code>文件和<code class="fe mk ml mm mc b">/migrations/&lt;long number string&gt;-create-user.js</code>文件中的内容，您可以手动编辑这些字段。你也可以删除上面提到的文件，并在修复后再次运行<code class="fe mk ml mm mc b">model:generate</code>命令。</p><p id="a639" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过运行以下命令，迁移您的更改并在数据库中创建用户表</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="6df6" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli db:migrate</span></pre><p id="a4ff" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们创建一个种子文件:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="9246" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli seed:generate --name users</span></pre><p id="61be" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将看到一个名为<code class="fe mk ml mm mc b">/seeders</code>的新目录。在该文件中，以下列格式添加一些虚拟用户:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="12c6" class="kz la jd mc b gy mg mh l mi mj">module.exports = {<br/>   up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.bulkInsert('Users', [{<br/>      firstName: 'John',<br/>      lastName: 'Doe',<br/>      createdAt: new Date(),<br/>      updatedAt: new Date()<br/>    },<br/>    { another user like above if you want}<br/>    ], {});<br/>},<br/>   down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.bulkDelete('Users', null, {});<br/>  };<br/>}</span></pre><p id="a98a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以用和以前一样的方法制作我们的另一个模型<code class="fe mk ml mm mc b">Projects</code>。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="090d" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli model:generate --name Project --attributes title:string,description:text,userId:integer</span></pre><p id="e6f9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以把这两个模型联系起来</p><p id="94ff" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae ja" href="https://sequelize.org/master/manual/assocs.html" rel="noopener ugc nofollow" target="_blank">这里的</a>是关于使用序列化CLI创建序列化关联的更多信息</p><p id="9c66" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，让我们将项目关联添加到user.js模型中。该关联被添加到<code class="fe mk ml mm mc b">static associate(models)</code>方法中。</p><figure class="lx ly lz ma gt ip"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="2fac" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe mk ml mm mc b">project.js</code>模型中，我们将添加同一关联的另一端，这样一个项目就可以属于一个用户</p><figure class="lx ly lz ma gt ip"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="0b5d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后一步是将外键添加到项目迁移文件中。您应该在迁移中保存文件。我们需要处理文件名中带有<code class="fe mk ml mm mc b">create-projects</code>的文件。</p><figure class="lx ly lz ma gt ip"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="6903" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">迁移新更改的项目文件，以在数据库上启动和运行项目表。</p><p id="146d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们用一些项目为我们的用户播种我们的数据库。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="103f" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli seed:generate --name projects</span></pre><p id="15ba" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将在<code class="fe mk ml mm mc b">/seeders</code>目录中找到新的种子文件。增加一些项目！</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="8fcb" class="kz la jd mc b gy mg mh l mi mj">'use strict';</span><span id="41ac" class="kz la jd mc b gy mp mh l mi mj"><em class="ky">module</em>.<em class="ky">exports</em> = {</span><span id="9afd" class="kz la jd mc b gy mp mh l mi mj">up: async (<em class="ky">queryInterface</em>, <em class="ky">Sequelize</em>) =&gt; {</span><span id="2fc0" class="kz la jd mc b gy mp mh l mi mj">await <em class="ky">queryInterface</em>.bulkInsert("Projects", [</span><span id="6dc2" class="kz la jd mc b gy mp mh l mi mj">{</span><span id="61e8" class="kz la jd mc b gy mp mh l mi mj">title: "test project 1",</span><span id="128b" class="kz la jd mc b gy mp mh l mi mj">description: "This project was built using Vanilla JavaScript, HTML, and CSS",</span><span id="41b5" class="kz la jd mc b gy mp mh l mi mj">userId: 1,</span><span id="d819" class="kz la jd mc b gy mp mh l mi mj">createdAt: <strong class="mc je">new</strong> <em class="ky">Date</em>(),</span><span id="99c8" class="kz la jd mc b gy mp mh l mi mj">updatedAt: <strong class="mc je">new</strong> <em class="ky">Date</em>()</span><span id="b5a8" class="kz la jd mc b gy mp mh l mi mj">},</span><span id="d92e" class="kz la jd mc b gy mp mh l mi mj">{</span><span id="7b27" class="kz la jd mc b gy mp mh l mi mj">title: "test project 2",</span><span id="7f8b" class="kz la jd mc b gy mp mh l mi mj">description: "This project was built using React &amp; a 3rd-party API.",</span><span id="a982" class="kz la jd mc b gy mp mh l mi mj">userId: 3,</span><span id="19ca" class="kz la jd mc b gy mp mh l mi mj">createdAt: <strong class="mc je">new</strong> <em class="ky">Date</em>(),</span><span id="25a6" class="kz la jd mc b gy mp mh l mi mj">updatedAt: <strong class="mc je">new</strong> <em class="ky">Date</em>()</span><span id="7ad8" class="kz la jd mc b gy mp mh l mi mj">},</span><span id="a0dd" class="kz la jd mc b gy mp mh l mi mj">])</span><span id="91ac" class="kz la jd mc b gy mp mh l mi mj">/**</span><span id="75e0" class="kz la jd mc b gy mp mh l mi mj">* Add seed commands here.</span><span id="579e" class="kz la jd mc b gy mp mh l mi mj">*</span><span id="b113" class="kz la jd mc b gy mp mh l mi mj">* Example:</span><span id="a34b" class="kz la jd mc b gy mp mh l mi mj">* await queryInterface.bulkInsert('People', [{</span><span id="67a3" class="kz la jd mc b gy mp mh l mi mj">*   name: 'John Doe',</span><span id="d4bf" class="kz la jd mc b gy mp mh l mi mj">*   isBetaMember: false</span><span id="46ff" class="kz la jd mc b gy mp mh l mi mj">* }], {});</span><span id="877f" class="kz la jd mc b gy mp mh l mi mj">*/</span><span id="046f" class="kz la jd mc b gy mp mh l mi mj">},</span><span id="3cf5" class="kz la jd mc b gy mp mh l mi mj">down: async (<em class="ky">queryInterface</em>, <em class="ky">Sequelize</em>) =&gt; {</span><span id="d00f" class="kz la jd mc b gy mp mh l mi mj">return <em class="ky">queryInterface</em>.bulkDelete('Projects', null, {})</span><span id="0b71" class="kz la jd mc b gy mp mh l mi mj">/**</span><span id="63b2" class="kz la jd mc b gy mp mh l mi mj">* Add commands to revert seed here.</span><span id="ee06" class="kz la jd mc b gy mp mh l mi mj">*</span><span id="4a5d" class="kz la jd mc b gy mp mh l mi mj">* Example:</span><span id="5198" class="kz la jd mc b gy mp mh l mi mj">* await queryInterface.bulkDelete('People', null, {});</span><span id="f65f" class="kz la jd mc b gy mp mh l mi mj">*/</span><span id="4e36" class="kz la jd mc b gy mp mh l mi mj">}</span><span id="267e" class="kz la jd mc b gy mp mh l mi mj">};</span></pre><p id="7375" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们的关系已经设置好了，我们的模型也有了种子，我们可以运行种子文件来填充我们的db。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="c44d" class="kz la jd mc b gy mg mh l mi mj">npx sequelize-cli db:seed:all</span></pre><p id="e394" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以通过一个<code class="fe mk ml mm mc b">psql</code>查询来检查我们的数据是否快速命中数据库。</p><p id="d3a5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用<code class="fe mk ml mm mc b">psql &lt;YOUR_PROJECT_NAME&gt;_development</code>访问thje psql命令行</p><p id="be6b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后运行以下SQL查询</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="4c56" class="kz la jd mc b gy mg mh l mi mj">SELECT * FROM "Users" JOIN "Projects" ON "Users".id = "Projects"."userId";</span></pre><p id="bda2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该可以从数据库中获得一些数据。斯威特。</p><h2 id="0e25" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">设置Express</h2><p id="61ad" class="pw-post-body-paragraph ka kb jd kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">现在，我们的Sequelize部分已经启动并运行，让我们创建并表达API，以便在我们从前端进行调用时提供我们的数据。</p><p id="aa8b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将再添加两个包(因为我们之前添加了express)</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="6013" class="kz la jd mc b gy mg mh l mi mj">npm i nodemon -D<br/>npm i body-parser</span></pre><p id="59a3" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae ja" href="https://www.npmjs.com/package/nodemon" rel="noopener ugc nofollow" target="_blank"> Nodemon </a>将监听我们的express应用程序中的变化，并在发生变化时重新启动服务器，这样我们就不必担心是否是手动进行的。</p><p id="438d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae ja" href="https://www.npmjs.com/package/body-parser" rel="noopener ugc nofollow" target="_blank"> Body-parser </a>将处理来自用户请求的信息。</p><p id="d81f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们通过添加一个<code class="fe mk ml mm mc b">routes</code>目录和<code class="fe mk ml mm mc b">controllers</code>目录来为我们的逻辑的成功做准备。</p><p id="caf5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的根文件夹中添加一个<code class="fe mk ml mm mc b">server.js</code>文件，这也是我们的express应用程序将要存放的地方。</p><p id="0172" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了简洁起见，我将通过用户路线和控制器来运行我们，但是对项目做同样的事情是非常相似的。</p><p id="f7d8" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先对<code class="fe mk ml mm mc b">package.json</code>文件做一个小小的修改。我们将配置nodemon作为调用<code class="fe mk ml mm mc b">npm start</code>时运行的默认脚本</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="7c33" class="kz la jd mc b gy mg mh l mi mj">....<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",<br/>    "start": "nodemon server.js"<br/>  },<br/>....</span></pre><p id="1c0c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们为我们的Express应用程序制作一个框架。在我们的server.js文件中，我们需要以下内容:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="eaf7" class="kz la jd mc b gy mg mh l mi mj">const express = require('express');<br/>const routes = require('./routes');<br/>const bodyParser = require('body-parser');<br/>const usersRouter = require('./routes/users.routes')</span><span id="b039" class="kz la jd mc b gy mp mh l mi mj">const PORT = process.env.PORT || 5000;</span><span id="f6e8" class="kz la jd mc b gy mp mh l mi mj">const app = express();<br/>app.use(bodyParser.json())<br/>app.use('/api/users', usersRouter);</span><span id="e6ce" class="kz la jd mc b gy mp mh l mi mj">app.listen(PORT, () =&gt; console.log(`Listening on port: ${PORT}`))</span></pre><p id="0ecc" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我们的基本Express服务器，它将监听端口5000。我们将在<code class="fe mk ml mm mc b">users.routes.js </code>文件的<code class="fe mk ml mm mc b">/routes </code>目录中定义它们，而不是在这个文件中定义所有的路径。让我们现在制作文件，并添加我们的第一条路线。</p><p id="3a96" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe mk ml mm mc b">/routes </code>目录中创建一个名为<code class="fe mk ml mm mc b">users.routes.js </code>的文件，并添加以下内容，然后从<a class="ae ja" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>进行测试，以确保我们的节点应用程序能够工作。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="8e89" class="kz la jd mc b gy mg mh l mi mj">const { Router } = require('express');<br/>const controllers = require('../controllers');<br/>const router = Router();</span><span id="b244" class="kz la jd mc b gy mp mh l mi mj">router.get('/', (req, res) =&gt; res.send('This is root!'))</span><span id="e47c" class="kz la jd mc b gy mp mh l mi mj">module.exports = router</span></pre><p id="4fc4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过使用<code class="fe mk ml mm mc b">npm start</code>启动快速服务器来测试路线</p><p id="4d55" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">太好了。我们正在大步前进。花点时间喝杯水、咖啡等。你应得的。</p><p id="e253" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">回来了？让我们从数据库中传递一些数据。为此，我们需要一个用户控制器。在您的<code class="fe mk ml mm mc b">/controllers </code>目录中创建一个<code class="fe mk ml mm mc b">users.controller.js</code>文件。</p><p id="6eef" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将创建一个<code class="fe mk ml mm mc b">getAllUsers</code>函数，从数据库及其相关项目中获取所有用户。</p><figure class="lx ly lz ma gt ip"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="637c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个文件中，我们已经合并了来自我们的<code class="fe mk ml mm mc b">/model</code>目录的用户和项目模型，并创建了一个<code class="fe mk ml mm mc b">async</code>函数来获取数据并从数据库返回它。如果成功，我们返回带有200状态码的响应和JSON格式的数据。我们导出函数，这样我们就可以在我们的<code class="fe mk ml mm mc b">users.routes.js</code>文件中访问它。让我们在那里添加它，并测试它。</p><p id="f37e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的<code class="fe mk ml mm mc b">users.routes.js</code>文件中，让我们设置一个路径来处理这个函数，并导入我们的<code class="fe mk ml mm mc b">users.controller.js</code>文件来访问它。将以下内容添加到我们的路线中。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="cb3e" class="kz la jd mc b gy mg mh l mi mj">const usersController = require('../controllers/users.controller')<br/>//replace our cuurent route with the following<br/>router.get('/', usersController.getAllUsers)</span></pre><p id="078a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请记住，我们将server.js文件设置为在调用<code class="fe mk ml mm mc b">/api/users</code>时使用这个路由器，因此在测试时，我们需要运行一个get请求到<code class="fe mk ml mm mc b"><a class="ae ja" href="http://localhost:5000/api/users/" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/api/users/</a></code></p><p id="511f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果进展顺利，我们应该能够在服务器运行时在浏览器中测试这一点。我们得到的结果应该是这样的(我的用户和项目比我在本教程中得到的要多一些)。</p><figure class="lx ly lz ma gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mq"><img src="../Images/f6161e3a301de6cf84374aeebb898b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJbrDu4H4v_girEaoc2oOw.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">our data from the db</figcaption></figure><p id="d3d0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以看到每个用户都有一个Projects键，其中包含所有项目及其userId。</p><h2 id="cfa4" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">接下来呢？</h2><p id="aa5c" class="pw-post-body-paragraph ka kb jd kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">在这里，您可以添加所有必要的路由和控制器动作，以便为您的项目和用户在API上执行所有CRUD动作</p><h2 id="53ae" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">最终想法:</h2><p id="ea66" class="pw-post-body-paragraph ka kb jd kc b kd ls kf kg kh lt kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ig bi translated">自从完成bootcamp后，我一直专注于JavaScript，现在我可以说，与使用Ruby on Rails相比，使用Express和Sequelize，我可以更快地在项目中安装和运行后端API。我将继续这个项目，并将图像添加到数据库中，并将在博客中介绍如何进行设置。(希望比Rails活动存储更容易)</p><h1 id="3ae9" class="mr la jd bd lb ms mt mu le mv mw mx lh my mz na lk nb nc nd ln ne nf ng lq nh bi translated">黑客快乐！</h1><h2 id="9ba8" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">资源:</h2><div class="im in gp gr io ni"><a href="https://expressjs.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd je gy z fp nn fr fs no fu fw jc bi translated">Express - Node.js web应用程序框架</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">Express是一个最小且灵活的Node.js web应用程序框架，它为web和…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">expressjs.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw iu ni"/></div></div></a></div><div class="im in gp gr io ni"><a href="https://sequelize.org/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd je gy z fp nn fr fs no fu fw jc bi translated">序列</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">Sequelize是一个基于promise的Node.js ORM，用于Postgres、MySQL、MariaDB、SQLite和Microsoft SQL Server。它的特点是…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">sequelize.org</p></div></div></div></a></div><div class="im in gp gr io ni"><a href="https://www.postgresql.org/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd je gy z fp nn fr fs no fu fw jc bi translated">一种数据库系统</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">2020-09-24 - PostgreSQL 13发布！PostgreSQL全球开发小组今天宣布发布PostgreSQL…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.postgresql.org</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw iu ni"/></div></div></a></div><h2 id="1cb3" class="kz la jd bd lb lc ld dn le lf lg dp lh kl li lj lk kp ll lm ln kt lo lp lq lr bi translated">与我联系</h2><div class="im in gp gr io ni"><a href="https://www.linkedin.com/in/robert-keller-dev/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd je gy z fp nn fr fs no fu fw jc bi translated">罗伯特·凯勒-志愿者-软件工程师-战斗流行病| LinkedIn</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">我喜欢做东西，通常用代码，有时用木头，总是有很高水平的细节。我曾经解决过…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.linkedin.com</p></div></div></div></a></div><div class="im in gp gr io ni"><a href="https://github.com/MisterRK" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd je gy z fp nn fr fs no fu fw jc bi translated">MisterRK -概述</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">大家好，我是罗伯特，一名软件工程师，之前管理米其林星级餐厅。我过渡到了…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ny l nt nu nv nr nw iu ni"/></div></div></a></div></div></div>    
</body>
</html>