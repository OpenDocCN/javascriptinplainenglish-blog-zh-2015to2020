<html>
<head>
<title>How to Integrate Card Payment with Stripe into Your Web App without Back-end</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在没有后端的情况下将带Stripe的卡支付集成到您的Web应用程序中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-integrate-card-payment-with-stripe-into-your-web-app-6bf17e0108ef?source=collection_archive---------3-----------------------#2020-07-29">https://javascript.plainenglish.io/how-to-integrate-card-payment-with-stripe-into-your-web-app-6bf17e0108ef?source=collection_archive---------3-----------------------#2020-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b4e2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用React &amp; Azure函数的分步指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0aeb7f831001bd007259dca293ece96b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MbrXBHvaWLtgKVgK"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@servuspaul?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Paul Felberbauer</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c78d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为我和我的朋友<a class="ls lt ep" href="https://medium.com/u/974f70f18518?source=post_page-----6bf17e0108ef--------------------------------" rel="noopener" target="_blank">德扬</a>的第一个#100DaysOfCode挑战，我们决定在100天内创造三个产品，每个产品的运行成本不到10美元/月。我们创造的第一个产品是<a class="ae kv" href="https://www.yield-curves.com/" rel="noopener ugc nofollow" target="_blank"> EIOPA rates API </a>。如果你有兴趣看我们的进度和每个产品的代码，欢迎在Twitter上关注我们(<a class="ae kv" href="https://twitter.com/fu_yingying" rel="noopener ugc nofollow" target="_blank">颖</a>、<a class="ae kv" href="https://twitter.com/simicdds" rel="noopener ugc nofollow" target="_blank">德扬</a>)。</p><p id="95d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建可销售产品的一个重要部分是将信用卡支付整合到你的网站中。</p><p id="021e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示如何将Stripe集成到您的React应用程序中。</p><p id="28ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">涵盖的主题概述:</p><ul class=""><li id="bb50" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">如何在线处理支付</li><li id="8c38" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">我们为什么选择条纹</li><li id="b5cf" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">如何集成Stripe API</li><li id="d90d" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">如何测试Stripe API</li></ul><p id="ceba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它代表了我们的经验和我们的选择推理，它绝不是唯一的好办法。在这篇博文中，我想与你分享如何复制我们所经历的平稳整合。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="2722" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">如何在线处理支付</h1><p id="1748" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">作为一个web开发新手，我有很多问题要从这里开始。首先也是最重要的，你的网站是如何付款的？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/d2d7e8ca73971189c7a86b510369d8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GhMGZnJG56o6iTNV"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Campaign Creators</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="80e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实证明，这个问题的答案也是理解如何将支付整合到网站中的关键。(这仅包括API模式，还有其他集成支付的模式[1])</p><p id="398b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">首先</strong>，一个客户来到你的网站，选择了一个产品。通过点击产品的链接，浏览器可以存储<code class="fe nn no np nq b">service</code>信息。</p><p id="73d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">然后</strong>，该信息通过<code class="fe nn no np nq b">Checkout Form</code>发送到服务器，服务器用存储在其上的密钥处理该信息。</p><p id="dea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">最后</strong>，付款被进一步转发给<a class="ae kv" href="https://en.wikipedia.org/wiki/Payment_service_provider" rel="noopener ugc nofollow" target="_blank"> PSP </a>。PSP是一个支付服务提供商，负责处理与银行的支付和清算。</p><p id="3e53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述过程表明:</p><ol class=""><li id="d2d8" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr nr ma mb mc bi translated">你需要一个在线产品</li><li id="e5b1" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr nr ma mb mc bi translated">您需要建立一个结帐表单(通过购买链接触发)</li><li id="c881" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr nr ma mb mc bi translated">您需要一台服务器(或者使用功能即服务来实现无服务器化)</li></ol><p id="72d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本教程的重点是第二和第三点。我会写一个单独的教程，如何使支付形式美丽，一旦我们完成了建立基础。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="4efa" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">为什么我们选择条纹</h1><p id="24f8" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">在进入实现模式之前，我想和大家分享一下我们选择Stripe的原因。有四个主要考虑因素:</p><ol class=""><li id="8347" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr nr ma mb mc bi translated"><strong class="ky ir">适宜性</strong>:我们的网站是销售金融产品的，我们不是网店，所以没有选择<em class="ns"> Shopify </em>或<em class="ns">亚马逊支付</em>等网购平台。另一方面，<em class="ns">条纹</em>一般适合商家。</li><li id="5fd1" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr nr ma mb mc bi translated"><strong class="ky ir">成本</strong>:由于我们的目标是拥有&lt;10美元/月的固定运营成本，因此剔除了每月固定费用+每件产品可变成本的产品(<em class="ns"> PayPal </em>、<em class="ns">Authorize.net</em>)。<em class="ns"> Stripe </em>要求每笔交易收取2.9% + 30cc可变费用。</li><li id="5281" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr nr ma mb mc bi translated">易于集成 : <em class="ns"> Stripe </em>有一个非常好的关于如何集成支付API的<a class="ae kv" href="https://stripe.com/docs/payments/integration-builder" rel="noopener ugc nofollow" target="_blank">文档</a>。</li><li id="a49d" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr nr ma mb mc bi translated"><strong class="ky ir">仪表板</strong> : <em class="ns">条纹</em>的仪表板提供了轻松监控交易和分析业务的可能性。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/1358c9f78d7ed35b0c987cf3e4ddb8e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kWfnpsKku9M8GvwwStefxQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Stripe dashboard for business</figcaption></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="142d" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">如何集成Stripe API</h1><p id="6fc9" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">所以我们选择条纹的。下一个问题是如何将它嵌入到我们的web应用程序中？下面的GIF展示了我们第一次整合到我们的网站时的样子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/8f2babd4512c51b0ee6327e99146a6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2WSliM_jvABo4CVigi38JQ.gif"/></div></div></figure><p id="b8c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在其<a class="ae kv" href="https://stripe.com/docs/payments/integration-builder" rel="noopener ugc nofollow" target="_blank">网站</a>中找到Stripe API的文档，我将使用Stripe所展示的相同示例，以避免额外的信息让你生吞活剥。你也可以在我们的GitHub <a class="ae kv" href="https://github.com/simicd/yield-curves/tree/feature/integrate-stripe" rel="noopener ugc nofollow" target="_blank"> repo </a>中找到所有代码。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h2 id="3539" class="nv mq iq bd mr nw nx dn mv ny nz dp mz lf oa ob nb lj oc od nd ln oe of nf og bi translated">第1部分:创建React应用程序</h2><p id="5c2d" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">前端包括三个文件:</p><ul class=""><li id="39fc" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated"><strong class="ky ir"> Checkout.jsx </strong>:这是结账页面的内容</li><li id="1a06" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">App.jsx :这是你调用结帐页面的地方</li><li id="122b" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">Checkout.css :这是默认包含的样式表</li></ul><p id="0fb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要运行它们，您需要设置React应用程序并安装文档中提到的必要的条带库。</p><h2 id="e846" class="nv mq iq bd mr nw nx dn mv ny nz dp mz lf oa ob nb lj oc od nd ln oe of nf og bi translated"><strong class="ak"> 1。创建结帐表单</strong></h2><p id="7c43" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">文档包括所有开始使用的代码，下面的例子是<code class="fe nn no np nq b">CheckoutForm</code>与后端服务器交互以请求<code class="fe nn no np nq b">clientSecret</code>的部分。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Checkout Form</figcaption></figure><ul class=""><li id="1b38" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated"><em class="ns">第19–24行:</em>转到服务器并发出POST请求。这个请求的主体是一个json格式，包含一个服务元素和一个字典列表:第一对包含键<code class="fe nn no np nq b">id</code>和值<code class="fe nn no np nq b">xl-tshirt</code>。</li><li id="cdf7" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated"><em class="ns">第30行</em>:接收客户秘密值，该值是继续处理付款所需的密钥</li></ul><p id="592f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦该步骤成功，其余的<code class="fe nn no np nq b">CheckoutForm</code>模块使用条带包来处理不同的场景，如<code class="fe nn no np nq b">submit</code>、<code class="fe nn no np nq b">Change of details</code>等。</p><p id="ce51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2 .使用App.jsx中的结账表单</strong></p><p id="716c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用文档中完全相同的代码，您应该能够让React应用程序为<code class="fe nn no np nq b">CheckoutForm</code>运行。现在我们去<code class="fe nn no np nq b">npm start</code>吧，你应该在你的浏览器里看到下面简单的结账表单。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/67ed3d2e94f3d8fe87d1b4e7f77294ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggVnWhQdB-l1K6WhdT5a9g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Checkout Form</figcaption></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h2 id="b42e" class="nv mq iq bd mr nw nx dn mv ny nz dp mz lf oa ob nb lj oc od nd ln oe of nf og bi translated">第2部分:为后端实现创建Azure函数</h2><p id="b5aa" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated"><strong class="ky ir"> 1 .没有后端会发生什么</strong></p><p id="73fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过上面的结账表单，您可以输入测试卡信息(条纹测试卡号:<code class="fe nn no np nq b">4242 4242 4242 4242</code>任意未来失效日期、任意CVC代码、任意邮政编码)，但这只会导致您出错。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/ebe7c358a5805e8fa84429b49058e3ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5F9sX5JDFVrTrHWS"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Error Checkout Form</figcaption></figure><p id="b8d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">浏览器没有收到继续处理交易所需的<code class="fe nn no np nq b">clientSecret</code>。为什么会这样？它从哪里得到<code class="fe nn no np nq b">clientSecret</code>的？</p><p id="332d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请记住，在上面的章节中，我们提到过反应应用需要向服务器提出请求，以获得<code class="fe nn no np nq b">clientSecret</code>作为响应。这个错误消息不可避免地出现，因为我们还没有REST API调用的后端。</p><p id="8cd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2 .后端服务器选择</strong></p><p id="edf1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对我们来说，让自己的服务器一直运行根本没有意义。拥有服务器的唯一目的是每当客户进入支付页面时触发开机自检请求以生成客户秘密。</p><p id="7123" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们选择了Azure云服务来完成这项任务。Azure Functions <a class="ae kv" href="https://azure.microsoft.com/en-us/pricing/details/functions/" rel="noopener ugc nofollow" target="_blank">消费计划定价</a>包括每月100万次免费订阅请求和每月40万GB-s的资源消耗，这对我们来说是一个完美的计划，尤其是在我们的客户基础很小的时候。</p><p id="773e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3 .Azure功能背景</strong></p><p id="5980" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本质上,<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview" rel="noopener ugc nofollow" target="_blank"> Azure函数</a>的功能是允许你在Azure云基础设施上运行一段代码，并且它只在调用该函数时被使用。这意味着您不需要让自己的服务器一直运行，也不需要担心基础架构。</p><p id="cdbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们使用Azure函数来编写Rest API，以支持React App的请求。这仅在客户打算购买时使用。</p><p id="09b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 4。如何设置Azure功能</strong></p><p id="453c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为先决条件，您需要在Azure门户上设置一个帐户，创建一个资源组，并在Visual Studio代码中创建一个本地Azure函数。这在<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-function-vs-code?pivots=programming-language-python" rel="noopener ugc nofollow" target="_blank">微软Azure的文档</a>中有很好的记录，我在这里就不详述了。</p><p id="5ba7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 5。如何创建Python Azure函数作为Stripe后端</strong></p><p id="8e2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用Azure函数创建REST API非常简单。在几行代码中，您可以创建条纹支付所需的内容。我将一行一行地向您介绍代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="e338" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ns">第1–5行</em>:导入所有需要的库</p><p id="78c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ns">第9行</em> : Stripe API key是网站所有者(你)能够验证和处理交易的秘密密钥。您可以在开发人员API密钥下的条带控制面板中找到该密钥:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/33b84d2de648c0bf61ba467a07103e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0-X-A5rpQACjhx493ZpAw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Stripe API key</figcaption></figure><ul class=""><li id="fd11" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">对于本地测试，您可以将这个键包含在<code class="fe nn no np nq b">local.settings.json</code>文件中</li></ul><pre class="kg kh ki kj gt om nq on oo aw op bi"><span id="c8ad" class="nv mq iq nq b gy oq or l os ot">{<br/>  "Values": {<br/>    "STRIPE_API_KEY":  "your secret stripe API key"<br/>  }<br/>}</span></pre><ul class=""><li id="fce6" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">为了在服务器上运行，您可以通过<code class="fe nn no np nq b">+ New application setting</code>将这个键包含在Azure Functions的配置部分中</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/348c20addacdf4070162d74004d774d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R2-mQBzRUNZwWmgt"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Add Strip API key in Azure Functions Configuration</figcaption></figure><ul class=""><li id="c974" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">在你的代码中引用API键的方法很简单<code class="fe nn no np nq b">os.environ[STRIPE_API_KEY]</code></li></ul><p id="53d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ns">第11–21行</em>:这是一个根据购买的商品在服务器上计算价格的功能。在服务器上计算价格的原因是为了避免客户端的操纵。</p><p id="3b00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ns">第24–40行</em>:这里是构建REST API的地方。它本质上是说:从浏览器接收到的<code class="fe nn no np nq b">service</code>信息中选取<code class="fe nn no np nq b">id</code>，得到这个物品的价格并实例化一个<code class="fe nn no np nq b">PaymentIntent</code>。<code class="fe nn no np nq b">PaymentIntent</code>是stripe库中用于收集支付信息的对象。发送回浏览器的响应是<code class="fe nn no np nq b">clientSecret</code>。</p><p id="7efd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了测试REST API是否工作，让我们去<code class="fe nn no np nq b">cd azure-function</code>保存azure函数的地方。<code class="fe nn no np nq b">func start</code>查看信息。如果是第一次初始化Azure函数，需要在<code class="fe nn no np nq b">func start</code>之前<code class="fe nn no np nq b">func init</code>。一旦该函数运行完毕，您将在控制台中看到正在运行的本地主机端口。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/0d21bb40199804a5d54a798d6a3378f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*goa8RuZcP-HYOBvzt-gmjw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Azure Functions Localhost</figcaption></figure><ul class=""><li id="926d" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated"><code class="fe nn no np nq b">localhost:7071/api/stripe-payment</code>是我们感兴趣的，我们也可以使用<a class="ae kv" href="https://www.postman.com/about-postman/" rel="noopener ugc nofollow" target="_blank"> Postman </a>与我们的REST API进行交互。</li><li id="b34c" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">Postman是测试你的API的一个很好的平台。您可以将本地主机位置插入到路径中，并选择要发出的请求类型(POST、GET等。).在这种情况下，REST API期望通过body从浏览器获得一些信息。因此，我们可以像在React应用程序中那样插入主体<code class="fe nn no np nq b">{"service": {"id": "xl-tshirts"}}</code>。如果一切正常，我们应该会得到如下所示的状态代码为200的<code class="fe nn no np nq b">clientSecret</code>(状态OK)。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/13243f6b03b190b5bc3a6c0d609a5d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ilpn6GUlLMvmmNUWLUikAA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Postman response</figcaption></figure><p id="7e2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 6。更新React应用程序中发出请求的路径</strong></p><p id="c742" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们还没有在真正的域上运行，React App和Azure函数在不同的本地主机端口上运行。这意味着要进行测试，我们需要指定REST API在React应用程序中的运行位置。在我们的例子中，我们把它改成了<code class="fe nn no np nq b">http://127.0.0.1:7071/api/strip-payment</code>。</p><pre class="kg kh ki kj gt om nq on oo aw op bi"><span id="38af" class="nv mq iq nq b gy oq or l os ot">useEffect(() =&gt; {<br/>window<br/>.fetch("http://127.0.0.1:7071/api/stripe-payment", {<br/> method: "POST",                               <br/> headers: {                                 <br/>    "Content-Type": "application/json"                               },                 <br/> body: JSON.stringify({service: [{ id: "xl-tshirt" }]})                             })</span></pre><p id="31f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 7。配置CORS设置</strong></p><blockquote class="ox oy oz"><p id="ba1d" class="kw kx ns ky b kz la jr lb lc ld ju le pa lg lh li pb lk ll lm pc lo lp lq lr ij bi translated">跨源资源共享(CORS)是一种机制，它使用额外的HTTP头来告诉浏览器向在一个源上运行的web应用程序提供对来自不同源的选定资源的访问。出于安全原因，浏览器限制从脚本发起的跨来源HTTP请求。[1]</p></blockquote><p id="c63f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们在不同的端口运行React App和Azure函数时，它会向我们抛出一个CORS错误。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/87dd8ac504fdf4670d061db76180ba98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CbxvGfRpEzVP2S_lTqle_w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Cross-region request blocked</figcaption></figure><p id="4651" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们将前端和后端设置为在同一个域上运行时，这种情况不会发生。但是对于本地测试，需要在<code class="fe nn no np nq b">local.settings.json</code>文件中进行额外的设置。</p><pre class="kg kh ki kj gt om nq on oo aw op bi"><span id="5f90" class="nv mq iq nq b gy oq or l os ot">{<br/>  "Host":{<br/>    "LocalHttpPort": 7071,<br/>    "CORS": "*",<br/>    "CORSCredentials": false<br/>  }<br/>}</span></pre><p id="a217" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦设置完成，我们可以再次运行它，现在我们得到一个状态ok响应！</p><ul class=""><li id="61fe" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">注意:您需要重新启动Azure功能才能应用本地设置中的更改</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/720d674b39a27e7056d500e82f3af231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNNpNdoC6wrDup_gUzOiRQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Successfully received response from server</figcaption></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h2 id="24d7" class="nv mq iq bd mr nw nx dn mv ny nz dp mz lf oa ob nb lj oc od nd ln oe of nf og bi translated">第3部分:运行React应用程序测试</h2><p id="8b0a" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">现在我们已经为测试做好了准备！让我们再试一次<code class="fe nn no np nq b">npm start</code>，并再次输入测试号码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/dbcbd8920b97d5f9f9b5bf86f126444c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-TL-Xehr7wqxTvKL59gAQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Test Stripe payment</figcaption></figure><p id="70a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一次，当我们点击<code class="fe nn no np nq b">Pay</code>时，我们进入了下一页:成功！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/78e9f5af1a78365b89410f3794690535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oaoIxO1rTW9a29XuyeF0fQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Payment successful</figcaption></figure><p id="4504" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们前往仪表板时，我们将看到测试付款已经通过！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/8a6829978d0bff50003f1d2a73cb37fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivkiXmjABv-6IoQYCkLczQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Stripe payment success on dashboard</figcaption></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="35aa" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">结束语</h1><p id="4d1b" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">希望一步一步的指南可以帮助你为你的网站设置条纹支付。我们发现最具挑战性的是React应用程序和后端服务器之间的连接。幸运的是，Azure Functions为我们提供了非常好的解决方案来实现这一点。</p><p id="f052" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您有本教程中未涉及的问题或遇到的情况，请告诉我们，我们将尝试更新本教程，以包含您的问题。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="3a74" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">未来主题</h1><p id="25d6" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">对于我这样一个web开发新手来说，学习曲线很陡，很难理解所有东西是如何工作和组合在一起的，但是我相信，在正确的指导下，每个人都可以做到。</p><p id="2360" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来我们将继续这个话题，用tailwindcss让支付表单看起来很漂亮，敬请期待。</p><p id="93ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下主题都是我们应用程序的重要组成部分，我相信您在开发过程中也会经历类似的步骤:</p><ul class=""><li id="dede" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">创建收益曲线产品</li><li id="e208" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">用React和tailwindcss创建一个漂亮的网站</li><li id="48cb" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">设置Azure功能</li><li id="817e" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">将谷歌分析整合到网络应用中</li></ul><p id="b9be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在进行过程中写下每个主题，非常欢迎您在Twitter <a class="ae kv" href="https://twitter.com/fu_yingying" rel="noopener ugc nofollow" target="_blank"> (Ying </a>，<a class="ae kv" href="https://twitter.com/simicdds" rel="noopener ugc nofollow" target="_blank"> Dejan </a>)上加入我们，检查我们的进度和代码。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="0d70" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">参考</h1><p id="a440" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">[1]Eiji Kitamura(2017年11月22日)，<em class="ns">将支付请求API与支付服务提供商集成</em>，<a class="ae kv" href="https://medium.com/dev-channel/integrating-the-payment-request-api-with-a-payment-service-provider-b6a23aa44bd6" rel="noopener">https://medium . com/dev-channel/Integrating-the-Payment-Request-API-with-a-Payment-service-provider-B6 a23 aa 44 BD 6</a></p><p id="1ae7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2] MDN Wed docs，<em class="ns">跨区域资源共享</em>，<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a></p></div></div>    
</body>
</html>