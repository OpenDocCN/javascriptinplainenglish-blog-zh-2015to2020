<html>
<head>
<title>Make your own YouTube Downloader</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作自己的YouTube下载器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/make-your-own-youtube-downloader-626133572429?source=collection_archive---------0-----------------------#2020-04-08">https://javascript.plainenglish.io/make-your-own-youtube-downloader-626133572429?source=collection_archive---------0-----------------------#2020-04-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="be69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">隔离期间无聊？想在loop上看自己喜欢的YouTube视频或播放自己喜欢的歌曲，但又不想把所有的数据都花在上面？下面是如何编写代码来下载它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f0f4d406afd5051660c895891104d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9L6E3Bq_KBS6vTkr5rYRGQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Random Image (pls don’t sue me)</figcaption></figure><h1 id="dfad" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">放弃</h1><p id="18f5" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">从YouTube上下载视频违反了他们的政策。这篇文章的目的只是演示如何从互联网上下载内容，并让您深入了解YouTube API的工作原理。</p><h1 id="1d75" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">描述</h1><p id="d17a" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">YouTube上的每个视频都有一个唯一的ID。YouTube视频的链接通常如下所示:</p><blockquote class="mb mc md"><p id="8b37" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated"><a class="ae mi" href="https://www.youtube.com/watch?v=fJ9rUzIMcZQ" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=fJ9rUzIMcZQ</a></p></blockquote><p id="dcd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该链接中的一系列字符<code class="fe mj mk ml mm b">fJ9rUzIMcZQ</code> <em class="me"> </em>代表该视频的唯一ID，由GET查询参数<code class="fe mj mk ml mm b">v</code>给出。</p><h2 id="6aff" class="mn kz in bd la mo mp dn le mq mr dp li jv ms mt lm jz mu mv lq kd mw mx lu my bi translated">1)获取关于视频的信息</h2><p id="36b3" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">YouTube API中可能非常有用的一条路线是<code class="fe mj mk ml mm b">/get_video_info?video_id=${videoId}&amp;eurl={eurl}</code>。这个路由发送回关于视频的数据，包括视频Id、标题、长度(秒)、不同质量视频的链接等。<code class="fe mj mk ml mm b">eurl</code>是一个重要的查询参数，没有该参数，视频可能会返回可播放性状态“不可播放”。一个<code class="fe mj mk ml mm b">eurl</code>的格式是:</p><blockquote class="mb mc md"><p id="961b" class="jk jl me jm b jn jo jp jq jr js jt ju mf jw jx jy mg ka kb kc mh ke kf kg kh ig bi translated"><a class="ae mi" href="https://youtube.googleapis.com/v/${videoId}" rel="noopener ugc nofollow" target="_blank">https://youtube.googleapis.com/v</a>/<code class="fe mj mk ml mm b">${videoId}</code></p></blockquote><p id="0212" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从<code class="fe mj mk ml mm b">/get_video_info</code>路由返回的数据可以使用下面的代码片段进行解析。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="adc3" class="mn kz in bd la mo mp dn le mq mr dp li jv ms mt lm jz mu mv lq kd mw mx lu my bi translated">2)解析信息</h2><p id="f7da" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">获取的<code class="fe mj mk ml mm b">parsedResponse</code>中的<code class="fe mj mk ml mm b">player_response</code>字段是我们主要需要的字段，特别是<code class="fe mj mk ml mm b">player_response.playabilityStatus</code>、<code class="fe mj mk ml mm b">player_response.videoDetails</code>和<code class="fe mj mk ml mm b">player_response.streamingData</code>。可以编写一个只返回所需数据的函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8aea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个<code class="fe mj mk ml mm b">videoInfo</code>对象拥有显示视频细节或下载视频所需的所有信息。现在，你可以从<code class="fe mj mk ml mm b">videoInfo.videoDetails</code>获得关于视频的信息，比如标题(<code class="fe mj mk ml mm b">videoInfo.videoDetails.title</code>)、描述(<code class="fe mj mk ml mm b">videoInfo.videoDetails.description</code>)等。</p><p id="3a5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要获取这些视频的流链接，您需要从<code class="fe mj mk ml mm b">videoInfo</code>对象中获取以下两个键:</p><ul class=""><li id="118d" class="nb nc in jm b jn jo jr js jv nd jz ne kd nf kh ng nh ni nj bi translated"><code class="fe mj mk ml mm b">videoInfo.streamingData.formats</code></li><li id="a8ef" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated"><code class="fe mj mk ml mm b">videoInfo.streamingData.adaptiveFormats</code></li></ul><h2 id="a84f" class="mn kz in bd la mo mp dn le mq mr dp li jv ms mt lm jz mu mv lq kd mw mx lu my bi translated">3)从流媒体链接下载内容</h2><p id="9c3b" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">包含在<code class="fe mj mk ml mm b">formats</code>数组中的链接用于流式传输包含音频和视频的视频。然而，这里只有几个选项，例如，你可能必须在720便士和360便士之间做出选择。你现在可以使用简单的下载器功能从你选择的链接(来自<code class="fe mj mk ml mm b">videoInfo.streamingData.formats[index].url</code>)下载内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">axios — Download content from url</figcaption></figure><p id="1927" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe mj mk ml mm b">adaptiveFormats</code>中，你可以找到一些只播放视频(没有音频)的链接和一些只播放音频的链接。在这里，有更多的选项可供选择，从144p到1080p或更高，有各种编解码器和mime类型。</p><p id="731f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，如果您想要下载1080p视频，您可以下载1080p纯视频流和纯音频流，然后使用“ffmpeg”合并它们，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">ffmpeg — Merge audio and video files</figcaption></figure><h2 id="6cb4" class="mn kz in bd la mo mp dn le mq mr dp li jv ms mt lm jz mu mv lq kd mw mx lu my bi translated">4)对某些视频不起作用？</h2><p id="a902" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">现在，有个问题。您可能无法通过这种方式下载某些视频。具有名为<code class="fe mj mk ml mm b">videoInfo.streamingData.formats[index].url</code>的字段的视频可以通过这种方式下载，因为在这些链接中，存在一个GET参数<code class="fe mj mk ml mm b">sig</code>。然而，在一些视频的<code class="fe mj mk ml mm b">videoInfo</code>中，不是formats和adaptiveFormats数组元素中的这个<code class="fe mj mk ml mm b">url</code>键，而是一个名为<code class="fe mj mk ml mm b">cipher</code>的键。这个密码包含三样东西:</p><ul class=""><li id="3720" class="nb nc in jm b jn jo jr js jv nd jz ne kd nf kh ng nh ni nj bi translated">sp:签名参数</li><li id="681d" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated">签名数据</li><li id="560d" class="nb nc in jm b jn nk jr nl jv nm jz nn kd no kh ng nh ni nj bi translated">url:流媒体链接</li></ul><p id="b78a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该参数<code class="fe mj mk ml mm b">s</code>必须通过一系列函数(反转、交换和拆分)才能附加到URL。这些函数可以从<a class="ae mi" href="https://www.youtube.com/watch?v=fJ9rUzIMcZQ" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=</a>T10上的源代码中的JS文件中获得。使用在<code class="fe mj mk ml mm b">sp</code>的值中指定的查询参数，可以将获得的结果值附加到<code class="fe mj mk ml mm b">url</code>。所以，如果<code class="fe mj mk ml mm b">sp = sig</code>，查询参数将以<code class="fe mj mk ml mm b">https://…/…&amp;sig=sig</code>的方式附加。此链接将最终获取您所请求的视频/音频流。</p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="0324" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">代码片段来自:</p><div class="nw nx gp gr ny nz"><a href="https://github.com/roerohan/ytdl" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd io gy z fp oe fr fs of fu fw im bi translated">roerohan/ytdl</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">用javascript/typescript编写的CLI，允许您将视频从YouTube下载到您的系统上。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div><h2 id="e7c9" class="mn kz in bd la mo mp dn le mq mr dp li jv ms mt lm jz mu mv lq kd mw mx lu my bi translated"><strong class="ak">用简单英语写的便条</strong></h2><p id="0185" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">你知道我们有四份出版物和一个YouTube频道吗？你可以在我们的主页<a class="ae mi" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> plainenglish.io </strong> </a>找到所有这些内容——关注我们的出版物并<a class="ae mi" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">订阅我们的YouTube频道</strong> </a> <strong class="jm io">来表达你的爱吧！</strong></p></div></div>    
</body>
</html>