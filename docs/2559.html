<html>
<head>
<title>JavaScript Fun with Promise.race()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript Fun with Promise.race()</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-fun-with-promise-race-20b2f8ea4695?source=collection_archive---------6-----------------------#2020-07-05">https://javascript.plainenglish.io/javascript-fun-with-promise-race-20b2f8ea4695?source=collection_archive---------6-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f68c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">愿最快的承诺获胜</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cc958ac1f007cfdc942b2ef3b4fa0380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_BegdVVxmkS6Df-ZeIb8w.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: <a class="ae kv" href="https://unsplash.com/photos/1IW4HQuauSU" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b53b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">首先:</strong>对于这篇文章，你应该明白承诺的目的是什么，以及它们是如何运作的。</p><p id="67bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">众所周知，承诺需要时间来兑现。</p><p id="188a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理想情况下，在一定时间后，他们成功完成，然后他们被<strong class="ky ir">解决</strong>。在什么条件下它们应该被解析，我们可以使用<strong class="ky ir"> resolve() </strong>函数来告诉每个承诺在什么条件下它应该被解析。</p><h1 id="6cc6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">那么，什么是Promise.race()函数呢？</h1><p id="3124" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">顾名思义，其实就是赛跑。Promise.race()将我们在代码中定义的承诺数组作为参数，它本身就是一个承诺。</p><p id="800d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就Promise.race()完成而言，它会给我们最快的承诺(无论是解决的还是拒绝的)的输出(resolve函数的参数)。不多不少——只是最快承诺的输出。</p><p id="fb16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不局限于一定数量的承诺，可以在数组中传递给Promise.race()。</p><p id="94be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">整个过程在浏览器和Node.js中都有效。</p><h1 id="e30b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">一个例子</h1><p id="89c6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">下面的代码中定义了两个承诺。</p><p id="d356" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它们所做的只是在超时完成后进行解析。上限承诺<em class="mp">定时器1 </em>当然会被更快地解析，因为解析函数已经在2秒后被调用。如你所见，第二个承诺需要4秒钟。</p><p id="59c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为Promise.race()的参数，我们只需传递由两个函数组成的数组，每个函数都包含一个Promise。</p><p id="2ebc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为Promise.race()本身返回一个承诺，所以一旦承诺完成，我们就可以继续使用<em class="mp">和</em>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Promise.race() basic example</figcaption></figure><p id="2809" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">两秒钟后，结果将是</strong> : <em class="mp">，因为第一个承诺最快完成&amp;，我们只需将在resolve函数中传递的数据变量作为<strong class="ky ir">数据。</strong></em></p><h1 id="f0cc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">这如何实际应用？</h1><p id="4576" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我个人可以想到3种不同的场景。</p><h2 id="f654" class="ms lt iq bd lu mt mu dn ly mv mw dp mc lf mx my me lj mz na mg ln nb nc mi nd bi translated">1.标杆管理</h2><p id="951c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当然，每当我们处理承诺时，优化它们以提高性能是很有趣的。特别是对于网络或数据库请求，承诺通常是标准，这时我们可以使用Promise.race()来测试两种不同的方法，并找出哪种方法更快。</p><h2 id="5489" class="ms lt iq bd lu mt mu dn ly mv mw dp mc lf mx my me lj mz na mg ln nb nc mi nd bi translated">2.同时执行</h2><p id="73f1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">尽可能快地向用户提供数据总是符合我们的利益的。</p><p id="3a12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，可以想象同时向几个服务器发送请求，只要其中一个服务器完成了工作，我们就会感到满意。那么Promise.race()最适合同时执行承诺，并在第一个成功后立即完成。</p><h2 id="71f0" class="ms lt iq bd lu mt mu dn ly mv mw dp mc lf mx my me lj mz na mg ln nb nc mi nd bi translated">3.设定时间限制</h2><p id="d0ca" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">是的，还可以通过使用reject()函数来限制承诺的执行时间，例如超时。</p><p id="02ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，我们可以对网络请求的承诺和时间限制的承诺做同样的事情，这将在3秒后解决。如果定时器承诺在3秒钟后比网络请求更早完成，则网络请求被中止。</p><p id="da4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一个简单的例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure></div></div>    
</body>
</html>