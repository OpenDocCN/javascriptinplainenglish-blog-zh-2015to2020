<html>
<head>
<title>Let’s Understand “Closures” in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们来理解JavaScript中的“闭包”</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/closures-in-javascript-a2adada10cf1?source=collection_archive---------0-----------------------#2019-02-25">https://javascript.plainenglish.io/closures-in-javascript-a2adada10cf1?source=collection_archive---------0-----------------------#2019-02-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/234f783119ee57d2730e1d738381d257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3gUBQcPavosqZTJQ"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pankaj Patel</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2965" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你曾经参加过JavaScript面试，那么你很可能会被问到，什么是<strong class="kc io">闭包</strong>。</p><p id="1802" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据Mozilla:<em class="ky">闭包</em>是一个函数和声明该函数的词法环境的组合。</p><p id="dfd7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">* <em class="ky">在我们开始讨论闭包之前，让我们看看词法范围。</em></p><p id="0655" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">JavaScript遵循词法作用域，这意味着子块可以访问其父块甚至父块中声明的所有变量。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/4680064f103364d5db9ec2525f706ff8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vECV-iPlTSR-HopST0bP4A.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">understanding lexical scope</figcaption></figure><p id="28bd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的例子是为了让你熟悉词法范围是如何工作的。</p><p id="3e25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是首先，让我们看看函数的性质。我们之所以能够做到这一点，是因为在JS中，就连函数也被视为对象。我们可以使用<em class="ky"> console.dir </em>()方法来显示属性。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/f70f871836eccce1bf16331ee4016904.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jV4yBmQLt_V7EayUUjSBOA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Looking at the function properties</figcaption></figure><p id="236c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如我们所看到的，“<em class="ky"> printInside </em>”函数持有对“<em class="ky"> outerVariable </em>”的引用，该变量是在<em class="ky"> printInside的</em>函数范围之外声明的。</p><p id="2bed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是<em class="ky">闭包</em>的一般含义，函数保存对所有属性的引用，这些属性在其父作用域中声明，但稍后将由函数本身使用。</p></div><div class="ab cl le lf hr lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ig ih ii ij ik"><p id="3015" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看一个传统的<em class="ky">闭包</em>例子，其中一个函数返回另一个函数，而不是一个值或对象:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/bf46593301fe8ed604434ed7420e102d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*h-ZUMFfUSxfE_6uz2XnaSA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">A simple <strong class="bd ll"><em class="lm">Closure</em></strong></figcaption></figure><p id="a423" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看<em class="ky"> addNumber </em>函数的属性:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/7c7ae34cb4181e9fde11ff6f8375efdf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7GbViL2RebCRyh2AtXNZJg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">addNumber properties</figcaption></figure><p id="6a2a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以看到，<em class="ky"> addNumber </em>实际上指向了<em class="ky"> passSecond </em> <strong class="kc io"> </strong>函数。<em class="ky"> passSecond </em>函数保存了对参数“<em class="ky"> num1 </em>”的引用，即使它没有在其函数范围内声明。我们应该记住，函数将只保存那些在父类中定义的属性的引用，这些引用将被函数本身使用。</p><p id="775c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你已经基本了解了<em class="ky">闭包</em>是如何工作的，让我们看看<em class="ky">闭包</em>的另一个例子:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/abb86e913b8c27cc05f9ace0a4472390.png" data-original-src="https://miro.medium.com/v2/format:webp/1*KHUAHJ8jPoYz6NSW-BzY5g.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">sample code</figcaption></figure><p id="e2c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你认为输出是0，1，2，3，4，再想想我解释的闭包。闭包<em class="ky"> </em>不保存变量的值，而是保存对变量的引用。因此，如果我们要分析循环，在循环结束时"<strong class="kc io"> i" </strong>的值为5，它才能退出循环。所以<strong class="kc io"> i </strong>的最后一个引用会指向值5。这就是每次函数调用都会打印5的原因。</p><p id="bcf4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那么我们实际上如何更新函数以获得期望的输出呢，简单的方法是使用<strong class="kc io">let(ES6<strong class="kc io">中引入的</strong>)</strong>而不是<strong class="kc io"> var </strong>，因为<strong class="kc io"> let </strong>提供了一个块范围。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/b415005dc4ee9d256df1d992fcd9f825.png" data-original-src="https://miro.medium.com/v2/format:webp/1*N-_Owzfqe0jiYklWqWn3VQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">updated code</figcaption></figure><p id="1cb5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您仍然想使用<strong class="kc io"> var </strong>方法，我们可以通过将代码改为<strong class="kc io">life</strong>(立即调用函数表达式)来实现相同的输出。这将帮助我们创建一个块范围。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="ab gu cl ld"><img src="../Images/c9733be73447c29f0ce5ca573e7ebbf5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Y-0hQF-9Ra9AUUPbcwBxRQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">using <strong class="bd ll">IIFE</strong></figcaption></figure><p id="3f33" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">闭包</strong>是JavaScript的一个核心概念，理解它的工作原理可以帮助你写出更好的代码。我希望通过这些例子，你能够更好地理解c <em class="ky"> losures </em>的世界。</p><p id="c3ba" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="ky">plain English . io</em></a><em class="ky">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ky">免费周报</em> </a> <em class="ky">。在我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="ky">社区</em> </a> <em class="ky">获得独家的写作机会和建议。</em></p></div></div>    
</body>
</html>