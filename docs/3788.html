<html>
<head>
<title>Creating Moment decorators for class-validator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为类验证器创建时刻装饰器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-moment-decorators-for-class-validator-712b97de41ef?source=collection_archive---------5-----------------------#2020-10-25">https://javascript.plainenglish.io/creating-moment-decorators-for-class-validator-712b97de41ef?source=collection_archive---------5-----------------------#2020-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="95b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Moment.js是即将被淘汰的<a class="ae kl" href="https://momentjs.com/docs/#/-project-status/" rel="noopener ugc nofollow" target="_blank"/>，但是如果您的项目正在使用它，并且您缺少一两个验证器，您仍然可以扩展它。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/0682c86758ecc94b86828d425e2f8dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klImwRvP4-uTWEEcOuvHSg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Picture courtesy of <a class="ae kl" href="https://unsplash.com/@neonbrand" rel="noopener ugc nofollow" target="_blank">NeONBRAND</a></figcaption></figure><p id="39bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Class-validator 是一个非常流行的基于decorators的JS/TS验证库。它为<a class="ae kl" href="https://github.com/typestack/class-validator#validation-decorators" rel="noopener ugc nofollow" target="_blank">提供了许多内置的验证器</a>，但是也可以很容易地扩展<a class="ae kl" href="https://github.com/typestack/class-validator#custom-validation-decorators" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ece6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如介绍中所述，我知道Moment.js现在已经被弃用了(实际上已经弃用了相当长一段时间)，因为它存在长期的问题(膨胀、缺乏对树抖动的支持、可变性等)。我在本文中的目标不是讨论在您的项目中使用Moment.js是否是一个好主意；我想，到现在为止，答案已经很清楚了:不是。但事实是，我们并不总是有选择，如果有其他优先事项，我们不能现在就放弃它。</p><p id="ef0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将解释为类验证器创建定制Moment.js验证器/定制装饰器是多么容易。为了展示这一点，我将分享我在当前项目中需要的<code class="fe lc ld le lf b">IsDuration</code>和<code class="fe lc ld le lf b">MinDuration</code>验证器的代码。顾名思义，这些验证器分别确保要检查的值是有效的Moment duration对象，或者是等于或大于配置的最小值的持续时间。</p><h1 id="7658" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">通用验证功能</h1><p id="7482" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">首先，让我们定义一个简单的函数来检查给定值(字符串或null)是否是有效的<a class="ae kl" href="https://momentjs.com/docs/#/durations/" rel="noopener ugc nofollow" target="_blank">持续时间</a>对象:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="2c66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，这个函数非常简单。它接收假定为持续时间的值，并检查它是否真的是持续时间。关于这个逻辑的细节，请查看这个<a class="ae kl" href="https://stackoverflow.com/questions/38692972/how-to-validate-a-moment-js-duration" rel="noopener ugc nofollow" target="_blank"> SO问题</a>，因为它解决了一些问题。</p><p id="074a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个函数的测试很简单:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="9847" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">IsDuration验证程序</h1><p id="788d" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">现在，让我们将函数包装成一个实际的力矩验证器:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="3e92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lc ld le lf b">isDuration</code>函数是验证函数(重用了我们之前的函数)，而<code class="fe lc ld le lf b">IsDuration</code>函数是一个类型脚本属性装饰器。</p><p id="77c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你不知道，TS装饰其实是..一个功能。所以这个函数接收标准的<code class="fe lc ld le lf b">ValidationOptions</code>配置对象os Moment并返回验证器的定义。当它调用moment的<code class="fe lc ld le lf b">ValidateBy</code>函数时，它定义了验证需要如何执行，以及如果验证失败，返回什么消息。</p><p id="5896" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是这个验证器的测试:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="6f9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个验证器就像在要验证的属性中添加<code class="fe lc ld le lf b">@IsDuration()</code>一样简单。</p><h1 id="5a5d" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">智力验证器</h1><p id="237c" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">下一个验证器扩展了前一个验证器，以确保持续时间值等于或大于某个最小值。</p><p id="cfed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实现如下:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="465e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个验证器稍微复杂一点，因为它接受一个输入值，我们称之为<code class="fe lc ld le lf b">minDurationInMs</code>(以毫秒为单位的最小持续时间)。我们将该值作为参数传递给装饰函数，装饰函数将其作为约束传递给<code class="fe lc ld le lf b">ValidateBy </code>函数，并使用<code class="fe lc ld le lf b">args?.constraints[0]</code>检索/传递给<code class="fe lc ld le lf b">minDuration</code>函数。</p><p id="ae74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，这样的验证器很容易测试:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="113b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且易于使用:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="4000" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="d163" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">在本文中，我已经向您展示了使用TypeScript和简单函数创建定制的类验证器验证装饰器是多么容易。</p><p id="3154" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们使用的是现在正式的dead Moment.js库，但是您可以为任何库或者您可能有的需求创建类似的验证器。</p><p id="75a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止！</p><p id="a670" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PS:如果你想学习大量关于软件/Web开发、TypeScript、Angular、React、Vue、Kotlin、Java、Docker/Kubernetes和其他很酷的主题的其他很酷的东西，那么不要犹豫<a class="ae kl" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">去拿一本我的书</a>并订阅<a class="ae kl" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的简讯</a>！</p></div></div>    
</body>
</html>