<html>
<head>
<title>Using Parasite to Debug NodeJS applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用寄生虫调试NodeJS应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-parasite-to-debug-nodejs-applications-8c9445358708?source=collection_archive---------4-----------------------#2020-04-15">https://javascript.plainenglish.io/using-parasite-to-debug-nodejs-applications-8c9445358708?source=collection_archive---------4-----------------------#2020-04-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8e039c73c9f92d52c44aaba1d8e7de7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5-me3wAGmp9vUGECIUrYw.png"/></div></div></figure><p id="5632" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我最近花了很多时间为<a class="ae kt" href="https://lynk.sh" rel="noopener ugc nofollow" target="_blank"> Lynk </a>开发新功能，我们最需要的功能是请求捕获和回放。这意味着能够看到通过Lynk隧道的单个HTTP请求和响应(更多信息请见<a class="ae kt" href="https://lynk.sh/docs" rel="noopener ugc nofollow" target="_blank">此处</a>)，而且能够在您更改代码时重放它们，而不必每次都通过web浏览器。</p><p id="3641" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个特性在开发REST APIs时特别有用，因为它允许您快速查看应用程序如何响应代码的各种迭代。<a class="ae kt" href="https://ngrok.com" rel="noopener ugc nofollow" target="_blank"> Ngrok，</a>Lynk<a class="ae kt" href="https://lynk.sh" rel="noopener ugc nofollow" target="_blank">Lynk</a>的现有替代品已经提供了这一功能(包括请求回放)，因此为即将到来的测试版开发这一功能是有意义的。</p><p id="4c64" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，我们不想让这个特性仅限于Lynk。拥有通过后端API和前端UI捕获和重放请求的能力对于许多应用程序来说是有意义的——不管它们是否通过Lynk托管。</p><p id="74d1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是为什么开发<a class="ae kt" href="https://parasite.sh" rel="noopener ugc nofollow" target="_blank">寄生虫</a>是有意义的——一个独立的代理服务器，允许您拦截、记录和重放传入的HTTP流量。它在我们的Github上也是完全开源的。</p><p id="ff36" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">寄生虫也可以作为一个<a class="ae kt" href="https://www.npmjs.com/package/@loophole-labs/parasite" rel="noopener ugc nofollow" target="_blank"> NPM包</a>获得，今天我将带你在ExpressJS API中嵌入它。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="103d" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">设置ExpressJS项目</strong></h1><p id="88f6" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">对于本教程，我们将建立一个快速ExpressJS hello-world项目，我们可以将寄生虫嵌入其中。为此，首先确保您拥有NodeJS v12.0.0或更高版本:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1331" class="mn lc in mj b gy mo mp l mq mr">$ node --version<br/>v12.0.0</span></pre><p id="1d1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">和NPM版本6.9.0或更高版本:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="450b" class="mn lc in mj b gy mo mp l mq mr">$ npm --version<br/>6.9.0</span></pre><p id="a8f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后使用<code class="fe ms mt mu mj b">npx express generator</code>启动hello-world ExpressJS项目:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="560c" class="mn lc in mj b gy mo mp l mq mr">$ mkdir hello-world<br/>$ cd hello-world<br/>$ npx express-generator</span></pre><p id="f7cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将为您创建必要的样板文件。要启动服务器，只需运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="90e7" class="mn lc in mj b gy mo mp l mq mr">$ npm install<br/>$ DEBUG=hello-world:* npm run start</span></pre><p id="3d06" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者用纱线:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6b55" class="mn lc in mj b gy mo mp l mq mr">$ yarn install<br/>$ DEBUG=hello-world:* yarn start</span></pre><p id="836f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将在<a class="ae kt" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>上启动一个本地开发服务器。</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/7a834a23af1ba3bc50527f60ecd2c587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*30kJQZtw6z6hJ6_8-CY5-g.png"/></div></div></figure><p id="335c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当你完成的时候关闭它，因为我们将会修改服务器来启动里面的寄生虫。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="9b2d" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">安装寄生</strong></h1><p id="1f32" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">虽然寄生虫是用NodeJS编写的，但我们决定<a class="ae kt" href="https://parasite.sh/?p=1" rel="noopener ugc nofollow" target="_blank">也将它作为打包的二进制文件</a>提供给无法安装NodeJS的环境。</p><p id="9215" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，对于本教程，我们将在生成的ExpressJS项目中安装NPM包:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8f94" class="mn lc in mj b gy mo mp l mq mr">$ <!-- -->npm install @loophole-labs/parasite</span></pre><p id="c1d4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者，如果你喜欢纱线:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e870" class="mn lc in mj b gy mo mp l mq mr">yarn add @loophole-labs/parasite</span></pre><p id="244b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们需要修改先前生成的<code class="fe ms mt mu mj b">app.js</code>,在某处包含以下几行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2079" class="mn lc in mj b gy mo mp l mq mr">var Parasite = require('@loophole-labs/parasite');                 <br/>var parasite = new Parasite();</span></pre><p id="608a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的最终<code class="fe ms mt mu mj b">hello-world/app.js</code>应该如下所示:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dfc1" class="mn lc in mj b gy mo mp l mq mr">// hello-world/app.js                 <br/><br/>var Parasite = require('@loophole-labs/parasite');                 <br/>var parasite = new Parasite();                 <br/><br/>var createError = require('http-errors');                 <br/>var express = require('express');<br/>var path = require('path');                 <br/>var cookieParser = require('cookie-parser');                 <br/>var logger = require('morgan');                 <br/>var indexRouter = require('./routes/index');                 <br/>var usersRouter = require('./routes/users');                 <br/>var app = express();                 <br/>// view engine setup                 <br/>app.set('views', path.join(__dirname, 'views'));                 <br/>app.set('view engine', 'jade');                 <br/>app.use(logger('dev'));                 <br/>app.use(express.json());                 <br/>app.use(express.urlencoded({ extended: false }));                 <br/>app.use(cookieParser());                 <br/>app.use(express.static(path.join(__dirname, 'public')));                 <br/>app.use('/', indexRouter);                 <br/>app.use('/users', usersRouter);                 <br/>// catch 404 and forward to error handler                 <br/>app.use(function(req, res, next) {                 <br/>	next(createError(404));                 <br/>});                 <br/>// error handler                 <br/>app.use(function(err, req, res, next) {                 <br/>	// set locals, only providing error in development                 <br/>	res.locals.message = err.message;                 <br/>	res.locals.error = req.app.get('env') === 'development' ? err : {};                 <br/>	// render the error page                 <br/>	res.status(err.status || 500);                 <br/>	res.render('error');                 <br/>});                 <br/>module.exports = app;</span></pre><p id="2da4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">就这样。寄生虫现在已经嵌入到你的ExpressJS应用中了。</strong></p><p id="a3c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用<code class="fe ms mt mu mj b">DEBUG=hello-world:* npm run start</code>或<code class="fe ms mt mu mj b">DEBUG=hello-world:* yarn start</code>启动应用程序备份，您将看到寄生虫在<a class="ae kt" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>创建一个代理，并将流量转发到您的ExpressJS应用程序(它仍然运行在端口3000上)。</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/40fd3c80feb33a9e3453bd22fd8949ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZNUNnkClVnV2RsWFh6KoQ.png"/></div></div></figure><p id="6100" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您还会看到Web UI从<a class="ae kt" href="http://localhost:5050" rel="noopener ugc nofollow" target="_blank"> http://localhost:5050 </a>开始，所有捕获的流量都将在这里显示。您还可以从这里重放请求:</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/965d5856e2c5a67d5568079f9664d539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j03Q0QcOVU-7_jMVwSaa6A.png"/></div></div></figure><p id="c049" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以及直接通过位于<a class="ae kt" href="http://localhost:5050/api" rel="noopener ugc nofollow" target="_blank">http://localhost:5050/API</a>的后端API。</p><p id="f649" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读！请访问我们的<a class="ae kt" href="https://parasite.sh" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息，或通过<code class="fe ms mt mu mj b">shivanshvij@loopholelabs.io</code>联系我。如果你遇到任何问题，在https://github.com/loophole-labs/parasite<a class="ae kt" href="https://github.com/loophole-labs/parasite" rel="noopener ugc nofollow" target="_blank">提出问题。</a></p><p id="dcd3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在<code class="fe ms mt mu mj b"><a class="ae kt" href="https://shivanshvij.com" rel="noopener ugc nofollow" target="_blank">https://shivanshvij.com</a></code>找到更多关于我的信息，在<a class="ae kt" href="https://lynk.sh" rel="noopener ugc nofollow" target="_blank"> https://lynk.sh </a>找到更多关于Lynk的信息。</p><p id="1590" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们也将在接下来的几周内开始关闭<a class="ae kt" href="https://pigeonpost.io" rel="noopener ugc nofollow" target="_blank"> https://pigeonpost.io </a>，请加入我们的邮件列表，随时了解最新消息！</p><h2 id="85b7" class="mn lc in bd ld mx my dn lh mz na dp ll kg nb nc lp kk nd ne lt ko nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="e808" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，用你的中级用户名发邮件到<a class="ae kt" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">submissions@javascriptinplainenglish.com</strong></a>给我们，我们会把你添加为作者。</p><p id="9cbf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还推出了三种新的出版物！请关注我们的新出版物:<a class="ae kt" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jx io">AI in Plain English</strong></a><a class="ae kt" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jx io">UX in Plain English</strong></a><a class="ae kt" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jx io">Python in Plain English</strong></a><strong class="jx io"/>——谢谢，继续学习！</p></div></div>    
</body>
</html>