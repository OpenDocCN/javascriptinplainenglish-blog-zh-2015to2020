<html>
<head>
<title>Computing Derived State with the Reselect Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用重选库计算派生状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/computing-derived-state-with-the-reselect-library-5f177cc82002?source=collection_archive---------10-----------------------#2020-04-26">https://javascript.plainenglish.io/computing-derived-state-with-the-reselect-library-5f177cc82002?source=collection_archive---------10-----------------------#2020-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1bca770c612671d6d01d3827f68668de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zZXJHdW_u1MF5UZw"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@bpyndus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bodie Pyndus</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1e99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了Redux，我们可以用它在JavaScript应用程序的中央位置存储数据。它可以单独工作，当与React-Redux结合使用时，它也是一个受欢迎的React应用程序状态管理解决方案。</p><p id="de1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将查看从现有状态计算派生状态的重新选择库。</p><h1 id="79e1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="5066" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下代码运行NPM来安装一个包:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f302" class="mn lc iq mj b gy mo mp l mq mr">npm i reselect</span></pre><h1 id="95ea" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用重新选择库将状态合并为一个</h1><p id="be0c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">一旦我们安装了库，我们就可以导入库，如下所示:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="42d9" class="mn lc iq mj b gy mo mp l mq mr">import { createSelector } from "reselect";</span></pre><p id="943d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在下面的例子中使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="22cf" class="mn lc iq mj b gy mo mp l mq mr">import { createSelector } from "reselect";</span><span id="8b9a" class="mn lc iq mj b gy ms mp l mq mr">const shopItemsSelector = state =&gt; state.shop.items;<br/>const taxPercentSelector = state =&gt; state.shop.taxPercent;</span><span id="afa0" class="mn lc iq mj b gy ms mp l mq mr">const subtotalSelector = createSelector(<br/>  shopItemsSelector,<br/>  items =&gt; items.reduce((acc, item) =&gt; acc + item.price, 0)<br/>);</span><span id="0867" class="mn lc iq mj b gy ms mp l mq mr">const taxSelector = createSelector(<br/>  subtotalSelector,<br/>  taxPercentSelector,<br/>  (subtotal, taxPercent) =&gt; subtotal * (taxPercent / 100)<br/>);</span><span id="18d3" class="mn lc iq mj b gy ms mp l mq mr">export const totalSelector = createSelector(<br/>  subtotalSelector,<br/>  taxSelector,<br/>  (subtotal, tax) =&gt; ({ total: (subtotal + tax).toFixed(2) })<br/>);</span><span id="c3cf" class="mn lc iq mj b gy ms mp l mq mr">let shoppingCart = {<br/>  shop: {<br/>    taxPercent: 8,<br/>    items: [{ name: "grape", price: 1.2 }, { name: "banana", price: 0.89 }]<br/>  }<br/>};</span><span id="4885" class="mn lc iq mj b gy ms mp l mq mr">console.log(subtotalSelector(shoppingCart));<br/>console.log(taxSelector(shoppingCart));<br/>console.log(totalSelector(shoppingCart));</span></pre><p id="0a0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们创建了从对象返回属性的函数，方法是传入一个对象，然后返回我们想要返回的属性，如下所示:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="77b2" class="mn lc iq mj b gy mo mp l mq mr">const shopItemsSelector = state =&gt; state.shop.items;<br/>const taxPercentSelector = state =&gt; state.shop.taxPercent;</span></pre><p id="10bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成后，我们可以创建如下计算状态:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1aa0" class="mn lc iq mj b gy mo mp l mq mr">const subtotalSelector = createSelector(<br/>  shopItemsSelector,<br/>  items =&gt; items.reduce((acc, item) =&gt; acc + item.price, 0)<br/>);</span><span id="69cf" class="mn lc iq mj b gy ms mp l mq mr">const taxSelector = createSelector(<br/>  subtotalSelector,<br/>  taxPercentSelector,<br/>  (subtotal, taxPercent) =&gt; subtotal * (taxPercent / 100)<br/>);</span><span id="576b" class="mn lc iq mj b gy ms mp l mq mr">export const totalSelector = createSelector(<br/>  subtotalSelector,<br/>  taxSelector,<br/>  (subtotal, tax) =&gt; ({ total: (subtotal + tax).toFixed(2) })<br/>);</span></pre><p id="35cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">subtotalSelector</code>中，我们通过传入上面定义的<code class="fe mt mu mv mj b">shopItemsSelector</code>函数来分配从<code class="fe mt mu mv mj b">createSelector</code>返回的对象，在这里我们返回我们想要计算的属性。</p><p id="e568" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将该函数传递给第二个获取<code class="fe mt mu mv mj b">item</code>的参数，我们从<code class="fe mt mu mv mj b">shoppingCart</code>返回<code class="fe mt mu mv mj b">items</code>数组。</p><p id="ce5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">函数<code class="fe mt mu mv mj b">price</code>取值并返回。</p><p id="0fab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们有<code class="fe mt mu mv mj b">taxSelector</code>，它从<code class="fe mt mu mv mj b">shopItemsSelector</code>获取<code class="fe mt mu mv mj b">shoppingCart.shop.items</code>，从<code class="fe mt mu mv mj b">taxPercentSelector</code>返回<code class="fe mt mu mv mj b">state.shop.taxPercent</code>。</p><p id="887b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后由<code class="fe mt mu mv mj b">subtotalSelector</code>返回的内容被传递给回调的<code class="fe mt mu mv mj b">subtotal</code>参数的。接下来，<code class="fe mt mu mv mj b">taxPercentSelector</code>返回的内容被传递给<code class="fe mt mu mv mj b">taxPercent</code>参数，然后<code class="fe mt mu mv mj b">subtotal * (taxPercent / 100)</code>返回。</p><p id="da80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们做同样的事情来创建<code class="fe mt mu mv mj b">totalSelector</code>。</p><p id="0381" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们运行<code class="fe mt mu mv mj b">console.log</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cbbc" class="mn lc iq mj b gy mo mp l mq mr">console.log(subtotalSelector(shoppingCart));<br/>console.log(taxSelector(shoppingCart));<br/>console.log(totalSelector(shoppingCart));</span></pre><p id="09e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们从<code class="fe mt mu mv mj b">console.log</code>中看到以下内容:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="426e" class="mn lc iq mj b gy mo mp l mq mr">2.09<br/>0.1672<br/>{total: "2.26"}</span></pre><p id="4929" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从<code class="fe mt mu mv mj b">shoppingCart.shop.items</code>计算小计，得到2.09美元</p><p id="04fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">taxSelector(shoppingCart)</code>计算出税额。然后通过上面的<code class="fe mt mu mv mj b">subtotalSelector</code>和<code class="fe mt mu mv mj b">taxSelector</code>计算总数，得到0.1672。</p><p id="0ec2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我们所看到的，我们用它通过<code class="fe mt mu mv mj b">subtotalSelector</code>和<code class="fe mt mu mv mj b">taxSelector</code>组成选择器，然后在<code class="fe mt mu mv mj b">totalSelector</code>中使用两者的返回值。这让我们<code class="fe mt mu mv mj b">{total: “2.26”}</code>。</p><p id="9b5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回的<code class="fe mt mu mv mj b">subtotal</code>和<code class="fe mt mu mv mj b">tax</code>被返回。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/73fc93c1470f12c80ccc1b7ac662d602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ImT6nvnWRW50bvTr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@artificialphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artificial Photography</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0d78" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d65d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Reselect从其他状态中派生出状态。我们所做的就是创建从对象返回属性的函数，然后将这些函数传递给<code class="fe mt mu mv mj b">createSelector</code>函数，这样我们就可以用它们来计算新的值。</p><p id="7bf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了计算新值，我们可以编写函数来获取那些从选择器函数返回的派生状态，然后使用它们来计算新值。</p><h2 id="f580" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="9446" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>——谢谢，继续学习！</p><p id="953b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>