# Node.js 最佳实践—监控

> 原文：<https://javascript.plainenglish.io/node-js-best-practices-monitoring-82123339fdb0?source=collection_archive---------1----------------------->

![](img/b65512ee62097c877f273703ec24e515.png)

Photo by [Anna Pelzer](https://unsplash.com/@annapelzer?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

像任何类型的应用程序一样，JavaScript 应用程序也必须写得很好。

否则，我们以后会遇到各种各样的问题。

在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。

# 委托给反向代理

我们应该将反向代理所能做的一切委托给它。

他们可以做的事情包括 SSL、gzip 等。

这样，我们的应用程序需要做的事情更少，这意味着它使用的资源更少。

我们不希望我们的应用程序忙于基础设施任务，而不是它应该做的事情。

# 锁定依赖关系

为了避免不同包版本的问题，我们应该锁定项目的依赖关系。

我们可以通过使用带有`.npmrc`的配置文件来告诉 NPM 需要哪个确切的版本。

或者，我们可以使用`npm shrinkwrap`来锁定我们想要的依赖项。

# 使用正确的工具保障流程正常运行

我们应该用像 PM2 这样的过程管理工具来检查正常运行时间。

这样，如果遇到任何错误，我们的节点应用程序将重新启动。

# 利用所有 CPU 内核

如果我们的服务器中有多个 CPU 核心，那么我们应该使用它们。

我们可以使用节点集群或 PM2 来管理中小型应用的集群。

对于较大的应用程序，我们可以使用一些 Docker 集群或基于 Linux 的 init 系统的部署脚本来复制这个过程。

否则，我们将无法利用服务器的全部能力来为我们的应用程序提供服务，

# 创建维护端点

我们可以创建一个维护端点来返回我们想要从应用程序中获取的数据。

这样，我们可以在一个地方获得我们需要的所有信息。

我们不想仅仅为了找到一些数据而进行诊断部署。

# 使用 APM 产品发现错误和停机时间

APM 产品非常适合在我们的应用程序中找出错误、停机时间和缓慢的代码。

它超越了传统的监控，从整体上监控我们应用的用户体验。

他们可以找到性能问题的根本原因。

# 让我们的代码可以投入生产

我们从第一天起就要计划生产。

我们的应用应该是无状态的。所以它不应该在本地保存数据。

应该在任何地方使用缓存来提高性能。

从一开始就应该检查内存使用情况。

我们可以用像`memwatch`这样的工具来检查它们。

当有函数时，命名函数帮助我们跟踪代码。

CI 工具对于在将代码投入生产之前检测故障非常有用。

日志数据应该有上下文信息。

并且应该有一个描述交易的 ID。

应该进行错误处理以防止崩溃。

# 测量和保护内存使用

我们应该确保我们的应用程序不会占用太多内存。

如果是这样，那么我们应该限制它，确保我们的应用程序永远不会使用超过这个数量。

此外，我们可能会定期使用 shell 命令来测量小应用程序的内存使用情况。

但对于较大的应用，我们需要添加内置的内存监控系统。

![](img/596481037ff643eeeca2bac60e351596.png)

Photo by [Dakota Corbin](https://unsplash.com/@thedakotacorbin?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

# 结论

我们可以观察各种监控产品的问题。

此外，我们应该尽可能地利用所有的资源，但是要控制内存的使用。