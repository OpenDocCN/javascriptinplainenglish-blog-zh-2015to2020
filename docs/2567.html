<html>
<head>
<title>JavaScript Tips — Getting Keypresses, Callbacks to Promises and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript技巧——获取按键、对承诺的回调等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-tips-getting-keypresses-callbacks-to-promises-and-more-7dfa9e19dc8f?source=collection_archive---------14-----------------------#2020-07-05">https://javascript.plainenglish.io/javascript-tips-getting-keypresses-callbacks-to-promises-and-more-7dfa9e19dc8f?source=collection_archive---------14-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eca5926c51811fef01906a1ea92b210d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l6Huf3OWQyCnYli_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@punttim?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tim Gouw</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4de5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写JavaScript应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些常见JavaScript问题的解决方案。</p><h1 id="5e6e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将现有的回访转变为承诺</h1><p id="35fc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有几种方法可以将现有的回电转化为承诺。</p><p id="de66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种方法是使用<code class="fe me mf mg mh b">Promise</code>构造函数。</p><p id="bc91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a1b2" class="mq lc iq mh b gy mr ms l mt mu">return new Promise((resolve, reject) =&gt; {<br/>  window.onload = resolve;<br/>});</span></pre><p id="8ad6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以将回调代码放在回调函数中，然后在它运行完代码后调用<code class="fe me mf mg mh b">resolve</code>。</p><p id="684f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以用一个库来做。</p><p id="00d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">jQuery有<code class="fe me mf mg mh b">Deferred</code>属性让我们这样做:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2cc4" class="mq lc iq mh b gy mr ms l mt mu">$.Deferred((dfrd) =&gt; {<br/>   getData(id, dfrd.resolve, dfrd.reject);<br/>}).promise();</span></pre><p id="20cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用回调函数调用<code class="fe me mf mg mh b">Deferred</code>来返回一个延迟的对象。</p><p id="ac95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们给<code class="fe me mf mg mh b">promise</code>打电话以示承诺。</p><p id="a9e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在异步代码中调用<code class="fe me mf mg mh b">resolve</code>和<code class="fe me mf mg mh b">reject</code>，就像我们使用<code class="fe me mf mg mh b">Promise</code>构造函数一样。</p><p id="d518" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于节点样式的回调，我们也可以像以前一样使用<code class="fe me mf mg mh b">Promise</code>构造函数:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ebbf" class="mq lc iq mh b gy mr ms l mt mu">return new Promise((resolve, reject) =&gt; {<br/>  getStuff(param, (err, data) =&gt; {<br/>    if (err !== null) reject(err);<br/>    else resolve(data);<br/>  });<br/>});</span></pre><p id="9e42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们遇到错误时，我们调用<code class="fe me mf mg mh b">reject</code>，而<code class="fe me mf mg mh b">resolve</code>是我们获取数据。</p><p id="5cea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用像Bluebird这样的库来将节点样式的回调转换为承诺:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8742" class="mq lc iq mh b gy mr ms l mt mu">Promise.promisifyAll(asyncCode);</span></pre><p id="0b06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Promise</code>是蓝鸟<code class="fe me mf mg mh b">Promise</code>对象，它有<code class="fe me mf mg mh b">promisifyAll</code>方法将节点回调转换为承诺。</p><h1 id="3000" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将HTML画布捕获为图像</h1><p id="28c9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">toDataURL</code>方法将HTML canvas捕获为图像。</p><p id="73d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="40fc" class="mq lc iq mh b gy mr ms l mt mu">const canvas = document.getElementById("mycanvas");<br/>const img = canvas.toDataURL("image/png");</span></pre><p id="53a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以直接使用<code class="fe me mf mg mh b">img</code>字符串作为<code class="fe me mf mg mh b">img</code>标签的<code class="fe me mf mg mh b">src</code>属性的值。</p><h1 id="f175" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将逗号分隔的字符串转换为数组</h1><p id="3b1e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要将逗号分隔的字符串转换成数组，我们可以使用<code class="fe me mf mg mh b">split</code>方法。</p><p id="766f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a5f3" class="mq lc iq mh b gy mr ms l mt mu">const array = string.split(',');</span></pre><p id="52d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe me mf mg mh b">string</code>是<code class="fe me mf mg mh b">'foo,baz'baz'</code>，那么我们得到<code class="fe me mf mg mh b">['foo', 'bar', 'baz']</code>作为<code class="fe me mf mg mh b">array</code>的值。</p><h1 id="92c2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">JavaScript中的静态变量</h1><p id="8245" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在JavaScriopt中创建一个静态变量，方法是将它们附加为构造函数的属性。</p><p id="b178" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="590f" class="mq lc iq mh b gy mr ms l mt mu">function Foo(){}<br/>Foo.bar = 'baz';</span></pre><p id="98a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe me mf mg mh b">bar</code>就是<code class="fe me mf mg mh b">Foo</code>构造函数的一个静态属性。</p><p id="6202" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于类，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d128" class="mq lc iq mh b gy mr ms l mt mu">class Foo {<br/>  static foo = 'bar'<br/>}</span></pre><p id="1b02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">static</code>关键字来定义静态的<code class="fe me mf mg mh b">foo</code>属性。</p><p id="beea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无论哪种情况，我们都可以用<code class="fe me mf mg mh b">Foo.bar</code>来访问它。</p><h1 id="5d88" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查数字是浮点数还是整数</h1><p id="47be" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用余数运算符检查浮点数是否是整数。</p><p id="6c4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="812a" class="mq lc iq mh b gy mr ms l mt mu">n % 1 === 0;</span></pre><p id="130b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，其中<code class="fe me mf mg mh b">n</code>是一个数字。</p><p id="0a94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果它能被1整除，那么我们知道它是一个整数。</p><p id="f062" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以使用<code class="fe me mf mg mh b">Number.isSafeInteger</code>法进行检查。</p><p id="8427" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有一种<code class="fe me mf mg mh b">Number.isInteger</code>方法。</p><p id="17e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们都带了一个我们要检查的号码:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c6e1" class="mq lc iq mh b gy mr ms l mt mu">Number.isInteger(1);<br/>Number.<!-- -->isSafeInteger<!-- -->(1);</span></pre><h1 id="6bf1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">混淆JavaScript</h1><p id="3535" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了混淆JavaScript，我们可以使用Uglify JS包来实现。</p><p id="cff8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过运行以下命令来安装它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7df4" class="mq lc iq mh b gy mr ms l mt mu">npm install -g uglify-js</span></pre><p id="7a4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">丑化的代码可以被颠倒。</p><p id="e421" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，私有字符串在被修改后仍然可见。</p><h1 id="d1b7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">window.onload vs document.onload</h1><p id="2c05" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">window.onload</code>和<code class="fe me mf mg mh b">document.onload</code>有区别。</p><p id="2c84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">window.onload</code>当整个页面加载时运行，包括图像、CSS、脚本等。</p><p id="c4ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">document.onload</code>是在DOM准备好时调用的，这可以先于图像和其他外部资源被加载。</p><h1 id="4822" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取用jQuery事件键按下了哪个键</h1><p id="a1b3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以得到用<code class="fe me mf mg mh b">keyCode</code>或<code class="fe me mf mg mh b">which</code>属性按下的键。</p><p id="6c35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了检查是否按下了回车键，我们检查代码13:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d5f0" class="mq lc iq mh b gy mr ms l mt mu">const code = e.keyCode || e.which;<br/>if (code === 13) { <br/>  //...<br/>}</span></pre><h1 id="460a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">对象文字中的自引用</h1><p id="4d8f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用getter返回从对象中的其他属性派生的数据。</p><p id="082b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d9d5" class="mq lc iq mh b gy mr ms l mt mu">const foo = {<br/>  a: 5,<br/>  b: 6,<br/>  get sum() {<br/>    return this.a + this.b;<br/>  }<br/>}</span></pre><p id="fc72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">sum</code>吸气剂，它是通过将<code class="fe me mf mg mh b">a</code>和<code class="fe me mf mg mh b">b</code>加在一起得到的。</p><p id="f721" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然吸气剂是方法，我们可以在里面使用<code class="fe me mf mg mh b">this</code>。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/a267ddce885ff331c1c22012db897fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8i3IIsBjyvAfzKsv"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@toddquackenbush?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Todd Quackenbush</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ccd0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="51bf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有很多方法可以将回调转换成承诺。</p><p id="d6cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用吸气剂来创建从其他属性派生的属性。</p><p id="f6c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript构造函数可以有静态变量。</p><p id="b050" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以得到按下的键。</p><h2 id="a6e9" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">简单明了的JavaScript</strong></h2><p id="84c9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有四个出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到他们，点击</strong> </a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>