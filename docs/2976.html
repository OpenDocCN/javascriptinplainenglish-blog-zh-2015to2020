<html>
<head>
<title>How to build a Real-Time multiuser Drawing app using Node and Socket.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node和Socket.io构建实时多用户画图app</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-a-real-time-multiuser-drawing-app-using-node-and-socket-io-bdebc5df916?source=collection_archive---------2-----------------------#2020-08-13">https://javascript.plainenglish.io/how-to-build-a-real-time-multiuser-drawing-app-using-node-and-socket-io-bdebc5df916?source=collection_archive---------2-----------------------#2020-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5b300f608d5ea109efb0b5e5f11abf58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wB_Jke95bVaDknr_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@dose?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dose Media</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c031" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将构建一个聊天应用程序，发送用户自制的图片，而不是简单的聊天消息。我们使用带有Socket.io的Express和HTTP服务器来实现实时功能，并在前端部分使用<strong class="kf ir"> drawingboard.js </strong>和jQuery来保持简洁。这是我们将要构建的最终工作演示。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/a8c3fbd6a2856c007b6c7d3ff48421c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MI6NeZrij4OVTS6ILTIxFQ.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Working Demo of Drawing App</figcaption></figure><p id="9999" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Github仓库中与此tut相关的代码如下所示:</p><blockquote class="lg"><p id="20b9" class="lh li iq bd lj lk ll lm ln lo lp la dk translated"><a class="ae kc" href="https://github.com/Mayank-MP05/Realtime-Drawing-Chat-NodeJS-SocketIO" rel="noopener ugc nofollow" target="_blank">https://github . com/Mayank-MP05/real time-Drawing-Chat-NodeJS-SocketIO</a></p></blockquote><p id="9e1d" class="pw-post-body-paragraph kd ke iq kf b kg lq ki kj kk lr km kn ko ls kq kr ks lt ku kv kw lu ky kz la ij bi translated">我们首先构建后端，然后转到前端部分，在构建后端部分之前，我们应该知道的是我们要通过客户端-服务器连接交换的数据类型。</p><p id="6a6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lv">我们使用图像数据URI作为字符串数据类型发送客户端到服务器，反之亦然。可以在这里阅读更多:</em> <a class="ae kc" href="https://en.wikipedia.org/wiki/Data_URI_scheme" rel="noopener ugc nofollow" target="_blank"> <em class="lv">数据URI方案</em> </a></p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="97a6" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">后端</h1><p id="e1ba" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">首先，确保您已经安装了node.js和npm，并且正在使用CLI启动npm项目并安装必要的依赖项</p><pre class="lc ld le lf gt ng nh ni nj aw nk bi"><span id="4855" class="nl me iq nh b gy nm nn l no np">npm init -y</span><span id="a145" class="nl me iq nh b gy nq nn l no np">npm install express socket.io</span></pre><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="be1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们导入了所有库Express HTTP和Socket IO。我们将静态设置到客户端文件夹，以便根据请求为静态前端提供服务。在套接字连接时，我们检查绘图数据URI是否由用户发出，并通过服务器将其重新发送给所有连接的用户。最后，我们开始监听指定端口上的服务器</p><p id="0ed4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恭喜你！您已经完成了后端部分。这是最起码的</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="e9f5" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">前端</h1><p id="3b7d" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">前端部分是客户端部分，它有一堆样式标记和脚本文件。我想解释一下核心机制、插座和画板，所以如果你想参考样式，你可以访问我上面提到的Github库中的代码。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/cec5292afa2e6d9d96021017a5f32cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*M9KLc_1VI9_vUOZvmw3KLg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Folder Structure for Project</figcaption></figure><p id="ece1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">客户端文件夹有一个包含库CSS和JS文件的画板文件夹。<strong class="kf ir">index.html</strong>用于基本标记文件。样式保存在<strong class="kf ir"> style.css中</strong>客户端socket和画板的核心逻辑保存在<strong class="kf ir"> script.js中</strong>另外，我们使用的是jQuery bootstrap和socket.io客户端使用的是CDN。</p><p id="4868" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个任务是在<strong class="kf ir">index.html</strong>中链接所有这些文件和cdn，在结束body标签之前链接所有的样式和CSS文件到head section和JS文件中，然后你的空HTML文件看起来像这样:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0b83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置好所有的链接后，下一个任务是给文件添加一些标记和样式，现在我不打算在这里详细解释样式，只是需要注意的是，样式是用来固定画板和导航条的位置，宽度和颜色很少</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8e62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是添加标记UI后的代码快照，我们添加了非常基本的导航栏，然后是一个消息容器，在底部的画板上有一个发送DWG按钮</p><p id="6228" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们移动客户端JS部分</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="a3b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lv">抱歉错别字！</em></p><p id="d422" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面使用的是jQuery once自动执行语法，你在函数体中写的任何东西都在开始时执行一次。首先，我们创建了一个<strong class="kf ir"> <em class="lv"> IO </em> </strong>类的实例作为<strong class="kf ir"> <em class="lv"> socket </em> </strong>并使用param提供的div的ID初始化画板</p><p id="ff89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们向按钮添加了一个点击事件(jQuery中的<code class="fe nu nv nw nh b"><em class="lv">click()</em></code>),每当用户按下send dwg按钮时，该代码就会在该函数中执行。我们首先使用在<strong class="kf ir"> drawing-board.js </strong>中预定义的<code class="fe nu nv nw nh b"><em class="lv">.getImg()</em></code> <strong class="kf ir"> </strong>函数获取画板图像的图像数据URI，然后使用socket IO客户端发出函数发出该图像数据URI字符串。</p><p id="155b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们发送图像时，我们使用<code class="fe nu nv nw nh b"><em class="lv">resetBackground(</em></code> <strong class="kf ir"> <em class="lv"> ) </em> </strong>方法将背景重置为空白。</p><p id="3a77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，由于服务器发出“drawing ”,我们必须将其映射到UI，因此我们使用了<code class="fe nu nv nw nh b"><em class="lv">on(“drawing”)</em></code>方法，并将图像作为列表对象附加到消息容器中</p><p id="2f5d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单！前端部分到此为止。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="5622" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个非常简单的例子，说明如何使用socket.io来构建到客户端的实时连接，并实时交换数据</p></div></div>    
</body>
</html>