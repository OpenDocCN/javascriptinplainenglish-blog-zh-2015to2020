<html>
<head>
<title>Chrome Extensions and a Local Database(IndexedDB)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chrome扩展和本地数据库(IndexedDB)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/chrome-extensions-and-local-database-indexeddb-3c92e12c436?source=collection_archive---------0-----------------------#2020-07-25">https://javascript.plainenglish.io/chrome-extensions-and-local-database-indexeddb-3c92e12c436?source=collection_archive---------0-----------------------#2020-07-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a86e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在本地硬盘上存储大量数据。</h2></div><p id="0d8c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想了解谷歌Chrome扩展的基础知识，请点击这里查看我的文章:</p><div class="kz la gp gr lb lc"><a href="https://medium.com/@an_object_is_a/how-does-a-chrome-extension-work-web-development-6e85bd2bccc1" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd io gy z fp lh fr fs li fu fw im bi translated">Chrome扩展是如何工作的？(网络开发)</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">Chrome扩展有5个部分:</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq lr lc"/></div></div></a></div></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><p id="c6be" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了在一个<strong class="ke io"> Chrome扩展</strong>的上下文中演示<strong class="ke io"> IndexedDB </strong>，我们将使用一个包含两个表单的简单HTML页面。</p><p id="7ad1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">一个添加记录的表单。</em></p><p id="57d5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">用于搜索和编辑记录的一个表单。</em></p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/cf4db6189629c1c1808b0c3a4c6a9124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZhOHY1dJm_lW9GIF0RsEA.png"/></div></div></figure><p id="e9b3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将通过我们的<strong class="ke io"> Chrome扩展</strong>的弹出页面使用这个表单。</p></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><h1 id="4d14" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">我们开始吧</h1><h2 id="5cab" class="nc ml in bd mm nd ne dn mq nf ng dp mu kl nh ni mw kp nj nk my kt nl nm na nn bi translated">我们的清单文件</h2><pre class="ma mb mc md gt no np nq nr aw ns bi"><span id="c1c5" class="nc ml in np b gy nt nu l nv nw">// manifest.json</span><span id="1fb4" class="nc ml in np b gy nx nu l nv nw">{<br/>    "name": "chrome ext with localDB",<br/>    "description": "chrome ext interacting with IndexedDB",<br/>    "version": "0.1.0",<br/>    "manifest_version": 2,<br/>    "icons": {<br/>        "16": "./obj-16x16.png",<br/>        "32": "./obj-32x32.png",<br/>        "48": "./obj-48x48.png",<br/>        "128": "./obj-128x128.png"<br/>    },<br/>    "background": {<br/>        "scripts": [<br/>            "./background.js"<br/>        ]<br/>    },<br/>    "options_page": "./options.html",<br/>    "browser_action": {<br/>        "default_popup": "popup.html"<br/>    },<br/>    "permissions": []<br/>}</span></pre><p id="47c1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">注意:</strong> <br/>我们不需要任何特殊权限；我们不需要'<em class="ky">存储</em>'权限来使用<strong class="ke io">索引数据库</strong>。</p></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><h1 id="acda" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">我们来看看那个背景脚本吧！</h1><p id="b4b5" class="pw-post-body-paragraph kc kd in ke b kf ny jo kh ki nz jr kk kl oa kn ko kp ob kr ks kt oc kv kw kx ig bi translated">当我们的Chrome扩展首次安装时，我们创建了一个数据库</p><pre class="ma mb mc md gt no np nq nr aw ns bi"><span id="5428" class="nc ml in np b gy nt nu l nv nw">// background.js</span><span id="4a7e" class="nc ml in np b gy nx nu l nv nw">let db = null;</span><span id="d0af" class="nc ml in np b gy nx nu l nv nw">function create_database() {<br/>    const request = window.indexedDB.open('MyTestDB');</span><span id="160b" class="nc ml in np b gy nx nu l nv nw">    request.onerror = function (event) {<br/>        console.log("Problem opening DB.");<br/>    }</span><span id="821a" class="nc ml in np b gy nx nu l nv nw">    request.onupgradeneeded = function (event) {<br/>        db = event.target.result;</span><span id="9311" class="nc ml in np b gy nx nu l nv nw">        let objectStore = db.createObjectStore('roster', {<br/>            keyPath: 'email'<br/>        });</span><span id="5676" class="nc ml in np b gy nx nu l nv nw">        objectStore.transaction.oncomplete = function (event) {<br/>            console.log("ObjectStore Created.");<br/>        }<br/>    }</span><span id="d1d1" class="nc ml in np b gy nx nu l nv nw">    request.onsuccess = function (event) {<br/>        db = event.target.result;<br/>        console.log("DB OPENED.");<br/>        insert_records(roster);</span><span id="0678" class="nc ml in np b gy nx nu l nv nw">        db.onerror = function (event) {<br/>            console.log("FAILED TO OPEN DB.")<br/>        }<br/>    }<br/>}</span></pre><p id="5805" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后填充数据库。</p><pre class="ma mb mc md gt no np nq nr aw ns bi"><span id="a5ea" class="nc ml in np b gy nt nu l nv nw">// background.js</span><span id="2771" class="nc ml in np b gy nx nu l nv nw">function insert_records(records) {<br/>    if (db) {<br/>      const insert_transaction = db.transaction("roster", <br/>                                   "readwrite");<br/>      const objectStore = insert_transaction.objectStore("roster");</span><span id="6836" class="nc ml in np b gy nx nu l nv nw">      return new Promise((resolve, reject) =&gt; {<br/>         insert_transaction.oncomplete = function () {<br/>             console.log("ALL INSERT TRANSACTIONS COMPLETE.");<br/>             resolve(true);<br/>         }</span><span id="3324" class="nc ml in np b gy nx nu l nv nw">         insert_transaction.onerror = function () {<br/>             console.log("PROBLEM INSERTING RECORDS.")<br/>             resolve(false);<br/>         }</span><span id="e997" class="nc ml in np b gy nx nu l nv nw">         records.forEach(person =&gt; {<br/>           let request = objectStore.add(person);</span><span id="5c09" class="nc ml in np b gy nx nu l nv nw">           request.onsuccess = function () {<br/>             console.log("Added: ", person);<br/>           }<br/>         });<br/>      });<br/>    }<br/>}</span></pre><p id="45c6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我们从前台添加、获取、更新或删除消息时:</p><pre class="ma mb mc md gt no np nq nr aw ns bi"><span id="0fbf" class="nc ml in np b gy nt nu l nv nw">// background.js</span><span id="3dbb" class="nc ml in np b gy nx nu l nv nw">function get_record(email) {<br/>  if (db) {<br/>    const get_transaction = db.transaction("roster", "readonly");<br/>    const objectStore = get_transaction.objectStore("roster");</span><span id="6613" class="nc ml in np b gy nx nu l nv nw">    return new Promise((resolve, reject) =&gt; {<br/>      get_transaction.oncomplete = function () {<br/>        console.log("ALL GET TRANSACTIONS COMPLETE.");<br/>      }</span><span id="12ed" class="nc ml in np b gy nx nu l nv nw">      get_transaction.onerror = function () {<br/>        console.log("PROBLEM GETTING RECORDS.")<br/>      }</span><span id="c2d2" class="nc ml in np b gy nx nu l nv nw">      let request = objectStore.get(email);</span><span id="aa2e" class="nc ml in np b gy nx nu l nv nw">      request.onsuccess = function (event) {<br/>        resolve(event.target.result);<br/>      }<br/>    });<br/>  }<br/>}</span><span id="d06f" class="nc ml in np b gy nx nu l nv nw">function update_record(record) {<br/>  if (db) {<br/>    const put_transaction = db.transaction("roster", "readwrite");<br/>    const objectStore = put_transaction.objectStore("roster");</span><span id="6537" class="nc ml in np b gy nx nu l nv nw">    return new Promise((resolve, reject) =&gt; {<br/>      put_transaction.oncomplete = function () {<br/>        console.log("ALL PUT TRANSACTIONS COMPLETE.");<br/>        resolve(true);<br/>      }</span><span id="7633" class="nc ml in np b gy nx nu l nv nw">      put_transaction.onerror = function () {<br/>        console.log("PROBLEM UPDATING RECORDS.")<br/>        resolve(false);<br/>      }</span><span id="e878" class="nc ml in np b gy nx nu l nv nw">      objectStore.put(record);<br/>    });<br/>  }<br/>}</span><span id="1af2" class="nc ml in np b gy nx nu l nv nw">function delete_record(email) {<br/>  if (db) {<br/>    const delete_transaction = db.transaction("roster", <br/>                                             "readwrite");<br/>    const objectStore = delete_transaction.objectStore("roster");</span><span id="37e9" class="nc ml in np b gy nx nu l nv nw">    return new Promise((resolve, reject) =&gt; {<br/>      delete_transaction.oncomplete = function () {<br/>        console.log("ALL DELETE TRANSACTIONS COMPLETE.");<br/>        resolve(true);<br/>      }</span><span id="d1ff" class="nc ml in np b gy nx nu l nv nw">      delete_transaction.onerror = function () {<br/>        console.log("PROBLEM DELETE RECORDS.")<br/>        resolve(false);<br/>      }</span><span id="f562" class="nc ml in np b gy nx nu l nv nw">      objectStore.delete(email);<br/>    });<br/>  }<br/>}</span></pre><p id="36b5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">…我们可以通过获取、更新和删除记录来响应…</p></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><h1 id="ce79" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">让我们来看看弹出页面及其附带的脚本。</h1><p id="0142" class="pw-post-body-paragraph kc kd in ke b kf ny jo kh ki nz jr kk kl oa kn ko kp ob kr ks kt oc kv kw kx ig bi translated">弹出页面是基本的html页面。两个带按钮的表单…</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="5088" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">…当然还有我们的'<strong class="ke io"> popup-script.js </strong>'附件，这样我们就可以捕获和操作DOM了。</p><p id="8d00" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在'<strong class="ke io"> popup-script.js </strong>中，我们捕获表单信息并向后台脚本发送消息，因此后台脚本可以执行所有的<strong class="ke io"> IndexedDB </strong>命令…</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="od oe l"/></div></figure><blockquote class="of"><p id="0efe" class="og oh in bd oi oj ok ol om on oo kx dk translated">…一旦我们从后台接收到IndexedDB数据，我们就会在HTML弹出页面上向用户显示一些视觉反馈！</p></blockquote><figure class="oq or os ot ou me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi op"><img src="../Images/a51007721727cc2dd43f774fc3e6153e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZUPgGdO5G_sTnZYm1b2yg.png"/></div></div></figure></div><div class="ab cl ls lt hr lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ig ih ii ij ik"><p id="6830" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想查看更深入的指南，可以查看我在YouTube上的完整视频教程，<strong class="ke io">一个对象就是一个</strong>。</p><p id="d41e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一定要在<a class="ae ov" href="https://www.instagram.com/an_object_is_a/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> Instagram </strong> </a>和<a class="ae ov" href="https://twitter.com/anobjectisa1" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> Twitter </strong> </a>上关注我们，及时了解我们最新的<strong class="ke io"> Web开发教程</strong>。</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="ow oe l"/></div></figure><p id="1277" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">代表</em><a class="ae ov" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ky">plain English . io</em></strong></a><em class="ky">团队，感谢阅读。</em></p></div></div>    
</body>
</html>