<html>
<head>
<title>Web Scraping with Puppeteer in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js中的Puppeteer进行网页抓取</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/web-scraping-with-puppeteer-in-node-js-4a32d85df183?source=collection_archive---------7-----------------------#2020-04-20">https://javascript.plainenglish.io/web-scraping-with-puppeteer-in-node-js-4a32d85df183?source=collection_archive---------7-----------------------#2020-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/180002de5a10a786db52201c189f3634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*laoZh8fB6iCGTuBbR_2zig.png"/></div></div></figure><p id="2045" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你是否曾经想使用你最喜欢的公司或网站的API来开发一个新的应用程序项目，却发现他们要么a)从一开始就没有这样的API，要么b)已经根除了它的API供公众使用？(我正看着你，网飞)嗯，这就是发生在我身上的事，作为一个坚持不懈的人，我发现了解决这个问题的方法:网络抓取。</p><p id="75cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网络抓取是一种使用软件从网站自动提取和收集数据的技术。收集数据后，您可以使用它来制作自己的API。</p><p id="2a42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有许多技术可以用于网络抓取；Python是一种流行的语言。然而，我是一个JavaScript类型的女孩。因此，在这篇博客中，我将使用Node.js和Puppeteer。</p><p id="ed1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Puppeteer是一个Node.js库，允许我们在后台运行Chrome浏览器(称为无头浏览器，因为它不需要图形用户界面)，并帮助从网站提取数据。</p><p id="403f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我们大多数人都被新冠肺炎扣在家里做人质，所以看网飞狂欢成了很多人的流行消遣(除了哭我们还能做什么？).为了支持我那些优柔寡断、无聊透顶的网飞观众，我找到了一个网站，<a class="ae kw" href="https://www.digitaltrends.com/movies/best-movies-on-netflix/" rel="noopener ugc nofollow" target="_blank">https://www . digital trends . com/movies/best-movies-on-网飞/ </a>列出了2020年4月可以观看的最佳电影。一旦我抓取了这个页面并检索了数据，我想把它存储在一个JSON文件中。这样，如果我需要一个最新的网飞电影API，我可以从这个库中获取数据。</p><h1 id="e15a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">入门指南</h1><p id="cfaa" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先，我在我的VSCode中创建了一个名为<code class="fe ma mb mc md b">webscraper</code>的文件夹。在这个文件夹中，我将创建一个名为<code class="fe ma mb mc md b">netflixscrape.js</code>的文件。</p><p id="779e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在终点站，我们需要安装木偶师。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="1fe7" class="mm ky iq md b gy mn mo l mp mq">npm i puppeteer</span></pre><p id="06d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要导入所需的模块和库。<code class="fe ma mb mc md b">netflixscrape.js</code>中的第一行代码将是:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="aa32" class="mm ky iq md b gy mn mo l mp mq">const puppeteer= require('puppeteer')<br/>const fs = require('fs')</span></pre><p id="6a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">fs</code>是Node.js文件系统模块。我们将需要使用它从我们的数据中创建一个JSON文件。</p><h1 id="bc5c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">编写抓取函数</h1><p id="59cb" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">让我们开始编写我们的<code class="fe ma mb mc md b">scrape()</code>函数。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="8981" class="mm ky iq md b gy mn mo l mp mq">async function scrape (<em class="mr">url</em>) {<br/>const browser = await puppeteer.launch();<br/>const page = await browser.newPage();<br/>await page.goto(url)</span></pre><p id="4bf1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">scrape()</code>将接受一个url的参数。我们使用<code class="fe ma mb mc md b">puppeteer.launch()</code>启动浏览器。在浏览器上打开一个空白页。然后，我们告诉浏览器转到指定的url。</p><h2 id="9bd4" class="mm ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">如何检索我们想要抓取的数据</h2><p id="55ab" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了从站点中抓取我们想要的数据，我们需要使用特定的HTML元素来抓取数据。进入<a class="ae kw" href="https://www.digitaltrends.com/movies/best-movies-on-netflix/" rel="noopener ugc nofollow" target="_blank">https://www . digital trends . com/movies/best-movies-on-网飞/ </a>并打开Inspector/Chrome DevTools。为此:</p><p id="856f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Mac上的“command + option + j”或Windows上的“control + shift + j”</p><p id="a78b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我想从文章中获取电影的标题和摘要，我看到我必须选择<code class="fe ma mb mc md b">h2</code>元素(标题)和它的“兄弟<code class="fe ma mb mc md b">p</code>元素(摘要)。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/3512e34e089e63d53206232d3fb50ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BEQd106SvxT1_jGuS4I23A.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">h2 for movie title</figcaption></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/69ea7d56de77f8e682ef3d3d328282d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RH8gGDJeIGE8Wz3VcDgyaQ.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">p for movie summary</figcaption></figure><h2 id="95c0" class="mm ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">如何操作检索到的数据</h2><p id="1a83" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">继续我们的代码:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="616e" class="mm ky iq md b gy mn mo l mp mq">var movies = await page.evaluate(() =&gt; {<br/>   var titlesList = document.querySelectorAll('h2');<br/>   var movieArr = [];</span><span id="b9a0" class="mm ky iq md b gy nj mo l mp mq">   for (var i = 0; i &lt; titlesList.length; i++) {<br/>      movieArr[i] = {<br/>     title: titlesList[i].innerText.trim(),<br/>     summary: titlesList[i].nextElementSibling.innerText.trim()<br/>   };<br/>}<br/>return movieArr;<br/>})</span></pre><p id="2937" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">page.evaluate()</code>用于进入网站的DOM，并允许我们运行定制的JavaScript代码，就像我们在DevTools控制台中执行它一样。</p><p id="5c6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">document.querySelector('h2')</code>选择页面上所有的<code class="fe ma mb mc md b">h2</code>元素。我们将它们全部保存在<code class="fe ma mb mc md b">titlesList</code>变量中。</p><p id="20a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们创建一个名为<code class="fe ma mb mc md b">movieArr</code>的空数组。</p><p id="cc6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们希望将每部电影的标题和摘要保存在各自的对象中。为了做到这一点，我们为循环运行一个<strong class="ka ir">。循环表明<code class="fe ma mb mc md b">movieArr</code>中的每个元素都等于一个具有<code class="fe ma mb mc md b">title</code>和<code class="fe ma mb mc md b">summary</code>属性的对象。</strong></p><p id="eb1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要得到电影片名，我们要经过<code class="fe ma mb mc md b">titlesList</code>，都是<code class="fe ma mb mc md b">h2</code>元素节点。我们应用<code class="fe ma mb mc md b">innerText</code>属性来获取<code class="fe ma mb mc md b">h2</code>的文本。然后，我们应用<code class="fe ma mb mc md b">.trim()</code>方法来删除任何空白。</p><p id="6a44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您仔细浏览过DevTools控制台，您会注意到该页面有许多没有唯一类或id的<code class="fe ma mb mc md b">p</code>元素。因此，很难准确地抓住我们需要的summary <code class="fe ma mb mc md b">p</code>元素。为了解决这个问题，我们调用了<code class="fe ma mb mc md b">h2</code>节点上的<code class="fe ma mb mc md b">.nextElementSibling</code>属性(titlesList[i])。当您仔细查看控制台时，您会看到摘要的<code class="fe ma mb mc md b">p</code>元素是标题的<code class="fe ma mb mc md b">h2</code>元素的兄弟。</p><h2 id="927e" class="mm ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">将抓取的数据存储到JSON文件中</h2><p id="11c4" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在我们已经完成了主要的数据提取部分，让我们将所有这些存储在一个JSON文件中。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="7296" class="mm ky iq md b gy mn mo l mp mq">fs.writeFile("./netflixscrape.json", JSON.stringify(movies, null, 3), (<em class="mr">err</em>) =&gt; {<br/>if (err) {<br/>console.error(err);<br/>return;<br/>};<br/>console.log("Great Success");<br/>});</span></pre><p id="0963" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">fs.writeFile()</code>创建一个新的JSON文件，包含我们的电影数据。它接受3个参数:1)要创建的文件的名称</p><p id="858a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2) <strong class="ka ir"> JSON </strong>。<strong class="ka ir"> stringify </strong>()方法将JavaScript对象转换为<strong class="ka ir"> JSON </strong>字符串。这里有三个参数。对象:<code class="fe ma mb mc md b">movies</code>、replacer(过滤掉你做的或者不想做的属性):<code class="fe ma mb mc md b">null </code>，以及space(用来在输出的JSON字符串中插入空格以增加可读性):<code class="fe ma mb mc md b">3</code>。这种方式本质上使JSON文件更漂亮、更干净。</p><p id="3b31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3) <code class="fe ma mb mc md b">err</code>，以防出错</p><p id="be0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">err</code>采用一个回调函数，声明如果有错误，console.log错误。如果没有错误，console.log“大获成功”</p><p id="6fdb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，将整个代码放在一起:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9c74" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们添加<code class="fe ma mb mc md b">browser.close()</code>来关闭木偶浏览器。我们用url调用最后一行中的<code class="fe ma mb mc md b">scrape()</code>函数。</p><h1 id="44a1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最后一步:运行scrape()函数</h1><p id="46ac" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">让我们通过在终端中键入<code class="fe ma mb mc md b">node netflixscrape.js</code>来运行这段代码。</p><p id="d4f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切顺利(这是应该的)，您将在您的控制台中获得“巨大成功”，您将看到一个新创建的JSON文件，其中包含所有网飞电影的标题和摘要。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/7679b2a4b4f6da99b1c3c7e5bd854fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8LazvNXbPlTgSCTs0n5cQ.png"/></div></div></figure><p id="5c94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你。！👏你正式成为黑客了！开玩笑的。但是现在你知道了如何从网络上获取数据并创建你自己的API，这更令人兴奋。</p><h2 id="9666" class="mm ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="db93" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae kw" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ka ir">AI in Plain English</strong></a>，<a class="ae kw" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ka ir">UX in Plain English</strong></a>，<a class="ae kw" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ka ir">Python in Plain English</strong></a><strong class="ka ir"/>——谢谢，继续学习！</p><p id="072c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kw" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">submissions @ plain English . io</strong></a><strong class="ka ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nn nl l"/></div></figure></div></div>    
</body>
</html>