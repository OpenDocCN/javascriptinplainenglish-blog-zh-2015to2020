<html>
<head>
<title>JavaScript Unit Test Best Practices — Organization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript单元测试最佳实践—组织</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-unit-test-best-practices-organization-e14240ef2582?source=collection_archive---------10-----------------------#2020-08-26">https://javascript.plainenglish.io/javascript-unit-test-best-practices-organization-e14240ef2582?source=collection_archive---------10-----------------------#2020-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/73b94edeb1b4081893f6f04366b25342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*myI0MP7wehLTcsF0"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jeshoots?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">JESHOOTS.COM</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="190d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序如何工作非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写JavaScript单元测试时应该遵循的一些最佳实践。</p><h1 id="b1da" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">精益测试设计</h1><p id="e1d3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">测试代码应该简单、简短、无抽象。</p><p id="cf87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们也应该是瘦的。</p><p id="a186" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的测试代码越简单，就越好。</p><p id="a104" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是做一些事情，然后在测试中检查结果。</p><h1 id="32fd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">每个测试名称包含3个部分</h1><p id="d010" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在每个测试名称中有3个部分。</p><p id="8feb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一部分是被测试的模块。</p><p id="622c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个是我们测试代码的环境。</p><p id="2d8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">预期的结果就是我们在测试中要检查的。</p><p id="8e6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以知道正在测试什么，并找出在失败时应该修复什么。</p><p id="a971" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6618" class="mn lc iq mj b gy mo mp l mq mr">describe('User Service', function() {<br/>  describe('Add new user', function() {<br/>    it('When no password is specified, then the product status is pending', ()=&gt; {<br/>      const user = new UserService().add(...);<br/>      expect(user.status).to.equal('pending');<br/>    });<br/>  });<br/>});</span></pre><h1 id="607a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">AAA模式的结构测试</h1><p id="fba0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该用AAA模式来组织我们的测试。</p><p id="1a41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3 A代表安排、行动和主张。</p><p id="01b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Arrange意味着添加设置代码是为了让我们进行测试。</p><p id="de53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Act正在做测试。</p><p id="e4ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">断言是在做了我们已经做的事情之后检查结果。</p><p id="f329" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="961f" class="mn lc iq mj b gy mo mp l mq mr">describe('User Service', function() {<br/>  describe('login', function() {<br/>    it('if the password is wrong, then we cannot log in', () =&gt; {<br/>      const user = new UserService().add({ username: 'james', password: '123456' });<br/>      const result = login('james', '123'); <br/>      expect(result).to.equal(false);<br/>    });<br/>  });<br/>});</span></pre><p id="3e08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们安排了第一行的测试。</p><p id="7307" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Act是对<code class="fe ms mt mu mj b">login</code>函数的调用。</p><p id="095e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">断言是<code class="fe ms mt mu mj b">expect</code>调用。</p><h1 id="eec5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用产品语言描述期望</h1><p id="d98e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该用类似人类的语言来描述测试。</p><p id="615f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">行为应该被描述，以便我们能够理解测试在做什么。</p><p id="fe7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">expect</code>或<code class="fe ms mt mu mj b">should</code>应该是人类可读的。</p><p id="0bd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6110" class="mn lc iq mj b gy mo mp l mq mr">describe('User Service', function() {<br/>  describe('Add new user', function() {<br/>    it('When no password is specified, then the product status is pending', ()=&gt; {<br/>      const user = new UserService().add(...);<br/>      expect(user.status).to.equal('pending');<br/>    });<br/>  });<br/>});</span></pre><p id="b374" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传递给<code class="fe ms mt mu mj b">describe</code>和<code class="fe ms mt mu mj b">it</code>的字符串清楚地解释了场景和测试。</p><h1 id="a743" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">只测试公共方法</h1><p id="5c25" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该只测试公共方法，这样我们就不用测试实现了。</p><p id="fbc7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不关心测试的实现。</p><p id="74dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只关心结果。</p><p id="4628" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们没有从测试中得到预期的结果时，我们应该看看它们。</p><p id="218e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是所谓的行为测试。</p><p id="9738" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们测试的是行为，不是别的。</p><p id="1b06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们不应该编写这样的代码:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9462" class="mn lc iq mj b gy mo mp l mq mr">it('should add a user to database', () =&gt; {<br/>  userManager.updateUser('james', 'password');</span><span id="ffbb" class="mn lc iq mj b gy mv mp l mq mr">  expect(userManager._users[0].name).toBe('james');<br/>  expect(userManager._users[0].password).toBe('password');<br/>});</span></pre><p id="7284" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不应该测试随时可能改变的私有变量。</p><h1 id="f113" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免嘲笑树桩和间谍</h1><p id="824d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">因为我们不能像在真实环境中那样在测试中做所有的事情，所以我们必须消除一些依赖性。</p><p id="096e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的测试不应该依赖于外界的任何东西，它们应该是孤立的。</p><p id="51d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们删除了所有会产生副作用的依赖项，这样我们就可以单独测试我们想要测试的东西。</p><p id="a00e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是存根任何网络请求代码。</p><p id="daa6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而我们看我们要检查的东西就叫做有间谍。</p><p id="c018" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，不要模仿这样的数据库:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="87ea" class="mn lc iq mj b gy mo mp l mq mr">it("should delete user", async () =&gt; {<br/>  //...<br/>  const dataAccessMock = sinon.mock(DAL);<br/>  dataAccessMock<br/>    .expects("deleteUser")<br/>    .once()<br/>    .withArgs(DBConfig, user, true, false);<br/>  new UserService().delete(user);<br/>  dataAccessMock.verify();<br/>});</span></pre><p id="d354" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们监视我们检查的函数，它是通过编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="45b2" class="mn lc iq mj b gy mo mp l mq mr">it("should delete user", async () =&gt; {<br/>  const spy = sinon.spy(Emailer.prototype, "sendEmail");<br/>  new UserService().delete(user);<br/>  expect(spy.calledOnce).to.be.true;<br/>});</span></pre><p id="9f4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们窥探了<code class="fe ms mt mu mj b">Emailer</code>构造函数的<code class="fe ms mt mu mj b">sendEmail</code>方法，检查它是否是在我们调用了<code class="fe ms mt mu mj b">UserService</code>实例的<code class="fe ms mt mu mj b">delete</code>方法之后被调用的。</p><p id="f053" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们避免用spies方法模拟任何服务器端的交互。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/68c1d868797bb33079e1d6a88bbb8e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qU9iWeo_14JGowD1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@sctgrhm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Scott Graham</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="61c8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="be76" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该用树桩和间谍来测试。</p><p id="1b34" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试应该是精简的，将我们的测试分为3个部分。</p><h2 id="8232" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="215f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> plainenglish.io </strong> </a>找到所有内容的链接！</p></div></div>    
</body>
</html>