<html>
<head>
<title>Write a Custom ESLint Plugin in 5 Easy Steps (Atomic Design)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用5个简单的步骤编写一个定制的ESLint插件(原子设计)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/writing-a-custom-eslint-plugin-in-5-easy-steps-c680ac154aaa?source=collection_archive---------7-----------------------#2020-10-28">https://javascript.plainenglish.io/writing-a-custom-eslint-plugin-in-5-easy-steps-c680ac154aaa?source=collection_archive---------7-----------------------#2020-10-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fc27e05d4a77a95d3b04c3919165a9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EkbD-1Bzvor6vrqL4svf9Q.png"/></div></div></figure><p id="8f0d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当在一个项目中提供最佳实践和代码指南时，没有执行的规则很容易在代码审查中被忽略，最终会被完全丢弃。</p><p id="54c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">强制执行项目规则的一个好方法是与林挺合作。然而，并不是每个指南都有现成的ESLint规则。这就是为什么在某些情况下，定制插件可能是你最好的解决方案。</p><p id="a516" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于本指南，我将使用原子设计作为一个例子。</p><h1 id="e058" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">1.定义您的规则</h1><p id="ef1c" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">你想解决哪个问题？</p><p id="5ce7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，我们想要实施<a class="ae lw" href="https://bradfrost.com/blog/post/atomic-web-design/" rel="noopener ugc nofollow" target="_blank">原子设计</a>。这意味着存在组件级别的层次结构，并且组件只能包括相同级别或更低级别的组件。例如，当一个原子试图包含一个分子时，ESLint应该将其标记为错误。姑且称之为<code class="fe lx ly lz ma b">hierarchical-import</code>。</p><h1 id="f3b2" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">2.安装软件包</h1><p id="0521" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">现在我们知道我们想要实现什么，我们将创建一个npm包来保存插件。包的名字应该以<code class="fe lx ly lz ma b">eslint-plugin</code>开头，所以我们的包就叫<code class="fe lx ly lz ma b">eslint-plugin-atomic-design-hierarchy</code>。</p><p id="33c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">包的入口文件(通常是index.js文件)将包含规则的实际逻辑。</p><h1 id="9c44" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">3.定义规则选项</h1><p id="8c0a" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我们希望我们的规则是灵活的，所以我们允许为规则设置一些配置参数。</p><ol class=""><li id="d55a" class="mb mc in jx b jy jz kc kd kg md kk me ko mf ks mg mh mi mj bi translated">层次:定义组件级别之间的层次</li><li id="9e2d" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">组件文件夹:定义保存组件级文件夹的文件夹的名称</li></ol><h2 id="5cb2" class="mp ku in bd kv mq mr dn kz ms mt dp ld kg mu mv lh kk mw mx ll ko my mz lp na bi translated">选项模式</h2><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">ESLint rule options schema</figcaption></figure><p id="1126" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">模式是在<a class="ae lw" href="http://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSON模式</a>中定义的输入参数数组。第一个参数是一个对象，具有附加属性(意味着没有固定的属性)。第二个参数是一个字符串。</p><h2 id="4744" class="mp ku in bd kv mq mr dn kz ms mt dp ld kg mu mv lh kk mw mx ll ko my mz lp na bi translated">规则配置</h2><p id="ceec" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">该规则在ESLint配置中配置如下。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">ESLint rule configuration</figcaption></figure><h1 id="0795" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">4.定义规则逻辑</h1><p id="884b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">编写ESLint规则比你想象的要容易。</p><p id="6453" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ESLint的工作方式是在一个节点结构中分析你的代码。每个节点都可以根据您的规则进行分析。这些节点通过一组接口公开，这些接口标识了正在被遍历的节点的类型。一些例子是变量声明、函数声明、导入声明…更多的文档可以在这里找到。</p><p id="37da" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的包的入口文件导出如下规则(示例)。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="b574" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们的规则是关于导入语句的，所以我们将使用<code class="fe lx ly lz ma b">ImportDeclaration</code>接口。函数中捕获的每个节点都将是一个导入声明。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="0281" class="mp ku in bd kv mq mr dn kz ms mt dp ld kg mu mv lh kk mw mx ll ko my mz lp na bi translated">规则状态</h2><p id="d69f" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">首先，我们定义规则的状态，这包含了规则选项的提取和默认的回退。这些选项在create函数提供的上下文中可用。</p><h2 id="30d8" class="mp ku in bd kv mq mr dn kz ms mt dp ld kg mu mv lh kk mw mx ll ko my mz lp na bi translated">节点处理程序</h2><p id="e082" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">接下来，我们为导入声明节点定义一个处理程序。对于每个节点，我们将检查导入声明所在的源文件路径，以及目标模块的导入路径。验证层次结构的逻辑被提取到一个独立的方法中，以提高可测试性。<code class="fe lx ly lz ma b">testHierarchy</code>方法将源路径、目标路径、层次结构和组件文件夹名称作为参数。当层次结构无效时，它将返回一条错误消息。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="56e2" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">5.测试你的逻辑</h1><p id="5489" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">为了确保规则按照设计的那样工作，我们将用一个单元测试来覆盖所有的导入案例。因为提取了规则的逻辑，所以我们可以很容易地为这个方法编写一些单元测试。</p><h2 id="6f1e" class="mp ku in bd kv mq mr dn kz ms mt dp ld kg mu mv lh kk mw mx ll ko my mz lp na bi translated">我们想报道的案件</h2><ol class=""><li id="df3f" class="mb mc in jx b jy lr kc ls kg nl kk nm ko nn ks mg mh mi mj bi translated">允许向下导入</li><li id="8a7b" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">允许水平导入</li><li id="475f" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">不允许向上导入</li><li id="a101" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">忽略组件文件夹外的源文件</li></ol><h2 id="64c7" class="mp ku in bd kv mq mr dn kz ms mt dp ld kg mu mv lh kk mw mx ll ko my mz lp na bi translated">最重要的是，我们希望针对不同的配置测试这些案例</h2><ol class=""><li id="ea46" class="mb mc in jx b jy lr kc ls kg nl kk nm ko nn ks mg mh mi mj bi translated">使用默认配置验证层次结构</li><li id="ba13" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">使用自定义组件文件夹验证层次结构</li><li id="5834" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">使用自定义层次结构验证层次结构</li></ol><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Example test case for default rule options</figcaption></figure><p id="8650" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你的插件已经准备好发布和分发了。但是在这之前，通过在一些测试文件上运行一个实际的ESLint配置来测试集成中的规则。</p></div><div class="ab cl no np hr nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ig ih ii ij ik"><p id="576d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">查看<a class="ae lw" href="https://www.npmjs.com/package/eslint-plugin-atomic-design-hierarchy" rel="noopener ugc nofollow" target="_blank"> npm </a>上的生产示例。</p><p id="3c3d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nv">更多内容尽在</em> <a class="ae lw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="nv">说白了. io </em> </strong> </a> <em class="nv">。报名参加我们的</em><strong class="jx io"><em class="nv"/></strong><a class="ae lw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nv">免费周报</em> </strong> </a> <em class="nv">。在我们的</em> <a class="ae lw" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="nv">社区不和谐</em> </strong> </a> <em class="nv">获得独家获取写作机会和建议。</em></p></div></div>    
</body>
</html>