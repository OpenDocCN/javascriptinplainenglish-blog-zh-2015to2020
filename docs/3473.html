<html>
<head>
<title>I Built the Same API With &amp; Without Express. Here Are the Differences.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用&amp;不用Express构建了相同的API。以下是不同之处。</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/i-built-the-same-api-with-without-express-here-are-the-differences-83bbeb7ddad?source=collection_archive---------0-----------------------#2020-10-02">https://javascript.plainenglish.io/i-built-the-same-api-with-without-express-here-are-the-differences-83bbeb7ddad?source=collection_archive---------0-----------------------#2020-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="265f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">运行了一个基准测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a3afa34a770bee6558abd5cd80e0bf20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwjbdzSkB6KnS9SCM-wx3Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: The author</figcaption></figure><p id="2801" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Express.js现在是Node.js世界的标准。如果backend想要为web开发应用程序，那么<code class="fe lr ls lt lu b">npm install express</code>是预编程的，并且已经成为我们大多数人的例行程序。</p><p id="bade" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">诚然，使用Express.js要愉快得多——当我学习Node.js时，我直接进入了Express。在这个实验之前，我可能没有写过任何没有Express.js的东西。</p><p id="ab7c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是为什么我非常渴望对Express进行测试——并以一个小API的形式用本地方法进行测试。</p><p id="8594" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以我构建了同一个API两次，一次有，一次没有Express。你可以看到下面的代码——首先是一个小提示。</p><p id="1a98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当我对这两个API进行测试时，我注意到了以下情况:<strong class="kx ir">Express应用程序的响应大约高出15%。</strong></p><p id="c49d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您想制定一个衡量服务器性能的公平基准，这当然是有问题的。<br/>不同的大小不是因为我们的响应内容，因为我们用<code class="fe lr ls lt lu b">res.end()</code>从两个服务器发送相同的内容，而是发送到标题。</p><p id="6cad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认情况下，Express.js在头中附带了一些东西，这只是表面上的——<code class="fe lr ls lt lu b">X-Powered-By</code>标签。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lv"><img src="../Images/cfaf8b354fe8fd3bdf000203a8d20153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVTQ2oCR5H5tufnSpffdGQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">X-Powered-By Express.js Tag</figcaption></figure><p id="0690" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是我们可以简单地停用它:<code class="fe lr ls lt lu b">app.disable('x-powered-by')</code></p><p id="059b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">那么不同服务器的两个响应的大小应该完全相同。让我们看一下代码。</p><p id="c1b4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">express . js API:</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="dbec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">不带Express.js的API:</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="5264" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从逻辑上讲，这两个API做的完全一样。它们只响应<em class="ly"> /api-route </em>并返回它们收到的查询参数。</p><h1 id="b4e9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">基准和结果</h1><p id="d336" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">作为基准工具，我决定使用Apache Bench。它是一个简单的命令行工具，预安装在大多数系统上(Windows除外)。</p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="4f27" class="na ma iq lu b gy nb nc l nd ne"><em class="ly">ab -n 10000 -c 100 &lt;url&gt;</em></span></pre><p id="1a52" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ly"> -n 10000 </em>是我们总共发送的请求，<em class="ly"> -c 100 </em>代表我们同时打开的连接——真正让服务器升温。</p><p id="268a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Apache Bench然后输出一些数据作为结果。最重要的列举如下。</p><ul class=""><li id="fbf6" class="nf ng iq kx b ky kz lb lc le nh li ni lm nj lq nk nl nm nn bi translated">每秒<em class="ly">请求越多</em>越好，同样适用于<em class="ly">传输速率。</em></li><li id="d737" class="nf ng iq kx b ky no lb np le nq li nr lm ns lq nk nl nm nn bi translated">每个请求的<em class="ly">时间越少越好——单个请求应该被尽可能快地处理。</em></li></ul><p id="9e92" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先我测试了原生服务器，也就是没有Express的那个。</p><p id="d058" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">基准1: </strong></p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="5fc3" class="na ma iq lu b gy nb nc l nd ne">Requests per second: 10882.52 [#/sec] (mean)<br/>Time per request: 9.189 [ms] (mean)<br/>Time per request: 0.092 [ms] (mean, across all concurrent requests)<br/>Transfer rate: 988.35 [Kbytes/sec] received</span></pre><p id="ddc2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">基准2: </strong></p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="4bf5" class="na ma iq lu b gy nb nc l nd ne">Requests per second: 10876.13 [#/sec] (mean)<br/>Time per request: 9.194 [ms] (mean)<br/>Time per request: 0.092 [ms] (mean, across all concurrent requests)<br/>Transfer rate: 987.77 [Kbytes/sec] received</span></pre><p id="0db9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">基准3: </strong></p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="a68b" class="na ma iq lu b gy nb nc l nd ne">Requests per second: 10928.75 [#/sec] (mean)<br/>Time per request: 9.150 [ms] (mean)<br/>Time per request: 0.092 [ms] (mean, across all concurrent requests)<br/>Transfer rate: 992.55 [Kbytes/sec] received</span></pre><p id="dee7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在遵循Express.js API。</p><p id="23f1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">基准1: </strong></p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="452e" class="na ma iq lu b gy nb nc l nd ne">Requests per second: 4998.91 [#/sec] (mean)<br/>Time per request: 20.004 [ms] (mean)<br/>Time per request: 0.200 [ms] (mean, across all concurrent requests)<br/>Transfer rate: 454.00 [Kbytes/sec] received</span></pre><p id="f21f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">基准2: </strong></p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="bdfd" class="na ma iq lu b gy nb nc l nd ne">Requests per second: 5076.82 [#/sec] (mean)<br/>Time per request: 19.697 [ms] (mean)<br/>Time per request: 0.197 [ms] (mean, across all concurrent requests)<br/>Transfer rate: 461.08 [Kbytes/sec] received</span></pre><p id="a6b0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">基准3: </strong></p><pre class="kg kh ki kj gt mw lu mx my aw mz bi"><span id="230d" class="na ma iq lu b gy nb nc l nd ne">Requests per second: 5249.16 [#/sec] (mean)<br/>Time per request: 19.051 [ms] (mean)<br/>Time per request: 0.191 [ms] (mean, across all concurrent requests)<br/>Transfer rate: 476.73 [Kbytes/sec] received</span></pre><p id="28b1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">服务器的纯Node.js实现，完全没有Express.js这样的框架要快很多。</p><p id="0865" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">乍一看，我简直不敢相信，我再次确保我为两台服务器创造了相同的条件。因此，我运行了很多次基准测试，但结果还是一样。</p><p id="5fa0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我在我的3B树莓派上运行了同样的基准测试——只是为了看看差异是否一样大。</p><p id="efd9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然在我的MacBook Pro上的基准测试中，本机服务器的速度几乎是两倍，但Raspberry Pi上的本机服务器仅快25%左右。</p><p id="2317" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，有一个显著的区别——在任何基准测试中，Express都无法接近简单Node.js服务器的性能。</p><p id="76e7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就我个人而言，我原本预计Express.js会慢一些，但这种差异有时并不明显。最后，Express.js走了一段弯路，构建在Node.js的HTTP模块上，我们将它用于原生服务器。</p><h1 id="0699" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">总结</h1><p id="b009" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">是不是应该从此吸取教训，再也不用Express.js了？不，绝对不是。Express.js非常棒——它使得开发后端应用程序变得非常容易。</p><p id="763b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">任何价格的性能并不总是有意义的——毕竟，Express应用程序也更容易维护，开发更快，这可以节省成本和时间。</p><p id="529f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">仅在因特网上找到的关于Express的文档和资源就有很多，并且有很好的解释。</p><p id="4c33" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在如此短的时间内向服务器发送10000个请求也是一个相当不现实的场景——当然，使用Express的响应时间也更高，但在正常情况下，这应该不会给任何人造成任何问题。</p><p id="6acf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢您的阅读！</p><p id="d085" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里有更多关于web框架性能的信息，让我们看看Fastify能做什么:</p><div class="nt nu gp gr nv nw"><a href="https://link.medium.com/X1Pc4yp4rab" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">我用Fastify，Express &amp; Bare Node.js构建了相同的API，区别如下。</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">Fastify -名字就是座右铭。至少Node.js的框架想要代表的是速度。在我们……</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">link.medium.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok kp nw"/></div></div></a></div><p id="e567" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于Express.js的更多信息:</p><div class="nt nu gp gr nv nw"><a href="https://medium.com/javascript-in-plain-english/3-express-js-features-you-need-to-know-8f78b0035f33" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">你需要知道的3个Express.js特性</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">几乎所有主要的Node.js应用程序都依赖于Express.js框架，这里有一些你应该知道的重要特性。</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">medium.com</p></div></div><div class="of l"><div class="ol l oh oi oj of ok kp nw"/></div></div></a></div><p id="cdd9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae om" href="http://eepurl.com/hacY0v" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">加入我的邮件列表保持联系</strong> </a></p></div></div>    
</body>
</html>