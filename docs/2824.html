<html>
<head>
<title>Unit testing Azure DevOps Extensions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">单元测试Azure DevOps扩展</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unit-testing-azure-devops-extensions-a1ed9ff69552?source=collection_archive---------7-----------------------#2020-07-27">https://javascript.plainenglish.io/unit-testing-azure-devops-extensions-a1ed9ff69552?source=collection_archive---------7-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1b15" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">5个挑战以及如何解决它们</h2></div><p id="f5c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的上一个项目中，我们面临着基于<a class="ae lb" href="https://developer.microsoft.com/en-us/azure-devops/develop/extensions" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> Azure DevOps基于反应的UI </strong> </a>进行单元测试的挑战。</p><p id="700c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您会发现很多关于如何利用Azure DevOps构建您的React应用程序并对其进行单元测试的资源。但是我发现关于如何对Azure DevOps扩展进行反应单元测试的信息很少。</p><p id="96a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总体而言，我们面临着<strong class="kh ir"> 5项挑战</strong>，其中4项与Azure DevOps Extensions相关:</p><ol class=""><li id="0910" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la lh li lj lk bi translated">模拟<a class="ae lb" href="https://github.com/Microsoft/azure-devops-extension-sdk" rel="noopener ugc nofollow" target="_blank">Azure DevOps extend SDK</a>方法的返回值</li><li id="4373" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">触发Azure DevOps扩展<em class="lq">工作项表单</em>事件</li><li id="3fda" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">嘲笑<a class="ae lb" href="https://github.com/Microsoft/azure-devops-extension-api" rel="noopener ugc nofollow" target="_blank"> Azure DevOps扩展API </a>的返回值和类</li><li id="7bf0" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">模拟外部Rest API调用并监视传输的值(使用扩展API提供的<em class="lq"> RestClientBase </em>类时)</li><li id="95a9" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated">嘲笑和监视日志记录方法(Application Insights SDK)</li></ol></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="abe2" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">让我们从解释这个例子开始</h1><p id="8011" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">示例代码、模型和单元测试发布到<a class="ae lb" href="https://github.com/h2floh/azure-dev-ops-react-ui-unit-testing" rel="noopener ugc nofollow" target="_blank">git hub</a><a class="ae lb" href="https://github.com/h2floh/azure-dev-ops-react-ui-unit-testing" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://git hub . com/H2 floh/azure-dev-ops-react-ui-unit testing</em></a>。</p><p id="8ca5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它包含两个工作项用户界面扩展:</p><ol class=""><li id="9abb" class="lc ld iq kh b ki kj kl km ko le ks lf kw lg la lh li lj lk bi translated"><a class="ae lb" href="https://github.com/h2floh/azure-dev-ops-react-ui-unit-testing/tree/main/src/VersionedItemsTable" rel="noopener ugc nofollow" target="_blank">版本化项目表</a>——可以将不同Azure Git repo分支的版本化项目(文件)链接到工作项目。为此，它将通过Azure DevOps服务外部的Rest API来保存状态。</li><li id="676c" class="lc ld iq kh b ki ll kl lm ko ln ks lo kw lp la lh li lj lk bi translated"><a class="ae lb" href="https://github.com/h2floh/azure-dev-ops-react-ui-unit-testing/tree/main/src/MultiIdentityPicker" rel="noopener ugc nofollow" target="_blank">多身份选择器</a> —允许您从Azure DevOps组织的关联AAD租户中选择多个身份，并将信息保存到工作项的文本字段中。</li></ol><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi mv"><img src="../Images/a0a423fb84db82b9a4334411dee55349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6NAT5A4o_gCIBxsju4BuA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">High Level Overview of the UI components and their service interactions</figcaption></figure><p id="f5d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两个组件之间的主要区别在于，一个将在外部保存状态，另一个将在内部保存到Azure DevOps Services。</p><p id="7ca8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两者的共同之处在于，它们将使用基于TypeScript的Azure DevOps Extension SDK和API与Azure DevOps服务通信，并记录基于Azure的应用洞察。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="9c14" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">好的，让我们看看这5个挑战以及如何解决它们</h1><p id="efc9" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated"><strong class="kh ir">免责声明:</strong>为了突出重要的部分，我重新排序并删除了截图的一些代码。</p><h2 id="e39e" class="nl lz iq bd ma nm nn dn me no np dp mi ko nq nr mk ks ns nt mm kw nu nv mo nw bi translated">模拟<a class="ae lb" href="https://github.com/Microsoft/azure-devops-extension-sdk" rel="noopener ugc nofollow" target="_blank"> Azure DevOps扩展SDK </a>方法的返回值</h2><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nx"><img src="../Images/549851779f5200059a8bf9c5a3dc55bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*So2ivoQxlq3OZ_iP3CQ7Sw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Azure DevOps Extension SDK initialization code</figcaption></figure><p id="0c9b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">代码:</em> SDK必须被初始化，我们从其中检索配置值。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ny"><img src="../Images/1a2882f1fde1e77ca2d80aaba3b8ca7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TsTopX08zNjbB6y-SrdclA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Azure DevOps Extension SDK initialization mock</figcaption></figure><p id="9c0c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">mock:</em><strong class="kh ir">SDK . init()</strong>函数需要返回一个已解析的承诺，以便激活<strong class="kh ir">中的lambda函数。然后是()</strong>分支的代码。</p><p id="d3b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> getConfiguration() </strong>函数可以很容易地通过返回一个具有我们期望的精确结构的JSON对象来模仿。我们一次添加了两个UI组件的所有配置值。</p><p id="9444" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">如果您需要在测试运行中修改特定的值</strong>,您可以创建一个额外的函数mock，该函数可被访问以覆盖您的测试文件中的返回值。在本例中，我们通过引入一个模拟函数<strong class="kh ir"> mockRepositoryId() </strong>，为默认值为<em class="lq">‘gitrepo’</em>的<em class="lq"> RepositoryId </em>执行此操作。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nz"><img src="../Images/3c9ba9a0357424063d49786d0aed25f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*olBn0k09BNa94Xe1fiFJaA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Retrieving a field value</figcaption></figure><p id="246b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">代码:</em>我们用函数<strong class="kh ir"> getService()从服务中检索<em class="lq">工作项。使用此服务，我们可以访问和修改UI中打开的当前工作项。我们希望检索指定字段的值，以保存该组件的状态。这是通过方法<strong class="kh ir"> getFieldValue()完成的。</strong></em></strong></p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi oa"><img src="../Images/41ab588137dd8c632b639eb37f112c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDiN3QKGgK5MIYKUwXmRww.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Mocking getService, WorkItemFormService and SearchIdentities</figcaption></figure><p id="23cc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">模拟:</em>正如你所看到的，我们需要从<strong class="kh ir"> getService() </strong>返回两个不同的服务，这取决于输入参数。如果请求W <em class="lq">或kItemFormService </em>，我们只需返回<strong class="kh ir"> getFieldValue() </strong>方法作为模拟函数<strong class="kh ir"> mockGetFieldValue() </strong>。这允许我们在单元测试级别注入返回值。在这种情况下，我们不区分需要什么字段。如果你需要的话，因为你正在访问几个字段，你需要为<strong class="kh ir"> mockGetFieldValue() </strong>创建一个实现，它将对不同的输入参数做出反应。</p><p id="eb02" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为如何对输入参数做出反应的例子，你可以看看<em class="lq"> IdentityService </em>的被模仿的<strong class="kh ir">searchdidentitieasync()</strong>方法。根据查询值，我们返回另一个标识。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ob"><img src="../Images/85e626f3f81639a5980a26d47c2ef263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjuFQO6coCxLWAA0dAJQpA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">The related test requiring getService(), getFieldValue() and searchIdentitiesAsync()</figcaption></figure><p id="fa07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">测试:</em>测试定义了<strong class="kh ir"> getFieldValue() </strong>的返回值，并期望控件显示与电子邮件地址相关联的名称。电子邮件和显示名称之间的映射发生在已经模仿过的<strong class="kh ir">searchdidentitasync()</strong>方法中。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="449a" class="nl lz iq bd ma nm nn dn me no np dp mi ko nq nr mk ks ns nt mm kw nu nv mo nw bi translated">触发Azure DevOps扩展<em class="oc"> WorkItemForm </em>事件</h2><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi od"><img src="../Images/b54dca85e8b00aaf23f0563ca53e07be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFDaYzo9H0cTgM2E_Ds1rw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Register onSaved event callback function</figcaption></figure><p id="12ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">代码:</em>当您开发一个工作项UI控件时，您可以从工作项UI中挂接事件，如保存、更改工作项状态等。控件将对<strong class="kh ir"> onSaved() </strong>事件做出反应，并向SDK注册它的回调。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi oe"><img src="../Images/8ae226939ff91be5306448b48bab4434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elZu5YBmg-G2d7Hn06-TSg.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Mocking the event callback system</figcaption></figure><p id="e727" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于这个模拟，我们必须找出SDKs <strong class="kh ir"> register() </strong>函数所期望的返回值的确切类型。正如你在截图中看到的，返回值将被分配给被模仿的<strong class="kh ir"> register() </strong>函数中的<strong class="kh ir"> spyWorkItemCallBack </strong>函数指针。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi of"><img src="../Images/b980321649075951ab3bc9bbe5e4bc39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWky2JZEChMmjG0tstTDNw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Testing onSaved event</figcaption></figure><p id="b0ce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">测试:</em>现在我们可以通过调用<strong class="kh ir"> spyWorkItemCallBack </strong>函数指针来触发测试中控件注册的回调函数。</p><p id="e00a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于所有其他5个可能订阅的事件挂钩，这将以相同的方式工作。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="3f31" class="nl lz iq bd ma nm nn dn me no np dp mi ko nq nr mk ks ns nt mm kw nu nv mo nw bi translated">模仿<a class="ae lb" href="https://github.com/Microsoft/azure-devops-extension-api" rel="noopener ugc nofollow" target="_blank"> Azure DevOps扩展API </a>的返回值和类</h2><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi og"><img src="../Images/2aa8cabdb1b78e1a404dbc71523d1131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cm44DLRf49ZnVbptfURjAQ.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Using Azure DevOps Extension API Git Rest Service</figcaption></figure><p id="89e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码:其中一个扩展通过使用Azure DevOps扩展APIs Git客户端加载Azure Git repo的所有项目。扩展只使用了这个类的<strong class="kh ir"> getItems() </strong>方法。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi oh"><img src="../Images/4e71345ea8dd8b1df42c4ecc2c40a8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tX5xzQl8Ij_T9wDR5eOkXg.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">The mock for the Azure Repo Git Rest Client</figcaption></figure><p id="c053" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">mock:</em>仅包含<strong class="kh ir"> getItems() </strong>方法，如果<em class="lq"> RepositoryId </em>已知，将返回<strong class="kh ir"> mockGetItems </strong>函数的值，否则将返回一个错误(用于错误测试)。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi oi"><img src="../Images/7a557ca3d7eb5f1902ca533ed5b654e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xw0WDobQkZgflLYmUa0WBA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Mocked getClient function of Extension API package</figcaption></figure><p id="34f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了检索API客户端，有一个<strong class="kh ir"> getClient() </strong>函数也必须被模拟，以返回正确的模拟实现。如果你使用一个额外的API，你必须把它包括在这个列表中。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi oj"><img src="../Images/27b5a7f5706e364aedd8b7aab55d5767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m5P1HGrhw5ZBHf3U_Lfnyg.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Defining the return value of Git Service getItems() method</figcaption></figure><p id="e01b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">测试:</em>在您的测试中，您现在可以在通过访问器模拟函数<strong class="kh ir"> mockGetItems </strong>调用之前指定<strong class="kh ir"> getItems() </strong>的返回值。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="f97b" class="nl lz iq bd ma nm nn dn me no np dp mi ko nq nr mk ks ns nt mm kw nu nv mo nw bi translated">模拟外部Rest API调用，并窥探传输的值</h2><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ok"><img src="../Images/a1a38009e7e0773b07f1bf62d194b22a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVIaEiIWaFbFAyj185D4mA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Custom API Client on top of Azure DevOps Extension API Base Rest Client</figcaption></figure><p id="b0ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">代码:</em>为了访问我们自己的API，我们继承了扩展API的<strong class="kh ir"> RestClientBase </strong>类。我们主要利用它提供的<strong class="kh ir"> _issueRequest() </strong>方法及其数据结构来处理http请求。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ol"><img src="../Images/61d4b576f9221b9bf8bfc93c6af53821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mVKrBG60XbmGppQHiiaMg.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Mocking the Extension API RestBaseClient</figcaption></figure><p id="126b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">模仿:</em>我们模仿基类来支持我们自己的客户端，以真正测试我们的rest客户端代码。</p><p id="306f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">被模仿的基类现在可以按需抛出错误，返回我们在测试级别为特定API调用设置的值(由method和endpointURL评估),甚至记录请求值，如POST调用情况下的测试验证的body和headers。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi om"><img src="../Images/ee4d68e72e45bddc7d020916feaffa65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wrJkKT6PfwfjZdJh4a27PQ.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Validation of Rest API POST request.</figcaption></figure><p id="446f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">测试:</em>我们现在可以在测试中验证成功的POST以及数据传输是否正确。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="8d29" class="nl lz iq bd ma nm nn dn me no np dp mi ko nq nr mk ks ns nt mm kw nu nv mo nw bi translated">模仿和窥探日志记录方法(应用洞察SDK)</h2><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi on"><img src="../Images/2493d5091d5b58aa2e82816b2ffd18e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3vGGP_TpsqEOhgY75lq9cw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Exception handling and logging</figcaption></figure><p id="452f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">代码:</em>我们使用自己的日志记录器实现对应用洞察记录异常和其他信息。在这里，我们记录了与Git Rest客户端通信时发生的任何异常。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/5c5a8f568dc655852f07b803f41dfae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*OQprD4e0PbRKLS-kPCoEuQ.png"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Mock for ApplicationInsights package</figcaption></figure><p id="5bf8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">模仿:</em>我们模仿<strong class="kh ir"> ApplicationInsights </strong>包中的方法<strong class="kh ir"> trackException() </strong>，并将该异常作为参数传递给<strong class="kh ir"> mockTrackException </strong>函数。</p><p id="a0ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过这种方式，我们可以验证记录的异常内容，也可以为我们的记录器实现提供完整的代码覆盖。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi op"><img src="../Images/30a60a7af9e55ec8a50e49d871279e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wbZTLGP_bYWllxCDI8Uy1A.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Testing error handling</figcaption></figure><p id="0921" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lq">测试:</em>我们可以为被模仿的Git <strong class="kh ir"> getItems() </strong>方法触发一个异常，并验证该异常是否被记录以及记录的内容是否正确。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="bf01" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论</h1><p id="3480" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">这需要一些努力，但模仿Azure DevOps扩展SDK和API的所有相关部分来成功创建有意义的单元测试并达到完整的代码覆盖是可能的。</p><p id="e07f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以派生出回购协议，用真实的扩展交换示例扩展，并利用现有的模拟作为起点。根据你使用的SDK / API特性，你必须扩展模拟部分，当然还有你的测试。</p><p id="7404" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读，祝测试愉快！</p><p id="0681" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://github.com/h2floh/azure-dev-ops-react-ui-unit-testing" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://github . com/H2 floh/azure-dev-ops-react-ui-unit-testing</em></a></p></div></div>    
</body>
</html>