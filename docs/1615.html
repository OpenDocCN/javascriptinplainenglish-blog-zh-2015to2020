<html>
<head>
<title>Firebase Authentication with Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firestore的Firebase认证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/firebase-authentication-with-firestore-database-78e6e4f348c6?source=collection_archive---------1-----------------------#2020-04-07">https://javascript.plainenglish.io/firebase-authentication-with-firestore-database-78e6e4f348c6?source=collection_archive---------1-----------------------#2020-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c718" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在云Firestore中认证用户并创建相应的文档。</h2></div><p id="bf8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我最近构建一个react-native应用程序时，我决定使用<a class="ae lb" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Google的Firebase云基础设施</a>来简化诸如身份验证、数据库管理、云功能等事情。在浏览了许多不同的视频教程，阅读了不同的文章和堆栈溢出问题之后，我努力寻找一个简单的例子来说明如何在Firebase Firestore中正确使用Firebase身份验证(用户名/密码和社交信息)。我决定写一篇简单的中型文章可能会帮助其他人在同一旅程。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/aa518a8de423672eda83132904a5e30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*deNN2LjBpbTHaNo9"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Firebase Service offering logos (src: firebase.google.com)</figcaption></figure><p id="ccdd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们进入细节之前，关于这篇文章，有两个关键点我想讲一下:<br/> 1 .我假设你知道如何编码或解释代码，我不会从头开始建立一个项目，但会使用JavaScript来演示我是如何做的(用一些伪代码截图)</p><p id="7e42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.因为Firebase的设计提供了惊人的灵活性，所以我将提供我考虑过的两种方法。如果你有任何其他方法，请在评论中提供细节，我会把它们添加到本文中。</p><p id="1c3c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">让我们开始<br/> </strong>场景:我们想建立一个应用程序，作为应用程序的一部分，我们想使用firebase auth验证用户，在用户成功创建后，我们想在Firestore的“用户”集合中创建一个用户记录。我们已经通读了所有的Firebase的Auth文档，并且非常清楚如何“创建”一个新用户。<br/>我们也通读了<a class="ae lb" href="https://firebase.google.com/docs/firestore" rel="noopener ugc nofollow" target="_blank"> Firestore文档</a>，并且知道如何创建新的收藏和存储新的文档——我们似乎不知道何时将两者结合在一起(我遇到的问题)。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lo"><img src="../Images/1f71085fd14bce5c90b7c3e71156cd71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QPLV8rIxydAKLnaO.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">A lot of ways to use Authentication — we focus on email/password &amp; google signin (src: firebase.google.com)</figcaption></figure><p id="fdd3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是对我有效的两种方法:</p><p id="5090" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">选项1: </strong>当使用“<em class="lt">createUserWithEmailAndPassword()</em>”或使用社交登录注册新用户时，当我们知道已在firebase auth中成功创建用户时，我们将使用该参考在firestore的“用户”集合中创建用户。</p><p id="70eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用用户名和密码注册</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">signing up a user with email and password, on success creating a user document in cloud firestore</figcaption></figure><p id="2c6e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">社交认证——Google<br/>使用Google(或任何其他认证提供商，如脸书、Twitter、GitHub)时，情况会有所不同，因为注册和登录的过程是相同的，即用户点击登录按钮，我们会去一个提供商那里验证用户的详细信息。如果用户是新的，我们让他们注册，如果他们不是新的，我们让他们登录。<br/>在这种情况下，我们需要先在firestore中做一个简单的检查，看看“用户”集合下是否已经存在一个文档，如果是，什么也不做，如果不是，创建一个新的用户文档。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">facilitating google sign in and then storing details in a user document in cloud firestore.</figcaption></figure><p id="79b1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">选项2: </strong>使用云功能将用户添加到“用户”集合。Firebase Cloud functions提供了onCreate函数，可用于检测在firebase auth中创建新用户的时间。一旦触发，我们可以使用用户引用和提供的数据在“用户”文档中创建用户。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">creating firestore user document using a cloud function</figcaption></figure><p id="0d9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在你有两种方法可以在firebase auth中创建帐户，然后在cloud firestore中创建相应的文档。就个人而言，因为从客户端前端创建文档的开销较低，所以我倾向于选择选项1而不是选项2——但是，我相信两者都可行。如果你觉得有更好的方法，我很乐意在评论中听到你的方法。</p><p id="cba6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我希望这篇文章有所帮助，引导人们朝着正确的方向前进。</p><p id="60e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">用简单的英语来自JavaScript的一个提示:</strong>我们总是对帮助推广高质量的内容感兴趣。如果你有一篇文章想用简单的英语提交给JavaScript，用你的中级用户名发邮件到<a class="ae lb" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>给我们，我们会把你添加为作者。</p></div></div>    
</body>
</html>