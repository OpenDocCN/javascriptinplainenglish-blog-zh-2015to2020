<html>
<head>
<title>React Tips — Form Data, Refs, and Calling useEffect on Mount</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应提示—表单数据、引用和调用装载时的使用效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-tips-form-data-refs-and-calling-useeffect-on-mount-fa8fcc359f20?source=collection_archive---------4-----------------------#2020-07-19">https://javascript.plainenglish.io/react-tips-form-data-refs-and-calling-useeffect-on-mount-fa8fcc359f20?source=collection_archive---------4-----------------------#2020-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7a19f0ea28fbf249e20cf08aede3bba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1pD6stLNghUQ6Ifm"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@kristinbrownphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kristin Brown</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="23f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的React应用程序的技巧。</p><h1 id="6b5e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在React中获取表单数据</h1><p id="896b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要获取表单数据，我们可以通过不受控制的输入直接获取表单元素。</p><p id="7b49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者我们可以创建受控输入并设置每个字段的状态。</p><p id="f710" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以得到场的状态。</p><p id="23d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="59a7" class="mn lc iq mj b gy mo mp l mq mr">class LoginForm extends React.Component {<br/>  constructor(){<br/>    this.state = {}<br/>  }</span><span id="8836" class="mn lc iq mj b gy ms mp l mq mr">  handleEmailChange(e) {<br/>     this.setState({email: e.target.value});<br/>  },</span><span id="291f" class="mn lc iq mj b gy ms mp l mq mr">  handlePasswordChange(e) {<br/>    this.setState({password: e.target.value});<br/>  },</span><span id="06b7" class="mn lc iq mj b gy ms mp l mq mr">  handleLogin() {<br/>    console.log(this.state);<br/>  }</span><span id="ed29" class="mn lc iq mj b gy ms mp l mq mr">  render() {<br/>    return (<br/>      &lt;form&gt;<br/>        &lt;input type="text" name="email" placeholder="Email" value={this.state.email} onChange={this.handleEmailChange} /&gt;<br/>        &lt;input type="password" name="password" placeholder="Password" value={this.state.password} onChange={this.handlePasswordChange}/&gt;<br/>        &lt;button type="button" onClick={this.handleLogin}&gt;Login&lt;/button&gt;<br/>      &lt;/form&gt;);<br/>    }<br/>  }<br/>}</span></pre><p id="e98f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了一个带有表单的<code class="fe mt mu mv mj b">LoginForm</code>组件，让我们输入电子邮件和密码。</p><p id="17b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将每个表单的<code class="fe mt mu mv mj b">value</code>道具设置为state。</p><p id="6418" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe mt mu mv mj b">onChange</code>属性设置为处理函数，用最新输入的值更新状态。</p><p id="0b84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们点击登录按钮时，<code class="fe mt mu mv mj b">handleLogin</code>运行并记录状态。</p><p id="c401" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要获得未受控输入的值，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="309e" class="mn lc iq mj b gy mo mp l mq mr">class LoginForm extends React.Component {</span><span id="3be8" class="mn lc iq mj b gy ms mp l mq mr">  constructor(props) {<br/>    super(props);<br/>    this.handleSubmit = this.handleSubmit.bind(this);<br/>  }</span><span id="839d" class="mn lc iq mj b gy ms mp l mq mr">  handleSubmit(e) {<br/>    e.preventDefault();<br/>    <br/>    const formData = new FormData(e.target)<br/>    const user = {}<br/>    for (const entry of formData.entries()) {<br/>      console.log(entry);<br/>    }<br/>  }</span><span id="6f39" class="mn lc iq mj b gy ms mp l mq mr">  render() {<br/>    return (<br/>        &lt;div&gt;<br/>          &lt;form onSubmit={this.handleSubmit}&gt;<br/>            &lt;input type='text' name="phone"/&gt;<br/>            &lt;input type='password' name="email"/&gt;<br/>            &lt;input type="submit" value="Submit"/&gt;<br/>          &lt;/form&gt;<br/>        &lt;/div&gt;<br/>    );<br/>  }<br/>}</span></pre><p id="2eb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一些没有<code class="fe mt mu mv mj b">value</code>或<code class="fe mt mu mv mj b">onChange</code>道具的输入来获取和设置状态。</p><p id="e1c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着它们是不受控制的输入。</p><p id="1588" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们单击Submit按钮提交表单时，我们将整个表单放在<code class="fe mt mu mv mj b">FormData</code>构造函数中来填充表单数据。</p><p id="d0a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe mt mu mv mj b">formData.entries()</code>遍历条目。</p><h1 id="d406" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在React中访问DOM元素</h1><p id="9805" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">React中document.getElementById()的等价物是设置引用。</p><p id="9864" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe mt mu mv mj b">createRef</code>方法创建一个ref并将其分配给一个元素。</p><p id="2abc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b645" class="mn lc iq mj b gy mo mp l mq mr">class Foo extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.myRef = React.createRef();<br/>  }<br/>  render() {<br/>    return &lt;div ref={this.myRef} /&gt;;<br/>  }<br/>}</span></pre><p id="8262" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe mt mu mv mj b">React.createRef</code>来创建ref。</p><p id="73c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将它分配给带有<code class="fe mt mu mv mj b">ref</code>属性的div。</p><p id="a456" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以用以下方式获得div节点:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2220" class="mn lc iq mj b gy mo mp l mq mr">const node = this.myRef.current;</span></pre><p id="99fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于功能组件，我们可以使用<code class="fe mt mu mv mj b">useRef</code>钩子。</p><p id="c392" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们需要访问子组件的方法，那么我们用<code class="fe mt mu mv mj b">React.forwardRef</code>方法创建子组件。</p><p id="7f72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7a17" class="mn lc iq mj b gy mo mp l mq mr">const Foo = React.forwardRef((props, ref) =&gt; {<br/>  return &lt;div ref={ref}&gt;foo&lt;/div&gt; <br/>});</span><span id="c44a" class="mn lc iq mj b gy ms mp l mq mr">const Bar = React.forwardRef((props, ref) =&gt; {<br/>  const handleClick = () =&gt; {};<br/>  useImperativeHandle(ref,() =&gt; ({<br/>    handleClick<br/>  }))<br/>  return &lt;div&gt;bar&lt;/div&gt; <br/>});</span><span id="1621" class="mn lc iq mj b gy ms mp l mq mr">const App = () =&gt; {<br/>  const foo = useRef(null);<br/>  const bar = useRef(null);</span><span id="c6fa" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>      &lt;&gt;<br/>         &lt;Foo ref={foo} /&gt;<br/>         &lt;Bar ref={bar} /&gt;<br/>      &lt;/&gt;<br/>    )<br/>}</span></pre><p id="b31a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在接受<code class="fe mt mu mv mj b">props</code>和<code class="fe mt mu mv mj b">ref</code>参数的回调中创建组件代码。</p><p id="69b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">props</code>有道具，<code class="fe mt mu mv mj b">ref</code>有裁判。</p><p id="9ada" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">方法放在我们在<code class="fe mt mu mv mj b">userImperativeHandle</code>钩子的回调中返回的对象中。</p><p id="8a92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将<code class="fe mt mu mv mj b">ref</code>分配给我们想要的元素。</p><p id="0752" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在父组件<code class="fe mt mu mv mj b">App</code>中创建带有<code class="fe mt mu mv mj b">useRef</code>钩子的引用。</p><p id="2f47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将引用分配给组件。</p><h1 id="09f7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">仅调用一次React useEffect加载函数</h1><p id="62b5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们想调用一次<code class="fe mt mu mv mj b">useEffect</code>钩子的回调函数，我们可以传入一个空数组作为它的第二个参数。</p><p id="22c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cd5f" class="mn lc iq mj b gy mo mp l mq mr">const useMountEffect = (fun) =&gt; useEffect(fun, [])</span><span id="9820" class="mn lc iq mj b gy ms mp l mq mr">function Foo() {<br/>  useMountEffect(() =&gt; console.log('hello')) <br/>  return &lt;div&gt;foo&lt;/div&gt;;<br/>}</span></pre><p id="bbc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了自己的<code class="fe mt mu mv mj b">useMountEffect</code>钩子，它返回<code class="fe mt mu mv mj b">useEffect</code>钩子，回调作为第一个参数，空数组作为第二个参数。</p><p id="7ccb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在<code class="fe mt mu mv mj b">Foo</code>组件中使用它，并传入回调。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/7af97b8dade16cacbd49e2282afb3a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xF86PE58rSplES9Z"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@davide_pietralunga?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Davide Pietralunga</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="884c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="6229" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以为元件和元素指定参照。</p><p id="0b53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用同样的方法处理类组件。</p><p id="d493" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们必须使用带有功能组件的<code class="fe mt mu mv mj b">forwardRef</code>。</p><p id="bd6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们将一个空数组作为它的第二个参数传入，可以让它只调用一次。</p><p id="04f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据输入是否受控，有多种方法可以获取表单数据值。</p><h2 id="d57a" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="af1d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>