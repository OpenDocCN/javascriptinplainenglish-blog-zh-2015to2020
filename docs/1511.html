<html>
<head>
<title>Build and Deploy a GraphQL API to AWS with Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器为AWS构建和部署一个GraphQL API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-and-deploy-a-graphql-api-to-aws-with-serverless-635c1345d432?source=collection_archive---------8-----------------------#2020-03-25">https://javascript.plainenglish.io/build-and-deploy-a-graphql-api-to-aws-with-serverless-635c1345d432?source=collection_archive---------8-----------------------#2020-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e15f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在几分钟内构建一个GraphQL API并将其部署到AWS上</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/85193ff3a50057e32128be428ae06c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nUCmHsdFtXmi8SfG"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@pixeldan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniel Abadia</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="e6b0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="a649" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">功能即服务(FaaS)在过去几年变得非常流行，因为它很简单。只需几行代码，我们就可以启动并运行应用程序，而不必担心基础设施。此外，您只需为消耗的资源付费，这样可以降低成本。这使得FaaS成为您可能只需要定期运行一小段时间的任何功能的完美候选。例如，我们公司每天早上都用它来生成销售报告。</p><p id="b48a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，我将向您展示如何使用<a class="ae kv" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器</a>快速构建GraphQL API并部署到AWS。</p><p id="d6ad" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您可以在这里找到本教程的代码:</p><div class="mp mq gp gr mr ms"><a href="https://github.com/kluu1/serverless-orders-api" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">kluu1/无服务器-订单-api</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">如何在几分钟内使用无服务器构建和部署graph QL API—kluu1/无服务器订单API</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kp ms"/></div></div></a></div><h1 id="c091" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">先决条件</h1><ul class=""><li id="77ae" class="nh ni iq lq b lr ls lu lv lx nj mb nk mf nl mj nm nn no np bi translated">有权访问IAM和Lambda的AWS帐户</li><li id="f916" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated"><a class="ae kv" href="https://serverless.com/framework/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">安装在您机器上的无服务器</a></li><li id="5eee" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated"><a class="ae kv" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a> v8.x或更高版本</li><li id="42b1" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">git v 2 . 14 . 1或更高版本</li></ul><h1 id="3639" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">创建GraphQL服务器</h1><p id="23d9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将从使用<a class="ae kv" href="https://www.apollographql.com/" rel="noopener ugc nofollow" target="_blank"> Apollo GraphQL </a>创建GraphQL服务器开始。让我们创建一个新的项目目录并安装一些包。</p><pre class="kg kh ki kj gt nv nw nx ny aw nz bi"><span id="ee3c" class="oa kx iq nw b gy ob oc l od oe">mkdir serverless-orders-api &amp;&amp; cd serverless-orders-api<br/>git init<br/>npm init -y<br/>npm install apollo-server-lambda<br/>npm install -D serverless-offline</span></pre><p id="c84f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们正在安装<code class="fe of og oh nw b">serverless-offline</code>作为开发依赖，以帮助我们在本地开发和测试我们的应用程序。</p><h2 id="73f9" class="oa kx iq bd ky oi oj dn lc ok ol dp lg lx om on li mb oo op lk mf oq or lm os bi translated">设置GraphQL处理程序</h2><p id="0aa5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在您喜欢的源代码编辑器中打开项目，并修改<code class="fe of og oh nw b">handler.js</code>文件，使其看起来像下面的代码。我们将解析器和模式导入到这个文件中，以创建一个新的Apollo服务器。然后我们将其导出为GraphQL处理程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">/handler.js</figcaption></figure><h2 id="cac3" class="oa kx iq bd ky oi oj dn lc ok ol dp lg lx om on li mb oo op lk mf oq or lm os bi translated">设置模式</h2><p id="213e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">模式文件定义了数据的外观和类型。它还公开了我们可用的查询，在本例中只是<em class="ov"> getOrders </em>。在项目根目录下名为<code class="fe of og oh nw b">graphql</code>的新文件夹中创建<code class="fe of og oh nw b">schema.js</code>文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">/graphql/schema.js</figcaption></figure><h2 id="fee9" class="oa kx iq bd ky oi oj dn lc ok ol dp lg lx om on li mb oo op lk mf oq or lm os bi translated">设置解析器</h2><p id="b5fc" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Resolvers提供了关于如何处理GraphQL查询和返回数据的说明。在<code class="fe of og oh nw b">graphql</code>文件夹中创建<code class="fe of og oh nw b">resolvers.js</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">/graphql/resolver.js</figcaption></figure><p id="1427" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是您通常会调用某个数据库来获取数据的地方。然后你会按摩数据返回它。为了使本教程简单，我们只是返回一些静态数据。</p><h2 id="9eb0" class="oa kx iq bd ky oi oj dn lc ok ol dp lg lx om on li mb oo op lk mf oq or lm os bi translated">安装severless.yml文件</h2><p id="52db" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">修改<code class="fe of og oh nw b">serverless.yml</code>文件，如下所示。注意，我们添加了<code class="fe of og oh nw b">serverless-offline</code>插件，这样我们可以在部署到AWS之前在本地测试我们的应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">/serverless.yml</figcaption></figure><h1 id="4820" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">本地测试</h1><p id="337b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在我们已经准备好了所有的部分，让我们在本地测试我们的GraphQL API服务器。从终端，在项目根目录下运行以下命令。</p><pre class="kg kh ki kj gt nv nw nx ny aw nz bi"><span id="9b8d" class="oa kx iq nw b gy ob oc l od oe">serverless offline</span></pre><p id="69c4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在您的浏览器中访问<a class="ae kv" href="http://localhost:3000/dev/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/dev/graph QL</a>并测试我们的查询。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/ecf01c63aa71be3b39dbce4e0dba4f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39bsJtv9ykUdYcBkLfpRDQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Testing our getOrders query locally</figcaption></figure><h1 id="6a04" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">部署到AWS</h1><p id="71a4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要部署到AWS，您需要有一个能够访问IAM和Lambda的AWS帐户。如果您在设置AWS凭证方面需要帮助，请参见此<a class="ae kv" href="https://serverless.com/framework/docs/providers/aws/guide/credentials/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="a2ab" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">部署到AWS就像运行一个命令<code class="fe of og oh nw b">serverless deploy</code>一样简单。在幕后，无服务器框架完成了设置基础设施的所有繁重工作。</p><pre class="kg kh ki kj gt nv nw nx ny aw nz bi"><span id="bb05" class="oa kx iq nw b gy ob oc l od oe">serverless deploy</span></pre><p id="6ebc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果一切顺利，您将看到类似于下图的输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/ea7ed97fac74f6666069a297e53044d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MabYI9U37Kb5Lh6v8LvhiA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Example of a successful deployment</figcaption></figure><p id="233e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们在Postman中测试新创建的AWS端点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/abb808360426d1f4426b8a98b34b676e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ON6hIg9xeNsrR9wR05nEmw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Testing our deployed application</figcaption></figure><p id="e157" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您需要从AWS中删除应用程序，只需运行<code class="fe of og oh nw b">serverless remove</code>，无服务器框架将为您删除并清理所有内容。</p><h1 id="232f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">摘要</h1><p id="d4b1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在本文中，我们介绍了如何使用无服务器设置GraphQL API。我们讲述了如何在本地开发和测试我们的应用程序。我们还见证了使用无服务器部署到AWS是多么容易。如果您想了解更多关于Severless及其功能的信息，我强烈推荐您通读他们的文档。</p><div class="mp mq gp gr mr ms"><a href="https://serverless.com/framework/docs/" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">无服务器框架文档</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">无服务器框架可以帮助你用更少的开销和成本构建无服务器应用。它提供了强大的…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">serverless.com</p></div></div><div class="nb l"><div class="oz l nd ne nf nb ng kp ms"/></div></div></a></div><p id="8e40" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">希望你喜欢这篇文章，对你有帮助！干杯！🍻</p><p id="225f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我在业余时间写这些文章是为了消遣。如果你喜欢这篇文章，请在下面留下你的喜欢和评论！可以关注我上 <a class="ae kv" href="https://medium.com/@this.kevinluu" rel="noopener"> <em class="ov">中</em> </a> <em class="ov">和</em> <a class="ae kv" href="https://twitter.com/kluu_10" rel="noopener ugc nofollow" target="_blank"> <em class="ov">推特</em> </a> <em class="ov">。感谢支持！</em></p><h2 id="e192" class="oa kx iq bd ky oi oj dn lc ok ol dp lg lx om on li mb oo op lk mf oq or lm os bi translated"><strong class="ak">用简单英语写的JavaScript的注释:</strong></h2><p id="1fc5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，用你的中级用户名发邮件到<a class="ae kv" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>给我们，我们会把你添加为作者。</p></div></div>    
</body>
</html>