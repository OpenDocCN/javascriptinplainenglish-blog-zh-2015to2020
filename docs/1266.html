<html>
<head>
<title>How to E2E Test Your Application With Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Cypress对你的应用程序进行E2E测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-e2e-test-your-application-with-cypress-162f4bafe376?source=collection_archive---------0-----------------------#2020-02-21">https://javascript.plainenglish.io/how-to-e2e-test-your-application-with-cypress-162f4bafe376?source=collection_archive---------0-----------------------#2020-02-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9248" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">无硒一体化测试框架</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ba3817bc64b538271adcf5d10aee956d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61Y2j7QtQhM9ZLdeNOamvw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.webtips.dev/how-to-e2e-test-your-application-with-cypress"><div class="gh gi kr"><img src="../Images/c19cb3069af1beba3c93258d9fcfe139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*-PVzecNs3s4ZbJsdsgIsGA.png"/></div></a></figure><p id="3116" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您已经完成了所有工作，您的应用程序已经准备好最终投入生产。然而，你还没有完成。测试即将开始。</p><p id="b16e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果我说测试是开发人员中最讨厌的部分，我可能比我相信的更接近事实。但这是开发周期中必不可少的一部分。为了让您的应用程序防弹防错，您需要有一个测试套件。</p><p id="1b97" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">你可以从编写尽可能多的<a class="ae lo" href="https://www.webtips.dev/writing-your-very-first-unit-test-with-jest" rel="noopener ugc nofollow" target="_blank">单元测试</a>开始，以增加代码覆盖率。但是之后呢？难道不应该对整个用户流量进行端到端的测试吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lp"><img src="../Images/471712cd1379ccad7fa59116f17bf68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aImD67T2Fjrqd8ZY5WnpxQ.png"/></div></div></figure><p id="6f75" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这就是E2E测试发挥作用的地方。这次我想给大家介绍一下<a class="ae lo" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>，一体化E2E测试框架。</p><p id="80b6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在本教程结束时，您应该能够编写自己的测试用例，并充分发挥Cypress的潜力。我们将研究如何设置一切，Cypress是如何构建的，以及我们如何使用它来创建基本的用户场景。因此，让我们首先将Cypress引入我们的项目并设置好一切。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="0007" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">树立柏树</h1><p id="e5a4" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">首先也是最重要的，你需要用<code class="fe mu mv mw mx b"><a class="ae lo" href="https://www.npmjs.com/package/cypress" rel="noopener ugc nofollow" target="_blank">npm i cypress --save-dev</a></code>拉倒柏树。这可能需要一些时间，但可能是建立框架最长的一步。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/232fc0838b434b7442c5b1002e438514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bSXJK4U2bXH-oDAq4P75gw.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">Downloading Cypress</figcaption></figure><p id="5cc8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">安装完成后，现在运行<code class="fe mu mv mw mx b">node_modules\.bin\cypress open</code>就可以打开Cypress了。为了使事情变得简单，让我们将它作为一个npm脚本添加到您的<code class="fe mu mv mw mx b">package.json</code>文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5980" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">确保你逃脱了反斜杠。现在，您应该能够通过在命令行中键入<code class="fe mu mv mw mx b">npm run cypress</code>来运行Cypress了。</p><p id="1141" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Cypress将在您的项目根目录下为您生成一个<code class="fe mu mv mw mx b">cypress.json</code>配置文件，以及一个包含多个子文件夹的cypress文件夹。让我们来看看这些文件夹的作用。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="01d0" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">柏树的结构</h1><p id="2498" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">首先是配置文件<code class="fe mu mv mw mx b">cypress.json</code>——在这里您可以修改Cypress的默认行为。比如设置一个基本的URL，env变量，或者测试文件所在的文件夹的路径。有关选项的完整列表，您可以参考官方文档下的<a class="ae lo" href="https://docs.cypress.io/guides/references/configuration.html" rel="noopener ugc nofollow" target="_blank">配置页面</a>。我们还有四个不同的文件夹:</p><h2 id="2e99" class="nf ly iq bd lz ng nh dn md ni nj dp mh lb nk nl mj lf nm nn ml lj no np mn nq bi translated"><a class="ae lo" href="https://docs.cypress.io/api/commands/fixture.html" rel="noopener ugc nofollow" target="_blank">夹具</a></h2><p id="d90a" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">Fixtures用于加载一组固定的数据。这对于嘲笑回应很有用。假设您的应用程序与一个API进行通信。您可以使用<a class="ae lo" href="https://docs.cypress.io/guides/guides/network-requests.html#Fixtures" rel="noopener ugc nofollow" target="_blank">修复</a>来模拟网络响应。</p><p id="bac9" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">有一点要注意；Cypress目前仅支持拦截XHR请求，如果您使用Fetch API，您需要变通办法:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/b185b213354f602bff0f64b4f26593eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5kA9P-rH9iVqzHel5myERg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">Warning from the official website on Cypress. <a class="ae lo" href="https://github.com/cypress-io/cypress/issues/95" rel="noopener ugc nofollow" target="_blank">#95</a> for reference</figcaption></figure><h2 id="bf44" class="nf ly iq bd lz ng nh dn md ni nj dp mh lb nk nl mj lf nm nn ml lj no np mn nq bi translated"><a class="ae lo" href="https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Test-files" rel="noopener ugc nofollow" target="_blank">整合</a></h2><p id="cadc" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">这是您所有测试文件的存放位置。您可以将该位置配置到您的<code class="fe mu mv mw mx b">cypress.json</code>文件的另一个目录中。您还将获得一些生成的示例测试，以便熟悉语法和可用的命令。</p><h2 id="c515" class="nf ly iq bd lz ng nh dn md ni nj dp mh lb nk nl mj lf nm nn ml lj no np mn nq bi translated"><a class="ae lo" href="https://docs.cypress.io/guides/tooling/plugins-guide.html" rel="noopener ugc nofollow" target="_blank">插件</a></h2><p id="e4f5" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">plugins文件夹用于修改或扩展Cypress的功能。假设您的应用程序使用TypeScript，并使用Webpack构建。通过挂钩到<code class="fe mu mv mw mx b">file:preprocessor</code>事件，您可以以正确的方式解析您的模块。</p><h2 id="48b3" class="nf ly iq bd lz ng nh dn md ni nj dp mh lb nk nl mj lf nm nn ml lj no np mn nq bi translated"><a class="ae lo" href="https://docs.cypress.io/api/cypress-api/custom-commands.html" rel="noopener ugc nofollow" target="_blank">支持</a></h2><p id="e8b7" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">最后，support文件夹用于向Cypress添加定制命令— <em class="ns">或修改现有命令</em> —这些命令可以在整个测试中使用。</p><p id="eea2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这种文件夹结构只是一个例子。你可以随时通过<code class="fe mu mv mw mx b">cypress.json</code>改变和配置位置。现在我们已经熟悉了Cypress是如何构建的，我们可以开始研究如何编写测试用例了。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="38bb" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">编写您的第一个测试</h1><p id="817a" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">首先，让我们删除集成文件夹中的所有内容，并通过运行<code class="fe mu mv mw mx b">npm run cypress</code>启动Cypress。您将看到它没有找到任何文件。所以让我们创建一个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7a47dbbadf8c121012c2d198f8b3f940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*rhFWvg4mAPzmGHu5VFgq6g.png"/></div></figure><p id="b508" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">创建一个名为<code class="fe mu mv mw mx b">test.js</code>的新文件。它应该会立即出现在赛普拉斯。假设我们要测试Cypress的官网。您可以像编写单元测试一样编写测试用例。让我们从概述我们想要测试的不同交互开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4845" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">首先我们需要导航到<a class="ae lo" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> cypress.io </a>。我们可以通过指定一个将在所有测试之前执行的<code class="fe mu mv mw mx b">before</code>块来做到这一点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0c61" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">全局<code class="fe mu mv mw mx b">cy</code>对象可以用来为我们做繁重的工作。除了访问页面或获取元素，它还用于各种用户交互。比如点击、键入甚至验证断言。</p><p id="d772" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">当您打开首页时，会出现两个横幅。比如说我们想测试一下是否可以关闭它们。点击Cypress内部的<code class="fe mu mv mw mx b">test.js</code>来运行它。您也可以选择使用不同的浏览器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3271bd3133b963f75deceeb0bada18a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*JRaKbpABRI0Ui6NcjKtMug.png"/></div></figure><p id="e760" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要关闭横幅，您需要测试元素的存在并触发一个点击事件。除了传统的方法之外，你还可以使用<em class="ns">内置的<em class="ns">选择器操场</em>按钮来获取元素。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/0d9f998160b70310d3f64dceef3fe01d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y_6gZrb6LHIDUbYH2xp1wg.gif"/></div></div></figure><p id="d6b7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">将它复制到剪贴板会为您生成一个cypress选择器。触发一个点击甚至就像在它上面调用<code class="fe mu mv mw mx b">click()</code>一样简单。保存文件后，Cypress自动重新运行测试，我们可以看到底部的横幅消失了。因此，让我们对顶部的横幅做同样的事情，并验证它是否确实被隐藏。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c6e1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如你所见，我们可以一个接一个地连锁行动。我们可以通过调用<code class="fe mu mv mw mx b">should</code>来验证预期。断言也会出现在浏览器的左侧。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/f325d0c949b2b0720ae512b1a0b3be79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/1*o1EywOMYYiT4MvoPch13Dg.gif"/></div></figure><p id="a1ce" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您可以与它们进行交互，并查看浏览器中反映的事件。继续，我们有导航。为了测试导航，我们需要获得导航按钮，并检查URL是否包含正确的单词。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ae12" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">当我们想要获得具有相同类名的不同元素时，我们可以使用类似于CSS中的<code class="fe mu mv mw mx b">nth-child</code>选择器的<code class="fe mu mv mw mx b">eq(n)</code>。我们可以对最后一个测试使用相同的逻辑。我们需要单击subscribe按钮，然后我们可以验证它旁边的input元素是否接收了一个类:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e103" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果我们运行测试，我们可以看到站点是如何被模拟用户控制和交互的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/71e52674d8fbfdc7a1513d142afdf7be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_uegTMi5NPzK_FC9wbRInw.gif"/></div></div></figure></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="3244" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">摘要</h1><p id="978d" class="pw-post-body-paragraph ks kt iq ku b kv mp jr kx ky mq ju la lb mr ld le lf ms lh li lj mt ll lm ln ij bi translated">你刚刚用柏树创造了你的第一个E2E！柏树提供了很多。我使用它已经有一段时间了，广泛的功能选择让您可以测试一些真正高级的场景。它也有很棒的文档和一个庞大的社区支持。因此，如果你碰巧遇到了困难，你很可能会找到解决问题的方法。</p><p id="9951" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最后，我想让你注意一下我们在整个教程中做的一件事，它被认为是反模式。尽量避免使用类选择器来获取元素。这些经常会改变，这会破坏你的测试。相反，我建议使用自定义数据属性，其唯一目的是作为测试的挂钩。</p><p id="daab" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我希望你能试一试Cypress，它会让你的测试工作流程变得简单一点，就像我做的那样。如果你想看看完成的项目，你可以从<a class="ae lo" href="https://github.com/flowforfrank/cypress" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中克隆它。保重，祝测试愉快。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://medium.com/@ferencalmasi/membership"><div class="gh gi ny"><img src="../Images/e66c4cd6d9849ac0bd245f3fc39b65c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ9xuLqLkbqUG65sgVB3gg.png"/></div></a></figure></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.webtips.dev/writing-your-very-first-unit-test-with-jest"><div class="gh gi nz"><img src="../Images/d1108117805e9771ed7decda9132c4ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*J3fk267vDo7ExNR_LBQlSg.png"/></div></a></figure></div></div>    
</body>
</html>