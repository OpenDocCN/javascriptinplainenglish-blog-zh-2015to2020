<html>
<head>
<title>Deploy a Node.js App with CI/CD and AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CI/CD和AWS部署Node.js应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deploying-nodejs-application-using-ci-cd-process-in-aws-86a3c2c4a4ad?source=collection_archive---------1-----------------------#2020-11-12">https://javascript.plainenglish.io/deploying-nodejs-application-using-ci-cd-process-in-aws-86a3c2c4a4ad?source=collection_archive---------1-----------------------#2020-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/914d43686477e4be369f41942fe0e223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*0o8q0_CsjZldK2FIF8EqxA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Photo from ITNEXT</figcaption></figure><p id="12d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我知道手动构建和部署您的应用程序有多困难。部署真的是开发者的噩梦。在本教程中，我将向您展示如何用一个命令部署NodeJS应用程序。所有的过程都将由AWS CodePipeline和AWS Elastic Beanstalk来处理。在深入应用程序之前，您需要具备以下条件:</p><p id="72ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS帐户</p><p id="c469" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">NPM安装</p><p id="7374" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GitHub帐户</p><p id="cb75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们创建一个简单的NodeJS应用程序，它将返回简单的JSON数据。打开VS代码终端，键入以下命令:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="1728" class="lf lg iq lb b gy lh li l lj lk">$ npm init</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/d18577ea03c76cc58c8acf38da8af628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*cikckoGiM3spxWTxyoIrlw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">npm init</figcaption></figure><p id="fbf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入该命令后，它会要求填写上面的字段。成功填充这些值后，将在该文件夹中创建package.json。然后我们需要为这个应用程序安装express和cors依赖项。要安装这些依赖项，请使用以下命令:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="ef9e" class="lf lg iq lb b gy lh li l lj lk">$ npm i express cors</span></pre><p id="3be6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Express是NodeJS的后端web应用程序框架。这是NodeJS的标准服务器框架。当你提供一个公共API，想要控制对某些资源的访问以及人们如何使用它们时，CORS真的很有用。此外，如果你想在不同的网页上使用自己的API或文件，你可以简单地配置CORS允许，同时仍然阻止其他人。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e1b631ee693b308abfbb46a7ad3369c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*WVF4a1Cmlae8RxYl3Ju5zg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">package.json</figcaption></figure><p id="3baa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装完这些包后，您可以在package.json中检查它们是否安装正确。在“脚本”中添加“start”:“节点服务器”来初始化节点服务器。然后在这个文件夹中创建一个名为server.js的文件来编写服务器配置。在server.js中添加以下代码段</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="276e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码段中，我已经导入了express framework和cors。在这里，我将“API Running”JSON消息发送到基本URL，即http://localhost:5000 。在代码下面，segment定义了端口，app.listen将使用该端口初始化服务器。现在，使用以下命令启动服务器:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="d762" class="lf lg iq lb b gy lh li l lj lk">$ npm start server</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/11dae7d052fd185e5ff5a41a9622e4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*qhro3e6gf0LZkc1-_05Lag.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">server running</figcaption></figure><p id="1bff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，该应用程序将在端口5000上运行，如果您访问该URL，您可以看到JSON消息。目前，一切都在本地运行，因为只有你可以访问这个网址。如果您希望每个人都能访问这个URL，您需要部署这个应用程序。</p><p id="8be0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要部署这个应用程序，您需要将代码推送到GitHub存储库。在将代码推送到存储库之前，不要忘记使用“.”忽略node_modules。gitignore”。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/db36c6a244d57155aa0bda46de27db19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*3fs6DroYGAphbBi_p6bRWw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">.gitignore file</figcaption></figure><p id="dbdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是时候将代码推送到您的存储库了。在GitHub中创建一个空的存储库。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/eb093366fda155eb438280f7c79f2d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*pv2JBwP8fBn_AryvKa20Wg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Sample GitHub Repo</figcaption></figure><p id="7514" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在VS Code terminal中使用以下命令，将您的代码部署到您已经创建的存储库中。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="3b82" class="lf lg iq lb b gy lh li l lj lk">$ git init -&gt; to initialize your git repository</span><span id="03b3" class="lf lg iq lb b gy lp li l lj lk">$ git add . -&gt; adds a change in the working directory to the staging area</span><span id="da7a" class="lf lg iq lb b gy lp li l lj lk">$ git commit –m “your message” -&gt; used to save your changes to the local repository</span><span id="5d7d" class="lf lg iq lb b gy lp li l lj lk">$ git branch –m main -&gt; rename local branch</span><span id="1776" class="lf lg iq lb b gy lp li l lj lk">$ git remote add origin "Your_Repo_URL"-&gt; to add remote repository</span><span id="ddc9" class="lf lg iq lb b gy lp li l lj lk">$ git push -u origin main -&gt; Push changes to remote repository.</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/503f15f121aef7bcdcbb67a3ea7da89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*D4MumxopUcGDaziXMszTmA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">after pushing your code</figcaption></figure><p id="9567" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你可以检查你的回购内，一切都在那里。成功地将代码推送到GitHub之后，就该配置AWS Elastic Beanstalk来创建节点环境以部署应用程序了。通过AWS管理控制台转到EBS服务。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/83a6500c6ffa017b92a60b8665b3f806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*vWw6fcIwP9nROoPBxsG8wQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">AWS Elastic Beanstalk</figcaption></figure><p id="4590" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击创建应用程序。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/15725ad474244b76b01ae002f7e2b038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*hNz8DfnrNgEMNPnY-YHwQQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">EBS Environment creation</figcaption></figure><p id="dcf3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，给你的应用程序一个名字。因为我们正在部署NodeJS应用程序，所以将平台设置为Node.js，并根据您的节点应用程序版本更改其他设置。在这里，我将所有内容都保留为默认值，并用AWS示例代码创建了一个应用程序。创建环境需要一些时间，在此之前，让我们转到CodePipeline service为该应用程序创建一个管道。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/2acb2dc8e59fd2d1c22489627b2fce6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*eEU89pTt54UVG8iPI6rblg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">CodePipeline</figcaption></figure><p id="4120" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击创建管道以创建新管道。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/4d35812546103a689bedc6257ea83812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*JntZNu0aYZL66_lPjajwfw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">pipeline settings</figcaption></figure><p id="cb51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为您的管道命名，然后单击next。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0d73c06e23469fc01160c787bd023f94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*DeuxXpGQ4_mQVELOm2Tw5Q.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Add source stage</figcaption></figure><p id="830e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从source provider中选择GitHub，并将其连接到这个控制台。然后选择您想要部署的存储库及其分支。配置完成后，单击“下一步”按钮。然后它会要求添加构建阶段。由于我们不使用任何构建，我们可以通过单击skip build stage跳过这一步。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0d2c15996413e0cd98325193752e608b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*8ITL6eduT2v96m7_IINLvQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Add build stage</figcaption></figure><p id="299a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您需要添加您将在哪里部署这些代码。在此之前，您需要确认您的EBS环境已经准备好部署您的应用程序。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/351e3c3d2d15ee52912db60ca23ae98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*shdWxnz5ya0SusUXeVbSFg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Your EBS Environment</figcaption></figure><p id="68ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果它成功地创建了您的环境，您可以在绿色勾号中看到健康状况。如果您单击右上角的URL，它将重定向到AWSsample nodejs应用程序。现在转到代码管道控制台部署应用程序。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/c4625ab8afa6a05b2989c329d3d1abf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*3TFAmNUgE9UxG-Vouww0hw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Add deploy stage</figcaption></figure><p id="7afa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意——记住您在哪个地区创建应用程序。</strong></p><p id="18cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">填写完这些字段后，选择“下一步”按钮。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/d2ac35edb223fd8cd252e29fb4bd8625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*JYt84LtR8ytzdCFAcdTJOg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Review Page</figcaption></figure><p id="891e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，它将重定向到审查页面，在这里您可以看到您的所有配置。现在点击创建管道按钮。将您的应用程序部署到EBS中需要一些时间。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0c5223f1f8e9fdb75ef1bc4cd14aace3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*SA-BGEi5kkyNDFgi4voFkQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Your CodePipeline</figcaption></figure><p id="6531" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您的应用程序已经成功部署到您的EBS中。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/c4ec810f8f62a14ae12f686e70ea25b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*1Io812S6qUWWltE5jUJudA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Your EBS Environment with Your Application</figcaption></figure><p id="634d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以点击上面的链接或者使用postman来测试这个应用程序。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/51607cdf5e0d2ab0b9e3422fdc0a07a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*T75OEk_3pJFjUxUlDdUwcQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Postman Test</figcaption></figure><h2 id="989e" class="lf lg iq bd lq lr ls dn lt lu lv dp lw kj lx ly lz kn ma mb mc kr md me mf mg bi translated">结论</h2><p id="c6a9" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">看看我们如何轻松地在AWS中部署我们的应用程序。现在，您不需要担心应用程序的部署。每当您对代码进行更改并将其推送到您的存储库时，这个管道会自动检测到更改并再次部署您的应用程序。我希望大家喜欢这篇文章。希望能再看到大家有另一个好话题。</p><p id="4971" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢你。</p><p id="31c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mm">我在这个演示中使用的代码库:</em></p><div class="mn mo gp gr mp mq"><a href="https://github.com/ezioguga/AWS-EBS-demo" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">ezioguga/AWS-EBS-demo</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne js mq"/></div></div></a></div></div></div>    
</body>
</html>