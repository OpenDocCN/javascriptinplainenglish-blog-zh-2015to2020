<html>
<head>
<title>JavaScript Under The Hood Pt. 3: Narrowing With Logical Operators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引擎盖下的JavaScript。3:使用逻辑运算符缩小范围</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-under-the-hood-pt-3-narrowing-with-logical-operators-41e02eed8a16?source=collection_archive---------14-----------------------#2020-09-28">https://javascript.plainenglish.io/javascript-under-the-hood-pt-3-narrowing-with-logical-operators-41e02eed8a16?source=collection_archive---------14-----------------------#2020-09-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bcafc4685baed690c42bc4b637fe2b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*doRG1DYb9XY4_saNhG7BKA.png"/></div></div></figure><p id="19a5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe kt ku kv kw b">||</code>(逻辑OR)和<code class="fe kt ku kv kw b">&amp;&amp;</code>(逻辑and)是JavaScript中非常常见的运算符。但是你知道为什么它们以这样的方式工作，以及它们还可以怎样被使用吗？不仅如此，你知道他们的陷阱吗？如果你不知道它们是如何工作的，逻辑OR和逻辑and实际上会在你的代码中引起难以发现的错误。</p><blockquote class="ky"><p id="4a9b" class="kz la in bd lb lc ld le lf lg lh ks dk translated">如果你不知道它们是如何工作的，逻辑OR和逻辑and会在你的代码中产生难以发现的错误。</p></blockquote><p id="4eed" class="pw-post-body-paragraph jv jw in jx b jy li ka kb kc lj ke kf kg lk ki kj kk ll km kn ko lm kq kr ks ig bi translated">除了它们的流行用法，逻辑OR <code class="fe kt ku kv kw b">||</code>和逻辑AND <code class="fe kt ku kv kw b">&amp;&amp;</code>实际上可以相当容易和有效地用来代替简单的条件语句，并且经常可以将它们减少到一行。</p><p id="078c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将讨论这两个操作符是如何工作的，如何/何时用它们来替换条件语句，并讨论它们的缺陷。</p></div><div class="ab cl ln lo hr lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ig ih ii ij ik"><h1 id="2fc3" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">逻辑OR和逻辑and是如何工作的？</h1><p id="37e2" class="pw-post-body-paragraph jv jw in jx b jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko mw kq kr ks ig bi translated">首先，如果我们看一下<a class="ae mx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence" rel="noopener ugc nofollow" target="_blank"> Mozilla的操作符优先级表</a>(向下滚动一点就可以看到这个表)，我们可以看到这两个表都有<strong class="jx io">从左到右的结合性(通常称为“左结合性”)</strong>，这实质上意味着JavaScript引擎首先读取操作符左侧的内容，然后读取右侧的内容。这在接下来的几个要点中很重要。(如果你想了解更多关于操作符结合性的内容，请查看这篇<a class="ae mx" href="https://en.wikipedia.org/wiki/Operator_associativity" rel="noopener ugc nofollow" target="_blank">维基百科文章</a></p><p id="287c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们继续之前，我想给<a class="ae mx" href="https://www.executeprogram.com/" rel="noopener ugc nofollow" target="_blank"> Execute Program的</a>关于类型脚本的课程一点信任。虽然本文不是关于TypeScript的，但是在他们的课程中会解释这些概念。</p><p id="941f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了理解<code class="fe kt ku kv kw b">||</code>和<code class="fe kt ku kv kw b">&amp;&amp;</code>如何产生无法预见的错误，让我们简单回顾一下JavaScript中的错误值。</p><h2 id="3ad0" class="my lv in bd lw mz na dn ma nb nc dp me kg nd ne mi kk nf ng mm ko nh ni mq nj bi translated">JavaScript中的Falsey值</h2><ul class=""><li id="96e7" class="nk nl in jx b jy ms kc mt kg nm kk nn ko no ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">false</code></li><li id="7a60" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">0</code></li><li id="7c36" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">0n</code>(在ECMAScript 2020中与“BigInt”一起使用)</li><li id="6052" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">'’</code></li><li id="9309" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">undefined</code></li><li id="524a" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">null</code></li><li id="5b99" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><code class="fe kt ku kv kw b">NaN</code></li></ul><p id="54d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所有其他的价值观都是真实的。</p><p id="3d48" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您能猜到为什么其中一些会导致我们正在讨论的操作符出现意外错误吗？</p></div><div class="ab cl ln lo hr lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ig ih ii ij ik"><p id="f398" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通常我们认为<code class="fe kt ku kv kw b">&amp;&amp;</code>是一种处理布尔值的方法。</p><pre class="ny nz oa ob gt oc kw od oe aw of bi"><span id="4150" class="my lv in kw b gy og oh l oi oj">true &amp;&amp; false<br/>//false</span><span id="1fd5" class="my lv in kw b gy ok oh l oi oj">false &amp;&amp; false<br/>//false</span><span id="42be" class="my lv in kw b gy ok oh l oi oj">true &amp;&amp; true<br/>//true</span></pre><p id="9bb9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe kt ku kv kw b"><strong class="jx io">&amp;&amp;</strong></code> <strong class="jx io">返回它看到的第一个falsey值。但是如果两个值都是真的，它返回右边的值</strong>(记住<code class="fe kt ku kv kw b">&amp;&amp;</code>使用左边的结合性)。</p><pre class="ny nz oa ob gt oc kw od oe aw of bi"><span id="4d3e" class="my lv in kw b gy og oh l oi oj">1 &amp;&amp; 2<br/>//2</span><span id="9e49" class="my lv in kw b gy ok oh l oi oj">undefined &amp;&amp; 2<br/>//undefined</span><span id="916b" class="my lv in kw b gy ok oh l oi oj">2 &amp;&amp; false<br/>//false</span><span id="ce32" class="my lv in kw b gy ok oh l oi oj">null &amp;&amp; 2<br/>//null</span><span id="7c66" class="my lv in kw b gy ok oh l oi oj">true &amp;&amp; “hello”<br/>//”hello”</span></pre><blockquote class="ky"><p id="c9bf" class="kz la in bd lb lc ol om on oo op ks dk translated"><code class="fe kt ku kv kw b">&amp;&amp;</code>返回它看到的第一个falsey值。但是如果两个值都是真的，它返回右边的值</p></blockquote><p id="5c02" class="pw-post-body-paragraph jv jw in jx b jy li ka kb kc lj ke kf kg lk ki kj kk ll km kn ko lm kq kr ks ig bi translated"><strong class="jx io">逻辑或</strong> <code class="fe kt ku kv kw b"><strong class="jx io">||</strong></code>工作方式类似，但是<strong class="jx io">返回它看到的第一个真值。但是如果两个值都为假，它返回右边的值</strong></p><pre class="ny nz oa ob gt oc kw od oe aw of bi"><span id="9752" class="my lv in kw b gy og oh l oi oj">1 || 2<br/>//1</span><span id="605c" class="my lv in kw b gy ok oh l oi oj">undefined || 2<br/>//2</span><span id="1cda" class="my lv in kw b gy ok oh l oi oj">“hello” || null<br/>//”hello”</span><span id="6dfb" class="my lv in kw b gy ok oh l oi oj">false || null<br/>//null</span></pre><blockquote class="ky"><p id="03cf" class="kz la in bd lb lc ol om on oo op ks dk translated">||返回它看到的第一个真值。但是如果两个值都为falsey，它将返回右边的值</p></blockquote></div><div class="ab cl ln lo hr lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ig ih ii ij ik"><h1 id="8a1e" class="lu lv in bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">逻辑OR和逻辑and怎么做条件语句？</h1><p id="7588" class="pw-post-body-paragraph jv jw in jx b jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko mw kq kr ks ig bi translated">利用我们现在所知道的，让我们来回答这个问题。</p><p id="4b01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，让我们使用一个简单的‘if else’语句将<code class="fe kt ku kv kw b">1</code>加到<code class="fe kt ku kv kw b">x</code>上，如果<code class="fe kt ku kv kw b">x</code>为真，那么使用逻辑AND运算符来达到同样的目的。</p><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="26f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们做同样的事情，但是把<code class="fe kt ku kv kw b">x</code>改为<code class="fe kt ku kv kw b">undefined</code>(一个假值)。</p><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="96c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">明白这是怎么回事了吗？</p><p id="f574" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第一个例子中，JavaScript引擎检查逻辑AND的左边，发现<code class="fe kt ku kv kw b">x</code>是真的，所以接下来检查右边。然后它再次看到<code class="fe kt ku kv kw b">x</code>，这仍然是真的，所以逻辑AND返回<code class="fe kt ku kv kw b">2</code>(因为<code class="fe kt ku kv kw b">x === 2</code>)。然后JavaScript引擎在同一行看到<code class="fe kt ku kv kw b">+</code>(它也有从左到右的关联性)，所以它把<code class="fe kt ku kv kw b">+</code>(也就是<code class="fe kt ku kv kw b">1</code>)右边的内容加到<code class="fe kt ku kv kw b">&amp;&amp;</code>返回的内容(也就是<code class="fe kt ku kv kw b">2</code>)上，然后返回<code class="fe kt ku kv kw b">3</code>。</p><p id="b9a7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第二个例子中，JavaScript引擎检查逻辑AND的左边，看到了<code class="fe kt ku kv kw b">x</code>，它现在是一个假值<code class="fe kt ku kv kw b">undefined</code>。所以它就停在那里，并返回falsey值，<code class="fe kt ku kv kw b">undefined</code>。</p><p id="3c2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们试试逻辑OR <code class="fe kt ku kv kw b">||</code>(记住它返回它看到的第一个真值，如果两个都为假，则返回第二个值)。</p><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="5437" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在最后一个例子中，<code class="fe kt ku kv kw b">||</code>返回<code class="fe kt ku kv kw b">5</code>，因为它是一个真值。右边的表达式甚至看不到。</p><p id="aa85" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们使<code class="fe kt ku kv kw b">x</code>变得虚假。</p><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="4cea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">这些概念很强大。</strong></p><p id="8068" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">让我们更进一步</strong>写一些稍微复杂一点的东西。</p><h2 id="01cd" class="my lv in bd lw mz na dn ma nb nc dp me kg nd ne mi kk nf ng mm ko nh ni mq nj bi translated">写一个函数，你知道它要么接受一个数组，要么为空。如果该值是一个数组，返回数组的长度，否则返回该值。</h2><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="7418" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用<code class="fe kt ku kv kw b">&amp;&amp;</code>的第二个函数更短更简洁(尽管代价是有点难以理解)。</p><p id="2cec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们使用逻辑OR运算符作为另一个示例的条件。</p><h2 id="a16d" class="my lv in bd lw mz na dn ma nb nc dp me kg nd ne mi kk nf ng mm ko nh ni mq nj bi translated">编写一个接受值的函数。如果该值为真，则返回该值，否则返回-1。</h2><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><h1 id="e953" class="lu lv in bd lw lx os lz ma mb ot md me mf ou mh mi mj ov ml mm mn ow mp mq mr bi translated">当||和&amp;&amp;有危险时</h1><p id="5bed" class="pw-post-body-paragraph jv jw in jx b jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko mw kq kr ks ig bi translated">回想一下我们上面列出的错误价值观。<strong class="jx io">JavaScript的一个大问题是</strong><code class="fe kt ku kv kw b"><strong class="jx io">0</strong></code><strong class="jx io"/><code class="fe kt ku kv kw b"><strong class="jx io">'’</strong></code><strong class="jx io">是假值</strong>。你可以想象这会引起多大的混乱！</p><p id="bd54" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">让我们用</strong> <code class="fe kt ku kv kw b"><strong class="jx io">||</strong></code> <strong class="jx io">创建一个函数，但要以一种你团队其他人不会注意到的方式破解它。</strong>(假设这个函数要么取一个数，要么取<code class="fe kt ku kv kw b">undefined</code>。)</p><figure class="ny nz oa ob gt jo"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="e013" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它返回了<code class="fe kt ku kv kw b">-1</code>！但是<code class="fe kt ku kv kw b">0</code>对我们人类来说是一个数字！</p><blockquote class="ky"><p id="59f7" class="kz la in bd lb lc ld le lf lg lh ks dk translated">JavaScript的一个大问题是0和' '(空字符串)是假值。</p></blockquote><p id="9572" class="pw-post-body-paragraph jv jw in jx b jy li ka kb kc lj ke kf kg lk ki kj kk ll km kn ko lm kq kr ks ig bi translated">处理这个问题的一个简单方法是，如果你认为一个变量可能以0或“”结束，选择使用一个简单的if/else语句。</p><p id="09d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">示例:</p><pre class="ny nz oa ob gt oc kw od oe aw of bi"><span id="e1e5" class="my lv in kw b gy og oh l oi oj">let defaultInt = 0</span><span id="a9a3" class="my lv in kw b gy ok oh l oi oj">if (defaultInt === 0) {<br/>    return 1<br/>} else {<br/>    return defaultInt + 1<br/>}<br/>// 1</span></pre><p id="f958" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">实现相同目标的另一种更简洁的方法是使用ES2020 nullish合并运算符(？？).</strong>在<a class="ae mx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator" rel="noopener ugc nofollow" target="_blank"> Mozilla开发者页面</a>上是这样描述的:<em class="kx">“</em><strong class="jx io"><em class="kx">nullish合并运算符(</em></strong><strong class="jx io"><em class="kx">)</em></strong><em class="kx">是一个逻辑运算符，当其左侧操作数为</em> <code class="fe kt ku kv kw b"><em class="kx">null</em></code> <em class="kx">或</em> <code class="fe kt ku kv kw b"><em class="kx">undefined</em></code> <em class="kx">时，返回其右侧操作数，否则返回左侧操作数。”</em></p><p id="231a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">文档中的示例:</p><pre class="ny nz oa ob gt oc kw od oe aw of bi"><span id="6cd7" class="my lv in kw b gy og oh l oi oj">const foo = null ?? 'default string';<br/>console.log(foo);<br/>// expected output: "default string"</span><span id="89b1" class="my lv in kw b gy ok oh l oi oj">const baz = 0 ?? 42;<br/>console.log(baz);<br/>// expected output: 0</span></pre><p id="27d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本质上，它会将0和''视为或多或少的“真”值，这不会像逻辑or运算符那样导致任何意外的行为。</p></div><div class="ab cl ln lo hr lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ig ih ii ij ik"><p id="83d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，总的来说，逻辑OR和逻辑and在简化简单的条件表达式时非常有用。然而，需要很好地理解它们是如何工作的，以便利用它们，并且不给你的团队造成混乱。</p><p id="d58a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你在编程中使用过逻辑运算符作为条件语句吗？它有没有给你带来什么看不见的bug？</p><p id="8e27" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您喜欢这篇文章，并且想要更多的高级JavaScript概念，请查看本系列的其余部分！</p></div></div>    
</body>
</html>