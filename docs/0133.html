<html>
<head>
<title>Introduction to the RxJS Custom Observable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RxJS自定义可观察对象介绍</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-custom-observable-with-rxjs-379692f08f76?source=collection_archive---------0-----------------------#2019-04-24">https://javascript.plainenglish.io/creating-custom-observable-with-rxjs-379692f08f76?source=collection_archive---------0-----------------------#2019-04-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a51f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何用RxJS创建自定义的可观察对象</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e78f5a0ade026f6cccc3ff62c41cb580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HydNkMMS5MR61s01IVXHA.png"/></div></div></figure><p id="320f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">在我之前的文章中，我们讲过</em> <strong class="kt ir"> <em class="ln"> RxJS </em> </strong> <em class="ln">的基础知识。该库提供了许多创建可观察对象的方法。在本文中，我们将讨论用</em> <strong class="kt ir"> <em class="ln">方式创建自定义可观察对象</em> </strong> <em class="ln">和</em> <strong class="kt ir"> <em class="ln">订阅自定义可观察对象</em> </strong> <em class="ln">创建。</em></p><p id="ca01" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">RxJS的基础知识可以参考下面这篇文章。</em></p><div class="lo lp gp gr lq lr"><a href="https://levelup.gitconnected.com/introduction-to-rxjs-3f17e1009527" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">RxJS和反应式编程简介</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">反应式编程是JavaScript世界的新热点。在本文中，我们将讨论基础知识…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf kp lr"/></div></div></a></div><p id="1f1c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">可观察对象</strong>是维护一个被称为观察者的<strong class="kt ir">依赖列表的对象，观察者被告知可观察对象的任何状态变化。对于每个可观测的状态变化，在观测器上调用一个方法。观察者认同可观察的事物并对事件做出反应。</strong></p><p id="a931" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简单来说，你可以说:</p><ol class=""><li id="5187" class="mg mh iq kt b ku kv kx ky la mi le mj li mk lm ml mm mn mo bi translated">可观的是那些抛出一些值的人</li><li id="57d9" class="mg mh iq kt b ku mp kx mq la mr le ms li mt lm ml mm mn mo bi translated">观察者是捕捉那些抛出的值的人</li></ol><p id="534e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">可观察对象可以发出以下事件:</p><ol class=""><li id="ba3a" class="mg mh iq kt b ku kv kx ky la mi le mj li mk lm ml mm mn mo bi translated">"<strong class="kt ir">下一个</strong>":事件用于从可观察值中发出下一个值。</li><li id="53e0" class="mg mh iq kt b ku mp kx mq la mr le ms li mt lm ml mm mn mo bi translated">"<strong class="kt ir">错误</strong>":跟随一个事件用于通知观察者一些错误。</li><li id="8ac5" class="mg mh iq kt b ku mp kx mq la mr le ms li mt lm ml mm mn mo bi translated">“<strong class="kt ir">完成</strong>”:表示观察体已经完成发射数据。</li></ol><p id="b2c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们创建一个每秒钟发出一个随机值的可观察对象。这将是包含单个事件“下一个”的简单可观测值。然后，我们将扩展这个例子，把其他事件也包括在内。</p><p id="3cd0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在下面的例子中，我们使用“<strong class="kt ir"> Observable.create </strong>”创建一个简单的观察者。该函数的参数是另一个接受“观察者”对象的函数。我们现在可以用一些随机数据在这个“观察者”对象上调用“下一个”函数。这就是我们创建一个简单的自定义可观察对象所需的全部内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7b5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，既然我们有了一个可用的可观察样本，我们现在可以创建一个简单的订阅者来订阅该可观察样本。由于上述可观察对象不会发出任何“错误”或“完全”事件，我们可以为其创建一个简单的观察器。下面是订阅可观察对象的代码</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c829" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码中，我们订阅了创建的可观察对象。我们可以通过使用<code class="fe mw mx my mz b">subscribe</code>函数来订阅可观察值。</p><p id="3317" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">subscribe函数将一个函数作为其输入参数，以响应观察器发出的不同事件。在上面的场景中，我们向subscribe函数传递一个函数，因为Observable只是发出一个事件“next”。默认情况下，作为参数传递的函数将处理“下一个”事件。从Observable发出的数据由“value”参数中指定的函数捕获。然后，我们在控制台中显示该值。</p><p id="a72c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是jsFiddle中的样例工作代码，它创建了一个简单的观察器，并通过简单的观察器订阅可观察对象。</p><p id="324b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">被创造的可观察对象正在发射“下一个”事件以及一些包含随机数的数据。当我们使用“subscribe”函数订阅可观察对象时，我们传递的是一个单独的函数，默认情况下该函数将处理“next”事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na mv l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">Source: <a class="ae nf" href="https://jsfiddle.net/Mayankgupta688/5chg8ftn/" rel="noopener ugc nofollow" target="_blank">https://jsfiddle.net/Mayankgupta688/5chg8ftn/</a></figcaption></figure><p id="2327" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们给可观察对象和观察者增加一些复杂性。我们将期望每秒钟在控制台中连续生成并显示一个随机值。同样，我们将在可观测的“误差”和“完全”中引入其他事件。我们将扩展该功能，在随机值被13整除的情况下发出“错误”事件，如果值为99，则发出“完整”事件。</p><p id="321d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，我们将创建一个订阅者来捕捉所有这些事件。</p><p id="de6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将在下面添加相同的代码，我们可以看到每秒钟后我们都在异步地发出值。在下面的代码中，我们可以看到我们在观察者对象上调用了“错误”、“完成”和“下一个”事件，这将引发与可观察对象不同的事件。</p><p id="8a4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“完成”事件标志着观察的完成，“错误”事件标志着错误状态。如果在完成之前引发了“错误”事件，可观察对象将停止发出任何进一步的事件，并在没有发出“完成”事件的情况下终止。因此，如果生成的随机值为13，下面的代码将终止并停止发出任何进一步的事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="0f61" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码中，我们根据生成的随机数的值有条件地引发事件。由于观察器发出多种类型的事件，我们需要创建一个观察器，使它能够捕获观察器发出的所有类型的事件。</p><p id="96d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面的代码是Observer的简单实现，它将订阅Observable并捕获所有这些事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="600a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码中，我们向subscribe函数传递了3个函数，每一个都映射到从Observable引发的“next”、“error”和“complete”事件。订户可以捕获每个事件，并可以根据事件发出期间接收到的数据采取行动。请注意，如果观察器发生“完全”事件，我们不会发出任何数据。</p><p id="bc9d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在您可以看到创建一个简单的自定义可观察对象是多么容易。在网页中，您可以观察到多个事件，如:</p><ol class=""><li id="0d23" class="mg mh iq kt b ku kv kx ky la mi le mj li mk lm ml mm mn mo bi translated">DOM事件可以使用Observable来处理</li><li id="bb78" class="mg mh iq kt b ku mp kx mq la mr le ms li mt lm ml mm mn mo bi translated">来自Ajax数据的响应可以从可观察的流中提供</li><li id="557b" class="mg mh iq kt b ku mp kx mq la mr le ms li mt lm ml mm mn mo bi translated">以可观察数据流的形式提供数据列表。</li><li id="7208" class="mg mh iq kt b ku mp kx mq la mr le ms li mt lm ml mm mn mo bi translated">对输入数据流应用运算符并对其进行转换</li></ol><p id="7898" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将在另一篇文章中讨论创建可观察对象和应用操作符的其他方法。</p><p id="49e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你喜欢这篇文章！</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt lr"><a href="https://gitconnected.com/learn/javascript" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">学习JavaScript -最佳JavaScript教程(2019) | gitconnected</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">50大JavaScript教程-免费学习JavaScript。课程由开发人员提交并投票，从而实现…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">gitconnected.com</p></div></div><div class="ma l"><div class="nn l mc md me ma mf kp lr"/></div></div></a></div><p id="f1de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">更多内容尽在</em><a class="ae nf" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="ln">plain English . io</em></strong></a></p></div></div>    
</body>
</html>