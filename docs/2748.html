<html>
<head>
<title>Using an Angular Directive Multiple Times on an Element</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在元素上多次使用角度方向</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-happens-when-an-angular-directive-is-used-more-than-once-on-an-element-1e709cbead2f?source=collection_archive---------3-----------------------#2020-07-20">https://javascript.plainenglish.io/what-happens-when-an-angular-directive-is-used-more-than-once-on-an-element-1e709cbead2f?source=collection_archive---------3-----------------------#2020-07-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/ae5e9d94cffdf159967b7a8f1545f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kewz0xLvwocuc8INzphzmA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@emilymorter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Emily Morter</a> on <a class="ae jd" href="https://unsplash.com/s/photos/question-mark?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="8495" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">解释Angular如何处理具有多次实例化的指令的元素</p><p id="6649" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们想要变换或调整一个元素的外观时，Angular中的指令就派上了用场。此外，使用指令对于抽象来说更好，因为所有的实现逻辑都在指令实现中被抽象出来，并且可以在任意数量的元素上使用这些逻辑，只需添加指令选择器以及输入(如果有的话)。</p><p id="b68a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我将解释在一个元素上不止一次使用一个指令的场景，以及Angular如何处理这种情况。</p><p id="9353" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像往常一样，让我们建立一个简单的例子。我将创建一个指令<code class="fe lb lc ld le b">square</code>，它将主机元素的值更新为其值的平方。下面是该指令的一个简单实现:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lf"><img src="../Images/7a17d2746708a0b3bf5ac25c58e961e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5p75E_tbxqsM6oE5CwvReQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Implementation of square directive</figcaption></figure><p id="59e0" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了在输入元素上使用它，下面是示例代码:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lf"><img src="../Images/b95d83a6181de32d9ec035566d3362f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d3rTCsEDcOurxf-TbXppOg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Using appSquare directive on an input element</figcaption></figure><p id="0dc2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们为input设置了一个值10，但是在初始化过程中，调用了<code class="fe lb lc ld le b">appSquare</code>指令，并将input上的值更新为其值的平方100。</p><p id="9b13" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是渲染后输入的样子:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/440af82a4e3a25509350fe7ce52e83f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*u65aXTGAQXHkKt8f6INM3A.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Input after rendering</figcaption></figure><p id="14c2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，举例来说，如果我们想要平方值，例如如果我们传入<code class="fe lb lc ld le b">10</code>，那么输入应该用<code class="fe lb lc ld le b">10000</code>更新，那么，我们可以在这个元素上使用两次<code class="fe lb lc ld le b">appSqaure</code>指令来实现吗？</p><p id="457c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们通过更新上面的例子来解决这个问题</p><p id="6f10" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新输入后，模板现在看起来像这样:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lf"><img src="../Images/8013fa5a838541d80afb52a389f3a168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUiLuvM6M-VrhFSn9wvdYQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Input with appSquare directive twice</figcaption></figure><p id="9df8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用户界面上呈现的结果如下所示”</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/8efd317429d35ab21e9fd2890159fe01.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*NLYxt7fZoLZH1546YQNrSQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">UI rendered value</figcaption></figure><p id="52df" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是的，价值仍然和以前一样。</p><h1 id="1adf" class="lm ln jg bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">这里发生了什么事？</h1><p id="7417" class="pw-post-body-paragraph kd ke jg kf b kg mk ki kj kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">让我们后退一步，理解当一个指令在一个元素上被多次添加时，Angular编译过程是如何工作的。</p><p id="7cad" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Angular编译过程中，Angular编译器检查每个元素的定义，并设置原生元素的属性。这部分的实现如下所示</p><figure class="lg lh li lj gt is"><div class="bz fp l di"><div class="mp mq l"/></div></figure><blockquote class="mr ms mt"><p id="ac11" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated"><strong class="kf jh">源代码:</strong><a class="ae jd" href="https://github.com/angular/angular/blob/master/packages/platform-browser/src/dom/dom_renderer.ts#L184" rel="noopener ugc nofollow" target="_blank">https://github . com/angular/angular/blob/master/packages/platform-browser/src/DOM/DOM _ renderer . ts # L184</a></p></blockquote><p id="5710" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于属性在本地元素上被设置为<code class="fe lb lc ld le b">Map</code>，不可能多次定义相同的属性(因为如果键是文字，那么它们在Map中是惟一的，在这种情况下，它们通过值进行比较)。</p><p id="677e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当角度按照元素上定义的所有属性的放置顺序循环时，元素上某个类型的最新属性将保持不变。</p><p id="c260" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们修改前面的指令示例，接受一个输入值，并为指令的每个实例传递不同的值。在这种情况下，放在最后的指令具有优先权。</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lf"><img src="../Images/3c3126e5f0b8016c5c20ff4e41e7f4c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqhqcDEKugnaj5enKgXkEQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Square directive that takes in an input</figcaption></figure><p id="6a0c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们更新模板，为两个指令实例传入值。因为我们用与指令选择器相同的名称定义了<code class="fe lb lc ld le b">@Input</code>，所以我们不需要传递额外的输入，相反，我们可以直接将值传递给声明它自己的<code class="fe lb lc ld le b">directive</code>(它完成两个任务。指示选择器和输入装饰器)。</p><p id="4e10" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它看起来是这样的:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lf"><img src="../Images/a508abd14c026fb31a7af457b57e7999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2SwMyj7M55g85G46XRfHA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Input element with multiple instances of directives</figcaption></figure><p id="86c5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们现在运行我们的应用程序，我们会在控制台中看到:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/b46f3e3f30cade999a6b3a1ed8cf12df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FY6TV5vjpVh2FPORj5z8tg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Only second instance of directive message gets logged</figcaption></figure><p id="0ef0" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我上面所说的，在上面的例子中可以看到，指令的后一个实例删除了前一个。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="8e28" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样。感谢阅读！更多有趣的文章请关注我。</p></div></div>    
</body>
</html>