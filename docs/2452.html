<html>
<head>
<title>Node.js Tips — Environment Variables, Downloads, DNS, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js提示—环境变量、下载、DNS等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-tips-environment-variables-downloads-dns-and-more-87412946cf31?source=collection_archive---------3-----------------------#2020-06-25">https://javascript.plainenglish.io/node-js-tips-environment-variables-downloads-dns-and-more-87412946cf31?source=collection_archive---------3-----------------------#2020-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/75011c5064449b82e28e608230159faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J5rWF0ZV_j-wIrxt"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@nft?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nicolas Tissot</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c4ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写节点应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些编写节点应用程序时常见问题的解决方案。</p><h1 id="5dc1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Node.js需要一个文件夹中的所有文件</h1><p id="2de4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过创建一个导出所有模块的模块来导出一个文件夹中的所有模块。</p><p id="3f0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以一次全部导入。</p><p id="e3ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="1618" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2844" class="mq lc iq mh b gy mr ms l mt mu">exports.foo = require("./routes/foo.js");<br/>exports.bar= require("./routes/bar.js");</span></pre><p id="4964" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">app.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3328" class="mq lc iq mh b gy mr ms l mt mu">const routes = require("./routes");</span></pre><p id="008a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="be66" class="mq lc iq mh b gy mr ms l mt mu">const fs = require("fs");<br/>const normalizedPath = require("path").join(__dirname, "routes");</span><span id="6af7" class="mq lc iq mh b gy mv ms l mt mu">fs.readdirSync(normalizedPath).forEach((file) =&gt; {<br/>  require(`./routes/${file}`);<br/>});</span></pre><h1 id="def9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">错误字符串</h1><p id="677b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过遍历对象的属性来记录错误。</p><p id="4e75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0f78" class="mq lc iq mh b gy mr ms l mt mu">const error = new Error('error');<br/>const propertyNames = Object.getOwnPropertyNames(error);<br/><br/>for (const prop of propertyNames) {<br/>  const descriptor = Object.getOwnPropertyDescriptor(error, prop);<br/>  console.log(prop, descriptor);<br/>}</span></pre><p id="f4a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">Object.getOwnPropertyNames</code>方法来获取<code class="fe me mf mg mh b">error</code>对象的属性。</p><p id="1069" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到每个属性的描述符。</p><h1 id="ee3b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Node.js中“process.stdout.write”和“console.log”的区别</h1><p id="fed3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">console.log</code>用格式化的输出调用<code class="fe me mf mg mh b">process.stdout.write</code>。</p><p id="3862" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">console.log</code>的代码只是:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8a70" class="mq lc iq mh b gy mr ms l mt mu">console.log = function (d) {<br/>  process.stdout.write(d + '\n');<br/>};</span></pre><p id="a38e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了额外的换行符之外，它们几乎是等效的。</p><h1 id="b4e8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在Mac OS或Windows中将NODE_ENV设置为生产/开发</h1><p id="7a85" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">export</code>命令在Mac OS中设置环境变量。</p><p id="6722" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以通过运行以下命令来设置<code class="fe me mf mg mh b">NODE_ENV</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d126" class="mq lc iq mh b gy mr ms l mt mu">export NODE_ENV=production</span></pre><p id="0621" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Windows中，我们可以使用<code class="fe me mf mg mh b">SET</code>命令:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b0b8" class="mq lc iq mh b gy mr ms l mt mu">SET NODE_ENV=production</span></pre><p id="03a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以直接设置<code class="fe me mf mg mh b">process.env.NODE_ENV</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8442" class="mq lc iq mh b gy mr ms l mt mu">process.env.NODE_ENV = 'production';</span></pre><p id="34d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过运行以下命令来设置运行文件时的环境:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4fa8" class="mq lc iq mh b gy mr ms l mt mu">NODE_ENV=production node app.js</span></pre><p id="12dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">package.json</code>中也是如此<code class="fe me mf mg mh b">scripts</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0f5a" class="mq lc iq mh b gy mr ms l mt mu">{<br/>  ...<br/>  "scripts": {<br/>    "start": "NODE_ENV=production node ./app"<br/>  }<br/>  ...<br/>}</span></pre><h1 id="f730" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在快速模板中使用要求</h1><p id="c148" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">require</code>包含在CommonJS中。</p><p id="8236" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它本身不是浏览器端JavaScript的一部分。</p><p id="4ed1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了包含JavaScript文件，我们可以使用Script标签。</p><p id="7a64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另外，我们可以使用CommonJS模块。</p><p id="ae24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者我们可以使用异步模块。</p><p id="ba0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Browserify、Webpack和Rollup可以将模块捆绑到浏览器可用的构建构件中。</p><p id="0fc1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以在浏览器中本地使用ES6模块，将type属性设置为<code class="fe me mf mg mh b">module</code>。</p><p id="8ea2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="f57e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">script.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c561" class="mq lc iq mh b gy mr ms l mt mu">export const hello = () =&gt; {<br/>  return "Hello World";<br/>}</span></pre><p id="9229" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来包含<code class="fe me mf mg mh b">script.js</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6c17" class="mq lc iq mh b gy mr ms l mt mu">&lt;script type="module" src="script.js"&gt;&lt;/script&gt;</span></pre><h1 id="f7c4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用回调度量JavaScript代码的执行时间</h1><p id="af34" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">console.time</code>和<code class="fe me mf mg mh b">console.timeEnd</code>方法来测量一个脚本的时间。</p><p id="8bfc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f895" class="mq lc iq mh b gy mr ms l mt mu">for (let i = 1; i &lt; 10; i++) {<br/>  const user = {<br/>    id: i,<br/>    name: "name"<br/>  };<br/>  db.users.save(user, (err, saved) =&gt; {<br/>    if(err || !saved) {<br/>      console.log("error");<br/>    } else {<br/>      console.log("saved");<br/>    }<br/>  });<br/>}</span></pre><p id="8485" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过编写来调用这些方法:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="89bf" class="mq lc iq mh b gy mr ms l mt mu">console.time("save");</span><span id="47f9" class="mq lc iq mh b gy mv ms l mt mu">for (let i = 1; i &lt; 10; i++) {<br/>  const user = {<br/>    id: i,<br/>    name: "name"<br/>  };<br/>  db.users.save(user, (err, saved) =&gt; {<br/>    if(err || !saved) {<br/>      console.log("error");<br/>    } else {<br/>      console.log("saved");<br/>    }<br/>    console.timeEnd("save");<br/>  });<br/>}</span></pre><p id="155d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须将相同的字符串传递给<code class="fe me mf mg mh b">time</code>和<code class="fe me mf mg mh b">timeEnd</code>。</p><h1 id="c27e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Express从NodeJS服务器下载文件</h1><p id="8b3f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过快捷方式用<code class="fe me mf mg mh b">res.download</code>方法下载一个文件。</p><p id="20c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="91b9" class="mq lc iq mh b gy mr ms l mt mu">const path = reqyire('path');</span><span id="fb60" class="mq lc iq mh b gy mv ms l mt mu">app.get('/download', (req, res) =&gt; {<br/>  const file = path.join(`${__dirname}, 'folder', 'img.jpg');<br/>  res.download(file);<br/>});</span></pre><p id="15de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只需获取路径并将其传递给<code class="fe me mf mg mh b">res.download</code>。</p><h1 id="8d71" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">URl编码Node.js中的字符串</h1><p id="6c03" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">querystring</code>模块对Node.jhs中的字符串进行URI编码。</p><p id="cc66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="65df" class="mq lc iq mh b gy mr ms l mt mu">const querystring = require("querystring");<br/>const result = querystring.stringify({ text: "hello world"});</span></pre><p id="605c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe me mf mg mh b">result</code>的<code class="fe me mf mg mh b">'text=hello%20world’</code>。</p><h1 id="8db3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取Node.js中的本地IP地址</h1><p id="f0f9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">dns</code>模块在一个节点app中获取一个本地IP地址。</p><p id="be35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4f55" class="mq lc iq mh b gy mr ms l mt mu">const dns = require('dns');<br/>const os = require('os');</span><span id="bdf4" class="mq lc iq mh b gy mv ms l mt mu">dns.lookup(os.hostname(), (err, addr, fam) =&gt; {<br/>  console.log(addr);<br/>})</span></pre><p id="8598" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用主机名调用<code class="fe me mf mg mh b">lookup</code>来从主机名中获取IP地址。</p><p id="af0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后<code class="fe me mf mg mh b">addr</code>有了IP地址。</p><h1 id="8879" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ec5f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">dns</code>模块获取IP地址。</p><p id="2853" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">console</code>有方法让我们测量代码的计时。</p><p id="9c89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以动态地要求文件。</p><p id="d8a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">环境变量可以动态设置。</p><h2 id="d935" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">简单英语的JavaScript</h2><p id="eb9d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到它们订阅我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>