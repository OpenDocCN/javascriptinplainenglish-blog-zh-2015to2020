<html>
<head>
<title>There is no point in using TypeScript if you don’t care about types</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果你不关心类型，使用TypeScript是没有意义的</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/there-is-no-point-to-use-typescript-in-your-project-if-you-dont-care-about-types-68131deeb43a?source=collection_archive---------3-----------------------#2019-12-29">https://javascript.plainenglish.io/there-is-no-point-to-use-typescript-in-your-project-if-you-dont-care-about-types-68131deeb43a?source=collection_archive---------3-----------------------#2019-12-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b84c1bca1f6d7bb39faa8cdb0daaca9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJ01QA717MQ3MkeKOWRR8A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">const cat: Cat = (dog as any);</figcaption></figure></div><div class="ab cl jz ka hr kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ig ih ii ij ik"><blockquote class="kg kh ki"><p id="de5b" class="kj kk kl km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ig bi translated">经过一年的TypeScript制作经验，我非常自信地说，它是比普通JavaScript更好的工具，我准备在我的下一个项目中使用它。然而，我会从一开始就禁止所有隐式和显式的“任何”类型用法和类型断言。</p></blockquote></div><div class="ab cl jz ka hr kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ig ih ii ij ik"><h1 id="8989" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">如果在代码库中允许“任何”类型，就不能信任TpeScript类型。</h1><p id="a213" class="pw-post-body-paragraph kj kk in km b kn mg kp kq kr mh kt ku mi mj kx ky mk ml lb lc mm mn lf lg lh ig bi translated">让我们从一个绝对邪恶的——<strong class="km io">任何</strong>类型开始。我认为默认情况下<a class="ae mo" href="https://medium.com/javascript-in-plain-english/what-are-typescript-strict-compiler-options-part-1-5822c67c1df5" rel="noopener"> typescript编译器配置有一个“<em class="kl">strict”</em>规则设置为<em class="kl">“false”</em></a><em class="kl">是一个巨大的错误。</em>因此，由于违约的力量，许多不熟悉技术的人会听之任之。但是对于一个新的项目来说，这是一个可怕的想法<em class="kl"> </em>，因为它减少了打字稿的优势<em class="kl">(这实际上也发生在我们的项目中)。为了理解我的意思，你可以看看下面的例子:</em></p><h2 id="f970" class="mp lj in bd lk mq mr dn lo ms mt dp ls mi mu mv lw mk mw mx ma mm my mz me na bi translated">1.“任何”可以分配给任何类型。</h2><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="af47" class="mp lj in ng b gy nk nl l nm nn"><strong class="ng io">const</strong> b: <strong class="ng io">any </strong>= 4;<br/><strong class="ng io">const </strong>z: <strong class="ng io">string </strong>= b; <em class="kl">// no compile time errors</em></span><span id="0a64" class="mp lj in ng b gy no nl l nm nn"><em class="kl">// some time later somewhere in the code </em><br/>z.toLowerCase(); <em class="kl">// runtime error!</em></span></pre><h2 id="74d8" class="mp lj in bd lk mq mr dn lo ms mt dp ls mi mu mv lw mk mw mx ma mm my mz me na bi translated">2.它打破了类型推理。所有带有“any”的操作都产生“any”:</h2><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="fab5" class="mp lj in ng b gy nk nl l nm nn"><strong class="ng io">const</strong> a: <strong class="ng io">number</strong> = 10;<br/><strong class="ng io">const</strong> b: <strong class="ng io">any </strong>= 4;<br/><strong class="ng io">const </strong>z: <strong class="ng io">string </strong>= a + b;</span><span id="f1fa" class="mp lj in ng b gy no nl l nm nn"><em class="kl">// z is actually type of number<br/>// but compiler now believes that it is a string</em></span></pre><p id="d52c" class="pw-post-body-paragraph kj kk in km b kn ko kp kq kr ks kt ku mi kw kx ky mk la lb lc mm le lf lg lh ig bi translated">所以不管你的类型定义有多好。即使是代码库中的几个“任何”类型也会导致对整个类型系统的不信任。</p></div><div class="ab cl jz ka hr kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ig ih ii ij ik"><h1 id="7c95" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">如果允许类型断言，就不能信任TpeScript类型。</h1><p id="7d32" class="pw-post-body-paragraph kj kk in km b kn mg kp kq kr mh kt ku mi mj kx ky mk ml lb lc mm mn lf lg lh ig bi translated">另一个容易使类型系统充满谎言的类型脚本特性是类型断言。我认为生产代码中的所有类型断言都应该用<a class="ae mo" href="https://palantir.github.io/tslint/rules/no-object-literal-type-assertion/" rel="noopener ugc nofollow" target="_blank"> tslint规则</a>禁止，除了“<a class="ae mo" href="https://blog.logrocket.com/const-assertions-are-the-killer-new-typescript-feature-b73451f35802/" rel="noopener ugc nofollow" target="_blank"> as const </a>”断言。这就是为什么:</p><h2 id="8cc8" class="mp lj in bd lk mq mr dn lo ms mt dp ls mi mu mv lw mk mw mx ma mm my mz me na bi translated">1.如果很容易，你更有可能走捷径:</h2><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="7a3d" class="mp lj in ng b gy nk nl l nm nn"><strong class="ng io">const</strong> catFromApi: <strong class="ng io">unknown</strong> = {<br/>   meow: () =&gt; console.log("meow")<br/>};</span><span id="86e1" class="mp lj in ng b gy no nl l nm nn">// Less than 10 characters to lie TS compiler..<br/><strong class="ng io">const </strong>cat: <strong class="ng io">Dog</strong> = catFromApi <strong class="ng io">as Dog</strong>;</span></pre><p id="07d0" class="pw-post-body-paragraph kj kk in km b kn ko kp kq kr ks kt ku mi kw kx ky mk la lb lc mm le lf lg lh ig bi translated">如果你禁止类型断言语法，但是有一种情况，当你需要断言你的类型来帮助TS编译器时，使用<a class="ae mo" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#user-defined-type-guards" rel="noopener ugc nofollow" target="_blank">类型守卫</a>:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="5283" class="mp lj in ng b gy nk nl l nm nn"><strong class="ng io">function</strong> isCat (obj: <strong class="ng io">unknown</strong>): obj <strong class="ng io">is Cat</strong> {<br/>   if (<strong class="ng io">typeof</strong> obj <strong class="ng io">!==</strong> 'object' <strong class="ng io">||</strong> obj <strong class="ng io">===</strong> null) {<br/>      <strong class="ng io">return</strong> false;<br/>   }<br/>   <br/>   <em class="kl">// now we with TS compiler know for sure that it is an object.</em><strong class="ng io"><br/>   const </strong>possibleCat: <strong class="ng io">Partial&lt;Cat&gt;</strong> = obj; // no errors<br/>   <strong class="ng io">return typeof </strong>possibleCat.meow <strong class="ng io">===</strong> 'function';<br/>}</span><span id="e6c9" class="mp lj in ng b gy no nl l nm nn"><strong class="ng io">if</strong> (isCat(catFromApi)) {<br/>   <strong class="ng io">const </strong>cat: <strong class="ng io">Cat </strong>= catFromApi;<br/>} <strong class="ng io">else</strong> {<br/>   <strong class="ng io">throw new</strong> <strong class="ng io">Error</strong>("Invalid api data, cat is expected.");<br/>}</span></pre><p id="b595" class="pw-post-body-paragraph kj kk in km b kn ko kp kq kr ks kt ku mi kw kx ky mk la lb lc mm le lf lg lh ig bi translated">是的，更多的代码，但是更少的出错的可能性。还有一些像<a class="ae mo" href="https://github.com/gcanti/io-ts" rel="noopener ugc nofollow" target="_blank"> io-ts </a>这样的库可以帮助你以一种更具可读性和声明性的方式编写你的类型保护。</p><h2 id="3cc2" class="mp lj in bd lk mq mr dn lo ms mt dp ls mi mu mv lw mk mw mx ma mm my mz me na bi translated">2.在重构过程中，你有更大的机会引入错误。</h2><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="f825" class="mp lj in ng b gy nk nl l nm nn"><strong class="ng io">interface</strong> <strong class="ng io">Cat </strong>{<br/>   meow: <strong class="ng io">Function</strong>,<br/>   name: <strong class="ng io">string</strong><br/>}</span><span id="734d" class="mp lj in ng b gy no nl l nm nn"><strong class="ng io">const </strong>cat1: <strong class="ng io">Cat</strong> = {<br/>   meow: () =&gt; "meow",<br/>   name: 'daisy',<br/>   hoof: ''  // that line will produce compile error<br/>}</span><span id="4f5d" class="mp lj in ng b gy no nl l nm nn"><strong class="ng io">const</strong> cat2: <strong class="ng io">Cat</strong> = (&lt;<strong class="ng io">Cat</strong>&gt; {<br/>   meow: () =&gt; "meow",<br/>   name: 'daisy',<br/>   hoof: ''  // that line will NOT produce compile error<br/>})</span></pre></div><div class="ab cl jz ka hr kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ig ih ii ij ik"><h1 id="9a95" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">您的团队成员必须学习文档，以找出如何处理上面提到的约束。</h1><p id="d419" class="pw-post-body-paragraph kj kk in km b kn mg kp kq kr mh kt ku mi mj kx ky mk ml lb lc mm mn lf lg lh ig bi translated">这是最重要的部分。JS世界中没有Java等静态类型语言经验的人通常习惯于不关心类型。他们中的许多人将类型视为可选的东西。因此，在每一种复杂的情况下，当我们需要一些<a class="ae mo" href="https://www.typescriptlang.org/docs/handbook/generics.html" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a><em class="kl">类型的一般类型</em>或<em class="kl">条件类型</em>时，他们可能会试图做类型断言或定义“任何”，而不会试图理解发生了什么。这就有可能在你的代码库中传播“谎言类型”。</p><p id="e9dd" class="pw-post-body-paragraph kj kk in km b kn ko kp kq kr ks kt ku mi kw kx ky mk la lb lc mm le lf lg lh ig bi translated">因此，如果你的团队不熟悉高级类型，那么最初拥有如此严格的编译器配置可能会对他们的速度产生一些影响。<a class="ae mo" href="http://www.typescriptlang.org/docs/handbook/advanced-types.html" rel="noopener ugc nofollow" target="_blank">但是最初提高知识的努力值得一个健全的打字系统的益处</a>。从长远来看，你的代码库不容易出现错误，尤其是如果你没有100%的高质量单元测试覆盖率。</p></div><div class="ab cl jz ka hr kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ig ih ii ij ik"><h1 id="3647" class="li lj in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">了解有关TypeScript的更多信息:</h1><p id="de54" class="pw-post-body-paragraph kj kk in km b kn mg kp kq kr mh kt ku mi mj kx ky mk ml lb lc mm mn lf lg lh ig bi translated"><a class="ae mo" href="https://medium.com/javascript-in-plain-english/what-are-typescript-strict-compiler-options-part-1-5822c67c1df5" rel="noopener">TypeScript:第1部分</a>中的这些严格的编译器选项是什么</p><p id="d730" class="pw-post-body-paragraph kj kk in km b kn ko kp kq kr ks kt ku mi kw kx ky mk la lb lc mm le lf lg lh ig bi translated"><a class="ae mo" href="https://medium.com/@kreznykov/what-are-these-strict-compiler-options-in-typescript-part-2-a7e974b13e54" rel="noopener">TypeScript:Part 2</a>中的这些严格的编译器选项是什么</p></div></div>    
</body>
</html>