<html>
<head>
<title>Using Webpack Code Splitting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Webpack代码分割</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-webpack-code-splitting-ed949680b7e?source=collection_archive---------12-----------------------#2020-09-05">https://javascript.plainenglish.io/using-webpack-code-splitting-ed949680b7e?source=collection_archive---------12-----------------------#2020-09-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="fede" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在本教程中，我们将研究一个叫做代码分割的Webpack特性。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/1d55d1f682e6097aa621a0a3ba46e62d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-D4C7C3cbUE0S_w1.png"/></div></div></figure><p id="4034" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">代码分割将允许您通过将主JavaScript文件分割成不同的文件来减小其大小，并在需要时延迟加载这些文件。</p><p id="8787" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在构建单页面应用程序时，这是一个非常重要的特性，因为您的JavaScript文件可能非常大，这意味着您的页面需要等待文件下载完毕才能启动。</p><p id="0465" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">使用代码分割，您可以将代码分割成多个文件，并且只下载应用程序显示页面所需的文件。例如，如果您只在单个页面上使用一个组件，您不需要在应用程序的每个页面上加载该组件，使用代码分割Webpack可以仅在需要时延迟加载该组件。</p><p id="3710" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了能够动态加载脚本，你需要使用<code class="fe lk ll lm ln b">import</code>的Javascript特性，而不是关键字，因为这是静态的，函数<code class="fe lk ll lm ln b">import()</code>。</p><p id="33f4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先你需要安装一个动态导入的babel插件。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="4f58" class="ls lt in ln b gy lu lv l lw lx">npm install babel-plugin-syntax-dynamic-import --save-dev</span></pre><p id="d353" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">安装完成后，你需要添加一个<code class="fe lk ll lm ln b">.babelrc</code>文件到你的项目的根目录，并添加如下配置。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="054d" class="ls lt in ln b gy lu lv l lw lx">{<br/>    "presets": [<br/>        "babel-preset-env"<br/>    ],<br/>    "plugins": [<br/>        "babel-plugin-syntax-dynamic-import"<br/>    ]<br/>}</span></pre><p id="05db" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">用Javascript导入文件非常简单，只需使用<code class="fe lk ll lm ln b">import Module from './location-of-module.js'</code>。</p><p id="f06e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">使用<code class="fe lk ll lm ln b">import()</code>语法，它将接受您想要导入的内容的单个参数，这将返回一个允许您解析模块内容的承诺。</p><p id="bdb3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">例如，要使用它来导入Vue组件，您将使用以下语法。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="145b" class="ls lt in ln b gy lu lv l lw lx">Vue.component('search', (resolve) =&gt; {<br/>    import('./components/Search.vue')<br/>      .then((Search) =&gt; {<br/>        resolve(Search.default)<br/>      })<br/>  })</span></pre><p id="ee94" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当你使用类似于<code class="fe lk ll lm ln b">npm run dev</code>的东西来构建你的Javascript时，你会看到你的普通主Javascript被构建，并且会有一个新的0.js文件。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="ab25" class="ls lt in ln b gy lu lv l lw lx">DONE  Compiled successfully in 871ms<br/><br/>     Asset     Size  Chunks                    Chunk Names<br/>      0.js  75.9.8 kB       0  [emitted]  [big]<br/>/js/app.js   900.7 kB       1  [emitted]         /js/app</span></pre><p id="8b4b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这个<code class="fe lk ll lm ln b">0.js</code>文件将包含您的搜索组件，只有当组件需要显示在您的应用程序上时，Webpack才会获取这个文件。</p><h1 id="395c" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">Vue单一文件组件</h1><p id="6609" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">要在你的Vue单个文件组件中使用它，语法甚至更简单，你只需要在你定义组件的地方使用导入功能。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="5e9f" class="ls lt in ln b gy lu lv l lw lx">const app = new Vue({<br/>    el: '#app',<br/>    components: {<br/>      Search: () =&gt; import('./components/Search.vue'),<br/>    }<br/>});</span></pre><h1 id="c85e" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">与vue路由器一起使用</h1><p id="7336" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">如果你有一个使用Vue Router来定义在页面上显示什么组件的单页面应用程序，你仍然可以使用与上面相同的技术进行代码分割。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="971f" class="ls lt in ln b gy lu lv l lw lx">export function createRouter () {<br/>  return new Router({<br/>    mode: 'history',<br/>    routes: [<br/>      { path: '/', component: () =&gt; import('./components/Home.vue') },<br/>      { path: '/item/:id', component: () =&gt; import('./components/Item.vue') }<br/>    ]<br/>  })<br/>}</span></pre><h1 id="eb15" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">改变公共道路</h1><p id="5e1d" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">我发现使用代码分割的一个问题是，在不同的环境中，JavaScript文件存储在不同的位置。</p><p id="1437" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">要解决这个问题，你可以告诉Webpack你的公共文件夹在哪里，这样你就可以根据环境来改变它。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="9f79" class="ls lt in ln b gy lu lv l lw lx">const ASSET_PATH = process.env.ASSET_PATH || '/';<br/>mix.webpackConfig({<br/>  output: {<br/>    publicPath: ASSET_PATH<br/>  }<br/>})</span></pre><h1 id="4b8d" class="ly lt in bd lz ma mb mc md me mf mg mh jt mi ju mj jw mk jx ml jz mm ka mn mo bi translated">预取模块</h1><p id="6c21" class="pw-post-body-paragraph ko kp in kq b kr mp jo kt ku mq jr kw kx mr kz la lb ms ld le lf mt lh li lj ig bi translated">如果你有一个组件要延迟加载到你的应用中，你可以通过告诉它预取这个文件来加速浏览器的处理。</p><p id="02fe" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">例如，假设您有一个登录按钮，它会弹出一个登录模式，这个登录模式可以在它自己的组件文件中，您可以使用上述技术对它进行代码拆分。当您为登录模式定义操作时，您将把它放在登录按钮组件中，并导入登录模式。</p><p id="c878" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">使用Webpack注释，您可以使用下面的代码告诉Webpack预取它。</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="de04" class="ls lt in ln b gy lu lv l lw lx">import(/* webpackPrefetch: true */ "LoginModal");</span></pre><p id="12ca" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，Webpack会自动将<code class="fe lk ll lm ln b">&lt;link rel="prefetch" href="login-modal.js"&gt;</code>附加到页面的头部，这将告诉浏览器预取这个脚本，因为如果用户单击登录按钮，将需要它。</p><p id="e382" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，您可以在项目中使用这一功能来拆分代码，并仅在需要时自动延迟加载这些组件。</p></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><p id="57fc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nb">原载于【https://paulund.co.uk】<a class="ae nc" href="https://paulund.co.uk/webpack-code-splitting" rel="noopener ugc nofollow" target="_blank"><em class="nb"/></a><em class="nb">。</em></em></p></div></div>    
</body>
</html>