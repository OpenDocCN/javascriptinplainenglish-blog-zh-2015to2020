<html>
<head>
<title>Upload files and Images to Firebase and retrieve a downloadable URL in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将文件和图像上传到Firebase，并在Angular中检索可下载的URL</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/upload-files-and-images-to-firebase-and-retrieve-a-downloadable-url-a5b3467bb89c?source=collection_archive---------2-----------------------#2020-04-07">https://javascript.plainenglish.io/upload-files-and-images-to-firebase-and-retrieve-a-downloadable-url-a5b3467bb89c?source=collection_archive---------2-----------------------#2020-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/88e54a8470af0cee1322e79eb0eb8b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AHaW7_Jk7v3gLLm71EnIw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@stairhopper?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Alex Holyoake</a> on <a class="ae kc" href="https://unsplash.com/s/photos/fire-store?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="9faa" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="a442" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在<a class="ae kc" href="https://medium.com/javascript-in-plain-english/set-up-firebase-in-your-angular-app-for-the-first-time-79e0875e504b" rel="noopener">之前的文章</a>中，我解释了如何在Angular应用程序中设置Firebase。在本文中，我将解释如何将图像或任何其他文件上传到Angular storage并获得一个可下载的URL，该URL可用于在应用程序中查看图像或将URL保存在Firebase数据库或另一个服务器端数据库中。</p><p id="bd3e" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">根据上一篇文章，我们导入了<strong class="ld ir">AngularFireDatabaseModule</strong>来启用模块中Firebase的数据库功能(以及<em class="me"> Firestore </em>)。<strong class="ld ir"> </strong>但是，由于我们想要上传文件/图像并保存它们，我们不能使用数据库，而是可以使用Firebase提供的<strong class="ld ir">存储</strong>功能。</p><h1 id="4948" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">入门指南</h1><p id="3621" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，如果你还没有在你的angular应用中设置firebase，请参考我之前的文章《<a class="ae kc" href="https://medium.com/javascript-in-plain-english/set-up-firebase-in-your-angular-app-for-the-first-time-79e0875e504b" rel="noopener"> <em class="me">第一次在你的Angular App中设置Firebase</em></a>》并完全按照那篇文章中的<strong class="ld ir">步骤1 </strong>和<strong class="ld ir">步骤2 </strong>中的全部步骤进行操作。如果你做到了这些，你就有资格继续留在这里。</p><h1 id="89b4" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤1(激活Firebase存储)</h1><ol class=""><li id="af5e" class="mf mg iq ld b le lf li lj lm mh lq mi lu mj ly mk ml mm mn bi translated">在线进入你的firebase控制台，打开你的firebase项目的控制台。</li><li id="6db3" class="mf mg iq ld b le mo li mp lm mq lq mr lu ms ly mk ml mm mn bi translated">按照下图中的步骤，转到存储- →规则- →将规则编辑为“真”并发布。</li></ol><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/cab9b8311e77c659af84a40d8670ce18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39Y30nzEnLKY5G8rxu9IzA.png"/></div></div></figure><p id="6df3" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在这里，我们允许书写，你可以根据自己的需要自定义规则。</p><h1 id="aead" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤Angular应用程序中的配置)</h1><ol class=""><li id="92d6" class="mf mg iq ld b le lf li lj lm mh lq mi lu mj ly mk ml mm mn bi translated">。您必须在app.module.ts中导入AngularFireStorageModule，如下所示，以启用存储功能。</li></ol><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="e9f7" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤3(上传后获取可下载的URL)</h1><p id="914a" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我已经使用命令<strong class="ld ir"> ng g c fileuploader创建了一个组件。</strong></p><ol class=""><li id="1a80" class="mf mg iq ld b le lz li ma lm na lq nb lu nc ly mk ml mm mn bi translated">我创建了一个只接受图像类型的文件输入按钮..</li></ol><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d9ed" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这里，在<img/>标签中，我使用了一个错误属性来加载一个默认的图片。</p><p id="4fe7" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">选择图像后，图像会自动上传到存储器，上传完成后即可查看图像。</p><p id="5f24" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">2.编辑。ts文件如下</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="b442" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这里，在第13行中，在存储器中创建了一个名为“images”的文件夹，上传的文件保存在该文件夹中，如第25行中的文件路径所定义的。</p><p id="1800" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">第26行-→<strong class="ld ir">firestorage . upload(&lt;path&gt;，&lt; file &gt; ) </strong>方法返回一个<strong class="ld ir"><em class="me">AngularFireUploadTask</em></strong>包含几个关于上传任务的信息和有用的方法。我们使用这个<em class="me">任务</em>来获取可下载的url，如第31行所示。</p><p id="4404" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">3.现在，您可以运行项目并上传图像。</p><h1 id="5d04" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤4(上传时显示进度条)</h1><p id="1b9e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果需要进度条，也可以添加。我在这里使用html中的默认进度视图。学习基本流程后可以自定义进度条。</p><ol class=""><li id="fb71" class="mf mg iq ld b le lz li ma lm na lq nb lu nc ly mk ml mm mn bi translated">我编辑了我的html文件，并为进度条添加了一些新行，如下所示</li></ol><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e08f" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">2.编辑。ts文件，并添加我在注释中显示的新行。(第18行和第32行)</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3e6e" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在这里，我也使用了<strong class="ld ir">任务</strong>来获取上传百分比，该百分比返回一个<strong class="ld ir">可观察值&lt;编号&gt; </strong>。(不要试图在控制台中记录这些值，因为这没有用..) .</p><p id="4343" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">3.好啊，你可以走了。赶紧运行app自己看看。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/063a36fd9e8c21dc0b3350c1f80e5648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*9N5_jUzfAPPmDM75cXotEQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Before upload with default image</figcaption></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/774c3797bfa21fc3bc8109e5b1dde36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjfZMkqxC4B_PUaOiQCnYQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">While uploading</figcaption></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/ec94ef6c5d24bf11cdc7acda2b988c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYw4u2GbFlQ4Lh9Z9piU8w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">After uploading</figcaption></figure><h1 id="abd2" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="6010" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在这里，您可以了解使用FireStorage时需要导入哪些模块，并了解作为<strong class="ld ir"> AngularFireStorage.upload()方法的结果而返回的<strong class="ld ir"> AngularFireUploadTask </strong>。</strong><em class="me">AngularFireUploadTask</em><strong class="ld ir"/>为我们提供了非常有用的方法来处理上传过程，我在本文中只使用了其中的两种方法，但还有其他方法可以暂停、停止或恢复上传过程。和他们一起玩就看你自己了<strong class="ld ir">。</strong></p><h2 id="2832" class="ng ke iq bd kf nh ni dn kj nj nk dp kn lm nl nm kr lq nn no kv lu np nq kz nr bi translated"><strong class="ak">用简单英语写的JavaScript的注释:</strong></h2><p id="b4b6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，用你的Medium用户名给我们发邮件到<a class="ae kc" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>，我们会把你添加为作者。</p></div></div>    
</body>
</html>