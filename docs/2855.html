<html>
<head>
<title>React Tips — Force Render, Conditionals, Listen for Navigation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应提示—强制渲染，条件，监听导航</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-tips-force-render-conditionals-listen-for-navigation-d1121912eae8?source=collection_archive---------10-----------------------#2020-07-29">https://javascript.plainenglish.io/react-tips-force-render-conditionals-listen-for-navigation-d1121912eae8?source=collection_archive---------10-----------------------#2020-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f91aba33b858a85e736300e494e889c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*71qA840KKk32RBK1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@chaseycasey?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Casey Chae</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9f89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些编写更好的React应用程序的技巧。</p><h1 id="f6a3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何强制一个函数组件呈现</h1><p id="4270" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用use-force-update包强制一个函数组件进行渲染。</p><p id="3ebd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="03b0" class="mn lc iq mj b gy mo mp l mq mr">npm install use-force-update</span></pre><p id="52a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="141d" class="mn lc iq mj b gy mo mp l mq mr">yarn add use-force-update</span></pre><p id="51b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d243" class="mn lc iq mj b gy mo mp l mq mr">import useForceUpdate from 'use-force-update';</span><span id="41f1" class="mn lc iq mj b gy ms mp l mq mr">const App = () =&gt; {<br/>  const forceUpdate = useForceUpdate();</span><span id="461b" class="mn lc iq mj b gy ms mp l mq mr">  const rerender = () =&gt; {<br/>    console('rerendering');<br/>    forceUpdate();<br/>  };</span><span id="c9c4" class="mn lc iq mj b gy ms mp l mq mr">  return &lt;button onClick={rerender} /&gt;;<br/>};</span></pre><p id="8776" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们让<code class="fe mt mu mv mj b">useForceUpdate</code>钩子返回<code class="fe mt mu mv mj b">forceUpdate</code>函数，让我们随时更新。</p><p id="4538" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以设置一个状态来更新React组件。</p><p id="a751" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="69a2" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from 'react';</span><span id="5167" class="mn lc iq mj b gy ms mp l mq mr">function useForceUpdate(){<br/>  const [value, setValue] = useState(0); <br/>  return () =&gt; setValue(value =&gt; ++value);<br/>}</span><span id="a22a" class="mn lc iq mj b gy ms mp l mq mr">function App() {<br/>  const forceUpdate = useForceUpdate();</span><span id="347a" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div&gt;  <br/>      &lt;button onClick={forceUpdate}&gt;<br/>        re-render<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="5fd7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了自己的<code class="fe mt mu mv mj b">useForceUpdate</code>钩子来更新一个<code class="fe mt mu mv mj b">value</code>状态。</p><p id="666c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">useState</code>钩子返回一个状态变量和一个函数来更新它。</p><p id="8080" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当我们更新一个状态，React将再次呈现组件。</p><h1 id="effe" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">React函数组件中的componentDidMount等效项</h1><p id="64e2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">函数组件中<code class="fe mt mu mv mj b">componentDidMount</code>的等价物是带有空数组的<code class="fe mt mu mv mj b">useEffect</code>钩子。</p><p id="8123" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="30db" class="mn lc iq mj b gy mo mp l mq mr">useEffect(() =&gt; {<br/>  //...<br/>}, []);</span></pre><p id="7b60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使回调中的代码仅在组件挂载时加载。</p><p id="0123" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以将变量传递给数组，以观察这些值的变化:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="07dd" class="mn lc iq mj b gy mo mp l mq mr">useEffect(() =&gt; {<br/>  //...<br/>}, [foo, bar]);</span></pre><p id="af52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">内容可以是任何值，如状态、道具等。</p><h1 id="4e49" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用反应路由器检测路由变化</h1><p id="6629" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用React路由器通过<code class="fe mt mu mv mj b">history.listen</code>方法检测路由变化。</p><p id="7462" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8fdb" class="mn lc iq mj b gy mo mp l mq mr">history.listen((location, action) =&gt; {<br/>  console.log(location, action);<br/>})</span></pre><p id="222b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">location</code>是本地位置对象，它拥有所有URL数据，就像路径名的<code class="fe mt mu mv mj b">pathname</code>一样。</p><p id="5f83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">search</code>为查询字符串。</p><p id="3175" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">hash</code>为哈希后的字符串。</p><p id="1205" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">action</code>具有导航动作的名称。</p><h1 id="3801" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">正在componentDidMount()上设置状态</h1><p id="8787" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在<code class="fe mt mu mv mj b">componentDidMount</code>方法中设置状态不是反模式。</p><p id="e95a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是在组件挂载时设置状态的推荐做法。</p><p id="e49c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以用它来获取API数据并设置状态:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8c19" class="mn lc iq mj b gy mo mp l mq mr">componentDidMount() {<br/>  fetch("https://randomuser.me/api")<br/>    .then(res =&gt; res.json())<br/>    .then(<br/>      (result) =&gt; {<br/>        this.setState({<br/>          isLoaded: true,<br/>          user: results[0]<br/>        });<br/>      },<br/>      (error) =&gt; {<br/>        this.setState({<br/>          isLoaded: true,<br/>          error<br/>        });<br/>      }<br/>    )<br/>}</span></pre><p id="c30f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用fetch API从一个API获取数据。</p><p id="8513" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们在第一个<code class="fe mt mu mv mj b">then</code>回调中获取结果数据，为数据设置状态。</p><p id="b655" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二次回调中，我们将<code class="fe mt mu mv mj b">isLoaded</code>状态设置为<code class="fe mt mu mv mj b">false</code>和<code class="fe mt mu mv mj b">error</code>状态。</p><h1 id="ca85" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在React渲染函数中使用if…else…语句</h1><p id="8ea0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有几种方法可以用React有条件地显示事物。</p><p id="77a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用各种布尔表达式来做到这一点。</p><p id="eedb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="bd69" class="mn lc iq mj b gy mo mp l mq mr">render() {<br/>  const { isLoggedIn } = this.state;<br/>  return (<br/>    &lt;div&gt;<br/>      {isLoggedIn ? (<br/>        &lt;LogoutButton onClick={this.handleClick} /&gt;<br/>      ) : (<br/>        &lt;LoginButton onClick={this.handleClick} /&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ced6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们获取<code class="fe mt mu mv mj b">isLoggedIn</code>状态，并使用它来检查用户是否登录。</p><p id="2ef0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用户不是，那么我们返回<code class="fe mt mu mv mj b">LogoutButton</code>。</p><p id="99a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们返回<code class="fe mt mu mv mj b">LoginButton</code>。</p><p id="9a91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用if-else语句将组件赋给变量/</p><p id="8f7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2dcf" class="mn lc iq mj b gy mo mp l mq mr">render() {<br/>  let button;<br/>  if (isLoggedIn) {<br/>    button = &lt;LogoutButton onClick={this.handleClick} /&gt;;<br/>  } else {<br/>    button = &lt;LoginButton onClick={this.handleClick} /&gt;;<br/>  }</span><span id="bc97" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div&gt;<br/>      {button}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ca26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用if-else语句而不是三元表达式来检查<code class="fe mt mu mv mj b">isLoggedIn</code>。</p><p id="9ae0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将组件分配给了<code class="fe mt mu mv mj b">button</code>变量，并对其进行渲染，而不是内联编写所有内容。</p><p id="dcc2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我们可以在条件语句中编写更长的表达式。</p><p id="d2b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以使用<code class="fe mt mu mv mj b">&amp;&amp;</code>操作符来显示给定条件下的事物。</p><p id="343b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6277" class="mn lc iq mj b gy mo mp l mq mr">render() {<br/>  return (<br/>    &lt;div&gt;<br/>      {cartItems.length &gt; 0 &amp;&amp;<br/>        &lt;h2&gt;<br/>          You have {cartItems.length} in the cart.<br/>        &lt;/h2&gt;<br/>      }<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="df08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe mt mu mv mj b">cartItems.length &gt; 0</code>是<code class="fe mt mu mv mj b">true</code>，那么它之后的东西被渲染。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/3e18b3685210a96f257b2dbecc1cb3e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ppaz9rN2XUH-RV2v"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@thejoshhoward?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Josh Howard</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="cb39" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="821d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以强制组件以各种方式呈现。</p><p id="dadb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以用几种语句和表达式有条件地显示事物。</p><p id="d125" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe mt mu mv mj b">history.listen</code>来监听React路由器中的变化。</p><h2 id="be81" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">简单英语的JavaScript</h2><p id="c297" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>