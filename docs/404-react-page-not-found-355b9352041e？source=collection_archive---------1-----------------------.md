# 404:æœªæ‰¾åˆ°ååº”é¡µé¢

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/404-react-page-not-found-355b9352041e?source=collection_archive---------1----------------------->

[*åœ¨é»‘æš—æ¨¡å¼ä¸‹é˜…è¯»æœ¬*](https://www.blog.karenying.com/posts/404-react-page-not-found) *ä¸Šçš„*[*blog.karenying.com*](https://www.blog.karenying.com/)*ã€‚*

![](img/f5ecbb3a5dd4f6981ba90dce5fa5a4a7.png)

Netlifyâ€™s 404 Page

æ‚¨åˆšåˆšå°†ç¬¬ä¸€ä¸ª [Create React åº”ç”¨](https://reactjs.org/docs/create-a-new-react-app.html)éƒ¨ç½²åˆ° Netlifyã€‚`Site is live`æ˜¾ç¤ºåœ¨æ»šåŠ¨éƒ¨ç½²æ—¥å¿—ä¸­ã€‚æˆåŠŸğŸ‰

ä½ æ„‰å¿«åœ°è®¿é—®ä½ çš„æ–°ç½‘ç«™ï¼Œç‚¹å‡»ç›¸å…³é“¾æ¥ã€‚å¥½æ ·çš„ï¼Œ[ååº”è¿‡æ¥çš„è·¯ç”±å™¨](https://www.npmjs.com/package/react-router)å·²ç»æŠ•å…¥äº†å·¥ä½œã€‚ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆæ£’ã€‚

ä½ åœ¨åœ°å€æ ä¸­è¾“å…¥ä¸€ä¸ªè·¯å¾„ï¼Œä½ çŸ¥é“å®ƒæ˜¯ç”± React è·¯ç”±å™¨å¤„ç†çš„â€¦â€¦ç„¶åå¾—åˆ°â€œæ‰¾ä¸åˆ°é¡µé¢â€çš„æç¤ºã€‚å•Šï¼Ÿ

ç¡®ä¿¡ä½ ä¸€å®šåšé”™äº†ä»€ä¹ˆï¼Œä½ åœ¨ä½ çš„æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åºå¹¶è¯•å›¾å¤åˆ¶è¿™ä¸ªé”™è¯¯ã€‚ä½†æ˜¯è·¯ç”±åœ¨æœ¬åœ°éå¸¸å¥½ã€‚å®ƒç”šè‡³é€‚ç”¨äºç”Ÿäº§ç‰ˆæœ¬:`npm run build`å’Œ`serve -s build`ã€‚é‚£ä¹ˆè¿™é‡Œçš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

# å•é¡µåº”ç”¨ç¨‹åºä¸­çš„è·¯ç”±

å¦‚æœä½ ä½¿ç”¨ [Create React App](https://reactjs.org/docs/create-a-new-react-app.html) (CRA)å’Œ [React Router](https://www.npmjs.com/package/react-router) ï¼Œä½ çš„ç«™ç‚¹å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå•é¡µé¢åº”ç”¨(SPA)ã€‚

ä¸ä¼ ç»Ÿçš„å¤šé¡µé¢åº”ç”¨ç¨‹åºç›¸åï¼Œspa åªç»´æŠ¤ä¸€ä¸ª HTML æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯`index.html`ã€‚spa ä¾èµ–äºå®¢æˆ·ç«¯è·¯ç”±ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè·¯å¾„æä¾›ä¸åŒçš„ HTML æ–‡ä»¶ã€‚React Router æ˜¯ä¸€ä¸ªå—æ¬¢è¿çš„å®¢æˆ·ç«¯è·¯ç”±åº“ï¼Œæ¯å‘¨ä¸‹è½½é‡æ¥è¿‘ 300 ä¸‡æ¬¡ã€‚

ç”¨æœ€ç®€å•çš„è¯æ¥è¯´ï¼ŒReact è·¯ç”±å™¨å°†è·¯å¾„è¿æ¥åˆ°ä¸€ä¸ªç»„ä»¶ã€‚å½“æ‰¾åˆ°è·¯å¾„æ—¶ï¼ŒReact Router ä¼šå°†ç›¸å…³çš„å…ƒç´ æ’å…¥ DOM æ ‘ä¸­ï¼Œè€Œä¸éœ€è¦åˆ·æ–°é¡µé¢ã€‚

ç„¶è€Œï¼Œä¸ºäº†ä½¿è¿™ä¸ªè¿‡ç¨‹å·¥ä½œï¼ŒHTTP GET è¯·æ±‚å¿…é¡»åªä»`index.html`ä¸­æ£€ç´¢æ•°æ®â€”â€”æ‰€æœ‰çš„ React è·¯ç”±å™¨é€»è¾‘éƒ½åœ¨è¿™é‡Œå¤„ç†ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨å¿…é¡»å°†æ‰€æœ‰è¯·æ±‚å‘é€åˆ°`index.html`ã€‚

é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™åœ¨å½“åœ°è¡Œå¾—é€šå‘¢ï¼Ÿè¿™å°±æ˜¯ Webpack çš„ç”¨æ­¦ä¹‹åœ°ã€‚

# ç½‘ç»œåŒ…

æœ‰æ²¡æœ‰æƒ³è¿‡å½“ä½ ç©¿ç€ CRA è·‘`npm start`æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

`npm start`åœ¨å¼•æ“ç›–ä¸‹è¿è¡Œ`react-scripts start`(åœ¨ä½ çš„`package.json`é‡Œæ£€æŸ¥ä¸€ä¸‹)ã€‚å¦‚æœæˆ‘ä»¬å·çœ‹`/node_modules`ä¸‹çš„`react-scripts`æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° CRA ä½¿ç”¨ [Webpack](https://webpack.js.org/) æ¥æ†ç»‘å’ŒæœåŠ¡ä½ çš„åº”ç”¨ã€‚

æ‚¨çš„åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ Webpackâ€œè®¾ç½®â€éƒ½ä¿å­˜åœ¨`/react-scripts/config`ä¸‹çš„`webpackDevServer.config.js`å’Œ`webpack.config.js`ä¸­ã€‚

å¯¹äºåº”ç”¨ç¨‹åºçš„å¼€å‘ç‰ˆæœ¬ï¼ŒWebpack å°†[å†å² API å›é€€é€‰é¡¹](https://webpack.js.org/configuration/dev-server/#devserverhistoryapifallback)è®¾ç½®ä¸º trueã€‚åœ¨`webpackDevServer.config.js`ä¸­ï¼ŒWebpack è¢«æŒ‡ç¤ºå°†æ‰€æœ‰è¯·æ±‚é‡å®šå‘åˆ°`paths.publicUrlOrPath`ï¼Œå®ƒæ˜¯æœåŠ¡äº`index.html`çš„åŸºæœ¬ URL`[http://localhost:3000](http://localhost:3000/)/`:

![](img/d4396979bd22ee7127292db4e316b1ed.png)

*Examining* `webpackDevServer.config.js`

å¯¹äºå½“ä½ `npm run build`å’Œ`serve -s build`æ—¶æä¾›çš„äº§å“ç‰ˆæœ¬ï¼Œæˆ‘ä»¬è½¬å‘`webpack.config.js`ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†[å¯¼èˆªå›é€€é€‰é¡¹](https://developers.google.com/web/tools/workbox/reference-docs/latest/module-workbox-webpack-plugin.GenerateSW)è®¾ç½®ä¸º`paths.publicUrlOrPath + 'index.html'`:

![](img/26d8366425e41f9c354442ecf346dedb.png)

*Examining webpack.config.js*

ç§å•Šã€‚åŒæ ·ï¼ŒWebpack å°†æ‰€æœ‰æµé‡å¯¼å‘`index.html`ã€‚

å¤ªå¥½äº†ï¼Œè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆå®ƒåœ¨æ‚¨çš„æœ¬åœ°ç¯å¢ƒä¸­éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯åœ¨ Netlify ä¸Šå‘¢ï¼Ÿ

# ç½‘ç»œç”Ÿæ´»

è®©æˆ‘ä»¬å›åˆ°æ‚¨åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„ç”Ÿäº§æ„å»ºã€‚å½“æ‚¨è¿è¡Œ`npm run build`æ—¶ï¼ŒWebpack å°†æ‰€æœ‰ç»„ç»‡å¥½çš„ä»£ç æ‰“åŒ…å¹¶ç¼©å°åˆ°æ ¹ç›®å½•ä¸‹çš„`build`æ–‡ä»¶å¤¹ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹æ­£æ˜¯ Webpack åœ¨æœ¬åœ°ä½œä¸ºäº§å“ç‰ˆæœ¬ä½¿ç”¨çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ Netlify åœ¨äº’è”ç½‘ä¸Šæä¾›çš„å†…å®¹ã€‚

ä½†æ˜¯ä½ æœ‰æ²¡æœ‰è¯•è¿‡ç”¨ Python çš„ [http.server](https://docs.python.org/3.0/library/http.server.html) æ¥æœåŠ¡ä½ çš„åº”ç”¨å‘¢ï¼Ÿå®ƒéœ€è¦ä¸€ä¸ª`index.html`æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ‚¨çš„ prod `build`æ–‡ä»¶å¤¹ä¸­è¿è¡Œå®ƒ:

```
$ cd /build
$ python3 -m http.server
```

å‰å¾€`[http://localhost:8000/](http://localhost:8000/)`ã€‚è¾“å…¥æ‚¨åœ¨ React è·¯ç”±å™¨ä¸­æŒ‡å®šçš„è·¯å¾„ï¼Œæˆ–å•å‡»ç›¸å¯¹é“¾æ¥å¹¶ç‚¹å‡»åˆ·æ–°ã€‚æ‚¨åº”è¯¥æ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Œå¹¶çœ‹åˆ°ä»¥ä¸‹ 404 é”™è¯¯æ¶ˆæ¯:

![](img/c2cc480fd1f48c06ebb8c3de56f8ab4f.png)

Another 404 page ğŸ˜

è¿™æ­£æ˜¯ Netlify ä¸Šå‘ç”Ÿçš„äº‹æƒ…ã€‚

Netlify çš„æœåŠ¡å™¨å’Œ Python çš„ http.server ä¸å¤„ç†åˆ°`index.html`çš„é‡å®šå‘ã€‚å°½ç®¡ Netlify æä¾› Webpack æ†ç»‘çš„æœåŠ¡ï¼Œä½†å®ƒå¹¶ä¸ä½¿ç”¨ Webpack æ¥å®é™…æä¾›é¡µé¢æœåŠ¡ã€‚

å¦‚æœä½ ä¸æ‰‹åŠ¨è¾“å…¥åœ°å€æˆ–åˆ·æ–°é¡µé¢ï¼Œä¸€åˆ‡éƒ½å¾ˆå®Œç¾ã€‚è¿™æ˜¯å› ä¸ºæ‚¨æ²¡æœ‰å¯¹è¿™ä¸¤ä¸ªæ“ä½œæå‡ºæ–°çš„è¯·æ±‚ã€‚ä½ æ²¡æœ‰ç¦»å¼€`index.html`ï¼Œè€Œ React è·¯ç”±å™¨æ­£åœ¨æ­£ç¡®åœ°å·¥ä½œã€‚ç„¶è€Œï¼Œå½“ä½ åˆ·æ–°æˆ–è¾“å…¥ä¸€ä¸ªç½‘å€æ—¶ï¼Œç½‘ç«™å°±å´©æºƒäº†ã€‚

å¯¹æ­¤ä½ èƒ½åšäº›ä»€ä¹ˆï¼Ÿ

## è§£å†³æ–¹æ¡ˆ

å¹¸è¿çš„æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ Netlify çš„[é‡å®šå‘é€‰é¡¹](https://docs.netlify.com/routing/redirects/)ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼ŒNetlify éœ€è¦åœ¨æ ¹ç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸º`_redirects`çš„æ–‡ä»¶ã€‚è¿™æ¡èˆªçº¿æ˜¯å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹:

```
/* /index.html 200
```

è¯¥è§„åˆ™æŒ‡å®šæ‰€æœ‰è·¯å¾„(`/*`)é‡å®šå‘åˆ°`/index.html` [è€Œä¸æ”¹å˜æµè§ˆå™¨åœ°å€æ ](https://docs.netlify.com/routing/redirects/redirect-options/) ( `200`)ä¸­çš„ URLã€‚

ä½ å¯ä»¥**æˆ–è€…**

*   æŠŠè¿™ä¸ª`_redirects`æ–‡ä»¶å’Œä¸Šé¢çš„ä¸€è¡Œæ”¾åˆ°ä½  app çš„`public`æ–‡ä»¶å¤¹é‡Œã€‚è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½åŸå°ä¸åŠ¨åœ°æ”¾å…¥`/build`çš„æ ¹ç›®å½•ä¸­ã€‚

**æˆ–**

*   å°†`&& echo â€˜/* /index.html 200â€™ | cat >build/_redirects`æ·»åŠ åˆ°`package.json`ä¸­çš„`build`è„šæœ¬ä¸­ã€‚å¦‚æœæ‚¨æ£€æŸ¥éƒ¨ç½²æ—¥å¿—ï¼ŒNetlify ä¼šåœ¨æ¯æ¬¡éƒ¨ç½²ä¹‹å‰è¿è¡Œ`npm build`ã€‚è¿™æ ·ï¼ŒNetlify æ¯æ¬¡éƒ½ä¼šåœ¨æ ¹ç›®å½•ä¸­æ‰‹åŠ¨åˆ›å»º`_redirects`æ–‡ä»¶ã€‚

é€šè¿‡æ·»åŠ `_redirects`æ–‡ä»¶ï¼Œæˆ‘ä»¬å¤åˆ¶äº† Webpack åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„åŠŸèƒ½ã€‚

# ç»“è®º

æ‚¨åˆšåˆšæˆåŠŸä¿®å¤äº†å¯æ€•çš„ 404 Netlify é”™è¯¯ï¼åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† React è·¯ç”±å™¨å¦‚ä½•ä¸º spaã€Webpack é…ç½®å’Œ Netlify é‡å®šå‘è§„åˆ™å·¥ä½œã€‚

ç”±äºè¿™æ˜¯ä¸€ä¸ª[å¸¸è§çš„](https://stackoverflow.com/search?q=react+router+404)é—®é¢˜ï¼Œæˆ‘é€šè¿‡è°·æ­Œæœç´¢å¾ˆå®¹æ˜“å°±æ‰¾åˆ°äº†è§£å†³åŠæ³•ã€‚è¿™æ¯•ç«Ÿæ˜¯ä¸€è¡Œç¨‹åºã€‚ç„¶è€Œï¼Œæˆ‘æ‰¾ä¸åˆ°ä¸€ä¸ªå¯é çš„è§£é‡Šæ¥è§£é‡Š*ä¸ºä»€ä¹ˆ*ä¼šæˆåŠŸã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¡«è¡¥è¿™ä¸ªç©ºç™½ã€‚

Netlify ä¸æ˜¯ä¸€ä¸ªäººï¼æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼ŒPython çš„ http.server æ˜¯å¦ä¸€ä¸ªç½ªé­ç¥¸é¦–ã€‚ä»»ä½•é™æ€æ‰˜ç®¡çš„ SPA éƒ½ä¼šå‡ºç°è¿™ç§å·å·æ‘¸æ‘¸çš„é”™è¯¯ã€‚ä½œä¸ºé‡å®šå‘çš„æ›¿ä»£ï¼Œ[æ•£åˆ—è·¯ç”±](https://itnext.io/why-using-hash-based-urls-in-your-react-spa-will-save-you-more-time-than-you-think-a21e2c560879)ä¹Ÿå…è®¸ SPA å®¢æˆ·ç«¯è·¯ç”±ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œä¸€å®šè¦å»çœ‹çœ‹ã€‚

## è¿›ä¸€æ­¥é˜…è¯»

*   [GitHub é¡µé¢è§£å†³æ–¹æ¡ˆ](https://github.com/rafrex/spa-github-pages)
*   [Heroku è§£å†³æ–¹æ¡ˆ](https://hackernoon.com/deploying-any-react-app-to-heroku-1ee6db9b97d3)
*   [Apache è§£å†³æ–¹æ¡ˆ](https://www.sej-ko.dk/2017/03/29/routing-single-page-application-on-apache-with-htaccess/)
*   [é‡‡ç”¨å“ˆå¸Œè·¯ç”±çš„è§£å†³æ–¹æ¡ˆ](https://itnext.io/why-using-hash-based-urls-in-your-react-spa-will-save-you-more-time-than-you-think-a21e2c560879)

æ„Ÿè°¢é˜…è¯»ã€‚ç¼–ç å¿«ä¹ï¼