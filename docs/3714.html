<html>
<head>
<title>JavaScript Under The Hood Pt. 6: Asynchronous Callbacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引擎盖下的JavaScript。6:异步回调</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-under-the-hood-pt-6-asynchronous-callbacks-f8e2e1e332bb?source=collection_archive---------15-----------------------#2020-10-19">https://javascript.plainenglish.io/javascript-under-the-hood-pt-6-asynchronous-callbacks-f8e2e1e332bb?source=collection_archive---------15-----------------------#2020-10-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="fd6f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">理解JavaScript中的异步性和同步性，它们意味着什么，并能够有效地向他人解释它们。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/5836f0e95a3188067e71c6d20fee553d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2VVpfM7RoFsNOU0LFhcywQ.png"/></div></div></figure></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><p id="fa65" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">JavaScript中的异步是一个棘手的话题。主要是因为这个词本身(或者更确切地说，它的使用方式)，在JavaScript的概念中，有误导性。</p><p id="7dac" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">JavaScript是一种单线程的同步语言，这意味着它按照出现的顺序一次读取一个命令(或一行代码)。那么它怎么可能是异步的呢？好吧，有一点需要记住:<strong class="kx io">当JavaScript在你的浏览器中执行时，它并不是唯一在运行的东西。</strong>这就是JavaScript中异步概念的真正本质。</p><blockquote class="lr"><p id="4361" class="ls lt in bd lu lv lw lx ly lz ma lq dk translated"><em class="mb"> JavaScript是一种单线程同步语言。</em></p></blockquote></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="9c80" class="mc md in bd me mf mg mh mi mj mk ml mm jt mn ju mo jw mp jx mq jz mr ka ms mt bi translated">“单线程”和“同步”是什么意思？</h1><p id="9f17" class="pw-post-body-paragraph kv kw in kx b ky mu jo la lb mv jr ld le mw lg lh li mx lk ll lm my lo lp lq ig bi translated"><strong class="kx io">单线程是指一次一行</strong>，同步是指按顺序(从上到下)。这就是JavaScript引擎执行代码的方式。就是这样。</p><p id="4c4d" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><strong class="kx io">即使考虑到执行环境，也是如此。</strong>当JavaScript引擎在某个执行上下文中运行代码时，它可能不会在文件的全局<em class="mz">词法</em>环境中完全从上到下读取，但它仍会在相应的执行上下文中一次读取一行(单线程)并按从上到下的顺序读取(同步)。</p><blockquote class="lr"><p id="52d6" class="ls lt in bd lu lv lw lx ly lz ma lq dk translated"><em class="mb">单线程是指一次一行，同步是指按顺序(从上到下)。</em></p></blockquote><h1 id="b43b" class="mc md in bd me mf na mh mi mj nb ml mm jt nc ju mo jw nd jx mq jz ne ka ms mt bi translated">那么异步回调呢？</h1><p id="f083" class="pw-post-body-paragraph kv kw in kx b ky mu jo la lb mv jr ld le mw lg lh li mx lk ll lm my lo lp lq ig bi translated">异步的定义相当简单。<strong class="kx io">当我们说异步时，我们实际上只是说“一次不止一个”</strong>。但是我们刚才不是说JavaScript是同步的吗？是的，但是请记住，<strong class="kx io">当JavaScript引擎运行您的代码时，它与浏览器中的其他东西协同工作。</strong></p><p id="077e" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">一些例子:</p><ul class=""><li id="a44c" class="nf ng in kx b ky kz lb lc le nh li ni lm nj lq nk nl nm nn bi translated"><strong class="kx io">渲染引擎:</strong>打印/绘制到屏幕上的引擎。</li><li id="03e6" class="nf ng in kx b ky no lb np le nq li nr lm ns lq nk nl nm nn bi translated"><strong class="kx io"> HTTP请求:</strong>浏览器中实际发出并获取数据的部分。</li></ul><p id="cd54" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">JavaScript引擎能够在执行过程中“挂钩”这些类型的东西。因此，尽管所有这些可能同时(或异步)运行，JavaScript引擎<em class="mz">本身</em>是同步运行的。</p><p id="10c8" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我们知道，在JavaScript中，我们有一个叫做“执行栈”的东西，在那里每个执行上下文被完成，然后“弹出”栈去下一个(如果你想了解更多关于全局环境和执行上下文的信息，请参考我的文章<a class="ae nt" href="https://codeburst.io/javascript-under-the-hood-pt-1-the-global-environment-332c8494413c" rel="noopener" target="_blank">这里</a>)。嗯，在引擎中还有一些东西与您的JavaScript代码同时运行，称为<strong class="kx io">事件队列。</strong></p><blockquote class="lr"><p id="1e14" class="ls lt in bd lu lv lw lx ly lz ma lq dk translated">与执行堆栈一起，JavaScript引擎中还运行着一个叫做事件队列的东西。</p></blockquote><p id="8180" class="pw-post-body-paragraph kv kw in kx b ky nu jo la lb nv jr ld le nw lg lh li nx lk ll lm ny lo lp lq ig bi translated">事件队列中充满了当前可能正在发生的事件。<strong class="kx io">当浏览器接收到JavaScript引擎想要知道的事件</strong>(例如，点击)<strong class="kx io">时，它被放置在事件队列</strong>中。无论点击是否被处理，它仍然被放置在队列中。另一个例子是HTTP请求，其中浏览器正在获取数据。这也被添加到事件队列中。</p><p id="5406" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><strong class="kx io">当执行堆栈为空时，JavaScript会查看事件队列。</strong>一旦整个执行堆栈为空，JavaScript引擎就会等待并定期检查事件队列中是否出现了什么。<em class="mz">然后</em>如果被询问就相应地处理它。</p><p id="d700" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">如果有一个函数正在监听那个事件(例如点击收听者)。然后，为处理该事件的函数创建一个新的执行上下文。在这之后，查看事件队列中的下一项，如果函数调用它，那么它将被添加到另一个执行上下文中。</p><p id="6497" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">所以JavaScript是<strong class="kx io">而不是</strong>异步运行。浏览器正在异步地将内容放入事件队列，但是正在运行的代码仍然是逐行运行的。一次一个。</p></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><h1 id="23d3" class="mc md in bd me mf mg mh mi mj mk ml mm jt mn ju mo jw mp jx mq jz mr ka ms mt bi translated">给我看看代码。</h1><p id="55ad" class="pw-post-body-paragraph kv kw in kx b ky mu jo la lb mv jr ld le mw lg lh li mx lk ll lm my lo lp lq ig bi translated">让我们创建一个文件，它有一个函数来模拟一个需要很长时间的函数，并将其命名为<code class="fe nz oa ob oc b">waitThreeSeconds()</code>。这可能令人震惊，但是这个函数在三秒钟内什么也不做，然后在控制台中记录“完成的函数”,让我们知道它的执行上下文已经结束。</p><p id="eefe" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我们将创建一个<code class="fe nz oa ob oc b">clickHandler()</code>事件，让我们知道它的执行何时运行，并在连接到全局环境的事件监听器上调用这个函数。</p><p id="2a62" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">说了这么多，做了这么多，我们将记录“执行完毕”。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="2f3f" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在，如果我们在执行<code class="fe nz oa ob oc b">waitThreeSeconds()</code>期间(页面加载后立即执行)点击<strong class="kx io">，您认为我们的控制台日志会以什么顺序显示？</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/b237afec3a9767f1df4941b58d4ac6ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGAAddxEtOHZMbZu7I5olg.png"/></div></div></figure><p id="cd6a" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">你能猜到为什么会这样吗？为什么click事件是最后处理的，即使我们在另一个函数运行时单击？因为JavaScript是同步的。<strong class="kx io">JavaScript引擎不会查看事件队列，直到执行堆栈为空</strong>。一旦堆栈完全清空，<strong class="kx io">然后</strong>JavaScript引擎为<code class="fe nz oa ob oc b">clickHandler()</code>函数创建一个执行上下文。</p><p id="8044" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">这正是长时间运行的函数会导致性能问题的原因。</p></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><p id="b037" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">那么，我们学到了什么？</p><ul class=""><li id="1633" class="nf ng in kx b ky kz lb lc le nh li ni lm nj lq nk nl nm nn bi translated">JavaScript是一种单线程同步语言。它按照从上到下的顺序逐行执行代码(根据执行上下文)。</li><li id="5dce" class="nf ng in kx b ky no lb np le nq li nr lm ns lq nk nl nm nn bi translated">JavaScript用一种叫做“事件队列”的东西来处理异步事件。一旦执行栈完全空了，它就引用事件队列，如果有任何函数需要处理其中一个事件，<strong class="kx io"> <em class="mz">，那么</em>就为它们创建执行上下文并相应地处理它们。</strong></li><li id="4872" class="nf ng in kx b ky no lb np le nq li nr lm ns lq nk nl nm nn bi translated"><strong class="kx io">“异步”在JavaScript中更多的是关于JavaScript引擎之外发生的事情。(浏览器等。)</strong></li></ul><p id="62ca" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">理解JavaScript中异步回调的本质对您的编程有何影响？请在评论中告诉我。要了解更多的高级JavaScript知识，请随时查看本系列的其余部分！</p><p id="17ad" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae nt" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kx io">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kx io">！</strong></p></div></div>    
</body>
</html>