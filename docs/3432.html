<html>
<head>
<title>Authenticate your App with Slack OAuth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Slack OAuth验证您的应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/authenticate-your-app-with-slack-oauth-438c9ced4c6d?source=collection_archive---------6-----------------------#2020-09-28">https://javascript.plainenglish.io/authenticate-your-app-with-slack-oauth-438c9ced4c6d?source=collection_archive---------6-----------------------#2020-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c3e61cb6b129cc7637fdbd8fdcc1be0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVTMMZQE1BAP5UpQYXNjJA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Cover Image</figcaption></figure><p id="3ede" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇博客中，我将演示如何用Node和Passport JS实现Slack OAuth。为了实现这一点，我们将使用一个名为Passport JS的第三方库。Passport JS是Node和Express JS的认证中间件。Passport JS可以与任何Express JS应用程序一起使用。Passport JS提供500 +策略。</p><div class="la lb gp gr lc ld"><a href="http://www.passportjs.org/packages/passport-slack/" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">护照-松弛</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">使用OAuth 2.0 API向Slack认证的Passport策略。已更新，支持以下人员在空闲时间登录…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">www.passportjs.org</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr jw ld"/></div></div></a></div></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="71c8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">目录</p><ol class=""><li id="5c13" class="lz ma iq ke b kf kg kj kk kn mb kr mc kv md kz me mf mg mh bi translated"><a class="ae mi" href="#ab7d" rel="noopener ugc nofollow">初始化一个节点JS项目</a></li><li id="ecb0" class="lz ma iq ke b kf mj kj mk kn ml kr mm kv mn kz me mf mg mh bi translated"><a class="ae mi" href="#a651" rel="noopener ugc nofollow">创建备用OAuth客户端ID </a></li><li id="fe3f" class="lz ma iq ke b kf mj kj mk kn ml kr mm kv mn kz me mf mg mh bi translated"><a class="ae mi" href="#af7e" rel="noopener ugc nofollow">配置松弛OAuth </a></li><li id="3174" class="lz ma iq ke b kf mj kj mk kn ml kr mm kv mn kz me mf mg mh bi translated"><a class="ae mi" href="#8574" rel="noopener ugc nofollow">保护路由并添加注销</a></li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><ol class=""><li id="ab7d" class="lz ma iq ke b kf kg kj kk kn mb kr mc kv md kz me mf mg mh bi translated"><strong class="ke ir">初始化一个节点JS项目</strong></li></ol><p id="8275" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，让我们创建一个新的Node js项目。下面的命令创建一个新文件夹，然后初始化我们项目的节点。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="3267" class="mx my iq mt b gy mz na l nb nc">mkdir slack_passport<br/>cd slack_passport/<br/>npm init -y<br/>touch index.js</span></pre><p id="5f6d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在安装所需的软件包:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="fa56" class="mx my iq mt b gy mz na l nb nc">npm i express cookie-session passport passport-slack</span></pre><p id="b8d9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">安装后，将下面的代码复制到您的<code class="fe nd ne nf mt b">index.js</code>文件中。</p><p id="00da" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nd ne nf mt b">index.js</code></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="c3ea" class="mx my iq mt b gy mz na l nb nc">const express = require('express')<br/>const app = express()</span><span id="5f7c" class="mx my iq mt b gy ng na l nb nc">app.get('/',(req,res)=&gt;{<br/>  res.send('Hello world')<br/>})</span><span id="eef4" class="mx my iq mt b gy ng na l nb nc">app.listen(8000,()=&gt;{<br/>  console.log('Serve is up and running at the port 8000')<br/>})</span></pre><p id="3bc1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在使用<code class="fe nd ne nf mt b">node index.js</code>启动服务器。然后导航到<a class="ae mi" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>。您应该会看到浏览器中显示“Hello world”。</p><p id="a651" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.<strong class="ke ir">创建空闲OAuth客户端ID </strong></p><p id="6d01" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在使用passport的Slack认证策略之前，您应该已经向Slack注册了您的应用程序或web应用程序。为此，请遵循以下步骤。</p><p id="d322" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">导航到链接:</p><div class="la lb gp gr lc ld"><a href="https://api.slack.com/apps" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">松弛API:应用程序|松弛</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">编辑描述</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">api.slack.com</p></div></div></div></a></div><p id="63f1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该链接会将您带到slack的开发者仪表板。现在点击“创建应用程序”按钮来创建一个新的slack应用程序。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/44796723ab99780454c8dcdccfefefda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1TJUvPLvJ8N_9YTVCU6Mhg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Create a new Slack App</figcaption></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/b7ecb2aebf4faef577fde0b7a5b18f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L25xiYvCD0C0DSesZq7-eg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Create app</figcaption></figure><p id="3ca9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建新应用程序后，您将被重定向到一个新页面，在该页面上您可以看到应用程序凭据。记下我们将在代码中使用的那些凭据。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/334da8c9ef19d9a77cc49fb830e4beb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnipHSGv8NrVnBrnslBCjA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Client ID</figcaption></figure><p id="d08c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另外，不要忘记更改重定向的URL。转到OAuth和权限部分，更改重定向的URL。该URL将是我们的回拨URL。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/1c0e5a0e3211a02d5615ce20dbeaf297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hRVioLlz47ikSU2Ahh7c0w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">CallBack URL</figcaption></figure><p id="af7e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.<strong class="ke ir">配置松弛OAuth </strong></p><p id="d831" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们开始将Slack认证与我们的项目集成。为此，我创建了一个名为<code class="fe nd ne nf mt b">passport.js</code>的新文件，它保存了我们从Slack的OAuth页面创建的凭证。</p><p id="edb4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nd ne nf mt b">passport.js</code></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="d9a0" class="mx my iq mt b gy mz na l nb nc">const passport = require('passport');<br/><strong class="mt ir">const SlackStrategy = require('passport-slack').Strategy;</strong></span><span id="9f8a" class="mx my iq mt b gy ng na l nb nc">passport.serializeUser(function(user, done) {<br/>  done(null, user);<br/>});</span><span id="fe14" class="mx my iq mt b gy ng na l nb nc">passport.deserializeUser(function(user, done) {<br/>  done(null, user);<br/>});</span><span id="35d5" class="mx my iq mt b gy ng na l nb nc"><strong class="mt ir">passport.use(new SlackStrategy({<br/>  clientID: "34******************61",<br/>  clientSecret: "7f6***************************dea",<br/>  callbackURL: "http://localhost:8000/auth/slack/callback",<br/>  skipUserProfile: false,<br/>  scope: ['identity.basic', 'identity.email', 'identity.avatar',  'identity.team'] // default<br/>},<br/>function(accessToken, refreshToken, profile, done) {<br/>  return done(null, profile);<br/>}<br/>));</strong></span></pre><p id="e76d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将以下代码复制并粘贴到您的<code class="fe nd ne nf mt b">index.js</code>文件中。</p><p id="b868" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">route <code class="fe nd ne nf mt b">/auth/slack</code>将客户端重定向到Slack的登录页面。</p><p id="de96" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">路由<code class="fe nd ne nf mt b">/auth/slack/callback</code>将充当回调URL，如果Slack认证成功，将调用该URL。</p><p id="a575" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果在松弛验证期间出现任何错误，将调用路线<code class="fe nd ne nf mt b">/ath/error</code>。</p><p id="694c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nd ne nf mt b">index.js</code></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="72b0" class="mx my iq mt b gy mz na l nb nc">const express = require('express')<br/>const app = express()<br/>const cookieSession = require('cookie-session')<br/><strong class="mt ir">const passport = require('passport');<br/>require('./passport')</strong></span><span id="febc" class="mx my iq mt b gy ng na l nb nc">app.use(cookieSession({<br/>  name: 'amazon-auth-session',<br/>  keys: ['key1', 'key2']<br/>}))<br/>app.use(passport.initialize());<br/>app.use(passport.session());</span><span id="02f9" class="mx my iq mt b gy ng na l nb nc">app.get('/',(req,res)=&gt;{<br/>  res.send(`Hello world ${req.user.displayName}`)<br/>})</span><span id="5e9a" class="mx my iq mt b gy ng na l nb nc">app.get('/auth/error', (req, res) =&gt; res.send('Unknown Error'))</span><span id="7914" class="mx my iq mt b gy ng na l nb nc"><strong class="mt ir">app.get('/auth/slack',passport.authenticate('slack',{scope: ['profile']}));</strong></span><span id="a067" class="mx my iq mt b gy ng na l nb nc"><strong class="mt ir">app.get('/auth/slack/callback',passport.authenticate('slack', { failureRedirect: '/auth/error' }),<br/>function(req, res) {<br/>  res.redirect('/');<br/>});</strong></span><span id="fe77" class="mx my iq mt b gy ng na l nb nc">app.listen(8000,()=&gt;{<br/>    console.log('Serve is up and running at the port 8000')<br/>})</span></pre><p id="85e8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在导航到<a class="ae mi" href="http://localhost:8000/auth/slack" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/auth/slack</a>。您将被重定向到Slack的登录页面。登录您的Slack帐户后，您将被重定向回我们的网页，您将看到您的Slack用户名显示在我们的网页上。</p><p id="8574" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.<strong class="ke ir">保护路由并添加注销</strong></p><p id="a55f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们添加中间件，看看用户是否已经登录。为此，我在中间件文件夹中创建了一个名为<code class="fe nd ne nf mt b">auth.js</code>的文件。</p><p id="e97e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nd ne nf mt b">Middleware/auth.js</code></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="f0a1" class="mx my iq mt b gy mz na l nb nc">const isLoggedIn = (req, res, next) =&gt; {<br/>  if (req.user) {<br/>    next(); <br/>  } else {<br/>    res.status(401).send('Not Logged In');<br/>  }<br/>}</span><span id="639f" class="mx my iq mt b gy ng na l nb nc">module.exports = isLoggedIn</span></pre><p id="d20b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">完成后，将中间件传递给路由<code class="fe nd ne nf mt b">/</code>。现在自动导航到URL <code class="fe nd ne nf mt b"><a class="ae mi" href="http://localhost:8000/auth" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/</a>.</code>，您将被重定向到<code class="fe nd ne nf mt b">/auth/slack</code>路线。</p><p id="5f31" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们创建一个注销函数。只要调用函数<code class="fe nd ne nf mt b">req.logout()</code>你就可以从Slack账户注销。</p><p id="12e9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nd ne nf mt b">index.js</code></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6e16" class="mx my iq mt b gy mz na l nb nc">const isLoggedIn = require('./Middleware/auth')</span><span id="00fa" class="mx my iq mt b gy ng na l nb nc">app.get('/',isLoggedIn,(req,res)=&gt;{<br/>  res.send(`Hello world ${req.user.displayName}`)<br/>})</span><span id="e9be" class="mx my iq mt b gy ng na l nb nc">app.get('/logout', (req, res) =&gt; {<br/>  req.session = null;<br/>  req.logout();<br/>  res.redirect('/');<br/>})</span></pre><p id="7ac1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">导航到<a class="ae mi" href="http://localhost:8000/logout" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/logout</a>。您将被注销。</p><p id="30c0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如有任何疑问，请随时联系我。</p><p id="80fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">电子邮件:sjlouji10@gmail.com。</p><p id="9ec5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">领英:<a class="ae mi" href="https://www.linkedin.com/in/sjlouji/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/sjlouji/</a></p><p id="a5dd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我的GitHub上的完整代码:</p><div class="la lb gp gr lc ld"><a href="https://github.com/sjlouji/Passport-Strategies---Medium/tree/master/slack_OAuth" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd ir gy z fp li fr fs lj fu fw ip bi translated">sjlouji/Passport-策略-中等</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">github.com</p></div></div><div class="lm l"><div class="nl l lo lp lq lm lr jw ld"/></div></div></a></div><p id="cb5c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">编码快乐！</p></div></div>    
</body>
</html>