<html>
<head>
<title>3 Things I learned from Testing in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我从JavaScript测试中学到的3件事</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/3-things-i-learned-from-testing-in-javascript-94f295db2df7?source=collection_archive---------2-----------------------#2019-11-08">https://javascript.plainenglish.io/3-things-i-learned-from-testing-in-javascript-94f295db2df7?source=collection_archive---------2-----------------------#2019-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="8b8f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">JavaScript测试</h2><div class=""/><div class=""><h2 id="ffce" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">我试图在我的工作项目中编写测试代码。这个帖子讲的是我从测试中学到的东西。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/5cfefd8b0128eb7c5fef86c6548bfc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XlQGyLJhn1YyTyCr"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@mometrixtestprep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mometrix Test Prep</a> on <a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3602" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di">答</span>几个月前，我和我的团队启动了一个项目，花了四个多月才完成。它给了我教训，但也让我头疼。在我发布项目之后，回想起来，我学到了一些关于测试和编程的东西。这篇文章将谈论我从我参与的项目中的测试经验中学到的和发现的东西。</p><blockquote class="mk ml mm"><p id="9866" class="lf lg mn lh b li lj ka lk ll lm kd ln mo lp lq lr mp lt lu lv mq lx ly lz ma ij bi translated">D <strong class="lh ja"> isclaimer </strong> <br/>这个项目我没有做TDD。在发布项目后，我编写了测试代码。为什么？因为我不知道测试是什么样的，测试代码应该是什么样的。是的，这是我第一次尝试写测试代码。</p></blockquote></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="9c0c" class="my mz iq bd na nb nc nd ne nf ng nh ni kf nj kg nk ki nl kj nm kl nn km no np bi translated">在告诉你测试代码之前，我应该让你知道我的项目环境。</h1><p id="c6b7" class="pw-post-body-paragraph lf lg iq lh b li nq ka lk ll nr kd ln lo ns lq lr ls nt lu lv lw nu ly lz ma ij bi translated">在JavaScript测试中，有各种各样的库可供选择。摩卡、杰斯特、西农，不一而足。我的团队一直使用Jest作为测试库。Jest是这一年中最受开发者欢迎和喜爱的测试库。</p><p id="0508" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当然，您还有其他选择，每个库都有自己的特点。因此，你应该看看它们，为你的项目做出正确的决定。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/48bbb2b51c198427db0e6f5337328485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFp1EKBZbtCk8_kkfvwnxQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">NPM download trends — showing download counts about testing libraries</figcaption></figure><h2 id="4b6e" class="nw mz iq bd na nx ny dn ne nz oa dp ni lo ob oc nk ls od oe nm lw of og no iw bi translated">测试环境</h2><ul class=""><li id="a238" class="oh oi iq lh b li nq ll nr lo oj ls ok lw ol ma om on oo op bi translated">Jest——Jest再次成为目前最流行的测试库。我们看不出有任何理由不选择Jest。</li><li id="37ed" class="oh oi iq lh b li oq ll or lo os ls ot lw ou ma om on oo op bi translated">TypeScript — TypeScript是一种由微软开发和管理的开源编程语言。TypeScript可以减少人为的错误或失误，主要是在你通过传递参数来处理很多函数的时候。</li><li id="9796" class="oh oi iq lh b li oq ll or lo os ls ot lw ou ma om on oo op bi translated">puppet eer——puppet eer是一个了不起的节点库，它允许你通过Devtool协议控制Chrome或Chrome。我用木偶师做E2E测试。</li></ul><h2 id="f675" class="nw mz iq bd na nx ny dn ne nz oa dp ni lo ob oc nk ls od oe nm lw of og no iw bi translated">我做了什么测试？</h2><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/adc57db3d140653a079b1f9b5e21e986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kKVHfWAB-h-B_MnWVk9xaA.png"/></div></div></figure><ul class=""><li id="1759" class="oh oi iq lh b li lj ll lm lo ow ls ox lw oy ma om on oo op bi translated">单元测试——单元测试是一种测试单元的方法。它通常用于测试项目的最小部分；例如，它们可以是函数。如果您有连接字母和将数字转换为字符串的函数，您可能想知道这些函数是否正常工作。那么你应该运行单元测试。</li><li id="2c51" class="oh oi iq lh b li oq ll or lo os ls ot lw ou ma om on oo op bi translated">集成测试——集成测试是单元测试的下一步。如果您的两个函数<code class="fe oz pa pb pc b">convertNumToStr</code>和<code class="fe oz pa pb pc b">concatLetters</code>成功地通过了单元测试，现在您想知道当它们一起工作时是否也能工作。为什么我们需要集成测试是因为即使功能通过了单元测试，也不意味着它们也能通过集成测试。</li><li id="9632" class="oh oi iq lh b li oq ll or lo os ls ot lw ou ma om on oo op bi translated">E2E测试——作为测试旅程的最后一步，我做了E2E测试。E2E代表端到端，所以当你在Web中做E2E测试时，这意味着你测试你的场景，比如从登录到退出。在这个例子中，场景可以包括登录、将数字转换为字符串时连接字母，以及注销。</li></ul></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="c0f2" class="my mz iq bd na nb nc nd ne nf ng nh ni kf nj kg nk ki nl kj nm kl nn km no np bi translated">第一课。纯函数的重要性</h1><p id="7d7f" class="pw-post-body-paragraph lf lg iq lh b li nq ka lk ll nr kd ln lo ns lq lr ls nt lu lv lw nu ly lz ma ij bi translated">回想起来，单元测试不容易的原因之一是函数的工作方式。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pd"><img src="../Images/ef3af90342a232f0593416d95c71c9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NC-vHkQ3pEJE7NdIoPvATA.png"/></div></div></figure><blockquote class="mk ml mm"><p id="4280" class="lf lg mn lh b li lj ka lk ll lm kd ln mo lp lq lr mp lt lu lv mq lx ly lz ma ij bi translated">如果你不了解TypeScript接口，<a class="ae le" href="https://www.typescriptlang.org/docs/handbook/interfaces.html" rel="noopener ugc nofollow" target="_blank">这里是文档</a>。</p></blockquote><p id="a1c8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所以，看看这个例子。函数<code class="fe oz pa pb pc b">filterStudents</code>接受一个<code class="fe oz pa pb pc b">People</code>类型的数组，检索工作是student的学生，并返回该数组。</p><p id="2e03" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">看起来还好，但是有个问题，很大的问题。当参数中没有学生时，将执行第12行，全局变量将被赋予不同的值。当你写一个函数的时候，你不应该在它的范围之外改变参数或者其他变量。在这种情况下，<code class="fe oz pa pb pc b">classForToday</code>就不在功能范围内了。当其他函数试图接近它而不知道新值已被赋给它们时，给任何不在该范围内的变量赋一个新值都会产生副作用。</p><p id="1990" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">纯函数应该总是返回一个仅由其输入值决定的值。它们不应影响其范围之外的任何其他变量或状态。使用纯函数的一个好处是，你总是可以从它们那里得到返回值的类型。</p><div class="pe pf gp gr pg ph"><a href="https://blog.bitsrc.io/understanding-javascript-mutation-and-pure-functions-7231cc2180d3" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd ja gy z fp pm fr fs pn fu fw iz bi translated">理解Javascript变异和纯函数</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">通过更好地理解JS中的变异和纯函数来提升你的应用性能</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">blog.bitsrc.io</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv ky ph"/></div></div></a></div><blockquote class="mk ml mm"><p id="fc15" class="lf lg mn lh b li lj ka lk ll lm kd ln mo lp lq lr mp lt lu lv mq lx ly lz ma ij bi translated">上面的帖子在解释什么是纯函数，如果你想了解更多关于纯函数的知识，你可以查看那个帖子！</p></blockquote><p id="43e8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所以函数应该像下面这样。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pw"><img src="../Images/416b1663dd9e85237a75b4e38db1ab01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3j87RSWQyg_6VM0fC434w.png"/></div></div></figure><p id="0769" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们可以通过调用<code class="fe oz pa pb pc b">doWeHaveClassToday</code>来检查我们今天是否有一个类，而不用改变任何不必要的变量。</p><h1 id="685d" class="my mz iq bd na nb px nd ne nf py nh ni kf pz kg nk ki qa kj nm kl qb km no np bi translated">第二课。"然而，我们为什么需要测试？"</h1><p id="50b9" class="pw-post-body-paragraph lf lg iq lh b li nq ka lk ll nr kd ln lo ns lq lr ls nt lu lv lw nu ly lz ma ij bi translated">当我告诉我的同事我想尝试编写测试代码时，我多次从他们那里听到这个问题。</p><blockquote class="qc"><p id="4c1f" class="qd qe iq bd qf qg qh qi qj qk ql ma dk translated">我们不能亲自点击按钮吗？我明白测试很重要，但我怀疑它对我们是否有必要。</p></blockquote><p id="fabb" class="pw-post-body-paragraph lf lg iq lh b li qm ka lk ll qn kd ln lo qo lq lr ls qp lu lv lw qq ly lz ma ij bi translated">老实说，当我开始尝试的时候，我并没有认真对待测试。显然，当我的同事问我这个问题时，我无法回答。我觉得有人用一把结实的锤子敲了我的后脑勺。</p><p id="a0dd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我开始思考为什么要写测试代码，需要多少测试代码。然后很快，我意识到在测试时有两种类型的函数。我应该测试的功能和我不必测试的功能。那么是什么决定了哪个功能应该测试，哪个功能不应该测试呢？在我看来，这完全取决于你的项目是关于什么的。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="qr qs l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk"><a class="ae le" href="https://twitter.com/rauchg" rel="noopener ugc nofollow" target="_blank">The creator of Socket.io</a> left the tweet about testing</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qt"><img src="../Images/247e47847d28ee4aa9cfbb3649d904d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8y9iQ7WQ1aP2tD4wfyVvKg.png"/></div></div></figure><p id="5692" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">问题:<em class="mn">好的，但是我们为什么需要测试代码呢？</em></p><p id="32fd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">假设您的项目中没有测试代码。您没有看到任何错误。一个月后，您的团队雇佣了一名新的开发人员，而她，这位新员工，想要探索这个项目。对她来说，掌握这个项目并不容易，因为她不知道哪些功能与主要功能相关。她努力学习代码，最后，在加入团队三个月后，她很好地掌握了这个项目。又一次，一个新的男性工人加入了这个团队，现在他必须做她做了三个月的事情来抓住这个项目。</p><p id="efa7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这就是为什么测试很重要。当然，它主要是让你找出代码的边缘案例，但也让你更容易管理项目。如果团队有一个测试环境，那两个新员工就不需要花费如此多的时间和精力去查看代码。</p><h1 id="ba31" class="my mz iq bd na nb px nd ne nf py nh ni kf pz kg nk ki qa kj nm kl qb km no np bi translated">第三课。E2E测试很昂贵</h1><p id="105f" class="pw-post-body-paragraph lf lg iq lh b li nq ka lk ll nr kd ln lo ns lq lr ls nt lu lv lw nu ly lz ma ij bi translated">在我编写了单元测试和集成测试的测试代码之后，我认为我可以继续以这种速度前进。但这是我的大错误。我不知道E2E是什么。我为E2E做的第一件事就是下载<code class="fe oz pa pb pc b">puppeteer</code>。幸运的是，我知道如何使用<code class="fe oz pa pb pc b">puppeteer</code>，我曾经在我的个人项目中使用它。这可能是为什么我低估了E2E的成本，因为我认为我知道如何使用<code class="fe oz pa pb pc b">puppeteer</code>和如何使用Jest。</p><p id="f188" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">没过多久，我就意识到自己是小池塘里的一条鱼。我甚至不是一条大鱼。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qu"><img src="../Images/18c83408fa4b9e51d5bd3524217f5550.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gG7vwoci1gQ0Tl7j4hi2gA.png"/></div></div></figure><p id="dc9a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">例如，这是我运行的E2E流程。</p><p id="e8ac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">首先，我必须进入登录页面，填写表格并点击按钮。当登录失败时，测试应该立即失败。然后，下一步是单击菜单将图像上传到服务器。我把虚拟数据放在输入框里。因为我们已经为dev-server建立了一个数据库，所以我向服务器发送了API请求，将图像存储在数据库中。如果图像存储成功，测试将通过，否则将失败。</p><p id="c1ed" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">哇，一、二、三……这是一段只有六行的文字，解释了我的E2E故事是什么！但是不要尖叫。我有300行只是为了上传和检查图像。</p><p id="dc40" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我觉得很奇怪。尽管这是我第一次写E2E，但它应该有更少的代码行。在这之后，我读了许多关于测试的文章，包括E2E，并对如何做E2E做了研究。后来我发现我没有错。E2E本身比其他测试需要更多的时间。</p><p id="a02e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">那我应该把E2E扔进垃圾桶吗？没有。当然，我不会在项目中到处写E2E代码，因为这会占用我太多的资源。昂贵的功能；这意味着它们与业务逻辑相关，值得进行测试。</p><h1 id="614f" class="my mz iq bd na nb px nd ne nf py nh ni kf pz kg nk ki qa kj nm kl qb km no np bi translated">下一步是什么？</h1><p id="ef99" class="pw-post-body-paragraph lf lg iq lh b li nq ka lk ll nr kd ln lo ns lq lr ls nt lu lv lw nu ly lz ma ij bi translated">如果评价我自己的测试技能，我觉得我是一个低中级测试员。我仍然对测试充满热情。从现在开始，我想学习一下测试工具，比如Cypress或者TestCafe。</p><p id="624b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你正在考虑是否应该在你的项目中编写测试代码，我想说你可以从明天开始。尽管编写测试代码可能会让你感到疲劳和无聊，但拥有它们将是一次很棒的经历。</p><h1 id="240d" class="my mz iq bd na nb px nd ne nf py nh ni kf pz kg nk ki qa kj nm kl qb km no np bi translated">参考</h1><ul class=""><li id="452b" class="oh oi iq lh b li nq ll nr lo oj ls ok lw ol ma om on oo op bi translated"><a class="ae le" href="https://kentcdodds.com/blog/write-tests" rel="noopener ugc nofollow" target="_blank">写测试，不要太多</a></li><li id="6ccb" class="oh oi iq lh b li oq ll or lo os ls ot lw ou ma om on oo op bi translated"><a class="ae le" href="https://testing.googleblog.com/2015/04/just-say-no-to-more-end-to-end-tests.html" rel="noopener ugc nofollow" target="_blank">谷歌测试博客</a></li></ul></div></div>    
</body>
</html>