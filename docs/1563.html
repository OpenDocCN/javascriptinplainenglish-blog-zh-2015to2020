<html>
<head>
<title>Testing Microsoft SQL Server with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript测试Microsoft SQL Server</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/testing-microsoft-sql-server-database-using-javascript-6b5337e4a151?source=collection_archive---------5-----------------------#2020-04-01">https://javascript.plainenglish.io/testing-microsoft-sql-server-database-using-javascript-6b5337e4a151?source=collection_archive---------5-----------------------#2020-04-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="8d20" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">MSSQL测试并没有那么难</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d285737ffe4656436c8df60c5a92a292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D36MPXgTqD0Hx5kp"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@johnyvino?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Johny vino</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8830" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我在之前的职位上开始测试<strong class="kv io"> Microsoft SQL Server </strong>数据库时，通常没有太多可用的文档。所以我不得不花额外的时间去理解和建立一个端到端的测试。</p><p id="2be7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">本文的目的是分享如何为MSSQL Server编写自动化测试的知识。不用在sql developer或Azure data studio中编写查询，整个端到端测试可以使用node.js <code class="fe lp lq lr ls b">mssql</code>包自动化。</p><p id="e404" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我会使用程序化的Mocha测试方法，设置可以在<a class="ae ks" href="https://medium.com/@punjpuneet/introduction-to-programmatic-approach-to-mocha-testing-framework-e10d1947148e" rel="noopener">上一篇文章</a>中找到。</p><p id="c932" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lp lq lr ls b">git clone https://github.com/puneetpunj/programmatic-mocha-framework.git</code></p><p id="4eea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lt">出于本文的目的，我将启动一个新的数据库来获取连接细节并显示实际的测试，否则，如果您已经运行了SQL Server，请随意跳过这一部分并使用您自己的连接细节。</em></p><h1 id="5dd1" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">安装SQL Server数据库</h1><p id="b846" class="pw-post-body-paragraph kt ku in kv b kw mm jo ky kz mn jr lb lc mo le lf lg mp li lj lk mq lm ln lo ig bi translated">先决条件— <a class="ae ks" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank"> Docker </a></p><p id="a5fc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们从在<code class="fe lp lq lr ls b">programmatic-mocha-framework</code>中创建<code class="fe lp lq lr ls b">dockerfile</code>开始</p><pre class="kd ke kf kg gt mr ls ms mt aw mu bi"><span id="3c20" class="mv lv in ls b gy mw mx l my mz">cd programmatic-mocha-framework</span><span id="367b" class="mv lv in ls b gy na mx l my mz">// create new file and name it as dockerfile<br/>touch dockerfile</span></pre><p id="2c3e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将这段代码复制到dockerfile中</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">dockerfile for SQL Server</figcaption></figure><p id="6d26" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">执行以下docker命令，您的SQL Server数据库将启动并运行。更多详情请查看<a class="ae ks" href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-configure-docker?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">微软文档</a></p><pre class="kd ke kf kg gt mr ls ms mt aw mu bi"><span id="d264" class="mv lv in ls b gy mw mx l my mz">docker build -t sqlserverimage .</span><span id="6050" class="mv lv in ls b gy na mx l my mz">docker run -d -p 60666:1433 --name mssql1 sqlserverimage</span><span id="ff18" class="mv lv in ls b gy na mx l my mz">docker ps</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/15edb88829ded837cb752453ea212343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yQLEhVkNmcoNdaUV0nk8vg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Confirmation of Docker Container running SQL Server</figcaption></figure><h1 id="84cc" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">向数据库添加数据</h1><p id="6152" class="pw-post-body-paragraph kt ku in kv b kw mm jo ky kz mn jr lb lc mo le lf lg mp li lj lk mq lm ln lo ig bi translated">下载<a class="ae ks" href="https://docs.microsoft.com/en-gb/sql/azure-data-studio/download?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> Azure Data Studio </a>并使用下面的连接细节</p><pre class="kd ke kf kg gt mr ls ms mt aw mu bi"><span id="87e6" class="mv lv in ls b gy mw mx l my mz">Server: localhost,60666<br/>Login Type: SQL Login<br/>User: sa<br/>Password: Stupidpassword123!</span></pre><p id="43aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">成功登录后，执行以下查询，以便在数据库中添加一些数据行。更多详情请参考<a class="ae ks" href="https://docs.microsoft.com/en-us/sql/azure-data-studio/quickstart-sql-server?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">微软文档</a>。</p><pre class="kd ke kf kg gt mr ls ms mt aw mu bi"><span id="956c" class="mv lv in ls b gy mw mx l my mz">// Start by creating new database and name it as TutorialDB</span><span id="01ff" class="mv lv in ls b gy na mx l my mz">USE master<br/>GO<br/>IF NOT EXISTS (<br/> SELECT name<br/> FROM sys.databases<br/> WHERE name = N'TutorialDB'<br/>)<br/> CREATE DATABASE [TutorialDB];<br/>GO<br/>IF SERVERPROPERTY('ProductVersion') &gt; '12'<br/> ALTER DATABASE [TutorialDB] SET QUERY_STORE=ON;<br/>GO<br/></span><span id="da59" class="mv lv in ls b gy na mx l my mz">// Create new table in above database -</span><span id="ba56" class="mv lv in ls b gy na mx l my mz">-- Create a new table called 'Customers' in schema 'dbo'<br/>-- Drop the table if it already exists<br/>IF OBJECT_ID('dbo.Customers', 'U') IS NOT NULL<br/> DROP TABLE dbo.Customers;<br/>GO<br/>-- Create the table in the specified schema<br/>CREATE TABLE dbo.Customers<br/>(<br/> CustomerId int NOT NULL PRIMARY KEY, -- primary key column<br/> Name nvarchar(50) NOT NULL,<br/> Location nvarchar(50) NOT NULL,<br/> Email nvarchar(50) NOT NULL<br/>);<br/>GO<br/></span><span id="e628" class="mv lv in ls b gy na mx l my mz">// Add rows </span><span id="6cb3" class="mv lv in ls b gy na mx l my mz">-- Insert rows into table 'Customers'<br/>INSERT INTO dbo.Customers<br/> ([CustomerId], [Name], [Location], [Email])<br/>VALUES<br/> ( 1, N'Orlando', N'Australia', N''),<br/> ( 2, N'Keith', N'India', <a class="ae ks" href="mailto:N'keith0@adventure-works.com" rel="noopener ugc nofollow" target="_blank">N'keith0@adventure-works.com</a>'),<br/> ( 3, N'Donna', N'Germany', <a class="ae ks" href="mailto:N'donna0@adventure-works.com" rel="noopener ugc nofollow" target="_blank">N'donna0@adventure-works.com</a>'),<br/> ( 4, N'Janet', N'United States', <a class="ae ks" href="mailto:N'janet1@adventure-works.com" rel="noopener ugc nofollow" target="_blank">N'janet1@adventure-works.com</a>')<br/>GO</span></pre><p id="2e72" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦数据成功插入，执行<code class="fe lp lq lr ls b">select * from dbo.Customers</code></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/290c3309bf08c58faa7b9a2658a4d194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31tsMfKPfCcV9ruRINH6hw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Select query returns all 4 records</figcaption></figure><h1 id="6fa2" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">构建一个库文件来与数据库交互</h1><p id="d858" class="pw-post-body-paragraph kt ku in kv b kw mm jo ky kz mn jr lb lc mo le lf lg mp li lj lk mq lm ln lo ig bi translated">首先，通过运行<code class="fe lp lq lr ls b">npm i mssql</code>添加mssql包</p><p id="b8c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在<code class="fe lp lq lr ls b">lib</code>目录下新建一个文件，命名为<code class="fe lp lq lr ls b">db-connect.js</code>。通常，您不会在此文件中硬编码凭据，它们必须在中定义。env或参数存储或机密管理器，但为了这个例子，我已经把它们添加到这个文件本身。将以下代码复制到db-connect.js</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">db-connect.js</figcaption></figure><h1 id="a22e" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">添加新的测试文件</h1><p id="9d46" class="pw-post-body-paragraph kt ku in kv b kw mm jo ky kz mn jr lb lc mo le lf lg mp li lj lk mq lm ln lo ig bi translated">编程方法的最大优势之一是基于计划/程序的测试的清晰分离，并独立运行它们。实现这一点的方法是在<code class="fe lp lq lr ls b">programmatic</code>目录下添加新文件<code class="fe lp lq lr ls b">db-test.js</code>。创建文件后，复制以下代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">db-test.js</figcaption></figure><h1 id="9af5" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">更新执行文件以包含新的测试</h1><p id="efe3" class="pw-post-body-paragraph kt ku in kv b kw mm jo ky kz mn jr lb lc mo le lf lg mp li lj lk mq lm ln lo ig bi translated">更新后的<code class="fe lp lq lr ls b">execute-tests.js</code>看起来如下:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">execute-tests.js</figcaption></figure><h1 id="520b" class="lu lv in bd lw lx ly lz ma mb mc md me jt mf ju mg jw mh jx mi jz mj ka mk ml bi translated">执行测试</h1><p id="a500" class="pw-post-body-paragraph kt ku in kv b kw mm jo ky kz mn jr lb lc mo le lf lg mp li lj lk mq lm ln lo ig bi translated">执行命令将保持不变<code class="fe lp lq lr ls b">npm run test</code></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/717dd2c26fc228fc79617bb2642395d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_k2VbeW0axpkcPz509PJhA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Output of mssql execution</figcaption></figure></div><div class="ab cl ng nh hr ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ig ih ii ij ik"><p id="63fd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">感谢阅读，代码可在git <a class="ae ks" href="https://github.com/puneetpunj/programmatic-mocha-framework" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p></div></div>    
</body>
</html>