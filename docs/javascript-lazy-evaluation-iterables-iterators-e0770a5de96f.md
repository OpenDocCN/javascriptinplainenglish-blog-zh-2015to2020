# JavaScript æƒ°æ€§æ±‚å€¼:å¯è¿­ä»£ç¨‹åºå’Œè¿­ä»£å™¨

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/javascript-lazy-evaluation-iterables-iterators-e0770a5de96f?source=collection_archive---------2----------------------->

## JavaScript Alpha æŒ‡å—

## å¯è¿­ä»£å’Œè¿­ä»£å™¨ã€‚æƒ°æ€§è¯„ä¼°ç®—æ³•çš„åŸºæœ¬æ„ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯ç”±ä»€ä¹ˆç»„æˆçš„ï¼Œä»¥åŠå®ƒä»¬æœ‰ä»€ä¹ˆç”¨å¤„ã€‚

![](img/243b4c8e490766a8b7a858dd7e5f5f86.png)

JavaScript lazy evaluation: Iterables & Iterators

æ‡’è¯„æµ‹ï¼Œæ¯ä¸ªå‡½æ•°å¼ç¨‹åºå‘˜çš„æ¢¦é—ã€‚å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°å‘ç”µæœºã€‚ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä»€ä¹ˆæ˜¯è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡ï¼Œå› ä¸ºå¯¹æˆ‘æ¥è¯´ï¼Œå®ƒä»¬æ˜¯ç”Ÿæˆå™¨çš„å…ˆå†³æ¡ä»¶ã€‚

# æ‡’æƒ°è¯„ä¼°

**æƒ°æ€§æ±‚å€¼**æ„å‘³ç€å°†è¡¨è¾¾å¼çš„æ±‚å€¼å»¶è¿Ÿåˆ°éœ€è¦çš„æ—¶å€™ã€‚æƒ°æ€§è¯„ä¼°æœ‰æ—¶è¢«ç§°ä¸º**æŒ‰éœ€è°ƒç”¨**ã€‚

æ‡’æƒ°è¯„ä¼°çš„åä¹‰è¯æ˜¯**çƒ­åˆ‡è¯„ä¼°**ã€‚è¿™æ˜¯å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨çš„è¯„ä¼°ç­–ç•¥ã€‚

æƒ°æ€§è¯„ä¼°å¯ä»¥:

*   å®šä¹‰æ½œåœ¨çš„æ— é™æ•°æ®ç»“æ„
*   é€šè¿‡é¿å…ä¸å¿…è¦çš„è®¡ç®—æ¥æé«˜æ€§èƒ½
*   ä¸ºå¸Œæœ›å…¶å…ƒç´ å¯ä¾›å…¬ä¼—è®¿é—®çš„æ•°æ®ç»“æ„å®šåˆ¶è¿­ä»£è¡Œä¸º

# è¿­ä»£å™¨

JavaScript ä¸­çš„**è¿­ä»£å™¨**(å› ä¸º [**ECMAScript 6**](http://es6-features.org/#IteratorForOfOperator) )ä½¿å¾—æƒ°æ€§æ±‚å€¼å’Œåˆ›å»ºç”¨æˆ·å®šä¹‰çš„æ•°æ®åºåˆ—æˆä¸ºå¯èƒ½ã€‚

**è¿­ä»£**æ˜¯ä¸€ç§éå†æ•°æ®çš„æœºåˆ¶ã€‚è¿­ä»£å™¨æ˜¯éå†æ•°æ®ç»“æ„å…ƒç´ çš„æŒ‡é’ˆï¼Œç§°ä¸º **Iterable** ã€‚äº§ç”Ÿä¸€ç³»åˆ—å€¼çš„æŒ‡é’ˆã€‚

è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯ä»¥è¢«è¿­ä»£çš„å¯¹è±¡ã€‚å®ƒæŠ½è±¡äº†ä¸€ä¸ªæ•°æ®å®¹å™¨ï¼Œä½¿å…¶è¡Œä¸ºåƒä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ã€‚

è¿­ä»£å™¨ä¸ä¼šåœ¨å®ä¾‹åŒ–æ—¶è®¡ç®—æ¯ä¸€é¡¹çš„å€¼ã€‚ä¸‹ä¸€ä¸ªå€¼ä»…åœ¨è¯·æ±‚æ—¶ç”Ÿæˆã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹æ•°æ®é›†æˆ–æ— é™æ•°é‡å…ƒç´ çš„åºåˆ—ã€‚

# å¯é‡å¤çš„

Iterables æ˜¯å¸Œæœ›å…¬ä¼—å¯ä»¥è®¿é—®å…¶å…ƒç´ çš„æ•°æ®ç»“æ„ã€‚

è®¸å¤š API æ¥å— iterablesï¼Œä¾‹å¦‚:

*   `new Map([iterable])`
*   `new WeakMap([iterable])`
*   `new Set([iterable])`
*   `new WeakSet([iterable])`
*   `Promise.all([iterable])`
*   `Promise.race([iterable])`
*   `Array.from([iterable])`

ä¹Ÿæœ‰æœŸæœ›å¯è¿­ä»£çš„è¯­å¥å’Œè¡¨è¾¾å¼ï¼Œä¾‹å¦‚:

*   `**for ... of**`(å¾ªç¯)
*   `**...**`(ä¼ æ’­ç®—å­)
*   `const **[a, b, ..]** = iterable;`(è§£æ„åˆ†é…)
*   `**yield***`(å‘ç”µæœºå§”æ‰˜)

JavaScript ä¸­å·²ç»æœ‰è®¸å¤šå†…ç½®çš„å¯è¿­ä»£å¯¹è±¡:
`String`ã€`Array`ã€`TypedArray`ã€`Map`ã€`Set`ã€‚

# è¿­ä»£åè®®

**è¿­ä»£å™¨**å’Œ**è¿­ä»£å™¨**ç¬¦åˆ [**è¿­ä»£** **åè®®**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols) ã€‚

> åè®®æ˜¯ä¸€ç»„æ¥å£å’Œä½¿ç”¨å®ƒä»¬çš„è§„åˆ™ã€‚

è¿­ä»£å™¨ç¬¦åˆ**è¿­ä»£å™¨åè®®**ã€‚å¯è¿­ä»£ç¬¦åˆ**å¯è¿­ä»£åè®®**ã€‚

## å¯è¿­ä»£åè®®

Iterable åè®®å…è®¸ JavaScript å¯¹è±¡å®šä¹‰æˆ–å®šåˆ¶å®ƒä»¬çš„è¿­ä»£è¡Œä¸ºã€‚

è¦ä½¿ä¸€ä¸ªå¯¹è±¡æˆä¸ºå¯è¿­ä»£çš„ï¼Œå®ƒå¿…é¡»å®ç°ä¸€ä¸ªå¯é€šè¿‡`Symbol.iterator`è®¿é—®çš„è¿­ä»£å™¨æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯è¿­ä»£å™¨çš„å·¥å‚ã€‚

ä½¿ç”¨ TypeScriptï¼Œiterable åè®®å¦‚ä¸‹æ‰€ç¤º:

```
interface Iterable {
  [Symbol.iterator]() : Iterator;
}
```

`[Symbol.iterator]()`æ˜¯ä¸€ä¸ªé›¶å‚æ•°å‡½æ•°ã€‚å®ƒåœ¨ iterable å¯¹è±¡ä¸Šè¢«è°ƒç”¨ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥é€šè¿‡`this`è®¿é—® iterableã€‚å®ƒå¯ä»¥æ˜¯å¸¸è§„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”Ÿæˆå™¨å‡½æ•°ã€‚

## è¿­ä»£å™¨åè®®

è¿­ä»£å™¨åè®®å®šä¹‰äº†äº§ç”Ÿå€¼åºåˆ—çš„æ ‡å‡†æ–¹æ³•ã€‚

ä¸€ä¸ªå¯¹è±¡è¦æˆä¸ºè¿­ä»£å™¨ï¼Œå®ƒå¿…é¡»å®ç°ä¸€ä¸ª`next()`æ–¹æ³•ã€‚å¯é€‰åœ°ï¼Œè¿­ä»£å™¨å¯ä»¥å®ç°ä¸€ä¸ª`return()`æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡åé¢è®¨è®ºã€‚

ä½¿ç”¨ TypeScriptï¼Œè¿­ä»£åè®®å¦‚ä¸‹æ‰€ç¤º:

```
interface Iterator {
    next() : IteratorResult;
    return?(value?: any): IteratorResult;
}
```

å…¶ä¸­`IteratorResult`æ˜¯:

```
interface IteratorResult {
    value?: any;
    done: boolean;
}
```

*   `done`é€šçŸ¥æ¶ˆè´¹è€…è¿­ä»£å™¨æ˜¯å¦å·²è¢«ä½¿ç”¨ï¼Œ`false`è¡¨ç¤ºä»æœ‰å€¼è¦ç”Ÿæˆï¼Œ`true`è¡¨ç¤ºè¿­ä»£å™¨å·²åˆ°è¾¾å…¶æœ«å°¾
*   `value`å¯ä»¥æ˜¯ä»»ä½• JavaScript å€¼ï¼Œå®ƒæ˜¯å‘æ¶ˆè´¹è€…å…¬å¼€çš„å€¼

å½“`done`ä¸ºçœŸæ—¶ï¼Œå¯ä»¥çœç•¥`value`ã€‚

## æ”¾åœ¨ä¸€èµ·

è¦å¯è§†åŒ– iterable å’Œ iterator ä¹‹é—´çš„è¿æ¥ï¼Œè¯·å‚è§ä¸‹å›¾ã€‚

![](img/2c466bb942748b966629eb84ae0a5a3c.png)

The connection between iterable and iterator

![](img/40d455ed760676d291346f96d6ee1cca.png)

# âŒ¨ï¸è¡¨æ¼”æ—¶é—´

å¥½äº†ï¼Œç†è®ºåˆ°æ­¤ä¸ºæ­¢ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­ã€‚æˆ‘ä»¬å°†ä»ä¸€äº›åŸºæœ¬çš„ä¾‹å­å¼€å§‹ï¼Œç„¶åä¸€ç‚¹ä¸€ç‚¹åœ°æ·»åŠ æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢å­¦åˆ°çš„ä¸œè¥¿ï¼Œä½¿äº‹æƒ…å˜å¾—æ›´æœ‰è¶£ã€‚

## èŒƒå›´è¿­ä»£å™¨

è®©æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸åŸºæœ¬çš„è¿­ä»£å™¨å¼€å§‹ï¼Œ`createRangeIterator`è¿­ä»£å™¨ã€‚

æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨`it.next()`æ¥è·å¾—ä¸‹ä¸€ä¸ª`IteratorResult`ã€‚æœ€åä¸€æ¬¡è°ƒç”¨è¿”å›`{ done: true }`ï¼Œè¿™æ„å‘³ç€è¿­ä»£å™¨ç°åœ¨è¢«æ¶ˆè€—æ‰äº†ï¼Œä¸ä¼šå†äº§ç”Ÿæ›´å¤šçš„å€¼ã€‚

Simple iterator

## å¯è¿­ä»£èŒƒå›´è¿­ä»£å™¨

åœ¨æœ¬æ–‡çš„å‰é¢ï¼Œæˆ‘æåˆ°è¿‡ JavaScript ä¸­çš„ä¸€äº›è¯­å¥å’Œè¡¨è¾¾å¼éœ€è¦ iterablesã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­åœ¨ä½¿ç”¨`for ... of`å¾ªç¯æ—¶å°±ä¸èµ·ä½œç”¨äº†ã€‚

ä½†æ˜¯åˆ›å»ºä¸€ä¸ªåŒæ—¶ç¬¦åˆ**è¿­ä»£å™¨**å’Œ**å¯è¿­ä»£**åè®®çš„å¯¹è±¡æ˜¯å¾ˆå®¹æ˜“çš„ã€‚

ä¸ºäº†å½¢è±¡åŒ–è¿™ä¸€ç‚¹ï¼Œè¯·å‚è§ä¸‹å›¾ã€‚

![](img/f4b83fe1b47be35de1f9f964a5eef9ce.png)

An object that is both iterable and iterator

Iterable iterator

## æ— é™åºåˆ—è¿­ä»£å™¨

è¿­ä»£å™¨å¯ä»¥è¡¨è¾¾æ— é™å¤§å°çš„åºåˆ—ï¼Œå› ä¸ºå®ƒä»¬åªåœ¨ä½ éœ€è¦æ—¶æ‰è®¡ç®—å€¼ã€‚

æ³¨æ„ä¸è¦åœ¨æ— é™è¿­ä»£å™¨ä¸Šä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦(`...`)ã€‚JavaScript ä¼šå°è¯•æ¶ˆè€—è¿­ä»£å™¨ï¼Œå› ä¸ºè¿­ä»£å™¨æ˜¯æ— é™çš„ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œä¸ä¼šåˆ°è¾¾ç»ˆç‚¹ã€‚ç›¸åï¼Œä½ çš„åº”ç”¨ä¼šå´©æºƒï¼Œå› ä¸ºä½ ä¼šè€—å°½å†…å­˜ã€‚

æ­¤å¤–,`for ... of`å¾ªç¯åœ¨è¿™æ ·çš„ iterable ä¸Šå°†æ˜¯æ— æ­¢å¢ƒçš„ã€‚ç¡®ä¿é€€å‡ºå¾ªç¯ã€‚å¦åˆ™ï¼Œä½ ä¹Ÿä¼šè€—å°½å†…å­˜ã€‚

Infinite iterator

## ç»“æŸè¿­ä»£å™¨

å‰é¢æˆ‘ä»¬æåˆ°è¿­ä»£å™¨å¯ä»¥é€‰æ‹©ä¸€ä¸ª`return()`æ–¹æ³•ã€‚å½“è¿­ä»£å™¨ç›´åˆ°æœ«å°¾æ‰è¢«è¿­ä»£æ—¶ï¼Œä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¹¶è®©è¿­ä»£å™¨è¿›è¡Œæ¸…ç†ã€‚

`for ... of`å¾ªç¯å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æå‰ç»ˆæ­¢è¿­ä»£:

*   `break`
*   `continue`(å½“ä½ ç”¨æ ‡ç­¾ç»§ç»­å¤–å¾ªç¯æ—¶)
*   `throw`
*   `return`

ä»¥ä¸‹æ„é€ å…³é—­æœªè¢«æ¶ˆè´¹çš„è¿­ä»£å™¨:

*   `for ... of`
*   `yield*`
*   è§£æ„
*   `Array.from`
*   `Map(), Set(), WeakMap(), WeakSet()`
*   `Promise.all(), Promise.race()`

æ‘˜è‡ª[https://2ality.com/2015/02/es6-iteration.html](https://2ality.com/2015/02/es6-iteration.html)ã€‚

Iterator cleanup through return()

*   å¦‚æœä½ çŸ¥é“è¿­ä»£å™¨å·²ç»åˆ°è¾¾ç»ˆç‚¹ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨`cleanup()`å‡½æ•°ã€‚
*   å¦‚æœæœ‰ä¸€ä¸ªçªç„¶çš„å®Œæˆï¼Œé‚£ä¹ˆ`return()`å°±ä¼šå¼€å§‹ä¸ºæˆ‘ä»¬åšæ¸…ç†å·¥ä½œã€‚

![](img/40d455ed760676d291346f96d6ee1cca.png)

# ğŸ’¥é¢å¤–çš„

å¦‚æœä½ å·²ç»åšåˆ°è¿™ä¸€æ­¥äº†ï¼Œæˆ‘ä»¬å†è¡¥å……ä¸€äº›é¢å¤–çš„ä¸œè¥¿ã€‚

## ç»„åˆå­

ç»„åˆå­æ˜¯ç»„åˆç°æœ‰çš„å¯é‡å¤é¡¹æ¥åˆ›å»ºæ–°çš„å¯é‡å¤é¡¹çš„å‡½æ•°ã€‚å¯é‡å¤çš„ç»„åˆã€‚

æ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºè®¸å¤šå®ç”¨å‡½æ•°ã€‚`map`æˆ–è€…`filter`æ€ä¹ˆæ ·ï¼Ÿçœ‹åˆ°ä¸‹é¢çš„ä»£ç ï¼Œç»™å®ƒä¸€åˆ†é’Ÿçš„æ—¶é—´æ¥ç†è§£ã€‚

Combinators

è€¶ï¼ä»£ç å¤ªå¤šäº†ã€‚å¾ˆå¿«æˆ‘ä»¬å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨**ç”Ÿæˆå™¨**å’Œ**å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µ**æ¥é‡æ„è¿™ä¸€åˆ‡ã€‚æ‚¨ä¼šæƒŠè®¶äºæ‰€æœ‰è¿™äº›ä»£ç å¯ä»¥å˜å¾—å¤šä¹ˆç´§å‡‘ã€‚

ä¿æŒå®‰å…¨ï¼Œä¿æŒå…³æ³¨ï¼Œå¹¶ç•™æ„æˆ‘å³å°†åˆ°æ¥çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰å¾ˆå¤šè¦æ¶µç›–ã€‚

ä¸‹æ¬¡è§ã€‚**ğŸºé˜¿å°”æ³•ï¼Œå®Œæ¯•ã€‚**

![](img/40d455ed760676d291346f96d6ee1cca.png)

# èµ„æº

*   [https://exploringjs.com/es6/ch_iteration.html](https://exploringjs.com/es6/ch_iteration.html)
*   [https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Guide/Iterators _ and _ Generators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators)
*   [https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Iteration _ protocols](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols)
*   [https://swi zec . com/blog/finally-a-practical-use-case-for-JavaScript-generators/](https://swizec.com/blog/finally-a-practical-use-case-for-javascript-generators/)
*   [https://2ality.com/2015/02/es6-iteration.html](https://2ality.com/2015/02/es6-iteration.html)
*   [https://www . freecodecamp . org/news/how-and-why-you-should-use-python-generators-f6fb 56650888/](https://www.freecodecamp.org/news/how-and-why-you-should-use-python-generators-f6fb56650888/)
*   [https://vegi bit . com/iterators-in-ES6/#:~:text = ES6 % 20 now % 20 has % 20 what % 20 knownï¼Œthat % 20 returns % 20 an % 20 iterator % 20 object](https://vegibit.com/iterators-in-es6/#:~:text=ES6%20now%20has%20what's%20known,that%20returns%20an%20iterator%20object)ã€‚
*   [https://en.wikipedia.org/wiki/Lazy_evaluation](https://en.wikipedia.org/wiki/Lazy_evaluation)