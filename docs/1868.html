<html>
<head>
<title>How To Convert JSON to CSV — NodeJs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将JSON转换成CSV — NodeJs</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-convert-json-to-csv-nodejs-f6be0778ee5a?source=collection_archive---------1-----------------------#2020-04-30">https://javascript.plainenglish.io/how-to-convert-json-to-csv-nodejs-f6be0778ee5a?source=collection_archive---------1-----------------------#2020-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0f25dbea348dd3b7aa94c390ec56782d.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Q0m0a9LZAt8pzzEixnet7Q.png"/></div></figure><p id="16aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编码让我的生活又变得简单了。几天前，有人向我提出一个问题，我们面前有一个很大的json转储文件，很难想象和理解文件的重要内容。它有一些我们需要提取的非常重要的信息，但是文件太大了，很多时候我的本地编辑器会崩溃，我不得不一直重启我的笔记本电脑。</p><p id="682c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">是时候拿出<strong class="jw ir">的解决方案了。</strong></p><ol class=""><li id="381c" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated">使用第三方网站链接，该链接接受json文件并将其转换为CSV格式。</li><li id="ce0b" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">通过编写代码来自动化这个过程，该代码将接收json文件，对其进行处理，然后将最终输出写入csv文件。</li></ol><p id="eb10" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们用上面的方法来研究一下<strong class="jw ir">问题</strong>。</p><ol class=""><li id="9fd7" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated">使用那个网站的问题是，当你上传你的json文件时(在我们的例子中，它的大小约为20MB)，如果文件大于1MB，所有的在线网站都要收费。我不想花50美元把我的json文件转换成csv文件格式。</li><li id="5ca8" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">我必须研究不同的想法和方法，然后决定哪种技术最适合我的用例。</li></ol><p id="7b80" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">显然，作为一名软件开发工程师，我选择了第二种方法，为了解决上面的问题，我使用了我最喜欢的框架- <strong class="jw ir"> NodeJs </strong>。</p><p id="dcaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">出于演示的目的，我将采取一个小的样本json，这里是它看起来如何:-</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="480e" class="lp lq iq ll b gy lr ls l lt lu">{<br/>  "$schema": "<a class="ae lv" href="https://vega.github.io/schema/vega/v4.json" rel="noopener ugc nofollow" target="_blank">https://vega.github.io/schema/vega/v4.json</a>",<br/>  "width": 400,<br/>  "padding": 5,<br/>  "autosize": "pad",<br/>  "data": [<br/>    {<br/>      "url": "data/summary3.csv",<br/>      "name": "tuples",<br/>      "transform": [<br/>        {<br/>          "type": "aggregate",<br/>          "groupby": ["a", "b", "d"],<br/>          "fields": ["c"],<br/>          "ops": ["average"],<br/>          "as": ["c"]<br/>        }<br/>      ]<br/>    },<br/>    {<br/>      "name": "trellis",<br/>      "source": "tuples",<br/>      "transform": [<br/>        {"type": "aggregate", "groupby": ["a"]},<br/>        {<br/>          "type": "formula",<br/>          "as": "span",<br/>          "expr": "rangeStep * bandspace(datum.count, innerPadding, outerPadding)"<br/>        },<br/>        {"type": "stack", "field": "span"},<br/>        {"type": "extent", "field": "y1", "signal": "trellisExtent"}<br/>      ]<br/>    }<br/>  ],<br/>  "legends": [<br/>    {"fill": "color", "orient": "right", "title": "Objective Categories"}<br/>  ],<br/>  "signals": [<br/>    {"name": "rangeStep", "value": 20},<br/>    {"name": "innerPadding", "value": 0.1},<br/>    {"name": "outerPadding", "value": 0.2},<br/>    {"name": "height", "update": "trellisExtent[1]"},<br/>    {"name": "colors", "value": ["#1f77b4", "#2ca02c", "#ff7f0e", "#1f77b4"]}<br/>  ],<br/>  "scales": [<br/>    {<br/>      "name": "xscale",<br/>      "domain": {"data": "tuples", "field": "c"},<br/>      "nice": true,<br/>      "zero": true,<br/>      "round": true,<br/>      "range": "width"<br/>    },<br/>    {<br/>      "name": "color",<br/>      "type": "ordinal",<br/>      "range": {"signal": "colors"},<br/>      "domain": {"data": "trellis", "field": "a"}<br/>    }<br/>  ],<br/>  "axes": [<br/>    {<br/>      "orient": "bottom",<br/>      "scale": "xscale",<br/>      "title": "Percent complete",<br/>      "ticks": true,<br/>      "labels": true,<br/>      "grid": true,<br/>      "domain": true<br/>    }<br/>  ],<br/>  "marks": [<br/>    {<br/>      "type": "group",<br/>      "from": {<br/>        "data": "trellis",<br/>        "facet": {"name": "faceted_tuples", "data": "tuples", "groupby": "a"}<br/>      },<br/>      "encode": {<br/>        "enter": {"x": {"value": 0}, "width": {"signal": "width"}},<br/>        "update": {"y": {"field": "y0"}, "y2": {"field": "y1"}}<br/>      },<br/>      "scales": [<br/>        {<br/>          "name": "yscale",<br/>          "type": "band",<br/>          "paddingInner": {"signal": "innerPadding"},<br/>          "paddingOuter": {"signal": "outerPadding"},<br/>          "round": true,<br/>          "domain": {"data": "faceted_tuples", "field": "b"},<br/>          "range": {"step": {"signal": "rangeStep"}}<br/>        }<br/>      ],<br/>      "axes": [<br/>        {<br/>          "orient": "left",<br/>          "scale": "yscale",<br/>          "ticks": false,<br/>          "domain": false,<br/>          "labelPadding": 4<br/>        }<br/>      ],<br/>      "marks": [<br/>        {<br/>          "type": "rect",<br/>          "from": {"data": "faceted_tuples"},<br/>          "encode": {<br/>            "enter": {<br/>              "x": {"value": 0},<br/>              "x2": {"scale": "xscale", "field": "c"},<br/>              "fill": {"scale": "color", "field": "a"},<br/>              "strokeWidth": {"value": 2},<br/>              "tooltip": {"field": "d"},<br/>              "hover": {"fill": {"value": "red"}}<br/>            },<br/>            "update": {<br/>              "y": {"scale": "yscale", "field": "b"},<br/>              "height": {"scale": "yscale", "band": 1},<br/>              "stroke": {"value": null},<br/>              "zindex": {"value": 0}<br/>            },<br/>            "hover": {"stroke": {"value": "firebrick"}, "zindex": {"value": 1}}<br/>          }<br/>        }<br/>      ]<br/>    }<br/>  ]<br/>}</span></pre><p id="8477" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在创建一个文件夹，你可以随意命名，并快速运行命令- <code class="fe lw lx ly ll b">npm init</code>。这将用<strong class="jw ir"> package.json </strong>文件初始化你的文件夹。</p><p id="dd8c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我搜索了一下，发现<strong class="jw ir"> npm </strong>包<strong class="jw ir"> csvjson </strong>很有帮助。使用下面的命令安装它和一些其他的包。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="d71c" class="lp lq iq ll b gy lr ls l lt lu">npm i csvjson<br/>npm i fs</span></pre><p id="9e0d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们快速进入编码部分，不要花太多时间。创建一个名为- index.js的文件，并将以下内容粘贴到其中。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="7b87" class="lp lq iq ll b gy lr ls l lt lu">const csvjson = require('csvjson');<br/>const readFile = require('fs').readFile;<br/>const writeFile = require('fs').writeFile;</span><span id="f0b2" class="lp lq iq ll b gy lz ls l lt lu">readFile('./test-data.json', 'utf-8', (err, fileContent) =&gt; {<br/>    if (err) {<br/>        console.log(err); // Do something to handle the error or just throw it<br/>        throw new Error(err);<br/>    }</span><span id="5c7e" class="lp lq iq ll b gy lz ls l lt lu">txs = JSON.parse(JSON.stringify(fileContent));</span><span id="dfcf" class="lp lq iq ll b gy lz ls l lt lu">finalTxs = []<br/>    for(let i=0; i&lt;=1; i++) {<br/>      finalTxs.push(fileContent[i]);<br/>    }</span><span id="0a92" class="lp lq iq ll b gy lz ls l lt lu">const csvData = csvjson.toCSV(finalTxs, {<br/>        headers: 'key'<br/>    });<br/>    writeFile('./test-data.csv', csvData, (err) =&gt; {<br/>        if(err) {<br/>            console.log(err); // Do something to handle the error or just throw it<br/>        }<br/>        console.log('Success!');<br/>    });<br/>});</span></pre><p id="9241" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我来解释一下上面代码的要点。</p><ol class=""><li id="0952" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated">导入csvjson和fs包。</li><li id="57fb" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">创建readFile和writeFile对象。</li><li id="4cd4" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">假设您的输入内容存在于<strong class="jw ir"> test-data.json </strong>文件中，我们开始读取它。</li><li id="0317" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">我们一读完，就把内容存入一个变量。</li><li id="8a76" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">第4步完成后，我们调用转换方法。<strong class="jw ir"> toCSV </strong>，传入输入内容变量，并开始将输出数据写入名为<strong class="jw ir"> test-data.csv </strong>的文件。</li></ol><p id="c5b5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要运行<strong class="jw ir"> index.js </strong>文件，可以使用的命令是<code class="fe lw lx ly ll b">node index.js</code>。</p><p id="b20d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我希望上面的文章很容易理解，我花了一个小时才弄明白上面所有的东西，但我还是写了一篇文章，这样以后就没有人需要花这么多精力去解决一个简单的问题了。</p><h2 id="e0d5" class="lp lq iq bd ma mb mc dn md me mf dp mg kf mh mi mj kj mk ml mm kn mn mo mp mq bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="eef2" class="pw-post-body-paragraph ju jv iq jw b jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae lv" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jw ir">AI in Plain English</strong></a><a class="ae lv" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jw ir">UX in Plain English</strong></a><a class="ae lv" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jw ir">Python in Plain English</strong></a><strong class="jw ir"/>——谢谢，继续学习！</p><p id="c84d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae lv" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">submissions @ plain English . io</strong></a><strong class="jw ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>