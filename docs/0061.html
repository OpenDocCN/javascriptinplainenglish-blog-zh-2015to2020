<html>
<head>
<title>Building a JavaScript Monorepo with Lerna</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Lerna构建JavaScript Monorepo</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-monorepo-with-lerna-5729d6242302?source=collection_archive---------4-----------------------#2019-01-06">https://javascript.plainenglish.io/javascript-monorepo-with-lerna-5729d6242302?source=collection_archive---------4-----------------------#2019-01-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a13b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如今的JavaScript几乎无处不在:后端、前端、桌面、移动、工具等等。</p><p id="5d7b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你的项目由多个JavaScript库组成，现在，最好将它们转移到一个/mono库中，并使用Lerna控制它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d52eb3c348420a931ee01b4e01a67e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ITPWdo1leQjJ4mogqBvrlQ.png"/></div></div></figure><h1 id="455e" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">什么是Lerna？</h1><blockquote class="ls lt lu"><p id="8ee3" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated"><a class="ae lz" href="https://lernajs.io" rel="noopener ugc nofollow" target="_blank"> Lerna </a>是一个用多个包管理JavaScript项目的工具。</p></blockquote><p id="5f48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们继续之前，我建议您看一下<a class="ae lz" href="https://github.com/lerna/lerna" rel="noopener ugc nofollow" target="_blank"> lerna命令</a>。</p><h1 id="2013" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么是Monorepo？</h1><p id="635f" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated"><strong class="jm io"> <em class="lv"> Monorepo </em> </strong>不是将一个项目中的所有东西混合在一起(<strong class="jm io">不要与monolith </strong>混淆)。<br/> <strong class="jm io"> Monorepo </strong>是关于在一个存储库中拥有属于一个域的多个应用程序、服务和库的源代码。</p><blockquote class="ls lt lu"><p id="a891" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated"><strong class="jm io">注意:</strong> Monorepo可以以任何舒适的方式组织，目录树，这取决于开发人员/团队。</p></blockquote><h2 id="b381" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">优点:</h2><ul class=""><li id="de17" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh mw mx my mz bi translated">整个系统(应用/服务/库)的固定版本。</li><li id="3577" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><strong class="jm io">跨项目变更。</strong>例如，一个改变系统多个部分(库/服务/应用)的特性可以在一个拉取请求中完成。</li><li id="b28d" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><strong class="jm io">单克隆</strong>。不需要克隆多个存储库。</li><li id="41a5" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><strong class="jm io">进入系统的所有部分</strong>。整个系统的简化重构。</li></ul><h2 id="f6e8" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">缺点:</h2><ul class=""><li id="b368" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh mw mx my mz bi translated">版本控制系统性能下降。</li><li id="5786" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated">安全。所有开发人员都可以访问系统的所有部分。</li></ul><h1 id="fe66" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">要求</h1><ul class=""><li id="3fcf" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh mw mx my mz bi translated">节点。JS版本8或以上</li></ul><h1 id="ece5" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">开始</h1><p id="64f1" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">在本例中，我们将创建一个简单的应用程序，包括:</p><ul class=""><li id="b08a" class="mr ms in jm b jn jo jr js jv nf jz ng kd nh kh mw mx my mz bi translated"><strong class="jm io"> API: </strong> API服务(后端)</li><li id="d7ed" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><strong class="jm io">前端:</strong>前端/web app</li></ul><p id="fa69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，为了不将所有逻辑混在一起，我们将创建单独的包:</p><ul class=""><li id="b492" class="mr ms in jm b jn jo jr js jv nf jz ng kd nh kh mw mx my mz bi translated"><strong class="jm io">验证器:</strong>自定义验证库/包</li><li id="ed1e" class="mr ms in jm b jn na jr nb jv nc jz nd kd ne kh mw mx my mz bi translated"><strong class="jm io">日志记录器:</strong>自定义日志记录库/包</li></ul><p id="bee5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们monorepo项目的整体文件结构是:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="f03e" class="mf kv in nj b gy nn no l np nq"><strong class="nj io">packages/</strong>        # directory for our custom libraries<br/>../validator      # custom validation helpers<br/>../logger         # custom logger library<br/><strong class="nj io">apps/</strong>            # directory for our apps/services<br/>../api            # API backend<br/>../frontend       # frontend/web</span></pre><h2 id="ff82" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">1.初始化Monorepo</h2><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="8f1f" class="mf kv in nj b gy nn no l np nq"># install lerna globally<br/>npm i -g lerna</span><span id="30f7" class="mf kv in nj b gy nr no l np nq"># create a new dir for project<br/>mkdir my-project &amp;&amp; cd my-project</span><span id="b655" class="mf kv in nj b gy nr no l np nq"># initialize a new lerna managed repository<br/>lerna init</span></pre><p id="a79c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并编辑<code class="fe ns nt nu nj b">lerna.json</code></p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="92a6" class="mf kv in nj b gy nn no l np nq">{<br/>  "packages": [ "packages/*", <strong class="nj io">"apps/*"</strong>],<br/>  "version": <strong class="nj io">"0.1.0"</strong><br/>}</span></pre><blockquote class="ls lt lu"><p id="319f" class="jk jl lv jm b jn jo jp jq jr js jt ju lw jw jx jy lx ka kb kc ly ke kf kg kh ig bi translated"><strong class="jm io">注意:</strong>我们将使用<a class="ae lz" href="https://docs.npmjs.com/misc/scope" rel="noopener ugc nofollow" target="_blank"> npm范围的包</a>命名我们所有的应用和包。<br/>举例:<code class="fe ns nt nu nj b">@my-project/{package-name}</code></p></blockquote><p id="deb2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们从库包开始。</p><h2 id="3123" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">2.创造一个<code class="fe ns nt nu nj b">"validator" library package</code></h2><ol class=""><li id="99f9" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh nv mx my mz bi translated">创建并初始化<code class="fe ns nt nu nj b">@my-project/validator</code>包:</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="dda9" class="mf kv in nj b gy nn no l np nq"># create library directory and cd inside<br/>mkdir -p packages/validator &amp;&amp; cd packages/validator</span><span id="4bfe" class="mf kv in nj b gy nr no l np nq"># initialize library with scope name<br/>npm init --scope=my-project --yes</span></pre><p id="36a9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.增加<code class="fe ns nt nu nj b">packages/validator/index.js</code>，内容如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="aac0" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">3.创建一个“记录器”库包</h2><ol class=""><li id="48d5" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh nv mx my mz bi translated">创建并初始化<code class="fe ns nt nu nj b">@my-project/logger</code>包:</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="0701" class="mf kv in nj b gy nn no l np nq"># From the root directory of the repository</span><span id="62ce" class="mf kv in nj b gy nr no l np nq"># create library directory and cd inside<br/>mkdir -p packages/logger &amp;&amp; cd packages/logger</span><span id="8e0d" class="mf kv in nj b gy nr no l np nq"># initialize library with scope name<br/>npm init --scope=my-project --yes</span></pre><p id="45e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.添加以下内容的<code class="fe ns nt nu nj b">packages/logger/index.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="0bc4" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">4.创建“api”应用程序包</h2><ol class=""><li id="2bb7" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh nv mx my mz bi translated">创建并初始化<code class="fe ns nt nu nj b">@my-project/api</code>包:</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="511a" class="mf kv in nj b gy nn no l np nq"># From the root directory of the repository</span><span id="46a7" class="mf kv in nj b gy nr no l np nq"># create app directory and cd inside<br/>mkdir -p apps/api &amp;&amp; cd apps/api</span><span id="54a7" class="mf kv in nj b gy nr no l np nq"># initialize app with scope name<strong class="nj io"><br/></strong>npm init --scope=my-project --yes</span><span id="c4c9" class="mf kv in nj b gy nr no l np nq"># install express<strong class="nj io"><br/></strong>npm i express --save</span><span id="06f0" class="mf kv in nj b gy nr no l np nq"># add our <strong class="nj io">logger</strong> library as dependency to our <strong class="nj io">api</strong> app<strong class="nj io"><br/></strong>lerna add @my-project/logger --scope=@my-project/api</span></pre><p id="c04a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.添加<code class="fe ns nt nu nj b">apps/api/index.js</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="0a06" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.将开始脚本添加到<code class="fe ns nt nu nj b">apps/api/package.json</code>:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="3de0" class="mf kv in nj b gy nn no l np nq">"scripts": {<br/> <strong class="nj io"> "start": "node index.js"</strong><br/>  ...<br/>}</span></pre><p id="b6ec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.运行app: <code class="fe ns nt nu nj b"><strong class="jm io">npm start</strong></code>打开<code class="fe ns nt nu nj b">http://localhost:8080/greeting</code></p><h2 id="d781" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated">5.创建“前端”应用程序包</h2><ol class=""><li id="2853" class="mr ms in jm b jn ma jr mb jv mt jz mu kd mv kh nv mx my mz bi translated">使用<code class="fe ns nt nu nj b">create-react-app</code>创建<code class="fe ns nt nu nj b">@my-project/frontend</code>:</li></ol><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="68b9" class="mf kv in nj b gy nn no l np nq"># From the root directory of the repository</span><span id="b2ec" class="mf kv in nj b gy nr no l np nq"># create frontend app using create-react-app<strong class="nj io"><br/></strong>cd apps &amp;&amp; npx create-react-app frontend</span></pre><p id="0f07" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.编辑<code class="fe ns nt nu nj b">apps/frontend/package.json</code> <strong class="jm io"> : </strong></p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="ac7e" class="mf kv in nj b gy nn no l np nq">{<br/><strong class="nj io">  "name": "@my-project/frontend",</strong><br/>  ...<br/><strong class="nj io">  "proxy": "http://localhost:8080"</strong><br/>}</span></pre><p id="a1c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.将我们的验证器作为依赖项添加到我们的前端。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="457f" class="mf kv in nj b gy nn no l np nq"># Add <strong class="nj io">validator</strong> library as a dependency to <strong class="nj io">frontend</strong> <strong class="nj io"><br/></strong>lerna add @my-project/validator --scope=@my-project/frontend</span></pre><p id="4f0a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.添加<code class="fe ns nt nu nj b">apps/frontend/src/Greeting.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="31e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">5.在<code class="fe ns nt nu nj b">apps/frontend/src/App.js</code>内的某处添加<code class="fe ns nt nu nj b">&lt;Greeting /&gt;</code>:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="1e89" class="mf kv in nj b gy nn no l np nq">...<br/><strong class="nj io">import {Greeting} from './Greeting';</strong></span><span id="721d" class="mf kv in nj b gy nr no l np nq">class App extends Component {<br/>  ...<br/>  render() {<br/>    return (<br/>        &lt;div className="App"&gt;<br/>           &lt;header className="App-header"&gt;<br/>             ...<br/>             <strong class="nj io">&lt;Greeting /&gt;</strong><br/>           &lt;/header&gt;<br/>        &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/>...</span></pre><p id="2679" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">6.运行前端app: <code class="fe ns nt nu nj b">npm start</code>打开<code class="fe ns nt nu nj b">http://localhost:3000</code>。</p><h1 id="6230" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="ecb5" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">如你所见，一个mono库可以包含项目所需的任意数量的应用程序和库。重要的是保持一切松散耦合:</p><ul class=""><li id="a70b" class="mr ms in jm b jn jo jr js jv nf jz ng kd nh kh mw mx my mz bi translated">一个应用/服务/库-&gt;一个包</li></ul><p id="58c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">公共逻辑、实用程序或助手可以放在一个单独的包中。因此，我们可以构建高度独立的包，这更容易理解、维护和重构。</p><p id="9fd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参见<a class="ae lz" href="https://github.com/erzhtor/javascript-monorepo-with-lerna" rel="noopener ugc nofollow" target="_blank"> Github </a>上的完整源代码。</p><p id="890a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，您可以在这里查看更高级的monorepo示例<a class="ae lz" href="https://github.com/erzhtor/algebroid" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="66ed" class="mf kv in bd kw mg mh dn la mi mj dp le jv mk ml li jz mm mn lm kd mo mp lq mq bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="bb78" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae lz" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jm io">AI in Plain English</strong></a>，<a class="ae lz" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jm io">UX in Plain English</strong></a>，<a class="ae lz" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jm io">Python in Plain English</strong></a><strong class="jm io"/>——谢谢，继续学习！</p><p id="3026" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae lz" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">submissions @ plain English . io</strong></a><strong class="jm io"/>，使用您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>