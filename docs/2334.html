<html>
<head>
<title>Customizing your Angular app’s Webpack configuration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义Angular应用程序的Webpack配置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/customizing-your-angular-apps-webpack-configuration-4099144949fc?source=collection_archive---------1-----------------------#2020-06-14">https://javascript.plainenglish.io/customizing-your-angular-apps-webpack-configuration-4099144949fc?source=collection_archive---------1-----------------------#2020-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2f44" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们看看如何定制我们的Angular应用程序的Webpack配置</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/91a8a70f23472a914c1ccb569c18cc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tB6NBwXaQpGMg4FY8FE7AQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Picture courtesy of <a class="ae kv" href="https://unsplash.com/@alenjcreative" rel="noopener ugc nofollow" target="_blank">Alen Jacob</a></figcaption></figure><p id="da4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将解释<em class="ls">为什么</em>你可能需要定制你的Angular应用程序的Webpack配置，我还将向你展示<em class="ls">如何做</em>。</p><p id="26e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这实际上是我已经在<a class="ae kv" href="https://medium.com/javascript-in-plain-english/adding-tailwind-support-to-a-nrwl-nx-workspace-with-angular-and-storybook-bf890ea882e" rel="noopener">的上一篇文章</a>中涉及到的东西，但是在这里我想集中在Webpack部分(为什么和如何)。</p><h1 id="1e36" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">为什么不呢？</h1><p id="f3e1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">通常，没有必要摆弄Angular的构建系统，这是一件<em class="ls">好事</em>。</p><p id="5683" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大约在2016年，我是一系列项目的发起人、PM和技术负责人，这些项目旨在使比利时国家银行创建Web应用和API的方式现代化。作为该项目的一部分，我想创建一个好的解决方案来构建我们的应用程序。</p><p id="4d6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在业余时间，我花了几十个小时为Web应用程序创建了一个基于gulp的现代构建系统。当时，我发现网络上许多很酷的工具缺乏集成，想要一个简单易用的解决方案来解决反复出现的问题。</p><p id="382b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的项目有很多优点:ES2015 &amp; TypeScript支持、SASS支持、使用CORS的实时重新加载和跨设备同步(使用BrowserSync)、sourcemaps、CSS优化/缩小、JS缩小/捆绑、HTML缩小、图像优化、JS/TS/CSS代码质量和代码风格检查等。我甚至为它创造了一个约曼发电机。这个想法很吸引我:定义一次构建系统并重用它，而不是在每个应用程序中维护一次性的构建系统。</p><p id="cd03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题是，当我在那个副业项目上取得进展时，我让自己沉浸在复杂的海洋中(这是TBH的乐趣)。然后，Webpack变得超级流行(理由很充分)，因为它让很多事情变得简单多了。我很快意识到吞咽已经成为过去。然后，随着时间的推移，Angular CLI取得了巨大的进步，在某种程度上，很明显CLI是正确的选择。</p><p id="2ea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">长话短说，除非您深入研究了CLI构建系统处理的集成问题，否则您可能不知道创建类似的东西有多复杂，它不仅仅是传输或捆绑您的代码。这里面隐藏着无数的技术挑战。它不仅仅创造了一次。随着时间的推移，随着拼图的所有部分继续进化，它也保持其功能。你只是不想做所有的工作。</p><p id="b7cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想要个例子吗？我想你已经听说了<a class="ae kv" href="https://github.com/palantir/tslint/issues/4534" rel="noopener ugc nofollow" target="_blank"> TSLint被</a>抛弃，取而代之的是<a class="ae kv" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a>。这对TS社区来说太棒了。但是TSLint仍然是Angular CLI的默认设置，现在无数的应用程序依赖于它，有时甚至不知道。Angular团队现在正在<a class="ae kv" href="https://github.com/angular/angular-cli/issues/13732" rel="noopener ugc nofollow" target="_blank">准备淘汰和向ESLint </a>迁移。而且这事<a class="ae kv" href="https://github.com/angular/angular-cli/issues/13732#issuecomment-575796158" rel="noopener ugc nofollow" target="_blank">也没那么容易</a>。对我们来说幸运的是，他们正在处理这件事，而我们可以专注于构建酷的Web应用程序。正如他们所说，无知是福…</p><p id="6d5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在过去，定制由Angular CLI管理的构建系统的唯一选项是使用<code class="fe mq mr ms mt b">ng eject</code>命令，但是从Angular 6 开始不再支持<a class="ae kv" href="https://github.com/angular/angular-cli/issues/10618" rel="noopener ugc nofollow" target="_blank">。无论如何，弹射的问题在于它是一列单程列车。如果您使用了它，那么就没有(容易的)返回方法，并且您继承了所有的复杂性和维护负担。所以“驱逐”基本上是不可以的(除了拥有足够资源的大型组织)。</a></p><p id="7497" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个试图避免定制你的构建的原因是Angular越来越接近能够支持<a class="ae kv" href="https://bazel.build/" rel="noopener ugc nofollow" target="_blank"> Bazel </a>的事实，这对每个人的性能都有重要影响。当Bazel支持变得广泛可用时，如果您深陷定制领域，那么<a class="ae kv" href="https://medium.com/@martindzejky/from-custom-webpack-build-to-angular-cli-9d87c3da6925" rel="noopener">您可能会后悔</a>，因为您将被“旧”所困。</p><h1 id="2f58" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">为什么</h1><p id="e15e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">好了，你知道为什么不应该定制构建了。但是如果你真的需要呢？在很多情况下，定制/扩展构建是有意义的，甚至是解决某些问题的唯一方法。</p><p id="568d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想要/需要使用像<a class="ae kv" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> Tailwind </a>这样的工具，它们必须<a class="ae kv" href="https://medium.com/javascript-in-plain-english/adding-tailwind-support-to-a-nrwl-nx-workspace-with-angular-and-storybook-bf890ea882e" rel="noopener">与构建</a>集成，那么你没有太多的选择。</p><p id="296e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，上周，另一件需要我定制构建的事情是，<a class="ae kv" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> MomentJS </a>地区都被添加到了我的应用程序的JS包中，尽管我只需要2-3个。我本来可以忽略它，但是对包大小的影响太大了。</p><p id="43a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，虽然您希望保持谨慎，不要走极端，但是有充分的理由不时地定制构建。你只需要小心不要走得太远。</p><h1 id="fbda" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">方法</h1><p id="eef3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">你可能知道，Angular CLI仍然在引擎盖下使用<a class="ae kv" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>。</p><p id="3f1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要定制构建系统，有两种主要的解决方案:</p><ul class=""><li id="c517" class="mu mv iq ky b kz la lc ld lf mw lj mx ln my lr mz na nb nc bi translated">由<a class="ae kv" href="https://twitter.com/ManfredSteyer?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener ugc nofollow" target="_blank"> Manfred Steyer </a>创建/维护的<a class="ae kv" href="https://github.com/manfredsteyer/ngx-build-plus" rel="noopener ugc nofollow" target="_blank"> ngx-build-plus </a>实用程序</li><li id="dcb9" class="mu mv iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">由<a class="ae kv" href="https://twitter.com/_Just_JeB_" rel="noopener ugc nofollow" target="_blank">“杰布”巴拉巴诺夫</a>创建/维护的<a class="ae kv" href="https://github.com/just-jeb/angular-builders" rel="noopener ugc nofollow" target="_blank"> angular-builders自定义网络包</a>实用程序</li></ul><p id="54b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个项目都支持使用定制的Webpack配置来扩展默认构建，这正是我们主要追求的。ngx-build-plus提供了一些原理图和对角度元素的支持；如果你在那之后，那么你知道使用什么；-)</p><p id="b76d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就我而言，我选择了angular-builders定制webpack，到目前为止，我是一个快乐的用户。最酷的事情(实际上也是ngx-build-plus，afaik所支持的)是它没有取代CLI的默认版本。相反，这个项目允许你扩展它，甚至对不同的部分使用不同的合并策略。</p><h1 id="b39c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">怎么</h1><p id="5c10" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">好了，让我们看看如何使用angular-builder custom-webpack定制构建。</p><p id="2dee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您需要安装以下依赖项:</p><pre class="kg kh ki kj gt ni mt nj nk aw nl bi"><span id="e528" class="nm lu iq mt b gy nn no l np nq">npm install --save-dev @angular-builders/custom-webpack</span></pre><p id="1d9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，我将它保存为<code class="fe mq mr ms mt b">devDependency</code>，因为它只在开发过程中需要。完成后，您需要修改项目中的<strong class="ky ir"> angular.json </strong>文件，以便使用自定义构建器并提供自定义Webpack配置的路径:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="acbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我为<code class="fe mq mr ms mt b">build</code>和<code class="fe mq mr ms mt b">serve</code>目标重用了同一个<strong class="ky ir"> webpack.config.js </strong>文件，但是如果需要的话，你可以使用不同的文件。这完全取决于你想要达到的目标。</p><p id="e0e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来当然是<strong class="ky ir"> webpack.config.js </strong>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="d22f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如你所看到的，这很简单。您只需要导出一个标准的Webpack配置对象。冷静点。从现在开始，只需要知道Webpack是如何工作的。如果您还不熟悉网络包，您肯定应该了解它。这是一个很好的时间投资。</p><p id="3675" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，angular-builder web pack-config使用<a class="ae kv" href="https://github.com/survivejs/webpack-merge" rel="noopener ugc nofollow" target="_blank">https://github.com/survivejs/webpack-merge</a>及其选项自动将您的配置与CLI的默认配置合并。</p><p id="5503" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这非常有效，可以使用<code class="fe mq mr ms mt b">mergeStrategies</code>和<code class="fe mq mr ms mt b">replaceDuplicatePlugins</code>选项进行调整。多亏了这些，您可以决定您的自定义配置是附加到默认配置(默认行为)上，还是应该完全替换默认配置。<code class="fe mq mr ms mt b">replaceDuplicatePlugins</code>选项让你按照自己的定义替换插件。</p><p id="fe8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于更复杂的场景，您也可以导出函数而不是对象。当您这样做的时候，angular-builder custom-webpack将调用带有默认配置、默认选项等的函数，并让您决定具体做什么来生成最终配置。我不建议您这样做，除非您确定您需要这样做，因为您将失去默认行为和对自动配置合并的支持。</p><p id="bfbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查看文档，了解更多关于铃声和哨声的信息！JeB还在<a class="ae kv" href="https://medium.com/angular-in-depth/customizing-angular-cli-build-an-alternative-to-ng-eject-v2-c655768b48cc" rel="noopener">角度深度</a>中写了一篇关于他的工具的有趣帖子。</p><h1 id="9ca7" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">TypeScript支持</h1><p id="36da" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">正如你可能知道的，我是TypeScript的超级粉丝(以至于我甚至为此写了一本该死的书)。我很高兴地发现，用于角度构建器webpack-config的自定义Webpack配置文件可以用TypeScript编写。太棒了。</p><p id="29bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，这里有一个早期定制Webpack配置文件的TS版本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="cc7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您只需要将其名称修改为<code class="fe mq mr ms mt b">webpack.config.ts</code>并相应地更新您的<code class="fe mq mr ms mt b">angular.json</code>文件。</p><p id="7d56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">生活难道不美丽吗？；-)</p><h1 id="cb1c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="9432" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在本文中，我给了你一些避免定制你的Angular应用程序的理由。然而，由于有相当多的情况下确实需要定制，所以我给出了不同的方法，您可以使用这些方法来扩展甚至覆盖由Angular CLI提供的默认构建管道的某些部分。</p><p id="1e34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，在实践中很容易做到，甚至可以用TypeScript编写。</p><p id="89d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论如何，如果可以的话，尽量避免这种情况，这样一旦Angular及其CLI转向Bazel，您就不会被一个难以维护的自制构建系统所困。</p><p id="f59d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天就到这里吧！</p><h1 id="2214" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">喜欢这篇文章吗？</h1><p id="d56a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你想了解很多关于软件/网络开发的很酷的东西，比如TypeScript、Angular、reactor、Vue、Kotlin、Java、Docker/Kubernetes以及其他很酷的主题，那么请不要犹豫<a class="ae kv" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">拿一份我的书</a>并订阅<a class="ae kv" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的时事通讯</a>！</p></div></div>    
</body>
</html>