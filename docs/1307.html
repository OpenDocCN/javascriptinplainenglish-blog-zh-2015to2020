<html>
<head>
<title>Introduction to Push Notifications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推送通知简介</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-push-notifications-c4a08186857e?source=collection_archive---------6-----------------------#2020-02-27">https://javascript.plainenglish.io/introduction-to-push-notifications-c4a08186857e?source=collection_archive---------6-----------------------#2020-02-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="46e6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让你的网络应用离原生应用更近一步</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0a4ac87844e2085e4a07c80abb74aa57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mhs0J6SlPyP_hKOE"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jamie452?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jamie Street</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.webtips.dev/introduction-to-push-notifications"><div class="gh gi kw"><img src="../Images/c19cb3069af1beba3c93258d9fcfe139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*-PVzecNs3s4ZbJsdsgIsGA.png"/></div></a></figure><p id="bd02" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">推送通知是与用户群保持联系的好方法。它让您的web应用离原生桌面和移动应用更近了一步。</p><p id="b635" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这些通知可以由正在运行的应用程序触发，甚至可以在应用程序未运行时由服务器触发。API需要用户的许可，所以你可以确保你只发送通知给那些真正需要他们的人。</p><p id="cfc3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">他们在一个<a class="ae kv" href="https://www.webtips.dev/going-offline-with-service-workers" rel="noopener ugc nofollow" target="_blank">服务工作者</a>之上工作，这是一种特殊类型的网络工作者，其目的是让你的应用在用户离线时可用。因此，为了使用推送通知，您必须有一个合适的服务人员。建立服务人员后，我们可以继续检查支持和用户权限。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="00b1" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">检查支持和许可</h1><p id="d078" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">如果我们检查对<a class="ae kv" href="https://caniuse.com/#feat=mdn-api_notification" rel="noopener ugc nofollow" target="_blank">can use</a>的支持，我们可以看到通知API还没有被广泛采用，它目前占78%。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/b810fd3737fec5579a0886d0de2c39dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIh_dsYRjzE9YXQQZogesw.png"/></div></div></figure><p id="1a6f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这就是为什么我们需要检查浏览器是否支持它。幸运的是，这可以用一条if语句来完成:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="55c3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如您所见，我们还需要检查<code class="fe na nb nc nd b">serviceWorker</code>的存在，因为通知是通过它们发送的。除了支持之外，我们还需要检查权限，因为我们需要获得用户权限来显示通知:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="15be" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果第一个If语句已经完成，我们就可以开始向用户发送通知。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="c5a4" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">发送通知</h1><p id="8269" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">正如本文开头提到的，要发送通知，我们必须注册一个<code class="fe na nb nc nd b">serviceWorker</code>。要显示通知，我们需要使用服务工作者注册对象:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7281" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">注册并检查支持/许可后，我们可以呼叫<code class="fe na nb nc nd b">serviceWorker.getRegistration()</code>向服务人员请求注册对象，然后我们可以发出我们的第一个推送通知:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/97f7db8ea8f7b65f1ba1ed3bd80b79cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/1*DXYYkYgQAiyU8dYsGHAO0g.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Make sure you test it with a webserver</figcaption></figure><p id="8280" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">看起来不错，但目前还没什么特别的。我们再增加一些选项。</p><h2 id="88f7" class="nf mb iq bd mc ng nh dn mg ni nj dp mk lg nk nl mm lk nm nn mo lo no np mq nq bi translated">添加更多选项</h2><p id="dd88" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">对于添加选项，您可以创建一个新对象，并将其作为第二个参数添加到<code class="fe na nb nc nd b">showNotification</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1765" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这种情况下，第一个参数成为标题。有关可用选项的完整列表，请参见MDN 上的<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/notification/Notification" rel="noopener ugc nofollow" target="_blank">文档。有许多有用的属性可以传递，例如:</a></p><ul class=""><li id="64c3" class="nr ns iq kz b la lb ld le lg nt lk nu lo nv ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">vibrate</code>:移动设备使用的振动模式</li><li id="cd49" class="nr ns iq kz b la oa ld ob lg oc lk od lo oe ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">silent</code>:布尔值，指定通知是否无声</li><li id="02b8" class="nr ns iq kz b la oa ld ob lg oc lk od lo oe ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">data</code>:包含任意值的任意数据，以便您可以识别与哪个通知进行了交互</li><li id="084d" class="nr ns iq kz b la oa ld ob lg oc lk od lo oe ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">actions</code>:可供用户选择的<code class="fe na nb nc nd b">NotificationActions</code>数组，我们现在就来看看</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/b619159053ff2be5fb375842939456ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/1*P9E1ZYPRKiWBb62qsRgekQ.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Push notification with the provided options</figcaption></figure><h2 id="784f" class="nf mb iq bd mc ng nh dn mg ni nj dp mk lg nk nl mm lk nm nn mo lo no np mq nq bi translated">添加操作</h2><p id="ff36" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">如果你想让用户与你的推送通知交互，你需要在你的选项中添加一个<code class="fe na nb nc nd b">actions</code>对象。添加以下对象将在通知中添加两个新按钮:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="878b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这里有三个属性可以使用:</p><ul class=""><li id="d085" class="nr ns iq kz b la lb ld le lg nt lk nu lo nv ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">action</code>:用于识别用户采取的动作</li><li id="7e35" class="nr ns iq kz b la oa ld ob lg oc lk od lo oe ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">title</code>:这将是按钮上的文本</li><li id="0521" class="nr ns iq kz b la oa ld ob lg oc lk od lo oe ls nw nx ny nz bi translated"><code class="fe na nb nc nd b">icon</code>:如果标题没有足够的空间，将会显示一个图标</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/917233c5d3a9b9467a95d6b3e00a6801.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/1*GVluWQdo6Q6cmuYrLJxwkg.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Buttons on push notification</figcaption></figure><h2 id="140c" class="nf mb iq bd mc ng nh dn mg ni nj dp mk lg nk nl mm lk nm nn mo lo no np mq nq bi translated">监听事件</h2><p id="abea" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">最后要做的事情是当用户点击其中一个按钮时进行监听，这样我们就可以相应地采取行动。为此，您需要在服务工作者内部附加一个事件监听器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="fb4c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">将以上几行添加到<code class="fe na nb nc nd b">sw.js</code> <em class="og">(我们已经注册的服务人员)</em>中将会记录发出的事件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/5a0c3b5ec55ab6680776e44f012dff55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JF3kLQYkrzINEJiCUwGBvQ.png"/></div></div></figure><p id="15bc" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在<code class="fe na nb nc nd b">NotificationEvent</code>中，您可以访问<code class="fe na nb nc nd b">action</code>，它可以告诉我们用户点击了哪个按钮。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="3355" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">摘要</h1><p id="38a8" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">现在，您可以在任何合适的时候向用户发送通知。这是与您的用户保持联系、提高参与度以及将更新直接发送到他们的设备中的绝佳方式。用户可以随时选择加入或退出，您可以为通知提供的选项数量可以丰富您的内容，并为您的用户量身定制。</p><p id="0917" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在到了困难的部分:做出好的商业决策，弄清楚什么，什么时候，怎么做。你应该通知用户什么，什么时候通知他们合适<em class="og">(不要在半夜通知)</em>以及你的通知应该多频繁。这些问题的答案因应用而异，所以最好的方法是现在就开始试验。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://medium.com/@ferencalmasi/membership"><div class="gh gi oi"><img src="../Images/e66c4cd6d9849ac0bd245f3fc39b65c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ9xuLqLkbqUG65sgVB3gg.png"/></div></a></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.webtips.dev/progressive-web-apps"><div class="gh gi kw"><img src="../Images/af0fcdeb750014450a6cdcde946b2e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*5BgA_R98uh7C30jrnapRHg.png"/></div></a></figure></div></div>    
</body>
</html>