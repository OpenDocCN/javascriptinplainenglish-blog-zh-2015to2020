<html>
<head>
<title>Using Allure and Jest to improve test reporting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Allure和Jest改进测试报告</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-allure-and-jest-to-improve-test-reporting-d43a8e01ab0f?source=collection_archive---------1-----------------------#2020-01-18">https://javascript.plainenglish.io/using-allure-and-jest-to-improve-test-reporting-d43a8e01ab0f?source=collection_archive---------1-----------------------#2020-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b70b6a52e242a855a3346f8063dbeee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1YiqLFKrdpNMZr0ygIvK7g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">An example of Allure</figcaption></figure><p id="3f90" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我最近开始着手一个新的React Native项目，并决定建立标准来确保高水平的质量融入到开发过程中。</p><p id="3ef9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这一过程意味着存在高水平的单元测试和集成测试，随着代码库的增长，由于测试套件增长或变得支离破碎以使代码更干净，这可能变得难以保持。</p><p id="e3bf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我过去用过Allure，但除了它允许一些更花哨的饼状图之外，我从未真正看到它的价值，如果使用了Gherkin，那么你会将特征文件添加到“行为”标签中。</p><p id="9eb2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我也遇到过让Allure与Jest一起工作的问题，因为有许多选项(<code class="fe la lb lc ld b">jest-allure</code>、<code class="fe la lb lc ld b">jest-allure-reporter</code>、<code class="fe la lb lc ld b">allure-jest-circus</code>等等)，并且没有任何关于npm的文档真正有助于理解如何用React Native进行设置。</p><p id="b959" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最终，我在<code class="fe la lb lc ld b">jest-allure</code> Github上找到了更好的文档，它解释了如何通过Jest的<code class="fe la lb lc ld b">setupFilesAfterEnv</code>配置选项设置<code class="fe la lb lc ld b">jest-allure</code>，这让我能够从Allure获得全部价值。</p><h1 id="4871" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">设置jest-allure</h1><p id="dbe7" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz ij bi translated">为了使用<code class="fe la lb lc ld b">jest-allure</code>，你需要首先<a class="ae mh" href="https://www.npmjs.com/package/jest-allure" rel="noopener ugc nofollow" target="_blank">通过npm </a>安装包。</p><p id="b518" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">安装好软件包后，创建一个<code class="fe la lb lc ld b">jest.config.js</code>文件(或添加到现有文件中)并将<code class="fe la lb lc ld b">jest-allure/dist/setup</code>作为一个条目添加到<code class="fe la lb lc ld b">setupFilesAfterEnv</code>键下。</p><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">An example of the Jest Config</figcaption></figure><p id="1466" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，当您运行Jest测试时，您应该会看到一个<code class="fe la lb lc ld b">allure-results</code>目录被创建。</p><h2 id="fa92" class="mo lf iq bd lg mp mq dn lk mr ms dp lo kn mt mu ls kr mv mw lw kv mx my ma mz bi translated">逮到你了</h2><p id="1f52" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz ij bi translated">如果你在运行<code class="fe la lb lc ld b">jest-circus</code>的Jest版本上，你需要安装<code class="fe la lb lc ld b">jest-jasmine2</code>并在你的<code class="fe la lb lc ld b">jest.config.js</code>文件中设置<code class="fe la lb lc ld b">testRunner: 'jest=jasmine2'</code>。</p><p id="7473" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您在使用TypeScript时遇到未定义<code class="fe la lb lc ld b">reporter</code>的问题，请添加下面的<code class="fe la lb lc ld b">global</code>声明，将<code class="fe la lb lc ld b">Reporter</code>类型添加到全局对象中:</p><pre class="mi mj mk ml gt na ld nb bn nc nd bi"><span id="9b9f" class="ne lf iq ld b be nf ng l nh ni">import { Reporter } from 'jest-allure'<br/>declare global {<br/>  let reporter: Reporter<br/>}</span></pre><h1 id="d350" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">生成报告</h1><p id="f1d4" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz ij bi translated">虽然您已经成功运行Jest测试，并且能够创建Allure使用的数据，但是您还没有脱离险境，您仍然需要运行Allure来查看报告。</p><p id="e5b6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以通过NPM 上的 <code class="fe la lb lc ld b"><a class="ae mh" href="https://www.npmjs.com/package/allure-commandline" rel="noopener ugc nofollow" target="_blank">allure-commandline</a></code> <a class="ae mh" href="https://www.npmjs.com/package/allure-commandline" rel="noopener ugc nofollow" target="_blank">包</a><a class="ae mh" href="https://www.npmjs.com/package/allure-commandline" rel="noopener ugc nofollow" target="_blank">下载Allure CLI，然后允许您从终端运行<code class="fe la lb lc ld b">allure</code>。</a></p><p id="10db" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您要使用的主要命令有:</p><ul class=""><li id="d394" class="nj nk iq ke b kf kg kj kk kn nl kr nm kv nn kz no np nq nr bi translated"><code class="fe la lb lc ld b">allure generate</code> —这将生成报告，以便您可以在浏览器中打开它</li><li id="84fc" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><code class="fe la lb lc ld b">allure serve</code> —这会生成报告并为您启动一个web服务器</li></ul><p id="e948" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然而CLI并不监视文件的变化，所以你需要在每次运行测试时运行这些命令，除非你创建一个文件监视器来重新运行<code class="fe la lb lc ld b">allure generate</code>命令和一个单独的web服务器进程(类似于<code class="fe la lb lc ld b">Python -m http.server</code>)。</p><h1 id="8e5c" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">加强报告</h1><figure class="mi mj mk ml gt jr"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">An example of using the Allure reporter object in a Jest test</figcaption></figure><p id="e2f3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">基本的Allure报告只提供了你的测试结果的饼状图，如果你使用过小黄瓜，你会在行为标签中看到你的特征。</p><p id="b2b5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您使用<a class="ae mh" href="https://docs.qameta.io/allure/#_features_2" rel="noopener ugc nofollow" target="_blank"> Allure annotation API </a>注释您的测试，您将从Allure获得主要价值。</p><p id="6d3c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe la lb lc ld b">jest-allure</code>将一个<code class="fe la lb lc ld b">reporter</code>对象添加到测试运行程序可用的全局变量中，它具有以下属性:</p><ul class=""><li id="9da6" class="nj nk iq ke b kf kg kj kk kn nl kr nm kv nn kz no np nq nr bi translated"><strong class="ke ir">严重性</strong> —设置被测试代码的严重性</li><li id="d9b9" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir"> Epic </strong> —设置与测试相关的Epic(在行为选项卡中使用)</li><li id="a801" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">特性</strong> —设置与测试相关的特性(用于行为选项卡)</li><li id="98b2" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">故事</strong> —设置与测试相关的故事(在行为选项卡中使用)</li><li id="6d7c" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">开始步骤</strong>——用于指示执行测试场景时采取的步骤</li><li id="af73" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">结束步骤</strong> —用于表示该步骤的结束</li><li id="93be" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">添加参数</strong>—从外观上看与<code class="fe la lb lc ld b">startStep</code>相同</li><li id="dfa6" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">添加环境</strong> —通过<code class="fe la lb lc ld b">addParameter</code>将环境信息添加到报告中</li><li id="a116" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">添加附件</strong> —向测试运行添加附件</li><li id="2ba4" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir">添加标签</strong> —向测试运行添加标签</li><li id="40f8" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated"><strong class="ke ir"> addParameter </strong> —将传递给被测代码的参数添加到测试运行中</li></ul><p id="1a60" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Allure支持更多的注释，但是由于<code class="fe la lb lc ld b">Severity</code>、<code class="fe la lb lc ld b">Epic</code>、<code class="fe la lb lc ld b">Feature</code>和<code class="fe la lb lc ld b">Story</code>都调用<code class="fe la lb lc ld b">addLabel</code>，你可以为这些注释添加自己的标签。</p><p id="7656" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可以在Allure网站上找到Allure支持的所有功能的分类。</p><h1 id="d135" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用报告</h1><p id="a4a8" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz ij bi translated">一旦您在报告上做好了注释，并且生成了报告，最后一步就是与团队分享它。</p><p id="2380" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有许多与各种CI工具的集成，例如Jenkins，它允许将<code class="fe la lb lc ld b">allure-results</code>文件与后续测试运行中生成的其他文件聚合在一起，但是如果您只是有一种将这些文件上传到文件服务器的方法，则不需要这些集成。</p><p id="a32a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦你有了这些文件，你就可以通过一个独立的Allure服务或者只是通过下载文件并在本地运行<code class="fe la lb lc ld b">allure generate</code>来生成报告。</p><p id="5ade" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是，我建议，如果您打算采用这种方法，那么使用Allure注释向报告添加元数据是值得的，例如:</p><ul class=""><li id="6aae" class="nj nk iq ke b kf kg kj kk kn nl kr nm kv nn kz no np nq nr bi translated">测试运行的环境(CI、本地等)</li><li id="48bb" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated">运行ID(如果在CI中运行，以便您可以追溯到特定的运行)</li><li id="ae83" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated">如果您正在运行系统测试，那么记录运行的服务器是一个好主意</li><li id="f0e5" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated">如果您在所有分支上运行测试，那么添加哪个分支是值得的，这样您就可以只在一个特定的分支上进行过滤</li><li id="ab1d" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated">如果您使用问题跟踪器或用户案例，那么值得添加这些资源的链接，以便您在解释结果时可以轻松访问其他信息</li></ul><p id="e250" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虽然所有这些报告功能都很棒，但最重要的是要考虑它将为团队提供什么价值。</p><p id="1c27" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">值得与团队成员交谈，看看他们是否有任何报告需求(例如发现不可靠的测试、报告回归等)，并确保在添加所有只有您想添加的功能之前满足这些需求。</p><p id="f671" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您还可以利用问题跟踪器的API将Allure报告信息添加到带有报告链接的页面中(带有一些过滤)，这样用户就可以点击测试这些实体中的信息，这样您就有了某种形式的基本双向可追溯性。</p></div></div>    
</body>
</html>