<html>
<head>
<title>Managing React Native Form State with Redux-Form</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Redux-Form管理React本机表单状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/managing-react-native-form-state-with-redux-form-d5a63c0a5679?source=collection_archive---------4-----------------------#2020-01-09">https://javascript.plainenglish.io/managing-react-native-form-state-with-redux-form-d5a63c0a5679?source=collection_archive---------4-----------------------#2020-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cdf429aceae7793f028003448f239f18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0oASgikuzcdRh0a4.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by Kelly Sikkema on Unsplash</figcaption></figure><p id="b1f0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在开发移动应用程序时，您可能不得不实现某种形式。这可能是一个简单的登录表单，也可能是一个复杂的报告系统，然而，您将面临一些挑战。你如何验证数据？表单状态存储在哪里？如何控制表单的生命周期？这些问题和许多其他问题的答案在下面等着，我会告诉你如何将<a class="ae la" href="https://redux-form.com/8.2.2/" rel="noopener ugc nofollow" target="_blank"> Redux Form </a>与React Native一起使用。</p><h1 id="dd58" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为什么一开始要用Redux？</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/5e8d1cf3cf78b6920f0b70dea2eff484.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/0*Qra9jO9motI114uj.png"/></div></figure><p id="b590" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Redux是一个全局状态管理的解决方案。你可以用它来存储任何时候定义你的应用的所有东西。但是为什么要用Redux来形成状态管理呢？</p><p id="4269" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将状态存储在Redux而不是React状态有很多原因(比如<code class="fe me mf mg mh b">useState</code> hook)。其中一些是:</p><ol class=""><li id="3fad" class="mi mj iq ke b kf kg kj kk kn mk kr ml kv mm kz mn mo mp mq bi translated">您需要在应用程序的其他地方访问这些数据。</li><li id="6e64" class="mi mj iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">您有多个相互同步的表单</li><li id="2e95" class="mi mj iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">表单中的数据必须比组件存在的时间长</li></ol><p id="457d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">相反，在某些情况下，Redux对于一个表单来说是多余的:</p><ol class=""><li id="fb73" class="mi mj iq ke b kf kg kj kk kn mk kr ml kv mm kz mn mo mp mq bi translated">这是一次性的表格。卸载组件后，您将不再需要这些数据。</li><li id="322a" class="mi mj iq ke b kf mr kj ms kn mt kr mu kv mv kz mn mo mp mq bi translated">应用程序中的任何其他地方都不需要该表单中的数据。</li></ol><p id="db1d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我将教你在React Native中用Redux表单管理表单状态的方法。</p><h1 id="8123" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建沙盒应用程序</h1><p id="65c0" class="pw-post-body-paragraph kc kd iq ke b kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv na kx ky kz ij bi translated">首先，您需要创建一个简单的应用程序来学习如何使用<code class="fe me mf mg mh b">redux-form</code>库。为了简单起见，我们将使用Expo SDK来设置一切:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7d280255a223ec51453ca6b1c18cca78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*tClIvAX_5iRwtZtj"/></div></figure><p id="d017" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当询问应用类型时，选择<em class="nc">空白</em>并为您的应用命名。现在您需要添加依赖项:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4c78d4e485de600009ead4626657a8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*w-Nc72sxusEyDHs8"/></div></figure><p id="472d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe me mf mg mh b">redux</code>是状态管理库本身，<code class="fe me mf mg mh b">react-redux</code>有绑定在react中使用<code class="fe me mf mg mh b">redux</code>，<code class="fe me mf mg mh b">redux-form</code>提供了一个reducer和一个HOC(高阶组件)来处理表单状态。如果你现在启动应用程序，你应该会看到Expo提供的默认屏幕:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/15f54d7264a4d188cebdcd5138fd7b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*ukvavaldKTyZ1M_j"/></div></figure><p id="e11c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在你已经准备好使用Redux表单进行黑客攻击了。</p><h1 id="6c77" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置Redux和Redux表单</h1><p id="5c27" class="pw-post-body-paragraph kc kd iq ke b kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv na kx ky kz ij bi translated">为了让Redux Form处理表单状态，您首先需要一个Redux存储。在项目根目录下创建一个文件<code class="fe me mf mg mh b">store.js</code>,并将以下代码放入其中:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d41c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了简单起见，我省略了您可能使用或可能不使用的任何额外的减速器。可以看到<code class="fe me mf mg mh b">formReducer</code>是从<code class="fe me mf mg mh b">redux-form</code>导入的，用form键包含在<code class="fe me mf mg mh b">rootReducer</code>中。关键很重要，应该一直是<code class="fe me mf mg mh b">form</code>。现在让我们创建一个<code class="fe me mf mg mh b">Form</code>组件！将该代码放入<code class="fe me mf mg mh b">Form.js</code>:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9a3c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个非常简单的表单，要求输入电子邮件和密码，并做了一些小的修改。它现在应该是这样的:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/c9064742ff72a2801496e6ca5dfed679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/0*TwdbRfpHnmDpWJRm"/></div></figure><p id="1c98" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要将它与Redux表单连接起来，您需要做两件事:连接<code class="fe me mf mg mh b">TextInput</code>和处理表单提交。编辑<code class="fe me mf mg mh b">Form.js</code>这样:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ad1b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因为<code class="fe me mf mg mh b"> redux-form</code>提供了一个<code class="fe me mf mg mh b">onChange</code>回调而<code class="fe me mf mg mh b">TextInput</code>期望一个<code class="fe me mf mg mh b">onChangeText</code>，所以你必须提供一个助手方法来将一个回调函数转换成另一个回调函数(第12行)。我们还从props中提取了一个<code class="fe me mf mg mh b">handleSubmit</code>函数，它是由第47行上使用的<code class="fe me mf mg mh b">reduxForm</code> HOC(高阶组件)提供的。出于调试的目的，我们只是记录表单值，但是可以随意使用它做一些更复杂的逻辑。</p><p id="5a6e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是，如果您现在尝试启动它，您会得到:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3f57a28da8c43316a43eec0a8f6b887b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/0*ltUXuckh0Ykdrf-4"/></div></figure><p id="5b5c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是因为我们从未将我们的商店从<code class="fe me mf mg mh b"> store.js</code>连接到应用程序本身。你可以像这样编辑<code class="fe me mf mg mh b">App.js</code>来修复它:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a0b5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">全部完成！现在，如果您按提交按钮，您将看到您的值记录到控制台:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/ed78f6c957caa348cd5e8b47dec1ed15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zodn0d_IX1r4BwIK.png"/></div></div></figure><h1 id="d7eb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">额外收获:查看表单状态</h1><p id="6ba7" class="pw-post-body-paragraph kc kd iq ke b kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv na kx ky kz ij bi translated">取回表单数据很好，但是Redux Form提供了更多的功能，但是我现在不打算详细介绍。相反，我将向您展示来自Redux的原始表单状态，您可以弄清楚您想用它做什么。为此，在<code class="fe me mf mg mh b">StateViewer.js</code>中创建一个新的<code class="fe me mf mg mh b">StateViewer</code>组件，并将以下代码放入其中:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="7249" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe me mf mg mh b">StateViewer</code>组件获取整个Redux表单状态，将其序列化为漂亮的JSON并输出到屏幕上。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/6ba365d47bba5e057008fa0c8458501d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/0*6wqRLsXUAa8rysQN"/></div></figure><p id="c322" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请注意州中所有不同的字段。您不仅可以获得任意时间点的字段值，还可以查看它们是否被<em class="nc">访问过</em>或<em class="nc">触摸过</em>以及提交是否成功。很漂亮，你不觉得吗？</p><p id="8015" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇短文中，我试图向您展示React Native中Redux表单的强大功能以及如何在您的项目中使用它，请让我知道它对您或您所知道的任何其他表单状态解决方案有何帮助！</p></div></div>    
</body>
</html>