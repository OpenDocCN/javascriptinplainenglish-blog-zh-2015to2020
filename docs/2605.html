<html>
<head>
<title>JavaScript Tips — Download Files, Performance Test, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript技巧—下载文件、性能测试等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-tips-download-files-performance-test-and-more-4ceaad3f383a?source=collection_archive---------5-----------------------#2020-07-08">https://javascript.plainenglish.io/javascript-tips-download-files-performance-test-and-more-4ceaad3f383a?source=collection_archive---------5-----------------------#2020-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f16339e89df5942515f9412fe9bdc96f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3wVz78M7bIJ3qBEI"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@kp89_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kirill Petropavlov</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6aa3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写JavaScript应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些常见JavaScript问题的解决方案。</p><h1 id="17f7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Javascript下载文件</h1><p id="8e12" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用JavaScript下载一个文件。</p><p id="8c13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以使用Fetch API。</p><p id="df00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以这样称呼它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="45c6" class="mn lc iq mj b gy mo mp l mq mr">fetch('https://www.w3.org/TR/PNG/iso_8859-1.txt')<br/>  .then(resp =&gt; resp.blob())<br/>  .then(blob =&gt; {<br/>    const url = window.URL.createObjectURL(blob);<br/>    const a = document.createElement('a');<br/>    a.style.display = 'none';<br/>    a.href = url;<br/>    a.download = 'sample.txt';<br/>    document.body.appendChild(a);<br/>    a.click();<br/>    window.URL.revokeObjectURL(url);<br/>  })<br/>  .catch(() =&gt; alert('oh no!'));</span></pre><p id="2e88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe ms mt mu mj b">fetch</code>对文件发出GET请求。</p><p id="39ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe ms mt mu mj b">blob</code>把它变成二进制对象。</p><p id="a846" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们调用<code class="fe ms mt mu mj b">createObjectURL</code>从blob创建一个URL。</p><p id="66eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建一个<code class="fe ms mt mu mj b">a</code>元素，用对象URL作为<code class="fe ms mt mu mj b">a</code>元素的URL来创建一个不可见的链接。</p><p id="b050" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以调用<code class="fe ms mt mu mj b">click</code>来下载文件。</p><p id="a06b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们调用<code class="fe ms mt mu mj b">revokeObjectURL</code>来清理数据URL。</p><h1 id="8d59" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从变量值创建对象特性</h1><p id="2be3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过在括号之间传递变量来创建一个对象。</p><p id="0069" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d28d" class="mn lc iq mj b gy mo mp l mq mr">obj[a] = 'foo';</span></pre><p id="c0f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe ms mt mu mj b">a</code>的值设置为属性的标识符。</p><p id="1d33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">a</code>可以是字符串或符号。</p><p id="2326" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以在对象文字中使用相同的符号。</p><p id="2594" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3122" class="mn lc iq mj b gy mo mp l mq mr">const obj = { [a]: b };</span></pre><p id="a272" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在对象文字的括号中传递变量<code class="fe ms mt mu mj b">a</code>。</p><h1 id="fe07" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">JavaScript Hashmap等价物</h1><p id="8bea" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">map是一个相当于hashmap的JavaScript。</p><p id="1eb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用它，我们创建了一个<code class="fe ms mt mu mj b">Map</code>实例:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e5a6" class="mn lc iq mj b gy mo mp l mq mr">const map = new Map();<br/>map.set('foo', 'bar');<br/>map.set('baz', 1);</span></pre><p id="3736" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了一个<code class="fe ms mt mu mj b">Map</code>实例并调用<code class="fe ms mt mu mj b">set</code>方法来添加或更新条目。</p><p id="76df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以使用<code class="fe ms mt mu mj b">size</code>属性来获取地图的大小。</p><h1 id="68bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从字符串中提取一个数</h1><p id="3a63" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了从一个字符串中提取一个数字，我们可以使用<code class="fe ms mt mu mj b">match</code>字母来查找匹配给定模式的所有子字符串。</p><p id="ed61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="86ac" class="mn lc iq mj b gy mo mp l mq mr">const txt = "123 foo 456";<br/>const nums = txt.match(/(\d+)/g);</span></pre><p id="90b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将匹配所有连续的数字。</p><p id="d94c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">g</code>表示我们在整个字符串中搜索这个模式。</p><p id="0eec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">\d</code>是一个数字。</p><p id="b75f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe ms mt mu mj b">nums</code>就是<code class="fe ms mt mu mj b">[“123”, “456”]</code>。</p><h1 id="d2f8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查数组是空的还是存在的</h1><p id="b4dc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过使用<code class="fe ms mt mu mj b">Array.isArray</code>方法和<code class="fe ms mt mu mj b">length</code>属性来检查数组是空的还是存在的。</p><p id="f4a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7823" class="mn lc iq mj b gy mo mp l mq mr">if (Array.isArray(array) &amp;&amp; array.length) {<br/>  // ...<br/>}</span></pre><p id="3ae5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检查<code class="fe ms mt mu mj b">array</code>是否是一个有<code class="fe ms mt mu mj b">Array.isArray</code>的数组。</p><p id="7686" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们使用<code class="fe ms mt mu mj b">length</code>属性来获取数组的长度。</p><p id="e9c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不必明确地检查长度，因为0是假的，所有其他数字都是真的。</p><p id="fb20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以<code class="fe ms mt mu mj b">array.length</code>会检查长度是否非零。</p><h1 id="bdf0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">深度合并对象，而不是进行浅层合并</h1><p id="3e46" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Lodash的<code class="fe ms mt mu mj b">merge</code>方法深度合并对象。</p><p id="c0c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f77d" class="mn lc iq mj b gy mo mp l mq mr">_.merge(obj1, obj2, obj3);</span></pre><p id="8f8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它合并任意多的对象。</p><p id="c23a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回的对象不会有引用现有对象的属性。</p><h1 id="67f2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用Javascript创建一个样式标签</h1><p id="81cd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">通过使用<code class="fe ms mt mu mj b">createElement</code>创建一个样式元素，我们可以用JavaScriot创建一个样式标签。</p><p id="2029" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a85e" class="mn lc iq mj b gy mo mp l mq mr">const css = 'h1 { background: red; }';<br/>const head = document.head;<br/>const style = document.createElement('style');<br/>style.appendChild(document.createTextNode(css));<br/>head.appendChild(style);</span></pre><p id="2849" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在一个字符串中创建了一些CSS样式。</p><p id="1844" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe ms mt mu mj b">document.head</code>得到头部元素。</p><p id="4be7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们创建了一个样式元素。</p><p id="5f09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们把CSS放到样式元素中。</p><p id="f5cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们将样式元素添加到head元素中。</p><h1 id="2196" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试JavaScript代码的性能</h1><p id="aab9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了测试JavaScript代码的性能，我们可以使用<code class="fe ms mt mu mj b">console.time</code>和<code class="fe ms mt mu mj b">console.timeEnd</code>方法。</p><p id="aaa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="893c" class="mn lc iq mj b gy mo mp l mq mr">console.time('test');<br/>for(let i = 0; i &lt; 1000000; i++){<br/>  //...<br/>};<br/>console.timeEnd('test')</span></pre><p id="d965" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用一个字符串标识符调用<code class="fe ms mt mu mj b">console.time</code>来启动性能测试计时器。</p><p id="8409" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用相同的标识符调用<code class="fe ms mt mu mj b">console.timeEnd</code>来结束计时器。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/74f717a1e0b1ebbbb1992ab5a14223a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SPx-bZv8GXBPHDlU"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@___rob__?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Robert Metz</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c1cb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ffe5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript <code class="fe ms mt mu mj b">console</code>对象有让我们测量代码时间的方法。</p><p id="8b2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用Fetch API下载文件。</p><p id="662c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Map</code>是JavaScript的hashmap。</p><p id="43f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Lodash <code class="fe ms mt mu mj b">merge</code>让我们深度合并对象。</p><p id="dbde" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以给对象添加动态属性。</p><h2 id="e3d7" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">简单英语的JavaScript</h2><p id="169c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>