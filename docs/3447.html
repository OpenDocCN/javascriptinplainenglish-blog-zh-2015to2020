<html>
<head>
<title>Multi-User Login Support like Google’s Gmail 🎭</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像谷歌的Gmail一样的多用户登录支持🎭</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-implement-multi-user-login-support-like-googles-gmail-f17f2f207c84?source=collection_archive---------5-----------------------#2020-09-29">https://javascript.plainenglish.io/how-to-implement-multi-user-login-support-like-googles-gmail-f17f2f207c84?source=collection_archive---------5-----------------------#2020-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ebd578697e39a27f99a1a5a27766a758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lQVJ7AanBGsRMoBn"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@hostreviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Stephen Phillips - Hostreviews.co.uk</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="29a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个故事中，我将分享我的经验<strong class="kf ir">如何实现多用户登录/登录支持</strong>，我还创建了一个演示，演示和源代码链接在故事的结尾提到。</p><p id="2a7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在做一个需要实现多用户登录支持的项目，最初，我很困惑，因为我不知道如何实现像“多用户登录”这样的功能。</p><p id="9547" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在做了一些研究后，我发现Gmail具有我正在寻找的类似功能，然后我决定玩Gmail，当我玩时，我注意到我的每个登录帐户的地址栏都发生了变化，每当我在帐户之间切换时，URL中只有一个参数发生了变化，这很可能是一个索引，但不确定，因为我不是谷歌的开发人员😁</p><p id="853d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想体验，请遵循以下说明。<br/>你必须有多个Gmail账户，试着同时登录，你可以点击<strong class="kf ir">添加另一个账户</strong>按钮，我相信下面的附件能帮助你找到添加另一个账户的选项。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/768a81a5ffc7211dd5ff823f46ac81b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aOHbMjN0s1-48ewDKTC9Wg.png"/></div></div></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><p id="2e6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你用多个帐户登录，试着在帐户之间切换，注意地址栏中的URL，你的地址栏可能看起来像这样。</p><blockquote class="ln"><p id="498a" class="lo lp iq bd lq lr ls lt lu lv lw la dk translated">https://mail.google.com/mail/u/0/#inbox<br/>https://mail.google.com/mail/u/1/#inbox<br/>https://mail.google.com/mail/u/2/#inbox<br/>https://mail.google.com/mail/u/3/#inbox</p></blockquote><p id="27ed" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw mb ky kz la ij bi translated">如果你和我一样注意到了，除了我称之为索引的值之外，所有的值都是相同的，为了进一步验证这一点，你可以手动将索引号从0更改为1，然后点击enter或重新加载页面，肯定是加载了第二个帐户的数据的Gmail。</p><p id="60e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">进一步挖掘Gmail，我发现它在API中添加了带有当前索引值的<strong class="kf ir"> authuser </strong>参数，该值可能来自URL，但同样不确定。</p><p id="406b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不知道到底发生了什么，但至少我知道如何在我的应用程序中实现多用户登录支持。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/996037a7071b87f742ff69a179b72e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VRe08gPmxOyFZYJT"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@boab?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mark Fletcher-Brown</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b5f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以在我的例子中，我遵循传统的认证机制，即:使用用户凭证点击登录API，返回一个JWT令牌，然后在每个请求的头中添加JWT令牌。</p><p id="c7bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯，我的想法非常简单，只是将JWT令牌保存到一个数组中，并创建类似Gmail的路由，这样我就可以在整个应用程序中访问活动索引，使用这种技术，我可以很容易地确定我需要在请求的头中添加哪个JWT令牌，而且backed会根据从前端添加的令牌进行操作。</p><p id="fdcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用上述方法，我们的地址栏看起来类似于Gmail，例如<br/>。</p><blockquote class="ln"><p id="6685" class="lo lp iq bd lq lr ls lt lu lv lw la dk translated">https://your-domain.com/0/dashboard<br/>https://your-domain.com/1/dashboard<br/>https://your-domain.com/2/dashboard<br/>https://your-domain.com/3/dashboard</p></blockquote><p id="c1ca" class="pw-post-body-paragraph kd ke iq kf b kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw mb ky kz la ij bi translated">所以，我终于找到了如何在前端管理多用户登录支持的方法，现在我对<strong class="kf ir">该做什么，以及如何做……</strong>有了更高层次的理解</p><p id="c027" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们开始编码，⌨ ️and举个例子。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/163a0955f049e30328bd288f57a12f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*v_aO-_Rc8O-aV3Rtbb1htw.jpeg"/></div></figure><p id="39c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用React和Firebase来构建这个例子，因为我擅长React，而且使用Firebase进行认证非常简单，你可以使用任何你喜欢的技术栈。</p><h2 id="a25d" class="me mf iq bd mg mh mi dn mj mk ml dp mm ko mn mo mp ks mq mr ms kw mt mu mv mw bi translated">路线</h2><pre class="lc ld le lf gt mx my mz na aw nb bi"><span id="561f" class="me mf iq my b gy nc nd l ne nf"><strong class="my ir">// App.js</strong></span><span id="cf8d" class="me mf iq my b gy ng nd l ne nf"><strong class="my ir">function </strong><em class="nh">App</em>() {<br/>  <strong class="my ir">return </strong>(<br/>   &lt;<strong class="my ir">Router</strong>&gt;<br/>     &lt;<strong class="my ir">Switch</strong>&gt;<br/>       &lt;<strong class="my ir">Route exact path="/"</strong>&gt;<br/>         &lt;<strong class="my ir">Login </strong>/&gt;<br/>       &lt;/<strong class="my ir">Route</strong>&gt;<br/>       &lt;<strong class="my ir">Route path="/:index/dashboard"</strong>&gt;<br/>         &lt;<strong class="my ir">Dashboard </strong>/&gt;<br/>       &lt;/<strong class="my ir">Route</strong>&gt;<br/>     &lt;/<strong class="my ir">Switch</strong>&gt;<br/>   &lt;/<strong class="my ir">Router</strong>&gt;<br/>  );<br/>}</span><span id="6dfc" class="me mf iq my b gy ng nd l ne nf"><strong class="my ir">export default </strong><em class="nh">App</em>;</span></pre><h2 id="d63b" class="me mf iq bd mg mh mi dn mj mk ml dp mm ko mn mo mp ks mq mr ms kw mt mu mv mw bi translated">注册</h2><pre class="lc ld le lf gt mx my mz na aw nb bi"><span id="78ea" class="me mf iq my b gy nc nd l ne nf"><strong class="my ir">function </strong>Login() {<br/> <strong class="my ir">let </strong>history = <em class="nh">useHistory</em>();<br/><br/> <strong class="my ir">function </strong>handleLogin() {<br/>  <strong class="my ir">firebase</strong>.<em class="nh">auth</em>().signInWithPopup(provider).then(<strong class="my ir">function</strong>(result) {<br/>   <strong class="my ir">const </strong>{<br/>    <strong class="my ir">credential</strong>: { accessToken },<br/>    <strong class="my ir">additionalUserInfo</strong>: { isNewUser, profile },<br/>    <strong class="my ir">user</strong>: { phoneNumber }<br/>   } = result;<br/>   <strong class="my ir">const </strong>id = profile.<strong class="my ir">id</strong>;<br/>   profile.<strong class="my ir">phone_number </strong>= phoneNumber;<br/>   <strong class="my ir">if</strong>(isNewUser) <em class="nh">addUser</em>(profile);<br/><br/>   <strong class="my ir">const </strong>tokens = <em class="nh">getFromStorage</em>(<strong class="my ir">'tokens'</strong>) || [];<br/>   <strong class="my ir">const </strong>users = <em class="nh">getFromStorage</em>(<strong class="my ir">'users'</strong>) || [];<br/>   profile.<strong class="my ir">access_token </strong>= accessToken;<br/>   <strong class="my ir">const </strong>index = users.findIndex(user =&gt; user.<strong class="my ir">id </strong>=== id);<br/>   <strong class="my ir">if</strong>(index === -1) {<br/>    tokens.push(accessToken);<br/>    users.push(profile);<br/>    <em class="nh">setInStorage</em>(<strong class="my ir">'tokens'</strong>, tokens);<br/>    <em class="nh">setInStorage</em>(<strong class="my ir">'users'</strong>, users);<br/>    history.push(<strong class="my ir">`/</strong>${tokens.<strong class="my ir">length </strong>- 1}<strong class="my ir">/dashboard`</strong>);<br/>   } <strong class="my ir">else </strong>{<br/>    history.push(<strong class="my ir">`/</strong>${index}<strong class="my ir">/dashboard`</strong>);<br/>   }<br/>  }).catch(<strong class="my ir">function</strong>(error) {<br/>   <strong class="my ir"><em class="nh">console</em></strong>.log(<strong class="my ir">'error'</strong>, error);<br/>  });<br/> }<br/><br/> <strong class="my ir">return </strong>(<br/>  &lt;<strong class="my ir">div className="login"</strong>&gt;<br/>   &lt;<strong class="my ir">button className="google-button" onClick=</strong>{handleLogin}&gt;<br/>     &lt;<strong class="my ir">span className="google-button__icon"</strong>&gt;<br/>       Google login icon<br/>     &lt;/<strong class="my ir">span</strong>&gt;<br/>    &lt;<strong class="my ir">span className="google-button__text"</strong>&gt;Sign in with Google&lt;/<strong class="my ir">span</strong>&gt;<br/>   &lt;/<strong class="my ir">button</strong>&gt;<br/><br/>  &lt;/<strong class="my ir">div</strong>&gt;<br/> );<br/>}<br/><br/><strong class="my ir">export default </strong><em class="nh">memo</em>(Login);</span></pre><h2 id="2d03" class="me mf iq bd mg mh mi dn mj mk ml dp mm ko mn mo mp ks mq mr ms kw mt mu mv mw bi translated">仪表盘</h2><pre class="lc ld le lf gt mx my mz na aw nb bi"><span id="6c18" class="me mf iq my b gy nc nd l ne nf"><strong class="my ir">function </strong>Dashboard() {<br/> <strong class="my ir">const </strong>tokens = <em class="nh">getFromStorage</em>(<strong class="my ir">'tokens'</strong>);<br/> <strong class="my ir">const </strong>history = <em class="nh">useHistory</em>();<br/> <strong class="my ir">const </strong>params = <em class="nh">useParams</em>();<br/> <strong class="my ir">const </strong>users = <em class="nh">getAllUsers</em>();<br/> <strong class="my ir">const </strong>currentUser = <em class="nh">getCurrentUser</em>(tokens[params.<strong class="my ir">index</strong>]) || {};<br/><br/> <strong class="my ir">function </strong>signOut() {<br/>  <em class="nh">setInStorage</em>(<strong class="my ir">'users'</strong>, []);<br/>  <em class="nh">setInStorage</em>(<strong class="my ir">'tokens'</strong>, []);<br/>  history.push(<strong class="my ir">'/'</strong>);<br/> }<br/> <strong class="my ir">function </strong>loggedInUsers() {<br/>  <strong class="my ir">return </strong>users.map((user, i) =&gt; {<br/>   <strong class="my ir">const </strong>isActive = params.<strong class="my ir">index </strong>== i;<br/>   <strong class="my ir">return </strong>(<br/>    &lt;<strong class="my ir">li className=</strong>{isActive ? <strong class="my ir">'active' </strong>: <strong class="my ir">''</strong>} <strong class="my ir">key=</strong>{user.<strong class="my ir">id</strong>}&gt;<br/>     &lt;<strong class="my ir">Link to=</strong>{<strong class="my ir">`/</strong>${i}<strong class="my ir">/dashboard`</strong>} <strong class="my ir">target=</strong>{isActive ? <strong class="my ir">'' </strong>: <strong class="my ir">'_blank'</strong>}&gt;<br/>      &lt;<strong class="my ir">p</strong>&gt;{user.<strong class="my ir">name</strong>}&lt;/<strong class="my ir">p</strong>&gt;<br/>      &lt;<strong class="my ir">small</strong>&gt;{user.<strong class="my ir">email</strong>}&lt;/<strong class="my ir">small</strong>&gt;<br/>     &lt;/<strong class="my ir">Link</strong>&gt;<br/>    &lt;/<strong class="my ir">li</strong>&gt;<br/>   )<br/>  })<br/> }<br/><br/> <strong class="my ir">return </strong>(<br/>  &lt;<strong class="my ir">Fragment</strong>&gt;<br/>   {!tokens.<strong class="my ir">length </strong>&amp;&amp; &lt;<strong class="my ir">Redirect to="/" </strong>/&gt;}<br/>   {<br/>    tokens.<strong class="my ir">length </strong>&amp;&amp;<br/>    !tokens[params.<strong class="my ir">index</strong>] &amp;&amp; &lt;<strong class="my ir">Redirect to="/0/dashboard" </strong>/&gt;<br/>   }<br/>   &lt;<strong class="my ir">div className="account-list"</strong>&gt;<br/>    &lt;<strong class="my ir">ul</strong>&gt;<br/>     {loggedInUsers()}<br/>     &lt;<strong class="my ir">Link className="add-account" to="/"</strong>&gt;Add another account&lt;/<strong class="my ir">Link</strong>&gt;<br/>     &lt;<strong class="my ir">button onClick=</strong>{signOut}&gt;Sign out of all accounts&lt;/<strong class="my ir">button</strong>&gt;<br/>    &lt;/<strong class="my ir">ul</strong>&gt;<br/>   &lt;/<strong class="my ir">div</strong>&gt;<br/>   &lt;<strong class="my ir">div className="account-details"</strong>&gt;<br/>    &lt;<strong class="my ir">div className="card"</strong>&gt;<br/>     &lt;<strong class="my ir">img className="avatar" src=</strong>{currentUser.<strong class="my ir">picture</strong>} <strong class="my ir">alt=""</strong>/&gt;<br/>     &lt;<strong class="my ir">h3</strong>&gt;{currentUser.<strong class="my ir">name</strong>}&lt;/<strong class="my ir">h3</strong>&gt;<br/>     &lt;<strong class="my ir">p</strong>&gt;{currentUser.<strong class="my ir">email</strong>}&lt;/<strong class="my ir">p</strong>&gt;<br/>    &lt;/<strong class="my ir">div</strong>&gt;<br/>   &lt;/<strong class="my ir">div</strong>&gt;<br/>  &lt;/<strong class="my ir">Fragment</strong>&gt;<br/> );<br/>}<br/><br/><strong class="my ir">export default </strong><em class="nh">memo</em>(Dashboard);</span></pre><p id="7cb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有很多其他文件，你可以在<a class="ae kc" href="https://github.com/umair-khanzada/multi-user-login-app" rel="noopener ugc nofollow" target="_blank">回购</a>中找到。</p><p id="7153" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">示例应用程序如下所示。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/2404b4f8284ab3f9ccc0c4320c3c2f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iuvsSH9-861RSVf5lTwqGQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Login Screen</figcaption></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/d754d194ec63312b7fb702dc7dd074ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gx1FnJl0B1tfMnYc5Q49cw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Dashboard Screen</figcaption></figure><p id="0678" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恭喜你，我们成功了。</p><p id="6b1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实现多用户登录支持是一个很好的体验，但我意识到没有从特定或单一帐户注销的选项，我期待着添加这样的功能。</p><h2 id="4e2a" class="me mf iq bd mg mh mi dn mj mk ml dp mm ko mn mo mp ks mq mr ms kw mt mu mv mw bi translated">结论</h2><p id="0a3d" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">我们已经研究了Gmail的多用户登录流程，并提出了如何在我们的应用程序中实现它的想法，然后构建了一个也支持多用户登录的原型应用程序，我对原型应用程序使用了React和Firebase，但策略非常简单，您可以用任何编程语言实现它。</p><h2 id="8e9f" class="me mf iq bd mg mh mi dn mj mk ml dp mm ko mn mo mp ks mq mr ms kw mt mu mv mw bi translated">链接</h2><p id="f2ed" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">github:【https://github.com/umair-khanzada/multi-user-login-app<br/>T4】试玩App:<a class="ae kc" href="https://multi-user-login.web.app/" rel="noopener ugc nofollow" target="_blank">https://multi-user-login.web.app/</a></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/787be6c671be8d345dc786dad8729ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-sOyyG8NoRbKpCG_y4Cmw@2x.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank">Subscribe to Decoded, our official YouTube channel!</a></figcaption></figure></div></div>    
</body>
</html>