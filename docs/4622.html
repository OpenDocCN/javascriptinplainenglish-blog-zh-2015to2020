<html>
<head>
<title>From TypeScript to WebAssembly in few steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从TypeScript到WebAssembly只需几个步骤</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/from-typescript-to-webassembly-in-few-steps-c76f98f00632?source=collection_archive---------0-----------------------#2020-12-26">https://javascript.plainenglish.io/from-typescript-to-webassembly-in-few-steps-c76f98f00632?source=collection_archive---------0-----------------------#2020-12-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fa4e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在WebAssembly中构建您的第一个程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8cf041a17fe86c954f45a94d6b19015f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdH6BwBt7BX7UO8nkLyZmA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://www.pexels.com/es-es/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><p id="d9dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示如何将一个TypeScript程序编译成WebAssemby来打印一个数字的阶乘。</p><p id="8917" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将使用TypeScript编写它，然后用<a class="ae kv" href="https://www.assemblyscript.org/" rel="noopener ugc nofollow" target="_blank"> AssemblyScript </a>编译它，后者使用Binaryen将TypeScript的严格变体编译为WebAssembly(Wasm)。</p><p id="b2d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">WebAssembly是当前的MVP，只处理整数和浮点，本身不支持字符串或其他类型。出于这个原因，我将编写一个函数，它接受一个数值类型的参数并返回其对应的阶乘，而不是使用字符串的典型HelloWorld。</p><h1 id="8707" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么是Wasm？</h1><p id="ca9a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用WebAssembly最常见的原因之一是它的速度。特定上下文中的速度是必不可少的，并且可以证明牺牲其他因素(如开发人员经验、可靠性或可维护性)是合理的。所以，要小心。</p><h1 id="32b6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在TS中创建阶乘函数</h1><p id="a622" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们的factorial.ts文件导出一个factorial函数，该函数接受一个数值并返回相应的阶乘数。</p><p id="0bd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> factorial.ts文件</strong></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="bcd6" class="mu lt iq mq b gy mv mw l mx my">export function factorial(num: i32): i32 {<br/>    if (num === 0){ <br/>      return 1; <br/>    }<br/>    else {<br/>     return num * factorial( num - 1 );<br/>    }<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/3473b52bc6b6adef778a53f0bc697a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*rAmOC4fGt7tcREje46nRfw.png"/></div></figure><h1 id="fc09" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">将TypeScript阶乘函数编译为Wasm</h1><p id="ea52" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在这一步中，我将使用AssemblyScript编译器将其编译成wasm模块，它将输出相应的factorial.wasm文件。</p><p id="6f85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我将把编译器作为一个全局npm包安装，这样我就可以很容易地使用它(你需要在你的计算机上安装<a class="ae kv" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank">NPM</a>):</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="06fc" class="mu lt iq mq b gy mv mw l mx my">npm i -g assemblyscript</span></pre><p id="68dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦安装了编译器，我们就可以用命令<asc sourcefile.ts="" destinationfile.wasm="">来使用它:</asc></p><p id="b2fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> factorial.wasm </strong></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="a019" class="mu lt iq mq b gy mv mw l mx my">asc factorial.ts -b factorial.wasm</span></pre><h1 id="c54b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">整合所有</h1><p id="d8eb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接下来，我将创建一个factorial.js <strong class="ky ir"> JavaScript </strong>文件，并添加一个使用WebAssembly Web APIs加载Wasm模块的函数:</p><p id="e2d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> factorial.js </strong></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="28cb" class="mu lt iq mq b gy mv mw l mx my">export const wasmInstantiate <br/>= async (wasmModuleUrl, importObject) =&gt; {<br/>  let response = undefined;</span><span id="83e3" class="mu lt iq mq b gy na mw l mx my">  if (!importObject) {<br/>    importObject = {<br/>      env: {<br/>        abort: () =&gt; console.log("Error!")<br/>      }<br/>    };<br/>  }</span><span id="e981" class="mu lt iq mq b gy na mw l mx my"> const instantiateModule = async () =&gt; {<br/>    //1.<br/>    const response = await fetch("./factorial.wasm");<br/>    const buffer = await response.arrayBuffer();<br/>    //2.  <br/>    const obj = await WebAssembly.instantiate(buffer, importObject);<br/>    return obj;<br/>  };</span><span id="6254" class="mu lt iq mq b gy na mw l mx my">  response = await instantiateModule();</span><span id="953c" class="mu lt iq mq b gy na mw l mx my">  //3.<br/>  return response;<br/>};</span><span id="3f46" class="mu lt iq mq b gy na mw l mx my">//...</span></pre><ol class=""><li id="d228" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">我将使用Fetch方法下载模块。</li><li id="93c2" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">这里，我们实例化Wasm模块。</li><li id="674d" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">退回Wasm模块。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/15302036fd25268da7c6e52b0c879aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJWoS6N0g7uw4l0qpAmGDQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">factorial.js part 1 file.</figcaption></figure><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d3f5" class="mu lt iq mq b gy mv mw l mx my">//...</span><span id="6b5b" class="mu lt iq mq b gy na mw l mx my">const executeWasmFactorial = async () =&gt; {<br/>//1.<br/>const wasmModule<br/>     = await wasmInstantiate("./factorial.wasm");</span><span id="76c9" class="mu lt iq mq b gy na mw l mx my">//2. <br/>const factorialResult <br/>     = wasmModule.instance.exports.factorial(7);</span><span id="6039" class="mu lt iq mq b gy na mw l mx my">//3.<br/>document.getElementById("factorialResultId").innerHTML  <br/>      = `The result is: &lt;strong&gt;${factorialResult}&lt;/strong&gt;`;<br/>};</span><span id="3991" class="mu lt iq mq b gy na mw l mx my">executeWasmFactorial();</span></pre><ol class=""><li id="243e" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">实例化wasm模块。</li><li id="15a1" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">从Wasm调用我们的阶乘函数export。</li><li id="063a" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">将结果设置为我们的HTML“factorial resultid”元素。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ac52caa7568cd5940539f4cfe762bd44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*uHXu8OZycw2LPQBLYXfFQw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">factorial.js part 2 file.</figcaption></figure><p id="b9c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">加入所有:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/65db0605323285450fbd2664c2880771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcCGRYTdlAemb4JfeQ3SXQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">factoria.js complete file</figcaption></figure><p id="74a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">Index.html</strong></p><p id="03ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我必须将factorial.js文件作为ES6模块加载到我们的index.html中:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="c602" class="mu lt iq mq b gy mv mw l mx my">&lt;!DOCTYPE html&gt;</span><span id="fb8e" class="mu lt iq mq b gy na mw l mx my">&lt;html&gt;<br/>  <br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;title&gt;Factorial - AssemblyScript&lt;/title&gt;<br/>    &lt;script type="module" src="./factorial.js"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;</span><span id="fb9b" class="mu lt iq mq b gy na mw l mx my">&lt;body&gt;<br/> &lt;div id="factorialResultId"&gt;&lt;/div&gt;<br/>&lt;/body&gt;</span><span id="fdb8" class="mu lt iq mq b gy na mw l mx my">&lt;/html&gt;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/cca04da6b949d63a86aa8de56be53a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*ZPgqIKI-FEGRz8Wq9GYIqA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">index.html file.</figcaption></figure><h1 id="12a3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最终文件夹结构</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1008cae37142f58dcbce743512f68f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*EhJ5S4ur50YuK1PxsE7G2g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">folder structure.</figcaption></figure><h1 id="5c9e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">摘要</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/1e368e6a1ed592de83c638356f82a36d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZtL5y_17La3R2DMUwpNyxg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">From TypeScript to Wasm byte code.</figcaption></figure><ol class=""><li id="e846" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">带有factorial函数的TypeScript文件计算一个数的阶乘。</li><li id="0dc3" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">从typescript文件编译为Wasm文件。</li><li id="abbb" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">Wasm模块计算一个数的阶乘。</li><li id="9bda" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">factorial.js文件加载Wasm模块，并从Wasm模块执行数字7的factorial函数。</li><li id="23f6" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">index.html文件导入factorial.js文件。</li><li id="0f7c" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">浏览器。</li></ol><h1 id="ceb8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">执行它</h1><p id="811d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了简单起见，我将使用一个零配置的命令行http服务器:</p><p id="75bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在代码的文件夹中执行<a class="ae kv" href="https://www.npmjs.com/package/http-server" rel="noopener ugc nofollow" target="_blank"> http-server </a>。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e31e" class="mu lt iq mq b gy mv mw l mx my">npm i -g http-server</span><span id="0d97" class="mu lt iq mq b gy na mw l mx my">http-server -p 82</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/a2a05579673315dd3c27299a5411c565.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*PINwRWcaiCNuLx_Q_W5UcQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The http-server running</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/6878563f4d49d82e9869c9ce01e29173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*nIJCtCxj0fLWuyFNk5Gymw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Final result.</figcaption></figure><p id="a879" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有一个Wasm字节码阶乘程序正在运行。</p><h1 id="4bef" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="cbfb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本文中，我开发了一个简单的例子，但我认为它有助于了解它的威力。</p><p id="292e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是请记住，虽然性能对于任何技术来说都是一个基本因素，但我不认为它是最重要的因素，除非在特定的环境中。</p><p id="5f84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，可以考虑通过我的<a class="ae kv" href="https://kesk.medium.com/membership" rel="noopener">个人资料</a>订阅Medium。谢谢大家！</p></div></div>    
</body>
</html>