<html>
<head>
<title>I created the same app in Svelte.js and Malina.js. Here are the differences.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我在Svelte.js和Malina.js里创建了同一个app，区别如下。</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/svelte-js-and-malina-js-b33c55253271?source=collection_archive---------0-----------------------#2020-07-05">https://javascript.plainenglish.io/svelte-js-and-malina-js-b33c55253271?source=collection_archive---------0-----------------------#2020-07-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/28335230c38babb98ffc792e5cdfd434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8u-2sP9A3HJjGy28XRgiA.png"/></div></figure><p id="e674" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我喜欢Svelte.js。既然我已经试过了，我想尝试另一种方法来检测变化/突变，当前的变化检测器是Svelte的关键之一，没有它Svelte就不是它自己。所以为了体验另一个变化检测器，我做了一个Svelte的小“姐妹”是<a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> Malina.js </a>，它不是检查变量是否变化，而是检查绑定是否变化(<em class="kq">绑定检查</em>)。下面是几个如何更好的例子。</p><p id="f07e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">为了能够看出区别，我在Svelte.js和<a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> Malina.js </a>上做了同样的todo-app(<em class="kq">Svelte使用数组的代码样式取自</em> <a class="ae kp" href="https://github.com/sveltejs/svelte-todomvc/blob/master/src/TodoMVC.svelte" rel="noopener ugc nofollow" target="_blank"> <em class="kq">官方svelte-todomvc </em> </a>)。</p><p id="a542" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">链接:<a class="ae kp" href="https://svelte.dev/repl/3db994685aba408c897b40b25de41178?version=3.23.2" rel="noopener ugc nofollow" target="_blank">苗条待办事宜</a>，<a class="ae kp" href="https://malinajs.github.io/repl/#/gist/e668fb17894a3a6993d109c9ee235003?version=0.6.36" rel="noopener ugc nofollow" target="_blank">玛丽娜待办事宜</a>。</p><p id="82f5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">让我们从函数“add”开始，在这里我们将todo项追加到数组中:</p><div class="kr ks kt ku gt ab cb"><figure class="kv jo kw kx ky kz la paragraph-image"><img src="../Images/119f0cb90ed16016d6f1bc7052da9e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*9wfvhRtTrO2KDs_Upn5tYQ.png"/></figure><figure class="kv jo kw kx ky kz la paragraph-image"><img src="../Images/363f4fa98711d66e1f3c7c3167a2c1cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*Locjg69uRR3XYUq7wQ17pg.png"/><figcaption class="lb lc gj gh gi ld le bd b be z dk lf di lg lh">Svelte on the left. <a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank">Malina</a> on the right.</figcaption></figure></div><p id="6298" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">删除项目的代码:</p><div class="kr ks kt ku gt ab cb"><figure class="kv jo kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><img src="../Images/5b8de6c37249df867be616ce90011750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*uEyEig4vswb2jS9AiQy5cw.png"/></div></figure><figure class="kv jo kw kx ky kz la paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><img src="../Images/97a090e1ac9e57dbe0d79b62756d5ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GkoMPMUPMX0RvJZCPPEEWA.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk lf di lg lh">Svelte on the left. <a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank">Malina</a> on the right.</figcaption></figure></div><p id="0fe3" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">你可以注意到<a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> Malina.js </a>的代码更加紧凑，它检测突变，所以你可以使用<a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> Malina.js </a>中的任何方法。</p><p id="5f8a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最有趣的情况是，当我们选择一个项目<code class="fe lm ln lo lp b">on:click={() =&gt; active=todo}</code>，在这之后todo-object出现在两个地方——数组<code class="fe lm ln lo lp b">todos</code>和变量<code class="fe lm ln lo lp b">active</code>,并在两个地方呈现。所以如果你变异了这个对象<code class="fe lm ln lo lp b">bind:value={active.name}</code>，Svelte不会检测到，需要手动触发更新，Svelte:</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="bec3" class="lu lv in lp b gy lw lx l ly lz">&lt;input on:keydown={enterEdit} bind:value={active.name} /&gt;</span><span id="c41c" class="lu lv in lp b gy ma lx l ly lz">const enterEdit = (e) =&gt; {<br/>  if(e.keyCode == 13) active=null;<br/>  todos=todos;  // trigger updating todos<br/>}</span></pre><p id="7dca" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在<a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank">马利纳</a>中:</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="59c0" class="lu lv in lp b gy lw lx l ly lz">&lt;input on:keydown|enter={active=null} bind:value={active.name} /&gt;</span></pre><p id="0b5d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">这里不需要额外的代码，它像预期的那样工作——active . name由输入更改并自动呈现在列表中，因为更改检测器检查绑定。你也可以通知一个事件修饰符<em class="kq"> "enter" </em>，它只对键<em class="kq"> "Enter" - </em>起作用，这很有帮助，我认为如果Svelte有它就好了(vue.js也有)。</p><p id="0ced" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">再举一个例子就是改变(反转)<em class="kq"> todo.name </em>，苗条:</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="5023" class="lu lv in lp b gy lw lx l ly lz">const reverse = todo =&gt; {<br/>  let newName = todo.name.split("").reverse().join("");<br/>  todos = todos.map(item =&gt; ({<br/>    name: item==todo?newName:item.name<br/>  }));<br/>}</span></pre><p id="a203" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> Malina.js </a>，换个名字就行了:</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="5cbb" class="lu lv in lp b gy lw lx l ly lz">const reverse = todo =&gt; {<br/>  todo.name = todo.name.split("").reverse().join("");<br/>}</span></pre><p id="ab96" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以你可以看到Svelte里面的代码看起来像是纯JS，但是我不能自由使用JS。</p><p id="6f92" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io"> Svelte </strong>为<em class="kq">提供了一种不可变的方式</em>——但这只是隐藏“赋值”的面具，因为赋值触发了更新，而不是不可变。所以写<code class="fe lm ln lo lp b">todos=todos</code>就够了，之后那个苗条触发更新。</p><p id="9440" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以Svelte中不变性的主要原因是为了让JS看起来更自然，为了逃离毫无价值的<code class="fe lm ln lo lp b">todos=todos</code>，这类似于来自其他框架的命令<code class="fe lm ln lo lp b">setValue/setState</code>。</p><p id="a797" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> Malina.js </strong> </a>让我改变对象和数组，它的工作方式和我对JavaScript的期望一样。</p><h2 id="e134" class="lu lv in bd mb mc md dn me mf mg dp mh kc mi mj mk kg ml mm mn kk mo mp mq mr bi translated">还有什么不同？</h2><p id="8099" class="pw-post-body-paragraph jr js in jt b ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk mw km kn ko ig bi translated">这是构建DOM的另一种方式，让我们来看看这个小片段:</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="14d3" class="lu lv in lp b gy lw lx l ly lz">&lt;div class="some class"&gt;<br/>  &lt;span on:click={click}&gt;<br/>    &lt;b&gt;a lot of &lt;i&gt;html&lt;/i&gt; can be here&lt;/b&gt;<br/>  &lt;/span&gt;<br/>&lt;/div&gt;</span></pre><p id="bc4e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">编译后它在<strong class="jt io"> Svelte </strong>中的样子(Svelte一个元素一个元素地构建它):</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="887d" class="lu lv in lp b gy lw lx l ly lz">div = element("div");<br/>span = element("span");<br/>b = element("b");<br/>t0 = text("a lot of ");<br/>i = element("i");<br/>i.textContent = "html";<br/>t2 = text(" can be here");<br/>attr_dev(div, "class", "some class");<br/>...<br/>insert_dev(target, div, anchor);<br/>append_dev(div, span);<br/>append_dev(span, b);<br/>append_dev(b, t0);<br/>append_dev(b, i);<br/>append_dev(b, t2);<br/>...<br/>dispose = listen(span, "click", click, false, false, false);</span></pre><p id="089f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io">看起来怎么样Malina.js </strong> </a>:</p><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="5bfa" class="lu lv in lp b gy lw lx l ly lz">$element.innerHTML = `&lt;div class="some class"&gt; &lt;span&gt; &lt;b&gt;a lot of &lt;i&gt;html&lt;/i&gt; can be here&lt;/b&gt; &lt;/span&gt; &lt;/div&gt;`;</span><span id="6248" class="lu lv in lp b gy ma lx l ly lz">$element.childNodes[0].childNodes[1].addEventListener('click', ...);</span></pre><p id="a38d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">作为一个操作插入一个模板，<code class="fe lm ln lo lp b">node.cloneNode(true)</code>用于<code class="fe lm ln lo lp b">#each</code>和<code class="fe lm ln lo lp b">#if</code> <em class="kq"> (Solid.js工作方式类似)</em>中的可重复块。</p><p id="9eed" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">它提供了更小的包大小和略好的性能<em class="kq">(在Firefox中重新渲染列表的速度提高了两倍)</em>，例如，我编译了相同的<a class="ae kp" href="https://github.com/malinajs/todomvc" rel="noopener ugc nofollow" target="_blank"> TodoMVC </a>应用程序:</p><ul class=""><li id="3520" class="mx my in jt b ju jv jy jz kc mz kg na kk nb ko nc nd ne nf bi translated"><strong class="jt io">Svelte:</strong><strong class="jt io">3.7 kb</strong>gzipped(<em class="kq">去掉了一代uuid等于</em>)，</li><li id="bb08" class="mx my in jt b ju ng jy nh kc ni kg nj kk nk ko nc nd ne nf bi translated"><strong class="jt io">Malina:2.7 kb</strong>gzipped(<a class="ae kp" href="https://github.com/malinajs/todomvc" rel="noopener ugc nofollow" target="_blank">source</a>)。</li></ul><p id="d284" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最后改变的是事件绑定的样式，它取自<strong class="jt io"> Angular </strong>，所以在Malina.js中它看起来像<code class="fe lm ln lo lp b">on:click={reverse(todo)}</code>而在Svelte中它是<code class="fe lm ln lo lp b">on:click={() =&gt; {reverse(todo)}}</code>，但是它还没有最终决定。</p><h2 id="f84f" class="lu lv in bd mb mc md dn me mf mg dp mh kc mi mj mk kg ml mm mn kk mo mp mq mr bi translated"><a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank">今天能做什么</a></h2><p id="13bb" class="pw-post-body-paragraph jr js in jt b ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk mw km kn ko ig bi translated">Malina.js太年轻了<em class="kq">(我两周前才开始使用)</em>，所以它还没有太多的功能，但最重要的功能是简单的应用程序和小工具所需要的。</p><p id="c31d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">目前有:绑定、绑定事件、类/风格、if-else块、for-each块、自定义指令/动作、反应(检测变化)，所有这些你都可以在<a class="ae kp" href="https://malinajs.github.io/repl/" rel="noopener ugc nofollow" target="_blank">的例子中看到</a>。</p><h2 id="21cb" class="lu lv in bd mb mc md dn me mf mg dp mh kc mi mj mk kg ml mm mn kk mo mp mq mr bi translated">试试<a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"> Malina.js </a></h2><ul class=""><li id="5087" class="mx my in jt b ju ms jy mt kc nl kg nm kk nn ko nc nd ne nf bi translated">你可以在REPL  <em class="kq">(也是用</em><a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank"><em class="kq">malina . js</em></a><em class="kq">—短短140行代码)在线试试<a class="ae kp" href="https://malinajs.github.io/repl/" rel="noopener ugc nofollow" target="_blank"/></em></li><li id="ce19" class="mx my in jt b ju ng jy nh kc ni kg nj kk nk ko nc nd ne nf bi translated">如果你不想安装<strong class="jt io"> nodejs </strong>之类的东西:<code class="fe lm ln lo lp b">docker run — rm -it — user ${UID} -p 7000:7000 -p 35729:35729 -v `pwd`:/app/src lega911/malina</code>，你也可以通过<strong class="jt io"> docker </strong>运行它，并实时重载</li><li id="e882" class="mx my in jt b ju ng jy nh kc ni kg nj kk nk ko nc nd ne nf bi translated">或者通过npm/npx安装模板:</li></ul><pre class="kr ks kt ku gt lq lp lr ls aw lt bi"><span id="6d7f" class="lu lv in lp b gy lw lx l ly lz">npx degit malinajs/template myapp<br/>cd myapp<br/>npm install<br/>npm run dev<br/># open http://localhost:7000/</span></pre><h2 id="ac10" class="lu lv in bd mb mc md dn me mf mg dp mh kc mi mj mk kg ml mm mn kk mo mp mq mr bi translated">结论</h2><p id="2528" class="pw-post-body-paragraph jr js in jt b ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk mw km kn ko ig bi translated">Malina.js 就像另一个变化探测器的苗条身材。它有助于更自由地使用JavaScript，具有更多预期的行为。更简单的JavaScript使开发过程更容易。</p><p id="293d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">感谢您的阅读，请留下反馈。</p><p id="fcbc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="kq"> Rich说过Svelte不仅仅是一个编译器，它是一种语言，Svelte-language，但是我仍然想使用JavaScript。</em></p><h2 id="cfc8" class="lu lv in bd mb mc md dn me mf mg dp mh kc mi mj mk kg ml mm mn kk mo mp mq mr bi translated">链接</h2><ul class=""><li id="30a1" class="mx my in jt b ju ms jy mt kc nl kg nm kk nn ko nc nd ne nf bi translated"><a class="ae kp" href="https://github.com/malinajs/malinajs" rel="noopener ugc nofollow" target="_blank">github上的malina . js</a></li><li id="f239" class="mx my in jt b ju ng jy nh kc ni kg nj kk nk ko nc nd ne nf bi translated"><a class="ae kp" href="https://malinajs.github.io/repl/" rel="noopener ugc nofollow" target="_blank">在线编辑REPL </a></li><li id="f52c" class="mx my in jt b ju ng jy nh kc ni kg nj kk nk ko nc nd ne nf bi translated"><a class="ae kp" href="https://github.com/malinajs/todomvc" rel="noopener ugc nofollow" target="_blank">todo MVC的来源</a></li><li id="13e8" class="mx my in jt b ju ng jy nh kc ni kg nj kk nk ko nc nd ne nf bi translated"><a class="ae kp" href="http://malina-todomvc.surge.sh/" rel="noopener ugc nofollow" target="_blank"> TodoMVC </a></li></ul><h2 id="847d" class="lu lv in bd mb mc md dn me mf mg dp mh kc mi mj mk kg ml mm mn kk mo mp mq mr bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="b34f" class="pw-post-body-paragraph jr js in jt b ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk mw km kn ko ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kp" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io">订阅我们的YouTube频道</strong> </a> <strong class="jt io">获取更多类似内容！</strong></p></div></div>    
</body>
</html>