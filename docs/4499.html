<html>
<head>
<title>Tackle Front-End Request Validation With TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript处理前端请求验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/tackle-front-end-request-validation-with-typescript-d0a6d108fd24?source=collection_archive---------4-----------------------#2020-12-16">https://javascript.plainenglish.io/tackle-front-end-request-validation-with-typescript-d0a6d108fd24?source=collection_archive---------4-----------------------#2020-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5e28" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">您确定您的JSON响应具有您期望的格式吗？如果没有呢？</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/fd19ed9a2c618afa6d856b1e8cabda10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FqVuIG8cMEaBtWyr95j3g.jpeg"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/photos/MggK54YixfU?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">Raúl Nájera</a> on <a class="ae kw" href="https://unsplash.com/s/photos/danger-sign" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="44d3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你好，前端开发人员，我希望我激起了你的兴趣。回答我自己的问题:<em class="lt">“不，我甚至可以肯定，在某个时刻，我的端点会以一种我不期望的格式来回答”</em>。</p><h1 id="dc61" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">在前端验证请求响应的动机</h1><p id="5e86" class="pw-post-body-paragraph kx ky iq kz b la mm jr lc ld mn ju lf lg mo li lj lk mp lm ln lo mq lq lr ls ij bi translated">不管您使用的是哪种技术/库/框架，一旦您开始使用一个前端和后端分离的web应用程序，就会有一个风险，即在您编写请求之后，响应的规范会发生变化。</p><p id="dc39" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我参与的每个项目的某个时候，我们有一个端点在没有完全通知前端团队的情况下获得更新。</p><p id="12be" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">出现的问题:</p><ul class=""><li id="2d03" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">信息在一段时间内显示不佳或为空</li><li id="bbb8" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">一些特定的(和嵌套的)屏幕崩溃时被打开</li><li id="1583" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">不满意的用户</li><li id="4693" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">这也意味着沟通和测试过程有弱点</li></ul><p id="2017" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">像<a class="ae kw" href="https://medium.com/@davert/javascript-the-future-of-end-to-end-testing-bfc00e23110b" rel="noopener">端到端测试</a>或者更好的<a class="ae kw" href="https://medium.com/@liran.tal/a-comprehensive-guide-to-contract-testing-apis-in-a-service-oriented-architecture-5695ccf9ac5a" rel="noopener">契约测试</a>这样的实践，允许你预先测试你的整个系统和它的请求，以确保一切按预期工作。</p><div class="nf ng gp gr nh ni"><a href="https://medium.com/@davert/javascript-the-future-of-end-to-end-testing-bfc00e23110b" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">JavaScript:端到端测试的未来</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">浏览器测试自动化的现状</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kq ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://medium.com/@liran.tal/a-comprehensive-guide-to-contract-testing-apis-in-a-service-oriented-architecture-5695ccf9ac5a" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">面向服务的架构中契约测试API的综合指南</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">您很可能经历过部署到生产环境中却发现某个API服务…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw kq ni"/></div></div></a></div><p id="9def" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">但是，根据您正在进行的项目，这可能并不完全适合您:</p><ul class=""><li id="c433" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">您无法控制您调用的端点。</li><li id="cabe" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">您可能没有100%的测试或案例覆盖率。</li><li id="4326" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">你还没有为这样或那样的练习做好准备。</li><li id="c796" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">您的流程尚未完全建立。</li><li id="c737" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated"><em class="lt">墨菲定律。</em></li></ul><p id="8775" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">考虑到这一点，我有两个愿望:</p><ul class=""><li id="2c25" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">实时了解我的应用在测试和生产中是否收到了格式与其主要定义不匹配的JSON响应。</li><li id="c946" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">使用默认值，而不是让我的应用程序因为丢失或重命名的属性而崩溃。</li></ul><h1 id="7d02" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">让我们谈谈打字稿</h1><p id="7138" class="pw-post-body-paragraph kx ky iq kz b la mm jr lc ld mn ju lf lg mo li lj lk mp lm ln lo mq lq lr ls ij bi translated"><em class="lt">由于我们需要一个真实的用例，我们将以axios的“登录”请求为例。这里</em>  <em class="lt">可以找到完整的</em> <a class="ae kw" href="https://github.com/morintd/example-axios-validation" rel="noopener ugc nofollow" target="_blank"> <em class="lt">例子。</em></a></p><h2 id="efbb" class="ny lv iq bd lw nz oa dn ma ob oc dp me lg od oe mg lk of og mi lo oh oi mk oj bi translated">安装</h2><p id="da39" class="pw-post-body-paragraph kx ky iq kz b la mm jr lc ld mn ju lf lg mo li lj lk mp lm ln lo mq lq lr ls ij bi translated">假设您正在开发新的前端应用程序，并开始发出请求。首先用<code class="fe ok ol om on b">yarn add axios</code>安装axios并设置它:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="381a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因为您正在设置登录，所以您定义了以下类型:</p><ul class=""><li id="db81" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">您的请求参数:</li></ul><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><ul class=""><li id="5a6d" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">您的请求期望得到响应:</li></ul><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><ul class=""><li id="bfdc" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">以及您的函数预期返回的数据类型:</li></ul><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="2435" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">因此，您可以轻松可靠地编写您的请求函数:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="1040" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">你有你需要的一切:</p><ul class=""><li id="4e59" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">由于使用了TypeScript，降低了打字错误和错误转换的风险</li><li id="3d1b" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">没有正确的参数，无法调用此函数</li><li id="f314" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">错误密码的处理错误</li></ul><p id="6d66" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这就是我们需要的一切，对吗？现在，如果在某个时候，<code class="fe ok ol om on b">createdAt</code>和<code class="fe ok ol om on b">updatedAt</code>将从<code class="fe ok ol om on b">user</code>中移除，而只出现在<code class="fe ok ol om on b">signUp</code>中，会怎么样呢？</p><p id="89ba" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">甚至可以说，你没有被告知，你用这个数据来显示注册以来的用户天数。如果您没有一个健壮的测试/质量过程，并且这进入了生产，那么您的应用程序很可能会抛出一个错误。</p><p id="2cbf" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是一个显而易见的功能，我们不是在谈论隐藏的或很少使用的功能。现在，我们的问题是如何验证传入的请求具有预期的格式。</p><h2 id="d473" class="ny lv iq bd lw nz oa dn ma ob oc dp me lg od oe mg lk of og mi lo oh oi mk oj bi translated">确认</h2><p id="1fd8" class="pw-post-body-paragraph kx ky iq kz b la mm jr lc ld mn ju lf lg mo li lj lk mp lm ln lo mq lq lr ls ij bi translated">我们有一个很好的起点，打字稿！我们已经定义了预期的请求响应，所以也许我们可以用它来验证传入的请求。</p><p id="6c86" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们很幸运，有很多实用程序可以与大量的验证库一起使用TypeScript。</p><p id="02af" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">您可以:</p><ul class=""><li id="7fc5" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">将您的类型编译成JSON-schema！像<code class="fe ok ol om on b"><a class="ae kw" href="https://github.com/YousefED/typescript-json-schema" rel="noopener ugc nofollow" target="_blank">typescript-json-schema</a></code>和<code class="fe ok ol om on b"><a class="ae kw" href="https://www.google.com/search?client=firefox-b-d&amp;q=ts-json-schema-generator" rel="noopener ugc nofollow" target="_blank">ts-json-schema-generator</a></code>这样的模块可以帮你做到。</li><li id="c35a" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">然后，您可以使用诸如<a class="ae kw" href="https://www.npmjs.com/package/yup?activeTab=readme" rel="noopener ugc nofollow" target="_blank"> Yup </a>(带有<a class="ae kw" href="https://www.npmjs.com/package/json-schema-yup-transformer" rel="noopener ugc nofollow" target="_blank"> json-schema-yup-yup </a>)和<a class="ae kw" href="https://github.com/ajv-validator/ajv" rel="noopener ugc nofollow" target="_blank"> Ajv </a>之类的库来将一个对象与生成的json-schema进行匹配。</li><li id="ace6" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">另一个选择可能是<a class="ae kw" href="https://github.com/sideway/joi" rel="noopener ugc nofollow" target="_blank"> Joi </a> with <a class="ae kw" href="https://github.com/joiful-ts/joiful" rel="noopener ugc nofollow" target="_blank"> Joiful，</a>但是这是一个使用<a class="ae kw" href="http://browser" rel="noopener ugc nofollow" target="_blank">浏览器</a>很难操作的库。</li></ul><p id="b62e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Ajv是最简单的，也是我们今天要用的。</p><p id="8d4b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果您想深入研究Ajv和JSON-Schema，我可以推荐您从那里开始:</p><div class="nf ng gp gr nh ni"><a href="https://medium.com/swlh/an-introduction-to-json-schema-8eaea643fcda" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">JSON模式介绍</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">我最近开始使用JSON Schema，并开始意识到它们可以给开发者带来的价值，以及在…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="oq l nt nu nv nr nw kq ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://medium.com/nsoft/using-ajv-for-schema-validation-with-nodejs-1dfef0a372f8" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">使用AJV对NodeJS进行模式验证</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">如果你是一个开发API的开发者，你需要考虑的无数事情中包括验证用户输入和…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="or l nt nu nv nr nw kq ni"/></div></div></a></div><p id="b677" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我对前面提到的生成JSON模式的工具并不满意。我不想编写和维护自己的脚本，而是希望有一个简单明了的CLI。</p><p id="3df8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这就是为什么对于这个前端请求验证项目，我创建了我自己的。构建在<code class="fe ok ol om on b"><a class="ae kw" href="https://github.com/YousefED/typescript-json-schema" rel="noopener ugc nofollow" target="_blank">typescript-json-schema</a></code>之上，只有一个命令。</p><ul class=""><li id="1526" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">用<code class="fe ok ol om on b">yarn add -D ts-generate-schema</code>安装。</li><li id="7c0d" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">用给定的扩展名命名要生成JSON-Schema的文件(例如. response.ts)。</li><li id="039d" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">在package.json中添加以下代码行:</li></ul><pre class="kh ki kj kk gt os on ot ou aw ov bi"><span id="9985" class="ny lv iq on b gy ow ox l oy oz">"schema": "ts-generate-schema src/**/*.response.ts"</span></pre><ul class=""><li id="c254" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">运行<code class="fe ok ol om on b">yarn schema</code>来生成所有的JSON-Schema。</li></ul><div class="nf ng gp gr nh ni"><a href="https://github.com/morintd/ts-generate-schema" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">morintd/ts-生成模式</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">从您的typescript定义生成json-schema文件</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="pa l nt nu nv nr nw kq ni"/></div></div></a></div><h2 id="631f" class="ny lv iq bd lw nz oa dn ma ob oc dp me lg od oe mg lk of og mi lo oh oi mk oj bi translated">在实践中</h2><p id="7dd2" class="pw-post-body-paragraph kx ky iq kz b la mm jr lc ld mn ju lf lg mo li lj lk mp lm ln lo mq lq lr ls ij bi translated">一旦生成了模式，一切都可以通过axios配置和拦截器来设置。</p><div class="nf ng gp gr nh ni"><a href="https://medium.com/datadriveninvestor/axios-instance-interceptors-682868f0de2d" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">Axios实例和拦截器</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">Axios是最常用的promise base http客户端之一，它不仅仅是get和post</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="pb l nt nu nv nr nw kq ni"/></div></div></a></div><p id="b875" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">出于性能原因，Ajv允许您首先从JSON-Schema编译一个validate函数，然后使用它。让我们告诉TypeScript在我们的axios配置中允许这个验证函数。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="eadb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">所以现在，我们可以编译我们的JSON-Schema，TypeScript将允许我们在发出请求时添加这个函数。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="05f8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，我们可以添加拦截器来最终验证我们的请求:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="4226" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这里，错误只是被发送到一个console.error，但是应该通过一个监控工具来处理，比如<a class="ae kw" href="https://sentry.io/" rel="noopener ugc nofollow" target="_blank"> sentry.io </a>。</p><h2 id="7e7f" class="ny lv iq bd lw nz oa dn ma ob oc dp me lg od oe mg lk of og mi lo oh oi mk oj bi translated">误差容限</h2><p id="4bcd" class="pw-post-body-paragraph kx ky iq kz b la mm jr lc ld mn ju lf lg mo li lj lk mp lm ln lo mq lq lr ls ij bi translated">我的一个愿望实现了。太好了！但是另一个呢？</p><p id="b905" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我看来，如果响应中缺少给定的属性，发送一个假值是合理的:</p><ul class=""><li id="c20c" class="mr ms iq kz b la lb ld le lg mt lk mu lo mv ls mw mx my mz bi translated">显示一个空的用户名，而不是我的整个应用程序关闭。</li><li id="3b48" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">在我们的用例中，显示用户从0天开始注册，而不是一个大红色的“RangeError: Invalid date”。</li><li id="d151" class="mr ms iq kz b la na ld nb lg nc lk nd lo ne ls mw mx my mz bi translated">唯一的假设是，我会知道它何时发生，这就是我们刚刚设置的！</li></ul><p id="204b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我的解决方案被称为“深度合并”。这是许多可能的策略之一。如果我收到一个格式错误的响应，我至少会尝试将其与一个有效的(但为空的)对象深度合并。</p><p id="76d4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们用<code class="fe ok ol om on b">yarn add deepmerge</code>安装一个深度合并模块:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/TehShrike/deepmerge" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">teh shrike/深合并</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">深度合并两个或多个对象的可枚举属性。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="pc l nt nu nv nr nw kq ni"/></div></div></a></div><p id="cc3e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">该过程将与验证过程相同。让我们在axios配置中允许另一个名为nullRawData的键(不言自明吧？):</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="ff9e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在原始响应的定义文件中，创建空对象。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="61b7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然后我们可以导入并在我们的请求中使用它。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="57c8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">然后，我们可以通过深度合并来完成之前的验证策略。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="0d69" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，如果由于未知的原因我的API发生了变化，那么我的应用程序宕机或任何变化被忽略的风险就会大大降低。</p><p id="5ab5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当前的策略甚至可以通过检查属性类型是否无效并将其与默认的有效类型合并来改进。</p><p id="6e54" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">示例将保存在<a class="ae kw" href="https://github.com/morintd/example-axios-validation" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="6c8d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="lt">感谢阅读</em>。</p></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><div class="kh ki kj kk gt ni"><a href="https://medium.com/@morin.td/about-me-teddy-morin-9fb1d65fe24e" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">关于我——泰迪·莫林</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">嗨，我是泰迪，一个反应的爱人🚀。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="pk l nt nu nv nr nw kq ni"/></div></div></a></div><p id="9b3c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">延伸阅读:</p><p id="d47c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(中)JavaScript:端到端测试的未来:<a class="ae kw" href="https://medium.com/@davert/javascript-the-future-of-end-to-end-testing-bfc00e23110b" rel="noopener"><strong class="kz ir">https://Medium . com/@ davert/JavaScript-The-Future-of-End-to-End-Testing-bfc 00 e 23110 b</strong></a></p><p id="d4b0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(中)面向服务架构中合约测试API综合指南:<a class="ae kw" href="https://medium.com/@liran.tal/a-comprehensive-guide-to-contract-testing-apis-in-a-service-oriented-architecture-5695ccf9ac5a" rel="noopener"><strong class="kz ir">https://Medium . com/@ liran . tal/A-Comprehensive-Guide-to-Contract-Testing-APIs-in-A-Service-Oriented-Architecture-5695 CCF 9 AC 5a</strong></a></p><p id="0e34" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(GitHub)前端请求验证示例:<a class="ae kw" href="https://github.com/morintd/example-axios-validation" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">https://github.com/morintd/example-axios-validation</strong></a></p><p id="a548" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(中)JSON模式介绍:<a class="ae kw" href="https://medium.com/swlh/an-introduction-to-json-schema-8eaea643fcda" rel="noopener"><strong class="kz ir">https://Medium . com/swlh/An-introduction-to-JSON-Schema-8 AEA 643 fcda</strong></a></p><p id="49b2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(GitHub)ts-generate-schema:<a class="ae kw" href="https://github.com/morintd/ts-generate-schema" rel="noopener ugc nofollow" target="_blank">https://github.com/morintd/ts-generate-schemaT21</a></p><p id="f876" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(中)Axios实例&amp;拦截器:<a class="ae kw" href="https://medium.com/datadriveninvestor/axios-instance-interceptors-682868f0de2d" rel="noopener"><strong class="kz ir">https://Medium . com/datadriveninvestor/Axios-Instance-Interceptors-682868 f0de 2d</strong></a></p><p id="1996" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">(GitHub)deep merge:<a class="ae kw" href="https://github.com/TehShrike/deepmerge" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">https://github.com/TehShrike/deepmerge</strong></a></p></div></div>    
</body>
</html>