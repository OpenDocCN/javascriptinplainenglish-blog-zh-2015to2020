<html>
<head>
<title>Browser Automation Tests with Cucumber and WebDriverJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Cucumber和WebDriverJS进行浏览器自动化测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/cucumber-and-webdriverjs-3a0ee227c297?source=collection_archive---------5-----------------------#2020-10-26">https://javascript.plainenglish.io/cucumber-and-webdriverjs-3a0ee227c297?source=collection_archive---------5-----------------------#2020-10-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/6f0580c6efcadfe1064523c2d875a9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dhrCkqxOhF9DFtDP.png"/></div></div></figure><h1 id="8168" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">背景</h1><p id="68c2" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">来自<a class="ae lr" href="https://github.com/cucumber/cucumber-js" rel="noopener ugc nofollow" target="_blank"> Cucumber.js </a>自述:</p><blockquote class="ls lt lu"><p id="eeb6" class="kt ku lv kv b kw lw ky kz la lx lc ld ly lz lg lh ma mb lk ll mc md lo lp lq ig bi translated">黄瓜是一个用简单语言编写的自动化测试工具。</p></blockquote><p id="3c4c" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">换句话说，Cucumber使用<a class="ae lr" href="https://cucumber.io/docs/gherkin/" rel="noopener ugc nofollow" target="_blank">小黄瓜</a>语法帮助完成<a class="ae lr" href="https://en.wikipedia.org/wiki/Behavior-driven_development" rel="noopener ugc nofollow" target="_blank">行为驱动开发(BDD) </a>。</p><h1 id="97bc" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">先决条件</h1><ul class=""><li id="a62f" class="me mf in kv b kw kx la lb le mg li mh lm mi lq mj mk ml mm bi translated"><a class="ae lr" href="http://b.remarkabl.org/nodejs-site" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae lr" href="http://b.remarkabl.org/get-npm" rel="noopener ugc nofollow" target="_blank"> npm </a></li><li id="2225" class="me mf in kv b kw mn la mo le mp li mq lm mr lq mj mk ml mm bi translated"><a class="ae lr" href="http://b.remarkabl.org/firefox" rel="noopener ugc nofollow" target="_blank">火狐</a>和<a class="ae lr" href="http://b.remarkabl.org/geckodriver" rel="noopener ugc nofollow" target="_blank">壁虎</a></li></ul><p id="b3e9" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">如果你在macOS上，你可以用<a class="ae lr" href="http://b.remarkabl.org/homebrew" rel="noopener ugc nofollow" target="_blank">家酿</a>安装必备软件:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="14b2" class="nb jw in mx b gy nc nd l ne nf">$ brew install node<br/>$ brew cask install firefox<br/>$ brew install geckodriver</span></pre><h1 id="14ee" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">安装</h1><p id="95ab" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">安装<a class="ae lr" href="https://www.npmjs.com/package/cucumber" rel="noopener ugc nofollow" target="_blank">黄瓜</a>和<a class="ae lr" href="http://b.remarkabl.org/1Tx8tt4" rel="noopener ugc nofollow" target="_blank">硒网驱动</a>:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="cc91" class="nb jw in mx b gy nc nd l ne nf">$ npm install cucumber@6 selenium-webdriver</span></pre><p id="9380" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">我们使用的版本是:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="621a" class="nb jw in mx b gy nc nd l ne nf">$ npm ls --depth=0<br/>├── cucumber@6.0.5<br/>└── selenium-webdriver@4.0.0-alpha.7</span></pre><h1 id="240f" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">设置</h1><p id="f27f" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">创建一个名为<code class="fe ng nh ni mx b">cucumber.js</code>的文件:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="81bd" class="nb jw in mx b gy nc nd l ne nf">$ touch cucumber.js</span></pre><p id="8ad5" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">添加内容:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="fa33" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">运行<code class="fe ng nh ni mx b">cucumber-js</code>以查看没有找到任何场景/步骤。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="571d" class="nb jw in mx b gy nc nd l ne nf">$ npx cucumber-js</span><span id="82bd" class="nb jw in mx b gy nl nd l ne nf">0 scenarios<br/>0 steps<br/>0m00.000s</span></pre><h1 id="f4cc" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">特征</h1><p id="b3e2" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">创建一个名为<code class="fe ng nh ni mx b">features</code>的目录:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="1f15" class="nb jw in mx b gy nc nd l ne nf">$ mkdir features</span></pre><blockquote class="ls lt lu"><p id="bff0" class="kt ku lv kv b kw lw ky kz la lx lc ld ly lz lg lh ma mb lk ll mc md lo lp lq ig bi translated">此处目录名的拼写和大小写必须准确。</p></blockquote><p id="a25d" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">在目录中创建一个<code class="fe ng nh ni mx b">.feature</code>文件。我们将把它命名为<code class="fe ng nh ni mx b">google-search.feature</code>:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="115d" class="nb jw in mx b gy nc nd l ne nf">$ touch features/google-search.feature</span></pre><p id="8feb" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">编写场景:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="3018" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">运行<code class="fe ng nh ni mx b">npx cucumber-js</code>查看警告:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7987" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">这是意料之中的，因为<a class="ae lr" href="https://github.com/cucumber/cucumber-js/blob/v6.0.5/docs/support_files/step_definitions.md" rel="noopener ugc nofollow" target="_blank">步骤定义</a>未定义。</p><h1 id="584f" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">步骤定义</h1><p id="7c95" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在<code class="fe ng nh ni mx b">features</code>目录中为您的步骤创建一个<code class="fe ng nh ni mx b">.js</code>文件。我们将它命名为<code class="fe ng nh ni mx b">google-search-steps.js</code>:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="09c1" class="nb jw in mx b gy nc nd l ne nf">$ touch features/google-search-steps.js</span></pre><p id="68ab" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">从<code class="fe ng nh ni mx b">cucumber</code>导入<code class="fe ng nh ni mx b">Given</code>、<code class="fe ng nh ni mx b">When</code>和<code class="fe ng nh ni mx b">Then</code>，并粘贴之前的步骤:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4227" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">运行<code class="fe ng nh ni mx b">npx cucumber-js</code>查看警告:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="bf77" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">Selenium WebDriver</h1><p id="a31e" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">用<code class="fe ng nh ni mx b">features/google-search-steps.js</code>中的WebDriverJS动作填写<a class="ae lr" href="https://github.com/cucumber/cucumber-js/blob/v6.0.5/docs/support_files/step_definitions.md" rel="noopener ugc nofollow" target="_blank">步骤定义</a>。</p><h2 id="38ad" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">在此之前</h2><p id="fae0" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在<code class="fe ng nh ni mx b">Given</code>步骤之前构建驱动程序:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="d52a" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">毕竟</h2><p id="6f42" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">退出<code class="fe ng nh ni mx b">AfterAll</code>中的驱动<a class="ae lr" href="https://github.com/cucumber/cucumber-js/blob/v6.0.5/docs/support_files/hooks.md" rel="noopener ugc nofollow" target="_blank">勾</a>:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="22b5" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">考虑到</h2><p id="b2c5" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">填写<code class="fe ng nh ni mx b">Given</code>步骤:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="b18b" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">当...的时候</h2><p id="2fac" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">填写<code class="fe ng nh ni mx b">When</code>的步骤:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><blockquote class="ls lt lu"><p id="0615" class="kt ku lv kv b kw lw ky kz la lx lc ld ly lz lg lh ma mb lk ll mc md lo lp lq ig bi translated">建议使用<a class="ae lr" href="https://www.selenium.dev/selenium/docs/api/javascript/module/selenium-webdriver/lib/until.html" rel="noopener ugc nofollow" target="_blank">等待到</a>而不是<a class="ae lr" href="https://www.selenium.dev/selenium/docs/api/javascript/module/selenium-webdriver/lib/webdriver_exports_WebDriver.html#sleep" rel="noopener ugc nofollow" target="_blank">休眠</a>，这样测试运行速度更快，不会变得不稳定。</p></blockquote><h2 id="ef67" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">然后</h2><p id="2aec" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">填写<code class="fe ng nh ni mx b">Then</code>步骤:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="db41" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">运行<code class="fe ng nh ni mx b">npx cucumber-js</code>查看故障:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="3d59" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">超时</h1><p id="9df8" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><a class="ae lr" href="https://github.com/cucumber/cucumber-js/blob/6.x/docs/support_files/timeouts.md#timeouts" rel="noopener ugc nofollow" target="_blank">超时</a>可以通过两种方式指定:</p><ol class=""><li id="8802" class="me mf in kv b kw lw la lx le nx li ny lm nz lq oa mk ml mm bi translated">全球的</li><li id="ab06" class="me mf in kv b kw mn la mo le mp li mq lm mr lq oa mk ml mm bi translated">台阶(或钩子)</li></ol><h2 id="4704" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">全局超时</h2><p id="1ebd" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">要指定全局超时:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h2 id="d270" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">步骤超时</h2><p id="a1a4" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">要指定步骤超时:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><blockquote class="ls lt lu"><p id="a25e" class="kt ku lv kv b kw lw ky kz la lx lc ld ly lz lg lh ma mb lk ll mc md lo lp lq ig bi translated">请注意，如何将包含超时的对象指定为step函数的第二个参数。</p></blockquote><p id="052d" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">运行<code class="fe ng nh ni mx b">npx cucumber-js</code>来验证场景是否通过:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5fef" class="nb jw in mx b gy nc nd l ne nf">$ npx cucumber-js<br/>...</span><span id="f995" class="nb jw in mx b gy nl nd l ne nf">1 scenario (1 passed)<br/>3 steps (3 passed)<br/>0m06.881s</span></pre><p id="ae7a" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated">成功！</p><h1 id="3f2a" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">最后的步骤</h1><p id="46bf" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">最后的<code class="fe ng nh ni mx b">features/google-search-steps.js</code>是这样的:</p><figure class="ms mt mu mv gt jo"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="4b9f" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">资源</h1><p id="517e" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">查看<a class="ae lr" href="https://b.remarkabl.org/2eUH7z7" rel="noopener ugc nofollow" target="_blank"> WebDriverJS食谱</a>获取更多示例。</p><h2 id="9a52" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">黄瓜</h2><ul class=""><li id="c134" class="me mf in kv b kw kx la lb le mg li mh lm mi lq mj mk ml mm bi translated"><a class="ae lr" href="https://cucumber.io/docs/guides/10-minute-tutorial/" rel="noopener ugc nofollow" target="_blank">黄瓜:10分钟教程</a></li><li id="4234" class="me mf in kv b kw mn la mo le mp li mq lm mr lq mj mk ml mm bi translated"><a class="ae lr" href="https://cucumber.io/docs/guides/browser-automation/" rel="noopener ugc nofollow" target="_blank">黄瓜:浏览器自动化</a></li></ul><h2 id="0e01" class="nb jw in bd jx nm nn dn kb no np dp kf le nq nr kj li ns nt kn lm nu nv kr nw bi translated">硒</h2><ul class=""><li id="2b6b" class="me mf in kv b kw kx la lb le mg li mh lm mi lq mj mk ml mm bi translated"><a class="ae lr" href="https://b.remarkabl.org/34tlEFy" rel="noopener ugc nofollow" target="_blank">web driver js:async/await</a></li><li id="d65d" class="me mf in kv b kw mn la mo le mp li mq lm mr lq mj mk ml mm bi translated"><a class="ae lr" href="https://b.remarkabl.org/2eDO1Xp" rel="noopener ugc nofollow" target="_blank">用含硒的壁虎驱动</a></li><li id="062d" class="me mf in kv b kw mn la mo le mp li mq lm mr lq mj mk ml mm bi translated"><a class="ae lr" href="https://www.browserstack.com/docs/automate/selenium/getting-started/nodejs/cucumber-js" rel="noopener ugc nofollow" target="_blank"> BrowserStack:硒黄瓜JS </a></li><li id="7c38" class="me mf in kv b kw mn la mo le mp li mq lm mr lq mj mk ml mm bi translated"><a class="ae lr" href="https://b.remarkabl.org/2etiPuZ" rel="noopener ugc nofollow" target="_blank">硒-网络驱动程序文档</a></li></ul></div><div class="ab cl ob oc hr od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ig ih ii ij ik"><p id="cabe" class="pw-post-body-paragraph kt ku in kv b kw lw ky kz la lx lc ld le lz lg lh li mb lk ll lm md lo lp lq ig bi translated"><a class="ae lr" href="https://b.remarkabl.org/34pXj3b" rel="noopener ugc nofollow" target="_blank"> <em class="lv">本文最初于2020年10月25日在remarkablemark.org发表。</em> </a></p></div></div>    
</body>
</html>