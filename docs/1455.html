<html>
<head>
<title>How to Upload Photos to Firebase Storage in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将照片上传到React Native中的Firebase存储</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-upload-photos-to-firebase-storage-in-react-native-dc3d2f4771b8?source=collection_archive---------6-----------------------#2020-03-17">https://javascript.plainenglish.io/how-to-upload-photos-to-firebase-storage-in-react-native-dc3d2f4771b8?source=collection_archive---------6-----------------------#2020-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2fe14926195d0646ae946cd4eed5ca47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hjve0txgHsVjW02rcOteew.gif"/></div></div></figure><p id="e363" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用React Native，您可以使用JavaScript作为主要编程语言来构建各种跨平台的应用程序屏幕。一个这样的应用程序屏幕功能是上传照片，这是社交媒体应用程序中非常常见的功能。将照片上传到Firebase存储是React本机应用程序的常见做法，这些应用程序与Firebase进行了后端集成，例如我们的<a class="ae kw" href="https://www.instamobile.io" rel="noopener ugc nofollow" target="_blank"> React本机模板</a>。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/76455cfa48631660cab518f268853fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/0*yf0nKfK_YYGuXLbG.gif"/></div></figure><p id="5f2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，让我们构建一个演示应用程序，其中您将创建一个简单的屏幕，允许您使用图像拾取器从设备上运行的应用程序中拾取图像，并将其上传到Firebase云存储。第二个屏幕将显示这些图像。</p><h2 id="f4ec" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">入门指南</h2><p id="7cc1" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先创建一个新的react本地项目。从终端窗口运行以下命令。创建项目目录后，在其中导航并安装所需的依赖项。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="edf0" class="lc ld iq mb b gy mf mg l mh mi">npx react-native <br/>init uploadStorageDemo <br/>cd uploadStorageDemo <br/>yarn add react-native-progress react-native-image-picker</span></pre><p id="7f01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，本教程使用了高于<code class="fe mj mk ml mb b">0.60.x</code>的react-native版本。如果您使用的是低于该版本的版本，请确保寻求关于如何链接本教程中提到的库的本机二进制文件的指导。</p><p id="bb58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了遵循关于如何为每个移动平台配置<code class="fe mj mk ml mb b">react-native-image-picker</code>的说明，我强烈推荐你在这里浏览官方文档<a class="ae kw" href="https://github.com/react-native-community/react-native-image-picker/blob/master/docs/Install.md" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="00e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于iOS，一定要安装pods。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="ca4a" class="lc ld iq mb b gy mf mg l mh mi">cd ios/ &amp;&amp; pod install # after pods install cd ..</span></pre><h2 id="3db6" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">创建上传屏幕</h2><p id="e5eb" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">当前的演示应用程序将包含一个屏幕，帮助用户从设备的照片库中选择图像。现在，在<code class="fe mj mk ml mb b">src/screens/</code>目录下创建一个名为<code class="fe mj mk ml mb b">UploadScreen.js</code>的文件和下面的模拟代码片段。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="b53e" class="lc ld iq mb b gy mf mg l mh mi">import * as React from 'react';<br/>import { Text, View } from 'react-native';<br/><br/>export default function UploadScreen() {<br/>  return (<br/>    &lt;View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}&gt;<br/>      &lt;Text&gt;Upload!&lt;/Text&gt;<br/>    &lt;/View&gt;<br/>  );<br/>}</span></pre><p id="5c01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<code class="fe mj mk ml mb b">App.js</code>文件，导入<code class="fe mj mk ml mb b">AppTabs</code>。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="6ee6" class="lc ld iq mb b gy mf mg l mh mi">import React from 'react';<br/>import { StatusBar } from 'react-native';<br/>import UploadScreen from './src/screens/UploadScreen';<br/><br/>const App = () =&gt; {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;StatusBar barStyle="dark-content" /&gt;<br/>      &lt;UploadScreen /&gt;<br/>    &lt;/&gt;<br/>  );<br/>};<br/><br/>export default App;</span></pre><p id="e862" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，回到终端窗口，为您希望运行react的平台或操作系统构建react本地应用程序。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="dda2" class="lc ld iq mb b gy mf mg l mh mi"># for iOS<br/>npx react-native run-ios<br/><br/># for Android<br/>npx react-native run-android</span></pre><p id="9ae2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将在这个演示中使用iOS模拟器。打开模拟器的应用程序，您将看到以下输出。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/d7001650847a81a652aab89d305c2905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/0*ldELQg56wL8zaP6G.png"/></div></figure><h2 id="2a87" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">创建一个新的Firebase项目</h2><p id="f18f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要访问每个移动操作系统平台的Firebase凭证并将其配置为使用Firebase SDK，请从<a class="ae kw" href="http://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>创建一个新的Firebase项目，或者如果您已经可以访问控制台中的项目，可以跳过这一步。</p><p id="a8e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个新项目，如下所示。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/ecf6e48d539f4f481dffbd16d925dd33.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/0*pq3ItBWyacygZXZm.png"/></div></figure><p id="d6bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加Firebase项目的详细信息。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/6d3979448519962b29edb53440ff9a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/0*a-8ZwWWSMsIJxmZv.png"/></div></figure><p id="bb2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击“创建项目”按钮，您将被重定向到仪表板屏幕。您应该在仪表板上看到您新创建项目。</p><h2 id="1260" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">添加Firebase SDK以与本机应用程序反应</h2><p id="31ee" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">使用第5版或更低版本的<code class="fe mj mk ml mb b">react-native-firebase</code>，因为这是一个单一报告，所有Firebase依赖项都可以从一个单独的模块中获得，并在React Native应用程序中使用。但是，对于版本6，您必须基于您想要使用的Firebase特性来安装依赖项。例如，在当前应用程序中，要使用存储，您需要安装核心应用程序包和存储包。</p><p id="042a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如前所述，核心模块<code class="fe mj mk ml mb b">@react-native-firebase/app</code>始终是必需的。打开终端窗口安装这些依赖项。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="b123" class="lc ld iq mb b gy mf mg l mh mi">yarn add @react-native-firebase/app @react-native-firebase/storage</span></pre><h2 id="2cd7" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">将Firebase凭据添加到您的iOS应用程序中</h2><p id="371f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Firebase提供了一个<code class="fe mj mk ml mb b">GoogleService-Info.plist</code>文件，其中包含所有API密钥以及iOS设备验证正确的Firebase项目所需的其他凭据。</p><p id="e58b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要访问这些凭据，请返回“Firebase控制台”，并从Firebase项目的仪表板屏幕上，从侧面菜单打开“项目设置”。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/096e98088b1312b1b5ce8f19f2efe25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/0*4Y3B7fVT2lHz3L30.png"/></div></figure><p id="bb33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到“您的应用”部分，点击图标<code class="fe mj mk ml mb b">iOS</code>选择平台。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/29c382adce9fb607fa6ad283cd2e5ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*wYu-aS_uYz6aNlug.png"/></div></figure><p id="d8c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入申请详情并点击“注册应用程序”。然后下载<code class="fe mj mk ml mb b">GoogleService-Info.plist</code>文件，如下图所示。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/22328aae0fe1e4ddab1442a2b7ae8c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xj1Mu_LqBkTyzmP6.png"/></div></div></figure><p id="8502" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开Xcode，然后打开<code class="fe mj mk ml mb b">/ios/uploadStorageDemo.xcodeproj</code>文件。右键单击项目名称并选择选项-然后选择要添加到此项目中的适当文件。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/a77dbf2ece5f63898e4fe27bd22f22ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*LvnVYhjXH3vK61mG.png"/></div></figure><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/c1e360e7ef026ee3933d91e21073521e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jju0vPhXmRC-QiCh.png"/></div></div></figure><p id="b5dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，打开<code class="fe mj mk ml mb b">ios/uploadStorageDemo/AppDelegate.m</code>并添加以下标题。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="cb1a" class="lc ld iq mb b gy mf mg l mh mi">#import &lt;Firebase.h&gt;</span></pre><p id="d8c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mj mk ml mb b">didFinishLaunchingWithOptions</code>方法中，添加以下配置方法。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="0f8e" class="lc ld iq mb b gy mf mg l mh mi"><br/>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {<br/>    if ([FIRApp defaultApp] == nil) {<br/>      [FIRApp configure];<br/>    }</span></pre><p id="48d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到终端窗口安装吊舱。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="d874" class="lc ld iq mb b gy mf mg l mh mi">cd ios/ &amp;&amp; pod install # after pods are installed cd ..</span></pre><p id="f90b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行之前，确保构建了iOS应用程序。打开</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="683f" class="lc ld iq mb b gy mf mg l mh mi">npx react-native run-ios</span></pre><h2 id="eeb3" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">将Firebase凭据添加到您的安卓应用程序中</h2><p id="e55e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于Android应用程序，Firebase提供了一个<code class="fe mj mk ml mb b">google-services.json</code>文件，其中包含所有API密钥以及Android设备验证正确Firebase项目所需的其他凭据。</p><p id="3eb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到“您的应用”部分，点击图标<code class="fe mj mk ml mb b">Android</code>选择平台。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4918a10a00a121f346b5ba4d82a36e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*XbLzg2DLcfxaDwik.png"/></div></figure><p id="5981" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下载<code class="fe mj mk ml mb b">google-services.json</code>文件。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/d45da4dc126033e1764891e9cb89bb4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ChjIxuuu0ur6TCif.png"/></div></div></figure><p id="fe91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在将下载的JSON文件复制到React Native项目中的以下位置:<code class="fe mj mk ml mb b">/android/app/google-services.json</code>。打开<code class="fe mj mk ml mb b">android/build.gradle</code>文件，添加以下片段。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="bd07" class="lc ld iq mb b gy mf mg l mh mi">dependencies { // ... classpath 'com.google.gms:google-services:4.2.0' }</span><span id="4c91" class="lc ld iq mb b gy mv mg l mh mi">apply plugin: 'com.google.gms.google-services'</span></pre><p id="fbcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，确保你构建了安卓应用程序。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="e746" class="lc ld iq mb b gy mf mg l mh mi">npx react-native run-android</span></pre><h2 id="ead6" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">使用反应原生图像拾取器</h2><p id="ea85" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在这一部分，让我们开始构建应用程序。首先打开文件<code class="fe mj mk ml mb b">UploadScreen.js</code>并导入以下语句。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="fa32" class="lc ld iq mb b gy mf mg l mh mi">import React, { useState } from 'react';<br/>import {<br/>  View,<br/>  SafeAreaView,<br/>  Text,<br/>  TouchableOpacity,<br/>  StyleSheet,<br/>  Platform,<br/>  Alert,<br/>  Image<br/>} from 'react-native';<br/>import ImagePicker from 'react-native-image-picker';<br/>import storage from '@react-native-firebase/storage';<br/>import * as Progress from 'react-native-progress';</span></pre><p id="77e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在功能组件<code class="fe mj mk ml mb b">UploadScreen</code>内创建三个状态变量。第一个，<code class="fe mj mk ml mb b">image</code>将用于存储图像源的URI。然后，同一个URI将用于显示用户选择的图像，并将图像上传到Firebase云存储中。</p><p id="a309" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二个状态变量是<code class="fe mj mk ml mb b">uploading</code>，它将成为<code class="fe mj mk ml mb b">false</code>违约。这将跟踪图像是否上传到云存储中。</p><p id="f7ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第三个变量<code class="fe mj mk ml mb b">transferred</code>将跟踪图片上传的进度。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="9ce5" class="lc ld iq mb b gy mf mg l mh mi">export default function UploadScreen() {<br/>  const [image, setImage] = useState(null);<br/>  const [uploading, setUploading] = useState(false);<br/>  const [transferred, setTransferred] = useState(0);<br/><br/>  //...<br/>}</span></pre><p id="d22d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加一个名为<code class="fe mj mk ml mb b">selectImage</code>的助手方法，它将使用<code class="fe mj mk ml mb b">react-native-image-picker</code>从设备库中选择一个图像，并显示图像拾取器本身。此外，定义一个<code class="fe mj mk ml mb b">options</code>对象来设置最大宽度和高度以及默认路径等属性。</p><p id="7179" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个<code class="fe mj mk ml mb b">options</code>对象将作为<code class="fe mj mk ml mb b">ImagePicker.showPicker()</code>方法的第一个参数被传递，该方法将返回一个发送<code class="fe mj mk ml mb b">response</code>对象的回调。使用这个回调，可以设置图像状态变量的路径。</p><p id="07d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在官方文件<a class="ae kw" href="https://github.com/react-native-community/react-native-image-picker/blob/master/docs/Reference.md" rel="noopener ugc nofollow" target="_blank">这里</a>找到要传递的一整套选项。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="164c" class="lc ld iq mb b gy mf mg l mh mi">const selectImage = () =&gt; {<br/>  const options = {<br/>    maxWidth: 2000,<br/>    maxHeight: 2000,<br/>    storageOptions: {<br/>      skipBackup: true,<br/>      path: 'images'<br/>    }<br/>  };<br/>  ImagePicker.showImagePicker(options, response =&gt; {<br/>    if (response.didCancel) {<br/>      console.log('User cancelled image picker');<br/>    } else if (response.error) {<br/>      console.log('ImagePicker Error: ', response.error);<br/>    } else if (response.customButton) {<br/>      console.log('User tapped custom button: ', response.customButton);<br/>    } else {<br/>      const source = { uri: response.uri };<br/>      console.log(source);<br/>      setImage(source);<br/>    }<br/>  });<br/>};</span></pre><p id="1610" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">定义另一个名为<code class="fe mj mk ml mb b">uploadImage</code>的助手方法，它将把图像上传到云存储中。这个方法在默认情况下是异步的，所以让我们用<code class="fe mj mk ml mb b">async-await</code>语法。</p><p id="d483" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，当该方法触发时，将<code class="fe mj mk ml mb b">uploading</code>的值更新为真，将<code class="fe mj mk ml mb b">transferred</code>的值更新为0，以跟踪图像上传到存储器的进度。</p><p id="5679" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Firebase中的<code class="fe mj mk ml mb b">storage</code>可以触发图像上传。值得注意的是，<code class="fe mj mk ml mb b">filename</code>和使用<code class="fe mj mk ml mb b">putFile</code>的图像URI必须按照下述顺序作为参考传递。</p><p id="049f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图像上传到存储器后，使用react本地组件<code class="fe mj mk ml mb b">Alert</code>显示一个警告方法，并将状态变量设置为默认值，如下所示。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="fb19" class="lc ld iq mb b gy mf mg l mh mi">const uploadImage = async () =&gt; {<br/>  const { uri } = image;<br/>  const filename = uri.substring(uri.lastIndexOf('/') + 1);<br/>  const uploadUri = Platform.OS === 'ios' ? uri.replace('file://', '') : uri;<br/><br/>  setUploading(true);<br/>  setTransferred(0);<br/><br/>  const task = storage()<br/>    .ref(filename)<br/>    .putFile(uploadUri);<br/><br/>  // set progress state<br/>  task.on('state_changed', snapshot =&gt; {<br/>    setTransferred(<br/>      Math.round(snapshot.bytesTransferred / snapshot.totalBytes) * 10000<br/>    );<br/>  });<br/><br/>  try {<br/>    await task;<br/>  } catch (e) {<br/>    console.error(e);<br/>  }<br/><br/>  setUploading(false);<br/><br/>  Alert.alert(<br/>    'Photo uploaded!',<br/>    'Your photo has been uploaded to Firebase Cloud Storage!'<br/>  );<br/><br/>  setImage(null);<br/>};</span></pre><p id="1830" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是从这个功能组件返回的完整的JSX。你将在应用程序中显示的进度将以条形图的形式出现。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="d5d1" class="lc ld iq mb b gy mf mg l mh mi">export default function UploadScreen() {<br/>  //... rest of the code<br/><br/>  return (<br/>    &lt;SafeAreaView style={styles.container}&gt;<br/>      &lt;TouchableOpacity style={styles.selectButton} onPress={selectImage}&gt;<br/>        &lt;Text style={styles.buttonText}&gt;Pick an image&lt;/Text&gt;<br/>      &lt;/TouchableOpacity&gt;<br/>      &lt;View style={styles.imageContainer}&gt;<br/>        {image !== null ? (<br/>          &lt;Image source={{ uri: image.uri }} style={styles.imageBox} /&gt;<br/>        ) : null}<br/>        {uploading ? (<br/>          &lt;View style={styles.progressBarContainer}&gt;<br/>            &lt;Progress.Bar progress={transferred} width={300} /&gt;<br/>          &lt;/View&gt;<br/>        ) : (<br/>          &lt;TouchableOpacity style={styles.uploadButton} onPress={uploadImage}&gt;<br/>            &lt;Text style={styles.buttonText}&gt;Upload image&lt;/Text&gt;<br/>          &lt;/TouchableOpacity&gt;<br/>        )}<br/>      &lt;/View&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>}</span></pre><p id="2499" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是上述组件的完整样式。</p><pre class="ky kz la lb gt ma mb mc md aw me bi"><span id="1959" class="lc ld iq mb b gy mf mg l mh mi">const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center',<br/>    backgroundColor: '#bbded6'<br/>  },<br/>  selectButton: {<br/>    borderRadius: 5,<br/>    width: 150,<br/>    height: 50,<br/>    backgroundColor: '#8ac6d1',<br/>    alignItems: 'center',<br/>    justifyContent: 'center'<br/>  },<br/>  uploadButton: {<br/>    borderRadius: 5,<br/>    width: 150,<br/>    height: 50,<br/>    backgroundColor: '#ffb6b9',<br/>    alignItems: 'center',<br/>    justifyContent: 'center',<br/>    marginTop: 20<br/>  },<br/>  buttonText: {<br/>    color: 'white',<br/>    fontSize: 18,<br/>    fontWeight: 'bold'<br/>  },<br/>  imageContainer: {<br/>    marginTop: 30,<br/>    marginBottom: 50,<br/>    alignItems: 'center'<br/>  },<br/>  progressBarContainer: {<br/>    marginTop: 20<br/>  },<br/>  imageBox: {<br/>    width: 300,<br/>    height: 300<br/>  }<br/>});</span></pre><p id="187a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是你将要得到的输出。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/bcab687a846a73d428dc89f2abbf8107.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/0*2Gj71SiF0IPpLubz.gif"/></div></figure><p id="9d80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要验证映像是否存储在云存储中，请返回Firebase控制台仪表板，并转到存储部分。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/b1643521920b3304c6bc480e3aaed758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fpchxzTCFfcfo3fG.png"/></div></div></figure><h2 id="051c" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">结论</h2><p id="eb95" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">关于自定义进度条的更多信息，请参考<code class="fe mj mk ml mb b">react-native-progress</code>的<a class="ae kw" href="https://github.com/oblador/react-native-progress" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="0559" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ng">原载于2020年3月17日</em><a class="ae kw" href="https://www.instamobile.io/mobile-development/react-native-firebase-storage/" rel="noopener ugc nofollow" target="_blank"><em class="ng">https://www . insta mobile . io</em></a><em class="ng">。</em></p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h2 id="9486" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="eee9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kw" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">订阅我们的YouTube频道</strong> </a> <strong class="ka ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>