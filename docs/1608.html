<html>
<head>
<title>How to Add a Chat Feature to Your React Native App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将聊天功能添加到React原生应用中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-add-a-chat-feature-to-your-react-native-app-c75003eb820c?source=collection_archive---------6-----------------------#2020-04-06">https://javascript.plainenglish.io/how-to-add-a-chat-feature-to-your-react-native-app-c75003eb820c?source=collection_archive---------6-----------------------#2020-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ef6e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Instamobile，我们正在构建大量复杂的功能，以节省全球React本地开发人员的时间和精力。这些复杂的功能之一是聊天功能，这是当今几乎所有移动应用程序的必备功能。在本教程中，我们将学习如何用几行代码将React原生聊天添加到任何移动应用程序中。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/430b8955b4e193725159eb7a11b70510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hy_Pcv_WHcCppcoilQKLXQ.png"/></div></div></figure><p id="9b20" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">是的，我们正在谈论一个完全成熟的聊天功能，它与后端(数据库和存储)集成，并且是实时的。而且可以毫不费力地集成到任何React原生app中！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ln"><img src="../Images/2a37ad472cbb307398f0b4bd650c4616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PD6VOTaPzi7rJVZY.png"/></div></div></figure><p id="86fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">构建聊天功能极其复杂，尽管乍一看似乎很琐碎。只支持基本的文本聊天功能会让你的应用看起来不专业，如果没有发送视频、记录消息等功能，用户会非常失望。</p><p id="55e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里列出了每个React原生聊天应用应该具备的功能，这些功能在所有那些教你如何在10分钟内构建一个聊天应用的教程中从未被考虑过:</p><ul class=""><li id="169c" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">照片和视频信息</li><li id="81e5" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">音频消息</li><li id="71e4" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">一次发送多张照片/视频</li><li id="f49e" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">影像播放机</li><li id="11c7" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">可点击的URL</li><li id="26c1" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">全屏照片查看器</li><li id="9b1b" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">打字指示器</li><li id="2954" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">看到的状态</li><li id="f329" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">在线状态</li><li id="6594" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">群聊</li><li id="0eff" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">推送通知</li><li id="7fcb" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">深色模式</li><li id="8cbf" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">RTL和本地化</li><li id="1dbd" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">阻止用户(苹果公司要求)</li></ul><p id="9d78" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">相信我，这个清单还在继续。我们花了6个月的时间开发了我们的<a class="ae mc" href="https://www.instamobile.io/app-templates/react-native-chat-app-template/" rel="noopener ugc nofollow" target="_blank">成熟的聊天应用</a>，它仍然没有我们想要的所有功能。所以不，你不可能在10分钟内建立一个React原生聊天应用，如果你从零开始。</p><p id="8d82" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">幸运的是，我们在Instamobile的代码是高度模块化的，所以我们让我们的客户在几分钟内就可以非常容易地将聊天功能集成到任何React原生应用程序中。这适用于任何移动应用程序，不管他们使用的是什么后端系统。</p><p id="c03c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">魔住在<strong class="kt ir">的<em class="md">imchatsune</em>的</strong>组件中。该组件只需要一个通道作为输入，包装两个用户id，当显示在屏幕上时，它将启用全功能的React本地聊天功能。</p><p id="6768" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将介绍您需要遵循的步骤，以便正确显示两个给定用户之间的聊天屏幕。</p><h2 id="cb7a" class="me mf iq bd mg mh mi dn mj mk ml dp mm la mn mo mp le mq mr ms li mt mu mv mw bi translated">1.将您的应用程序链接到您的Firebase帐户</h2><p id="ddf0" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated">所有消息都存储在Firebase Firestore(一个数据库)中，不管您现有的后端是什么类型(AWS、MySQL、REST API、GraphQL等)。您只需要两个用户id就可以正确触发聊天功能，我们将向您展示如何让事情正常运行。</p><p id="5c1a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">除了消息之外，聊天还将被阻止的用户存储在Firestore中。这是苹果指南所要求的功能，没有它你就不能发布你的iOS应用。</p><p id="f972" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你还不熟悉Firebase，这里有你需要做的事情(如果你需要更多细节，查看我们的<a class="ae mc" href="https://www.instamobile.io/docs/documentation/firebase-integration/" rel="noopener ugc nofollow" target="_blank">综合文档</a>):</p><p id="a4b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在运行你的应用程序，确保一切正常。</p><h2 id="c804" class="me mf iq bd mg mh mi dn mj mk ml dp mm la mn mo mp le mq mr ms li mt mu mv mw bi translated">2.将核心/聊天文件夹添加到React本机应用程序中</h2><p id="c9d9" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated">所有与聊天相关的代码都存在于<strong class="kt ir"> <em class="md">内核/聊天</em> </strong>模块中。有趣的是，我们所有的<a class="ae mc" href="https://www.instamobile.io" rel="noopener ugc nofollow" target="_blank">应用程序模板</a>都使用这段代码来启用聊天功能。</p><p id="5a9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简单的复制粘贴这个文件夹到你的<strong class="kt ir"> <em class="md"> src </em> </strong>文件夹就大功告成了。此外，如果您想使用我们自己的本地化库和图标，您可能还想复制粘贴<strong class="kt ir"> <em class="md"> CoreAssets </em> </strong>和<strong class="kt ir"> <em class="md"> Translations </em> </strong>文件夹。</p><h2 id="346e" class="me mf iq bd mg mh mi dn mj mk ml dp mm la mn mo mp le mq mr ms li mt mu mv mw bi translated">3.将导航路径添加到IMChatScreen</h2><p id="427f" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated"><strong class="kt ir"> <em class="md"> IMChatScreen </em> </strong>是负责React本地聊天功能的组件。这是我们在<a class="ae mc" href="https://www.instamobile.io/app-templates/react-native-chat-app-template/" rel="noopener ugc nofollow" target="_blank">产品页面</a>上列出的每一项功能的入口。它显示用户界面，它连接到后端，它监听新消息，它显示照片&amp;视频采集器，它管理打字指示器，等等。</p><p id="b3d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，为了将聊天功能添加到React本机应用程序中，您需要让您的应用程序能够呈现这个屏幕。</p><p id="ee40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将假设您正在使用<strong class="kt ir"><em class="md">react-navigation</em></strong>库来处理屏幕转换。因此，只需将此屏幕(IMChatScreen)添加到您的一个导航器中。</p><p id="95fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"><em class="md">imchatsscreen</em></strong>住在<strong class="kt ir"><em class="md">src/Core/chat</em></strong>里。所以可以这样导入</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="d348" class="me mf iq nd b gy nh ni l nj nk">import { IMChatScreen } from '../Core/chat';</span></pre><p id="3fd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是一个示例，展示了在堆栈导航器中，您到IMChatScreen的路线可能是什么样子:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="210f" class="me mf iq nd b gy nh ni l nj nk">const HomeStack = createStackNavigator( { <br/>  Home: { screen: HomeScreen }, <br/>  ChatScreen: { screen: IMChatScreen }, <br/>  }, { <br/>  initialRouteName: 'Home', <br/>  initialRouteParams: { appStyles: AppStyles } <br/>});</span></pre><h2 id="6fd5" class="me mf iq bd mg mh mi dn mj mk ml dp mm la mn mo mp le mq mr ms li mt mu mv mw bi translated">4.显示聊天屏幕</h2><p id="f7f0" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated">现在一切都设置好了，你可以在React本地应用的任何地方显示聊天屏幕，只需导航到<strong class="kt ir"> <em class="md">聊天屏幕</em> </strong>路径。</p><p id="2c8e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是如何在两个用户之间显示聊天屏幕，并使用用户id作为这些用户的唯一标识符:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="0435" class="me mf iq nd b gy nh ni l nj nk">import { IMChatScreen } from '../Core/chat'; <br/>... </span><span id="aef1" class="me mf iq nd b gy nl ni l nj nk">const id1 = "1234"; <br/>const id2 = "5678"; </span><span id="f116" class="me mf iq nd b gy nl ni l nj nk">const otherUsers = [ <br/>  { id: id1 &lt; id2 ? id1 + id2 : id2 + id1, firstName: "Andrew" } <br/>]; <br/>const channel = { id: id1 + id2, participants: otherUsers, }; </span><span id="efeb" class="me mf iq nd b gy nl ni l nj nk">props.navigation.navigate('ChatScreen', { <br/>  channel, appStyles: AppStyles, <br/>});</span></pre><p id="3161" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样。这就是将聊天功能呈现到您自己的React本机应用程序中所需的全部内容。</p><p id="b5fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是一些观察结果:</p><ul class=""><li id="65fb" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">该代码将显示当前用户(id = 1234)和另一个用户(id = 5678)之间的聊天</li><li id="4401" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">频道ID总是两个用户ID的串联，按字母顺序排列(这样当两个用户互相交谈时，他们将拥有完全相同的频道ID)</li><li id="697f" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">正如你所看到的，我们假设有一个“聊天屏幕”导航路径已经集成在你的一个导航器(堆栈导航器，底部导航器等)中。)—因此，请确保在测试聊天之前将此导航路径添加到您的应用程序中。</li><li id="e5b5" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">所有的数据都将存储在Firebase Firestore中，不管你使用的是什么后端。所以在测试这段代码之前，请确保<a class="ae mc" href="https://www.instamobile.io/docs/documentation/firebase-integration/" rel="noopener ugc nofollow" target="_blank">你已经设置了你的Firebase账户</a>。<strong class="kt ir">是的，它可以在你现有的后端之外工作，可以是任何类型的(AWS，REST API，WordPress，MySQL等)</strong></li><li id="f59b" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">对于群组聊天，频道ID将只是您想要显示聊天屏幕的群组的频道ID。</li><li id="e350" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">您可以使用自定义AppStyles，以获得与您的应用程序UI匹配的正确颜色和字体</li><li id="88f2" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">无论您选择哪种后端，报告和阻止用户也可以开箱即用。它们将存储在Firestore的“报告”表中。</li></ul><h2 id="ec22" class="me mf iq bd mg mh mi dn mj mk ml dp mm la mn mo mp le mq mr ms li mt mu mv mw bi translated">5.测试您的集成</h2><p id="a8d0" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated">您可以开始在两个用户之间聊天。当然，您将测试该功能是否正常工作。</p><p id="43ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你也可以进入你的<a class="ae mc" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>，查看自动创建的Firestore表格:</p><ul class=""><li id="3342" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><strong class="kt ir">通道</strong> —用于存储所有消息及其元数据</li><li id="94df" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir"> channel_participations </strong> —这是存储聊天室和用户之间的关联，对于群聊来说极其重要</li><li id="162e" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir">报告</strong> —该表用于记录所有被阻止或报告的用户。</li></ul><h2 id="e706" class="me mf iq bd mg mh mi dn mj mk ml dp mm la mn mo mp le mq mr ms li mt mu mv mw bi translated">结论</h2><p id="a5bf" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated">从头构建一个React原生聊天是极其痛苦的。这些功能非常复杂，性能非常关键，很难得到正确的，所需的总开发工作将超过6个月。</p><p id="e9c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，如今用户非常挑剔，对聊天室有很高的期望，因此合理的聊天功能所需的功能也非常多。</p><p id="2b38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">幸运的是，在Instamobile，我们已经建立了一个模块化的聊天功能，可以很容易地集成到任何React本机应用程序中。希望本教程能帮助我们所有的客户轻松地将聊天室添加到他们的应用程序中。</p><p id="e8ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你遇到困难或者React本地聊天教程中缺少了什么，请在评论中告诉我们。干杯！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="4803" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="md">原载于2020年4月6日</em><a class="ae mc" href="https://www.instamobile.io/mobile-development/react-native-chat/" rel="noopener ugc nofollow" target="_blank"><em class="md">https://www . insta mobile . io</em></a><em class="md">。</em></p></div></div>    
</body>
</html>