<html>
<head>
<title>Improve your Redux skills by writing custom middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过编写定制中间件来提高您的Redux技能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/improve-your-redux-skills-by-writing-custom-middleware-32a70b9dfb25?source=collection_archive---------7-----------------------#2020-02-15">https://javascript.plainenglish.io/improve-your-redux-skills-by-writing-custom-middleware-32a70b9dfb25?source=collection_archive---------7-----------------------#2020-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1d150c2eb7d01101f7d604484729423b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jp7VgQlaiPK-Rtwj.png"/></div></div></figure><p id="1baa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Redux是一个状态管理库，通常与React一起使用。在本文中，我将教您编写定制的中间件来扩展Redux的功能，并深入了解如何管理全局状态。</p><h1 id="a5cc" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Redux是什么？</h1><p id="b8e4" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果您知道Redux是什么，请随意跳到下一部分。Redux用于管理全局状态，最常见于React应用程序中。它通过存储一个全局的、<em class="lz">不可变的</em>状态对象来做到这一点，您可以通过<strong class="ka ir">reducer</strong>来修改它。缩减器是一个函数，它接受一个状态对象，一个<strong class="ka ir">动作</strong>(换句话说，事件)对象，并返回一个新的状态对象。动作对象描述了到底发生了什么以及状态应该如何改变。一个动作对象总是有一个<code class="fe ma mb mc md b">type</code>属性和可选的有效负载属性。为了更好地理解它，请看这个例子:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="4eda" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是中间件？</h1><p id="ffd6" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Redux中的中间件用于覆盖商店的行为，最常见的是<code class="fe ma mb mc md b">dispatch</code>函数。<code class="fe ma mb mc md b">redux-thunk</code>就是这样一个中间件。它允许您调度异步操作。另一个例子是<code class="fe ma mb mc md b">redux-logger</code>，它将每个动作和状态变化记录到控制台。</p><p id="5261" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">编写Redux自定义中间件的目的是以可重用和一致的方式实现一些高级功能。它应该简化您的开发体验，并清理您的代码。</p><h1 id="c2e4" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">编写Redux定制中间件</h1><p id="4bc6" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">当我在工作中遇到问题时，我想到了开发定制redux中间件的想法。我有一些特定的API请求，在任何特定的动作被分派的时候都会被发出。此外，另一个团队成员也有同样的问题。我决定开发一个中间件，允许你拦截某些动作并为它们提供回调。在本文中，我们将开发一个我们最终在生产中使用的中间件的稍微修改的版本。</p><p id="177f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">中间件的定义有点混乱。它应该是一个接收redux存储并返回一个接收回调<code class="fe ma mb mc md b">next</code>的函数，回调函数返回另一个接收redux动作并执行您需要的中间件特性的函数。不要担心，一会儿就都清楚了。首先，考虑这个简单的中间件，它简单地记录每个调度动作的类型:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="8b00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以注意到，在第2行，我们记录了动作的类型，并将动作传递给<code class="fe ma mb mc md b">next</code>。<code class="fe ma mb mc md b">next</code>如果没有更多的中间件，将操作管道化到下一个中间件或最初的分派。给<code class="fe ma mb mc md b">next</code>打电话至关重要，否则，你的行动将不会被派遣。顺序也很重要:任何在<code class="fe ma mb mc md b">next</code>之前的都将在动作被分派之前执行，任何在动作被分派之后的都将执行。</p><h1 id="be10" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">拦截动作</h1><p id="7858" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">是时候实现拦截功能了。为此，我们将编写另一个函数<code class="fe ma mb mc md b">createInterceptorMiddleware</code>，它将获取一个拦截器列表并返回中间件:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="1778" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在处理动作时，我们按类型过滤拦截器(第3行),并调用每个匹配的拦截器的处理程序。在第9–12行，拦截器数组被定义并传递给<code class="fe ma mb mc md b">createInterceptorMiddleware</code>。您可以注意到，我们也将<code class="fe ma mb mc md b">action</code>、<code class="fe ma mb mc md b">dispatch</code>和<code class="fe ma mb mc md b">getState</code>传递给处理程序，非常像redux-thunk。</p><h1 id="2788" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">支持异步处理程序</h1><p id="0719" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">虽然我们的中间件已经很有帮助了，但是让它支持处理程序的承诺还是很有用的，非常像redux-thunk。要实现这一点，我们只需在所有承诺都得到解决后调度操作。此外，在任何处理程序拒绝的情况下，该动作将不会被分派:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="aeea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该实现将支持异步处理程序，并将等待它们进行解析。在第6–7行，我们检查处理程序的返回类型，如果它不是一个承诺，我们就把它变成一个。您还可以注意到，我们在第5行使用了<code class="fe ma mb mc md b">map</code>而不是<code class="fe ma mb mc md b">forEach</code>，因为现在我们必须存储处理程序的返回值，以便<code class="fe ma mb mc md b">Promise.all</code>可以等待它们。一旦所有的承诺都被等待，第10行将分派动作，第11行将记录错误，如果任何承诺被拒绝，则不分派动作。</p><h1 id="6c77" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">支持调度后处理程序</h1><p id="3287" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我们当前的实现在分派动作之前触发处理程序<em class="lz">。为了增加对在分派动作后触发的处理程序的支持，我们将对处理程序本身做一点小小的改变:如果一个处理程序返回一个函数，这个函数将在分派后运行。这将为我们提供各种组合和复杂逻辑的灵活性:</em></p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="65a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该特性通过第12–17行实现。由于<code class="fe ma mb mc md b">Promise.all</code>将解析所有处理程序返回值的列表，我们遍历它并调用任何函数。要使用这个特性，处理程序应该返回一个函数，如第23-29行所示。</p><h1 id="5049" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">挂上去</h1><p id="0353" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">最后，您必须将您的中间件实际连接到商店。您可以通过将它传递给<code class="fe ma mb mc md b">applyMiddleware</code>函数来实现，该函数将返回一个增强器，该增强器需要传递给<code class="fe ma mb mc md b">createStore</code>函数:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="8af6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢您的阅读，希望您喜欢！把这个发给你的朋友/同事，看看我关于高级JavaScript的其他文章:</p><div class="mk ml gp gr mm mn"><a href="https://medium.com/javascript-in-plain-english/react-usememo-and-when-you-should-use-it-e69a106bbb02" rel="noopener follow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd ir gy z fp ms fr fs mt fu fw ip bi translated">React.useMemo以及何时应该使用它</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">尽管React经过了很好的优化，开箱即用，但了解它提供的制作工具非常重要…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">medium.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb jw mn"/></div></div></a></div><div class="mk ml gp gr mm mn"><a href="https://medium.com/javascript-in-plain-english/10-javascript-interview-questions-for-2020-697b40de9480" rel="noopener follow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd ir gy z fp ms fr fs mt fu fw ip bi translated">2020年10个JavaScript面试问题</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">随着对JS开发人员需求的增长，你必须做好准备。这里有10个问题可以帮助你…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">medium.com</p></div></div><div class="mw l"><div class="nc l my mz na mw nb jw mn"/></div></div></a></div><div class="mk ml gp gr mm mn"><a href="https://medium.com/javascript-in-plain-english/7-really-good-reasons-not-to-use-typescript-166af597c466" rel="noopener follow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd ir gy z fp ms fr fs mt fu fw ip bi translated">不使用TypeScript的7个非常好的理由</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">有很多理由使用TypeScript，但我会给你7个不使用的理由。</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">medium.com</p></div></div><div class="mw l"><div class="nd l my mz na mw nb jw mn"/></div></div></a></div><figure class="me mf mg mh gt jr gh gi paragraph-image"><a href="http://eepurl.com/gYiA29"><div class="gh gi ne"><img src="../Images/446049aa060bbaea15a64e1a907b1030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*zWeFS3E1gbkEuBmpbvm6Rg.jpeg"/></div></a></figure></div></div>    
</body>
</html>