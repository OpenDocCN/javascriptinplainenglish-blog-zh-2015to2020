<html>
<head>
<title>Node.js Best Practices — Caching and REST</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js最佳实践—缓存和REST</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-best-practices-caching-and-rest-e678c92fe121?source=collection_archive---------4-----------------------#2020-09-02">https://javascript.plainenglish.io/node-js-best-practices-caching-and-rest-e678c92fe121?source=collection_archive---------4-----------------------#2020-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0e11dd185ed63aceec2610cd35eb4538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9_xWXBKYPeWlD1K5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@mrthetrain?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joshua Hoehne</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8497" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="231a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Redis启用缓存</h1><p id="8cca" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Redis启用缓存来加速我们的Express应用程序。</p><p id="4348" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以通过运行以下命令来安装Redis:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fb2d" class="mn lc iq mj b gy mo mp l mq mr">apt update<br/>apt install redis-server</span></pre><p id="4cf9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe ms mt mu mj b">/etc/redis/redis.conf</code>我们改变:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8271" class="mn lc iq mj b gy mo mp l mq mr">supervised no</span></pre><p id="788b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">收件人:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4937" class="mn lc iq mj b gy mo mp l mq mr">supervised systemd</span></pre><p id="009e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么Redis将在Systemd下运行。</p><p id="b68c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们重新启动Redis以使更改生效:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a1c5" class="mn lc iq mj b gy mo mp l mq mr">systemctl restart redis<br/>systemctl status redis</span></pre><p id="f416" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们通过运行以下命令来安装redis NPM模块:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="290c" class="mn lc iq mj b gy mo mp l mq mr">npm i redis</span></pre><p id="58e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1cf4" class="mn lc iq mj b gy mo mp l mq mr">const express = require('express')<br/>const app = express()<br/>const redis = require('redis')<br/>​<br/>const redisClient = redis.createClient(6379)<br/>​<br/>async function getData(req, res, next) {<br/>  try {<br/>    //...<br/>    redisClient.setex(id, 3600, JSON.stringify(data))<br/>    res.status(200).send(data)<br/>  } catch (err) {<br/>    console.error(err)<br/>    res.status(500)<br/>  }<br/>}<br/>​<br/>function cache (req, res, next) {<br/>  const { id } = req.params<br/>​<br/>  redisClient.get(id, (err, data) =&gt; {<br/>    if (err) {<br/>      return res.status(500).send(err)<br/>    }<br/>    if (data !== null) {<br/>      return res.status(200).send(data)<br/>    }<br/>    next()<br/>  })<br/>}<br/>​<br/>​<br/>app.get('/data/:id', cache, getData)<br/>app.listen(3000, () =&gt; console.log(`Server running on Port ${port}`))</span></pre><p id="700d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用Redis客户端的节点应用程序来创建Redis客户端。</p><p id="e52c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建<code class="fe ms mt mu mj b">cache</code>中间件，如果Redis缓存存在的话，它从Redis缓存中获取数据。</p><p id="03c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果Redis存在，我们就从它发送响应数据。</p><p id="134d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果不是，那么我们调用我们的<code class="fe ms mt mu mj b">getData</code>路由中间件从数据库中获取数据。</p><p id="998f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是通过<code class="fe ms mt mu mj b">redisClient.setex</code>方法设置数据来完成的。</p><h1 id="3608" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">启用虚拟机/服务器范围的监控和日志记录</h1><p id="04df" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用各种工具实现服务器或虚拟机监控和日志记录。</p><p id="ab83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过这种方式，我们可以观察应用程序中出现的任何问题。</p><h1 id="b241" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">NODE_ENV的隐藏功能</h1><p id="6131" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe ms mt mu mj b">NODE_ENV</code>可以使我们的节点应用程序的性能有很大的不同。</p><p id="0b9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们将其设置为<code class="fe ms mt mu mj b">production</code>，则启用缓存，以便缓存数据。</p><p id="6dfc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不希望在开发中出现这种情况，因为我们总是希望看到最新的数据。</p><p id="3019" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">视图在生产中缓存，但不在开发节点中缓存。</p><p id="55f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用给定的<code class="fe ms mt mu mj b">NODE_ENV</code>运行它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f7d8" class="mn lc iq mj b gy mo mp l mq mr">NODE_ENV=&lt;environment&gt; node server.js</span></pre><p id="ca05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中<code class="fe ms mt mu mj b">server.js</code>是我们app的入口点。</p><p id="6ff5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着生产模式的开启，Express应用程序不会一直忙于处理Pug模板。</p><p id="3fbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于缓存，CPU可以自由地做其他事情。</p><p id="6ac2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过运行以下命令来设置<code class="fe ms mt mu mj b">NODE_ENV</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="94e1" class="mn lc iq mj b gy mo mp l mq mr">export NODE_ENV=production</span></pre><p id="c750" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Linux和Mac OS中。</p><p id="885f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Windows中，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3d15" class="mn lc iq mj b gy mo mp l mq mr">SET NODE_ENV=production</span></pre><p id="9cde" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以跑:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="aa9c" class="mn lc iq mj b gy mo mp l mq mr">NODE_ENV=production node my-app.js</span></pre><p id="471c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在所有平台中。</p><h1 id="0c4c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用HTTP方法和API路由</h1><p id="822b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该使用与REST约定相匹配的HTTP方法和API路由。</p><p id="b7b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><ul class=""><li id="ce6c" class="mv mw iq kf b kg kh kk kl ko mx ks my kw mz la na nb nc nd bi translated"><code class="fe ms mt mu mj b">POST /article</code>或<code class="fe ms mt mu mj b">PUT /article:/id</code>创建新文章</li><li id="4f89" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">GET /article</code>检索文章列表</li><li id="4975" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">GET /article/:id</code>检索文章</li><li id="51af" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">PATCH /article/:id</code>修改现有的<code class="fe ms mt mu mj b">articlerecord</code></li><li id="1eae" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">DELETE /article/:id</code>删除文章</li></ul><p id="19de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们通过ID得到，我们在最后有ID参数。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/f87f56908f098ea9ae584128c2fbf9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LsCVM05KkYTQNHCY"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@janpadilla?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jan Padilla</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="1bc5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="aa41" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">缓存并将NODE_ENV设置为<code class="fe ms mt mu mj b">production</code>可以加速我们的应用程序。</p><p id="eb14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">REST约定对于保持我们的API一致非常有用。</p><h2 id="2ee2" class="mn lc iq bd ld nk nl dn lh nm nn dp ll ko no np lp ks nq nr lt kw ns nt lx nu bi translated">简单英语的JavaScript</h2><p id="5226" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">寻找一切的链接plainenglish.io </strong> </a>！</p></div></div>    
</body>
</html>