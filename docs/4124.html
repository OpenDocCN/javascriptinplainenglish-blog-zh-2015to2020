<html>
<head>
<title>Understanding the Fetch API in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解JavaScript中的Fetch API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/understanding-the-fetch-api-in-javascript-585913cf2a80?source=collection_archive---------6-----------------------#2020-11-18">https://javascript.plainenglish.io/understanding-the-fetch-api-in-javascript-585913cf2a80?source=collection_archive---------6-----------------------#2020-11-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a518" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过实例了解fetch API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f3ca5f2e3473890f1183c72bc3efc020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45wZCdnX2a2d337Ej-JUrQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image Created with ❤️️ By Mehdi Aoussiad.</figcaption></figure><h1 id="0643" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="66ba" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Fetch API提供了一个获取资源的接口。它用于发出Ajax请求，比如调用API、获取远程资源或从服务器获取HTML文件。</p><p id="5c97" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">对于任何使用过Ajax XHR的人来说，这似乎都很熟悉，但是新的API提供了更强大、更灵活的特性集。就个人而言，我更喜欢使用fetch，因为它用更简单的语法完成了我需要的一切。</p><p id="ff4b" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在本文中，我们将探索如何在JavaScript中使用fetch API。让我们开始吧。</p><h1 id="24e7" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">基本提取API语法</h1><p id="112f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在今天的文章中，我们将使用<a class="ae mo" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"> JSON占位符</a>来发出真正的API请求。</p><p id="4cfd" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">假设您想使用下面的URL从API获取一个帖子列表:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="315e" class="mu kw iq mq b gy mv mw l mx my">https://jsonplaceholder.typicode.com/posts</span></pre><p id="46ac" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">首先，您可以将它作为参数传递给<code class="fe mz na nb mq b"><strong class="lp ir">fetch()</strong></code>方法。看看下面的例子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9491" class="mu kw iq mq b gy mv mw l mx my">fetch('https://jsonplaceholder.typicode.com/posts');</span></pre><p id="7487" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">方法<code class="fe mz na nb mq b">fetch()</code>返回一个承诺。我们可以使用<code class="fe mz na nb mq b">then()</code>和<code class="fe mz na nb mq b">catch()</code>来处理API响应。让我们将响应记录到控制台。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="39b3" class="mu kw iq mq b gy mv mw l mx my">fetch('https://jsonplaceholder.typicode.com/posts').then(function (response) {<br/>	// The API call was successful!<br/>	console.log('success!', response);<br/>}).catch(function (err) {<br/>	// There was an error<br/>	console.warn('Something went wrong.', err);<br/>});</span></pre><p id="de58" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">如果您查看控制台中的响应，您会注意到<code class="fe mz na nb mq b">response.body</code>不是可用的JSON。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0bc03831551b1860148bf3f25975701e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*4ZWDivZIZMhYGQjwpxJl7w.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The console.</figcaption></figure><p id="92ac" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">因此，我们需要使用方法<code class="fe mz na nb mq b">json()</code>将其转换成JSON。看看下面的例子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d4b6" class="mu kw iq mq b gy mv mw l mx my">fetch('https://jsonplaceholder.typicode.com/posts').then(function (response) {<br/>	// The API call was successful!<br/>	return response.<strong class="mq ir">json()</strong>;<br/>}).then(function (data) {<br/>	// This is the JSON from our response<br/>	console.log(data);<br/>}).catch(function (err) {<br/>	// There was an error<br/>	console.warn('Something went wrong.', err);<br/>});</span></pre><p id="49ab" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">正如你在上面看到的，我们可以在一个链接的<code class="fe mz na nb mq b">then()</code>方法中处理实际的响应JSON，并用方法<code class="fe mz na nb mq b">catch()</code>处理错误。现在，如果我们查看控制台，我们可以在那里看到我们的帖子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b8ab1d6e7da13adc19b5b3212f4f0750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bs-lSYk3iR65nvbWi4qzxw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The console.</figcaption></figure><h1 id="fc2d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">提出其他请求类型</h1><p id="188b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">默认情况下，Fetch API发出<code class="fe mz na nb mq b">GET</code>请求。假设您想通过API发出一个<code class="fe mz na nb mq b">POST</code>请求来发布一篇新文章。</p><p id="0318" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">方法<code class="fe mz na nb mq b">fetch() </code>接受第二个参数，可以用来传入一个选项对象。看看下面的例子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="f511" class="mu kw iq mq b gy mv mw l mx my">fetch('https://jsonplaceholder.typicode.com/posts', {<br/>	method: 'POST'<br/>}).then(function (response) {<br/>	// The API call was successful!<br/>	if (response.ok) {<br/>		return response.json();<br/>	} else {<br/>		return Promise.reject(response);<br/>	}<br/>}).then(function (data) {<br/>	// This is the JSON from our response<br/>	console.log(data);<br/>}).catch(function (err) {<br/>	// There was an error<br/>	console.warn('Something went wrong.', err);<br/>});</span></pre><h1 id="ccbb" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">使用Fetch API设置标题</h1><p id="4a6e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">您可能需要做的另一件常见的事情是为您的请求设置标题和其他属性。这也可以通过options对象来完成。</p><p id="8423" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">看看下面的例子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e46f" class="mu kw iq mq b gy mv mw l mx my">fetch('https://jsonplaceholder.typicode.com/posts', {<br/>	method: 'POST',<br/>	body: 'title=' + encodeURIComponent('My awesome new article') + '&amp;body=' + encodeURIComponent('This is the text of my article'),<br/>	headers: {<br/>		'Content-Type': 'application/json'<br/>	},<br/>	referrer: 'no-referrer'<br/>}).then(function (response) {<br/>	// The API call was successful!<br/>	if (response.ok) {<br/>		return response.json();<br/>	} else {<br/>		return Promise.reject(response);<br/>	}<br/>}).then(function (data) {<br/>	// This is the JSON from our response<br/>	console.log(data);<br/>}).catch(function (err) {<br/>	// There was an error<br/>	console.warn('Something went wrong.', err);<br/>});</span></pre><p id="817d" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">您可以在<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters" rel="noopener ugc nofollow" target="_blank"> Mozilla开发者网络</a>上查看选项和值的完整列表。</p><h1 id="1d32" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">结论</h1><p id="e6e9" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">除IE之外，所有现代浏览器都支持fetch API。它可以在新的移动浏览器上运行，但可能无法在旧的浏览器上运行。然而，它使得获取、请求和提交数据变得更加容易。</p><p id="8631" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">感谢您阅读本文，希望您觉得有用。如果是这样，通过<a class="ae mo" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lp ir">订阅解码获得更多类似内容，我们的YouTube频道</strong> </a> <strong class="lp ir">！</strong></p><h1 id="5ac4" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">进一步阅读</h1><div class="ne nf gp gr ng nh"><a href="https://medium.com/javascript-in-plain-english/how-to-fetch-data-from-an-api-in-javascript-dccde83619b2" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">如何在JavaScript中从API获取数据</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">通过实例了解fetch API</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kp nh"/></div></div></a></div></div></div>    
</body>
</html>