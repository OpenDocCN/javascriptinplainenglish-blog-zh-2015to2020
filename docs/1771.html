<html>
<head>
<title>Solutions to Common JS Problems — Clipboard, Time and Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">常见JS问题的解决方案—剪贴板、时间和请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/solutions-to-common-js-problems-clipboard-time-and-requests-a79094462109?source=collection_archive---------14-----------------------#2020-04-20">https://javascript.plainenglish.io/solutions-to-common-js-problems-clipboard-time-and-requests-a79094462109?source=collection_archive---------14-----------------------#2020-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/098b4cd93460cd95f016f55b11f1956c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1NVyH3lN8mkMBfMr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@aronvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aron Visuals</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5edd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一些JavaScript问题经常出现。经常出现的问题包括DOM问题、字符串格式、数组等等。</p><p id="1673" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们看看如何用JavaScript解决我们在web开发中遇到的常见问题。</p><h1 id="ba07" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">如何得到两个日期的差值(天数)？</strong></h1><p id="89a0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以将<code class="fe me mf mg mh b">Date</code>对象转换成时间戳，然后减去时间戳，再转换成天数。</p><p id="a7dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们创建以下函数:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c131" class="mq lc iq mh b gy mr ms l mt mu">const diffDays = (dateInitial, dateFinal) =&gt;<br/>  (dateFinal - dateInitial) / (1000 * 3600 * 24);</span></pre><p id="0e12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码通过首先将日期转换成时间戳来减去日期。有了返回的以毫秒为单位的整数差值，我们可以用它除以<code class="fe me mf mg mh b">1000 * 3600 * 24</code>得到以天为单位的差值。</p><p id="05e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们这样称呼它时:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c833" class="mq lc iq mh b gy mr ms l mt mu">console.log(diffDays(new Date('2018-12-13'), new Date('2019-12-22')));</span></pre><p id="35a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到374。</p><h1 id="dd66" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">如何向给定的URL发出GET请求？</strong></h1><p id="be77" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Fetch API来发出GET请求。</p><p id="bcca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它来从JSON占位符API获取一个post:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c465" class="mq lc iq mh b gy mr ms l mt mu">(async () =&gt; {<br/>  const res = await fetch('https://jsonplaceholder.typicode.com/posts/1')<br/>  const post = await res.json();<br/>  console.log(post);<br/>})();</span></pre><p id="8e33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们会得到这样的结果:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b572" class="mq lc iq mh b gy mr ms l mt mu">{<br/>  "userId": 1,<br/>  "id": 1,<br/>  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",<br/>  "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"<br/>}</span></pre><p id="d7c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从控制台日志输出。</p><h1 id="5492" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何向给定的URL发出POST请求？</h1><p id="6eab" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们也可以用Fetch API来做这件事。</p><p id="7d3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以编写以下代码:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9f88" class="mq lc iq mh b gy mr ms l mt mu">(async () =&gt; {<br/>  const data = {<br/>    title: 'title',<br/>    body: 'body'<br/>  }<br/>  const res = await fetch('https://jsonplaceholder.typicode.com/posts', {<br/>    method: 'POST',<br/>    headers: {<br/>      'Content-Type': 'application/json',<br/>    },<br/>    body: JSON.stringify(data),<br/>  })<br/>  const post = await res.json();<br/>  console.log(post);<br/>})();</span></pre><p id="0c51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们用请求方法传入了一个额外的对象，这个对象就是<code class="fe me mf mg mh b">'POST'</code>。另外，我们的请求头在<code class="fe me mf mg mh b">headers</code>属性中，请求体在字符串化的<code class="fe me mf mg mh b">body</code>属性中。</p><h1 id="76d2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">如何将字符串复制到剪贴板？</strong></h1><p id="06c2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过创建一个textarea元素将一个字符串复制到剪贴板，用我们的字符串填充它，然后我们可以用<code class="fe me mf mg mh b">document.execCommand</code>方法运行<code class="fe me mf mg mh b">'copy'</code>命令。</p><p id="396f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们编写以下函数:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6454" class="mq lc iq mh b gy mr ms l mt mu">const copyStringToClipboard = (str) =&gt; {<br/>  const el = document.createElement('textarea');<br/>  el.value = str;<br/>  el.setAttribute('readonly', '');<br/>  el.style = {<br/>    position: 'absolute',<br/>    left: '-9999px'<br/>  };<br/>  document.body.appendChild(el);<br/>  el.select();<br/>  document.execCommand('copy');<br/>  document.body.removeChild(el);<br/>}</span><span id="cfb2" class="mq lc iq mh b gy mv ms l mt mu">copyStringToClipboard('foo')</span></pre><p id="b480" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们将textarea的值设置为<code class="fe me mf mg mh b">str</code>，这样我们就可以在运行<code class="fe me mf mg mh b">document.execCommand(‘copy’)</code>时复制<code class="fe me mf mg mh b">str</code>的值。</p><p id="de89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们将元素移出屏幕，这样用户就看不到它了。</p><h1 id="ea9e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">如何发现页面的浏览器选项卡是否被聚焦？</strong></h1><p id="9e36" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">document.hidden</code>属性来查看它是否被聚焦，所以我们可以直接否定它来检查它是否被聚焦。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/bc6e6d528aa8b976b45b5bcb5de93651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QDXotv2AfM8AS-JR"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@nickkarvounis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nick Karvounis</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="eeb4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">如何得到给定毫秒数的可读格式？</strong></h1><p id="5fa5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过下面的函数来实现:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="192a" class="mq lc iq mh b gy mr ms l mt mu">const formatDuration = ms =&gt; {<br/>  const time = {<br/>    day: Math.floor(ms / (1000 * 60 * 60 * 24)),<br/>    hour: Math.floor(ms / 60 * 60 * 24) % 24,<br/>    minute: Math.floor(ms / 1000 * 60) % 60,<br/>    second: Math.floor(ms / 1000) % 60,<br/>    millisecond: Math.floor(ms) % 1000<br/>  };<br/>  return Object.entries(time)<br/>    .filter(val =&gt; val[1] !== 0)<br/>    .map(([key, val]) =&gt; `${val} ${key}(s)`)<br/>    .join(', ')<br/>};</span></pre><p id="44de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们所做的只是将毫秒数除以一天、小时、分钟、秒和毫秒中的毫秒数。</p><p id="7f0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们删除所有对象条目中所有为零的1。</p><p id="3e1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们将它们全部连接在一起。</p><p id="10a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们可以通过如下调用来尝试一下:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9a92" class="mq lc iq mh b gy mr ms l mt mu">console.log(formatDuration(3432545574))</span></pre><p id="d556" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="076f" class="mq lc iq mh b gy mr ms l mt mu">39 day(s), 34 minute(s), 5 second(s), 574 millisecond(s)</span></pre><h1 id="5cd7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">等待后如何调用提供的函数(以毫秒计)？</strong></h1><p id="5f8f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">setTimeout</code>函数在给定的时间后运行一些东西。</p><p id="d343" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以做一个<code class="fe me mf mg mh b">delay</code>函数如下:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="775d" class="mq lc iq mh b gy mr ms l mt mu">const delay = (fn, wait, ...args) =&gt; setTimeout(fn, wait, ...args);</span></pre><p id="036d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过运行来调用它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="954b" class="mq lc iq mh b gy mr ms l mt mu">delay(<br/>  (text) =&gt; {<br/>    console.log(text);<br/>  },<br/>  1000,<br/>  'foo'<br/>);</span></pre><p id="c53e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们看到<code class="fe me mf mg mh b">'foo'</code>在一秒钟后被记录，因为我们有1000毫秒的延迟，我们将<code class="fe me mf mg mh b">'foo'</code>传递给<code class="fe me mf mg mh b">setTimeout</code>的第三个参数，该参数被传递给<code class="fe me mf mg mh b">setTimeout</code>的回调参数。</p><h1 id="5c0a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="dd82" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">setTimeout</code>运行延迟给定时间的功能。</p><p id="44b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">属性检查一个标签是否隐藏。</p><p id="86b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">document.execCommand('copy')</code>将从文本区复制文本。</p><p id="07a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过划分正确的数量来格式化时间戳，以获得天数、小时数、分钟数和秒数。</p><p id="633d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fetch API对于发出HTTP请求很有用。</p><h2 id="8ec3" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="daff" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物，表达对它们的喜爱:<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>——谢谢，继续学习！</p><p id="c9a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>