<html>
<head>
<title>How to Create, Download, and Upload Files in React Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React应用中创建、下载和上传文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-download-and-upload-files-in-react-apps-80893da4247a?source=collection_archive---------0-----------------------#2020-10-28">https://javascript.plainenglish.io/how-to-create-download-and-upload-files-in-react-apps-80893da4247a?source=collection_archive---------0-----------------------#2020-10-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="cb0b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">不需要服务器！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/9837ed8701959f733a698003da11d0e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S6iphQ3C3Z-q9psi"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@imandrewpons?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrew Pons</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7b39" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">用React构建的丰富的单页应用程序(spa)。JS、Angular和其他框架变得越来越流行。当SPA应用程序创建数据时，用户如何将数据作为文件下载到桌面？</p><p id="6d75" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上传工具:用户如何上传文件到React。在浏览器上进行处理的JS app？</p><p id="581f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">TL；博士:<a class="ae ks" href="https://jsfiddle.net/larrykluger/eo4dzptr/" rel="noopener ugc nofollow" target="_blank">一个工作反应。通过JSFiddle </a>的JS示例。</p><h1 id="3962" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">从应用程序创建和下载文件</h1><p id="64b3" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">对于大多数web应用程序，文件是从服务器下载的。<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="noopener ugc nofollow" target="_blank">Content-type</a></code> <strong class="kv io"> </strong>和<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition" rel="noopener ugc nofollow" target="_blank">Content-Disposition</a></code> <strong class="kv io"> </strong>头用于声明文件类型，并向浏览器建议应该如何处理文件，包括建议的文件名。</p><p id="3d44" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我们的例子中，我们希望在SPA中使用JavaScript创建或管理数据，然后允许用户将数据作为文件下载。不需要服务器！</p><p id="beb8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">以下是步骤:</p><h1 id="7ab0" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">选择并创建输出格式</h1><p id="9ac1" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">JavaScript变量和结构(对象和数组)以本机二进制格式处理。例如，考虑一个包含美国2020年选举摇摆州(宾夕法尼亚州、佛罗里达州、俄亥俄州、密歇根州、亚利桑那州、北卡罗来纳州、威斯康星州和爱荷华州)名称的JavaScript数组。数组在内存中的存储是特定于实现的:Firefox的数组内存布局可能与Chrome的不同。</p><p id="cc41" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要将swing states数组输出为文件，首先选择一种输出格式。您可以决定将状态输出为文本文件中的报告，每个状态一行。您可以选择使用逗号分隔值(CSV)格式。或者JSON，或者XML。所有这些格式都是文本格式。</p><p id="c282" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以选择二进制格式，比如通用二进制JSON ( <a class="ae ks" href="https://ubjson.org/" rel="noopener ugc nofollow" target="_blank"> UBJSON </a>)甚至Excel二进制文件格式。但是在JavaScript中很难操作二进制。我建议尽可能使用文本格式。</p><p id="9250" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，将原生JavaScript数据转换成所选的输出格式。</p><p id="7c3c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于JSON，使用<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" rel="noopener ugc nofollow" target="_blank">JSON.stringify</a></code> <strong class="kv io"> </strong>方法。我总是包含三到四个空格的缩进，以使输出可读。我认为能够轻松读取输出的价值超过了较大输出文件相对较低的成本。</p><p id="530d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">虽然JSON支持使用数组作为顶层对象，但是不建议<a class="ae ks" href="https://stackoverflow.com/a/3833393/64904" rel="noopener ugc nofollow" target="_blank">这样做。最好将JSON创建为包含数组的对象:<code class="fe mm mn mo mp b">{"states": ["Pennsylvania", "Florida", … ]}</code></a></p><p id="d495" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于CSV，有多个<a class="ae ks" href="https://stackoverflow.com/questions/14964035/how-to-export-javascript-array-info-to-csv-on-client-side" rel="noopener ugc nofollow" target="_blank"> JavaScript生成器实现</a>可用。XML也不难创建。但是如果您将它存储在DOM中，请记住，在将它写入文件之前，您需要将该结构转换为字符串。</p><p id="c139" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">每个标量变量(不是对象、数组或其他结构的变量)都必须有一个字符串表示形式，以便以后在读取文件时进行解析。这对于字符串、整数和实数来说是简单而明显的。</p><p id="3c5a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于任何其他类型的数据，您必须明确决定如何处理该数据类型。例如，JSON原生支持<code class="fe mm mn mo mp b">NULL</code>数据值。但是CSV没有:应该将<code class="fe mm mn mo mp b">NULL</code>值存储为空字符串、字符串<code class="fe mm mn mo mp b">"NULL"</code>、字符串<code class="fe mm mn mo mp b">"**NULL**"</code>还是其他什么？这是你的选择。XML通过<code class="fe mm mn mo mp b"><a class="ae ks" href="https://stackoverflow.com/questions/774192/what-is-the-correct-way-to-represent-null-xml-elements" rel="noopener ugc nofollow" target="_blank">xsi:nil</a></code>属性支持<code class="fe mm mn mo mp b">NULL</code>值。</p><p id="ce01" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">日期和日期时间JavaScript对象也是一个问题。一个常见的答案是使用ISO 8601标准将该值转换为文本，因为稍后可以对其进行解析以重新创建date对象。提示:记得考虑时区问题。</p><h1 id="413b" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">下载文件</h1><p id="7aea" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">有了HTML5，以前的一些复杂问题就消除了。例如，锚元素的<code class="fe mm mn mo mp b">download</code> <strong class="kv io"> </strong>属性很容易用来设置建议的文件名。模式是这样的:</p><ol class=""><li id="e9e9" class="mq mr in kv b kw kx kz la lc ms lg mt lk mu lo mv mw mx my bi translated">用户通过连接到JavaScript方法的按钮启动下载。</li><li id="24bc" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo mv mw mx my bi translated">数据被转换成输出格式。结果是一个字符串。</li><li id="2f3a" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo mv mw mx my bi translated">从字符串中创建一个<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank">Blob</a></code>。</li><li id="e3ad" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo mv mw mx my bi translated">使用<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL" rel="noopener ugc nofollow" target="_blank">URL.createObjectURL</a></code>方法从<code class="fe mm mn mo mp b">Blob</code>创建一个<code class="fe mm mn mo mp b">Object URL</code>。</li><li id="b2e6" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo mv mw mx my bi translated">隐藏锚元素的<code class="fe mm mn mo mp b">href</code> <strong class="kv io"> </strong>属性被设置为<code class="fe mm mn mo mp b">Object URL</code>。</li><li id="3728" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo mv mw mx my bi translated">锚元素的<code class="fe mm mn mo mp b">click</code>方法被调用。通常情况下，当用户点击元素时会调用<code class="fe mm mn mo mp b">click</code>方法。在这种情况下，我们以编程方式单击元素，因此用户只需在步骤1中启动下载。</li><li id="078d" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo mv mw mx my bi translated">在<code class="fe mm mn mo mp b">click</code>方法完成后，<code class="fe mm mn mo mp b">Object URL</code>可以被释放。</li></ol><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c121" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一个<a class="ae ks" href="https://jsfiddle.net/larrykluger/eo4dzptr/" rel="noopener ugc nofollow" target="_blank">工作反应。下面是通过JSFiddle </a>的JS示例。点击<strong class="kv io">结果</strong>标签。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ng nf l"/></div></figure><h1 id="bcc9" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">专业提示</h1><p id="a4b8" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">如果您正在下载应用程序的内部状态，以便将来可以上传和恢复它:</p><ul class=""><li id="b5bf" class="mq mr in kv b kw kx kz la lc ms lg mt lk mu lo nh mw mx my bi translated">使用JSON。</li><li id="6822" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo nh mw mx my bi translated">包括对象根级别的版本属性，以使数据格式能够在将来被更新，其中数据格式的版本容易被识别并被适当地解析。</li><li id="097d" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo nh mw mx my bi translated">不要试图“腌制”二进制格式的数据，将其转换为文本格式。</li><li id="1353" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo nh mw mx my bi translated">通过使用BASE64编码，图像或PDF文件等二进制数据可以存储在JSON数据结构中。</li></ul><h1 id="dc37" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">将文件上传到应用程序</h1><p id="e720" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们可以将文件上传到浏览器中运行的应用程序，而不是将文件上传到服务器。应用程序可以在本地处理该文件。如果需要，该应用程序还可以通过<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX" rel="noopener ugc nofollow" target="_blank"> Ajax </a>将文件上传到服务器。</p><p id="b308" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在你的应用程序中创建一个<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" rel="noopener ugc nofollow" target="_blank">文件输入元素</a>。在我的JSFiddle示例中，我通过一个带有我喜欢的按钮文本的按钮来触发input元素，但这不是必须的。</p><p id="57f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用input元素的<code class="fe mm mn mo mp b">multiple</code>属性来控制用户是否可以选择多个文件。使用<code class="fe mm mn mo mp b">accept</code>属性控制可以选择的文件类型。<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" rel="noopener ugc nofollow" target="_blank"> MDN文档</a>提供了关于设置这些属性的附加信息。</p><p id="5200" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将onChange <code class="fe mm mn mo mp b">attribute</code>设置为上传文件的处理方法。下面是文件输入元素和带注释的处理程序:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="ee6d" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">专业提示</h1><ul class=""><li id="505c" class="mq mr in kv b kw mh kz mi lc ni lg nj lk nk lo nh mw mx my bi translated">不要对上传文件的内容做任何假设。例如，有人可以将二进制文件或图像重命名为“data.json”。</li><li id="0287" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo nh mw mx my bi translated">在我的例子中，我使用的是<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsText" rel="noopener ugc nofollow" target="_blank">FileReader.readAsText</a></code>方法。新的<code class="fe mm mn mo mp b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob/text" rel="noopener ugc nofollow" target="_blank">Blob.text</a></code>方法也可以使用，但是它的浏览器支持不如<code class="fe mm mn mo mp b">FileReader</code>对象完整。</li></ul><h1 id="21ea" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">摘要</h1><p id="2dc1" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">从基于浏览器的代码中生成下载很容易。不需要涉及服务器！您的SPA应用程序可以生成和下载CSV文件、JSON数据、文本报告等等。</p><p id="7c59" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将文件上传到您的SPA应用程序也很容易。将文件下载和上传到SPA应用程序而不是远程服务器，可以为您的用户提供更快、更出色的用户体验。在你的下一个应用中尝试一下。</p><h1 id="7944" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">资源</h1><ul class=""><li id="5fe4" class="mq mr in kv b kw mh kz mi lc ni lg nj lk nk lo nh mw mx my bi translated">一个<a class="ae ks" href="https://jsfiddle.net/larrykluger/eo4dzptr/" rel="noopener ugc nofollow" target="_blank">工作反应。通过JSFiddle </a>的JS例子。</li><li id="964a" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo nh mw mx my bi translated">HTML5 <a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank">斑点</a></li><li id="ee32" class="mq mr in kv b kw mz kz na lc nb lg nc lk nd lo nh mw mx my bi translated">html 5<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL" rel="noopener ugc nofollow" target="_blank">URL . createobjecturl</a></li></ul></div></div>    
</body>
</html>