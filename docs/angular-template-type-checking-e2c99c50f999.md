# 角度模板类型检查

> 原文：<https://javascript.plainenglish.io/angular-template-type-checking-e2c99c50f999?source=collection_archive---------1----------------------->

在 Angular 9 中，引入了一个全新的模板类型检查模式，叫做`strictTemplates`。让我告诉你它是什么，为什么你应该启用它。

![](img/8f135b073bc6236e8a0618cf059291b1.png)

Picture courtesy of [Agence Olloweb](https://unsplash.com/@olloweb)

在本文中，我们将看到 Angular 9+的一个令人敬畏的新标志，您可以在将代码发布到产品之前启用并利用它来发现/修复问题。

# 什么是模板类型检查

当你写 TypeScript 代码时，你知道只要你搞砸了，编译器就会对你大喊大叫。忘记定义类型了？忘记提供参数了？忘记返回值了？别担心，编译器会支持你的。它不会找到所有的东西(因为编译只是故事的一部分)，但是它会帮助你发现代码中明显的问题。

现在，你们可能都没有意识到这一点，但是 Angular 把你的模板转换成了类型脚本代码，不管那些是单独的 HTML 文件还是单个文件组件的一部分。

当然，如果模板被转换成 TypeScript 代码，那么这些可以像代码库的其余部分一样进行类型检查。是不是很牛逼？

感谢模板类型检查，我们可以发现模板中嵌入的表达式的问题，并避免在运行时发现这些问题。

# 模板类型检查模式

对于 Angular 9，有三种不同的[模板类型检查](https://angular.io/guide/template-typecheck#template-type-checking)“模式”或“级别”:

*   基础
*   全部
*   严格的

你可以猜到，基本模式不是很严格，你可能会看到积极的一面:“嘿，别烦我”。这种模式的工作方式与 Angular 以前的版本基本相同；它将只检查模板中的顶级表达式(例如，您使用的字段和属性存在于组件类中)。老实说，这种级别的类型检查真的是*弱*。当`fullTemplateTypeCheck`标志被设置为`false`时，基本模式被启用。

如果你启用了“完整”模式，那么 Angular 会更加小心，它还会检查管道和嵌入视图(当你使用 ngIf、ngFor、ng-template 等工具时创建的)。总的来说，这种模式提供了额外的安全性，但是谁喜欢折中的方法呢？要启用它，将`fullTemplateTypeCheck`标志设置为`true`。

最后，新的“严格”模式强制执行完整的模板类型检查，并在构建时捕获更多的错误。在严格模式下，启用“完整”模式检查，此外，还会检查更多内容:

*   组件绑定和可分配性(服从 TypeScript 的`strictNullChecks`标志)
*   组件和指令的类型(包括泛型！)
*   上下文类型(例如，允许对循环进行全面的类型检查)
*   组件、指令、DOM &动画绑定的事件对象(即`$event`
*   对 DOM 元素的引用类型
*   安全导航表达
*   (可能更多)

在 Angular 9 之前，我们需要启用/使用 [AOT](https://angular.io/guide/aot-compiler) 模式来受益于额外的类型检查。现在，简单多了，也快多了。

要启用严格模式，只需将`strictTemplates`标志设置为`true`。

请注意，这些标志是在您的“tsconfig.json”文件中配置的:

此外，我真的建议您启用 TypeScript 的严格模式，但那是另外一个故事了。

# 严格还是不严格？

那么应该使用哪种模板类型检查模式呢？

如果你经常阅读我的博客或推特，你可能已经知道答案了:当然是严格模式！在任何情况下，严格模式很可能会成为 Angular 10 的默认模式！

事实上，根据你的项目，你可能需要一步一步地增加严格性，在进行过程中解决暴露出来的问题。

问题是，对于一个大型项目，修复类型检查器发现的错误可能需要一段时间。对于 TypeScript 的严格模式，情况也是如此。

但是对于新的/年轻的项目，这真的很简单:从一开始就为 Angular 和 TypeScript 启用最严格的模式！

顺便说一句，Angular 团队已经写了一份很好的指南来帮助你[解决模板错误](https://angular.io/guide/template-typecheck#troubleshooting-template-errors)。正如该指南所指出的，您可以禁用特定的严格检查，而不是完全禁用严格类型检查，这样您就可以“大部分”保持在严格模式下，同时仍然受益于其他严格检查。也就是说，直到你能够回到完全成熟的严格模式。

查看官方文档，获取受支持的严格模式标志的完整列表。

# 利益

对我来说，好处是显而易见的:你越早发现潜在的错误，你的最终用户就会越高兴，无论如何。

您不仅交付了质量更好的软件(作为一名软件工匠，这应该让您感觉良好)，而且最终，您还节省了时间，避免了生产中不必要的压力。

由于更好的类型检查而节省的时间可以用于交付更多的商业价值，这比半夜醒来修复编译器可能已经注意到的东西要有回报得多。

任何可以在构建时捕获的东西都应该被捕获；任何做不到的事情都应该被自动化测试发现。其余的应该由代码审查来捕捉。说够了；-)

# 结论

在本文中，我快速介绍了 Angular 9 支持的不同模板类型检查模式，包括令人惊叹的新“严格”模式。

我也试图说服你尽快启用严格模式。如果你已经读到这里，请不要让我失望；继续并立即启用它。我很好奇它为你的代码库:D 捕捉了多少错误

今天到此为止！

# 喜欢这篇文章吗？

如果你想了解关于软件/Web 开发、TypeScript、Angular、React、Vue、Kotlin、Java、Docker/Kubernetes 和其他很酷的主题的大量其他很酷的东西，那么不要犹豫[拿一本我的书](https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL)并订阅[我的简讯](https://mailchi.mp/fb661753d54a/developassion-newsletter)！