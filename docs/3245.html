<html>
<head>
<title>Introduction to React Context API with Firebase Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase身份验证的React上下文API简介</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-react-context-api-with-firebase-authentication-92a6a3cf116d?source=collection_archive---------5-----------------------#2020-09-13">https://javascript.plainenglish.io/introduction-to-react-context-api-with-firebase-authentication-92a6a3cf116d?source=collection_archive---------5-----------------------#2020-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2175" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好！今天的文章将是对React Context API的初学者介绍，因为我注意到这个概念对于React初学者来说很难掌握。我将使用Firebase身份验证来演示使用React上下文API的好处。我们开始吧！</p><p id="86ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">遵循本教程的一些先决条件:</strong></p><ul class=""><li id="6777" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">对React(即道具、状态等)有基本的了解。)</li><li id="810c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">对Firebase了解不多(但更多的知识会有所帮助)</li></ul><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/b45740b8db4076f3d4770565597801f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*krXv1sr5uJ3tdhRv_b-low.png"/></div></div></figure><h1 id="b2a4" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">什么是React上下文API？</h1><p id="cc5c" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">通常在React中，我们将名为<code class="fe mo mp mq mr b">props</code>的东西从父组件传递给它的子组件。React应用程序由组件组成，许多组件具有父子关系，因此应用程序的简单可视化如下所示:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/0d620687174a2eb78d56959aa6bc7392.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/0*csbF39AaBbTjzAeb"/></div></figure><p id="d7ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数时候，我们只需要从父代传递到子代，所以使用通常的<code class="fe mo mp mq mr b">state</code>和<code class="fe mo mp mq mr b">props</code>就足够了。但是如果我们需要将一个<code class="fe mo mp mq mr b">prop</code>传递给许多组件呢？即使是那些深深嵌套或在另一棵树上的？</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mt"><img src="../Images/fb5341a7bf7daf79590b5e7070fdc2c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BLSzb05q7SJMU34P.png"/></div></div></figure><p id="b698" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这样的</strong> <code class="fe mo mp mq mr b"><strong class="jp ir">props</strong></code> <strong class="jp ir">的例子有:</strong></p><ul class=""><li id="48cb" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">用户的首选语言</li><li id="461d" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">用户选择的应用程序的主题或配色方案</li><li id="a3bf" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">经过身份验证的用户的属性</li></ul><p id="4ded" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，必须手动将<code class="fe mo mp mq mr b">prop</code>传入传出每个组件将会非常繁琐！这就是所谓的支柱钻探。因此，React Context API来拯救我们了。根据他们的官方文件，</p><p id="b7b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu"> React上下文API提供了将属性传递给子组件的能力，而无需手动传递。</em></p><p id="0191" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在我们知道它是什么，何时需要使用它。</p><p id="7b00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在将展示一个使用<strong class="jp ir"> Firebase认证</strong>的简单例子。我们需要使用上下文API，因此我们不必手动将经过身份验证的用户属性传递给每个子组件。让我们看看这是如何工作的。</p><h1 id="fa07" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤1:创建一个Firebase项目</h1><p id="01e6" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">前往<a class="ae mv" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">firebase.google.com</a>创建一个新项目。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mw"><img src="../Images/b793e0fbc4bbd23caac199648f647d14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DnNpvgMx6pzqSUBF"/></div></div></figure><p id="bbd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在仪表板上，单击Web图标为Web应用程序初始化Firebase。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mx"><img src="../Images/7dc0c51ac919feae2a314c8dd372bc06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SPC_b5QEGWEcDoXF"/></div></div></figure><p id="0797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照Firebase的步骤，您将到达一个显示配置变量的页面。这很重要，所以复制并保存在某个地方。我们很快就会用到它。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi my"><img src="../Images/f3fff643a63d1564ccfa42d2584868ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uilNhkAt8vOGv3rB"/></div></div></figure><h1 id="4f5f" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤2:设置Firebase身份验证</h1><p id="a8ad" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">如下图所示，前往认证。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mz"><img src="../Images/9af640f697a65d2dd1fd158d47bd6e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XEsLRbe4iQl5bba3"/></div></div></figure><p id="bc52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以设置app的登录方式。以我为例，我将启用<strong class="jp ir">谷歌、电子邮件和脸书。</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi na"><img src="../Images/167532ecde1c87ae9c0c9f2a5ef44876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ygI3goH92DhH8OVO"/></div></div></figure><h1 id="c991" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">脸书登录设置</h1><p id="fd7c" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">对于谷歌和电子邮件认证，你只需按下切换按钮，使其成为一种登录方式。对于脸书，你需要有一个<strong class="jp ir">脸书开发者账户</strong>来设置它。</p><blockquote class="nb nc nd"><p id="f27e" class="jn jo mu jp b jq jr js jt ju jv jw jx ne jz ka kb nf kd ke kf ng kh ki kj kk ij bi translated"><em class="iq">这是可选的，因此如果您不打算使用脸书作为身份验证方法，请跳到步骤3。</em></p></blockquote><p id="6682" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前往<a class="ae mv" href="https://developers.facebook.com/" rel="noopener ugc nofollow" target="_blank">developers.facebook.com</a>创建一个开发者账户</p><p id="2b5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后创建一个新项目，您将看到这个页面。转到<strong class="jp ir">设置&gt;基本</strong>。复制你的应用ID和应用密码。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nh"><img src="../Images/c853771b665ad097da7209fd519ac186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*avfsFBTiFjCWjZIx"/></div></div></figure><p id="109f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在回到Firebase并相应地粘贴它们。同时，复制如下图所示的url。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ni"><img src="../Images/4466d6a4001a6bbce95b206dd47707f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1nH2Y2wRUuI2-Yyo"/></div></div></figure><p id="f6c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到开发人员的脸书，在“添加产品”下，找到一个名为<strong class="jp ir">脸书的产品，登录</strong>，点击<strong class="jp ir">“设置”</strong>按钮。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nj"><img src="../Images/a6c99fd49d096d9761d0994236b55498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*20_24RNtI6p_Puyz"/></div></div></figure><p id="0ced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将你从Firebase复制的url粘贴到下图所示的字段中，然后点击<strong class="jp ir">‘保存更改’</strong>。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nk"><img src="../Images/eda36cb5c544992b6b755b03c4a2eecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UnLFKUOHi5Ix1Sw6"/></div></div></figure><p id="c0e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，前往<strong class="jp ir">脸书登录&gt;快速启动</strong>并输入你网站的网址。在我的情况下，这只是一个测试应用程序，所以网址是<code class="fe mo mp mq mr b">http://localhost:3000</code>。点击<strong class="jp ir">‘保存’</strong>就大功告成了！</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nl"><img src="../Images/b917eeb79032d495e0e3cae1eef8be91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PVBXhx8JxKvmTAR7"/></div></div></figure><p id="1939" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你的用户现在可以使用脸书在你的应用中进行身份验证。</p><h1 id="4999" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤3:设置React项目</h1><p id="9c07" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在我们的3种登录方式(即谷歌、电子邮件和脸书)的Firebase身份验证完成后，让我们设置React项目，以便能够使用Firebase。</p><p id="0b95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们项目的根目录中，运行:</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="d25a" class="nq lm iq mr b gy nr ns l nt nu">npm install firebase react-firebaseui</span></pre><ul class=""><li id="dc5f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe mo mp mq mr b">firebase</code>包含在React应用中设置firebase所需的工具和基础设施。</li><li id="3cda" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><code class="fe mo mp mq mr b">react-firebaseui</code>提供预制组件来轻松处理和显示身份验证。</li></ul><h1 id="09bd" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤4: Firebase配置</h1><p id="2a88" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在React App的<code class="fe mo mp mq mr b">src</code>文件夹中创建一个<strong class="jp ir">‘Firebase’</strong>文件夹，在里面创建一个名为<code class="fe mo mp mq mr b">config.js</code>的文件。这是我们粘贴第一步中的配置变量的地方。如果你忘记复制它，你总是可以从你的Firebase <strong class="jp ir">项目设置</strong>中找到你的配置变量(见下图)。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e4715e7423133684ed5319c9182a5416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/0*cUK0uIJnDHTCCi9U"/></div></figure><p id="eaa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mo mp mq mr b">Firebase/config.js</code>中，我们将做3件事:</p><ol class=""><li id="41cd" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk nw kr ks kt bi translated">导入依赖项</li><li id="c4e3" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk nw kr ks kt bi translated">使用<code class="fe mo mp mq mr b">firebase.initializeApp(config)</code>创建一个Firebase应用程序实例</li><li id="4cb4" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk nw kr ks kt bi translated">导出此应用程序以供使用，我们将很快看到</li></ol><p id="950b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在代码中，它应该类似于:</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="48d6" class="nq lm iq mr b gy nr ns l nt nu">//1. import the dependencies<br/>import * as firebase from "firebase";<br/>import "firebase/auth";<br/><br/>//2. Initialize app with the config vars<br/>const app = firebase.initializeApp({<br/>  apiKey: process.env.REACT_APP_API_KEY,<br/>  authDomain: process.env.REACT_APP_AUTH_DOMAIN,<br/>  databaseURL: process.env.REACT_APP_DATABASE_URL,<br/>  projectId: process.env.REACT_APP_PROJECT_ID,<br/>  storageBucket: process.env.REACT_APP_STORAGE_BUCKET,<br/>  messagingSenderId: process.env.REACT_APP_MESSAGING_SENDER_ID,<br/>});<br/><br/>//3. export it for use<br/>export default app;</span></pre><h1 id="4119" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤5: Firebase上下文</h1><p id="5113" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">现在让我们使用上下文API来创建一个Firebase上下文。在<code class="fe mo mp mq mr b">Firebase</code>文件夹中，添加名为<code class="fe mo mp mq mr b">context.js</code>的新文件。</p><p id="80a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将执行以下操作:</p><ol class=""><li id="d88a" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk nw kr ks kt bi translated">从<code class="fe mo mp mq mr b">config.js</code>导入React依赖项和<strong class="jp ir">应用程序</strong></li><li id="eff9" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk nw kr ks kt bi translated">使用<code class="fe mo mp mq mr b">React.createContext()</code>创建并导出一个名为<code class="fe mo mp mq mr b">AuthContext</code>的React上下文</li><li id="bdc4" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk nw kr ks kt bi translated">创建并导出包含React上下文提供者的<code class="fe mo mp mq mr b">AuthProvider</code>。</li></ol><p id="551a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个上下文对象都有一个<strong class="jp ir">提供者</strong>，允许其他组件使用它的上下文。在这种情况下，我们的<code class="fe mo mp mq mr b">AuthProvider</code>将向其他组件提供<code class="fe mo mp mq mr b">user</code>的状态。这样，我们应用程序中的任何组件都可以确定用户是否已经登录并访问用户的属性。</p><p id="c94a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe mo mp mq mr b">useState</code>钩子将<code class="fe mo mp mq mr b">user</code>状态初始化为null，并使用<code class="fe mo mp mq mr b">useEffect</code>钩子和Firebase的<code class="fe mo mp mq mr b">auth().onAuthStateChanged(setUser)</code>进行更新。</p><p id="fd6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mo mp mq mr b">onAuthStateChanged</code>基本上是一个观察器，监听认证的变化。这样，无论用户何时登录或退出，我们的<code class="fe mo mp mq mr b">user</code>状态都会在我们的<code class="fe mo mp mq mr b">AuthProvider</code>中自动更新。</p><p id="d5b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码如下所示:</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="6abe" class="nq lm iq mr b gy nr ns l nt nu">//1.<br/>import React, { useEffect, useState } from "react";<br/>import app from "./config";<br/><br/>//2.<br/>export const AuthContext = React.createContext();<br/><br/>//3.<br/>export const AuthProvider = ({ children }) =&gt; {<br/>  const [user, setUser] = useState(null);<br/><br/>  useEffect(() =&gt; {<br/>    app.auth().onAuthStateChanged(setUser);<br/>  }, []);<br/><br/>  return (<br/>    &lt;AuthContext.Provider value={{ user }}&gt;{children}&lt;/AuthContext.Provider&gt;<br/>  );<br/>};</span></pre><h1 id="ee29" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤6:将AuthProvider导入App.js</h1><p id="547f" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">现在，我们可以将<code class="fe mo mp mq mr b">AuthProvider</code>导入到<strong class="jp ir"> App.js </strong>中，并将所有组件放入其中。这样，它可以将上下文传递给应用程序中的任何组件(因为它是组件树的顶层节点)。</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="3e15" class="nq lm iq mr b gy nr ns l nt nu">import { AuthProvider } from "./Firebase/context";<br/><br/>function App() {<br/>  return (<br/>    &lt;AuthProvider&gt;<br/>      &lt;Router&gt;<br/>        &lt;div className="App"&gt;<br/>          &lt;Nav /&gt;<br/>          &lt;Switch&gt;<br/>            &lt;Route path="/signin" exact component={SignIn} /&gt;<br/>          &lt;/Switch&gt;<br/>        &lt;/div&gt;<br/>      &lt;/Router&gt;<br/>    &lt;/AuthProvider&gt;<br/>  );<br/>}</span></pre><h1 id="a489" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">步骤7:登录组件</h1><p id="5d35" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">我们创建了一个<strong class="jp ir"> SignIn.js </strong>来显示登录按钮，供用户登录我们的应用程序。从上面的<strong class="jp ir"> App.js </strong>代码可以看出，我的应用程序将在路径<code class="fe mo mp mq mr b">/signin</code>呈现签到组件。</p><p id="b3d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mo mp mq mr b">Nav</code>组件中有一个“签到/注册”按钮，点击后链接到<code class="fe mo mp mq mr b">/signin</code>路径，显示签到按钮。这之后我们再来看我们的<strong class="jp ir"> Nav.js </strong>。</p><p id="253d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们的登录组件将导入以下内容:</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="8a81" class="nq lm iq mr b gy nr ns l nt nu">import React, { useContext } from "react";<br/>import "../App.css";<br/>import firebase from "firebase";<br/>import { FirebaseAuth } from "react-firebaseui";<br/>import { AuthContext } from "../Firebase/context";<br/>import { Redirect } from "react-router-dom";</span></pre><ul class=""><li id="e59c" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><code class="fe mo mp mq mr b">useContext</code>是一个React钩子，它允许组件使用上下文。</li><li id="eee5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><code class="fe mo mp mq mr b">FirebaseAuth</code>是我们登录方法的样式组件</li><li id="1275" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><code class="fe mo mp mq mr b">AuthContext</code>包含我们将被<code class="fe mo mp mq mr b">useContext</code>使用的上下文</li><li id="a46a" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><code class="fe mo mp mq mr b">Redirect</code>允许我们在登录成功后将用户重定向到主页</li></ul><p id="8faf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的导入语句下面，我们将有:</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="c9a9" class="nq lm iq mr b gy nr ns l nt nu">export default function SignIn() {<br/>  //get the user state from the context<br/>  const { user } = useContext(AuthContext); <br/><br/>  //this is our config for FirebaseAuth<br/>  const uiConfig = {<br/>    signInFlow: "popup",<br/>    signInOptions: [<br/>      firebase.auth.GoogleAuthProvider.PROVIDER_ID,<br/>      firebase.auth.FacebookAuthProvider.PROVIDER_ID,<br/>      firebase.auth.EmailAuthProvider.PROVIDER_ID,<br/>    ],<br/>    callbacks: {<br/>      signInSuccess: () =&gt; false,<br/>    },<br/>  };<br/><br/>//if user exists or signed in, we redirect the page to home, else display the sign in methods with FirebaseAuth<br/>  return (<br/>    &lt;div&gt;<br/>      {!!user ? (<br/>        &lt;Redirect to={{ pathname: "/" }} /&gt;<br/>      ) : (<br/>        &lt;div&gt;<br/>          &lt;p&gt;Please Sign In&lt;/p&gt;<br/>          &lt;FirebaseAuth uiConfig={uiConfig} firebaseAuth={firebase.auth()} /&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="5698" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们让我们的<code class="fe mo mp mq mr b">Nav</code>组件显示一个登录按钮，如果没有用户当前认证。如果用户确实存在，我们将通过访问用户的<code class="fe mo mp mq mr b">displayName</code>和<code class="fe mo mp mq mr b">photoURL</code>属性显示其姓名和图片。更多的用户属性可以在文档<a class="ae mv" href="https://firebase.google.com/docs/reference/js/firebase.User" rel="noopener ugc nofollow" target="_blank">中找到这里的</a>。</p><p id="a59f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们还有一个“注销”链接，单击该链接时将执行<code class="fe mo mp mq mr b">app.auth().signOut()</code>以注销用户。</p><p id="c23b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我们的<strong class="jp ir"> Nav.js </strong>:</p><pre class="la lb lc ld gt nm mr nn no aw np bi"><span id="e38f" class="nq lm iq mr b gy nr ns l nt nu">import { AuthContext } from "../Firebase/context.js";<br/><br/>export default function Nav() {<br/>   //get the user state from context<br/>  const { user } = useContext(AuthContext);<br/><br/>//if user exists, display user name and picture.<br/>//else, show a sign in button instead<br/>  return (<br/>      &lt;div className="account"&gt;<br/>        {!!user ? (<br/>          &lt;div className="dropdown"&gt;<br/>            &lt;p&gt;{`Welcome, ${user.displayName}`}&lt;/p&gt;<br/>            &lt;div className="dropdown-content"&gt;<br/>              &lt;Link to="/"&gt;Create Stories&lt;/Link&gt;<br/>              &lt;Link to="/"&gt;My Stories&lt;/Link&gt;<br/>              &lt;Link onClick={() =&gt; app.auth().signOut()}&gt;Sign Out&lt;/Link&gt;<br/>            &lt;/div&gt;<br/>          &lt;/div&gt;<br/>        ) : (<br/>          &lt;Link to="/signin"&gt;<br/>            &lt;button&gt;SIGN IN/ REGISTER&lt;/button&gt;<br/>          &lt;/Link&gt;<br/>        )}<br/>      &lt;/div&gt;<br/>  );<br/>}</span></pre><h1 id="ee77" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">我们的最终结果</h1><p id="f563" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">总之，React Context API提供了一种漂亮而简单的方法来创建上下文，以便将数据传递给应用程序中的其他组件。我希望本文对学习如何使用上下文API以及Firebase身份验证有所帮助。非常感谢阅读。请在下面留下任何问题或评论。或者，阅读下面的资源以了解有关我们今天讨论的内容的更多信息。下一次，干杯！</p><h1 id="ec97" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">进一步阅读</h1><ul class=""><li id="9a80" class="kl km iq jp b jq mj ju mk jy nx kc ny kg nz kk kq kr ks kt bi translated"><a class="ae mv" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">反应上下文API文档</a></li><li id="9cb3" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><a class="ae mv" href="https://firebase.google.com/docs/auth/web/start" rel="noopener ugc nofollow" target="_blank">网络应用文档Firebase</a></li></ul></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="1a78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">最初发表于</em><a class="ae mv" href="https://lo-victoria.com/introduction-to-react-context-api-with-firebase-authentication" rel="noopener ugc nofollow" target="_blank"><em class="mu">https://lo-victoria.com</em></a><em class="mu">。</em></p><h2 id="ab02" class="nq lm iq bd ln oh oi dn lr oj ok dp lv jy ol om lz kc on oo md kg op oq mh or bi translated">用简单的英语</h2><p id="f9be" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">喜欢这篇文章吗？如果是这样的话，获得更多类似内容由<a class="ae mv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">订阅解码，我们YouTube频道</strong> </a> <strong class="jp ir">！</strong></p></div></div>    
</body>
</html>