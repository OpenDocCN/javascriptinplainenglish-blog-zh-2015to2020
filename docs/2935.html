<html>
<head>
<title>Consuming file data in Next.js API routes with Formidable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用强大的Next.js API路由消费文件数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/formidable-with-next-js-298c913517a0?source=collection_archive---------4-----------------------#2020-08-08">https://javascript.plainenglish.io/formidable-with-next-js-298c913517a0?source=collection_archive---------4-----------------------#2020-08-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2646" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">改善API中的数据流</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fbd5bd94cb7fe9def389d81f383a573b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIrYErGPCTgfROqyaLJ7iw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@epicantus?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Daria Nepriakhina</a> on <a class="ae kv" href="https://unsplash.com/s/photos/send?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5fd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将检查如何在不使用定制服务器的情况下使用强大，从客户端发送表单数据到我们的后端</p><p id="c818" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此示例假设您已经习惯于将文件从客户端发送到后端，从客户端发送文件的基本示例如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><h1 id="cfc7" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">Next.js API</h1><p id="49ae" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">关于Next.js API routes的好处是，您可以在不使用任何定制服务器的情况下完成许多事情。我们将设置api路由来处理传入的表单数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="3d04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是Next.js中api路由的基本设置，其中我们有<strong class="ky ir"> req( </strong> request <strong class="ky ir"> ) </strong>，其中有内置的中间件帮助我们解析请求，以便访问cookies、请求正文、请求中的查询等等。</p><p id="2211" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们还有<strong class="ky ir"> res( </strong> response <strong class="ky ir"> ) </strong>，它是我们的响应助手，在我们对发送到这个路由的请求做了任何我们想做的事情之后，它会发回一个响应。</p><p id="34d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你到达终点；<em class="mr"> /api/uploadApi </em>，你会得到‘文件已收到’的响应。</p><p id="e106" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Next.js还为我们提供了一个选项来配置我们的api，关于被解析的主体的最大大小，我们还可以告诉它我们是否希望我们的主体被解析，在这种情况下，我们需要我们的表单数据作为一个流，因此我们必须禁用bodyparser</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="a280" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们的设置已经准备好了，我们可以安装获取表单数据所需的所有依赖项，这些数据是微小而强大的。</p><p id="0dd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的文件现在看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="5891" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Micro将为我们解析数据，而davidle将处理所有传入的流，然后我们将所有数据存储到我们的“数据”变量中。如果您想将它发送到数据库，您可以创建一个可读的流并将其附加到表单数据中，然后发送它。</p></div></div>    
</body>
</html>