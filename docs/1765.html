<html>
<head>
<title>Create a COVID Map with Vue &amp; Google Maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue和谷歌地图创建COVID地图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-a-covid-map-using-vue-google-maps-89eb70a9f089?source=collection_archive---------8-----------------------#2020-04-20">https://javascript.plainenglish.io/making-a-covid-map-using-vue-google-maps-89eb70a9f089?source=collection_archive---------8-----------------------#2020-04-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/53cdbec07e2e292845b5daa748694e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jil7xR4E-uLUTpLoTYABVw.png"/></div></div></figure><p id="3c51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我一直使用<a class="ae kt" href="https://coronavirus-map.com/" rel="noopener ugc nofollow" target="_blank">冠状病毒地图</a>进行每日更新；但我也一直在为谷歌地图制作自己的Vue插件，我想我应该测试一下。对于那些正在学习Vue(中级)或者想要开始自己的(COVID)地图的人来说，这是一个很好的例子。</p><p id="842c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是结果:<a class="ae kt" href="https://github.com/xon52/covid-map/" rel="noopener ugc nofollow" target="_blank">资源库(代码)</a> | <a class="ae kt" href="https://xon52.github.io/covid-map/" rel="noopener ugc nofollow" target="_blank">现场演示</a></p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="5f98" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置</h1><p id="2fb1" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">使用<a class="ae kt" href="https://cli.vuejs.org/guide/creating-a-project.html" rel="noopener ugc nofollow" target="_blank"> Vue CLI </a>和默认预设(Babel和ESLint)进行非常基本的设置。</p><p id="cdfb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们只是使用带有组件的<em class="me"> App.vue </em>文件，所以我们不需要生成的<em class="me">视图</em>文件夹或<em class="me"> HelloWorld.vue </em>组件。我们也没有资产，所以您也可以删除<em class="me"> Assets </em>文件夹。</p><h2 id="e42b" class="mf lc in bd ld mg mh dn lh mi mj dp ll kg mk ml lp kk mm mn lt ko mo mp lx mq bi translated"><a class="ae kt" href="https://github.com/xon52/x5-gmaps/" rel="noopener ugc nofollow" target="_blank">X5-gmaps</a>(Vue的谷歌地图插件)</h2><ol class=""><li id="989b" class="mr ms in jx b jy lz kc ma kg mt kk mu ko mv ks mw mx my mz bi translated">通过<code class="fe na nb nc nd b">npm install x5-gmaps</code>安装</li><li id="fa96" class="mr ms in jx b jy ne kc nf kg ng kk nh ko ni ks mw mx my mz bi translated">为了让它在Edge和IE中工作，添加一个<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/vue.config.js" rel="noopener ugc nofollow" target="_blank"><em class="me">vue . config . js</em></a>文件，并包含:<br/> <code class="fe na nb nc nd b">module.exports = { transpileDependencies: ['x5-gmaps'] }</code></li><li id="a0c5" class="mr ms in jx b jy ne kc nf kg ng kk nh ko ni ks mw mx my mz bi translated"><a class="ae kt" href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="noopener ugc nofollow" target="_blank">获取一个谷歌API密钥</a></li><li id="6bb4" class="mr ms in jx b jy ne kc nf kg ng kk nh ko ni ks mw mx my mz bi translated">在您的<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/src/main.js" rel="noopener ugc nofollow" target="_blank"> <em class="me"> main.js </em> </a>文件中导入并<a class="ae kt" href="https://vuejs.org/v2/guide/plugins.html" rel="noopener ugc nofollow" target="_blank">安装插件</a>:</li></ol><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="0ff0" class="mf lc in nd b gy nr ns l nt nu">// ...<br/>import x5GMaps from 'x5-gmaps'<br/>Vue.use(x5GMaps, { key: GOOGLE_KEY, libraries: ['visualization'] }<br/>// ...</span></pre><h2 id="ac39" class="mf lc in bd ld mg mh dn lh mi mj dp ll kg mk ml lp kk mm mn lt ko mo mp lx mq bi translated">事件总线</h2><p id="77df" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">为了在组件之间传递数据，我们将使用一个<a class="ae kt" href="https://css-tricks.com/using-event-bus-to-share-props-between-vue-components/" rel="noopener ugc nofollow" target="_blank"> EventBus </a>而不是<a class="ae kt" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vuex </a>(你可以将它用于任何比它更大的项目)。我把它叫做<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/src/bus.js" rel="noopener ugc nofollow" target="_blank"> <em class="me"> bus.js </em> </a>它包含的全部内容是:</p><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="fe40" class="mf lc in nd b gy nr ns l nt nu">import Vue from 'vue'<br/>export const EventBus = new Vue()</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="bf87" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">成分</h1><p id="b4e5" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">我们将只有一个“视图”(<em class="me"> App.vue </em>，但它将由两个组件组成:<em class="me"> WorldMap.vue </em>和<em class="me"> MapOptions.vue </em>。</p><h2 id="4c86" class="mf lc in bd ld mg mh dn lh mi mj dp ll kg mk ml lp kk mm mn lt ko mo mp lx mq bi translated">热图</h2><p id="2997" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">为了简化起见，我们将把地图覆盖图与<em class="me"> WorldMap.vue. </em>分开。这个覆盖图是X5-gmap附带的热图组件，我们称之为<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/src/components/HeatMap.vue" rel="noopener ugc nofollow" target="_blank"> <em class="me"> HeatMap.vue </em> </a>。</p><p id="df8d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们从两个Vue数据属性开始:<code class="fe na nb nc nd b">covidDataRaw</code>(我们下载的原始数据)和<code class="fe na nb nc nd b">type</code>(我们映射的数据类型)。</p><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="5570" class="mf lc in nd b gy nr ns l nt nu">data: () =&gt; ({<br/>  covidDataRaw: [],<br/>  type: 'active'<br/>}),</span></pre><p id="bc54" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当组件为<code class="fe na nb nc nd b">created()</code>时，我们将使用<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" rel="noopener ugc nofollow" target="_blank"> fetch() </a>在<a class="nv nw ep" href="https://medium.com/u/724f7693f760?source=post_page-----89eb70a9f089--------------------------------" rel="noopener" target="_blank">Muhammad mustapi</a>的<a class="ae kt" href="https://github.com/mathdroid/covid-19-api" rel="noopener ugc nofollow" target="_blank">新冠肺炎-api </a>上获得COVID数据。我们还将使用EventBus来倾听和响应“类型”变化(来自<em class="me"> MapOptions.vue </em>)。</p><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="e736" class="mf lc in nd b gy nr ns l nt nu">created() {<br/>  // Get data<br/>  fetch('<a class="ae kt" href="https://covid19.mathdro.id/api/confirmed'" rel="noopener ugc nofollow" target="_blank">https://covid19.mathdro.id/api/confirmed'</a>)<br/>    .then(response =&gt; response.json())<br/>    .then(data =&gt; (this.covidDataRaw = data))<br/>    .catch(e =&gt; console.error(e))<br/>  // Listen for type change<br/>  EventBus.$on('changeType', type =&gt; (this.type = type))<br/>}</span></pre><p id="0b8d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="me">*注意:在存储库代码中，我有一个备份数据集，如果它不能连接到主数据集，就会被调用，如果主数据集也有问题，就会解析为一个空数组。</em></p><p id="bc51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下载的COVID数据集几乎是完美的，但是在热图组件中使用它之前，需要稍加修改；所以我们做了一个计算属性<code class="fe na nb nc nd b">items</code>返回一个修改过的(和更小的)数组。<br/>我们也可以根据选择的类型设置热图颜色梯度。</p><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="005c" class="mf lc in nd b gy nr ns l nt nu">computed: {<br/>  items() {<br/>    return this.covidDataRaw.map(e =&gt; ({<br/>      lat: e.lat,<br/>      lng: e.long,<br/>      active: e.active,<br/>      confirmed: e.confirmed,<br/>      deaths: e.deaths,<br/>      recovered: e.recovered<br/>    }))<br/>  },<br/>  colors() {<br/>    if (this.type === 'recovered') return ['white', 'blue']<br/>    if (this.type === 'deaths') return ['red', 'black']<br/>    return ['green', 'yellow', 'red']<br/>  }<br/>}</span></pre><p id="e318" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们可以将所有这些添加到热图组件中，并添加一些额外的道具以使其看起来更好:</p><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="d926" class="mf lc in nd b gy nr ns l nt nu">&lt;gmaps-heatmap :items="items"<br/>               :weightProp="type"<br/>               :dissipating="false"<br/>               :colors="colors"<br/>               :maxIntensity="20000" /&gt;</span></pre><h2 id="ebab" class="mf lc in bd ld mg mh dn lh mi mj dp ll kg mk ml lp kk mm mn lt ko mo mp lx mq bi translated">世界地图</h2><p id="f84c" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">在<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/src/components/WorldMap.vue" rel="noopener ugc nofollow" target="_blank"> <em class="me"> WorldMap.vue </em> </a>中没有什么特别的，只有我们刚刚在里面创建的带有热图的x5-gmaps地图组件。这些选项使地图居中，设置缩放比例，并关闭谷歌地图的所有控件和按钮。</p><h2 id="06e9" class="mf lc in bd ld mg mh dn lh mi mj dp ll kg mk ml lp kk mm mn lt ko mo mp lx mq bi translated">MapOptions</h2><p id="9d26" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">同样，<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/src/components/MapOptions.vue" rel="noopener ugc nofollow" target="_blank"><em class="me">mapoptions . vue</em></a>也是非常基本的。一组固定在左上角的单选按钮，允许选择映射的数据类型。</p><p id="9539" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有趣的是EventBus的使用。Vue数据属性<code class="fe na nb nc nd b">type</code>是单选按钮组所连接到的，因此我们为<code class="fe na nb nc nd b">type</code>和<a class="ae kt" href="https://vuejs.org/v2/guide/components.html#Emitting-a-Value-With-an-Event" rel="noopener ugc nofollow" target="_blank">添加了一个观察器，并为热图组件监听的事件</a>发出，为其赋予新的<code class="fe na nb nc nd b">type</code>值。</p><pre class="nj nk nl nm gt nn nd no np aw nq bi"><span id="2713" class="mf lc in nd b gy nr ns l nt nu">data: () =&gt; ({<br/>  type: 'active'<br/>}),<br/>watch: {<br/>  type(newVal) {<br/>    EventBus.$emit('changeType', newVal)<br/>  }<br/>}</span></pre><h1 id="8c56" class="lb lc in bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">应用</h1><p id="324b" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">现在所有的组件都准备好了，所以我们可以把它们放在<a class="ae kt" href="https://github.com/xon52/covid-map/blob/master/src/App.vue" rel="noopener ugc nofollow" target="_blank"> <em class="me"> App.vue </em> </a>中。这非常简单，我们所做的就是在固定为全屏的包装div中添加WorldMap组件和MapOptions组件。</p><h1 id="ba7d" class="lb lc in bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">奔跑</h1><p id="d035" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">你应该能够运行<code class="fe na nb nc nd b">npm run serve</code>并看到我们的目标实现。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h1 id="e170" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="59cf" class="pw-post-body-paragraph jv jw in jx b jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks ig bi translated">这当然是一张极其基础的地图。改进包括:</p><ul class=""><li id="0ae0" class="mr ms in jx b jy jz kc kd kg oc kk od ko oe ks of mx my mz bi translated">地图上的病例数(<em class="me"> x5-gmaps弹出窗口可能有所帮助</em>)</li><li id="c821" class="mr ms in jx b jy ne kc nf kg ng kk nh ko ni ks of mx my mz bi translated">图表(<em class="me">例如一个</em> <a class="ae kt" href="https://github.com/open-covid-19/data" rel="noopener ugc nofollow" target="_blank"> <em class="me">不同的数据集</em> </a> <em class="me">和</em> <a class="ae kt" href="https://vue-chartjs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="me">)</em></a></li><li id="b5bc" class="mr ms in jx b jy ne kc nf kg ng kk nh ko ni ks of mx my mz bi translated">放大时重新评估热图(<em class="me">例如从地图边界过滤数据</em>)</li><li id="b03b" class="mr ms in jx b jy ne kc nf kg ng kk nh ko ni ks of mx my mz bi translated">数据新鲜度的指示(<em class="me">例如每个国家的日期</em>)</li></ul><p id="8108" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">…但这些是另一个教程的内容，或者更好的是，供您创建和共享！</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="c994" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我还在开发我的<a class="ae kt" href="https://github.com/xon52/x5-gmaps" rel="noopener ugc nofollow" target="_blank"> x5-gmaps插件</a>；但它是以一种您可以添加自己的组件的方式构建的，这样您就不必等我了！如果你确实使用它，请给它一颗星🌟说你想看什么，或者分享你为它制作的组件。</p><p id="d3cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">哦，鼓掌👏。我喜欢鼓掌。</p><p id="120f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有任何问题，请在这里提问，Github，或者联系我<a class="ae kt" href="https://chisnall.io/" rel="noopener ugc nofollow" target="_blank"> chisnall.io </a>。</p></div></div>    
</body>
</html>