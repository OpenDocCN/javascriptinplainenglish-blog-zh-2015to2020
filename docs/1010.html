<html>
<head>
<title>Getting started with React and D3 — interactive Bar Chart.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和D3 —交互式条形图入门。</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-react-and-d3-interactive-bar-chart-3ed8c933beb3?source=collection_archive---------1-----------------------#2020-01-14">https://javascript.plainenglish.io/getting-started-with-react-and-d3-interactive-bar-chart-3ed8c933beb3?source=collection_archive---------1-----------------------#2020-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/ad25ed4f48a3d2b8466e06c14e59717c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*Le21JF5X-17Buq8Hdbz05g.png"/></div></figure><p id="47e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">D3代表数据驱动文档，自2011年诞生以来，它一直是在网络上创建自定义数据可视化的行业标准。我喜欢把D3想象成一个加载数据并将其附加到DOM的库。React是一项脸书技术，它使得创建交互式用户界面变得不费力。它被认为是有史以来最强大的用户界面库。</p><p id="c324" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">React和D3都是用于在web上构建定制数据可视化的很好的工具。然而，它们的设计目的是相互冲突的。两者都控制用户界面元素或操作DOM，并以不同的方式完成。我们如何让它们协同工作，同时最大限度地发挥各自的独特优势？</p><p id="5f2c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本文中，我们将使用这两个库，利用它们独特的优势来创建一个交互式条形图。在同一个项目中使用react和D3有多种方法，但是必须遵循一个规则；</p><blockquote class="ks kt ku"><p id="1d63" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated">他们不应该共享DOM控制权。这将是一场灾难。马科斯·伊格莱西亚斯</p></blockquote><p id="1c38" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就是我们要构建的东西，也是我将在本文中向您介绍的内容。一个<a class="ae kz" href="https://www.asabahebwa.com/visualizations" rel="noopener ugc nofollow" target="_blank">现场演示在这里</a>，如果你想看它的行动。</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="779d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当用React和D3创建数据可视化时，我们可以使用许多不同的方法，更多地倾向于React端或D3.js端。在我的<a class="ae kz" href="https://medium.com/analytics-vidhya/make-a-clever-bitcoin-price-chart-with-react-and-d3-e6359d604b54" rel="noopener">上一篇关于用React和D3创建30天比特币价格图表的文章</a>中，我用React表示DOM，D3表示Math。</p><p id="08de" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> React为DOM，D3.js为math </strong></p><p id="1593" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这个策略中，我们尽可能的限制D3.js的使用。这意味着我们需要用D3.js对SVG路径、比例、布局和转换进行计算，并将其转换成我们可以用React绘制的东西。对于这个演示，我们将在React中使用D3.js。</p><p id="3e43" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">【React内的D3.js】</p><p id="3749" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这种方法中，我们给予D3.js尽可能多的DOM控制权。我们使用React来呈现一个div，作为数据可视化的根元素。然后我们利用<em class="kv"> componentDidMount </em>生命周期方法，用D3.js代码进行数据可视化，并借助React refs将其附加到根元素上。</p><p id="5060" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好了，说够了！让我们开始实现交互式条形图。</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="lg lf l"/></div></figure><h1 id="4675" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">交互式条形图的实现</h1><p id="9a16" class="pw-post-body-paragraph ju jv iq jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">实现这个条形图主要需要两个文件；</p><p id="4c00" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">反应元件</strong></p><ul class=""><li id="9489" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated">包含发生D3.js计算的<em class="kv"> componentDidMount </em>生命周期方法。</li><li id="91de" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">其中根元素由React呈现。</li><li id="9c2d" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">其中D3.js被添加到项目中。</li><li id="c7b1" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated">包含条形图的一些样式。</li></ul><p id="8158" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">样式文件</strong></p><ul class=""><li id="1a60" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated">获取条形图的其他样式。</li></ul><p id="9c1f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">非常简单直接……:)</p><h1 id="32f5" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">我是这样做的</h1><p id="d5c7" class="pw-post-body-paragraph ju jv iq jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">为了快速启动这个项目，我用create-react-app引导应用程序，这是一个由脸书的工程师创建的节点模块，用于为react应用程序生成锅炉板代码。它负责引擎盖下的webpack和babel配置。</p><p id="6b13" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将从React组件中的代码开始，该组件负责进行D3.js计算并将条形图可视化呈现到DOM上。</p><pre class="la lb lc ld gt my mz na nb aw nc bi"><span id="ea00" class="nd li iq mz b gy ne nf l ng nh">import React from "react";<br/>import * as d3 from "d3";</span><span id="3dc0" class="nd li iq mz b gy ni nf l ng nh">class App extends React.Component {<br/>  constructor(props) {<br/>  super(props);<br/>  this.state = {};<br/> }<br/>  <br/> componentDidMount() {<br/>   const dataset = [12, 31, 22, 17, 25, 18, 29, 14, 9];<br/>   const w = 600;<br/>   const h = 300;</span><span id="7015" class="nd li iq mz b gy ni nf l ng nh">   const svg = d3<br/>     .select(this.refs.chart)<br/>     .append("svg")<br/>     .attr("width", w)<br/>     .attr("height", h)<br/>     .attr("class", "bar");</span><span id="7036" class="nd li iq mz b gy ni nf l ng nh">   svg<br/>     .selectAll("rect")<br/>     .data(dataset)<br/>     .enter()<br/>     .append("rect")<br/>     .attr("fill", "navy")<br/>     .attr("class", "sBar")<br/>     .attr("x", (d, i) =&gt; i * 60)<br/>     .attr("y", (d, i) =&gt; {<br/>        return h - 7 * d;<br/>      })<br/>     .attr("width", 50)<br/>     .attr("height", (d, i) =&gt; 7 * d)<br/>     .append("title")<br/>     .text(d =&gt; d);</span><span id="6ab5" class="nd li iq mz b gy ni nf l ng nh">   svg<br/>     .selectAll("text")<br/>     .data(dataset)<br/>     .enter()<br/>     .append("text")<br/>     .style("font-size", 18)<br/>     .attr("fill", "red")<br/>     .attr("x", (d, i) =&gt; i * 60)<br/>     .attr("y", (d, i) =&gt; h - 7 * d - 3)<br/>     .text(d =&gt; d);<br/>    }</span><span id="0b95" class="nd li iq mz b gy ni nf l ng nh">    render() {<br/>      const styles = {<br/>        container: {<br/>          display: "grid",<br/>          justifyItems: "center"<br/>        }<br/>      };</span><span id="8514" class="nd li iq mz b gy ni nf l ng nh">    return (<br/>      &lt;div ref="chart" style={styles.container}&gt;<br/>        &lt;h1 style={{ textAlign: "center" }}&gt;Hi, I'm the bar chart&lt;/h1&gt;<br/>      &lt;/div&gt;<br/>     );<br/>   }<br/>  }</span><span id="4195" class="nd li iq mz b gy ni nf l ng nh">export default App;</span></pre><p id="4803" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，您需要将D3.js添加到项目中。导航到你的项目文件夹，运行命令<code class="fe nj nk nl mz b">yarn add d3</code>如果你正在使用yarn else为npm风扇运行<code class="fe nj nk nl mz b">npm i d3</code>。之后，将D3导入到<code class="fe nj nk nl mz b">App.js</code>文件中，如上面代码片段开头所示。</p><pre class="la lb lc ld gt my mz na nb aw nc bi"><span id="93c3" class="nd li iq mz b gy ne nf l ng nh">const dataset = [12, 31, 22, 17, 25, 18, 29, 14, 9];<br/>   const w = 600;<br/>   const h = 300;</span></pre><p id="0fe5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这个文件中，我们需要将注意力集中在<em class="kv"> componentDidMount </em>生命周期方法上。在这个方法的开始，我们将数据集变量初始化为一个简单的数字数组。我们还初始化了svg的高度和宽度。</p><pre class="la lb lc ld gt my mz na nb aw nc bi"><span id="ac4b" class="nd li iq mz b gy ne nf l ng nh">const svg = d3<br/>     .select(this.refs.chart)<br/>     .append("svg")<br/>     .attr("width", w)<br/>     .attr("height", h)<br/>     .attr("class", "bar");</span></pre><p id="aebc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，我们使用帮助D3的<code class="fe nj nk nl mz b">select()</code>方法选择render方法中的根元素，React refs并向其追加一个svg元素。D3有<code class="fe nj nk nl mz b">attr()</code>方法来添加任何HTML属性到元素中，包括类名。在上面的代码片段中，我们将宽度、高度和一个类<em class="kv">栏</em>添加到svg元素中。</p><pre class="la lb lc ld gt my mz na nb aw nc bi"><span id="4000" class="nd li iq mz b gy ne nf l ng nh">   svg<br/>     .selectAll("rect")<br/>     .data(dataset)<br/>     .enter()<br/>     .append("rect")<br/>     .attr("fill", "navy")<br/>     .attr("class", "sBar")<br/>     .attr("x", (d, i) =&gt; i * 60)<br/>     .attr("y", (d, i) =&gt; {<br/>        return h - 7 * d;<br/>      })<br/>     .attr("width", 50)<br/>     .attr("height", (d, i) =&gt; 7 * d)<br/>     .append("title")<br/>     .text(d =&gt; d);</span></pre><p id="5768" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在突出显示的代码片段的开始，我们为<em class="kv">数据集</em>变量中的每个数据点创建并附加了一个矩形。这个过程的第一步是让D3知道数据。<code class="fe nj nk nl mz b">data()</code>方法用于选择DOM元素，将数据附加到这些元素上。数据集作为参数传递给方法。</p><p id="d2db" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">常见的工作流模式是在文档中为集合中的每条数据创建一个新元素。D3为此使用了<code class="fe nj nk nl mz b">enter()</code>方法。当<code class="fe nj nk nl mz b">enter()</code>与<code class="fe nj nk nl mz b">data()</code>方法结合使用时，它会查看从页面中选择的元素，并将它们与集合中的数据项数量进行比较。如果元素比数据项少，它会创建缺失的元素。</p><p id="85f5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于<em class="kv">数据集</em>数组中的每个数字，我们向<em class="kv"> svg </em>追加一个<em class="kv"> rect </em>元素。然后，我们借助D3的<code class="fe nj nk nl mz b">attr()</code>方法将HTML属性<em class="kv">填充</em>和<em class="kv">类</em>添加到rect元素中。在这一点上，所有的矩形将堆叠在对方的顶部。矩形的放置由<code class="fe nj nk nl mz b">x</code>和<code class="fe nj nk nl mz b">y</code>属性处理。他们告诉D3在<code class="fe nj nk nl mz b">svg</code>区域从哪里开始绘制形状。</p><p id="7628" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">记住<code class="fe nj nk nl mz b">x</code>值需要随着你添加新的条形而改变。较大的x值会将项目向右推得更远。D3的<code class="fe nj nk nl mz b">attr()</code>方法接受一个回调函数来动态设置该属性。回调函数接受两个参数，一个用于数据点本身(通常是<code class="fe nj nk nl mz b">d</code>)，另一个用于数组中数据点的索引。在这种情况下，我们返回乘以60的索引，这样我们可以在条形之间留出一些空间。</p><p id="2712" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请记住，在svg中，较高的<code class="fe nj nk nl mz b">y</code>值会将矩形向下推。要使条形正面朝上，您需要改变<code class="fe nj nk nl mz b">y</code>坐标的计算方式。它需要考虑条形的高度和SVG区域的总高度。<code class="fe nj nk nl mz b">y</code>坐标(即<code class="fe nj nk nl mz b">y = heightOfSVG - heightOfBar</code>坐标)会将棒材正面朝上放置。</p><p id="437c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">多亏了D3，添加显示悬停效果数据值的工具提示是最简单的事情之一。您只需要添加一个title元素，然后用回调函数调用<code class="fe nj nk nl mz b">text()</code>方法，这样文本就会显示数据值。</p><pre class="la lb lc ld gt my mz na nb aw nc bi"><span id="6743" class="nd li iq mz b gy ne nf l ng nh">svg<br/>     .selectAll("text")<br/>     .data(dataset)<br/>     .enter()<br/>     .append("text")<br/>     .style("font-size", 18)<br/>     .attr("fill", "red")<br/>     .attr("x", (d, i) =&gt; i * 60)<br/>     .attr("y", (d, i) =&gt; h - 7 * d - 3)<br/>     .text(d =&gt; d);<br/>    }</span></pre><p id="b572" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在条形上方添加文本标签与为条形添加矩形几乎相同。你不需要像添加矩形那样担心宽度和高度属性。我们从属性<code class="fe nj nk nl mz b">y</code>的返回值中减去3，这样文本就可以位于条形的正上方。</p><p id="ca90" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你读到这里，很高兴让你知道我现在要结束了。你也应该准备奖励自己，是的。值了。</p><pre class="la lb lc ld gt my mz na nb aw nc bi"><span id="7abe" class="nd li iq mz b gy ne nf l ng nh">.bar {<br/>  padding-left: 60px;<br/>  padding: 0 auto;<br/> }</span><span id="c1d7" class="nd li iq mz b gy ni nf l ng nh">.sBar:hover {<br/>  fill: brown;<br/> }</span></pre><p id="089f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">无论如何，从我们的项目结构来看，我们有另一个小但重要的文件，<code class="fe nj nk nl mz b">index.css</code>用于添加样式，例如改变悬停时条的颜色。添加到<code class="fe nj nk nl mz b">App.js</code>文件中的类属性可以在该文件中访问。</p><p id="d969" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你已经用React和D3成功地构建了一个交互式条形图。还是那句话，不太难。那鸿</p><p id="8987" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">源代码可以在<a class="ae kz" href="https://github.com/ahebwa49/bar_chart" rel="noopener ugc nofollow" target="_blank">这个GitHub库</a>里找到。</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="nm lf l"/></div></figure><p id="a8f7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">结论</strong></p><p id="080f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">开始使用React和D3可能会有些吓人。然而，如果您掌握了D3的基础知识以及如何将它与React一起使用，您将拥有一个很好的工具集来帮助您处理DOM，而不会增加任何错误。</p><p id="9138" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">过几天再来看看，我将写一篇关于用React和D3向条形图添加画笔的文章，以便只检索指定可视范围内的数据。</p><p id="6599" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">如果你喜欢读这篇文章，你可能也会喜欢我的其他一些博客:</strong></p><ul class=""><li id="e31c" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated"><a class="ae kz" href="https://medium.com/analytics-vidhya/make-a-clever-bitcoin-price-chart-with-react-and-d3-e6359d604b54" rel="noopener">用React和D3做一个巧妙的比特币价格图。</a></li><li id="075c" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated"><a class="ae kz" href="https://medium.com/@ahebwa49/basic-node-js-setup-every-javascript-backend-developer-needs-to-know-f157dad834e6" rel="noopener">每个JavaScript后端开发者都需要知道的基本Node.js设置。</a></li></ul><p id="544b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">参考资料和更多资源:</strong></p><ul class=""><li id="59f8" class="mk ml iq jw b jx jy kb kc kf mm kj mn kn mo kr mp mq mr ms bi translated"><a class="ae kz" href="https://www.freecodecamp.org/learn/data-visualization/data-visualization-with-d3/" rel="noopener ugc nofollow" target="_blank"> freeCodeCamp </a></li><li id="5e1f" class="mk ml iq jw b jx mt kb mu kf mv kj mw kn mx kr mp mq mr ms bi translated"><a class="ae kz" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank">d3js.org</a></li></ul><p id="1b88" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">我对React和D3的数据可视化非常感兴趣。如果你</strong> <a class="ae kz" href="https://twitter.com/ahebwa49" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">在Twitter上关注我，</strong> </a> <strong class="jw ir">我不会浪费你的时间。！</strong></p></div></div>    
</body>
</html>