<html>
<head>
<title>What is CORS (Cross Origin Resource Sharing)?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是CORS(跨源资源共享)？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-cors-cross-origin-resource-sharing-98df12d0f7db?source=collection_archive---------6-----------------------#2020-01-03">https://javascript.plainenglish.io/what-is-cors-cross-origin-resource-sharing-98df12d0f7db?source=collection_archive---------6-----------------------#2020-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3bfb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">跨来源资源共享指南。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0dd9de8b1a621f0ccf701e4cc2978d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXI-kg18liPn4XcfZmoqQQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@cdr6934?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Chris Ried</a> on <a class="ae kv" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="751d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CORS允许我们打破浏览器的<strong class="ky ir"> <em class="ls">同源策略</em> </strong>。它允许从不同的来源加载资源。当javascript试图使用<code class="fe lt lu lv lw b">XMLHttpRequest</code>或<code class="fe lt lu lv lw b">fetch</code>对不同的域进行API调用时，这将是有用的，由于同源策略，它将被浏览器阻止。</p><h2 id="de6d" class="lx ly iq bd lz ma mb dn mc md me dp mf lf mg mh mi lj mj mk ml ln mm mn mo mp bi translated">什么是同源策略？</h2><p id="f032" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">同源策略是定义来自一个源的资源如何与其他源交互的机制。默认情况下，浏览器允许从同一来源加载资源。这是出于安全目的，以减少可能的攻击。</p><p id="f8bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您从abc.com向xyz.com发出AJAX请求时。您一定会遇到以下错误。</p><pre class="kg kh ki kj gt mv lw mw mx aw my bi"><span id="0f92" class="lx ly iq lw b gy mz na l nb nc">No 'Access-Control-Allow-Origin' header is present on the requested resource</span></pre><p id="36e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此错误是由于浏览器的同源策略造成的。通过使用CORS，我们可以打破同源策略，使用来自不同域的资源。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/d8af8f233adc2f8187717e7eee78c2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*6ijOf3x5ijjYshXqgrFB-Q.png"/></div></figure><p id="75ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您从<code class="fe lt lu lv lw b">abc.com</code>向<code class="fe lt lu lv lw b">xyz.com</code>请求资源时，浏览器会自动在请求中添加<code class="fe lt lu lv lw b">origin:abc.com</code>报头，作为响应，它会检查<code class="fe lt lu lv lw b">Access-Control-Allow-Origin:xyz.com</code>报头以匹配原始报头。如果标头值不同于原始标头，它将由于浏览器上的相同原始策略而被阻止。<strong class="ky ir">注意</strong> —响应被阻塞，而不是请求被阻塞。</p><p id="76d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">浏览器通过使用头<code class="fe lt lu lv lw b">Access-Control-Allow-Origin.</code>来识别哪些资源可以被访问。这个头指定哪个源可以访问资源。</p><p id="b9b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">允许从任何来源访问— <code class="fe lt lu lv lw b">Access-Control-Allow-Origin: *</code></p><p id="cf15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到特定的原点— <code class="fe lt lu lv lw b">Access-Control-Allow-Origin: https://abc.com</code></p><h2 id="09d5" class="lx ly iq bd lz ma mb dn mc md me dp mf lf mg mh mi lj mj mk ml ln mm mn mo mp bi translated">CORS请求类型</h2><p id="02a8" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">有两种类型的CORS请求:<code class="fe lt lu lv lw b">“simple”</code>请求，<code class="fe lt lu lv lw b">“preflight”</code>请求。浏览器会自动计算出哪个请求必须发送给服务器。通常，我们会在网络日志中看到不同种类的请求。</p><h2 id="aecf" class="lx ly iq bd lz ma mb dn mc md me dp mf lf mg mh mi lj mj mk ml ln mm mn mo mp bi translated">简单的请求</h2><p id="da64" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">如果请求满足以下条件，则认为是简单请求。</p><ol class=""><li id="21a6" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">请求方法:<code class="fe lt lu lv lw b">GET,POST</code></li><li id="b1a3" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">以下内容类型:<code class="fe lt lu lv lw b">application/x-www-form-urlencoded</code>、<code class="fe lt lu lv lw b">multipart/form-data</code>或<code class="fe lt lu lv lw b">text/plain</code></li><li id="92c0" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated"><a class="ae kv" href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header" rel="noopener ugc nofollow" target="_blank"> CORS安全头球</a></li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/f1c22de1b5605eec24d0a307f9f97917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJR6f4NSVyRCmscvoZjSvg.png"/></div></div></figure><p id="02c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上图显示了简单请求的请求和响应。</p><h2 id="83c6" class="lx ly iq bd lz ma mb dn mc md me dp mf lf mg mh mi lj mj mk ml ln mm mn mo mp bi translated">飞行前请求</h2><p id="532b" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">在预检请求的情况下，浏览器将使用<code class="fe lt lu lv lw b">OPTIONS</code>方法进行自动请求。这用于确定实际请求的确切能力。如果请求的响应表明不能发出请求，那么对服务器的实际请求将不会被执行。预检选项请求无数据。</p><p id="7580" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">飞行前请求自动设置几个标题，下面是几个重要的标题，</p><p id="0e89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">Access-Control-Request-Method</code> —请求的实际方法。</p><p id="28dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">Access-Control-Request-Headers</code> —将随请求一起发送的自定义标题。</p><p id="8ded" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">预检响应获得以下标题，</p><p id="9d5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">Access-Control-Allow-Origin</code> —允许发起请求的来源。</p><p id="0d44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">Access-Control-Allow-Methods</code> —允许发出请求的逗号分隔的HTTP方法。</p><p id="1663" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">Access-Control-Allow-Headers</code> —允许在请求中设置逗号分隔的标题。</p><p id="6f81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">浏览器检查预检请求的响应，以决定是继续实际的请求还是放弃它。一旦飞行前请求成功，它将被视为一个简单的请求。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e596fff84abf05d48fd638559815148a.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*EOfGIZAeRvOgY3ZAs20zgA.png"/></div></figure><p id="c3bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上图显示了预检请求情况下的请求和响应。假设网站abc.com想制作一个<code class="fe lt lu lv lw b">Put Request</code>到xyz.com，</p><ol class=""><li id="1ca4" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">首先将<code class="fe lt lu lv lw b">OPTIONS</code>请求发送到服务器，</li><li id="326b" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">基于请求的响应报头</li></ol><p id="c291" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果成功，实际的<code class="fe lt lu lv lw b">PUT</code>方法将被发送到服务器。</p><p id="c62f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">否则，该请求将被浏览器丢弃。</p><h2 id="1648" class="lx ly iq bd lz ma mb dn mc md me dp mf lf mg mh mi lj mj mk ml ln mm mn mo mp bi translated">样本飞行前请求</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/4115b37509820b19170c4f10ebdbc143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAdE0cU2DlprWNTTJ4jYnA.png"/></div></div></figure></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="a27a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章对你有用。非常感谢任何改进建议或反馈。</p><p id="f779" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>