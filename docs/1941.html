<html>
<head>
<title>Let’s write e2e tests for a React application with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们用Cypress为React应用程序编写e2e测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-write-e2e-tests-for-a-react-application-with-cypress-653dc10c301d?source=collection_archive---------14-----------------------#2020-05-05">https://javascript.plainenglish.io/lets-write-e2e-tests-for-a-react-application-with-cypress-653dc10c301d?source=collection_archive---------14-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7b63f5efe64176d8a5cb338367b239bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ONs09WwQ7T-c7rNw.png"/></div></div></figure><p id="91dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">端到端测试是一种测试方法，通过测试所谓的用户流来检查应用程序是否如预期的那样工作。</p><p id="2b58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们为我制作的React应用程序之一编写几个e2e测试:<a class="ae kw" href="https://csstox.surge.sh/" rel="noopener ugc nofollow" target="_blank"> csstox </a>，这是一个简单的实用程序，使用它可以轻松地将CSS片段转换为React本机/JSS样式表对象。请在这里通读背后的故事<a class="ae kw" href="https://dev.to/jamesgeorge007/csstox-convert-css-snippets-to-react-native-jss-stylesheet-objects-with-ease-2500" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="da45" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">入门指南</h1><p id="5583" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如标题所示，我们将使用Cypress作为测试框架。首先，我们需要将cypress作为devDependency安装。</p><p id="1e0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面的命令根据Cypress的需要创建几个文件和目录。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6670" class="mj ky iq mf b gy mk ml l mm mn">./node_modules/.bin/cypress open</span></pre><p id="fdd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者使用快捷键<code class="fe mo mp mq mf b">npm bin</code></p><p id="4c1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经过几次调整后，测试设置的目录结构如下所示:</p><p id="3c0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">试验</p><p id="0eae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">└──·e2e</p><p id="c0b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">├──一体化</p><p id="a5a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">│ ├── basic.spec.js</p><p id="7d78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">│ └──行为. spec.js</p><p id="d044" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">└──截图</p><p id="5027" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要根据所做的更改来配置Cypress，为此我们已经有了<code class="fe mo mp mq mf b">cypress.json</code>文件。</p><p id="c425" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们让Cypress知道它必须在<code class="fe mo mp mq mf b">tests/e2e/integration</code>目录中搜索想要的文件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="f938" class="mj ky iq mf b gy mk ml l mm mn">"integrationFolder": "tests/e2e/integration",</span></pre><p id="627c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最终版本如下所示:</p><p id="3bc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，Cypress会要求我们的应用程序在开始执行测试之前启动并运行。让我们安装一个实用程序来完成这项工作。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="248e" class="mj ky iq mf b gy mk ml l mm mn">yarn add -D start-server-and-test</span></pre><p id="7dcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们继续将以下脚本添加到<code class="fe mo mp mq mf b">package.json</code></p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="84ec" class="mj ky iq mf b gy mk ml l mm mn">"cy:run": "cypress open", "test:e2e": "start-server-and-test :3000 cy:run"</span></pre><p id="32f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样我们就可以用<code class="fe mo mp mq mf b">yarn run test:e2e</code>启动测试设置了。</p><p id="5253" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，start-server-and-test 会寻找一个启动脚本，幸运的是我们就是这样。否则，我们需要提供相关的脚本名称作为第一个参数，后跟本地服务器URL和测试脚本。我们已经准备好开始为我们的应用程序编写测试了。</p><p id="6180" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您可能已经从上面的目录结构中注意到的，有两个测试套件:</p><ol class=""><li id="7e70" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated">基本的工作流程——这有点像冒烟测试，它确保事情准备好执行进一步的测试用例。</li><li id="f8f3" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated">行为——它包括确保应用程序端到端行为的测试用例。</li></ol><h1 id="c863" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">基本工作流程</h1><ul class=""><li id="d198" class="mr ms iq ka b kb lv kf lw kj nf kn ng kr nh kv ni mx my mz bi translated">首先，我们需要确保我们的应用程序是否启动并运行。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e432" class="mj ky iq mf b gy mk ml l mm mn">it("renders without crashing", () =&gt; {<br/>    cy.visit("/");<br/>  });</span></pre><ul class=""><li id="5970" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">我们有一个选择框作为用户界面的一部分，默认值为“本地反应”。Cypress提供了各种命令来与DOM交互，就像真正的用户一样。这里，我们需要一个实用程序来选择选择框，并确保它的默认值为“React Native”。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e068" class="mj ky iq mf b gy mk ml l mm mn">it("expects to find the select box defaulting to React Native", () =&gt; {<br/>    cy.visit("/")<br/>      .get("[data-testid=selectbox]")<br/>      .should("have.value", "React Native");<br/>  });</span></pre><p id="4ddc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能已经注意到使用了属性(<code class="fe mo mp mq mf b">data-testid</code>)选择器而不是类选择器，您可能想知道为什么。在Cypress docs网站上列出了一些最佳实践，你可以发现<a class="ae kw" href="https://docs.cypress.io/guides/references/best-practices.html#Selecting-Elements" rel="noopener ugc nofollow" target="_blank">选择元素</a>就是其中之一。CSS类随时会发生变化，导致测试用例失败，而使用<code class="fe mo mp mq mf b">data</code>属性不会出现这种情况。正如所料，我们已经重构了<a class="ae kw" href="https://github.com/jamesgeorge007/csstox/blob/e1916115adff82f3ee980fcb4b46b6477f6e3b05/src/components/select-box/SelectBox.js#L12" rel="noopener ugc nofollow" target="_blank">各自的组件</a>，使其具有了一个<code class="fe mo mp mq mf b">data-testid</code>属性。</p><p id="6820" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cypress提供了一些可以从断言库中选择的断言，比如<code class="fe mo mp mq mf b">chai</code>、<code class="fe mo mp mq mf b">sinon</code>等。我们可以用<code class="fe mo mp mq mf b">should()</code>创建一个断言，现在我们已经有了一个更好的图片。</p><h1 id="5beb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">行为</h1><p id="6150" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">万岁，我们刚刚完成了第一个测试套件的测试用例。现在我们开始编写测试，详细描述应用程序的行为。</p><p id="f6e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有两个<code class="fe mo mp mq mf b">textarea</code>元素用于不同的目的。左边的一个应该允许用户粘贴一个CSS片段，而另一个应该显示React Native/JSS的相同内容。这需要在相应的<code class="fe mo mp mq mf b">textarea</code>元素中输入一些CSS代码片段。幸运的是，我们有一个由Cypress为此提供的<code class="fe mo mp mq mf b">type()</code>函数。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="40f6" class="mj ky iq mf b gy mk ml l mm mn">it("is possible to enter text to the `textarea` intended to receive input CSS snippet", () =&gt; {<br/>    const cssSnippet = "padding: 10px;";<br/>    cy.visit("/")<br/>      .get("[data-testid=input]")<br/>      .type(cssSnippet)<br/>      .should("have.value", cssSnippet);<br/>  });</span></pre><ul class=""><li id="ae42" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">如前所述，两个<code class="fe mo mp mq mf b">textarea</code>元素扮演不同的角色。右边的一个应该显示React本地/JSS等价物，用户应该使其不可编辑。我们如何为这个场景编写一个测试用例呢？嗯，这很简单。只要确保相应的<code class="fe mo mp mq mf b">textarea</code>元素有一个<code class="fe mo mp mq mf b">readonly</code>属性。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a894" class="mj ky iq mf b gy mk ml l mm mn">it("expects to find readonly attribute associated with the textarea intended to display the result", () =&gt; {<br/>    cy.visit("/").get("[data-testid=output]").should("have.attr", "readonly");<br/>  });</span></pre><ul class=""><li id="e69c" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">现在我们需要编写一个测试用例来确保应用程序是否符合它的目的，也就是说，一个输入的CSS代码片段是否被转换成了相应的等价物。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="b940" class="mj ky iq mf b gy mk ml l mm mn">it("converts an input CSS snippet to the React Native equivalent", () =&gt; {<br/>    const inputCSSRule = "transform: translate(10px, 5px) scale(5);";<br/>    const result = {<br/>      transform: [{ scale: 5 }, { translateY: 5 }, { translateX: 10 }],<br/>    };<br/>    cy.visit("/")<br/>      .get("[data-testid=input]")<br/>      .type(inputCSSRule)<br/>      .get("[data-testid=output]")<br/>      .should("have.value", JSON.stringify(result, null, 2));<br/>  });</span></pre><ul class=""><li id="4435" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">JSS的同行向我们提出了新的挑战。选择框的默认值为“反应本地”，我们需要将该值更改为JSS，赛普拉斯用<code class="fe mo mp mq mf b">select()</code>来救援。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="86f3" class="mj ky iq mf b gy mk ml l mm mn">it("converts an input CSS snippet to the JSS equivalent", () =&gt; {<br/>    const inputCSSRule = "margin: 5px 7px 2px;";<br/>    const result = {<br/>      margin: "5px 7px 2px",<br/>    };<br/>    cy.visit("/")<br/>      .get("[data-testid=selectbox]")<br/>      .select("JSS")<br/>      .get("[data-testid=input]")<br/>      .type(inputCSSRule)<br/>      .get("[data-testid=output]")<br/>      .should("have.value", JSON.stringify(result, null, 2));<br/>  });</span></pre><ul class=""><li id="0cca" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">我们已经进行了验证，以确保提交无效的CSS规则会导致在输出<code class="fe mo mp mq mf b">textarea</code>元素中显示适当的警告。好吧，让我们为它写一个测试用例。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="1bcb" class="mj ky iq mf b gy mk ml l mm mn">it("shows an error message for invalid CSS snippet", () =&gt; {<br/>    const inputCSSRule = "margin: 5";<br/>    const result = `Error translating CSS`;<br/>    cy.visit("/")<br/>      .get("[data-testid=input")<br/>      .type(inputCSSRule)<br/>      .get("[data-testid=output]")<br/>      .should((el) =&gt; {<br/>        expect(el).to.contain(result);<br/>      });<br/>  });</span></pre><ul class=""><li id="e301" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">如果输入元素<code class="fe mo mp mq mf b">textarea</code>为空，我们就有了一个占位符，等效的版本显示在输出元素<code class="fe mo mp mq mf b">textarea</code>上。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="297e" class="mj ky iq mf b gy mk ml l mm mn">it("generates the React Native equivalent of default CSS rule available as placeholder", () =&gt; {<br/>    const result = {<br/>      fontSize: 18,<br/>      lineHeight: 24,<br/>      color: "red",<br/>    };<br/>    cy.visit("/")<br/>      .get("[data-testid=output]")<br/>      .should((el) =&gt; {<br/>        expect(el).to.contain.text(JSON.stringify(result, null, 2));<br/>      });<br/>  });</span></pre><ul class=""><li id="4022" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv ni mx my mz bi translated">和JSS的对应方。</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="116d" class="mj ky iq mf b gy mk ml l mm mn">it("generates the JSS equivalent of default CSS rule available as placeholder", () =&gt; {<br/>    const result = {<br/>      fontSize: "18px",<br/>      lineHeight: "24px",<br/>      color: "red",<br/>    };<br/>    cy.visit("/")<br/>      .get("[data-testid=selectbox]")<br/>      .select("JSS")<br/>      .get("[data-testid=output]")<br/>      .should((el) =&gt; {<br/>        expect(el).to.contain.text(JSON.stringify(result, null, 2));<br/>      });<br/>  });</span></pre><p id="51a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">差不多就是这样。我们只了解了赛普拉斯提供的一些东西，请从<a class="ae kw" href="https://docs.cypress.io/guides/overview/why-cypress.html" rel="noopener ugc nofollow" target="_blank">官方文件</a>中了解更多。感谢您通读。</p><p id="523c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想了解我的工作，请在twitter上关注我。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="458a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nq">原载于2020年5月5日</em><a class="ae kw" href="https://dev.to/jamesgeorge007/let-s-write-e2e-tests-for-a-react-application-with-cypress-4a8i" rel="noopener ugc nofollow" target="_blank"><em class="nq">https://dev . to</em></a><em class="nq">。</em></p><h2 id="8236" class="mj ky iq bd kz nr ns dn ld nt nu dp lh kj nv nw ll kn nx ny lp kr nz oa lt ob bi translated"><strong class="ak">简明英语团队的笔记</strong></h2><p id="3ce2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">简明英语刚刚推出了一个YouTube频道！我们希望您现在就通过<a class="ae kw" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">订阅来支持我们！</strong> </a></p></div></div>    
</body>
</html>