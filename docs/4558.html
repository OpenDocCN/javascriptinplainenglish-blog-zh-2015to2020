<html>
<head>
<title>Super Easy NPM Package Patching with ‘patch-package’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用“补丁包”进行超级简单的NPM包修补</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/live-npm-package-patching-with-patch-package-b8f30d47779c?source=collection_archive---------4-----------------------#2020-12-21">https://javascript.plainenglish.io/live-npm-package-patching-with-patch-package-b8f30d47779c?source=collection_archive---------4-----------------------#2020-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e8cc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">轻松修补软件包。非常简单。</h2></div><p id="1bc0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">NPM套餐很棒。没有他们，我们作为开发人员的生活将会更加艰难。事实上，我可能会做些更有趣的事情来谋生。比如养猫。或者玩电锯杂耍。</p><p id="b480" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，尽管它们很棒，总有一天你使用的NPM软件包中会有一个bug。没问题吧？您在包的GitHub repo上创建了一个问题。或者，作为专业人员，您创建一个包含修复的拉请求。</p><p id="2db2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后你等待...</p><p id="fa7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且等待…</p><p id="9cc5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有……</p><p id="6b64" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是啊，不。这是不可接受的。</p><p id="49cc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以你派生出回购，并把它作为你的包源。或者你用你的叉子创建你自己的NPM包。</p><p id="f744" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果有更简单的方法不是很好吗？更简单的方法？</p><p id="07e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">进入<a class="ae lb" href="https://github.com/ds300/patch-package" rel="noopener ugc nofollow" target="_blank">补丁包</a>。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/7343003ad48666940f07adbbed6242e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xul_LK7S_BMhR25Gcrp-Aw.png"/></div></div></figure><p id="deec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">补丁包是我到目前为止发现的最简单的方法..修补程序包。</p><p id="c41c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是的，它确实和罐头上说的一样。</p><h2 id="d889" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">如何安装</h2><p id="54dc" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">安装非常简单。添加…</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="e50d" class="lo lp iq mn b gy mr ms l mt mu">"scripts": {<br/>  ...other scripts<br/>  "postinstall": "patch-package"<br/>}</span></pre><p id="aeea" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">…到您的<code class="fe mv mw mx mn b">package.json</code>文件，并使用yarn安装补丁包:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="9c54" class="lo lp iq mn b gy mr ms l mt mu">yarn add patch-package postinstall-postinstall</span></pre><p id="290a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能注意到我们实际上安装了两个包，即补丁包和安装后包。这两者一起工作，这一点稍后会变得清楚。</p><h2 id="7101" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">如何使用</h2><p id="9aaa" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">要使用修补程序包，请在node_modules 中的程序包代码中进行修改<em class="my">，然后运行<code class="fe mv mw mx mn b">patch-package</code>。就是这样！它将创建一个<code class="fe mv mw mx mn b">patches</code>文件夹，其中包含用您所做的更改更新您安装的软件包版本所需的差异。</em></p><h2 id="664d" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">活生生的例子</h2><p id="54f3" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">为了向您展示它是如何工作的，我将对<a class="ae lb" href="https://github.com/VansonLeung/react-native-keyboard-aware-view" rel="noopener ugc nofollow" target="_blank">react-native-keyboard-aware-view包</a>应用一个补丁。</p><p id="c0a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在撰写本文时，使用react-native-keyboard-aware-view包中的<code class="fe mv mw mx mn b">&lt;KeyboardAwareView&gt;</code>会导致以下警告:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mz"><img src="../Images/e6b7fc92f4d2fb7fe80b0697cbe48176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRhDRknRfpy1vHLIfgNFmQ.png"/></div></div></figure><p id="74e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这显然很糟糕。修复相当简单，在回购上至少有2个拉请求。但回购似乎已经死了。所以还是自己修吧。</p><p id="594d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们将打开文件<code class="fe mv mw mx mn b">node_modules/react-native-keyboard-aware-view\lib\CodeKeyboardAwareView.js</code>。然后我们查找方法调用<code class="fe mv mw mx mn b">Animated.timing</code>的所有实例，并将行<code class="fe mv mw mx mn b">useNativeDriver: false</code>添加到配置参数中(有3个实例)。</p><p id="ad17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们重新加载我们的应用程序，以确保警告已经消失。是的，所以我们成功地修补了这个包。</p><p id="8913" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们运行<code class="fe mv mw mx mn b">patch-package</code>:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi na"><img src="../Images/1ee75521155db8d2fa7b0541cb4e99f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTt5n4KF-PhE1-Mjj6ce4Q.png"/></div></div></figure><p id="ee4a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧啊。补丁包为我们创建了一个补丁文件。它的一个片段看起来像这样:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nb"><img src="../Images/e36f1e70b12b8718f57ae4cfaa134572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ztdmKn2ZGY4Ns12qASAmg.png"/></div></div></figure><p id="60d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这清楚地显示了我们所做的改变。</p><p id="0f13" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，因为我们安装了<code class="fe mv mw mx mn b">postinstall</code> yarn，所以每次我们安装新的软件包时，它都会运行我们的补丁。我们还可以通过不带参数运行<code class="fe mv mw mx mn b">patch-package</code>来强制安装补丁。</p><p id="c187" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是在等待你的PR(你<strong class="kh ir"/>还在创建PR，对吧)时，补丁包让修复你的本地代码中的一个bug变得多么容易。)合并到官方包中。</p><p id="ed4b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我发现<code class="fe mv mw mx mn b">patch-package</code>非常有用。我希望你也能。</p><p id="1052" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编码快乐！</p><p id="9250" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="my">更多内容请看</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="my">plain English . io</em></strong></a></p></div></div>    
</body>
</html>