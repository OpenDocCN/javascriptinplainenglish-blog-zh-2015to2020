<html>
<head>
<title>Fetching JavaScript Promises Simultaneously</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">同时获取JavaScript承诺</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/fetching-javascript-promises-simultaneously-91f17db70c2a?source=collection_archive---------5-----------------------#2020-05-07">https://javascript.plainenglish.io/fetching-javascript-promises-simultaneously-91f17db70c2a?source=collection_archive---------5-----------------------#2020-05-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/85b2ab4f226cc25359b2f20017cabdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NB457TbFOl6T9C6j1XnXeg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Fetching Sequentially 🙁</figcaption></figure><figure class="jz ka kb kc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5a74b974b3580e06c0f88f156a601bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVWKKk2paxBOBmrrKouw0w.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Fetching Simultaneously 😁</figcaption></figure><h2 id="0f7f" class="kd ke in bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">问题:获取多个文档</h2><p id="91e6" class="pw-post-body-paragraph kz la in lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ig bi translated">假设你正在开发一个新闻应用程序，比如Medium，在这里你有作者和文章。您决定将作者及其文章保存在Firebase的文档数据库中。</p><p id="d20d" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">当用户打开一篇文章时，需要从Firestore获取并显示两个文档:</p><ol class=""><li id="7c4c" class="lz ma in lb b lc lu lg lv km mb kq mc ku md lt me mf mg mh bi translated">用户简介文档:用于显示作者姓名和简介图片</li><li id="2c81" class="lz ma in lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated">文章文档:用于显示文章的实际内容</li></ol><p id="1e49" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">在我们的例子中，文章和作者文档id是预先知道的，因此这两个查询可以独立执行。</p><h1 id="b727" class="mn ke in bd kf mo mp mq ki mr ms mt kl mu mv mw kp mx my mz kt na nb nc kx nd bi translated">概念</h1><p id="1e80" class="pw-post-body-paragraph kz la in lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ig bi translated">等待多个提取承诺同时解决(O(1))比等待一个提取承诺在另一个之后完成(O(n))要快得多。</p><blockquote class="ne nf ng"><p id="79a9" class="kz la nh lb b lc lu le lf lg lv li lj ni lw ll lm nj lx lo lp nk ly lr ls lt ig bi translated">但是JavaScript不是单线程的吗？如何同时完成多项任务？—你说得对，查看页脚的免责声明。</p></blockquote><h1 id="6c57" class="mn ke in bd kf mo mp mq ki mr ms mt kl mu mv mw kp mx my mz kt na nb nc kx nd bi translated">糟糕的解决方案:获取并等待</h1><figure class="jz ka kb kc gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6e3a" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">以<code class="fe nn no np nq b">articleID</code>和<code class="fe nn no np nq b">authorId</code>为参数调用<code class="fe nn no np nq b">fetchArticle()</code>。</p><p id="9887" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">该函数通过等待承诺获取<code class="fe nn no np nq b">authorSnap</code>(第7行)，然后通过等待另一个承诺获取<code class="fe nn no np nq b">articleSnap</code>(第7行)。</p><p id="c95b" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">从快照中提取数据，并更新状态。</p><p id="65f0" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">我们正在等待这两个获取按顺序完成。👎</p><h1 id="abdb" class="mn ke in bd kf mo mp mq ki mr ms mt kl mu mv mw kp mx my mz kt na nb nc kx nd bi translated">好的解决方案:同时获取</h1><figure class="jz ka kb kc gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0f9e" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">再次以<code class="fe nn no np nq b">articleID</code>和<code class="fe nn no np nq b">authorId</code>为参数调用<code class="fe nn no np nq b">fetchArticle()</code>。</p><p id="8fbd" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">这一次，该函数同时执行<code class="fe nn no np nq b">authorPromise</code>和<code class="fe nn no np nq b">articlePromise</code>(注意await关键字已从第7行和第8行中删除)。然后作者和文章承诺被组合起来，我们等待两者都完成(第12行)。</p><p id="b034" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">然后，我们再次从快照中提取数据并更新状态。</p><p id="c414" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">我们正在等待两个获取同时完成。👍</p><h1 id="c1ec" class="mn ke in bd kf mo mp mq ki mr ms mt kl mu mv mw kp mx my mz kt na nb nc kx nd bi translated">感谢阅读👏</h1><p id="b0f7" class="pw-post-body-paragraph kz la in lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ig bi translated">更多内容请关注我的Medium和IG:<a class="ae nr" href="https://www.instagram.com/antonbegehr/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/antonbegehr/</a></p><h2 id="f2de" class="kd ke in bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">JavaScript承诺vs异步等待</h2><p id="abb5" class="pw-post-body-paragraph kz la in lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ig bi translated">如果您还没有这样做，请务必查看上周关于JavaScript Promises vs Async Await的文章，这里有两个在JavaScript中使用Promises的选项:</p><div class="ns nt gp gr nu nv"><a href="https://medium.com/javascript-in-plain-english/js-promise-then-catch-vs-async-await-try-catch-4827b07d0373" rel="noopener follow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">JavaScript承诺vs异步等待</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">Promise.then()。catch()与异步、等待、尝试、捕捉</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jt nv"/></div></div></a></div><h2 id="ea77" class="kd ke in bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">声明:JS是单线程的</h2><p id="e41a" class="pw-post-body-paragraph kz la in lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ig bi translated">单线程意味着JavaScript有一个调用栈和一个内存头。简单地说，代码是按顺序执行的:一个操作的执行必须在移到下一段代码之前完成。</p><p id="6dbf" class="pw-post-body-paragraph kz la in lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ig bi translated">因为JavaScript是单线程的，所以它一次只能发送一个HTTP获取请求。然而，获取数据的大部分时间都在等待响应。在等待承诺解决时，JavaScript可以执行其他操作。</p></div></div>    
</body>
</html>