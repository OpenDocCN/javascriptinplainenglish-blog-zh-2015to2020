<html>
<head>
<title>How to auto play/pause videos like Netflix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何像网飞一样自动播放/暂停视频</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/video-pause-play-like-netflix-8570f903e0ff?source=collection_archive---------9-----------------------#2020-09-13">https://javascript.plainenglish.io/video-pause-play-like-netflix-8570f903e0ff?source=collection_archive---------9-----------------------#2020-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="18db" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">交叉点观察器和页面可见性API使之成为可能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/071780023a0e42945ba5b84ccdf2d505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kcPiApIFYlhL0imx"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@purzlbaum?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">🇨🇭 Claudio Schwarz | @purzlbaum</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="67d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章并没有解释网飞是如何实现这个特性的，但是我们可以通过出色的交叉点观察器API和页面可见性API轻松实现这个特性。</p><p id="c785" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我告诉你它将会是什么——如果你去过网飞，他们在他们的浏览页面顶部有一个主要的视频部分，它会自动开始播放。他们自动播放和暂停，让用户体验无缝。他们做得很好的两件事是-</p><p id="61b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.当您滚动过视频预览部分时，它会暂停并在向上滚动时恢复。</p><p id="1a7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.当用户切换到另一个选项卡时，视频暂停，当您返回到浏览部分时，视频继续播放。</p><p id="796c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个可以通过交叉点观察器API实现，第二个可以通过页面可见性API实现。让我们看看下面的实现。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="5b15" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">我们正在使用的示例</h2><p id="225f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">这将是一个简单的香草JavaScript应用程序，我们有一个视频和一些随机文本。你可以在代码沙箱中看到它。目前它没有实现上述功能，视频继续播放(请单击播放控件播放视频，并取消静音以收听音频)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="12d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不得不在这里使用视频控件，因为据我所知，默认情况下我们不能自动播放带音频的视频。有人请让我知道这是否可以实现。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8d05" class="na ma iq bd mb nb nc nd me ne nf ng mh jw nh jx mk jz ni ka mn kc nj kd mq nk bi translated">交叉点观察器API</h1><p id="ff75" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">如果你不知道这个API是如何工作的，请看看我以前的一篇<a class="ae kv" href="https://medium.com/javascript-in-plain-english/intersection-observer-928a0ce309" rel="noopener">文章</a>，这篇文章通过例子深入探讨了它的功能。</p><blockquote class="nl"><p id="8042" class="nm nn iq bd no np nq nr ns nt nu lr dk translated">基本上，这个API提供了一种简单的方法来观察和注册当页面上的元素进入视图时触发的回调。</p></blockquote><p id="53aa" class="pw-post-body-paragraph kw kx iq ky b kz nv jr lb lc nw ju le lf nx lh li lj ny ll lm ln nz lp lq lr ij bi translated">我们将抓取视频元素并用观察者API观察它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa my l"/></div></figure><p id="a233" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是我们在上面所做的:</p><ul class=""><li id="4b88" class="ob oc iq ky b kz la lc ld lf od lj oe ln of lr og oh oi oj bi translated">从页面中选择的视频元素。</li><li id="1385" class="ob oc iq ky b kz ok lc ol lf om lj on ln oo lr og oh oi oj bi translated">创建了交叉点观察器API的实例，并遍历了感兴趣的条目。然后，我们检查视频是否与视口不相交，如果不相交，我们暂停它，否则我们播放它。</li><li id="3934" class="ob oc iq ky b kz ok lc ol lf om lj on ln oo lr og oh oi oj bi translated">最后观察了视频元素。</li></ul><p id="e522" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是沙盒:<a class="ae kv" href="https://codesandbox.io/s/video-with-intersection-observer-gt6mk" rel="noopener ugc nofollow" target="_blank">https://code sandbox . io/s/video-with-intersection-observer-gt6mk</a></p><h2 id="dee5" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">结果:</h2><p id="c032" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">尝试将页面滚动到视频部分，视频将暂停，一旦向上滚动将继续播放。实现了第一步。现在让我们讨论第二个目标。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="67a0" class="na ma iq bd mb nb nc nd me ne nf ng mh jw nh jx mk jz ni ka mn kc nj kd mq nk bi translated">页面可见性API</h1><p id="c930" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">先说一些基础的。这个API用于检测空闲的浏览器标签。使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API" rel="noopener ugc nofollow" target="_blank">页面可见性API </a>，我们可以检测到用户何时没有查看我们的网站/与我们的网站进行交互，以帮助他们节省宝贵的计算资源！</p><p id="e764" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">页面可见性API是在2011年引入的，它包括几个添加到文档对象中的功能:</p><ul class=""><li id="99af" class="ob oc iq ky b kz la lc ld lf od lj oe ln of lr og oh oi oj bi translated"><strong class="ky ir"> document.hidden </strong>:一个只读属性，当选项卡/窗口隐藏时返回true</li><li id="d497" class="ob oc iq ky b kz ok lc ol lf om lj on ln oo lr og oh oi oj bi translated"><strong class="ky ir"> document.visibilityState </strong>:只读属性，返回表示选项卡/窗口状态的字符串值:“隐藏“|”可见“|”先决条件”</li><li id="822c" class="ob oc iq ky b kz ok lc ol lf om lj on ln oo lr og oh oi oj bi translated"><strong class="ky ir"> visibilitychange </strong>:每当选项卡/窗口的可见性改变时发出的事件</li></ul><p id="10d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我们的场景，我们将监听文档上的<strong class="ky ir"> visibilityChange </strong>事件，并决定需要采取什么行动。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa my l"/></div></figure><p id="eeae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它只是这样做——当文档被隐藏/切换标签时暂停视频，否则播放它。</p><p id="73f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">沙盒:<a class="ae kv" href="https://codesandbox.io/s/video-with-page-visibility-api-yzbm6" rel="noopener ugc nofollow" target="_blank">https://code sandbox . io/s/video-with-page-visibility-API-yzbm 6</a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="89b3" class="na ma iq bd mb nb nc nd me ne nf ng mh jw nh jx mk jz ni ka mn kc nj kd mq nk bi translated">两个API一起</h1><p id="726b" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">以下是全部代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa my l"/></div></figure><p id="bf60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">唯一的变化是这里增加了<strong class="ky ir"> playState </strong>变量，确保视频状态保持一致。如果我们没有此布尔检查，您可以通过执行以下操作来查看此<a class="ae kv" href="https://codesandbox.io/s/playpause-inconsitency-pnx0t" rel="noopener ugc nofollow" target="_blank">沙箱</a>中发生的问题:</p><ul class=""><li id="2bde" class="ob oc iq ky b kz la lc ld lf od lj oe ln of lr og oh oi oj bi translated">滚动视频。由于交叉点观察器API，视频现在应该暂停</li><li id="16cf" class="ob oc iq ky b kz ok lc ol lf om lj on ln oo lr og oh oi oj bi translated">切换到另一个选项卡。由于页面可见性检查，视频应保持暂停。</li><li id="390b" class="ob oc iq ky b kz ok lc ol lf om lj on ln oo lr og oh oi oj bi translated">切换回沙盒标签，你会注意到视频恢复。这不是我们想要的行为，因为我们只想在视口中播放它。因此我们需要支票。</li></ul><p id="19ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是最终的工作沙箱:<a class="ae kv" href="https://codesandbox.io/s/video-with-intersection-observer-gt6mk" rel="noopener ugc nofollow" target="_blank">https://code sandbox . io/s/video-with-intersection-observer-gt6mk</a></p><p id="4b55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还创建了一个网飞的基本克隆。在这里你可以看到相同的功能实现:<a class="ae kv" href="https://netflixx-8b384.firebaseapp.com/" rel="noopener ugc nofollow" target="_blank">https://netflixx-8b384.firebaseapp.com/</a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ac29" class="na ma iq bd mb nb nc nd me ne nf ng mh jw nh jx mk jz ni ka mn kc nj kd mq nk bi translated">资源</h1><div class="op oq gp gr or os"><a href="https://alligator.io/js/page-visibility-api/" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">如何用页面可见性API检测空闲的浏览器标签</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">你有没有想过背景标签/窗口是否使用电池电源，或者宝贵的CPU时间？使用页面可见性…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">鳄鱼. io</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg kp os"/></div></div></a></div><div class="op oq gp gr or os"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">交叉点观察器API</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">交叉点观察器API提供了一种异步观察目标元素交叉点变化的方法…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">developer.mozilla.org</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg kp os"/></div></div></a></div><div class="op oq gp gr or os"><a href="https://medium.com/javascript-in-plain-english/intersection-observer-928a0ce309" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">交叉观察者</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">导航风格和惰性加载变得容易</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">medium.com</p></div></div><div class="pb l"><div class="pi l pd pe pf pb pg kp os"/></div></div></a></div><h2 id="75b4" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">简单英语的JavaScript</h2><p id="726d" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="ky ir">！</strong></p></div></div>    
</body>
</html>