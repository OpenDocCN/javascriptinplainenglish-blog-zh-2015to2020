<html>
<head>
<title>Getting started with Realm for React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native领域入门</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-realm-for-react-native-c15e72c96758?source=collection_archive---------0-----------------------#2020-12-30">https://javascript.plainenglish.io/getting-started-with-realm-for-react-native-c15e72c96758?source=collection_archive---------0-----------------------#2020-12-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="43c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://realm.io/docs/javascript/latest/" rel="noopener ugc nofollow" target="_blank"><em class="kj">Realm Database</em></a><em class="kj">让你的React原生app轻松保存和操作数据库中的数据。</em></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/1be18be80dea2f7c36c0653dbb5efb97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lSbm5so0zwaSZFwh0BlXfg.jpeg"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Photo by <a class="ae ki" href="https://unsplash.com/@oskaryil?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Oskar Yildiz</a> on <a class="ae ki" href="https://unsplash.com/s/photos/app-development?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2db0" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">介绍</h1><p id="4044" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">Realm是一个库，用于保存在重新加载和重新启动时持久保存的数据。以这种方式处理数据的其他方法是使用AsyncStorage或SQLite。</p><p id="43fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用SQLite，您会发现自己在编写查询，而在Realm中，您可以像访问JavaScript中的对象一样访问数据。</p><p id="5b9a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇博客中，我将尝试向您展示如何在您的下一个React本机应用程序中安装和使用Realm数据库。完成的代码将在Github上提供，并由我在我的三星Galaxy S6 Edge上进行测试。</p><p id="5a88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">注意:Expo不能和Realm一起使用。</em></p><h2 id="c102" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">动机</h2><p id="8784" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">当我第一次使用Realm时，我一直在努力让它工作。我看过的所有教程都包含了太多的信息。我希望这个指南更简洁，并鼓励其他人使用Realm，因为在我看来它是SQLite的一个很好的替代品。</p><h1 id="5a47" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">安装和设置</h1><p id="3559" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">我将假设您以前已经用React Native制作了一个应用程序，并且您已经遵循了他们为React Native CLI设置的<a class="ae ki" href="https://reactnative.dev/docs/environment-setup" rel="noopener ugc nofollow" target="_blank">开发环境。</a></p><p id="b05f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">打开你的cmd，创建一个新的React原生应用。</p><pre class="kl km kn ko gt mp mq mr ms aw mt bi"><span id="677e" class="md lb in mq b gy mu mv l mw mx">npx react-native init RealmExample</span></pre><p id="7b2e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">进入新文件夹，运行你的应用程序，确保一切正常。我在连接到我电脑的安卓手机上运行它。这一步可能需要几分钟(或10分钟)。</p><pre class="kl km kn ko gt mp mq mr ms aw mt bi"><span id="9d4f" class="md lb in mq b gy mu mv l mw mx">cd RealmExample &amp;&amp; npx react-native run-android</span></pre><p id="fc8b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切正常，进入app.js并删除所有默认元素，直到只剩下这个。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d9d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你现在应该在你的手机或模拟器上看到一些文本，没有其他内容。你可以随心所欲地设计应用程序。我会把它保持在最低限度。</p><h2 id="6814" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">安装领域</h2><p id="c4bc" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">现在我们已经设置了我们的应用程序，是时候安装Realm了。</p><pre class="kl km kn ko gt mp mq mr ms aw mt bi"><span id="f383" class="md lb in mq b gy mu mv l mw mx">npm install realm --save</span></pre><p id="d7bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">注意:我过去在安装领域</em><a class="ae ki" href="https://docs.mongodb.com/realm/react-native/install#std-label-react-native-install" rel="noopener ugc nofollow" target="_blank"><em class="kj"/></a><em class="kj">时遇到过一些问题。这可能是因为React Native或React的版本已过期。请尝试更新它们，然后重试。</em></p><h1 id="d966" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">制作图书模式</h1><p id="733d" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">领域使用模式。为了简单起见，我们将创建一个包含所有领域代码的Database.js文件，从中我们可以导出函数以在组件和页面中使用。</p><p id="56be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们创建Database.js文件，并为一本书添加模式。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="adfd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经为book对象创建了一个模式。一本书包含所需的属性title和pages，它们分别是string和int类型。我们还为图书版本添加了一个可选的(可以为空)属性。如果它不是null，它必须是一个int。</p><p id="66dc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还用我们的模式创建我们的Realm对象，并导出它。请注意schemaVersion是如何设置为1的，稍后当我们添加一个用于向一本书添加作者的属性时，这将会改变。</p><h2 id="67af" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">添加数据</h2><p id="129a" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">现在我们要添加一些测试数据。我创建了一个小的for循环来创建三本书。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="fc7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个for循环被粘贴到return语句之前的app.js中。我让它跑了一次。之后我就把它注释掉了。如果它运行得更频繁，这没什么大不了的。无论如何，我们最终都会删除测试数据。</p><h2 id="9c48" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">查看数据</h2><p id="9365" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">在数据库中拥有数据很有趣，但是我们如何才能看到它呢？有一种方法可以使用Realm的Realm studio并浏览Android中的文件，但如果你使用的是物理设备，那么让它工作起来就很麻烦了。</p><p id="9c9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们添加一个函数来检索所有书籍并将其导出，以便我们可以在app.js中访问它。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c8c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将这几行添加到Database.js中。我们使用realm.objects('Book ')检索书籍。这将返回一个我们可以查看的JSON对象。您可以添加console.log()来查看控制台中的对象。</p><p id="a270" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过编辑导入和文本元素，您还可以看到它是如何工作的。像这样。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="bbe7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切都是正确的，您将看到一个JSON字符串，其中包含一组书籍，有一个标题，400页，edition的值为空。</p><p id="afcb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可以想象，您现在可以随心所欲地处理这些数据。您可以在书籍数组中循环显示一个漂亮的列表。让我们开始吧。</p><h2 id="4d8d" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">制作一个可视列表</h2><p id="3485" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">我们将使用React Native中的<a class="ae ki" href="https://reactnative.dev/docs/flatlist" rel="noopener ugc nofollow" target="_blank"> FlatList </a>组件来正确显示我们的图书。</p><p id="66f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">移除app.js中的<text>元素，用这个平面列表替换它。</text></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8599" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">确保为制作此平面图导入适当的东西。</em></p><p id="074f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这段代码简单地从我们从<em class="kj"> getAllBooks </em>函数获得的数据中创建了一个列表。它创建了一个包含三个文本的视图，每个文本包含图书数据的一个值。</p><p id="8b96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">如果您没有看到任何数据，请确保您的代码是正确的，并通过执行我们之前看到的代码再次尝试添加数据。</em></p><h2 id="b51a" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">添加和删除数据</h2><p id="29b7" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">现在我们可以看到数据，我们希望能够通过单击按钮来添加或删除它。</p><p id="37a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们在Database.js中添加两个函数来添加新记录和删除所有数据。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2282" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">阅读这些函数，并试着理解它是如何工作的。</p><p id="5ce6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们调用<strong class="jm io"> realm.write </strong>来准备realm改变一些东西。在realm.write中，我们根据我们的模式创建了一本新书。我们在函数中添加了一些参数，这样我们就可以添加包含我们想要的数据的书籍。</p><p id="e1f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">删除所有书籍的方法是首先获取所有书籍，然后删除数据。这个<em class="kj">可能</em>以后会更有意义。但是基本上您可以在一次写操作中修改数据库中的数据。但是你可以在后面读到更多。</p><p id="43ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们在平面列表上添加两个按钮！我将简单地添加两个带有onPress属性的文本组件和一些非常简单的样式。</p><h2 id="3408" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">添加按钮</h2><p id="f20b" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">我添加了两个按钮，onPresses和使用useState钩子添加状态。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2fb5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果到目前为止所有代码都工作正常，那么恭喜你。到目前为止，代码可以通过单击两个按钮来添加数据和删除所有记录。</p><p id="9107" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">嘶。如果你有困难，</em> <a class="ae ki" href="https://gist.github.com/mbvissers/915695269384085d98327c1b521c701c" rel="noopener ugc nofollow" target="_blank"> <em class="kj">这里是app.js </em> </a> <em class="kj">到目前为止，</em> <a class="ae ki" href="https://gist.github.com/mbvissers/577c5200454b85f4d27b3d8aefc80520" rel="noopener ugc nofollow" target="_blank"> <em class="kj">这里是Database.js </em> </a> <em class="kj">到目前为止。</em></p><p id="ce3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">显而易见，下一步是添加用于添加数据的输入字段。但是我说不。我很确定你知道如何改变参数和增加输入。</p><p id="f4b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">提示:如果你不理解大部分代码，花点时间通读一遍，试着理解它。理解它比复制粘贴代码更重要。</p><h2 id="f141" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">更新数据</h2><p id="47a2" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">现在我们只需要看看如何更新数据。之后，我们可以在book模式中添加author属性。</p><p id="b277" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们添加另一个按钮，将版本为null的所有记录更新为版本1。</p><p id="88cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第一步是在我们的Database.js中创建一个函数，该函数将所有的空版本值更新为1。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="83a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以看到，在realm.write函数中，我们得到所有的书，我们使用<a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank"> map() </a>函数对它们进行循环，如果版本等于null，它就将它设置为1。</p><p id="4cae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加这个方法，在你的app.js里面像这样添加一个新的按钮。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3035" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果所有版本为空，按钮会将它们设置为1，然后重新加载我们的状态，这样我们的页面就会更新。就像其他按钮一样。</p><p id="87ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当您按下“新建”按钮时，记录应该全部更新为新的版本值。</p><h2 id="d60b" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">选择记录</h2><p id="7273" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">我们拥有的当然是美好的。但是如果我们只想选择特定的书呢？让我们通过选择所有超过400页的书来尝试一下。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="bc04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我们的新功能。你可以把它换出来，把这个函数放在初始状态加载，看看它的效果。不过要确保你有一本书符合你的条件。</p><p id="3024" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以在这里阅读更多关于查询数据<a class="ae ki" href="https://realm.io/docs/javascript/latest/#queries" rel="noopener ugc nofollow" target="_blank">的内容。在王国的官方文件中。但是我们稍后会讨论更多的问题。</a></p><p id="c6cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://gist.github.com/mbvissers/9b9b2aa271fb12c078f1107b6fc55e8c" rel="noopener ugc nofollow" target="_blank"> <em class="kj">这里是app.js </em> </a> <em class="kj">到目前为止，这里的</em> <a class="ae ki" href="https://gist.github.com/mbvissers/274ba8211b253c8e5d8abfc347ed1d6d" rel="noopener ugc nofollow" target="_blank"> <em class="kj">是Database.js </em> </a> <em class="kj">到目前为止。</em></p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="7035" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到目前为止，我们已经做了很多。去伸展一下。喝点水，休息一下。之后，让我们继续。</p><h1 id="897d" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">更新模式</h1><p id="629f" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">一本书通常有一个作者。但是我们目前不支持。让我们解决这个问题。</p><p id="2b29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们希望为我们的作者拥有一个单独的“表”，而一个新的“表”需要一个新的模式，所以让我们添加一个新的模式。我们还需要更新Bookschema来添加作者，并更新我们的Realm对象。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="570f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的Database.js现在包含了这段代码。这是一些更新的代码，和一些新的代码。仔细看。我们还更新了schemaVersion。</p><p id="316a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还将作者值设置为BookSchema中的一个可选字段，这样我们就不会出现任何错误，因为我们现有的书籍没有任何作者。您还可以添加一个默认作者或删除所有现有书籍，这样模式差异就不是问题了。</p><p id="f115" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我还增加了一个新栏，在我们的应用程序中显示我们书籍的作者姓名。该列被添加到平面列表中。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e540" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果作者为空，则只显示“空”，否则将显示作者的全名。</p><p id="6d05" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了利用我们新的作者字段，我们需要更新<em class="kj"> addBook </em>来包含一个作者。我还创建了一个函数来获取所有作者。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="a19e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您可以通过调用更新的addBook函数并使用它添加一个author对象来添加一本书的作者。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3bc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">新作者会自动按领域添加到作者“表”中。如果您添加另一个包含所有作者的平面列表，就可以看到这一点。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5470" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们为作者添加了一个新的状态和一个新的列表。如果你添加了一本有作者的书，你会看到它会出现在第二个列表中。</p><p id="cc7c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你删除所有书籍，作者将保持可用。</p><p id="e879" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可能已经注意到，这将为每本书添加一个新的author对象，即使是同一作者。让我们解决这个问题。</p><p id="e85c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要函数来创建一个作者，一个函数来获取一个作者。您很可能希望通过id来检索它们。因此，让我们更新代码，为作者添加一个<strong class="jm io">主键</strong> id。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3bbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">如果您因为现有作者中没有ID而遇到问题，您现在可以删除所有数据或省略“primaryKey: id”。</em></p><p id="00da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加一些独特的作者一起工作。我将通过使用一些随机参数和id的0、1和2调用addAuthor函数来创建三个。</p><p id="0560" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">也删除所有书籍。</p><p id="c6bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们添加一些作者来自我们的作者表的书籍。</p><p id="de8a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们首先需要的是一个按ID获取作者的函数。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8068" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们使用JavaScript <a class="ae ki" href="https://developer.mozilla.org/nl/docs/Web/JavaScript/Reference/Template_literals" rel="noopener ugc nofollow" target="_blank">模板文字</a>将参数添加到字符串中。简单地将数字附加到字符串上也是可行的。</p><p id="a5ee" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将该函数添加到您的导出中，并更新addBook中的onPress按钮，以添加带有作者ID的图书。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="a3bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">加几本书看看。不会有新作者了。</p><p id="e39d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可能还(没有)注意到，在addBook函数中，我们获取getAuthorById返回的数组的第一个元素。因为我们知道它应该只返回1个对象，所以我们可以非常安全地用[0]获得第一个元素。</p><h2 id="be17" class="md lb in bd lc me mf dn lg mg mh dp lk jv mi mj lo jz mk ml ls kd mm mn lw mo bi translated">更新单个记录</h2><p id="c9a0" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">更新单个记录与我们之前更新所有记录一样。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c2a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在realm.write中，您获得一条记录，并像普通的JavaScript对象一样对其进行更改。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="2214" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">恭喜你走到这一步。本教程到此结束。</p><p id="de56" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">嘶。</em> <a class="ae ki" href="https://gist.github.com/mbvissers/cba1a37a933d96d8ca873abc16cdaff5" rel="noopener ugc nofollow" target="_blank"> <em class="kj">这里是要点</em> </a> <em class="kj">找到我们到目前为止所做的代码。</em></p><p id="6f5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望它是有用的，并且您已经了解了开始学习所需的一切。</p><p id="04b2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请继续阅读，找出你自己尝试的内容，并查看我使用所有这些代码完成的最终GitHub项目。和一些让你生活更轻松的小技巧。</p><h1 id="c8aa" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">下一步是什么？</h1><p id="4fd5" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">你可以更新这个项目，并尝试添加按钮，文本字段，也许新的模式，以在书中包括id，添加一些章节，为流派添加一个新的模式，等等。玩得开心，祝你好运。</p><h1 id="0aae" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">技巧</h1><p id="2270" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">A.自动增加id的一个简单方法是检索最大的ID，并在addAuthor函数中给它加1。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8d1a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">B.另一个技巧是，无论何时使用Realm，都要尝试创建一个测试页面。以便您可以快速查看和添加数据。</p><p id="8140" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">C.阅读<a class="ae ki" href="https://realm.io/docs/javascript/latest/" rel="noopener ugc nofollow" target="_blank">文档</a>。有几种方法可以声明类型，类型比我之前介绍的多得多，要执行的查询也多得多。</p><p id="3602" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">D.“添加日期”列的日期对象很容易创建。将模式中的类型设置为“date”，并在create函数中将其设置为“new Date()”。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="b9c2" class="la lb in bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">GitHub项目</h1><p id="7928" class="pw-post-body-paragraph jk jl in jm b jn ly jp jq jr lz jt ju jv ma jx jy jz mb kb kc kd mc kf kg kh ig bi translated">为了可用性，我稍微更新了我们在这里做的项目。只是多了几个按钮和稍微更新的样式。你可以在这里找到<a class="ae ki" href="https://github.com/mbvissers/RealmExampleApp" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0523" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">祝你学习顺利，玩得开心。感谢您的阅读。</p></div></div>    
</body>
</html>