<html>
<head>
<title>Useful JavaScript Tips — Query Strings Rounding, and URLs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有用的JavaScript技巧—查询字符串舍入和URL</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/useful-javascript-tips-query-strings-rounding-and-urls-c53b4153cf40?source=collection_archive---------12-----------------------#2020-07-04">https://javascript.plainenglish.io/useful-javascript-tips-query-strings-rounding-and-urls-c53b4153cf40?source=collection_archive---------12-----------------------#2020-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/359a74e01db451f47beffd32c8e881f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*COf5vcRb77zVeZTN"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lutzelhof?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alfred Lutz</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0ff5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解一些应该遵循的技巧，以便更快更好地编写JavaScript代码。</p><h1 id="29a5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取查询字符串值</h1><p id="ade9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript的标准库有<code class="fe me mf mg mh b">URLSearchParams</code>构造函数，可以用来提取查询参数并让我们搜索它们。</p><p id="d8a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4599" class="mq lc iq mh b gy mr ms l mt mu">const urlParams = new URLSearchParams(window.location.search);<br/>const val  = urlParams.get('key');</span></pre><p id="0e97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">window.location.search</code>返回URL的查询字符串部分。</p><p id="7263" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">get</code>方法通过查询参数的键获取值。</p><h1 id="0031" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将数字四舍五入到最多两位小数</h1><p id="f6cc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">Math.round</code>让我们四舍五入到小数点后两位。</p><p id="7cd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2a9c" class="mq lc iq mh b gy mr ms l mt mu">Math.round(num * 100) / 100</span></pre><p id="e6c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">num</code>乘以100，四舍五入，然后除以100，得出一个最多有两位小数的数字。</p><p id="cc03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果有少于第一百位的十进制数字，那么我们在乘以100之前加上<code class="fe me mf mg mh b">Number.EPSILON</code>。</p><p id="13bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b78b" class="mq lc iq mh b gy mr ms l mt mu">Math.round((num + Number.EPSILON) * 100) / 100</span></pre><p id="a600" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用<code class="fe me mf mg mh b">parseFloat</code>和<code class="fe me mf mg mh b">toFixed</code>将一个数字格式化为一个包含两位小数的字符串。</p><p id="da77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3d1e" class="mq lc iq mh b gy mr ms l mt mu">parseFloat("575.393").toFixed(2);</span></pre><h1 id="6b6a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将字符串转换为布尔值</h1><p id="769c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下代码将字符串<code class="fe me mf mg mh b">'true'</code>和<code class="fe me mf mg mh b">'false'</code>转换为它们对应的布尔值:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fd8e" class="mq lc iq mh b gy mr ms l mt mu">val === 'true'</span></pre><p id="a399" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设<code class="fe me mf mg mh b">val</code>可以设置为<code class="fe me mf mg mh b">'true'</code>或<code class="fe me mf mg mh b">'false'</code>，我们只需与<code class="fe me mf mg mh b">'true'</code>进行比较即可。</p><h1 id="e9e2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将对象存储在本地存储中</h1><p id="51c4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要在本地存储中存储一个对象，我们必须先把它转换成一个字符串。</p><p id="55f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8bd7" class="mq lc iq mh b gy mr ms l mt mu">const obj = { 'foo': 1, 'bar': 2, 'baz': 3 };<br/>localStorage.setItem('data', JSON.stringify(obj));</span></pre><p id="a909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在调用<code class="fe me mf mg mh b">setItem</code>之前，我们调用了<code class="fe me mf mg mh b">JSON.stringify</code>来将带有<code class="fe me mf mg mh b">key</code>数据的stringified对象存储在本地存储中。</p><p id="5457" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">JSON.stringify</code>不会保留<code class="fe me mf mg mh b">undefined</code>、函数、<code class="fe me mf mg mh b">Infinity</code>和正则表达式，所以我们必须小心。</p><h1 id="8149" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">合并两个或更多对象</h1><p id="7f48" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用扩展操作符或<code class="fe me mf mg mh b">Object.assign</code>将两个或更多对象的属性合并在一起。</p><p id="1a3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="48c5" class="mq lc iq mh b gy mr ms l mt mu">const merged = {...obj1, ...obj2, ...obj3};</span></pre><p id="8d10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0048" class="mq lc iq mh b gy mr ms l mt mu">const merged = Object.assign({}, obj1, obj2, obj3, etc);</span></pre><p id="73dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两段代码都将<code class="fe me mf mg mh b">obj1</code>、<code class="fe me mf mg mh b">obj2</code>和<code class="fe me mf mg mh b">obj3</code>的属性填充到一个空对象中。</p><h1 id="81dc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检测元素外部的单击</h1><p id="ab06" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以调用<code class="fe me mf mg mh b">stopPropagation</code>来阻止我们从外部检查点击的元素的点击事件。</p><p id="3ebc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4825" class="mq lc iq mh b gy mr ms l mt mu">window.addEventListener('click', () =&gt; {<br/>  // do something when clicked outside<br/>});</span><span id="0192" class="mq lc iq mh b gy mv ms l mt mu">document.querySelector('#menucontainer').click((event) =&gt; {<br/>  event.stopPropagation();<br/>});</span></pre><p id="e2af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">window</code>的<code class="fe me mf mg mh b">click</code>事件处理程序让我们在用户点击外部时运行代码。</p><h1 id="116e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">刷新页面</h1><p id="5674" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">用JavaScript刷新页面有很多方法，</p><p id="38ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以做到:</p><ul class=""><li id="6b85" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated"><code class="fe me mf mg mh b">location.reload();</code></li><li id="913d" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe me mf mg mh b">history.go(0)</code></li><li id="d765" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe me mf mg mh b">location.href = location.href</code></li><li id="0de4" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe me mf mg mh b">location.href = location.pathname</code></li><li id="c4ba" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe me mf mg mh b">location.replace(location.pathname)</code></li><li id="77f8" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe me mf mg mh b">location.reload(false)</code></li></ul><p id="4c84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">location.pathname</code>是相对URL。</p><p id="87c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">history.go</code>也通过重新加载同一页面来刷新。</p><h1 id="b603" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">漂亮的打印JSON</h1><p id="2bfc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">JSON.stringify</code>方法美化JSON。</p><p id="1a18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c8bc" class="mq lc iq mh b gy mr ms l mt mu">const str = JSON.stringify(obj, null, 2);</span></pre><p id="ce00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2表示我们缩进2个空格。</p><h1 id="cce4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将命令行参数传递给Node.js程序</h1><p id="c5d2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">节点程序可以访问<code class="fe me mf mg mh b">process.argv</code>属性来获取程序的所有命令行参数。</p><p id="63d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="56cb" class="mq lc iq mh b gy mr ms l mt mu">for (const a of process.argv){<br/>  console.log(a)<br/>}</span></pre><p id="169c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数总是<code class="fe me mf mg mh b">'node'</code>。第二个总是我们运行的文件的路径。</p><p id="f4b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其余的是其他命令行参数。</p><h1 id="d41d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查十进制数</h1><p id="4e53" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过使用<code class="fe me mf mg mh b">isNaN</code>函数和<code class="fe me mf mg mh b">isFinite</code>函数来检查十进制数。</p><p id="4e72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了进行检查，我们编写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e10d" class="mq lc iq mh b gy mr ms l mt mu">!isNaN(parseFloat(n)) &amp;&amp; isFinite(n);</span></pre><p id="286b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">parseFloat</code>将字符串解析成浮点数。</p><p id="f2ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">isNaN</code>检查返回值是否为<code class="fe me mf mg mh b">NaN</code>。</p><p id="256d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">isFinite</code>检查数字或数字串是否代表有限的数字。</p><h1 id="b516" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">修改URL而不重新加载页面</h1><p id="bed3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">无需用JavaScript重新加载页面就可以修改URL。</p><p id="5960" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">window.history.pushState</code>让我们向浏览历史添加一个新的URL。</p><p id="4d51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9fd7" class="mq lc iq mh b gy mr ms l mt mu">window.history.pushState('foo', 'title', '/foo.html');</span></pre><p id="fa1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是状态对象。</p><p id="7e12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">popstate</code>来获取参数的值。</p><p id="9dec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">'title'</code>是标题，在大多数浏览器中被忽略。</p><p id="0cfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">'/foo.html'</code>是要写入浏览历史的URL。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/a2558decff6d6caf641e133b281faba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9_DsEU2DT3At5-AV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@katekerdi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Katerina Kerdi</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f924" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="416d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">URLSearchParams</code>构造函数让我们将查询字符串解析成一个我们可以查找的有用对象。</p><p id="c00a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">Math.round</code>将一个数字四舍五入到小数点后两位。</p><p id="7b07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以更改URL并将其添加到浏览历史中，而无需重新加载页面。</p><h2 id="c3c8" class="mq lc iq bd ld nl nm dn lh nn no dp ll ko np nq lp ks nr ns lt kw nt nu lx nv bi translated">简单英语中的JavaScript</h2><p id="fdf3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有四个出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到他们所有人。点击</strong> </a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>