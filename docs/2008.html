<html>
<head>
<title>Firebase Cloud Functions Tutorial — Firestore Trigger Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase云函数教程— Firestore触发函数</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/firebase-cloud-functions-tutorial-firestore-trigger-functions-90bb3c3f9ea8?source=collection_archive---------2-----------------------#2020-05-12">https://javascript.plainenglish.io/firebase-cloud-functions-tutorial-firestore-trigger-functions-90bb3c3f9ea8?source=collection_archive---------2-----------------------#2020-05-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f02a294c56b687d448b4f827ab3e87bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFzA6xKQcmfkmfx-lixiIQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Cloud Firestore Triggers</figcaption></figure><p id="7674" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">众所周知，Firebase是我最喜欢的工具之一。他们的团队使得在创纪录的时间内开发一个应用程序变得如此容易。在我的上一篇文章中，我们介绍了如何使用Firebase函数创建一个<a class="ae la" href="https://medium.com/javascript-in-plain-english/firebase-cloud-functions-tutorial-creating-a-rest-api-8cbc51479f80" rel="noopener"> REST API。虽然这是一个好的开始，但是还有很多事情要做。</a></p><p id="581d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本教程中，我们将介绍Firebase函数触发器，以及如何使用它们来简化开发。有了它们，我们可以监听Firestore表、存储桶、身份验证请求等等。然后我们可以在特定事件发生时执行代码。</p><p id="77cb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本教程中，我们将介绍云Firestore触发功能。这些只是您可以采取的不同侦听器和操作的几个示例。显然，您还可以做更多的事情，但是这应该会让您对这些事情有一个很好的了解。</p><h1 id="9299" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">云Firestore触发器</h1><p id="63f9" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">云Firestore触发器允许您在编写、创建、更新或删除文档时执行代码。您需要做的就是指定文档路径和事件。那么当特定事件发生时，您将触发触发器。</p><h1 id="b511" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">视频教程</h1><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Cloud Firestore Triggers Video Tutorial</figcaption></figure><h2 id="978e" class="mk lc iq bd ld ml mm dn lh mn mo dp ll kn mp mq lp kr mr ms lt kv mt mu lx mv bi translated">onCreate</h2><p id="33e1" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">这将在首次写入文档时触发。我最喜欢在发送推送通知的时候使用它。您可以创建一个通知表，并在每次想要发送推送通知时写入该表。</p><p id="636e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">文档结构<br/> </strong>在通知集合内部，从具有以下结构的客户端或API创建文档:</p><pre class="me mf mg mh gt mw mx my mz aw na bi"><span id="3d3a" class="mk lc iq mx b gy nb nc l nd ne">{<br/>  fcmToken: "1234",<br/>  message: "Test push notification,<br/>  title: "Test"<br/>}</span></pre><p id="1e3d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> onCreate Cloud Firestore触发器<br/> </strong>在上述文档创建完成后，该触发器将被触发:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nf mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">onCreate Cloud Firestore Trigger for Push Notifications</figcaption></figure><h2 id="43f5" class="mk lc iq bd ld ml mm dn lh mn mo dp ll kn mp mq lp kr mr ms lt kv mt mu lx mv bi translated">onUpdate</h2><p id="8446" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Firestore等NoSQL数据库最大的优点之一就是可伸缩性。但是，为了获得可伸缩性，您将复制数据。如果用户在一个表中更新他们的数据，而您还需要更新另一个表中的数据，这可能会变得很麻烦。</p><p id="2aa3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如，如果我们有一个带有用户名的用户集合，但也有一个引用该用户名的评论集合。当用户在用户集合中更新用户名时，我们也需要在评论集合中更新用户名。</p><p id="2a97" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">用户文档</strong></p><pre class="me mf mg mh gt mw mx my mz aw na bi"><span id="e7fd" class="mk lc iq mx b gy nb nc l nd ne">{<br/>  firstName: "Diligent",<br/>  lastName: "Dev",<br/>  userName: "TheDiligentDev"<br/>}</span></pre><p id="7e06" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">审查文件</strong></p><pre class="me mf mg mh gt mw mx my mz aw na bi"><span id="8384" class="mk lc iq mx b gy nb nc l nd ne">{<br/>  userName: "TheDiligentDev",<br/>  rating: 5,<br/>  text: "Great Article!"<br/>}</span></pre><p id="86a3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> onUpdate云Firestore触发器</strong></p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nf mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">onUpdate Cloud Firestore Trigger</figcaption></figure><h2 id="7891" class="mk lc iq bd ld ml mm dn lh mn mo dp ll kn mp mq lp kr mr ms lt kv mt mu lx mv bi translated">onDelete</h2><p id="fd02" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">onDelete Firebase函数触发器是另一个清理数据的好工具。例如，假设您有一个帖子集合，每个帖子都有一个图像数组。如果一篇选中的文章被删除，你会想要删除所有相关的图片来清理你的存储桶。</p><p id="c5a5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">发文</strong></p><pre class="me mf mg mh gt mw mx my mz aw na bi"><span id="df3e" class="mk lc iq mx b gy nb nc l nd ne">{<br/>  title: "Example Post,<br/>  content: "Example post content",<br/>  images: ["test-1.png", "test-2.png"]<br/>}</span></pre><p id="2ed9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> onDelete Cloud Firestore触发器</strong></p><p id="2243" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在删除上面的文档时，这个触发器将触发并清除任何帖子图像。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nf mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">onDelete Cloud Firestore Trigger</figcaption></figure><h1 id="d79e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="94bb" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">这应该会让您对使用Firebase函数触发器可以自动化的一些任务有一个很好的了解。在以后的文章中，我将介绍您可以利用的其他触发因素。如果你有任何问题、意见或顾虑，请给我留言。下次见，编码快乐！</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="ng mj l"/></div></figure></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h2 id="303f" class="mk lc iq bd ld ml mm dn lh mn mo dp ll kn mp mq lp kr mr ms lt kv mt mu lx mv bi translated">来自简明英语团队的说明</h2><p id="140a" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">你知道我们有四种出版物吗？给他们一个follow来表达爱意:<a class="ae la" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="ke ir">JavaScript in Plain English</strong></a><a class="ae la" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ke ir">AI in Plain English</strong></a><a class="ae la" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ke ir">UX in Plain English</strong></a><a class="ae la" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ke ir">Python in Plain English</strong></a><strong class="ke ir"/>—谢谢，继续学习！我们还推出了一个YouTube，希望你能通过<a class="ae la" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">订阅我们的简明英语频道</strong> </a>来支持我们</p><p id="dc87" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一如既往,“简明英语”希望帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae la" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">submissions @ plain English . io</strong></a><strong class="ke ir"/>，并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>