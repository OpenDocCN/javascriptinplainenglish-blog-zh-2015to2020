<html>
<head>
<title>Five Major Differences between Serverless Framework &amp; AWS CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器框架和AWS CDK之间的五大区别</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/should-you-ditch-serverless-for-aws-cdk-fc5ac904688a?source=collection_archive---------6-----------------------#2020-09-27">https://javascript.plainenglish.io/should-you-ditch-serverless-for-aws-cdk-fc5ac904688a?source=collection_archive---------6-----------------------#2020-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bfe6a46e8365af4d9370153cf6c7a589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UET778T-re-GTcTL"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Luca Bravo</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="63a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>是构建无服务器应用最流行的框架，但是它与新的AWS CDK相比如何呢？2019年7月，<a class="ae kc" href="https://aws.amazon.com/about-aws/whats-new/2019/07/the-aws-cloud-development-kit-aws-cdk-is-now-generally-available1/" rel="noopener ugc nofollow" target="_blank"> AWS公布了自己的框架云开发工具包</a>。<a class="ae kc" href="https://aws.amazon.com/cdk/" rel="noopener ugc nofollow" target="_blank"> AWS CDK </a>是一个部署无服务器应用和任何AWS资源的框架。AWS CDK以类似于<a class="ae kc" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation </a>和<a class="ae kc" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>的代码形式帮助您实现基础设施。</p><p id="a70a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章将从不同方面比较无服务器框架和AWS CDK:框架易用性、可扩展性和安全性。到最后，你应该能够决定是继续使用无服务器还是采用CDK。</p><h1 id="0947" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">框架概述</h1><p id="9bb0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">AWS CDK(我们称之为“CDK”)和无服务器框架(我们称之为“无服务器”)都是JavaScript框架，您可以通过<a class="ae kc" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>或<a class="ae kc" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank"> yarn </a>将其作为命令行界面(CLI)脚本进行安装。两者都支持AWS，但是它们的用途不同。</p><h1 id="2745" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是无服务器框架？</h1><p id="8337" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">无服务器允许您将无服务器应用程序部署到多个云提供商。无服务器支持以下<a class="ae kc" href="https://www.serverless.com/framework/docs/providers/" rel="noopener ugc nofollow" target="_blank">提供商</a>:</p><ul class=""><li id="efe1" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">自动警报系统</li><li id="6a30" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">蔚蓝的</li><li id="43e0" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">腾讯云</li><li id="d03b" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">谷歌云</li><li id="e84a" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">Knative</li><li id="8ad3" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">阿里云</li><li id="6ac3" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">云耀斑</li><li id="984a" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">【数学】函数</li><li id="dcef" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">一无所有</li><li id="2106" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">OpenWhisk</li><li id="357c" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">现场测试</li></ul><p id="286c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器配置文件(名为“serverless.yml”)对大多数提供者使用类似的格式，这允许您相当容易地在提供者之间切换心理上下文。“serverless.yml”文件将使您能够使用<a class="ae kc" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>语法指定您的配置，并放置您的函数源代码，如JavaScript、Python、Go和云提供商支持的任何其他语言。Serverless将反序列化“serverless.yml”并将其转换为云提供商的底层格式(例如，AWS CloudFormation模板)。</p><h1 id="d735" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是亚马逊网络服务(AWS)云开发工具包(CDK)？</h1><p id="6fea" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">CDK允许您使用TypeScript、JavaScript、Python、Java和. NET在AWS中部署资源。您的源代码定义了资源和这些资源需要的文件(例如，<a class="ae kc" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>函数源代码)。CDK将综合源代码，以创建适当的AWS CloudFormation模板。</p><h1 id="6ae3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">让我们比较一下这两者</h1><h1 id="fb99" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.设置基本项目</h1><p id="8f15" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们将回顾如何在AWS上为这两个框架建立一个项目。</p><p id="9fd0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我假设你已经有一个AWS帐户，并且知道如何创建适当的<a class="ae kc" href="https://www.serverless.com/framework/docs/providers/aws/guide/credentials/" rel="noopener ugc nofollow" target="_blank"> IAM凭证</a>或临时凭证来部署AWS资源。</p><p id="cf89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我假设您的机器上已经安装了Node.js、npm和您想要的编程语言。</p><p id="608e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">无服务器框架项目设置</strong></p><p id="fa04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装无服务器，请使用npm:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="db3e" class="nb lc iq mx b gy nc nd l ne nf">npm install -g serverless</span></pre><p id="38fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这允许您将“无服务器”或“sls”用作CLI命令。</p><p id="e54b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要创建新的无服务器项目，请使用“无服务器”或“sls”命令，并按照屏幕提示进行操作:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="987c" class="nb lc iq mx b gy nc nd l ne nf">sls</span></pre><p id="84cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将在新项目中找到以下启动文件。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5b5d" class="nb lc iq mx b gy nc nd l ne nf">$ ls sls-example/<br/>handler.js    serverless.yml</span></pre><p id="55d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我倾向于使用“sls”命令，并选择Node.js JavaScript(或TypeScript)作为Lambda函数语言。</p><p id="754f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> AWS CDK项目设置</strong></p><p id="c090" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要安装AWS命令行界面和CDK。</p><p id="71e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装AWS CLI，请遵循<a class="ae kc" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI安装说明</a>，因为它们因操作系统而异</p><p id="45b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装CDK，请使用npm:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9844" class="nb lc iq mx b gy nc nd l ne nf">npm install -g aws-cdk</span></pre><p id="6fd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要创建一个新的cdk项目，请使用“CDK”命令。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ec5d" class="nb lc iq mx b gy nc nd l ne nf">mkdir cdk-example<br/>cd cdk-example<br/>cdk init app --language=javascript</span></pre><p id="7f6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将在新项目中找到以下启动文件。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="67b5" class="nb lc iq mx b gy nc nd l ne nf">$ ls<br/>README.md    lib                  package.json<br/>bin          node_modules         test<br/>cdk.json     package-lock.json</span></pre><p id="88aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我更喜欢Node.js JavaScript作为Lambda函数语言。我建议你考虑使用TypeScript而不是JavaScript，因为CDK是用TypeScript构建的。我选择节点来与无服务器进行比较。</p><p id="22c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">比较</strong></p><p id="fdd1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两者都很容易建立基本的项目结构。</p><h1 id="8867" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.易用性</h1><p id="5fba" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我认为每个框架都相对容易使用。根据您是否喜欢编写代码以及您对AWS的理解和知识，您可能更喜欢一个框架而不是另一个。</p><h1 id="8f70" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.1.部署Lambda函数</h1><p id="d939" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们将从一个简单的用例开始。</p><p id="032f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">无服务器框架</strong></p><p id="dced" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您只想部署一个Lambda函数。前面的项目设置已经准备好部署一个Lambda函数。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="477b" class="nb lc iq mx b gy nc nd l ne nf"># serverless.yml<br/># automatically created file<br/># no code changes made</span><span id="67dd" class="nb lc iq mx b gy ng nd l ne nf">service: sls-example</span><span id="faba" class="nb lc iq mx b gy ng nd l ne nf">provider:<br/>  name: aws<br/>  runtime: nodejs12.x</span><span id="14cc" class="nb lc iq mx b gy ng nd l ne nf">functions:<br/>  hello:<br/>    handler: handler.hello</span></pre><p id="e7ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器将假设您想要一个<code class="fe nh ni nj mx b">dev</code>阶段和<code class="fe nh ni nj mx b">us-east-1</code>区域。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="27a9" class="nb lc iq mx b gy nc nd l ne nf">/* handler.js */<br/>/* automatically created file */<br/>/* no code changes made */</span><span id="1f23" class="nb lc iq mx b gy ng nd l ne nf">'use strict';<br/>module.exports.hello = async event =&gt; {<br/>  return {<br/>    statusCode: 200,<br/>    body: JSON.stringify(<br/>      {<br/>        message: 'Go Serverless v1.0! Your function executed successfully!',<br/>        input: event,<br/>      },<br/>      null,<br/>      2<br/>    ),<br/>  };<br/>};</span></pre><p id="bcd1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们只需要部署配置。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="880d" class="nb lc iq mx b gy nc nd l ne nf">sls deploy --aws-profile my_aws_profile</span></pre><p id="6673" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器将创建一个部署以下项目的云信息模板:</p><ul class=""><li id="495d" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">包含无服务器配置文件和适当的S3存储桶策略的S3存储桶</li><li id="266d" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">一个λ函数</li><li id="d46a" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">最新的Lambda函数版本</li><li id="a5b2" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">一个CloudWatch日志日志组，用于捕获函数日志</li><li id="d1f5" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">Lambda函数将用于访问任何AWS服务和资源的IAM角色</li></ul><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/cfa67feb18d133d4e6decbedef7753be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*auoshaggXEqHjmmW.png"/></div></div></figure><p id="9612" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">“serverless.yml”文件中的少量行部署了“handler.js”功能代码，并设置了所有必要的支持资源。此外，资源命名约定遵循一种命名模式。还不错！</p><p id="cc5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> AWS CDK </strong></p><p id="af71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们之前创建的项目(即app)结构没有资源。我们将需要添加所需的资源。</p><p id="225b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要安装一个额外的包来定义我们的应用程序中的Lambda。</p><p id="c958" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装附加软件包，请运行以下npm命令:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="107a" class="nb lc iq mx b gy nc nd l ne nf">npm i --save <a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/aws-lambda</span></pre><p id="59ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以通过修改现有代码在应用程序中定义一个Lambda函数。</p><p id="949d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不需要对<code class="fe nh ni nj mx b">bin/cdk-example.js</code>文件进行修改。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d5b3" class="nb lc iq mx b gy nc nd l ne nf">#!/usr/bin/env node</span><span id="6370" class="nb lc iq mx b gy ng nd l ne nf">/* bin/cdk-example.js */<br/>/* automatically created file */<br/>/* no code changes made */</span><span id="c66a" class="nb lc iq mx b gy ng nd l ne nf">const cdk = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/core');<br/>const { CdkExampleStack } = require('../lib/cdk-example-stack');</span><span id="4389" class="nb lc iq mx b gy ng nd l ne nf">const app = new cdk.App();<br/>new CdkExampleStack(app, 'CdkExampleStack');</span></pre><p id="82e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要将Lambda函数添加到<code class="fe nh ni nj mx b">lib/cdk-example-stack.js</code>文件中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="72c9" class="nb lc iq mx b gy nc nd l ne nf">/* lib/cdk-example-stack.js */<br/>/* automatically created file */<br/>/* code changes made */</span><span id="11c2" class="nb lc iq mx b gy ng nd l ne nf">'use strict';</span><span id="76bb" class="nb lc iq mx b gy ng nd l ne nf">const cdk = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/core');</span><span id="5b16" class="nb lc iq mx b gy ng nd l ne nf">/* addition */<br/>const lambda = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/aws-lambda');<br/>const fs = require('fs');<br/>/* end addition */</span><span id="f36c" class="nb lc iq mx b gy ng nd l ne nf">class CdkExampleStack extends cdk.Stack {<br/>  /**<br/>   *<br/>   * <a class="ae kc" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {cdk.Construct} scope<br/>   * <a class="ae kc" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {string} id<br/>   * <a class="ae kc" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {cdk.StackProps=} props<br/>   */<br/>  constructor(scope, id, props) {<br/>    super(scope, id, props);<br/>    /* addition */<br/>    const helloSrc = fs.readFileSync('handler.js').toString();<br/>    const helloLambda = new lambda.Function(this, 'HelloLambda', {<br/>      runtime: lambda.Runtime.NODEJS_12_X,<br/>      handler: 'handler.hello',<br/>      code: new lambda.InlineCode(helloSrc, {<br/>        encoding: 'utf-8',<br/>      }),<br/>    });<br/>    /* end addition */<br/>  }<br/>}</span><span id="0073" class="nb lc iq mx b gy ng nd l ne nf">module.exports = { CdkExampleStack };</span></pre><p id="6918" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用无服务器示例中的同一个<code class="fe nh ni nj mx b">handler.js</code>文件，并将其添加到<code class="fe nh ni nj mx b">cdk-example</code>文件夹中。</p><p id="a1e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们准备好部署了。让我们运行CDK CLI命令。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ec12" class="nb lc iq mx b gy nc nd l ne nf"># check for errors<br/>cdk synth<br/># deploy<br/>cdk deploy --profile my_aws_profile</span></pre><p id="79cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK将使用AWS CLI配置中的默认区域，如果没有默认区域，则使用<code class="fe nh ni nj mx b">us-east-1</code>。</p><p id="25e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK将创建一个云形成模板，部署以下项目:</p><ul class=""><li id="bfc7" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">CDK元数据</li><li id="8f8e" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">一个λ函数</li><li id="25fa" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">Lambda函数将用于访问任何AWS服务和资源的IAM角色</li></ul><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/835a2c16b1a85a31c4a7876bffef45fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3j_GNUUzNepRKOGv.png"/></div></div></figure><p id="30b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器部署的S3桶、S3桶策略、最新Lambda函数版本和CloudWatch Logs日志组发生了什么变化？</p><p id="beaf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK使用CDK元数据，而不是将CloudFormation模板和无服务器所需的其他资源上传到S3存储桶并创建适当的存储桶策略。我们获得了<strong class="kf ir">安全奖励</strong>，因为我们无法从AWS控制台访问CDK配置。不错！</p><p id="b041" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器假设您在更新Lambda函数时需要它的一个版本。这可能是一个有用的特性，但是，在大多数情况下，您可能只需要最新的版本。CDK不会为你做这样的假设。如果您想要版本化的函数，您需要指定它。</p><p id="95e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当Lambda第一次触发时，AWS将自动创建一个CloudWatch Logs日志组。因此，我们不需要在应用程序中指定它。但是，在删除堆栈时，CDK或CloudFormation将<strong class="kf ir">而不是</strong>自动删除日志组，因为它不是配置的一部分。如果我们希望这样，我们需要在lib/cdk-example-stack.js文件中添加日志组。</p><p id="9baa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK假设您想要使用最佳实践和可信模式。因此，它为该函数创建了IAM角色。</p><p id="e693" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">比较</strong></p><p id="b202" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器使得创建Lambda函数和支持资源变得非常简单。但是，它确实创建了一个新的S3存储桶来存放无服务器配置。</p><p id="3c64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK需要一点额外的努力，因为它没有一个样本Lambda函数。我必须阅读<a class="ae kc" href="https://docs.aws.amazon.com/cdk/api/latest/docs/aws-lambda-readme.html" rel="noopener ugc nofollow" target="_blank"> API参考</a>来决定如何添加一个Lambda。此外，它没有部署我想要的所有资源(例如，CloudWatch Logs日志组)。但是，它限制了资源的数量，给了我更多的控制权。</p><h1 id="f767" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.2.添加DynamoDB表</h1><p id="9f0f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Lambda函数很可能需要从数据库中获取数据。我们将使用DynamoDB，这是一个无服务器的数据库表服务。</p><p id="fc3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">无服务器框架</strong></p><p id="e518" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器不支持开箱即用的某些资源(例如，DynamoDB表和S3桶)。因此，我们需要借助云形成来创建它们。</p><p id="b107" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将把CloudFormation模板代码附加到现有的<code class="fe nh ni nj mx b">serverless.yml</code>配置文件中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="79ce" class="nb lc iq mx b gy nc nd l ne nf"># serverless.yml</span><span id="c29e" class="nb lc iq mx b gy ng nd l ne nf"># additions<br/>resources:<br/>  Resources:<br/>    TableUsers:<br/>      Type: AWS::DynamoDB::Table<br/>      Properties:<br/>        TableName: ${self:service}-${self:provider.stage}-users<br/>        AttributeDefinitions:<br/>          - AttributeName: PartitionKey<br/>            AttributeType: S<br/>          - AttributeName: SortKey<br/>            AttributeType: S<br/>        KeySchema:<br/>          - AttributeName: PartitionKey<br/>            KeyType: HASH<br/>          - AttributeName: SortKey<br/>            KeyType: RANGE<br/>        ProvisionedThroughput:<br/>          ReadCapacityUnits: 1<br/>          WriteCapacityUnits: 1<br/># end additions</span></pre><p id="017e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们再次部署时，我们将看到DynamoDB表的新资源。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/682caec8ffd95fa3cdc0e328812545e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LNCHb5BDKr5Vy8rf.png"/></div></div></figure><p id="107b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们希望我们的Lambda函数能够从表中读取数据。我们需要将IAM策略添加到<code class="fe nh ni nj mx b">serverless.yml</code>文件中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4773" class="nb lc iq mx b gy nc nd l ne nf"># serverless.yml</span><span id="5522" class="nb lc iq mx b gy ng nd l ne nf"># addition<br/>  iamRoleStatements:<br/>    - Effect: "Allow"<br/>      Action:<br/>        - "dynamodb:GetItem"<br/>      Resource:<br/>        Fn::Join:<br/>          - ""<br/>          - - "arn:aws:dynamodb:"<br/>            - "Ref" : "AWS::Region"<br/>            - ":"<br/>            - "Ref" : "AWS::AccountId"<br/>            - ":table/"<br/>            - "Ref" : "DdbTableHello"<br/># end addition</span></pre><p id="aae2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们部署它时，不会看到任何新的资源。我们可以转到<code class="fe nh ni nj mx b">IamRoleLambdaExecution</code> IAM角色资源，看到它有我们刚刚添加的IAM策略。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d211" class="nb lc iq mx b gy nc nd l ne nf">        {<br/>            "Action": [<br/>                "dynamodb:GetItem"<br/>            ],<br/>            "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/sls-example-dev-hello",<br/>            "Effect": "Allow"<br/>        }</span></pre><p id="91e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加DynamoDB表并授予Lambda函数从其中获取一个项目的权限相当费力。</p><p id="1c7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> AWS CDK </strong></p><p id="b8a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要添加一个额外的包来将DynamoDB添加到我们的应用程序中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="910f" class="nb lc iq mx b gy nc nd l ne nf">npm i --save <a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/aws-dynamodb</span></pre><p id="f3d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要更新<code class="fe nh ni nj mx b">lib/cdk-example-stack.js</code>文件来添加DynamoDB资源。我将限制显示的代码，只关注变化。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="da61" class="nb lc iq mx b gy nc nd l ne nf">/* lib/cdk-example-stack.js */<br/>/* automatically created file */<br/>/* code changes made */</span><span id="e2c6" class="nb lc iq mx b gy ng nd l ne nf">'use strict';</span><span id="804e" class="nb lc iq mx b gy ng nd l ne nf">const cdk = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/core');</span><span id="62bd" class="nb lc iq mx b gy ng nd l ne nf">/* addition */<br/>/* end addition */</span><span id="c683" class="nb lc iq mx b gy ng nd l ne nf">/* addition 2 */<br/>const dynamodb = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/aws-dynamodb');<br/>/* end addition 2 */</span><span id="0a54" class="nb lc iq mx b gy ng nd l ne nf">class CdkExampleStack extends cdk.Stack {<br/>  constructor(scope, id, props) {<br/>    super(scope, id, props);<br/>    /* addition */<br/>    /* end addition */</span><span id="89d0" class="nb lc iq mx b gy ng nd l ne nf">/* addition 2 */<br/>    const helloTable = new dynamodb.Table(this, 'HelloTable', {<br/>      partitionKey: {<br/>        name: 'PartitionKey',<br/>        type: dynamodb.AttributeType.STRING,<br/>        billingMode: dynamodb.BillingMode.PROVISIONED,<br/>      },<br/>      sortKey: { name: 'SortKey', type: dynamodb.AttributeType.STRING },<br/>      readCapacity: 1,<br/>      writeCapacity: 1,<br/>    });<br/>    helloTable.grantReadData(helloLambda);<br/>    /* end addition 2 */<br/>  }<br/>}</span><span id="676b" class="nb lc iq mx b gy ng nd l ne nf">module.exports = { CdkExampleStack };</span></pre><p id="a589" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们综合和部署时，我们会发现两种新资源:</p><ul class=""><li id="676c" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">一张DynamoDB桌子</li><li id="b876" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">一个IAM策略</li></ul><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/7a7c5e5161fc1f68cfbbecc0c600f671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7CxybOgTB8J9ft0w.png"/></div></div></figure><p id="80a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">IAM策略将显示以下内容:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="445c" class="nb lc iq mx b gy nc nd l ne nf">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Action": [<br/>                "dynamodb:BatchGetItem",<br/>                "dynamodb:GetRecords",<br/>                "dynamodb:GetShardIterator",<br/>                "dynamodb:Query",<br/>                "dynamodb:GetItem",<br/>                "dynamodb:Scan"<br/>            ],<br/>            "Resource": [<br/>                "arn:aws:dynamodb:us-east-1:123456789012:table/CdkExampleStack-HelloTable2C0887DE-1D2AVL6SE753L"<br/>            ],<br/>            "Effect": "Allow"<br/>        }<br/>    ]<br/>}</span></pre><p id="463c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能会注意到，这个IAM策略比我们使用无服务器创建的策略具有更多允许的操作。我们用Serverless创建的IAM策略只包含我们在serverless.yml文件中定义的策略。然而，我们使用方便的grantReadData函数来自动创建该函数需要的所有读取权限。我们可以手动创建IAM策略并将其添加到角色中。虽然我们与CDK一起创建的IAM策略在技术上不是最低特权，但其意图是最低特权。尽管如此，通过获取一个项目与获取多个项目进行读取仍然是一种读取。如果我们想要实际的最小特权，我们需要向文件中添加更多的代码。</p><p id="93ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">比较</strong></p><p id="e917" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器没有简化IAM策略中DynamoDB表的创建。我们将附加分配给Lambda函数的IAM角色策略。我们不得不求助于使用本机CloudFormation模板代码和IAM策略声明。</p><p id="6515" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK用几行代码简化了DynamoDB和IAM策略的创建，并且不需要了解CloudFormation模板代码和IAM策略声明。我们获得了Lambda函数执行读取所需的所有特权。尽管如此，如果我们真的想让函数只读取一次，那么它可能不是最小特权。然后，我们需要添加更多的代码来添加适当的IAM策略，这样就失去了它的简洁性。</p><h1 id="d5b6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.展开性</h1><p id="0246" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在本节中，我们将回顾CDK和无服务器的可扩展性。</p><p id="31d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> CDK </strong></p><p id="9360" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK使用结构，并在三个层次上定义它们。级别1允许您直接使用云形成。第二层提供抽象和人类可读的代码；参见上面的例子。第3级将使您能够将第1级和第2级构造与构建可重用模式结合起来(例如，部署一个S3桶和CloudFront发行版来托管一个静态网站)。</p><p id="5a69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS已经构建了几个3级结构来解决许多常见的模式。他们以他们的<a class="ae kc" href="https://docs.aws.amazon.com/solutions/latest/constructs/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS解决方案结构</a>发布。例如，您可以安装他们的构造来部署S3 bucket和CloudFront发行版。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="026f" class="nb lc iq mx b gy nc nd l ne nf">npm i --save <a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-solutions-constructs/aws-cloudfront-s3</span></pre><p id="bf6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将创建一个“lib/cloudfront-s3.js”文件来定义我们的新堆栈。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ea2d" class="nb lc iq mx b gy nc nd l ne nf">/* lib/cloudfront-s3.js */<br/>/* new file */</span><span id="9065" class="nb lc iq mx b gy ng nd l ne nf">'use strict';</span><span id="b81c" class="nb lc iq mx b gy ng nd l ne nf">const cdk = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/core');<br/>const {<br/>  CloudFrontToS3,<br/>} = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-solutions-constructs/aws-cloudfront-s3');</span><span id="6de1" class="nb lc iq mx b gy ng nd l ne nf">class CloudFrontS3Stack extends cdk.Stack {<br/>  /**<br/>   *<br/>   * <a class="ae kc" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {cdk.Construct} scope<br/>   * <a class="ae kc" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {string} id<br/>   * <a class="ae kc" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {cdk.StackProps=} props<br/>   */<br/>  constructor(scope, id, props) {<br/>    super(scope, id, props);<br/>    new CloudFrontToS3(stack, 'cloudfront-s3', {});<br/>  }<br/>}</span><span id="6821" class="nb lc iq mx b gy ng nd l ne nf">module.exports = { CloudFrontS3Stack };</span></pre><p id="54e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将堆栈添加到我们的应用程序中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c03a" class="nb lc iq mx b gy nc nd l ne nf">#!/usr/bin/env node<br/>/* bin/cdk-example.js */<br/>/* automatically created file */<br/>/* code changes made */</span><span id="d930" class="nb lc iq mx b gy ng nd l ne nf">'use strict';</span><span id="9f32" class="nb lc iq mx b gy ng nd l ne nf">const cdk = require('<a class="ae kc" href="http://twitter.com/aws" rel="noopener ugc nofollow" target="_blank">@aws</a>-cdk/core');<br/>const { CdkExampleStack } = require('../lib/cdk-example-stack');<br/>const { CloudFrontS3Stack } = require('../lib/cloudfront-s3-stack');</span><span id="9e96" class="nb lc iq mx b gy ng nd l ne nf">const app = new cdk.App();<br/>new CdkExampleStack(app, 'CdkExampleStack');<br/>new CloudFrontS3Stack(app, 'CloudFrontS3Stack');</span></pre><p id="3949" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们部署时，CDK自动创建S3桶、CloudFront分发版和CloudFront origin访问身份，允许CloudFront分发S3对象。我们需要将文件上传到S3存储桶，并创建一个CloudFront失效来清除CloudFront缓存。我们仍然需要为CloudFront发行版创建Route 53托管区域、证书管理器证书和Route 53 A别名记录，以拥有一个完整的工作网站。</p><p id="0098" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK也支持构建和使用插件。插件修改CDK部署过程，而构造允许我们构建可重用的模式。例如，前面的第3级构造允许我们部署多个CloudFront-S3模式。相比之下，<a class="ae kc" href="https://www.npmjs.com/package/cdk-multi-profile-plugin" rel="noopener ugc nofollow" target="_blank">CDK-multiple-profile-plugin</a>将使我们能够使用多个AWS概要文件(可能是多个AWS帐户)进行部署。</p><p id="d299" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">无服务器</strong></p><p id="dd82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Serverless有许多<a class="ae kc" href="https://github.com/serverless/plugins" rel="noopener ugc nofollow" target="_blank">开源插件</a>，它们扩展了部署过程，甚至允许我们扩展它如何处理serverless.yml文件。</p><p id="3702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以部署一个静态网站。<a class="ae kc" href="https://github.com/MadSkills-io/fullstack-serverless" rel="noopener ugc nofollow" target="_blank"> fullstack-serverless </a>插件允许我们部署S3桶、CloudFront发行版和CloudFront origin访问身份，运行网站的构建命令，并将文件上传到S3桶。</p><p id="c0c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们安装插件。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="40b2" class="nb lc iq mx b gy nc nd l ne nf">npm install --save-dev fullstack-serverless</span></pre><p id="3b3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将配置添加到<code class="fe nh ni nj mx b">serverless.yml</code>文件中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="3f04" class="nb lc iq mx b gy nc nd l ne nf"># serverless.yml<br/># only some of the options are displayed</span><span id="a543" class="nb lc iq mx b gy ng nd l ne nf">plugins:<br/>  - fullstack-serverless</span><span id="7834" class="nb lc iq mx b gy ng nd l ne nf">custom:<br/>  fullstack:<br/>    domain: my-custom-domain.com<br/>    certificate: arn:aws:acm:us-east-1:...<br/>    bucketName: my-website<br/>    distributionFolder: websiteDir/dist<br/>    indexDocument: index.html<br/>    errorDocument: error.html<br/>    singlePageApp: true<br/>    compressWebContent: true<br/>    clientCommand: npm run build<br/>    clientSrcPath: websiteDir</span></pre><p id="8b30" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们部署时，我们将完成许多步骤。我们仍然需要为CloudFront发行版创建Route 53托管区域、证书管理器证书和Route 53 A别名记录，以拥有一个完整的工作网站。</p><p id="46a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">对比</strong></p><p id="2c7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK和无服务器都支持插件。CDK提供了第三级构造来构建模式。相比之下，Serverless除了制作一个允许您修改指定构建模式的serverless.yml文件的插件之外，没有这个概念。Serverless是一个稳定且完善的框架，有多个插件。CDK成立才一年多一点，它的一些二级结构和三级结构仍然处于试验阶段。实验性的构造可能会在未来的版本中引入突破性的变化。当然，不能保证无服务器插件不会引入重大变化，因为它们不受无服务器公司的控制。</p><h1 id="feee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">4.稳定性</h1><p id="226a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我认为无服务器和CDK都是稳定的。无服务器公司管理无服务器，他们遵循既定的软件开发流程。AWS管理CDK，并遵循既定的软件开发流程。</p><p id="b942" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器框架是稳定的，并且它们提供了与当前V1及其次要版本的向后兼容性。CDK本身是稳定的，我所评论的所有1级构造也是如此。这意味着您可以使用CloudFormation设置可靠地构建一个CDK应用程序，而不用担心会出现重大更改。</p><p id="122f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如前所述，一些CDK 2级和3级结构是实验性的，无服务器插件可能是也可能不是稳定的。本质上，突破性变更的潜力来自于利用构建在基本功能之上的便利性。CDK相对于无服务器的优势在于，AWS正在构建和维护2级和3级结构，这使得AWS在整个生态系统中更加稳定。相比之下，无服务器不能直接控制插件。</p><h1 id="e1c4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.安全考虑</h1><h1 id="7f70" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.1.部署所需的AWS资源</h1><p id="32e9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">无服务器需要包含无服务器配置文件的S3存储桶。如果您部署一个无服务器配置，并且在serverless.yml文件中没有指定任何资源，它仍然会创建该S3存储桶。</p><p id="bada" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK确实创建了一个S3存储桶来存放其配置数据。如果部署空的CDK应用程序，它将生成无法通过AWS控制台或CLI访问的CDK元数据资源。</p><h1 id="158c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.2.资源配置</h1><p id="8c99" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Serverless假定您可能需要一些资源(例如，Lambda版本控制、CloudWatch日志日志组和一个IAM角色用于您的所有功能)。该存储桶不可通过互联网访问，但未配置为专用存储桶。</p><p id="d6c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CDK尽量不承担你想要的资源，并给你大部分的控制权(例如，它不会创建Lambda版本控制和CloudWatch Logs日志组，也不会为你的所有功能创建一个IAM角色)。假设你指定一个Lambda函数需要一个包含它所有依赖项的包。在这种情况下，它将自动创建将包部署到Lambda函数所需的S3桶。尽管如此，它还是将其配置为一个私有桶。正如你在上面的例子中看到的，CDK没有创建S3桶，因为Lambda函数代码是内联代码而不是包。</p><h1 id="cf93" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.3.最小特权原则</h1><p id="c585" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">CDK 2级构造提供了使用“grant”函数授予特权的便利。这些“授予”功能创建适当的最低特权IAM角色(例如，它添加允许在两个特定资源之间进行读取访问的所有IAM策略语句，但不添加任何创建/删除/更新权限)。</p><p id="dbda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器假设您希望所有功能都有一个IAM角色。当每个栈只有一个函数时，这样做很好，但是当你添加更多的函数时，可能会违反最小特权原则。您将需要一个插件来帮助您为每个函数定义IAM角色，或者避免使用内置的IAM角色，并使用“serverless.yml”文件的“resources”部分中的CloudFormation模板来手动定义它们。</p><h1 id="1cb1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">我们只使用AWS。我们应该使用哪个？</h1><p id="fd39" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">无服务器和CDK最终都建立了一个云形成模板，但它如何创建模板有所不同。在某些方面，无服务器使部署无服务器应用程序更容易，而在其他方面，它需要更多的工作。CDK要求对AWS有更好的理解，并给你更多的控制权。当涉及到部署Lambda函数以外的资源时，CDK比无服务器需要更少的代码(除非你使用无服务器插件)。</p><p id="087e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您不熟悉AWS和无服务器计算，并且希望尽快开始部署，我建议从无服务器开始。</p><p id="a8f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设你是AWS新手，想学习AWS的工作原理。那样的话，我建议看YouTube上关于<a class="ae kc" href="https://aws.amazon.com/certification/certified-cloud-practitioner/" rel="noopener ugc nofollow" target="_blank"> AWS认证云从业者</a>认证考试的视频来了解AWS。当您对AWS的工作原理有了基本的了解后，无服务器可能仍然是最好的起点。尽管如此，你将有足够的知识开始使用CDK。</p><p id="2c14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您对AWS有中级到高级的了解。在这种情况下，CDK将为您提供更多的控制，以实现您希望实现的任何简单或复杂的部署。无服务器也将帮助您实现相同的结果，但您可能需要构建自己的AWS CloudFormation模板。如果您喜欢YAML配置的简单性，您可能希望使用无服务器。</p><p id="1dc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设你更多的是DevOps工程师，而不是软件开发者。在这种情况下，您可能倾向于无服务器，但是为CDK编写源代码可能不是您力所不及的。</p><p id="3e6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="https://github.com/miguel-a-calles-mba/secjuice/tree/master/cdk-vs-sls" rel="noopener ugc nofollow" target="_blank">https://github . com/Miguel-a-calles-MBA/sec juice/tree/master/CDK-vs-SLS</a>查看源代码。</p><h1 id="858c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">作者的笔记</h1><p id="70ea" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">加入我的邮件列表来接收关于我写作的更新。</p><p id="42d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">参观<a class="ae kc" href="https://miguelacallesmba.com/subscribe" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">miguelacallesmba.com/subscribe</strong></a>并报名。</p><p id="30ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保持安全，米格尔</p><h2 id="7329" class="nb lc iq bd ld nn no dn lh np nq dp ll ko nr ns lp ks nt nu lt kw nv nw lx nx bi translated">关于作者</h2><p id="968f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Miguel是首席安全工程师，也是“<a class="ae kc" href="https://ServerlessSecurityBook.com" rel="noopener ugc nofollow" target="_blank">无服务器安全</a>”一书的作者。作为一名开发人员和安全工程师，他参与了多个无服务器项目，为开源无服务器项目做出了贡献，并以各种工程角色参与了大型军事系统。</p><p id="7556" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ny">本帖最初发表于</em><a class="ae kc" href="https://www.secjuice.com/aws-cdk-vs-serverless-framework/" rel="noopener ugc nofollow" target="_blank"><em class="ny">https://www.secjuice.com/aws-cdk-vs-serverless-framework/</em></a><em class="ny">。</em></p></div></div>    
</body>
</html>