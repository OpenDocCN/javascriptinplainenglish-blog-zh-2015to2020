<html>
<head>
<title>Node.js Best Practices — Helmet and Cookie</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js最佳实践—头盔和Cookie</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-best-practices-helmet-and-cookie-2db298854d00?source=collection_archive---------4-----------------------#2020-08-19">https://javascript.plainenglish.io/node-js-best-practices-helmet-and-cookie-2db298854d00?source=collection_archive---------4-----------------------#2020-08-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e0bce6ea4011164d1230f8fed8c8330d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oOF1Z4aEBtakzaKv"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@dwidiyohanung?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dwidiyo Hanung</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e599" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="9769" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加头盔以设置Sane默认值</h1><p id="ffcc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">快速应用程序的某些默认设置不太安全。</p><p id="4986" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，头盔中间件可用于设置一些更合理的默认设置。</p><p id="bab6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用它，我们写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5cd3" class="mn lc iq mj b gy mo mp l mq mr">const express = require('express');<br/>const helmet = require('helmet');</span><span id="331c" class="mn lc iq mj b gy ms mp l mq mr">const app = express();</span><span id="0362" class="mn lc iq mj b gy ms mp l mq mr">app.use(helmet());</span></pre><p id="2794" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们创建快速应用程序时。</p><p id="7fb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它做了几件事来提高我们的应用程序的安全性。</p><p id="d98b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它启用了内容安全策略HTTP头。</p><p id="f1fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这定义了允许在我们的网页上加载的内容(如脚本、图像等)的可信来源。</p><p id="6f0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DNS预取有助于加快加载速度。</p><p id="9178" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，禁用预取将限制所使用的外部服务类型的潜在数据泄漏。</p><p id="a096" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还可以减少与DNS查询查找相关的流量和成本。</p><p id="509f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-Frame-Options HTTP头也被启用。</p><p id="0003" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这通过禁用在另一个站点上呈现的网页的选项来阻止点击劫持尝试。</p><p id="c492" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-Powered-By HTTP头也是隐藏的。</p><p id="87fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，攻击者就无法识别我们用什么来创建我们的应用程序。</p><p id="3b7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还启用了公钥固定标头。</p><p id="b1cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可以防止使用伪造证书的中间人攻击。</p><p id="f08e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还启用了严格传输安全标头。</p><p id="34bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦客户端最初与HTTPS连接，这将强制后续的服务器连接使用HTTPS。</p><p id="7c54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还使用默认值启用Cache-Control、Pragma、Expires和Surrogate-Control，阻止客户端缓存旧版本的站点资源。</p><p id="be5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">X-Content-Type-Options HTTP头阻止客户端嗅探声明的内容类型之外的响应的MIME类型。</p><p id="f451" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的应用程序的响应头中引用的HTTP头也可以被控制来包含某些信息。</p><p id="ced2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">防止浏览器中某些XSS攻击的X-XSS保护HTTP头。</p><h1 id="45af" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">收紧会话Cookies</h1><p id="d8a3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该加强安全性不高的会话cookies。</p><p id="a9a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe mt mu mv mj b">express-session</code>包设置各种设置。</p><p id="6ff1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">secret</code>属性是用来加盐的cookie的秘密字符串。</p><p id="f163" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">key</code>是饼干的名字。</p><p id="a990" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">httpOnly</code>将cookies标记为只能由发布web服务器访问。</p><p id="dad0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">secure</code>应该设置为<code class="fe mt mu mv mj b">true</code>，需要SSL/TLS。</p><p id="36d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将强制cookies仅用于HTTPS请求。</p><p id="418a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">domain</code>表示可以访问cookie的域。</p><p id="2b43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">path</code>具有cookie在应用程序域内被接受的路径。</p><p id="b7f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">expires</code>已经设置了cookie的失效日期。</p><p id="0063" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，这将持续一个会话。</p><p id="b09a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用这些选项，我们可以编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5339" class="mn lc iq mj b gy mo mp l mq mr">const express = require('express');<br/>const session = require('express-session');</span><span id="ec2d" class="mn lc iq mj b gy ms mp l mq mr">const app = express();</span><span id="0039" class="mn lc iq mj b gy ms mp l mq mr">app.use(session({  <br/>  secret: 'secret',<br/>  key: 'someKey', <br/>  cookie: {<br/>    httpOnly: true,<br/>    secure: true,<br/>    domain: 'example.com',<br/>    path: '/foo/bar',<br/>    expires: new Date( Date.now() + 60 * 60 * 1000 )<br/>  }<br/>}));</span></pre><p id="c3b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以设置所有这些选项来创建和发送我们的cookie。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6ac4eee4c30ff44f0bec4c871ee0254a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J1IAXv1XrnNicZ5p"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@andrewwelch3?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">andrew welch</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f5c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="66f8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">快速头盔和快速会话包对于保护我们的快速应用程序非常有用。</p><h2 id="545a" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="57e8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>