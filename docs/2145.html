<html>
<head>
<title>useLocalStorage() React Hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">useLocalStorage() React挂钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/uselocalstorage-react-hook-2532e922d5b1?source=collection_archive---------0-----------------------#2020-05-24">https://javascript.plainenglish.io/uselocalstorage-react-hook-2532e922d5b1?source=collection_archive---------0-----------------------#2020-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="be16" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">再也不会丢失表单提交</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/26a157f6bb98f47132c976c011ff4428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZVJHVRGyGcs5C56mG7bxQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Now that’s what I call local storage! Photo by <a class="ae kv" href="https://unsplash.com/@anetek?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Aneta Foubíková</a> on <a class="ae kv" href="https://unsplash.com/s/photos/pocket?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6842" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">故事时间:Moodle测验</h1><p id="5589" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">几年前，我使用了一个叫做Moodle 的开源LMS(类似于Blackboard或Canvas，如果你听说过的话)。在当时，它不是最漂亮的，但它足够好，学校也不能抱怨价格。我真的只有一个抱怨。</p><p id="26b2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当在Moodle中进行测试/测验时，它会弹出一个提示，告诉你还剩多少时间。不是最流畅的用户体验(UX)，但在当时可以理解。<em class="mp">然而</em>，如果你正在输入一个回复，文本区会突然被取消选择。这意味着你接下来的击键被解释为快捷键。</p><p id="6c1b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当时，在Chrome上按backspace会返回一页。</p><p id="b79a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这意味着每30分钟，提醒窗口会试图欺骗你返回一页。如果它成功了，那么当你重新进入测试<strong class="lq ir">时，你所有提交的答案</strong>——值得工作的时间<strong class="lq ir">——都将消失</strong>。</p><p id="f29f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我曾经连续发生过三次。眼泪。不难想象，对更小的孩子来说，变成“我讨厌数学”、“我讨厌网上学习”、“我讨厌电脑”，然后是“我讨厌学校”。</p><p id="5143" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">说“糟糕的UX”是一种保守的说法。</p><h1 id="7408" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">正确的UX: GitHub公关描述</h1><p id="002e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">下次您打开一个拉取请求时，请在点击绿色的“创建拉取请求”按钮之前尝试刷新页面。刷新和快速刷新后，您的提交再次出现。我也在公关评论中看到过这种情况。你可能都没注意到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/4589f49cb32a8fceab102919bec7f0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fiU4msRX9ctvaau3ljcemA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">A screenshot doesn’t do this feature justice. Seriously, try it next time you open a PR.</figcaption></figure><p id="0a65" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这就像“记住我”复选框，但总是启用，而不仅仅是用户名。</p><p id="42c1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">该功能仅对用户花费大量时间的<strong class="lq ir">输入字段有意义</strong>，包括长文本提交、冗长的调查/表格、经常被遗忘的字段(如用户名)或短暂的偏好。在敏感领域使用这个UX之前，我会三思而行:这是“记住我”记住你的用户名而不是密码的原因。</p><h1 id="d5ff" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">履行</h1><p id="6154" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可以通过在客户端的localStorage中存储正在进行的值来实现这个UX。当文本改变时，我们可以将文本发送到localStorage。在页面加载时，我们可以使用localStorage来填充当前值。</p><h2 id="8b50" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">反应钩</h2><p id="f51e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">事不宜迟，用TypeScript typings ( <a class="ae kv" href="https://usehooks.com/useLocalStorage/" rel="noopener ugc nofollow" target="_blank">及其JavaScript源</a>)挂钩:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Original source: <a class="ae kv" href="https://usehooks.com/useLocalStorage/" rel="noopener ugc nofollow" target="_blank">https://usehooks.com/useLocalStorage/</a></figcaption></figure><p id="e866" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">受控表单是用一个<code class="fe nf ng nh ni b">useState</code>钩子构建的，遵循模式<code class="fe nf ng nh ni b">const [currentFieldValue, setCurrentFieldValue] = useState(<em class="mp">initialValue</em>);</code>，然后显示<code class="fe nf ng nh ni b">currentFieldValue</code>并在输入改变时调用<code class="fe nf ng nh ni b">setCurrentFieldValue</code>。这就是我们想要插入localStorage-sync特性的地方，所以模仿<code class="fe nf ng nh ni b">useState</code>接口和语义会使把它放入您的组件变得容易。</p><h2 id="549a" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">命名密钥</h2><p id="db28" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这个键是一个字符串，如果需要的话，应该包含将它与其他组件分开所需的标识符。</p><p id="3517" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，考虑上面的GitHub pull请求用例。您可能希望PR描述的键包含源repo和分支以及目标repo和分支的唯一标识符，这样不同的pull请求就不会得到相同的描述。</p><p id="413e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果数据是全局的，那么键可以只是一个静态字符串。</p><h1 id="c84b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">数据持久性可能很棘手</h1><p id="2b7e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">数据持久性可能会导致许多棘手的问题。</p><p id="1fad" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您更改了持久化数据的结构(由于UI软件更新)，您可能会由于意外的结构而导致代码中断。在数据持久化的后端世界中，我们使用“迁移”脚本将所有数据转换成正确的结构。</p><p id="eb39" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">幸运的是，如果您对非关键数据使用这个钩子，您也许能够“忘记”旧的持久性。更改localStorage键模板的一部分，这样您的代码就不会出现旧的内容。类似于<code class="fe nf ng nh ni b">pull-request-description-cache-${sourceRepo}-${sourceBranch}-${targetRepo}-${targetBranch}-v1</code>的东西，但是当你违约时，它会增加到v2。(在某个地方放一个快速脚本，通过迭代<code class="fe nf ng nh ni b">Object.keys(localStorage)</code>来清理v1键)</p><h1 id="76d1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">何时清理本地存储</h1><p id="2bae" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">数据的清理经常被忽视，但在构建成品时却是至关重要的。</p><h2 id="a53f" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">长格式</h2><p id="5e3e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">上面的Moodle例子很复杂。如果两个用户在同一个浏览器中参加同一个测试(一个接一个)，您不希望第二个用户看到第一个用户的选择。</p><p id="de50" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">考虑清除相关的localStorage键一次:</p><ul class=""><li id="4e4c" class="nj nk iq lq b lr mk lu ml lx nl mb nm mf nn mj no np nq nr bi translated">表单已成功提交</li><li id="01fe" class="nj nk iq lq b lr ns lu nt lx nu mb nv mf nw mj no np nq nr bi translated">当提交被显式中止时(取消按钮与意外导航)</li><li id="2778" class="nj nk iq lq b lr ns lu nt lx nu mb nv mf nw mj no np nq nr bi translated">当用户注销或登录时</li></ul><h2 id="0ae4" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">高度机密信息</h2><p id="65d5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">localStorage中的数据在XSS攻击中是可检索的，因此如果您在localStorage中有个人身份信息或其他敏感数据，请考虑不时将其清除。为任何TTL类型的计算存储时间戳。(使用<code class="fe nf ng nh ni b">Date.now()</code>获得一个JSON可序列化的纪元编号)</p><p id="a2a0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">出于安全原因，不要依赖本地存储中的数据。任何人都可以编辑本地存储。即使您对其进行了加密，您的用户也可以看到前端的任何内容，包括加密密钥。(除非你在后端加密它，那么也许可以，但是要意识到用户可以清空他们的本地存储或者切换到不同的设备)。</p><h2 id="2c1d" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">短暂的偏好</h2><p id="e5a6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">列表中的主题或排序顺序等偏好是很好的存储方式(“人体工程学”是我想到的一个词)，但是如果你打算长期保存这些东西，就不要依赖本地存储。用户清空缓存、切换浏览器或在不同设备上登录时，你的应用程序应该没问题——所有这些情况下本地存储都不会持久。</p><h1 id="5251" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">简明英语团队的一份说明</strong></h1><p id="19f1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？你可以在我们的主页<a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> plainenglish.io </strong> </a>上找到所有这些——关注我们的出版物并<a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">订阅我们的YouTube频道</strong> </a> <strong class="lq ir">来表达你的爱吧！</strong></p><h1 id="d13b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">资源</h1><ul class=""><li id="a84d" class="nj nk iq lq b lr ls lu lv lx nx mb ny mf nz mj no np nq nr bi translated"><a class="ae kv" href="https://gist.github.com/jamesfulford/a7f1fcead386e76bfd9d36136e0da6da" rel="noopener ugc nofollow" target="_blank">使用位置存储()要点</a></li><li id="d29d" class="nj nk iq lq b lr ns lu nt lx nu mb nv mf nw mj no np nq nr bi translated"><a class="ae kv" href="https://usehooks.com/useLocalStorage/" rel="noopener ugc nofollow" target="_blank">useLocalStorage钩子的原始来源</a>(没有TS类型，也没有关于用例以及正确使用的建议——这使得这篇文章是原创的)</li></ul></div></div>    
</body>
</html>