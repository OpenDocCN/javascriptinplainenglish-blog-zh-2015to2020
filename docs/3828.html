<html>
<head>
<title>4 Ways You Can Get Rid of Dirty Side Effects for Cleaner Code in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有4种方法可以消除JavaScript中干净代码的肮脏副作用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/4-ways-you-can-get-rid-of-dirty-side-effects-for-cleaner-code-in-javascript-e93c50ff2355?source=collection_archive---------6-----------------------#2020-10-27">https://javascript.plainenglish.io/4-ways-you-can-get-rid-of-dirty-side-effects-for-cleaner-code-in-javascript-e93c50ff2355?source=collection_archive---------6-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="32a4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从长远来看，副作用造成了巨大的精神负担</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3ad2f948242e7aaf2bb8a0552940d46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X7s0W8Gwkca2gjgU"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@chatelp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pierre Châtel-Innocenti</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d079" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分析显示，开发者平均每1000行代码会产生70个bug。因此，他将75%的时间花在调试上。太可悲了！</p><p id="6395" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">bug的产生有多种方式。制造副作用就是其中之一。</p><p id="72b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人说副作用是邪恶的，有人说不是。</p><p id="df0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在第一组。副作用应该被认为是邪恶的。我们应该瞄准副作用免费代码。</p><p id="a27a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以用以下四种方法来实现你的目标。</p><h1 id="3724" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.严格使用；</h1><p id="64f5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">略加利用严格；</strong>到你文件的开头。这个特殊的字符串将打开代码验证，并防止您在没有首先声明变量的情况下使用变量。</p><h1 id="acad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.环</h1><p id="37ac" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">请看下面的例子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="17bd" class="mu lt iq mq b gy mv mw l mx my">var names = [‘amy’, ‘james’, ‘anna’, ‘joey’];</span><span id="63a4" class="mu lt iq mq b gy mz mw l mx my">for (var i = 0; i &lt; names.length; i++) {<br/>  console.log(names[i]);<br/>}</span></pre><p id="786a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，什么会引起副作用？</p><p id="490e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意索引变量<strong class="ky ir"> i </strong>，它不仅在<strong class="ky ir"> for loop </strong>范围内可用，而且在外部范围内也可用。</p><p id="a2a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果将变量<strong class="ky ir"> i </strong>的值记录在for循环的正下方，则应为4。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="60c2" class="mu lt iq mq b gy mv mw l mx my">for (var i = 0; i &lt; names.length; i++) {<br/>  console.log(names[i]);<br/>}</span><span id="5ac8" class="mu lt iq mq b gy mz mw l mx my">console.log(i); // 4</span></pre><p id="3d4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了避免这种副作用，我们目前有两个选择。</p><p id="30d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">选项1: </strong>使用<strong class="ky ir"> forEach </strong></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="ae19" class="mu lt iq mq b gy mv mw l mx my">names.forEach(name =&gt; {<br/>  console.log(name);<br/>});</span></pre><p id="e122" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<strong class="ky ir"> forEach </strong>，我们不再需要定义索引变量。所以，没有更多的副作用。</p><p id="e8e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">选项2: </strong>比起<strong class="ky ir"> var </strong>更喜欢使用<strong class="ky ir"> let </strong></p><p id="e49b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ES6附带了很多有用的特性。<strong class="ky ir">让</strong>关键词就是其中之一。</p><p id="50cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你用<strong class="ky ir"> let </strong>定义一个变量时，它只在当前范围内可用。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="2754" class="mu lt iq mq b gy mv mw l mx my">for (let i = 0; i &lt; names.length; i++) {<br/>  console.log(names[i]);<br/>}</span><span id="efaa" class="mu lt iq mq b gy mz mw l mx my">console.log(i); // error: Uncaught ReferenceError: i is not defined</span></pre><p id="4291" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如图所示，如果在定义的范围之外使用<strong class="ky ir"> i </strong>，则会导致错误。</p><h1 id="18bf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.立即调用函数表达式(IIFE)</h1><p id="020d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">IIFE是一个JavaScript函数，一旦定义就运行。</p><p id="b688" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IIEF我发现的一个好处是，你可以把变量隐藏在函数内部，避免它们泄露出去，这样就不会发生副作用。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="1955" class="mu lt iq mq b gy mv mw l mx my">const Calculation = (function () {<br/>  const PI = 3.14;<br/>  let mode = 1;<br/>  <br/>  return {<br/>    sum: function (a, b) {<br/>      return a + b;<br/>    },</span><span id="e77b" class="mu lt iq mq b gy mz mw l mx my">    changeMode: function (newMode) {<br/>      this.mode = newMode;<br/>    },</span><span id="e1c8" class="mu lt iq mq b gy mz mw l mx my">    printMode: function () {<br/>      console.log(this.mode);<br/>    }<br/>  };<br/>})();</span><span id="bd25" class="mu lt iq mq b gy mz mw l mx my">let sum = Calculation.sum(2, 6); // 8<br/>Calculation.changeMode(4);<br/>Calculation.printMode(); // 4</span></pre><p id="6468" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果要修改变量，唯一的方法是通过返回的IIEF函数更改值，这将避免副作用。</p><h1 id="6f94" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.纯函数</h1><p id="4d43" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><a class="ae kv" href="https://medium.com/javascript-in-plain-english/principles-of-functional-programming-in-javascript-that-will-make-your-coding-life-easier-ed1416d2b726" rel="noopener">纯函数</a>是用相同的输入返回相同的输出的函数。</p><p id="bd9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，一个纯函数只依赖于它自己的参数，不会改变它作用域之外的变量，所以不会发生副作用。</p><p id="b30b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下面这个不纯函数为例:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d2e6" class="mu lt iq mq b gy mv mw l mx my">let person = {<br/>  name: ‘Amy’,<br/>  age: 28<br/>};</span><span id="7f1a" class="mu lt iq mq b gy mz mw l mx my">function change(person) {<br/>  let someone = person;<br/>  someone.name = ‘James’;</span><span id="56eb" class="mu lt iq mq b gy mz mw l mx my">  return someone;<br/>}</span><span id="f83c" class="mu lt iq mq b gy mz mw l mx my">let someone = change(person);<br/>console.log(someone.name) // James<br/>console.log(person.name); // James</span></pre><p id="3554" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的函数是不纯的，因为它改变了变量<strong class="ky ir"> person </strong>的值，这个变量在函数之外。那是副作用。</p><p id="bed7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了防止副作用，我们需要将该功能转换为纯功能:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="39ee" class="mu lt iq mq b gy mv mw l mx my">let person = {<br/>  name: ‘Amy’,<br/>  age: 28<br/>};</span><span id="a872" class="mu lt iq mq b gy mz mw l mx my">function change(person) {<br/>  let someone = {...person}<br/>  someone.name = ‘James’;<br/>  <br/>  return someone;<br/>}</span><span id="a7ca" class="mu lt iq mq b gy mz mw l mx my">let someone = change(person);<br/>console.log(someone.name) // James<br/>console.log(person.name); // Amy</span></pre><p id="44cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，它是纯净的。</p><p id="eb54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数时候，为了减少副作用，最好为不太令人惊讶的错误创建纯函数。</p><p id="3181" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不需要把所有的函数都做纯。我们可以根据需要混合纯函数和不纯函数，因为不是所有不纯函数都是不好的。有时我们需要它们为特定的目的服务。</p><h1 id="ea7a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="e317" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">想象你的代码库是没有副作用的。如果有任何问题，您可以更快地进行调查。您将轻松快速地编写单元测试。更多的单元测试意味着你增加了你的应用程序没有错误的几率。</p><p id="b9d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望你喜欢这篇文章。</p><p id="2d1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有其他方法防止副作用吗？如果有，请在下面的评论中分享它们。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="5b88" class="ls lt iq bd lu lv nh lx ly lz ni mb mc jw nj jx me jz nk ka mg kc nl kd mi mj bi translated">进一步阅读</h1><div class="nm nn gp gr no np"><a href="https://medium.com/javascript-in-plain-english/9-tips-for-writing-scalable-javascript-code-e6bcfc791882" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">编写可伸缩JavaScript代码的9个技巧</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">您应该从一开始就准备好扩展您的项目</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kp np"/></div></div></a></div></div></div>    
</body>
</html>