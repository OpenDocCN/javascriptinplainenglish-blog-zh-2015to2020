<html>
<head>
<title>Google APIs with JavaScript: Complete Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带JavaScript的Google APIs:完整教程</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/google-apis-with-javascript-complete-guide-9679d687250e?source=collection_archive---------9-----------------------#2020-05-18">https://javascript.plainenglish.io/google-apis-with-javascript-complete-guide-9679d687250e?source=collection_archive---------9-----------------------#2020-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="34bb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何登录Google并通过JavaScript、Firebase和React使用多个Google APIs</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a845c2a376cb8289d11e7bc04a58e3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GiOvnzpRnC-mjS9nzKQBiA.png"/></div></div></figure><p id="3455" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天，我将向您展示使用两个流行的Google APIs的完整编码流程。从使用特定的作用域对用户进行身份验证、取回令牌，到使用该令牌操作多个API。</p><p id="e297" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">到目前为止，这是我最复杂的文章，所以请提供反馈！我很乐意帮助你在这方面比我做得更容易，如果你遇到困难，我会回答个别问题(给我发电子邮件！).</p><p id="2b56" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这也是我自己搭建app时需要的教程。有些事情只有你自己去尝试和解释，才会被简化！</p><h2 id="b29f" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">你会学到什么</h2><ol class=""><li id="e348" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">React中使用Firebase的Google登录</li><li id="aeba" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">如何传入范围来访问特定的Google APIs</li><li id="dc04" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">操控谷歌<strong class="kt ir">驱动API </strong></li><li id="d3a8" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">操纵谷歌<strong class="kt ir">表单API </strong></li></ol><p id="94e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于这个例子，我们将使用<strong class="kt ir"> Google Drive </strong>和<strong class="kt ir">Google Sheets API</strong>。为什么是这两个？因为我想演示一个我在创建自己的网站时不得不处理的具体流程:雪球财经教育(www . snowballmifiests . com)。</p><h2 id="7773" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">要求:</h2><ol class=""><li id="7980" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">基本JavaScript</li><li id="a79a" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">Node.js已安装</li><li id="510b" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">基本反应(reactjs.org)</li><li id="3cdf" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">一个Firebase项目设置:www.firebase.com(<strong class="kt ir">登录</strong>，<strong class="kt ir">进入控制台</strong>，<strong class="kt ir">添加项目+ ) </strong></li></ol><p id="e7dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将提供完整的代码示例！</p><h2 id="d041" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">教程概述</h2><ol class=""><li id="7df4" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">反应项目设置</li><li id="82f8" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">Firebase设置</li><li id="0f5c" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">使用API范围的Google登录</li><li id="9561" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">驱动API使用</li><li id="a254" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">工作表API用法</li></ol></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="f1a0" class="nd lo iq bd lp ne nf ng ls nh ni nj lv jw nk jx ly jz nl ka mb kc nm kd me nn bi translated">1.设置新的React项目</h1><p id="8377" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">让我们从React开始我们的项目</p><p id="a7b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b">npx create-react-app google-apis</code></p><p id="c61b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b">cd google-apis</code></p><p id="7e5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用你最喜欢的文本编辑器打开它(我用VSCode)</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="4fbb" class="nd lo iq bd lp ne nf ng ls nh ni nj lv jw nk jx ly jz nl ka mb kc nm kd me nn bi translated">2.在React中设置Firebase项目</h1><p id="c813" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated"><em class="nv">去</em><strong class="kt ir"><em class="nv">www.firebase.com</em></strong><em class="nv">开始一个新项目。浏览设置，直到您进入项目概述。</em></p><p id="ce83" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您知道如何用React项目配置Firebase，那么可以跳过这一步。</p><h2 id="76a3" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">从Firebase获取API密钥</h2><ol class=""><li id="0798" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">在项目概述(你看到的第一页)上，应该有一条消息说<strong class="kt ir">“</strong><em class="nv">通过将Firebase添加到你的应用</em> <strong class="kt ir">”开始。点击网络图标。</strong></li><li id="2d09" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">给你的应用取一个昵称。我把它叫做<strong class="kt ir">Google-API</strong>。你完成了这一步，只需点击下一步，直到你返回到主firebase项目屏幕。</li><li id="c803" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">在你的项目总览上，进入项目设置:点击<strong class="kt ir">“项目总览”旁边的<strong class="kt ir">齿轮图标</strong>，</strong>点击<strong class="kt ir">项目设置</strong>选项。</li><li id="1796" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">找到<strong class="kt ir"> Firebase SDK片段</strong>(页面底部)点击<strong class="kt ir">配置</strong>圆圈。您应该会看到这样的代码。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d934" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太好了。您将在接下来的步骤中将其添加到您的应用程序中。</p><h2 id="0ccb" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">在React应用程序上初始化Firebase</h2><p id="067c" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">转到项目的根目录。安装firebase，并在src目录中添加一个名为firebase.js的firebase配置文件:</p><p id="b6ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b">npm i firebase</code></p><p id="adec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b">touch src/firebase.js</code></p><p id="60ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">firebase安装后，在firebase.js中导入firebase，粘贴SDK配置，并用我们之前找到的配置初始化firebase。使用下面的代码并粘贴您自己的凭据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ed7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在测试firebase是否在您的项目中。转到App.js并打印出firebase实例。为了简单起见，我删除了App.js的所有内容，并替换为以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ac04" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在做<code class="fe nr ns nt nu b">npm start</code>，你会看到这个窗口。打开控制台。您应该在localhost上获得以下内容:3000</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/c39958bbd2af2bfce326559cc41b70dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyc30xs6_o_FoB1fX9imTg.png"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk">Application with Firebase working</figcaption></figure><p id="1f9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">恭喜你，Firebase已经安装完毕，可以开始运行了！</strong></p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="b85e" class="nd lo iq bd lp ne nf ng ls nh ni nj lv jw nk jx ly jz nl ka mb kc nm kd me nn bi translated">3.使用API范围的Google登录</h1><p id="479e" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">现在是有趣的部分。您将在firebase后端启用Google。然后，您将设置带有自定义作用域的代码，以获得一个令牌，使您能够使用Sheets和Drive API。</p><h2 id="3c96" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">在Firebase中启用Google</h2><ol class=""><li id="8269" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">再次转到Firebase，并进入项目概述左侧的<strong class="kt ir">身份验证</strong>选项卡。</li><li id="5167" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">新闻设置登录方法</li><li id="a69b" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">按下谷歌，并启用它(小开关变成蓝色)</li><li id="d13f" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">按下<strong class="kt ir">保存</strong>。</li></ol><h2 id="4759" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">从React登录Google</h2><p id="7a7e" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">让我们创建登录函数。这一部分非常简单。为了保持有序，在<strong class="kt ir"> src </strong>中创建一个<strong class="kt ir"> auth.js </strong>文件。现在用Drive API作用域设置Google firebase登录函数。</p><p id="22a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b">touch src/auth.js</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="fd30" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样。这个函数让您登录Google，并为您提供正确的令牌来访问您的Google APIs。现在你只需要<strong class="kt ir">从App.js中正确调用函数</strong>。</p><p id="7be8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们将函数导入App.js，调用函数，获取用户信息和令牌，最后将它们设置为<strong class="kt ir">状态。</strong>我还添加了简单的渲染逻辑，以显示注销时的“使用Google登录”按钮，以及登录时的用户电子邮件和令牌。</p><blockquote class="od oe of"><p id="564f" class="kr ks nv kt b ku kv jr kw kx ky ju kz og lb lc ld oh lf lg lh oi lj lk ll lm ij bi translated"><strong class="kt ir">警告1: </strong>您可能会收到一条消息，提示“应用程序未经验证”。你可以点击<strong class="kt ir">“高级”</strong>按钮，然后点击底部的链接。你可以点击此链接查看如何验证你的应用:<a class="ae oj" href="https://support.google.com/googleapi/answer/7454865?hl=en" rel="noopener ugc nofollow" target="_blank">https://support.google.com/googleapi/answer/7454865?hl=en</a></p><p id="dbcf" class="kr ks nv kt b ku kv jr kw kx ky ju kz og lb lc ld oh lf lg lh oi lj lk ll lm ij bi translated">令牌在1小时后过期，这意味着它们对API的访问也过期了。你需要重新加载你的应用并再次登录。否则你会得到认证错误</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="95c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你做的一切都是正确的，你应该看到这个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/8331a473155323c5cf0e01e15e7a3cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5OW_BuBYp94GIWJDbRsvA.png"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk">Application successfully got token after login</figcaption></figure><p id="59a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如你所见，我的电子邮件在图片上。如果到目前为止您有任何问题，请告诉我！<em class="nv">(附上你的github回购链接并描述问题)</em></p><p id="71c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">妙极了。</strong>现在您已经有了一个准备使用Drive API的登录用户。所以还是用起来吧！</p><h1 id="d3db" class="nd lo iq bd lp ne ol ng ls nh om nj lv jw on jx ly jz oo ka mb kc op kd me nn bi translated">4.驱动API</h1><p id="1389" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">为了充分使用API，您必须首先在Google控制台上启用它。一旦启用，您就可以使用令牌来访问API。</p><h2 id="e5b8" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">在Google控制台上启用Drive</h2><p id="800a" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">谷歌阻止你直接访问API，除非你已经在他们的控制台上启用了它们。如果您从未这样做过，请遵循以下步骤。</p><ol class=""><li id="9ee1" class="mg mh iq kt b ku kv kx ky la oq le or li os lm mn mo mp mq bi translated">转到<a class="ae oj" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/</a></li><li id="0e81" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">在顶部，单击选择项目。</li><li id="fbb0" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">如果在“最近”选项卡上没有看到您的项目，请选择“全部”。找到后，点击它。</li><li id="5b6c" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">单击“启用API和服务”</li><li id="44af" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">搜索“Google Drive API”。一旦它出现，选择它。</li><li id="f9df" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">最后，点击“启用”。</li></ol><p id="b683" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你都准备好了。现在您已经启用了<strong class="kt ir">API</strong>，并且您拥有了一个<strong class="kt ir">令牌</strong>来访问API。是的，一旦你在<strong class="kt ir"> auth.js </strong>中添加了作用域“https://www . Google APIs . com/auth/drive ”,你就把它与你的<strong class="kt ir"> google控制台</strong>连接起来，现在它就启用了！</p><h2 id="c7e6" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">访问驱动器API文件</h2><p id="9cf6" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">关键时刻；使用API。</p><p id="add6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用JavaScript的<strong class="kt ir">获取</strong>来访问API。首先，创建一个新文件来保持src的有序。</p><p id="0cf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b"><strong class="kt ir">touch src/drive.js</strong></code></p><p id="e4ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们将设置url，然后用请求中的令牌构建对服务器的GET请求，最后返回信息。</p><p id="4754" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<strong class="kt ir"> drive.js </strong>上，用fetch调用API并使用授权头中的令牌:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="f211" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仔细观察获取请求的结构。谷歌要求你在<strong class="kt ir">授权头中传递一个<strong class="kt ir">不记名令牌</strong>。</strong>我花了3个月才学会这个，所以如果一开始没多大意义也不要太难受。</p><p id="388d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们已经准备好使用这段代码了。将函数添加到App.js，并传入登录后获得的令牌。我添加了一个简单的按钮和一个调用API的函数；<em class="nv">见</em>第25行&amp;第44行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1d47" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你做的一切都是正确的，你应该在按下“从驱动器获取文件”按钮后得到这个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/e7c75e7bff6db05d415bee47e7eb92a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3fhuRJKEB88mgQWhJI6Lw.png"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk">Application successfully getting data from the Drive API</figcaption></figure><p id="0668" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这真是太棒了！您现在可以访问所有驱动器文件。我们现在将扩展功能。</p><h1 id="99c7" class="nd lo iq bd lp ne ol ng ls nh om nj lv jw on jx ly jz oo ka mb kc op kd me nn bi translated">5.谷歌工作表API</h1><p id="5e07" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">让我们创建一个新的谷歌表！</p><h2 id="dc54" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">在控制台上授权工作表API</h2><ol class=""><li id="b444" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">遵循第4部分的相同步骤:<strong class="kt ir">在控制台上启用驱动</strong></li><li id="4695" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">启用<strong class="kt ir">谷歌工作表API </strong></li></ol><p id="edf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在你已经准备好使用它了！</p><p id="b0ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="nv">重要:</em></strong><em class="nv"/><strong class="kt ir"><em class="nv">Google Drive API</em></strong><em class="nv">作用域</em><strong class="kt ir"><em class="nv"/></strong><em class="nv">https://www.googleapis.com/auth/drive</em><strong class="kt ir"><em class="nv">【auth . js</em></strong><em class="nv">中的“还可以访问工作表API。这就是为什么我们</em> <strong class="kt ir"> <em class="nv">不</em> </strong> <em class="nv">非得编辑我们的</em><strong class="kt ir"><em class="nv">auth . js</em></strong><em class="nv">文件添加一个新的特定的电子表格范围。这适用于这个特定的API。您应该看看每个API的文档，看看它需要什么范围！你可以在这里阅读更多关于工作表API的作用域:</em><a class="ae oj" href="https://developers.google.com/sheets/api/guides/authorizing" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://developers.google.com/sheets/api/guides/authorizing</em></a><em class="nv">(向下滚动，你会看到作用域)。</em></p><h2 id="a364" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">创建您的第一个电子表格</h2><p id="cac4" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">在src中添加一个名为<strong class="kt ir"> sheets.js </strong>的文件，并用您的令牌创建一个对<a class="ae oj" href="https://sheets.googleapis.com/v4/spreadsheets" rel="noopener ugc nofollow" target="_blank">https://sheets.googleapis.com/v4/spreadsheets</a>的POST请求，以及一个指定标题的主体。</p><p id="79fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nr ns nt nu b">touch scr/sheets.js</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2536" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在Sheets API v4 docs中查看主体的属性:<a class="ae oj" href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets#Spreadsheet" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/Sheets/API/reference/rest/v4/spreadsheets # Spreadsheet</a></p><p id="8fca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们将函数添加到我们的<strong class="kt ir"> App.js </strong>文件<em class="nv">(第32行)</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d2cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击创建新的电子表格按钮。您应该看到一个日志，上面写着“工作表已创建！”几秒钟后。您可以通过按“从驱动器获取文件”按钮来检查您的文件是否已创建。回来的<strong class="kt ir">阵</strong>应该是加了<strong class="kt ir">一个</strong>。试试吧！从驱动器中获取文件，创建电子表格，现在再次从驱动器中获取文件，您应该会看到更多！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/ed833d0185430ad930d38bcc0b050556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAo12X6x9lWmdqjvHqQDNA.png"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk"><strong class="bd ov">localhost:3000 </strong>App successfully getting and adding files to the Drive and Sheets APIs</figcaption></figure><h2 id="25df" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">检查重复项</h2><p id="5026" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">如果你多次按下“创建新的电子表格”按钮，然后打开谷歌硬盘，你会发现有多个文件同名。假设您希望您的应用程序检查是否有副本，以避免创建多个副本。让我们解决这个问题。</p><p id="0a6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">驱动程序API支持对其API GET请求的查询。</p><p id="3430" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用"<strong class="kt ir">名称"</strong>查询参数。因此，在<strong class="kt ir"> drive.js </strong>上创建一个新函数，通过名称获取文件。我们将其命名为getFilesByName，并添加一个自定义url来添加查询。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e053" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nv">你可以在这里阅读更多API查询参数:</em><a class="ae oj" href="https://developers.google.com/drive/api/v3/reference/query-ref#fn1" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://developers . Google . com/drive/API/v3/reference/query-ref # fn1</em></a></p><p id="8b95" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们用App.js中的这个函数来检查数组是否大于0(也就是上面有没有文件)。检查第32行和第48行的函数。我添加了一个简单的方法来检查文件长度，如果有名为“My Sheet 1”(我们最初创建的工作表)的文件，那么就不要创建新的文件。否则，创建一个新文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="6bd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">检查它是否存在后，根据它创建它或不创建它。</p><p id="a075" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">如果文件存在，下面是截图:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/14e7022aa798f558e5657b50c79eb01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vsVAyBvS_Mcr6eWpv-4TQ.png"/></div></div></figure><p id="d8a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">以下是文件不存在时的截图(将名称从“我的工作表1”更改为“我的工作表2”或任何其他名称！):</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/3f4879ab31d8ac4c808f107a5e6e56ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k_p8I5bcCyKsfN5kfqWS6w.png"/></div></div></figure><p id="5f67" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以创建一个具有特定名称的电子表格，而不会得到双精度。</p><h2 id="3003" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">获取和设置SheetId</h2><p id="2c38" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">现在让我们编辑您刚刚创建的电子表格中的一个单元格，名为“MySheet 2”。为此，我们将更改复制函数，返回找到的文件的spreadsheetId。</p><p id="5df9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们想要的如下:如果它找到一个副本，使用该副本的sheetId来更新该电子表格。如果没有找到，就创建一个新的电子表格，并将id设置为该电子表格。我修改了我们的checkDuplicates(第54行)来返回文件，并将createSheet函数改为createOrSetSheet(第33行)。如果有什么不工作，我建议将这段代码粘贴到您已经拥有的代码之上！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c557" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太好了！应该可以了。现在您正在创建一个电子表格，并设置它是否存在。</p><p id="cb6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果工作表不存在，控制台上应该是这样的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/18d57128c6d702341cd94bb7826ca54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1YkLrqdFFB-ymE4CdHWszw.png"/></div></div></figure><p id="bb60" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果它确实存在，这应该是它的样子</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/b3d519398592c5bbd38dc103fb5a5726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*woAy8Sj1nsnOw2zGV7TfdQ.png"/></div></div></figure><p id="53b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这足够清楚！现在，最后一部分，实际上是更新电子表格。</p><h2 id="df9d" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">更新电子表格数据</h2><p id="ccf1" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la no lc ld le np lg lh li nq lk ll lm ij bi translated">我们将从API中使用<strong class="kt ir"> RepeatCellRequest端点</strong>。你可以在这里了解更多信息:</p><div class="oz pa gp gr pb pc"><a href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#RepeatCellRequest" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">请求|工作表API | Google开发人员</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">发送反馈将区域中的所有单元格更新为给定单元格对象中的值。只有在…中列出的字段</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">developers.google.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq kp pc"/></div></div></a></div><p id="1771" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">基于<strong class="kt ir"> src/sheets.js文档中的参数构建获取请求。如果你问我，这是最难创造的。一旦你看到了我的代码，去看看文档，看看如何扩展功能(给单元格添加颜色，改变文本大小，添加公式等)。</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c55d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对这个功能做一点解释不会有什么坏处，特别是对身体。Sheets API期望一个<strong class="kt ir">请求</strong>对象数组(第25行)。<strong class="kt ir"> repeatCell </strong>对象是一种改变特定单元格或单元格范围的请求。您必须指定三个主要内容来生成更新:</p><ol class=""><li id="62c5" class="mg mh iq kt b ku kv kx ky la oq le or li os lm mn mo mp mq bi translated"><strong class="kt ir"> Range </strong>:给定索引值:startColumnIndex: 0，endColumnIndex: 1，startRowIndex:0，endRowIndex:1指定函数将在电子表格上的何处执行。<strong class="kt ir"> SheetId不是spreadsheetId。</strong>您的电子表格可能有多个入口点，您必须指定创建的第一个表格。在这种情况下，0。</li><li id="9a53" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated"><strong class="kt ir">单元格</strong>:您要编辑的单元格的具体内容。您可以更改字体、颜色、值等。</li><li id="172b" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated"><strong class="kt ir">字段:</strong>您可以限制请求可以编辑的内容。f <strong class="kt ir">字段:“*”</strong>表示您可以编辑单元格的每个方面。</li></ol><p id="d2eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这有意义！</p><p id="72b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">现在导入App.js中使用！</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e597" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！去sheets.google.com看看你的档案(“我的第三页”)或者随便你怎么称呼它。您应该会在单元格A1中看到一个<strong class="kt ir"> 2000 </strong>！通过查看上面的<strong class="kt ir"> RepeatCellRequest </strong>链接，尝试更改其他属性。</p><p id="95bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！希望你学会了这些API的完整流程，现在可以使用这个结构来使用/探索其他Google APIs了！</p><h2 id="3eb6" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">以下是你学到的东西:</h2><ol class=""><li id="3fb7" class="mg mh iq kt b ku mi kx mj la mk le ml li mm lm mn mo mp mq bi translated">在React项目中设置Firebase</li><li id="f4e8" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">使用Google认证用户并授权特定范围。</li><li id="1ca3" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">使用令牌来使用Google Sheets和Google Drive APIs</li><li id="0ccc" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">已检查驱动器API中的现有文件</li><li id="3d5c" class="mg mh iq kt b ku mr kx ms la mt le mu li mv lm mn mo mp mq bi translated">创建电子表格并更新电子表格值</li></ol><p id="8873" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这对你有帮助！如果你遇到困难或者有什么事情不适合你，请告诉我。以下是完整的回购协议:</p><div class="oz pa gp gr pb pc"><a href="https://github.com/Ignacio1996/google-apis-tutorial.git" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">Ignacio 1996/Google-API-教程</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">在GitHub上创建一个帐户，为Ignacio 1996/Google-APIs-tutorial开发做贡献。</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">github.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq kp pc"/></div></div></a></div><p id="f7c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你看到我的firebase证书，别担心。我已经删除了原项目，所以都是安全的。记得用你的证件！</p><p id="96a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一如既往，</p><h2 id="9ed7" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">编码快乐！</h2></div></div>    
</body>
</html>