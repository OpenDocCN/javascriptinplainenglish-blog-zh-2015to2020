<html>
<head>
<title>Working with Time Data in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript中使用时间数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/working-with-time-data-in-javascript-af3215f64d8a?source=collection_archive---------4-----------------------#2020-07-23">https://javascript.plainenglish.io/working-with-time-data-in-javascript-af3215f64d8a?source=collection_archive---------4-----------------------#2020-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1212a5663302d00a6f3db08cd9431c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAD-A6V4ruS7guoNIE1JBw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@bradneathery?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Brad Neathery</a> on <a class="ae jz" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ee99" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不久前，我编写了一个CRUD应用程序，它跟踪创建并存储在数据库中的条目的“开始时间”和“结束时间”。我可以减去这些时间值，为每个条目找到一个简单的“时间长度”。但是以一种有用的格式检索时间数据比我想象的要困难一些。</p><h1 id="d0af" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">日期和时间问题</h1><p id="e6a6" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">处理时间数据最困难的部分是一个边缘案例可能会让您的应用程序陷入一个循环。诸如本地化、24小时与12小时时间以及其他主题提出了有趣的挑战。</p><p id="1a6a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我的应用程序中，一个困难的概念是让用户能够创建一个持续超过24小时的条目。在AM / PM格式的约束下工作本身就具有很大的挑战性。</p><p id="6391" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面的微型项目旨在展示一些我发现的关于在JavaScript中使用时间戳的有用的东西，特别是在计算时间流逝的价值方面。</p><h1 id="0fb5" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置项目</h1><p id="038b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">这是一个非常基本的项目，只有最小的CSS，我不会在这里包括。</p><p id="3446" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">HTML用两个本地日期时间输入建立了一个基本的计算器大纲。</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="0e73" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">JavaScript如下所示:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="ada4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该项目目前看起来是这样的:</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/8888db26cded0de409dc8155195c41c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uU2QigZxQHpKj04XwHxA1A.png"/></div></div></figure><h1 id="c14f" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">项目说明</h1><h1 id="5cfb" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">1.用HTML输入检索时间字符串</h1><p id="ebe5" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">HTML <code class="fe mi mj mk ml b">&lt;input type=’datetime-local’&gt;</code>为本地化做了大部分繁重的工作。这将创建一个类似日历的输入，其中包括一个12小时或24小时格式的时间字段，具体取决于用户操作系统的默认设置。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/9987e495cfa8b7a7ee02baaed6479f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*0srru6-vtJgY54Vt1_vLzA.png"/></div></figure><p id="3a76" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当您在JavaScript中检索输入值时，您将可以访问如下所示的字符串:</p><pre class="mb mc md me gt mn ml mo mp aw mq bi"><span id="6180" class="mr kz in ml b gy ms mt l mu mv">2020-07-21T16:20</span></pre><h1 id="0985" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">2.将日期字符串转换为Unix时间戳(自1970年1月1日以来的毫秒数)</h1><p id="8dca" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">单击Calculate按钮时触发的回调函数将把与您的时间输入相关联的日期字符串转换成一个数值。</p><p id="51bd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经创建了一个与每个输入字段的值相对应的变量。然后，我们为每个值创建一个新的<code class="fe mi mj mk ml b">Date</code>对象，并传递这些值来创建日期。然后，我们使用内置于<code class="fe mi mj mk ml b">Date</code>对象中的<code class="fe mi mj mk ml b">.getTime()</code>方法将我们的字符串转换成Unix时间戳。</p><p id="2bdb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个时间戳具有很强的可塑性，可以绕过许多关于时间数据处理的陷阱。这个数字被称为Unix时间或纪元时间，在JavaScript中，它表示自1970年初以来经过的毫秒数。</p><p id="694a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这很棒的原因是，当应用程序的边缘情况开始出现时，处理字符串、对象或其他数据类型格式的时间数据将会带来巨大的挑战。如果您的应用程序被从头开始配置为只接受Unix格式的时间数据<strong class="kc io">和</strong>，那么您可以根据需要轻松地操作您的Unix数据，向用户显示有用的信息。我们将在下一步中这样做。</p><h1 id="17cc" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">3.操作前端的Unix时间戳</h1><p id="1101" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在这个项目中，以及我前面谈到的CRUD应用程序中，我想向用户显示从开始时间到结束时间已经过去的小时数。</p><p id="9144" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这归结为一个基本的计算方法，用Unix值的开始时间减去Unix值的结束时间。这将产生一个毫秒的差值，我们可以用这个差值除以一个小时的毫秒数(3，600，000)。最后，我们可以通过用<code class="fe mi mj mk ml b">.toFixed(2)</code>舍入到第二个小数位来进一步清理东西。</p><p id="30af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">计算完成后，我们更新“result”元素的值，以显示前端已经过去的小时数。</p><h1 id="7caa" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">4.添加基本验证</h1><p id="099e" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">回调函数中的变量将根据传递给它们各自的<code class="fe mi mj mk ml b">Date</code>对象的字符串来表示数值。如果他们不能这样做，<code class="fe mi mj mk ml b">NaN</code>将被归还。</p><p id="5469" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我们将检查以确保两个字段都不返回<code class="fe mi mj mk ml b">NaN</code>，如果其中一个返回了<code class="fe mi mj mk ml b">alert</code>，则退出函数。我们还将检查以确保结束时间晚于开始时间。</p><p id="d2e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这基本上是这个项目所做的全部工作，计算结果的成品将如下所示:</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/1676c2f37dac776c5bff395cc4b2e2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THOMdKeTp7a2C2zn1AQ6Og.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Calculator with an accurate calculation on display</figcaption></figure><h1 id="b675" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">将此应用于其他场景</h1><p id="de3e" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">使用Unix时间数据的美妙之处在于它具有广泛的可塑性。在大多数情况下，它绕过了本地化、用户时间显示首选项以及其他难以管理的情况所带来的限制。</p><h1 id="63ed" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">关于存储时间数据的重要警告</h1><p id="e19f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">这个项目是在JavaScript中使用时间数据的一个非常简单的演示，但是它并没有涵盖<em class="mx">存储</em>和<em class="mx">显示</em>数据以备后用的一些重要方面。当JavaScript将时间字符串转换为Unix时间时，它将使用UTC。这通常符合您的最大利益，因为将所有时间数据存储为UTC是有益的，但是根据用户的位置，还需要一个额外的步骤来以有用的时间格式显示数据。</p><p id="1b53" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">换句话说，用UTC存储数据，并将该数据的前端表示转换为用户的本地时间。</p><h1 id="1ed9" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">关键外卖</h1><p id="0d93" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在JavaScript(以及任何编程语言)中处理日期和时间都会遇到很多“问题”。当您开始考虑您的应用程序可能需要的任何复杂功能时，您可能希望考虑实现Unix时间，以将您自己从许多管理难题中解救出来。</p><p id="e72b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我很想知道你对如何在JavaScript中处理时间有没有其他建议，所以如果我错过了一些很酷的东西，请告诉我。</p><p id="e22b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读。</p><h1 id="0aa3" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">简单英语的JavaScript</h1><p id="12e1" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">喜欢这篇文章吗？如果是这样，通过<a class="ae jz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">订阅解码获得更多类似内容，我们的YouTube频道</strong> </a> <strong class="kc io">！</strong></p></div></div>    
</body>
</html>