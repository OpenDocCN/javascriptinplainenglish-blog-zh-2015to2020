<html>
<head>
<title>Create a Stateful Camera Gallery App with Font Awesome using Nativescript Vue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nativescript Vue创建一个字体为Awesome的全状态相机图库应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/stateful-nativescript-vue-camera-gallery-app-with-font-awesome-37bd7d19c16?source=collection_archive---------6-----------------------#2019-11-01">https://javascript.plainenglish.io/stateful-nativescript-vue-camera-gallery-app-with-font-awesome-37bd7d19c16?source=collection_archive---------6-----------------------#2019-11-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="cec2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇文章中，我将介绍如何使用Nativescript创建一个简单的应用程序，该应用程序使用设备摄像头拍摄照片，在一个简单的图像库中显示这些照片，使用字体很棒的图标，并在应用程序运行期间维护图库的状态。这是<a class="ae ki" href="https://blog.angelengineering.com/stateful-picture-gallery/" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>的更新版本，但是现在使用的是带有Vue的Nativescript 6.1.2，而不是Javascript。</p><h1 id="5c71" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">使用Nativescript CLI创建新应用程序</h1><p id="ada3" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">Nativescript 6.1.2是最近发布的，我将在帖子中使用这个版本。我使用以下命令升级到最新版本的CLI:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="3313" class="lv kk in lr b gy lw lx l ly lz">npm install -g nativescript</span></pre><p id="9ca3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装新的CLI后，我们将使用Nativescript CLI创建一个新的应用程序，执行Nativescript CLI诊断检查，然后在iOS模拟器中运行基本应用程序，以确保一切正常工作。我们将开始使用下面的命令设置一个名为<code class="fe ma mb mc lr b">NSimagallery6</code>的新应用程序。</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="eb39" class="lv kk in lr b gy lw lx l ly lz">tns create NSimagegallery6</span></pre><p id="a29e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">CLI将询问您希望使用哪种语言风格，以及使用哪种模板结构来构建您的新应用程序。选择“Vue.js”作为样式，“Blank”作为模板。</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi md"><img src="../Images/265c80a062f69bbd2a2fcc3d3fbdeda4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*07QLnZc03LmZWa_g.png"/></div></figure><p id="246b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦搭建完成，您可以切换到该目录，添加iOS平台，然后使用<code class="fe ma mb mc lr b">tns doctor</code> CLI命令确保您的Nativescript应用程序环境正常。</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="3b4f" class="lv kk in lr b gy lw lx l ly lz">cd NSimagegallery6 <br/>tns platform add ios<br/>tns doctor<!-- --> </span></pre><p id="51bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下载的模板可能会针对稍微旧一点的Nativescript平台版本，所以在运行<code class="fe ma mb mc lr b">tns doctor</code>后，您可能会看到如下警告。</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/4cb5505df6d68e57b33546c3f2fe2a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4_j3m_FMh1_MHKjW.png"/></div></div></figure><p id="9076" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用Nativescript CLI更新移动平台版本可以通过使用以下命令移除平台并将其重新添加到项目中来完成。CLI将使用当前平台版本更新package.json文件。或者，您也可以手动编辑<code class="fe ma mb mc lr b">package.json</code>中的包版本。</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="e807" class="lv kk in lr b gy lw lx l ly lz">tns platform remove ios <br/>tns platform add ios</span></pre><p id="1685" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用以下工具在模拟器或设备上运行应用程序:</p><p id="643a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切运行正常，您应该会在iPhone模拟器上看到以下屏幕。</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/6962200faf23cec92994cf060313729e.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/0*8Yc18zExzO0ppjHK.png"/></div></figure><p id="34c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，查看新创建的应用程序的文件夹结构，您会看到以下内容:</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/2c84a53cbd0c60ba8ba5d21f63800b03.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/0*ALmO-gCTtSmsfvVJ.png"/></div></figure><p id="8eef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个新版本的Vue Blank应用程序模板的一个主要区别是，它现在预配置为支持在Nativescript应用程序中使用字体很棒的图标。你会在<code class="fe ma mb mc lr b">/app/fonts</code>文件夹中看到<code class="fe ma mb mc lr b">FontAwesome.ttf</code>文件，它由<code class="fe ma mb mc lr b">/app/app.scss</code>作为<code class="fe ma mb mc lr b">/app/_app-common.scss</code>的导入加载，并通过一个名为<code class="fe ma mb mc lr b">fa</code>的CSS类使用。模板应用程序使用字体牛逼图标显示在中心文本的开始。你可以在Github 上的<a class="ae ki" href="https://github.com/NativeScript/nativescript-app-templates" rel="noopener ugc nofollow" target="_blank"> Nativescript应用模板报告中找到其他(以及更新的)版本的应用模板。</a></p><h1 id="5d03" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">创建基本的相机应用程序</h1><p id="84d0" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">模板应用程序由一个显示Vue组件页面的页面组成，页面中央有一条简单的消息，作为主入口页面加载到<code class="fe ma mb mc lr b">app/app.js</code>内的应用程序中。通过在初始导入代码后添加<code class="fe ma mb mc lr b">Vue.config.silent = false;</code>,您可以在这个文件中启用来自Vue解释器的更详细的调试消息。我们希望我们的应用程序的第一个版本是一个单独的页面，显示一个拍照按钮和一个显示应用程序拍摄的最后一张照片的图像字段，所以我们将使用现有的模板结构，并替换应用程序主页的内容。</p><p id="7e11" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，使用以下CLI命令安装<a class="ae ki" href="https://github.com/NativeScript/nativescript-camera" rel="noopener ugc nofollow" target="_blank"> Nativescript相机插件</a>，这将允许我们访问设备相机来拍照。</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="71bf" class="lv kk in lr b gy lw lx l ly lz">tns plugin add nativescript-camera</span></pre><p id="686d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在将把<code class="fe ma mb mc lr b">/app/components/Home.vue</code>中的主页组件修改为:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="8b2a" class="lv kk in lr b gy lw lx l ly lz">&lt;template&gt;<br/>    &lt;Page class="page"&gt;<br/>        &lt;ActionBar class="action-bar"&gt;<br/>            &lt;Label class="action-bar-title" text="Picture Gallery"&gt;&lt;/Label&gt;<br/>        &lt;/ActionBar&gt;<br/>        &lt;StackLayout&gt;<br/>            &lt;Label text="Take a Pic" <a class="ae ki" href="http://twitter.com/tap" rel="noopener ugc nofollow" target="_blank">@tap</a>="takePicture" class="take-picture-icon" /&gt;<br/>            &lt;Image :src="cameraImage" class="picture-gallery" stretch="aspectFit" /&gt;<br/>        &lt;/StackLayout&gt;<br/>    &lt;/Page&gt;<br/>&lt;/template&gt;</span><span id="4067" class="lv kk in lr b gy mo lx l ly lz">&lt;script&gt;<br/>const cameraModule = require("nativescript-camera");<br/>export default {<br/>    computed: {<br/>    },<br/>    data() {<br/>        return {<br/>            cameraImage: null<br/>        };<br/>    },<br/>    methods: {<br/>        takePicture() {<br/>            let that = this;<br/>            cameraModule<br/>                .takePicture({<br/>                    width: 300,  //these are in device independent pixels<br/>                    height: 300, //only one will be respected depending on os/device if<br/>                    keepAspectRatio: true, //    keepAspectRatio is enabled.<br/>                    saveToGallery: false //Don't save a copy in local gallery, ignored by some Android devices<br/>                })<br/>                .then(imageAsset =&gt; {<br/>                    that.cameraImage = imageAsset<br/>                })<br/>        }<br/>    },<br/>    mounted() {<br/>        cameraModule.requestPermissions().then( //request permissions for camera<br/>            success =&gt; { //have permissions  <br/>            },<br/>            failure =&gt; { //no permissions for camera<br/>            }<br/>        )<br/>    }<br/>}<br/>&lt;/script&gt;</span><span id="4afd" class="lv kk in lr b gy mo lx l ly lz">&lt;style scoped lang="scss"&gt;<br/>.take-picture-icon {<br/>    horizontal-align: center;<br/>    background-color: rgb(105, 105, 241);<br/>    padding: 12;<br/>    border-width: 1.2;<br/>    border-color: black;<br/>    border-radius: 14;<br/>    margin-top: 20;<br/>    color: white;<br/>    font-size: 30;<br/>}<br/>.picture-gallery {<br/>    margin-top: 60;<br/>}<br/>&lt;/style&gt;</span></pre><p id="6430" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经从Vue模板中删除了示例消息，并添加了一个行为和外观都像按钮的标签，以及一个将显示相机拍摄的最后一张照片的图像元素。代码部分内部是<code class="fe ma mb mc lr b">takePicture()</code>函数，它调用Nativescript Camera插件在点击按钮时拍照，然后将该图片设置为按钮下方显示的图像源。页面加载后运行<code class="fe ma mb mc lr b">mounted()</code>函数，调用Camera插件中的<code class="fe ma mb mc lr b">requestPermissions()</code>来获得应用程序访问设备摄像头的本地权限(当使用iOS模拟器选择设备图像时，还会访问照片库，因为模拟器没有摄像头)。</p><p id="0b0b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<code class="fe ma mb mc lr b">tns run ios</code>在iOS模拟器上运行应用程序，点击“拍照”按钮，从模拟器图库中选择一张图片，您应该会看到类似于以下内容的内容:</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/17cb09a15c090cd9c480c370c00c1f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/0*6bn25ADU_o2ssCik.png"/></div></figure><h1 id="fc7d" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">Android和iOS版本的相机权限</h1><p id="6d93" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">除了本地权限之外，您还需要为构建过程添加一些额外的权限，以允许摄像机访问。对于iOS，编辑“App/App _ Resources/iOS/info . plist”并添加以下键:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="8f95" class="lv kk in lr b gy lw lx l ly lz">&lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;<br/>&lt;string&gt;To access saved pictures&lt;/string&gt;<br/>&lt;key&gt;NSCameraUsageDescription&lt;/key&gt;<br/>&lt;string&gt;To take new pictures&lt;/string&gt;</span></pre><p id="af26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于Android，编辑“App/App _ Resources/Android/Android manifest . XML”并添加以下权限:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="1590" class="lv kk in lr b gy lw lx l ly lz">&lt;uses-permission android:name="android.permission.CAMERA"/&gt;</span></pre><h1 id="bb92" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">在Nativescript中使用字体超赞图标</h1><p id="8f94" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">除了使用文本作为图片按钮，你还可以使用字体很棒的图标。Font Awesome库可用于在您的Nativescript应用程序中注入可缩放的图标，让您不必再为设计自己的图像和Android和iOS上所有可能的屏幕尺寸所需的多分辨率版本而头疼。它们在Nativescript应用程序中也非常容易使用，特别是因为空白应用程序模板附带了已经设置好的字体文件和css类。</p><p id="8850" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当你想使用一个特定的图标时，你必须首先<a class="ae ki" href="https://fontawesome.com/icons?d=gallery&amp;q=camera&amp;m=free" rel="noopener ugc nofollow" target="_blank">查找图标</a>的unicode值。对于这个应用程序，我将使用<a class="ae ki" href="https://fontawesome.com/icons/camera-retro?style=solid" rel="noopener ugc nofollow" target="_blank">固体相机图标</a>，因为常规和轻型版本仅作为Font Awesome Pro包的一部分提供。在信息页面上，您会看到这个特定图标的unicode编码，即<code class="fe ma mb mc lr b">f030</code>。每当你想在应用程序中使用图标时，记下代码，然后使用格式化为<code class="fe ma mb mc lr b">&amp;#xf030;</code>的unicode作为标签的<code class="fe ma mb mc lr b">text.decode</code>值，并分配<code class="fe ma mb mc lr b">fa</code>类。</p><p id="78da" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们用这个图标更新我们的应用程序，将标签从<code class="fe ma mb mc lr b">&lt;Label text="Take a Pic" @tap="takePicture" class="take-picture-icon" /&gt;</code>改为<code class="fe ma mb mc lr b">&lt;Label text.decode="&amp;#xf030; " @tap="takePicture" class="take-picture-icon fa" /&gt;</code>。</p><p id="8438" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">保存并重新运行应用程序，它现在应该看起来像:</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/9109c3be811b8d49011e58c8f59793c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/0*GJA0frbi6nfLLGaO.png"/></div></figure><h1 id="bef0" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">显示多张图片</h1><p id="1bbf" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">现在让我们让这个应用程序更有用，我们将使用一个简单的图片库来显示到目前为止拍摄的所有照片，而不是只显示最后拍摄的照片。我们将在Image元素上使用Vue <code class="fe ma mb mc lr b">v-for</code>指令，并将其嵌套在StackLayout中，以呈现相机拍摄的所有图片，这些图片现在将存储在一个数组中。这将嵌套在一个ScrollView容器中，这样我们就可以上下滚动图像。</p><p id="1d0f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编辑<code class="fe ma mb mc lr b">/app/components/Home.vue</code>，使其包含:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="073d" class="lv kk in lr b gy lw lx l ly lz">&lt;template&gt;<br/>    &lt;Page class="page"&gt;<br/>        &lt;ActionBar class="action-bar"&gt;<br/>            &lt;Label class="action-bar-title" text="Picture Gallery"&gt;&lt;/Label&gt;<br/>        &lt;/ActionBar&gt;<br/>        &lt;StackLayout&gt;<br/>            &lt;Label text.decode="&amp;#xf030; " <a class="ae ki" href="http://twitter.com/tap" rel="noopener ugc nofollow" target="_blank">@tap</a>="takePicture" class="take-picture-icon fa" /&gt;<br/>            &lt;ScrollView class="picture-gallery" orientation="vertical"&gt;<br/>                &lt;StackLayout&gt;<br/>                    &lt;Image v-for="image in arrayPictures" class="gallery-item" :src="image" stretch="aspectFill" /&gt;<br/>                &lt;/StackLayout&gt;<br/>            &lt;/ScrollView&gt;<br/>    <br/>        &lt;/StackLayout&gt;<br/>    &lt;/Page&gt;<br/>&lt;/template&gt;</span><span id="6ec1" class="lv kk in lr b gy mo lx l ly lz">&lt;script&gt;<br/>const cameraModule = require("nativescript-camera");<br/>export default {<br/>    computed: {},<br/>    data() {<br/>        return {<br/>            arrayPictures: []<br/>        };<br/>    },<br/>    methods: {<br/>        takePicture() {<br/>            let that = this;<br/>            cameraModule<br/>                .takePicture({<br/>                    width: 300, //these are in device independent pixels<br/>                    height: 300, //only one will be respected depending on os/device if<br/>                    keepAspectRatio: true, //    keepAspectRatio is enabled.<br/>                    saveToGallery: false //Don't save a copy in local gallery, ignored by some Android devices<br/>                })<br/>                .then(imageAsset =&gt; {<br/>                    that.arrayPictures.unshift(imageAsset)<br/>                })<br/>        }<br/>    },<br/>    mounted() {<br/>        cameraModule.requestPermissions().then( //request permissions for camera<br/>            success =&gt; { //have permissions  <br/>            },<br/>            failure =&gt; { //no permissions for camera<br/>            }<br/>        )<br/>    }<br/>}<br/>&lt;/script&gt;</span><span id="204a" class="lv kk in lr b gy mo lx l ly lz">&lt;style scoped lang="scss"&gt;<br/>.take-picture-icon {<br/>    horizontal-align: center;<br/>    background-color: rgb(105, 105, 241);<br/>    padding: 12;<br/>    border-width: 1.2;<br/>    border-color: black;<br/>    border-radius: 14;<br/>    margin-top: 20;<br/>    margin-bottom: 20;<br/>    color: white;<br/>    font-size: 30;<br/>    padding-left: 20;<br/>}</span><span id="3a65" class="lv kk in lr b gy mo lx l ly lz">.picture-gallery {<br/>    margin-top: 20;<br/>}</span><span id="c0d1" class="lv kk in lr b gy mo lx l ly lz">.gallery-item {<br/>    margin: 10;<br/>}<br/>&lt;/style</span></pre><p id="eabb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ma mb mc lr b">takePicture()</code>功能现在将保存在<code class="fe ma mb mc lr b">arrayPictures</code>数组中拍摄的每张照片(使用<code class="fe ma mb mc lr b">unshift</code>而不是<code class="fe ma mb mc lr b">push</code>来首先显示最新的照片)。Nativescript Vue现在将在按钮下方的可滚动区域中为数组的每个元素呈现一个图像。</p><p id="376e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行应用程序，拍摄两张或更多照片，你会看到每张照片垂直显示在一个可滚动区域，类似于下面的截图。</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/483afad9ff6128c0ba025f26ecd16678.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/0*72Dv5QfyJnaZwN-6.png"/></div></figure><h1 id="1017" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">添加注释和删除的详细信息页面</h1><p id="2b02" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">到目前为止，我们已经有了一个简单的带有图片库的相机应用程序，但它有点基础。让我们通过添加一个新的详细信息页面来使它更有用，以便在点击图库项目时全屏查看图像。在这个新页面上，我们将添加对每张图片进行注释的支持(注释显示在每个图库图片的顶部)，以及一个从图库中删除图片的按钮。</p><p id="01b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，通过将<code class="fe ma mb mc lr b">/app/components/Home.vue</code>中的图像标签(<code class="fe ma mb mc lr b">&lt;Image v-for="image in arrayPictures" class="gallery-item" :src="image" stretch="aspectFill"/&gt;</code>)替换为:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="c405" class="lv kk in lr b gy lw lx l ly lz">&lt;GridLayout cols="*" rows="*" <a class="ae ki" href="http://twitter.com/tap" rel="noopener ugc nofollow" target="_blank">@tap</a>="tapPicture" v-for="image in arrayPictures"&gt;<br/>    &lt;Image class="gallery-item" col="0" row="0" :src="image" stretch="aspectFill" /&gt;<br/>    &lt;StackLayout :visibility="image.note&amp;&amp;(image.note.length&gt;0)  ? 'visible' : 'hidden'" col="0" row="0" class="note-picture-wrapper"&gt;<br/>        &lt;Label textWrap="true" verticalAlignement="bottom" :text="image.note" class="note-picture-text"&gt;&lt;/Label&gt;<br/>    &lt;/StackLayout&gt;<br/>&lt;/GridLayout&gt;</span></pre><p id="0bc7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GridLayout用于在图像上覆盖一个标签，方法是将它们放在同一行和同一列。标签嵌套在StackLayout中，以允许对其进行样式化，从而文本区域可以是阴影和半透明的。标签中的<code class="fe ma mb mc lr b">v-if</code>语句确保只有在该图片有任何文本的情况下才显示这个阴影覆盖。我们需要在新标签的<code class="fe ma mb mc lr b">/app/components/Home.vue</code>底部添加一些新的样式类:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="dc21" class="lv kk in lr b gy lw lx l ly lz">.note-picture-wrapper {<br/>  background-color: #1a1919;<br/>  opacity: 0.7;<br/>  border-width: 1;<br/>  border-radius: 8;<br/>  color: #ffffff;<br/>  border-color: #ffffff;<br/>  margin: 15;<br/>  vertical-align: bottom;<br/>  horizontal-align: center;<br/>}<br/>.note-picture-text {<br/>  font-size: 15;<br/>  vertical-align: center;<br/>  horizontal-align: center;<br/>  padding: 4;<br/>}</span></pre><p id="c663" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们将添加新的<code class="fe ma mb mc lr b">tapPicture()</code>函数，并更新<code class="fe ma mb mc lr b">takePicture()</code>函数，为每个图像分配一个惟一的id(设置为当前的Unix时间戳，并用作<code class="fe ma mb mc lr b">v-for</code>指令中的键)，并初始化一个与每个图像相关联的空注释字符串。将<code class="fe ma mb mc lr b">methods:{}</code>部分改为:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="c924" class="lv kk in lr b gy lw lx l ly lz">    methods: {<br/>        tapPicture(image) {<br/>            let navContextObj = {<br/>                image: image,<br/>                arrayPictures: this.arrayPictures<br/>            };<br/>            this.$navigateTo(ImageDetails, {<br/>                animated: true,<br/>                transition: {<br/>                    name: "slideLeft",<br/>                    curve: "easeInOut",<br/>                    duration: 100<br/>                },<br/>                props: { navObject: navContextObj }<br/>            });<br/>        },<br/>        takePicture() {<br/>            let that = this;<br/>            cameraModule<br/>                .takePicture({<br/>                    width: 300, //these are in device independent pixels<br/>                    height: 300, //only one will be respected depending on os/device if<br/>                    keepAspectRatio: true, //    keepAspectRatio is enabled.<br/>                    saveToGallery: false //Don't save a copy in local gallery, ignored by some Android devices<br/>                })<br/>                .then(imageAsset =&gt; {<br/>                    imageAsset.note = ''<br/>                    imageAsset.id = new Date().getTime()<br/>                    that.arrayPictures.unshift(imageAsset)<br/>                })<br/>        }<br/>    },</span></pre><p id="bda2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ma mb mc lr b">tapPicture</code>功能将导航到一个新页面(<code class="fe ma mb mc lr b">/app/components/ImageDetails.vue</code>)，并将点击的图像和图像库数组作为道具传递。将它们作为对象的成员传递可以确保传递对原始图像数组的引用，以便在详细信息页面中使用。让我们创建并编辑该文件，使其包含:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="9d84" class="lv kk in lr b gy lw lx l ly lz">&lt;template&gt;<br/>    &lt;Page class="page" ref="page" actionBarHidden="false" backgroundSpanUnderStatusBar="true"&gt;<br/>    <br/>        &lt;ActionBar class="action-bar" title="Picture Details"&gt;<br/>            &lt;NavigationButton text="Done" android.systemIcon="ic_menu_back" <a class="ae ki" href="http://twitter.com/tap" rel="noopener ugc nofollow" target="_blank">@tap</a>="$navigateBack()" /&gt;<br/>            &lt;Label class="action-bar-title" text="Picture Details"&gt;&lt;/Label&gt;<br/>        &lt;/ActionBar&gt;<br/>        &lt;ScrollView orientation="vertical"&gt;<br/>            &lt;StackLayout&gt;<br/>                &lt;Image class="picture-full" stretch="aspectFit" :src="navObject.image" /&gt;<br/>                &lt;GridLayout columns="*,*" rows="60,30,*,300"&gt;<br/>                    &lt;StackLayout col="1" row="0" class="delete-picture-icon-wrapper" <a class="ae ki" href="http://twitter.com/tap" rel="noopener ugc nofollow" target="_blank">@tap</a>="deletePicture"&gt;<br/>                        &lt;Label verticalAlignement="bottom" text="delete" class="delete-picture-icon"&gt;&lt;/Label&gt;<br/>                    &lt;/StackLayout&gt;<br/>                    &lt;Label col="0" colSpan="2" row="1" text="Note:" class="section-label" /&gt;<br/>                    &lt;TextView col="0" colSpan="2" row="2" class="text-picture" hint="Add a note for this picture here" editable="true" v-model="navObject.image.note" /&gt;<br/>                    &lt;Label col="0" colSpan="2" row="3" text="" /&gt;<br/>                &lt;/GridLayout&gt;<br/>            &lt;/StackLayout&gt;<br/>        &lt;/ScrollView&gt;<br/>    &lt;/Page&gt;<br/>&lt;/template&gt;</span><span id="680c" class="lv kk in lr b gy mo lx l ly lz">&lt;script&gt;<br/>export default {<br/>    name: "image-details-page",<br/>    data() {<br/>        return {};<br/>    },<br/>    props: {<br/>        navObject: {<br/>            type: Object<br/>        },<br/>    },<br/>    components: {},<br/>    computed: {},<br/>    created() {},<br/>    mounted() {},<br/>    methods: {<br/>        deletePicture() {<br/>            let pictureIndex = this.navObject.arrayPictures.indexOf(this.navObject.image);<br/>            this.navObject.arrayPictures.splice(pictureIndex, 1);<br/>            this.$navigateBack()<br/>        }<br/>    }<br/>};<br/>&lt;/script&gt;</span><span id="73fd" class="lv kk in lr b gy mo lx l ly lz">&lt;style scoped&gt;<br/>.delete-picture-icon {<br/>    font-size: 15;<br/>    vertical-align: center;<br/>    horizontal-align: center;<br/>}</span><span id="1931" class="lv kk in lr b gy mo lx l ly lz">.delete-picture-icon-wrapper {<br/>    background-color: #000000;<br/>    border-width: 1;<br/>    border-radius: 8;<br/>    color: #ffffff;<br/>    border-color: #ffffff;<br/>    margin: 15;<br/>    vertical-align: center;<br/>    horizontal-align: right;<br/>    height: 30;<br/>    width: 60;<br/>}</span><span id="42bb" class="lv kk in lr b gy mo lx l ly lz">.text-picture {<br/>    border-width: 1;<br/>    border-style: solid;<br/>    border-color: #01060c;<br/>    height: 80;<br/>    background-color: rgb(235, 233, 233);<br/>}</span><span id="cff3" class="lv kk in lr b gy mo lx l ly lz">.section-label {<br/>    background-color: #292b2b;<br/>    border-width: 1;<br/>    border-style: solid;<br/>    border-color: #01060c;<br/>    color: white;<br/>    padding-left: 10;<br/>    padding-top: 5;<br/>    padding-bottom: 5;<br/>}</span><span id="34d7" class="lv kk in lr b gy mo lx l ly lz">.picture-full {<br/>    border-width: 1;<br/>    border-color: gray;<br/>}<br/>&lt;/style&gt;</span></pre><p id="dc08" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">查看顶部的XML，您会看到ActionBar元素类似于主页，但是我们现在添加了一个NavigationButton，让用户导航回第一页。在它下面，我们显示了在第一页上点击的图像、一个删除按钮和一个文本区域，以便用户可以为所选图像输入注释(绑定到图像对象的注释变量)。底部的额外标签GridLayout分配的高度为300，用于在更改图像注释文本时屏幕键盘弹出时提供一些缓冲空间。<code class="fe ma mb mc lr b">deletePicture()</code>函数是该页面上唯一的方法，它在导航回主页之前从图像库数组中移除当前图像。</p><h1 id="4adf" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">维护图像库状态</h1><p id="1d0b" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">现在，我们有了一个功能强大的图片库应用程序，允许我们从相机中添加新图片，给它们添加注释，以及删除图像。现在最大的问题是，当我们关闭应用程序并重新打开它时，所有的图像和它们的注释都将消失。我们使这成为一个有用的应用程序的最后一步是在应用程序运行期间维护图像及其相关注释的状态。<a class="ae ki" href="https://docs.nativescript.org/ns-framework-modules/application-settings" rel="noopener ugc nofollow" target="_blank">native script application settings模块</a>允许我们从应用的本地存储中保存和加载文本数据，因此我们可以使用它来维护应用运行期间的状态。为了将它用于此图片库，我们需要开始将图片保存为设备上的文件，因为我们无法使用此模块轻松存储二进制数据。相反，我们将使用这个模块来存储一个有状态的文件名和注释数组，每当发生更改时都会更新，并在下次运行应用程序时重新加载。</p><p id="0aad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将使用更多的库模块，所以将以下内容添加到<code class="fe ma mb mc lr b">/app/components/Home.vue</code>中代码部分的顶部:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="5f1e" class="lv kk in lr b gy lw lx l ly lz">const applicationSettings = require("application-settings"); <br/>const fsModule = require("tns-core-modules/file-system"); <br/>const imageSourceModule = require("tns-core-modules/image-source");</span></pre><p id="81f3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ma mb mc lr b">applicationSettings</code>将用于<a class="ae ki" href="https://docs.nativescript.org/ns-framework-modules/application-settings" rel="noopener ugc nofollow" target="_blank">保存和加载设备上的应用状态</a>。<code class="fe ma mb mc lr b">fsModule</code>与<code class="fe ma mb mc lr b">imageSourceModule</code>配合使用时将用于<a class="ae ki" href="https://docs.nativescript.org/ns-framework-modules/file-system" rel="noopener ugc nofollow" target="_blank">将图片保存并加载到本地设备存储器</a>，本地设备存储器用于<a class="ae ki" href="https://docs.nativescript.org/ns-framework-modules/image-source" rel="noopener ugc nofollow" target="_blank">处理图像</a>。</p><p id="a99e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">修改<code class="fe ma mb mc lr b">takePicture()</code>方法，使其包含以下内容:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="5a52" class="lv kk in lr b gy lw lx l ly lz">    takePicture() {<br/>            let that = this;<br/>            cameraModule<br/>                .takePicture({<br/>                    width: 300, //these are in device independent pixels<br/>                    height: 300, //only one will be respected depending on os/device if<br/>                    keepAspectRatio: true, //    keepAspectRatio is enabled.<br/>                    saveToGallery: false //Don't save a copy in local gallery, ignored by some Android devices<br/>                })<br/>                .then(imageAsset =&gt; {<br/>                    imageSourceModule.fromAsset(imageAsset).then(<br/>                        savedImage =&gt; {<br/>                            let filename = "image" + "-" + new Date().getTime() + ".png";<br/>                            let folder = fsModule.knownFolders.documents();<br/>                            let path = fsModule.path.join(folder.path, filename);<br/>                            savedImage.saveToFile(path, "png");<br/>                            var loadedImage = imageSourceModule.fromFile(path);<br/>                            loadedImage.filename = filename;<br/>                            loadedImage.note = "";<br/>                            that.arrayPictures.unshift(loadedImage);<br/>                            that.storeData();<br/>                        },<br/>                        err =&gt; {<br/>                            console.log("Failed to load from asset");<br/>                        }<br/>                    );<br/>                })<br/>        },</span></pre><p id="37fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还需要一些新的方法来加载和保存当前的图片库状态。将以下功能添加到<code class="fe ma mb mc lr b">methods:{}</code>部分</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="fac5" class="lv kk in lr b gy lw lx l ly lz">    storeData() {<br/>            let localArr = [];<br/>            this.arrayPictures.forEach(entry =&gt; {<br/>                localArr.push({ note: entry.note, filename: entry.filename });<br/>            })<br/>            applicationSettings.setString("localdata", JSON.stringify(localArr));<br/>        },<br/>        loadData() {<br/>            let strData = applicationSettings.getString("localdata");<br/>            console.log(strData)<br/>            if (strData &amp;&amp; strData.length) {<br/>                let localArr = JSON.parse(strData);<br/>                localArr.forEach(entry =&gt; {<br/>                    const folder = fsModule.knownFolders.documents();<br/>                    const path = fsModule.path.join(folder.path, entry.filename);<br/>                    var loadedImage = imageSourceModule.fromFile(path);<br/>                    loadedImage.filename = entry.filename;<br/>                    loadedImage.note = entry.note;<br/>                    this.arrayPictures.unshift(loadedImage);<br/>                })<br/>            }<br/>        },</span></pre><p id="43f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">拍照后，我们现在将图片作为图像文件保存到应用程序的本地设备存储中，并使用从保存的图像中加载的图像资产。每当添加或删除图片时，我们都会调用新函数<code class="fe ma mb mc lr b">storeData</code>将图像注释和文件名数组保存到本地存储。</p><p id="a04b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当使用<code class="fe ma mb mc lr b">deletePicture</code>从图库中移除图像时，或者当它们的注释发生变化时，我们需要更新保存的状态。我们可以通过在从详细信息页面返回之前更新状态来处理这两个问题。我们将使用细节页面上的<code class="fe ma mb mc lr b">beforeDestroy</code> Vue生命周期挂钩来调用我们的<code class="fe ma mb mc lr b">storeData</code>函数。因为该函数是在主页上定义的，所以我们还需要传递对该函数的引用，作为导航上下文的一部分。将以下内容添加到<code class="fe ma mb mc lr b">/app/components/ImageDetails.vue</code>中的<code class="fe ma mb mc lr b">export default {</code></p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="1612" class="lv kk in lr b gy lw lx l ly lz">beforeDestroy() { <br/>    this.navObject.storeData() <br/>},</span></pre><p id="6b5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将通过修改<code class="fe ma mb mc lr b">/app/components/Home.vue</code>中的<code class="fe ma mb mc lr b">tapPicture</code>来传递这个函数引用，作为主页导航上下文的一部分:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="f1d6" class="lv kk in lr b gy lw lx l ly lz">let navContextObj = { <br/>    image: image, arrayPictures: this.arrayPictures, storeData:this.storeData <br/>};</span></pre><p id="950a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">每当用户离开详细信息页面时都会运行这个钩子，因此在返回到主页之前，对图像注释的任何更改或图像的任何删除都会保存到state中。</p><figure class="lm ln lo lp gt me gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/d8902f36410b409d8d587683110526d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/0*lac4McPyd6N1IUqb.png"/></div></figure><h1 id="e4d1" class="kj kk in bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">搞定了。</h1><p id="2368" class="pw-post-body-paragraph jk jl in jm b jn lh jp jq jr li jt ju jv lj jx jy jz lk kb kc kd ll kf kg kh ig bi translated">这个帖子到此为止。如果你想下载最终的源文件，你可以在<a class="ae ki" href="https://github.com/drangelod/nsimagegallery6" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到它们。</p></div><div class="ab cl ms mt hr mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ig ih ii ij ik"><p id="d29e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mz">原载于2019年11月1日</em><a class="ae ki" href="https://blog.angelengineering.com/nativescript6-picture-gallery/" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://blog.angelengineering.com</em></a><em class="mz">。</em></p></div></div>    
</body>
</html>