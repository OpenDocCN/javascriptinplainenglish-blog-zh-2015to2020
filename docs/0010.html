<html>
<head>
<title>Webpack 4: Universal Code Splitting in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">web pack 4:React中的通用代码分割</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/webpack-4-universal-code-splitting-in-react-the-inventors-are-back-baby-453745f9665d?source=collection_archive---------1-----------------------#2018-06-12">https://javascript.plainenglish.io/webpack-4-universal-code-splitting-in-react-the-inventors-are-back-baby-453745f9665d?source=collection_archive---------1-----------------------#2018-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2b54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/faceyspacey/extract-css-chunks-webpack-plugin" rel="noopener ugc nofollow" target="_blank">extract-css-chunks-web pack-plugin</a>—迄今为止最好的CSS分块插件(Webpack 4，独立，SSR友好，内置HMR)！</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="14cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我相信我们都曾遇到过不可避免的问题，“我想在服务器端呈现我的React应用，但我也真的想进行代码拆分。”欢迎来到地狱。</p><p id="9f68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我自己，像React社区中的许多其他人一样，面临着同样的困境。</p><p id="8d09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们中的许多人可能一直在等待React 17来拯救世界……据开发它的人说，这还有很长的路要走。流泪了，面对现实了😂。</p><h1 id="4ba4" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">我选了什么？</h1><p id="9aac" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">有很多选择，为了确定最佳选择，我列出了一个基本要求的列表。</p><ul class=""><li id="deb4" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">粒度控制&amp; <strong class="jp ir">灵活性</strong></li><li id="1cea" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">可扩展</strong>并且与<strong class="jp ir">容器化</strong>架构配合良好</li><li id="e232" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">健壮</strong>用于<strong class="jp ir">平台</strong>开发，日常<strong class="jp ir">简单</strong>用于特性开发。</li><li id="fb16" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">能够从<strong class="jp ir">低级API </strong>访问详细输出</li></ul><p id="d18a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很难找到，尤其是当你在处理这种新的<strong class="jp ir">微前端架构</strong>热潮的时候。我需要一些架构师和初级开发人员一样热爱的东西。</p><p id="e789" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我选择了FaceySpacey的环球家族。宇宙家庭给了我两个世界最好的东西。</strong></p><p id="52a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管该解决方案在初始实施阶段更复杂，但从长远来看，它提供了更大的灵活性:</p><ul class=""><li id="fecd" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">你可以在导入里面使用<strong class="jp ir">动态表达式</strong></li><li id="3c14" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">创建<strong class="jp ir">用户土地HOCs </strong></li><li id="9f81" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">提升机静力学</strong></li><li id="d726" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">用<strong class="jp ir">阿波罗</strong>进行双重渲染</li><li id="97df" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">渲染时利用<strong class="jp ir">回调</strong></li><li id="811a" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">分体式异径管</strong></li><li id="31b2" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">诸如此类…</li></ul><p id="fa9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Universal支持许多其他代码分割包需要变通方法才能实现的特性。</strong></p><blockquote class="mk"><p id="180e" class="ml mm iq bd mn mo mp mq mr ms mt kk dk translated">Universal是健壮的，功能丰富的，而其他解决方案是最小的。</p></blockquote><p id="d72f" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated"><a class="ae kl" href="https://webpack.js.org/api/module-methods/#require-resolveweak" rel="noopener ugc nofollow" target="_blank">https://web pack . js . org/API/module-methods/# require-resolve weak</a></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="bed6" class="kt ku iq bd kv kw mz ky kz la na lc ld le nb lg lh li nc lk ll lm nd lo lp lq bi translated">Universal和web pack 4——两个版本的故事</h1><p id="203d" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在为开发人员建立了一个非常棒的POC节点基础设施，并提供了令人惊叹的代码拆分和非常简单的代码拆分方式之后，可以肯定地说，我对自己的小实验非常满意。修补过程中出现的问题，使Universal为大规模、复杂的系统做好准备。</p><p id="7a7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是后来Webpack 4发布了。考虑到我们是一个代码分离系统，Webpack 4几乎重写了所有分块的东西…当我试图更新时，Universal不工作。<strong class="jp ir">游戏结束了？</strong></p><blockquote class="mk"><p id="f029" class="ml mm iq bd mn mo mp mq mr ms mt kk dk translated">通用系列现在支持激进的代码分割！</p></blockquote><blockquote class="ne nf ng"><p id="5f61" class="jn jo nh jp b jq mu js jt ju mv jw jx ni mw ka kb nj mx ke kf nk my ki kj kk ij bi translated">截至2018年6月4日，我们发布了<a class="ae kl" href="https://github.com/faceyspacey/babel-plugin-universal-import" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">babel-plugin-universal-import</strong></a><strong class="jp ir"/>的重大更新，现在<strong class="jp ir">支持</strong> <strong class="jp ir"> Webpack 4 </strong></p><p id="b517" class="jn jo nh jp b jq jr js jt ju jv jw jx ni jz ka kb nj kd ke kf nk kh ki kj kk ij bi translated">截至2018年6月5日，我们发布了<a class="ae kl" href="https://github.com/faceyspacey/extract-css-chunks-webpack-plugin" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">extract-CSS-chunks-web pack-plugin</strong></a><strong class="jp ir"/>的重大更新，现在<strong class="jp ir">支持Webpack 4 </strong></p><p id="62d1" class="jn jo nh jp b jq jr js jt ju jv jw jx ni jz ka kb nj kd ke kf nk kh ki kj kk ij bi translated">截至2018年6月12日，我们发布了<strong class="jp ir"/><a class="ae kl" href="https://github.com/faceyspacey/webpack-flush-chunks" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">web pack-flush-chunks</strong></a>的重大更新，使<strong class="jp ir">开发者能够将Universa </strong> l与更复杂/ <strong class="jp ir">激进的代码分裂</strong>战术一起使用。</p></blockquote><p id="2d26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">那么，我们是如何解决这个问题的呢？</strong></p><p id="adf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">差不多，<a class="ae kl" href="https://github.com/faceyspacey/extract-css-chunks-webpack-plugin" rel="noopener ugc nofollow" target="_blank">extract-css-chunks-web pack-plugin</a>是主要问题…我们需要一个Webpack 4解决方案来处理CSS分块。</p><p id="237c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们都知道Webpack在未来的某个时候会有更好的CSS处理能力。我们不知道什么时候，但似乎没有人说它会很快。所以我们不能指望蒸汽工具</p><blockquote class="ne nf ng"><p id="8bec" class="jn jo nh jp b jq jr js jt ju jv jw jx ni jz ka kb nj kd ke kf nk kh ki kj kk ij bi translated">看看宇宙家庭(从这里开始):<a class="ae kl" href="https://github.com/faceyspacey/react-universal-component" rel="noopener ugc nofollow" target="_blank">https://github.com/faceyspacey/react-universal-component</a></p></blockquote><p id="60c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我肯定你在想，<strong class="jp ir">“就用mini-css-extract吧。”是啊。我试过了，它做了代码分割CSS的工作，但是没有<strong class="jp ir">没有</strong>热模块重载(<strong class="jp ir"> HMR </strong> )…哎哟</strong></p><p id="a238" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">“但是有一个样式加载器，只是把它用于开发构建！”</strong> <br/>嗯嗯，有那个。但是来吧</p><ul class=""><li id="b364" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">没有源地图</li><li id="408d" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">无法在chrome devtools中编辑样式</li><li id="749f" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">向DOM中注入字符串</li><li id="f944" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">当追加更多内联代码时，样式覆盖样式。</li><li id="9f61" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">声誉好的公司不喜欢这样</li></ul><figure class="nm nn no np gt nq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/11da3e59138dce528a9ead83470df180.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*k1uZsh2zCNIFxfjYvfhRgg.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The use of style-loader</figcaption></figure><p id="2234" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Fiverr，或者任何一家大公司，我都有一些常识性的目标要实现。</p><p id="c98f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在CSS的范围内，下面是我想要的:</p><ul class=""><li id="4c5b" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">I <strong class="jp ir">提高DX </strong>和<strong class="jp ir">降低风险</strong>。</li><li id="c781" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">尽量避免本地和生产之间的不一致。</li><li id="a288" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">避免客户端难以调试的</strong> CSS、额外内存和<strong class="jp ir">变慢</strong>。</li><li id="5c43" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">不要干涉CSS的层叠效果(保持样式的可继承性)</li><li id="15f9" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">改善长期缓存</li><li id="4fb5" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">加速构建</li></ul><p id="7835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你需要<strong class="jp ir">开发版本</strong>作为<strong class="jp ir">运行，尽可能接近</strong>生产版本。你需要一个良好的端到端系统，经得起高流量的考验。<strong class="jp ir">依赖一个</strong>不太接近生产<strong class="jp ir">的版本</strong>会给你带来<strong class="jp ir">风险</strong>你可能只有在部署了<strong class="jp ir">10万美元的错误后才会发现。</strong></p><p id="2e28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果DX(开发者体验)不在它需要的地方，那么一个伟大的系统还有什么意义？我四处寻找如何让迷你css-extract热重装。非常坦率地说，我很失望，不是因为Sokra的伟大工作，而是因为它只是更多的工作，仍然笨拙。我只是希望它能起作用。说真的，这年头什么不热装了😂</p><h2 id="362f" class="nx ku iq bd kv ny nz dn kz oa ob dp ld jy oc od lh kc oe of ll kg og oh lp oi bi translated">解决方案</h2><p id="38fd" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">本质上，我们采用了mini-css，对其进行了一点修改，并添加了自动HMR注入功能。</p><h2 id="d6e5" class="nx ku iq bd kv ny nz dn kz oa ob dp ld jy oc od lh kc oe of ll kg og oh lp oi bi translated">但是为什么呢？为什么不把它公关回Webpack呢？</h2><p id="ece8" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">一个合理的问题。我分两部分回答。</p><p id="e1be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为什么要用mini-css-extract修改呢？</p><ul class=""><li id="8ef9" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">API是熟悉的，更少的摩擦&amp;顺便更换。</li><li id="1756" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">写得很好，快速，简单。</li><li id="db9e" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">Webpack的作者直接参与其中。</li></ul><p id="4559" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为什么不是PR Webpack？</p><ul class=""><li id="3bc4" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">我会的。但这对我们现在的议程来说并不理想。</li><li id="3ebd" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">我想控制环球公司的架构。</li><li id="db20" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">迷你css似乎优先级较低，这是一个权宜之计，直到Webpack原生处理css，他们计划在未来的某个时间点。</li><li id="a323" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">迷你css可能会随着时间的推移而改变，我们的用例与议程可能不匹配。</li></ul></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="7a43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">FaceySpacey回来了，事实是他从未真正离开过。他忙着做更令人兴奋的事情。Universal太棒了，现在有了一个忠诚的团队，我们可以更快地创新，更好地照顾我们忠实的家属，并实现我们改进React工作流程的最终目标。</p><p id="7b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中很大一部分是<a class="ae kl" href="https://github.com/faceyspacey/redux-first-router/tree/rudy-respond" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">鲁迪</strong> </a>(之前的redux-first-router)</p><p id="74ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">鲁迪的任务清单上没剩下多少了！然而，鲁迪只是回应框架<strong class="jp ir"><em class="nh"/></strong>的三个关键部分之一，我们希望它能真正改变React的发展。</p><p id="1dd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只是一个程序员分布的团队。我们对所有这些工作的回报很简单。我们都是程序员，我们只是想制造一些工具，让我们的生活更轻松，反过来，我们也想让你们的生活更轻松。React很棒，但现在是它的“Rails”时刻了。下一件大事的时间到了。</p><p id="8269" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">推特</strong> <a class="ae kl" href="https://twitter.com/ScriptedAlchemy" rel="noopener ugc nofollow" target="_blank">上关注我</a></p></div></div>    
</body>
</html>