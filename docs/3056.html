<html>
<head>
<title>Node.js Best Practices — HTTPS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js最佳实践— HTTPS</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-best-practices-https-a69d8d254426?source=collection_archive---------6-----------------------#2020-08-24">https://javascript.plainenglish.io/node-js-best-practices-https-a69d8d254426?source=collection_archive---------6-----------------------#2020-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bedace3706fc2f9cca984611a1caaff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sJb6wu4pVJ09fTAV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@misslove?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Abbie Love</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3b82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="7244" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安全传输</h1><p id="5b34" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">没有HTTPS，通信是通过发送明文来完成的。</p><p id="957d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着任何人都可以接入通信信道来获取数据。</p><p id="7857" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们应该通过HTTPS交流。</p><p id="49e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用强密码来加密我们的通信，这样我们就不必担心不安全的通信。</p><p id="b190" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们必须测试密码、密钥和重新协商是否正确配置。</p><p id="0886" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且证书必须有效。</p><p id="dc5d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用nmap和sslyze这样的工具来检查这些东西。</p><p id="74c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2603" class="mn lc iq mj b gy mo mp l mq mr">nmap --script ssl-cert,ssl-enum-ciphers -p 443,465,993,995 www.example.com</span></pre><p id="95e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查来自example.com的证书</p><p id="c720" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用sslyze，我们可以运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="436b" class="mn lc iq mj b gy mo mp l mq mr">./sslyze.py --regular example.com:443</span></pre><p id="35ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">做检查</p><h1 id="ea0e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">HSTS</h1><p id="6e20" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该添加Strict-Transport-Security头来强制HTTPS连接到服务器。</p><p id="3c44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标题如下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4586" class="mn lc iq mj b gy mo mp l mq mr">strict-transport-security:max-age=631138519</span></pre><p id="095d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果存在，将从web应用程序返回。</p><p id="b423" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以检查:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4186" class="mn lc iq mj b gy mo mp l mq mr">curl -s -D- https://example.com/ | grep -i Strict</span></pre><p id="a3a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查是否有以<code class="fe ms mt mu mj b">Strict</code>开头的报头，以检查报头的响应。</p><h1 id="174b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">拒绝服务</h1><p id="5669" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了防止拒绝服务攻击，我们应该采取一些措施来防止它们。</p><p id="3d75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用户尝试登录的次数太多并且失败了，我们应该将他们锁定一段时间。</p><p id="0273" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这减轻了暴力猜测攻击。</p><p id="14ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">少量的登录尝试会在一段时间内禁止更多的登录尝试。</p><p id="36ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可能需要几分钟，然后会因后续故障而增加。</p><p id="0001" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也有可以挂起应用程序的正则表达式。</p><p id="8bab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像重复分组和重复模式或重叠交替模式这样的模式是正则表达式，会使我们的节点应用程序崩溃。</p><p id="48c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，<code class="fe ms mt mu mj b">(a+)+</code>这样的模式是易受攻击的正则表达式，会导致大量计算。</p><p id="a73b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了检查这些正则表达式，我们可以使用<a class="ae kc" href="https://www.npmjs.com/package/safe-regex" rel="noopener ugc nofollow" target="_blank"> safe-regex </a>包。</p><h1 id="41b3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">错误处理</h1><p id="b4df" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该小心错误处理，不要泄露我们应用程序的敏感信息。</p><p id="8e18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们可以泄露对攻击者有用的信息。</p><p id="6ee0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们应该记录它们，而不是显示给用户。</p><h1 id="ff7f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">NPM</h1><p id="2d6f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该检查我们的节点应用程序中需要的包。</p><p id="5a5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了检查易受攻击的包，我们可以使用<code class="fe ms mt mu mj b">nsp</code>包。</p><p id="2979" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9d08" class="mn lc iq mj b gy mo mp l mq mr">npm i nsp -g</span></pre><p id="20a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><p id="f1a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们使用以下内容审核包覆面提取:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e38b" class="mn lc iq mj b gy mo mp l mq mr">nsp audit-shrinkwrap</span></pre><p id="a01a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者我们可以查看<code class="fe ms mt mu mj b">package.json</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9466" class="mn lc iq mj b gy mo mp l mq mr">nsp audit-package</span></pre><h1 id="812e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">无服务器</h1><p id="8323" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">无服务器从AWS Lambda的引入开始。</p><p id="cb1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将成为构建应用程序的一种流行方式。</p><p id="8a69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以创建直接从服务器运行的代码。</p><h1 id="fb79" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Node.js应用程序的结构</h1><p id="1aa3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们先用<code class="fe ms mt mu mj b">npm init</code>创建一个节点应用。</p><p id="e93e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将创建<code class="fe ms mt mu mj b">package.json</code>，它包含我们的节点项目的元数据。</p><p id="48ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们包括名称、版本、描述、脚本等等。</p><p id="fbca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还包含软件包信息。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/01b2db317be91678222634f8839c2fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1WEhM7_7rIY_j7vl"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@keebarber?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Keenan Barber</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c2b7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="08ff" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用一些工具来分析我们的应用程序的安全性。</p><p id="7d3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过用<code class="fe ms mt mu mj b">npm init</code>创建一个<code class="fe ms mt mu mj b">package.json</code>来构建我们的应用程序。</p><h2 id="72d2" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="d62e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> plainenglish.io </strong> </a>找到所有内容的链接！</p></div></div>    
</body>
</html>