<html>
<head>
<title>The Express.js Application Object — Rendering and Setting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Express.js应用程序对象-渲染和设置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/guide-to-the-express-application-object-rendering-and-setting-10187e49fdaa?source=collection_archive---------5-----------------------#2020-02-11">https://javascript.plainenglish.io/guide-to-the-express-application-object-rendering-and-setting-10187e49fdaa?source=collection_archive---------5-----------------------#2020-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/360204f517a26f5c3d980952660d3014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6FKpgIIpelhbz_EA"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@bellehunt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Belle Hunt</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="93bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">快速应用程序的核心部分是应用程序对象。是应用本身。</p><p id="06a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看<code class="fe lb lc ld le b">app</code>对象的方法以及我们可以用它做什么，包括呈现HTML和更改设置。</p><h1 id="2a37" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">app.render(视图，[局部变量]，回调)</h1><p id="307c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">app.render</code>方法通过它的<code class="fe lb lc ld le b">callback</code>函数来呈现视图的HTML。它接受一个可选参数，该参数是一个包含视图变量的对象。</p><p id="334f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="df9a" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="e466" class="mq lg iq le b gy mv ms l mt mu">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="2d1c" class="mq lg iq le b gy mv ms l mt mu">app.engine('ejs', require('ejs').renderFile);<br/>app.set('view engine', 'ejs');</span><span id="9c4e" class="mq lg iq le b gy mv ms l mt mu">app.render('index', { people: ['geddy', 'neil', 'alex'] }, (err, html) =&gt; {<br/>  console.log(html);<br/>});</span><span id="ea06" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="de0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，如果我们在<code class="fe lb lc ld le b">views/index.ejs</code>中有以下内容:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="f421" class="mq lg iq le b gy mr ms l mt mu">&lt;%= people.join(", "); %&gt;</span></pre><p id="8a3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="0a39" class="mq lg iq le b gy mr ms l mt mu">geddy, neil, alex</span></pre><p id="6f4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从<code class="fe lb lc ld le b">console.log(html);</code>输出</p><h1 id="ef7e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">app.route(路径)</h1><p id="eb7f" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">app.route</code>来定义带有给定<code class="fe lb lc ld le b">path</code>的路由处理程序。</p><p id="114b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="e337" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="7cde" class="mq lg iq le b gy mv ms l mt mu">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="e729" class="mq lg iq le b gy mv ms l mt mu">app.route('/')<br/>  .get((req, res, next) =&gt; {<br/>    res.send('GET request called');<br/>  })<br/>  .post((req, res, next) =&gt; {<br/>    res.send('POST request called');<br/>  })<br/>  .all((req, res, next) =&gt; {<br/>    res.send('Other requests called');<br/>  })</span><span id="4d87" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="a231" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，当对<code class="fe lb lc ld le b">/</code>发出GET请求时，我们得到<code class="fe lb lc ld le b">GET request called</code>。如果向<code class="fe lb lc ld le b">/</code>发出POST请求，那么我们得到<code class="fe lb lc ld le b">POST request called</code>。</p><p id="39db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对<code class="fe lb lc ld le b">/</code>的任何其他类型的请求都会得到<code class="fe lb lc ld le b">Other requests called</code>。</p><p id="4280" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">顺序很重要，因为<code class="fe lb lc ld le b">all</code>将处理各种请求。因此，如果我们除了其他类型的请求之外，还想监听特定类型的请求，<code class="fe lb lc ld le b">all</code>应该放在最后。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/92abd89a5acd79908fa6c58336340d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N7gpq99xSSX1YZo9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@shlagance?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Shlag</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="90a5" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">app.set(名称，值)</h1><p id="4f54" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">set</code>来设置给定<code class="fe lb lc ld le b">name</code>到给定<code class="fe lb lc ld le b">value</code>的设置。</p><p id="ff2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="969a" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="5fb1" class="mq lg iq le b gy mv ms l mt mu">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));<br/>app.set('title', 'Foo');</span><span id="8916" class="mq lg iq le b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send(app.get('title'));<br/>})</span><span id="1545" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="6cf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们调用了<code class="fe lb lc ld le b">app.set(‘title’, ‘Foo’);</code>来将<code class="fe lb lc ld le b">title</code>设置为<code class="fe lb lc ld le b">Foo</code>，所以当我们向<code class="fe lb lc ld le b">/</code>发出GET请求时，我们应该会看到显示的<code class="fe lb lc ld le b">Foo</code>。</p><p id="4fdf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些设置是Express专用的。它们包括:</p><ul class=""><li id="65ac" class="mx my iq kf b kg kh kk kl ko mz ks na kw nb la nc nd ne nf bi translated"><code class="fe lb lc ld le b">case sensitive routing</code> —用于启用或禁用区分大小写路由的布尔值(例如，如果是<code class="fe lb lc ld le b">true</code>，则<code class="fe lb lc ld le b">/Foo</code>将被视为与<code class="fe lb lc ld le b">/foo</code>不同)</li><li id="07c5" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">env</code> —环境模式的字符串</li><li id="7895" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">etag</code> — ETag响应头</li><li id="9aba" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">jsonp callback name</code>—JSONP回调名称的字符串</li><li id="fcb2" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">json escape</code> —启用或禁用来自<code class="fe lb lc ld le b">res.json</code>、<code class="fe lb lc ld le b">res.jsonp</code>或<code class="fe lb lc ld le b">res.send</code>的转义JSON响应的布尔选项。如果是<code class="fe lb lc ld le b">true</code>，则<code class="fe lb lc ld le b">&lt;</code>、<code class="fe lb lc ld le b">&gt;</code>和<code class="fe lb lc ld le b">&amp;</code>将被转义</li><li id="3583" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">json replacer</code> —替换<code class="fe lb lc ld le b">JSON.stringify</code>的回调</li><li id="4d8c" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">json spaces</code>—<code class="fe lb lc ld le b">JSON.stringify</code>的空格参数</li><li id="512f" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">query parser</code> —如果设置为<code class="fe lb lc ld le b">false</code>，则禁用查询解析，或将查询解析设置为使用<code class="fe lb lc ld le b">'simple'</code>或<code class="fe lb lc ld le b">'extended'</code>或自定义查询字符串解析功能。</li><li id="694c" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">strict routing</code> —启用/禁用严格路由的布尔设置。如果这是<code class="fe lb lc ld le b">true</code>，那么<code class="fe lb lc ld le b">/foo</code>将被认为不同于<code class="fe lb lc ld le b">/foo/</code></li><li id="0c41" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">subdomain offset</code> —要删除以访问子域的主机的点分隔部分的数量。默认为2。</li><li id="6bbe" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">trust proxy</code> —如果是<code class="fe lb lc ld le b">true</code>，则表示应用程序在代理后面。<code class="fe lb lc ld le b">X-Forwarded-*</code>头将决定客户端的连接和IP地址。</li><li id="668d" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">views</code> —查找视图模板的目录字符串或数组。如果它是一个数组，那么视图将按照它们被列出的顺序被搜索</li><li id="2c51" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">view cache</code> —用于启用视图模板编译缓存的布尔值</li><li id="5f64" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">view engine</code> —用于设置渲染模板的视图引擎的字符串。</li><li id="0129" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">x-powered-by</code> —启用<code class="fe lb lc ld le b">'X-Powered-By: Express</code> HTTP头</li></ul><h2 id="3e2d" class="mq lg iq bd lh nl nm dn ll nn no dp lp ko np nq lt ks nr ns lx kw nt nu mb nv bi translated">“信任代理”设置的选项</h2><p id="5b95" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">它可以采取以下选项:</p><ul class=""><li id="728d" class="mx my iq kf b kg kh kk kl ko mz ks na kw nb la nc nd ne nf bi translated"><code class="fe lb lc ld le b">true</code> —客户端的IP地址被认为是<code class="fe lb lc ld le b">X-Forwarded-*</code>报头最左边的条目</li><li id="30f0" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><code class="fe lb lc ld le b">false</code> —假设应用程序直接面向互联网</li><li id="072d" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated">字符串、逗号分隔的字符串或字符串数组—一个或多个要信任的子网或IP地址</li><li id="3d7a" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated">Number —将前端代理服务器的第n跳作为客户端。</li><li id="243f" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated">函数—自定义信任实现</li></ul><h2 id="f759" class="mq lg iq bd lh nl nm dn ll nn no dp lp ko np nq lt ks nr ns lx kw nt nu mb nv bi translated">“etag”设置的选项</h2><p id="0f4a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">它可以采取以下选项:</p><ul class=""><li id="4227" class="mx my iq kf b kg kh kk kl ko mz ks na kw nb la nc nd ne nf bi translated">布尔— <code class="fe lb lc ld le b">true</code>启用弱ETag，<code class="fe lb lc ld le b">false</code>禁用ETag</li><li id="dd23" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated">String — <code class="fe lb lc ld le b">'strong'</code>启用强ETag，<code class="fe lb lc ld le b">‘weak’</code>启用弱ETag</li><li id="1e47" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated">函数—自定义实现。</li></ul><h1 id="5453" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="f87b" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用<code class="fe lb lc ld le b">app.render</code>方法呈现一个HTML字符串。它需要一个视图文件名、一个变量对象和一个带有<code class="fe lb lc ld le b">html</code>参数的回调来呈现HTML。</p><p id="7054" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.route</code>让我们定义路线处理程序。</p><p id="3ed7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.set</code>让我们为应用程序设置所需的选项。有些设置是Express专用的，如果设置了这些设置，将由Express处理。</p></div></div>    
</body>
</html>