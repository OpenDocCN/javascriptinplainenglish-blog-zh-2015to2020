<html>
<head>
<title>Node.js Tips — Templates, Queries, Dates, and Memory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js提示—模板、查询、日期和内存</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-tips-templates-queries-dates-and-memory-71f334b1aa48?source=collection_archive---------7-----------------------#2020-06-26">https://javascript.plainenglish.io/node-js-tips-templates-queries-dates-and-memory-71f334b1aa48?source=collection_archive---------7-----------------------#2020-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ef415d1c132e548bf8af9d58d607fc01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kujd_ulSUUEQn4D6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">DFFPhoto by <a class="ae kc" href="https://unsplash.com/@taffy_apple?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sarah Olive</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="31c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写节点应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些编写节点应用程序时常见问题的解决方案。</p><h1 id="ff67" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从fs.readFile获取数据</h1><p id="80f6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以从<code class="fe me mf mg mh b">fs</code>模块调用<code class="fe me mf mg mh b">readFile</code>方法来踩踏文件。</p><p id="aa0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="78dd" class="mq lc iq mh b gy mr ms l mt mu">fs.readFile('./foo.txt', (err, data) =&gt; {<br/>  if (err) {<br/>    throw err;<br/>  }<br/>  console.log(data);<br/>});</span></pre><p id="8529" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传入路径，然后将其作为二进制文件读取。</p><p id="61c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">data</code>有文件内容，<code class="fe me mf mg mh b">err</code>是遇到错误时设置的错误对象。</p><p id="a646" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有一种<code class="fe me mf mg mh b">fs.readFileSync</code>方法:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f78e" class="mq lc iq mh b gy mr ms l mt mu">const text = fs.readFileSync('./foo.txt', 'utf8');<br/>console.log(text);</span></pre><h1 id="d014" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在Express中获取URL参数</h1><p id="a34e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要在Express应用程序中获取URL参数，我们可以使用<code class="fe me mf mg mh b">req.params</code>属性来获取URL参数。</p><p id="ab92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cb5f" class="mq lc iq mh b gy mr ms l mt mu">app.get('/tags/:tagId', (req, res) =&gt; {<br/>  res.send(req.params.tagId);<br/>});</span></pre><p id="62e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，如果我们向<code class="fe me mf mg mh b">/tags/2</code>发出GET请求，我们将得到2作为<code class="fe me mf mg mh b">req.params.tagId</code>的值。</p><p id="1168" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了从查询参数中获取一个值，我们可以使用<code class="fe me mf mg mh b">req.query</code>属性:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="43fd" class="mq lc iq mh b gy mr ms l mt mu">app.get('/foo', (req, res) =&gt; {<br/>  res.send(req.query.tagId);<br/>});</span></pre><p id="2498" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么如果我们向<code class="fe me mf mg mh b">/foo?tagId=2</code>发出请求，<code class="fe me mf mg mh b">req.query.tagId</code>将会是2。</p><h1 id="e8a4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">呈现基本HTML视图</h1><p id="674c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过使用<code class="fe me mf mg mh b">include</code>在Jade视图中包含HTML文件来呈现HTML。</p><p id="f2e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以在<code class="fe me mf mg mh b">views/index.jade</code>中写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4bdc" class="mq lc iq mh b gy mr ms l mt mu">include plainHtml.html</span></pre><p id="8be7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">views/plainHtml.html</code>中，我们可以编写普通的HTML”</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b63a" class="mq lc iq mh b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>...</span></pre><p id="13d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用以下内容渲染<code class="fe me mf mg mh b">index.jade</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="065a" class="mq lc iq mh b gy mr ms l mt mu">res.render(index);</span></pre><h1 id="9a7a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">NodeJS支持导入/导出ES6 (ES2015)模块</h1><p id="98c9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们的应用运行在节点13.2.0或更高版本上，我们可以通过向<code class="fe me mf mg mh b">package.json</code>添加以下内容来启用ES6模块支持:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ae1d" class="mq lc iq mh b gy mr ms l mt mu">{<br/>  "type": "module"<br/>}</span></pre><p id="a041" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于Node 13.1.0或更低版本，我们可以编写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6222" class="mq lc iq mh b gy mr ms l mt mu">node -r esm main.js</span></pre><p id="eaba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过使用<code class="fe me mf mg mh b">esm</code>打开ES模块支持。</p><p id="b62d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是运行<code class="fe me mf mg mh b">npm i esm</code>来将<code class="fe me mf mg mh b">esm</code>添加到我们的节点项目中。</p><h1 id="d6d4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用下划线. js作为模板引擎</h1><p id="a237" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">template</code>方法来传递HTML模板字符串。</p><p id="62e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7f6c" class="mq lc iq mh b gy mr ms l mt mu">const template  = _.template("&lt;h1&gt;hello &lt;%= name %&gt;&lt;/h1&gt;");</span></pre><p id="2e85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">template</code>是一个带占位符的函数。</p><p id="f9fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe me mf mg mh b">name</code>就是我们可以传入的占位符。</p><p id="3d2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5519" class="mq lc iq mh b gy mr ms l mt mu">const str = <!-- -->template({ name: 'world' });</span></pre><p id="dd7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe me mf mg mh b">str</code>就是<code class="fe me mf mg mh b">'&lt;h1&gt;hello world&lt;/h1&gt;’</code>。</p><p id="4cc8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">&lt;%= %&gt;</code>表示打印模板中的一些值。</p><p id="6a8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">&lt;% %&gt;</code>执行一些代码。</p><p id="b76a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">&lt;%- %&gt;</code>打印一些带有转义HTML的值。</p><h1 id="a040" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">运行npm start时，启动脚本丢失错误</h1><p id="ecdb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了解决这个错误，我们可以将<code class="fe me mf mg mh b">start</code>脚本添加到<code class="fe me mf mg mh b">package.json</code>中，把它放在<code class="fe me mf mg mh b">scripts</code>部分。</p><p id="d1f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="644b" class="mq lc iq mh b gy mr ms l mt mu">"scripts": {<br/>  "start": "node app.js"<br/>}</span></pre><p id="a779" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们运行<code class="fe me mf mg mh b">npm start</code>时，带有键<code class="fe me mf mg mh b">start</code>的脚本将会运行。</p><h1 id="573c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Node.js堆内存不足</h1><p id="6d6f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过设置<code class="fe me mf mg mh b">max-old-space-size</code>选项来增加节点应用的内存限制。</p><p id="ce4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7c33" class="mq lc iq mh b gy mr ms l mt mu">node --max-old-space-size=2048 app.js</span></pre><p id="06ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将内存限制增加到2 GB。</p><p id="08ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以在<code class="fe me mf mg mh b">NODE_OPTIONS</code>环境变量中设置它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f2cd" class="mq lc iq mh b gy mr ms l mt mu">export NODE_OPTIONS=--max_old_space_size=2048</span></pre><h1 id="bd46" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">所有异步forEach回调完成后的回调</h1><p id="a4d6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用for-await-of循环来遍历承诺。</p><p id="782b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="da2d" class="mq lc iq mh b gy mr ms l mt mu">const get = a =&gt; fetch(a);</span><span id="0b43" class="mq lc iq mh b gy mv ms l mt mu">const getAll = async () =&gt; {<br/>  const promises = [1, 2, 3].map(get);</span><span id="b493" class="mq lc iq mh b gy mv ms l mt mu">  for await (const item of promises) {<br/>    console.log(item);<br/>  }<br/>}</span></pre><p id="bae9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将通过一个循环依次运行每个承诺。</p><p id="a5ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这从ES2018开始提供。</p><h1 id="c810" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将UTC日期格式化为“YYYY-MM-DD hh:mm:ss”字符串</h1><p id="6411" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">toISOString</code>方法将<code class="fe me mf mg mh b">Date</code>实例格式化为‘YYYY-MM-DD hh:MM:ss’格式的日期字符串。</p><p id="e44a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写“</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9752" class="mq lc iq mh b gy mr ms l mt mu">const str = new Date()<br/>  .toISOString()<br/>  .<!-- -->replace(/T/, ' ')<br/>  .replace(/\..+/, '');</span></pre><p id="903f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用空字符串替换<code class="fe me mf mg mh b">T</code>，用空字符串替换点之后的文本。</p><p id="e5b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe me mf mg mh b">'2020–06–04 16:15:55'</code>作为结果。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/a4c8dd8995f977247bcf1d56a345f2eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wVuuj9qWo__iCDXC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@tadmint?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Melissa Regina</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="127b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="8232" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">下划线有一个<code class="fe me mf mg mh b">template</code>方法。</p><p id="b40d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">readFile</code>可以读取文件。</p><p id="3c4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在Express中获得查询参数。</p><p id="bef3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以增加节点应用程序的内存限制。</p><p id="2294" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Jade模板可以包含HTML局部视图。</p><h2 id="3bff" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">简单英语的JavaScript</h2><p id="7179" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到它们订阅我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>