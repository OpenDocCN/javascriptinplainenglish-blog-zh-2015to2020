<html>
<head>
<title>React Form Validation with Formik + Yup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Formik对表单验证做出反应+是</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-form-validation-with-formik-yup-ee6395b355f?source=collection_archive---------0-----------------------#2020-06-21">https://javascript.plainenglish.io/react-form-validation-with-formik-yup-ee6395b355f?source=collection_archive---------0-----------------------#2020-06-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1575" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Formik和yey以一种简单的方式构建一个包含其验证的表单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/35ecb00f2fddb4b2bce588ca6231c910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0esCF1i2MuwnLILpNukcJg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@mrthetrain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Joshua Hoehne</a> on <a class="ae kv" href="/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="908b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建表单验证是一项很累但很重要的任务。以正常的“反应方式”构建表单及其验证可能会令人沮丧，因为您需要创建从设置状态到表单提交的过程。<a class="ae kv" href="https://jaredpalmer.com/formik/" rel="noopener ugc nofollow" target="_blank"> Formik </a>可以帮助你以更简单的方式创建表单。还有<a class="ae kv" href="https://github.com/jquense/yup" rel="noopener ugc nofollow" target="_blank">是</a>，它提供了一系列的功能，所以你可以让验证过程更容易。</p><h2 id="63ba" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">本文将涉及哪些内容？</h2><ol class=""><li id="b0dd" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">使用Formik设置表单字段和初始值</li><li id="1416" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">处理用户输入</li><li id="bc79" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">使用“是”创建验证</li><li id="0036" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">处理提交表格</li></ol><p id="1757" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示如何构建一个简单的注册页面并处理表单验证。它包括全名、电子邮件、密码和密码确认字段。</p><h1 id="3bde" class="nb lt iq bd lu nc nd ne lx nf ng nh ma jw ni jx md jz nj ka mg kc nk kd mj nl bi translated">1.使用Formik设置字段和初始值</h1><p id="7ec9" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">这是我做的一个注册表格的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6530" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以看到，没有声明任何状态来存储字段的值。我们不会为此使用<code class="fe nr ns nt nu b">useState</code>挂钩。相反，我们将使用Formik来存储字段值。</p><p id="dd67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在此之前，让我们安装Formik。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="37db" class="ls lt iq nu b gy nz oa l ob oc">npm install formik --save<br/>// or<br/>yarn add formik</span></pre><p id="7cd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Formik提供了一个定制的挂钩，返回所需的所有状态和助手，它被称为<code class="fe nr ns nt nu b">useFormik</code>。它接受一个定义表单配置的对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="4896" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们通过<code class="fe nr ns nt nu b">initialValues</code>为我们的形式到<code class="fe nr ns nt nu b">useFormik</code>挂钩。在<code class="fe nr ns nt nu b">initialValues</code>声明的物业名称应与<code class="fe nr ns nt nu b">&lt;input /&gt;</code>的名称一致。现在可以从<code class="fe nr ns nt nu b">formik</code>变量访问返回的状态和助手。有了这些，我们就可以。获取字段值并将其放在我们的输入组件上:<code class="fe nr ns nt nu b">value={formik.values.full_name}</code>。无需反应<code class="fe nr ns nt nu b">useState</code>。</p><h1 id="f4ad" class="nb lt iq bd lu nc nd ne lx nf ng nh ma jw ni jx md jz nj ka mg kc nk kd mj nl bi translated">2.处理用户输入</h1><p id="a021" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">接下来是捕获用户输入并将其存储在我们的Formik状态中。Formik为我们提供了一系列的助手功能，其中之一就是<code class="fe nr ns nt nu b">handleChange</code>。此函数接受<code class="fe nr ns nt nu b">event</code>对象(从<code class="fe nr ns nt nu b">onChange</code>返回)，并使用字段名将值存储到适当的Formik状态。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="7c7f" class="ls lt iq nu b gy nz oa l ob oc">&lt;input<br/>  type="text"<br/>  name="full_name"<br/>  value={formik.values.full_name}<br/>  onChange={formik.handleChange} <br/>/&gt;</span></pre><p id="4e4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无需将该字段名称传递给<code class="fe nr ns nt nu b">handleChange</code>，因为其将获得带有<code class="fe nr ns nt nu b">event.target.name</code>的字段名称。</p><p id="5525" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Formik处理用户输入是一项简单的工作。使用<code class="fe nr ns nt nu b">handleChange</code>函数，我们可以将它放入所有输入的<code class="fe nr ns nt nu b">onChange</code>中。</p><h1 id="8ae1" class="nb lt iq bd lu nc nd ne lx nf ng nh ma jw ni jx md jz nj ka mg kc nk kd mj nl bi translated">3.使用Yup创建验证</h1><p id="4293" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">设置表单和处理用户输入很容易，验证值就不容易了。我们必须创建值检查器来验证我们的所有字段。多亏了Yup，我们可以使验证过程更容易！</p><p id="8325" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">什么是呀？引用自<a class="ae kv" href="https://github.com/jquense/yup" rel="noopener ugc nofollow" target="_blank"> Yup文档页面</a>:<em class="od">Yup是一个用于值解析和验证的JavaScript模式构建器</em>。我们可以使用Yup创建一个验证模式，并将其传递给<code class="fe nr ns nt nu b">useFormik</code>钩子。Formik为Yup提供了一个名为<code class="fe nr ns nt nu b">validationSchema</code>的选项。</p><p id="1a10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们安装。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="17ab" class="ls lt iq nu b gy nz oa l ob oc">npm install yup --save<br/>// or<br/>yarn add yup</span></pre><p id="7704" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以在页面上导入Yup，并为表单创建验证模式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="edc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面我做了两件事，即用Yup创建验证模式并显示错误消息。</p><h2 id="fabc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">用Yup创建验证模式</h2><p id="fe56" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">正如您在上面看到的，这个模式非常简单。我们只是链接验证函数来创建一组验证模式。例如，我们希望我们的<code class="fe nr ns nt nu b">full_name</code>值不为空，是一个字符串，最少2个字符，最多15个字符。然后使用Yup，我们可以使用<code class="fe nr ns nt nu b">required</code>、<code class="fe nr ns nt nu b">string</code>、<code class="fe nr ns nt nu b">min</code>和<code class="fe nr ns nt nu b">max</code>功能。错误消息也可以传递给每个函数。</p><p id="4da7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们通常遇到的更复杂的验证是电子邮件验证和密码确认。幸运的是，Yup还为我们提供了验证电子邮件和值相等的功能。Yup有更多的功能。关于Yup的详细信息可以在<a class="ae kv" href="https://github.com/jquense/yup" rel="noopener ugc nofollow" target="_blank">它的文档页面</a>中找到。</p><h2 id="e62c" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">显示错误消息</h2><p id="3e2d" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><code class="fe nr ns nt nu b">useFormik</code>钩子返回可用于显示错误信息的<code class="fe nr ns nt nu b">errors</code>和<code class="fe nr ns nt nu b">touched</code>状态。</p><ul class=""><li id="df46" class="ml mm iq ky b kz la lc ld lf oe lj of ln og lr oh mt mu mv bi translated"><code class="fe nr ns nt nu b">errors</code>:表单验证错误的对象。</li><li id="ed07" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr oh mt mu mv bi translated"><code class="fe nr ns nt nu b">touched</code>:布尔对象，表示该字段是否被访问过。</li></ul><p id="4ca8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Formik的验证功能会在用户输入的每一次击键时运行。这意味着<code class="fe nr ns nt nu b">errors</code>对象将包含任何给定时刻的所有验证错误。因此，我们可以显示这样的错误消息。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="0929" class="ls lt iq nu b gy nz oa l ob oc">{formik.<strong class="nu ir">errors</strong>.full_name &amp;&amp; &lt;p&gt;{formik.<strong class="nu ir">errors</strong>.full_name}&lt;/p&gt;}</span></pre><p id="405d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是这段代码会在用户在字段中输入内容后立即向用户显示错误消息。通常，我们希望在他们在该字段中输入完之后显示一条错误消息(而不是在他们输入的第一个字符之后)。这就是为什么我们需要<code class="fe nr ns nt nu b">touched</code>状态。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="331a" class="ls lt iq nu b gy nz oa l ob oc">{formik.errors.full_name &amp;&amp; formik.<strong class="nu ir">touched</strong>.full_name &amp;&amp; (<br/>  &lt;p&gt;{formik.errors.full_name}&lt;/p&gt;<br/>)}</span></pre><p id="f753" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过检查<code class="fe nr ns nt nu b">touched</code>状态，现在我们可以在他们处理完该字段后显示错误消息。</p><h1 id="cf05" class="nb lt iq bd lu nc nd ne lx nf ng nh ma jw ni jx md jz nj ka mg kc nk kd mj nl bi translated">4.处理表单提交</h1><p id="dc32" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">为了处理表单提交，我们必须将一个<code class="fe nr ns nt nu b">onSubmit</code>选项传递给<code class="fe nr ns nt nu b">useFormik</code>钩子。我们可以在<code class="fe nr ns nt nu b">onSubmit</code>选项功能中访问提交的值。您可以对这些值做任何您想做的事情，比如将它用作API的有效负载。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="af40" class="ls lt iq nu b gy nz oa l ob oc">const formik = useFormik({<br/>  initialValues: {<br/>    ...<br/>  },<br/>  validationSchema: Yup.object({<br/>    ...<br/>  }),<br/>  <strong class="nu ir">onSubmit</strong>: values =&gt; {<br/>    alert(JSON.stringify(values, null, 2));  <br/>  }<br/>});</span></pre><p id="85de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Formik提供的另一个助手功能是<code class="fe nr ns nt nu b">handleSubmit</code>。如果验证没有错误，它将执行我们传递给<code class="fe nr ns nt nu b">useFormik</code>的<code class="fe nr ns nt nu b">onSubmit</code>函数。我们可以把<code class="fe nr ns nt nu b">handleSubmit</code>功能放在<code class="fe nr ns nt nu b">&lt;form&gt;</code>上。</p><pre class="kg kh ki kj gt nv nu nw nx aw ny bi"><span id="b2d7" class="ls lt iq nu b gy nz oa l ob oc">&lt;form onSubmit={formik.handleSubmit}&gt;</span></pre><p id="78bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是注册表单的完整代码，以及它与Formik和Yup的验证。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="192f" class="nb lt iq bd lu nc nd ne lx nf ng nh ma jw ni jx md jz nj ka mg kc nk kd mj nl bi translated">结论</h1><p id="7048" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">有了Formik + Yup，我们可以使表单验证更容易。Formik为我们提供了一堆状态和助手来创建表单。然后，Yup为我们提供了一整套创建验证模式的方法。</p><p id="b095" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们上面讨论的一个工作示例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi nq l"/></div></figure><p id="ea1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢！</p></div></div>    
</body>
</html>