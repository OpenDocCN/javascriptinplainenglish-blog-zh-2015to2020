<html>
<head>
<title>Writing a CLI tool with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js编写CLI工具</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/writing-a-cli-tool-with-node-js-acfe200e20fc?source=collection_archive---------4-----------------------#2020-08-17">https://javascript.plainenglish.io/writing-a-cli-tool-with-node-js-acfe200e20fc?source=collection_archive---------4-----------------------#2020-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="883c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最初在2013年写了关于如何在Node.js中编写命令行实用程序的文章，当时，我正在撰写博客，因为我自己学会了如何在Node.js中构建CLI。</p><p id="e599" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是2020年，自从那篇原始帖子以来，我已经编写了相当多的CLI工具，所以我觉得有必要写一篇新帖子，谈谈我将如何在2020年用Node.js编写CLI工具。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8b0f21eecb5130d6ca45d92918ae9599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JYqFXNdAb0bTEUGA.jpg"/></div></div></figure><h1 id="eacf" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><p id="d853" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在我们开始之前，本教程有一个先决条件，即您已经安装了Node.js。我没有在这里写如何做到这一点，而是在treehouse的博客上链接了如何做到这一点的教程。</p><p id="de0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://blog.teamtreehouse.com/install-node-js-npm-mac】Mac:<a class="ae ma" href="https://blog.teamtreehouse.com/install-node-js-npm-mac" rel="noopener ugc nofollow" target="_blank">Windows:</a><a class="ae ma" href="https://blog.teamtreehouse.com/install-node-js-npm-windows" rel="noopener ugc nofollow" target="_blank">https://blog.teamtreehouse.com/install-node-js-npm-windows</a></p><h1 id="5cb9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">走吧</h1><p id="74d0" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">安装好先决条件后，我们现在需要初始化我们的项目。要做到这一点，你需要在系统的某个地方创建一个文件夹，对于我来说，我通常在我的主目录中有一个名为Sites的文件夹。</p><p id="b2e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要在命令行中访问该文件夹，请使用:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="469d" class="mg ky iq mc b gy mh mi l mj mk">cd ~/Sites</span></pre><p id="f812" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是为项目创建一个文件夹，为此我将使用<code class="fe ml mm mn mc b">mkdir.</code></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="fb12" class="mg ky iq mc b gy mh mi l mj mk">mkdir cli-project<br/>cd cli-project</span></pre><p id="dc31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们需要使用<code class="fe ml mm mn mc b">npm</code>初始化Node.js项目。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="05cc" class="mg ky iq mc b gy mh mi l mj mk">npm init</span></pre><p id="0f60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行这个命令后，NPM会问我们一系列关于我们项目的问题，对于这个项目，我们将把我们的命令行工具命名为<strong class="jp ir"> hello </strong>。以下是我对它提出的问题的回答(括号中的答案是默认答案，我按下enter键接受)。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="acd2" class="mg ky iq mc b gy mh mi l mj mk">name: (cli-project)<br/>version: (1.0.0)<br/>description: Simple hello world CLI<br/>entry point: (index.js)<br/>test command:<br/>git repository:<br/>keywords:<br/>author: Jonathan Fielding<br/>license: (ISC) MIT</span></pre><p id="93ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们会看到NPM生成的JSON提示:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="da0c" class="mg ky iq mc b gy mh mi l mj mk">{<br/>    "name": "cli-project",<br/>    "version": "1.0.0",<br/>    "description": "Simple hello world CLI",<br/>    "main": "index.js",<br/>    "scripts": {<br/>        "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>    },<br/>    "author": "Jonathan Fielding",<br/>    "license": "MIT"<br/>}</span></pre><p id="c7ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要接受这一点，只需按回车键。</p><p id="92df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，我们的目录中只有NPM init生成的<strong class="jp ir"> package.json </strong>文件，所以我们现在将创建命令行使用的JS文件。</p><p id="bf78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上所述，我们将在项目的根目录下创建一个名为<strong class="jp ir"> index.js </strong>的文件。我们的JS脚本的目的是在我们的hello CLI工具运行时，简单地将“hello world”记录到命令行。要做到这一点，我们需要做的第一件事是告诉我们的脚本应该如何执行，要为Node.js配置这一点，我们脚本的第一行应该是:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="b2c3" class="mg ky iq mc b gy mh mi l mj mk">#! /usr/bin/env node</span></pre><p id="88e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成了这些，我们现在可以写剩下的脚本了，因为我们只想在命令行上说hello world。完整的脚本如下。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="027e" class="mg ky iq mc b gy mh mi l mj mk">#! /usr/bin/env node<br/>console.log('hello world');</span></pre><p id="4c0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编写完JavaScript后，我们还想定义将在命令行中使用的命令，为此，我们需要在编辑器中打开package.json文件。然后，我们需要在配置中添加一个新的部分，即<code class="fe ml mm mn mc b">bin</code>对象。这个对象需要列出用户可能想要输入的任何命令，对于这个例子，我们将添加一个命令<code class="fe ml mm mn mc b">hello</code>。我们需要将它指向用于实用程序的主js文件<code class="fe ml mm mn mc b">index.js</code>。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="903a" class="mg ky iq mc b gy mh mi l mj mk">"bin": {<br/>    "hello" : "index.js"<br/>}</span></pre><p id="3425" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经告诉我们的package.json，每当我们的实用程序的用户在他们的CLI上输入' hello '时，它应该运行<code class="fe ml mm mn mc b">index.js</code>。</p><p id="324f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在只需返回控制台并运行<code class="fe ml mm mn mc b">npm link</code>，它将在我们的机器上安装CLI工具。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/03fd4446650b165194ed8ffb51de17c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwq-CRhow387q7u3dz_1hw.png"/></div></div></figure><p id="7e7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦运行测试我们运行的<code class="fe ml mm mn mc b">hello</code>命令，你会看到'你好世界'登录到控制台。</p><h1 id="197b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">下一步是什么</h1><p id="3144" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">当我们输入“hello”时，让我们的命令行说“hello world”是很好的，但是如果我们想让这个消息更个性化一点呢？为此，我们可以允许用户输入我们想打招呼的人的名字作为附加参数。</p><p id="7359" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果用户输入命令:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="bf63" class="mg ky iq mc b gy mh mi l mj mk">hello --from jonathan</span></pre><p id="6cd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它应该响应:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="e712" class="mg ky iq mc b gy mh mi l mj mk">hello jonathan</span></pre><p id="91b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，我们需要读取传递给应用程序的参数。在Node.js中，这样做的方法是读取<code class="fe ml mm mn mc b">process.argv</code>的值。</p><p id="d4ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们更新<code class="fe ml mm mn mc b">index.js</code>中的代码，将<code class="fe ml mm mn mc b">process.argv</code>的值记录到终端中。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="f323" class="mg ky iq mc b gy mh mi l mj mk"><em class="mp">#! /usr/bin/env node</em></span><span id="097b" class="mg ky iq mc b gy mq mi l mj mk">console.log(process.argv)</span></pre><p id="ef56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们现在在终端中键入<code class="fe ml mm mn mc b">hello --from jonathan</code>,我们将会看到下面的输出。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/03941ec4c1191dbb2d6c6145f55c83fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BTRhbRzA_Qea4PltEDIVA.png"/></div></div></figure><p id="24bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在上面看到的，我们输入的命令导致一个包含4个值的数组被记录到控制台。</p><p id="aa82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数组的第一个值是运行CLI的<code class="fe ml mm mn mc b">node</code>可执行文件的路径。</p><p id="1b4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个是我们运行的脚本的完整系统路径。<em class="mp">注意:</em>由于我们已经将CLI工具链接到我们的系统，完整的系统路径位于我们的<em class="mp"> /usr/local/bin </em>目录中。</p><p id="1055" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数组的其余值将是用户传递的参数。在这种情况下<code class="fe ml mm mn mc b">--from</code>和<code class="fe ml mm mn mc b">jonathan</code>。对于我们的CLI，我们最感兴趣的是这些剩余的参数。</p><p id="6a5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当析构一个数组时，我们可以选择命名数组的值。然后，我们可以使用spread操作符将剩余的值放入它自己的数组中。<a class="ae ma" href="https://dev.to/samanthaming/6-use-cases-of-spread-with-array-in-javascript-2n53" rel="noopener ugc nofollow" target="_blank">Samantha Ming</a>在dev.to上写了一篇关于析构数组的博文。</p><p id="f1bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面我们正在解构数组，为了我们自己的使用，我们提取命令(在本例中我们设置为<code class="fe ml mm mn mc b">--from</code>)和名称列表。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="cd4b" class="mg ky iq mc b gy mh mi l mj mk"><em class="mp">#! /usr/bin/env node</em></span><span id="ea3a" class="mg ky iq mc b gy mq mi l mj mk"><em class="mp">const</em> [ nodeExec, scriptPath, command, ...names ] = process.argv;</span><span id="b4ff" class="mg ky iq mc b gy mq mi l mj mk">console.log(names);</span></pre><p id="1a48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在运行我们的命令<code class="fe ml mm mn mc b">hello --from jonathan</code>将只输出名字。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/3efdd6249128bf277b7563f862f46d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3KoqbkgLkqG3oOPz26ZgQg.png"/></div></div></figure><p id="2c82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让用户输入到我们的CLI后，我们现在将构建我们的消息，并向用户显示。</p><p id="a8ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果命令设置为<code class="fe ml mm mn mc b">--from</code>，我们将使用作为参数传递的名字作为我们要问候的人的名字。如果命令没有设置为<code class="fe ml mm mn mc b">--from</code>，我们将简单地继续将<code class="fe ml mm mn mc b">hello world</code>登录到控制台。</p><p id="247b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了输出消息，我们将使用一个模板字符串，使用<code class="fe ml mm mn mc b">.join(', ')</code>将“names”数组的值连接起来，这样名称用逗号和空格分隔。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="0d1a" class="mg ky iq mc b gy mh mi l mj mk"><em class="mp">#! /usr/bin/env node</em></span><span id="2bcb" class="mg ky iq mc b gy mq mi l mj mk"><em class="mp">const</em> [ nodeExec, scriptPath, command, ...names ] = process.argv;</span><span id="9ae6" class="mg ky iq mc b gy mq mi l mj mk">if (command === '--from') {<br/>    console.log(`hello ${names.join(', ')}`);<br/>} else {<br/>    console.log('hello world')<br/>}</span></pre><p id="defb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果我们最后一次测试我们的CLI，我们会看到，如果我们简单地输入<code class="fe ml mm mn mc b">hello</code>，我们将得到一个响应<code class="fe ml mm mn mc b">hello world</code>，如果我们输入<code class="fe ml mm mn mc b">hello --from jonathan</code>，CLI将会用<code class="fe ml mm mn mc b">hello Jonathan</code>来响应。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/fa966cef733366f0fe10a06d76e4f25f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXb3VrvNr8EkZ2FfUlKxRw.png"/></div></div></figure><h1 id="e8d3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">概括起来</h1><p id="3c7c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">总之，在这篇文章中，我们已经完成了编写输出<code class="fe ml mm mn mc b">hello world</code>的Node.js CLI的步骤。然后，我们扩展它，根据指定的参数对问候语进行个性化设置。</p><p id="e954" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从这里开始，在Node.js中编写CLI非常类似于编写任何Node.js应用程序🤗。我希望这个教程对你有所帮助，我会继续在medium上发布更多帖子，所以请查看我的简介<a class="ae ma" href="https://medium.com/@JonthanFielding" rel="noopener">https://medium.com/@JonthanFielding</a>。</p><p id="b1fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">附:如果你喜欢这篇文章，请在推特上关注我<a class="ae ma" href="https://twitter.com/jonthanfielding" rel="noopener ugc nofollow" target="_blank">https://twitter.com/jonthanfielding</a>😀</p></div></div>    
</body>
</html>