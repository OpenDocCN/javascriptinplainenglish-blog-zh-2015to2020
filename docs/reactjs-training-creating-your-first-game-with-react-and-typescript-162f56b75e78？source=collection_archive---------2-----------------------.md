# ReactJS åŸ¹è®­:ä½¿ç”¨ React å’Œ TypeScript åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ¸¸æˆ

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/reactjs-training-creating-your-first-game-with-react-and-typescript-162f56b75e78?source=collection_archive---------2----------------------->

![](img/10845cfda170d88e83b80b0346f67455.png)

> å¦‚æœä½ æƒ³çŸ¥é“è¥¿ç­ç‰™è‰ºæœ¯çš„ç‰ˆæœ¬ï¼Œè¯·ç‚¹å‡»[è¿›å…¥](https://medium.com/@nanovazquez/reactjs-training-creando-tu-primer-juego-con-react-y-typescript-43232b988d87)ã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»ä»‹ç»äº†åŸºç¡€çŸ¥è¯†ï¼Œæ˜¯æ—¶å€™è®©äº‹æƒ…å˜å¾—çœŸå®äº†ã€‚åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä»å¤´å¼€å§‹å»ºç«‹ä¸€ä¸ª React åº”ç”¨ç¨‹åºï¼Œç„¶åæˆ‘ä»¬å°†åœ¨å®ƒçš„åŸºç¡€ä¸Šå®ç° [Connect Four](https://en.wikipedia.org/wiki/Connect_Four) æ¸¸æˆã€‚

![](img/95c7ca48e01bfff5bfa8ccace2d761f6.png)

This is the game we are going to build in this post: Connect four

é€šè¿‡éµå¾ªæœ¬é€æ­¥æ¼”ç»ƒï¼Œæ‚¨å°†åœ¨ç¼–å†™å®é™…åº”ç”¨ç¨‹åºæ—¶äº†è§£ React å’Œ TypeScriptã€‚ä½ å‡†å¤‡å¥½äº†å—ï¼ŸğŸ‘¾

# åˆå§‹è®¾ç½®

> **æ³¨æ„:**å¦‚æœä½ æƒ³é©¬ä¸Šå¼€å§‹æ¸¸æˆé€»è¾‘ï¼Œä½ å¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ï¼Œç„¶å[æ‰“å¼€æœ¬ç»ƒä¹ çš„ **begin** åº”ç”¨ï¼Œä½äºæœ¬æ¬¡åŸ¹è®­çš„ GitHub èµ„æºåº“](https://github.com/nanovazquez/reactjs-training/tree/master/exercise-2/begin/connect-four)ã€‚è®°å¾—åœ¨ç”¨`*npm start*`è¿è¡Œä¹‹å‰å…ˆç”¨`*npm install*`ã€‚

æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è§£é‡Šçš„é‚£æ ·ï¼ŒTypeScript å’Œ JSX éƒ½ä¸èƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚å› ä¸ºæˆ‘ä»¬è¦ç”¨è¿™äº›è¯­è¨€ç¼–å†™ä»£ç ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦*è½¬æ¢å®ƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©:*

1.  è‡ªå·±å‘ˆç°ã€è§£é‡Šã€åˆ†æå’Œé…ç½®å¤šä¸ªå·¥å…·(Webpack/Rollupã€Babel/tsconfigã€CSS æ¨¡å—ç­‰ã€‚)
2.  åˆ©ç”¨â€œæ¶å­å·¥â€(ä¹Ÿç§°ä¸º*é›†æˆå·¥å…·é“¾*)ï¼Œè¿™æ˜¯å·²ç»é¢„å…ˆé…ç½®å¥½çš„çƒ˜ç„™åº”ç”¨ï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„è®¾ç½®å°±å¯ä»¥å¼€å§‹ï¼Œè®©æˆ‘ä»¬**åªå…³æ³¨æˆ‘ä»¬çš„ä»£ç **ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨åä¸€ç§é€‰æ‹©ï¼Œåˆ©ç”¨è„¸ä¹¦çš„ [Create React app](https://github.com/facebook/create-react-app) ï¼Œè¿™æ˜¯å½“ä»Šæ„å»º React åº”ç”¨ç¨‹åºçš„äº‹å®ä¸Šçš„å·¥å…·ã€‚

è®¾ç½®èµ·æ¥éå¸¸ç®€å•:

åœ¨ä½ çš„ç»ˆç«¯ä¸­ï¼Œè¿è¡Œ`npx create-react-app connect-four --typescript`ã€‚è¯¥å‘½ä»¤å°†åœ¨æ–‡ä»¶å¤¹ **connect-four** ä¸­åˆ›å»ºä¸€ä¸ª TypeScript åº”ç”¨ç¨‹åºã€‚ç­‰å¾…è¯¥è¿‡ç¨‹å®Œæˆã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„æ¶ˆæ¯:

![](img/5e370885547cec56ef062d22d3ba803c.png)

Create React app installation completed successfully message

> **æ³¨æ„:**å¦‚æœ`*npx*`ä¸èµ·ä½œç”¨ï¼Œå…ˆç”¨`*npm i -g create-react-app*`å†ç”¨`*create-react-app connect-four --typescript*`è¯•è¯•ã€‚

æµè§ˆåˆ°æ‚¨åˆšåˆšåˆ›å»ºçš„ **connect-four** æ–‡ä»¶å¤¹ï¼ŒèŠ±ä¸€ä¸¤åˆ†é’Ÿæ—¶é—´åˆ†ææ–‡ä»¶å¤¹ç»“æ„ã€‚æ‚¨æ­£åœ¨æŸ¥çœ‹ä¸€ä¸ªå…¨åŠŸèƒ½çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸šåŠ¡é€»è¾‘ä½äº **src** æ–‡ä»¶å¤¹ä¸­:

```
**connect-four** â”œâ”€â”€ node_modules
â”‚   â”œâ”€â”€ ...
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ manifest.json
â”‚   â””â”€â”€ ...
**â”œâ”€â”€ src** â”‚   â”œâ”€â”€ App.css
â”‚   â”œâ”€â”€ **App.tsx** â”‚   â”œâ”€â”€ index.css
â”‚   â”œâ”€â”€ index.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ ...
```

ç°åœ¨ï¼Œè¿è¡Œ`npm start`ã€‚è¯¥å‘½ä»¤åœ¨*â€œå¼€å‘æ¨¡å¼â€*ä¸‹æ‰§è¡Œåº”ç”¨ç¨‹åºï¼Œè¿™æä¾›äº†è®¸å¤šé¢å¤–çš„å¥½å¤„ï¼Œå¦‚å½“æ‚¨å¯¹ä»£ç è¿›è¡Œæ›´æ”¹æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½(ä¹Ÿç§°ä¸º[çƒ­æ¨¡å—æ›¿æ¢](https://webpack.js.org/concepts/hot-module-replacement/))ã€‚

æ‰“å¼€ [http://localhost:3000](http://localhost:3000) åœ¨æµè§ˆå™¨ä¸­å¯è§†åŒ–æ‚¨çš„åº”ç”¨ç¨‹åº:

![](img/77c2af17e108a4231d123f8819a6b890.png)

Create React app initial Home screen

æ­å–œä½ ï¼ä½ å·²ç»ç”¨ React å’Œ TypeScript åˆ›å»ºäº†ä½ çš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºğŸ‘ ğŸ’ƒ ğŸ•º ğŸ‘

è®©æˆ‘ä»¬å…œä¸€åœˆã€‚ä½¿ç”¨ VSCode æˆ–æ‚¨åå¥½çš„ IDE æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œå¹¶å¯¼èˆªåˆ° **src/App.tsx** æ–‡ä»¶å¤¹ã€‚

![](img/7340afe7503c370405558efc2e0f04d9.png)

App.tsx file autogenerated by Create React app

> **æ³¨:**äº²æç¤ºï¼æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ`*code .*`æ‰“å¼€æŒ‡å‘æ‚¨ç»ˆç«¯æ‰€åœ¨æ–‡ä»¶å¤¹çš„ VSCodeã€‚ç±»ä¼¼åœ°ï¼Œæ‚¨å¯ä»¥ç”¨`*atom .*`å¯¹ Atom åšåŒæ ·çš„äº‹æƒ…ã€‚è€Œå¯¹äº Sublimeï¼Œå¯ä»¥è¿è¡Œ`*subl .*`ã€‚

èŠ±å‡ åˆ†é’Ÿæ—¶é—´æ¥åˆ†æè¿™ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç :

*   åœ¨é¡¶éƒ¨ï¼Œæœ‰`import`è¯­å¥ã€‚è¿™æ˜¯ JavaScript (ES6)å°†æ¨¡å—å¯¼å…¥æ–‡ä»¶çš„æ–¹å¼ã€‚å¯¼å…¥çš„å€¼å­˜å‚¨åœ¨å˜é‡ä¸­ä¾›ä»¥åä½¿ç”¨ã€‚*ä½ å¯ä»¥åœ¨è¿™é‡Œ* *äº†è§£æ›´å¤š ES6 è¿›å£* [*ã€‚*](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import)
*   *ç¬¬ 5 è¡Œ*å®šä¹‰äº†ä¸€ä¸ªåä¸º`App`çš„[ååº”å‡½æ•°ç»„ä»¶](https://reactjs.org/docs/components-and-props.html#function-and-class-components)ã€‚å®ƒè¿”å› JSX ä»£ç ï¼Œç¨åå°†ç”±æµè§ˆå™¨å‘ˆç°(åœ¨ç¿»è¯‘ä¹‹å)ã€‚ *React ç»„ä»¶å¸®åŠ©æˆ‘ä»¬å°†ä»£ç åˆ†å‰²æˆå°å—ï¼Œéµå¾ªå•ä¸€è´£ä»»åŸåˆ™(æˆ–è€…*[*SRP*](https://en.wikipedia.org/wiki/Single_responsibility_principle)*)ã€‚*
*   åœ¨ç¬¬ 7 è¡Œå’Œç¬¬ 22 è¡Œä¹‹é—´æœ‰ JSX ä»£ç ï¼Œä»£è¡¨æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°çš„æ¸²æŸ“ã€‚æ³¨æ„ï¼Œé™¤äº†ç¬¬ 9 è¡Œä½¿ç”¨ JavaScript å˜é‡å¼•ç”¨(`<img src={logo} .. />`)è®¾ç½®äº† *src* å±æ€§ä¹‹å¤–ï¼Œå®ƒå‡ ä¹ä¸ HTML ç›¸åŒã€‚
*   æœ€åï¼Œ*ç¬¬ 26 è¡Œ* *å¯¼å‡º*æˆ‘ä»¬çš„`<App />`å‡½æ•°ï¼Œä½¿å…¶å¯ä»¥è¢«*å¯¼å…¥åˆ°å…¶ä»–æ–‡ä»¶ä¸­*ã€‚

åœ¨æœ¬åœ°è¿è¡Œåº”ç”¨ç¨‹åº(å¦‚æœæ‚¨å·²ç»åœæ­¢äº†å®ƒï¼Œåœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œ`npm start`ï¼Œé€šè¿‡åˆ é™¤ç¬¬*è¡Œç¬¬ 22ã€*è¡Œä¸­çš„`</div>`ç»“æŸæ ‡ç­¾æ¥ä¿®æ”¹ä»£ç ï¼Œå¹¶ä¿å­˜æ‚¨çš„æ›´æ”¹ã€‚

è¯·æ³¨æ„ï¼ŒVSCode(æˆ–æ‚¨çš„ IDE)ç°åœ¨ä¼šæ˜¾ç¤ºä¸€ä¸ªé”™è¯¯:

![](img/d2a5d6a5afd6fdaf7ee9462d4164e9d5.png)

Error message displayed in VSCode

æµè§ˆå™¨æ˜¾ç¤ºä¸€ä¸ªç¼–è¯‘é”™è¯¯:

![](img/aa8861189d117ddf093b988e7fbc5628.png)

Compilation error in the browser

é€šè¿‡æ’¤é”€æ‚¨æ‰€åšçš„æ¥ä¿®å¤é”™è¯¯(æˆ‘ä»¬ç§»é™¤äº†`</div>`ç»“æŸæ ‡ç­¾)ï¼Œä¿å­˜æ‚¨çš„æ›´æ”¹å¹¶ç­‰å¾…æµè§ˆå™¨åˆ·æ–°æ‚¨çš„åº”ç”¨ã€‚

ç°åœ¨ï¼Œæ‰“å¼€ **src/index.tsx** æ–‡ä»¶ã€‚è¿™æ˜¯åº”ç”¨ç¨‹åºçš„ä¸»è¦å…¥å£ç‚¹:

```
import React from â€œreactâ€;
import ReactDOM from â€œreact-domâ€;
import App from â€œ./Appâ€;ReactDOM.render(<App />, document.getElementById(â€œrootâ€));
```

ä½ ç°åœ¨éœ€è¦å­¦ä¹ çš„æœ€é‡è¦çš„äº‹æƒ…æ˜¯:

*   è¿™ä¸ªæ–‡ä»¶*å¯¼å…¥*ç»„ä»¶`<App />`ï¼Œä»¥åŠ React å’Œ ReactDOM åº“ã€‚
*   å®ƒæ‰§è¡Œ`ReactDOM.render()`æ–¹æ³•ï¼Œå°†`<App />`ç»„ä»¶å’Œä¸€ä¸ªä»¥â€œrootâ€ä¸º ID çš„æ–‡æ¡£(HTML)å…ƒç´ çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ã€‚
*   ä½ å¯ä»¥åœ¨ **public/index.html** æ–‡ä»¶ä¸­æ‰¾åˆ°ä½ çš„åº”ç”¨å¯åŠ¨æ—¶æµè§ˆå™¨å‘ˆç°çš„ HTMLã€‚åœ¨*ç¬¬ 31 è¡Œï¼Œ*æœ‰ä¸€ä¸ªç©ºçš„`<div id="root">`å…ƒç´ ã€‚è¿™æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºå°†è¢«â€œè£…è½½â€çš„åœ°æ–¹ï¼Œè¿™æ„å‘³ç€è¿™æ˜¯åº”ç”¨ç¨‹åºåœ¨`render()`æ–¹æ³•ä¸­çš„ä»£ç å°†è¢«æ³¨å…¥çš„åœ°æ–¹(ä½œä¸º HTML)ã€‚

è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸æˆ‘ä»¬åœ¨ä¹‹å‰çš„å¸–å­ä¸­çœ‹åˆ°çš„ä¹‹å‰çš„åŸºæœ¬ç¤ºä¾‹[å®Œå…¨ç›¸åŒã€‚**è¿™å°±æ˜¯ React çš„å¼ºå¤§ä¹‹å¤„:**ä¸ç®¡ä½ çš„åº”ç”¨ç¨‹åºæœ‰å¤šå¤æ‚ï¼Œå‘ˆç°å®ƒçš„ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ã€‚](https://medium.com/@nanovazquez/reactjs-training-understanding-react-and-typescript-d01deb2dd127)

## åŒ…æ‰

åœ¨åˆå§‹è®¾ç½®çš„å¿«é€Ÿæ¼”ç»ƒä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œ:

1.  æˆ‘ä»¬ç”¨ç»ˆç«¯ä¸­çš„ä¸€ä¸ª(npm)å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªå…¨åŠŸèƒ½çš„ web åº”ç”¨ç¨‹åºã€‚
2.  æˆ‘ä»¬åœ¨æœ¬åœ°æ‰§è¡Œ web åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºå®ƒã€‚
3.  æˆ‘ä»¬åˆ†æäº†åº”ç”¨ç¨‹åºçš„ *React + TypeScript* ä»£ç ï¼ŒåŒ…æ‹¬ä¸»è¦ç»„ä»¶å’Œä¸»è¦å…¥å£ä»£ç ï¼Œä»¥åŠå®ƒçš„ HTML ä»£ç ã€‚

æœ€åï¼Œä¸è¦å¿˜è®°**æµè§ˆå™¨åªç†è§£ HTMLã€JS å’Œ CSS** ï¼Œä¸ç†è§£ TS æˆ– JSXã€‚è¿™ä¸ª*æ­å»ºçš„åº”ç”¨*æœ‰ä¸€ä¸ª**æ„å»º** *è¿›ç¨‹*ï¼Œå®ƒå°†ç”Ÿæˆ JS å’Œ CSS æ–‡ä»¶ï¼Œå¹¶å°†å®ƒæ”¾åœ¨ä¸€ä¸ª **dist** æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶åœ¨**index.html**æ–‡ä»¶ä¸­å¼•ç”¨ï¼Œä¹Ÿç”Ÿæˆã€‚è¿™äº›è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶å°†è¢«å‘é€åˆ°æµè§ˆå™¨è¿›è¡Œè§£æã€è¯»å–ã€è§£é‡Šå’Œæ‰§è¡Œã€‚

> **æ³¨æ„:**å¦‚æœä½ æœ‰å…´è¶£é˜…è¯» transpilation è¿‡ç¨‹çš„æ·±å…¥è§£é‡Šï¼Œä»¥åŠå¦‚ä½•ä¸ºæ­¤é…ç½®å·¥å…·ï¼Œè¯·åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ·»åŠ è¯„è®ºï¼Œæˆ‘ä¼šå†™çš„ï¼

# å°†æ¸¸æˆé€»è¾‘æ·»åŠ åˆ°åº”ç”¨ä¸­

æ—¢ç„¶æˆ‘ä»¬å·²ç»äº†è§£äº† React åº”ç”¨ç¨‹åºçš„åŸºç¡€ï¼Œæ˜¯æ—¶å€™æ·»åŠ æ¸¸æˆé€»è¾‘äº†ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è§£é‡Šçš„é‚£æ ·ï¼ŒReact åº”ç”¨ç¨‹åºå°†ä¸šåŠ¡é€»è¾‘åˆ†æˆä¸åŒçš„ç»„ä»¶ã€‚ä½†æ˜¯æˆ‘ä»¬å¿…é¡»å¤„ç†ä¸åŒçš„è´£ä»»:å†³å®šè°èµ¢(ä»¥åŠæ˜¯å¦æœ‰äººèµ¢)çš„é€»è¾‘ï¼Œé€‰æ‹©ç»˜åˆ¶å…ƒç´ (ä»¥åŠå¦‚ä½•ç»˜åˆ¶)çš„é€»è¾‘ï¼Œå†³å®šè°çš„ç©å®¶å¯ä»¥ç§»åŠ¨çš„é€»è¾‘ï¼Œç­‰ç­‰ã€‚æˆ‘ä»¬å¦‚ä½•ä»¥ä¸€è‡´çš„å¯é‡å¤çš„æ–¹å¼åˆ’åˆ†è¿™äº›èŒè´£ï¼Ÿ

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå¹¿ä¸ºäººçŸ¥çš„æ¨¡å¼ï¼Œ[è¡¨ç¤ºå’Œå®¹å™¨ç»„ä»¶](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)ï¼Œä»¥ä¸€ä¸ªç®€å•ä½†å¼ºå¤§çš„ç»“æ„ç»„ç»‡æˆ‘ä»¬çš„ç»„ä»¶:

![](img/beabafba37727dfb9600f574ad840f6b.png)

React data flows from â€œtop to bottomâ€, while events bubble up information â€œfrom the bottom to the topâ€

è¯¥æŠ€æœ¯æå‡ºå°†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€å°è£…åœ¨çˆ¶ç»„ä»¶ä¸­(*å®¹å™¨*æˆ–*æ™ºèƒ½)*)ã€‚å¹¶ä½¿ç”¨å®ƒä»¬çš„å­ç»„ä»¶ï¼Œé€šå¸¸æ˜¯æ ‘å¶ï¼Œæ¥å‘ˆç° UI å’Œç®¡ç†ç”¨æˆ·äº¤äº’(*è¡¨ç¤ºæ€§*æˆ–*å“‘*ç»„ä»¶)ã€‚

*å®¹å™¨*ç»„ä»¶é€šè¿‡**é“å…·**å‘å…¶å­ç»„ä»¶å‘é€æ•°æ®å’ŒåŠŸèƒ½ã€‚*è¡¨ç¤ºæ€§*ç»„ä»¶ä½¿ç”¨æ•°æ®æ¥å†³å®šç”»ä»€ä¹ˆä»¥åŠå¦‚ä½•ç”»ã€‚å¹¶åœ¨ç”¨æˆ·ä¸è¿™äº›å‡½æ•°äº¤äº’æ—¶æ‰§è¡Œå®ƒä»¬ï¼Œé€šå¸¸ä»¥å‚æ•°çš„å½¢å¼å‘é€ä¿¡æ¯ã€‚

> **æ³¨æ„:**ç”±äºä½ çš„åº”ç”¨ç¨‹åºå°†ä»ä¸Šåˆ°ä¸‹å±‚å ä¿¡æ¯ï¼Œè¿™ç§æ–¹æ³•æœ€é€‚åˆä¸­å°å‹åº”ç”¨ç¨‹åºã€‚ç”±æ·±åº¦åµŒå¥—çš„å±‚æ¬¡ç»“æ„ç»„æˆçš„å¤§å‹åº”ç”¨ç¨‹åºéœ€è¦ä¸åŒçš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºå®ƒã€‚

é€šè¿‡ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«ä»¥ä¸‹å®ä½“:

*   ä¸€ä¸ª **App** ç»„ä»¶ï¼Œè´Ÿè´£å­˜å‚¨åº”ç”¨çš„çŠ¶æ€ã€‚å¹¶è®¡ç®—å‡ºè°æ˜¯èµ¢å®¶ã€‚å°±æ˜¯*â€œçˆ¶â€/â€œå®¹å™¨â€/â€œæ™ºèƒ½â€*ç»„ä»¶ã€‚
*   ä¸€ä¸ª**æ£‹ç›˜**ç»„ä»¶ï¼Œè´Ÿè´£ç»˜åˆ¶æ¸¸æˆçš„å…ƒç´ ã€‚è¯¥æ¿ç”±å¤šä¸ª**åˆ—**ç»„æˆï¼Œè¿™äº›åˆ—ç”±ä¸åŒçš„**å—**ç»„æˆï¼Œè¿™äº›å—å¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰èŠ¯ç‰‡ã€‚å®ƒä»¬æ˜¯â€œå­å…ƒç´ â€/â€œè¡¨è±¡å…ƒç´ â€/â€œå“‘å…ƒç´ â€ã€‚
*   å½“ç‚¹å‡»**æ **æ—¶ï¼Œä¸€ä¸ªæ–°çš„**èŠ¯ç‰‡**è¢«æ·»åŠ åˆ°åº•éƒ¨ä¸€ä¸ªç©ºçš„**ç“·ç –**ä¸­ã€‚è¿™æ˜¯ app ä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†ã€‚

![](img/99fe87693c59020cd8ddfda27a8aa50e.png)

Split the applicationâ€™s logic into small components

> å½“ç„¶ï¼Œæ‚¨ä½¿ç”¨çš„ç»„ä»¶å¯ä»¥æ ¹æ®æ‚¨çš„åå¥½è€Œæœ‰æ‰€ä¸åŒã€‚ä½ èƒ½æƒ³å‡ºä¸€ç§ä¸åŒçš„æ–¹å¼æ¥ç»„ç»‡ä½ çš„ä»£ç å—ï¼Ÿ

## åˆ›å»ºå•å¹…å›¾å—ç»„ä»¶

åœ¨ **src** æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåä¸º **components** çš„æ–°æ–‡ä»¶å¤¹ã€‚

åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºå¦ä¸€ä¸ªåä¸º **Tile** çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹(ç›®å‰ä¸ºç©º)æ–‡ä»¶:

*   å­˜å‚¨ css ä»£ç çš„ **Tile.module.css** æ–‡ä»¶
*   React ç»„ä»¶é€»è¾‘çš„ **Tile.tsx** æ–‡ä»¶
*   ä»¥åŠç”¨äºç»„ä»¶çš„ç±»å‹è„šæœ¬ç±»å‹çš„ **types.ts** æ–‡ä»¶ã€‚

æ‰“å¼€**src/components/Tile/types . ts**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç :

```
export interface Props {
  id: string;
  chipType?: string;
  onClick: (id: string) => any;
}
```

é€šè¿‡é”®å…¥**ç“¦ç‰‡**ç»„ä»¶çš„**é“å…·**ï¼Œæˆ‘ä»¬å®šä¹‰äº†å®ƒçš„æ¥å£ï¼Œæˆ–è€…å¥‘çº¦ã€‚å®ƒå‘Šè¯‰ç»„ä»¶ä½¿ç”¨è€…:

1.  å®ƒå¿…é¡»é€šè¿‡ç»„ä»¶çš„**é“å…·**æä¾›ä¸€ä¸ª`id`ã€‚
2.  å®ƒå¯ä»¥å‘ç»„ä»¶å‘é€ä¸€ä¸ª`chipType`ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œ**ç“·ç –**å¯ä»¥æœ‰**èŠ¯ç‰‡**ä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚
3.  å®ƒå¿…é¡»é™„åŠ ä¸€ä¸ªåŠŸèƒ½åˆ°`onClick`é“å…·ï¼Œå½“ç”¨æˆ·ç‚¹å‡»**ç“·ç –**æ—¶å°†è¢«è§¦å‘ã€‚

ç„¶åï¼Œæ‰“å¼€**src/components/tile . tsx**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç :

```
import React from "react";
import classNames from "classnames";
import styles from "./Tile.module.css";
import { Props } from "./types";export default class Tile extends React.PureComponent<Props> {render() {
    const { id, chipType, onClick = () => {} } = this.props;
    const chipCssClass = classNames(styles.chip, chipType === "red" ? styles.red : styles.yellow);

    return (
      <div className={styles.tile} onClick={() => onClick(id)}>
        {chipType && <div className={chipCssClass} />}
      </div>
    );
  }
}
```

é€šè¿‡æŸ¥çœ‹è¿™æ®µä»£ç ï¼Œä½ ä¼šæ³¨æ„åˆ° **Tile** ç»„ä»¶æ˜¯ä¸€ä¸ª *presentational* ç»„ä»¶ï¼Œè´Ÿè´£åœ¨ä½ çš„æ¿ä¸Šç»˜åˆ¶å›¾å—ã€‚å®ƒé€šè¿‡æ£€æŸ¥`chipType`å±æ€§çš„å€¼æ¥å†³å®š**èŠ¯ç‰‡**æ˜¯å¦å­˜åœ¨ï¼Œå¹¶æ ¹æ®å…¶å€¼è®¾ç½® CSS ç±»ã€‚æœ€åï¼Œå½“ç‚¹å‡»æ—¶ï¼Œå®ƒè§¦å‘è®¾ç½®ä¸º`onClick`é“å…·çš„å‡½æ•°ï¼Œå‘é€**å›¾å—**çš„`id`ä½œä¸ºå‚æ•°ã€‚

> **æ³¨æ„:**æœ‰æ²¡æœ‰æ³¨æ„åˆ°æˆ‘ä»¬æŠŠ**é“å…·**æ¥å£é™„åŠ åˆ°äº†`*React.PureComponent*`å®šä¹‰ä¸Šï¼Ÿè¿™å°±æ˜¯ä½ è¾“å…¥ React class çš„æ–¹å¼ã€‚IDE å°†ç†è§£è¿™ä¸€ç‚¹ï¼Œå¹¶å‘Šè¯‰æ‚¨ç»„ä»¶ä¸­æ¯ä¸ªé“å…·çš„ç±»å‹ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†é¼ æ ‡æ‚¬åœåœ¨`render()`æ–¹æ³•çš„ç¬¬ä¸€è¡Œä¸­çš„`*this.props*`å€¼ä¸Šæ¥æŸ¥çœ‹è¿™ä¸€ç‚¹ã€‚è¯•è¯•çœ‹ï¼

æœ€åï¼Œæ‰“å¼€**src/components/tile . module . css**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ CSS ä»£ç :

```
.tile {
  width: 75px;
  height: 75px;
  border: solid 10px #3355ff;
  border-radius: 100%;
  background-color: white;
}.chip {
  width: 75px;
  height: 75px;
  border-radius: 100%;
  background-color: gray;
}.yellow {
  background-color: #ffff33;
}.red {
  background-color: #ff010b;
}
```

> **æ³¨æ„:** Create React app ä½¿ç”¨`*[name].module.css*`å¤„ç† CSS æ–‡ä»¶çš„æ–¹å¼ä¸åŒäºæ™®é€šçš„ CSS æ–‡ä»¶ï¼Œå®ƒä½¿ç”¨ [CSS æ¨¡å—](https://github.com/css-modules/css-modules)åº“æ¥ä¼ è¾“å®ƒä»¬ã€‚è¿™æ ·åšçš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œæ‚¨ä¸éœ€è¦æ‹…å¿ƒ CSS ç±»åå†²çªï¼Œå› ä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ã€‚è¿™æ˜¯å¯ä»¥å®ç°çš„ï¼Œå› ä¸ºå½“ä¼ è¾“æ–‡ä»¶æ—¶ï¼Œæ‰€æœ‰ CSS ç±»åéƒ½è¢«æ›¿æ¢ä¸ºæ ¼å¼`*[filename]_[classname]__[hash]*`çš„â€œå”¯ä¸€â€å€¼ã€‚
> 
> æœ‰å…³è¯¥åº“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å•å‡»[æ­¤å¤„](https://create-react-app.dev/docs/adding-a-css-modules-stylesheet)ã€‚

## åˆ›å»ºæŸ±æ„ä»¶

ç°åœ¨å¯¼èˆªåˆ°**ç»„ä»¶**æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º**åˆ—**çš„æ–°æ–‡ä»¶å¤¹ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä»¥ä¸‹æ–‡ä»¶:ä¸€ä¸ªç”¨äºå­˜å‚¨ css ä»£ç çš„ **Column.module.css** æ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äº React ç»„ä»¶é€»è¾‘çš„ **Column.tsx** æ–‡ä»¶å’Œä¸€ä¸ªç”¨äºç»„ä»¶ç±»å‹è„šæœ¬ç±»å‹çš„ **types.ts** æ–‡ä»¶ã€‚

æ‰“å¼€**src/components/Column/types . ts**æ–‡ä»¶ï¼Œç²˜è´´ä¸‹é¢å®šä¹‰**åˆ—**ç»„ä»¶çš„ props (contract)çš„ä»£ç :

```
import { ChipsPositions } from "../App/types";export interface Props {
  column: number;
  rows: number;
  chipsPositions: ChipsPositions;
  onTileClick: (id: string) => any;
}
```

è¿™æ®µä»£ç å‘Šè¯‰ç»„ä»¶çš„ä½¿ç”¨è€…:

*   å®ƒéœ€è¦æä¾›ä¸€ä¸ª`column`å·ã€‚è¯¥å€¼å……å½“å…ƒç´ çš„ IDã€‚
*   å®ƒéœ€è¦å®šä¹‰**åˆ—**ç»„ä»¶å°†æœ‰å¤šå°‘ä¸ª`rows`ã€‚
*   `chipsPositions`é“å…·æ˜¯çŸ¥é“æ¯ä¸ªç­¹ç ä½ç½®çš„å¯¹è±¡ã€‚æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°è¿™ä¸ªå¯¹è±¡æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚ç°åœ¨ï¼Œä½ åªéœ€è¦çŸ¥é“å®ƒèƒ½å‘Šè¯‰æˆ‘ä»¬**ç“·ç –**é‡Œé¢æ˜¯å¦æœ‰èŠ¯ç‰‡ã€‚
*   æœ€åï¼Œ`onTileClick`å‡½æ•°ç”¨äºè®©çˆ¶èŠ‚ç‚¹çŸ¥é“ç”¨æˆ·ä½•æ—¶ç‚¹å‡»äº†ç‰¹å®šçš„ç£è´´ã€‚

æ‰“å¼€**src/components/column . tsx**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç :

```
import React from "react";
import Tile from "../Tile/Tile";
import styles from "./Column.module.css";
import { Props } from "./types";export default class Column extends React.PureComponent<Props> { render() {
    const { column, rows, chipsPositions, onTileClick } = this.props;
    const tiles = [];

    for (let row = 0; row < rows; row++) {
      const tileId = `${row}:${column}`;
      const chipType = chipsPositions[tileId];
      tiles.push(
        <Tile
          key={tileId}
          id={tileId}
          chipType={chipType}
          onClick={onTileClick}
        />
      );
    } return <div className={styles.column}>{tiles}</div>;
  }
}
```

è¿™æ®µ(ä¹Ÿæ˜¯*è¡¨ç¤ºæ€§*)ä»£ç å‘ˆç°ä¸€ä¸ª`<div>`å…ƒç´ ï¼Œè¯¥å…ƒç´ åŒ…å«ä¸`rows`å€¼æ‰€æŒ‡ç¤ºçš„**å¹³é“º**ç»„ä»¶ä¸€æ ·å¤šçš„`<div>`ç»„ä»¶(é€šè¿‡*é“å…·*å‘é€)ã€‚æ¯ä¸ªåŒºå—å°†æ¥æ”¶ä¸€ä¸ª`chipType`å’Œ`onTileClick()`åŠŸèƒ½ã€‚æ³¨æ„ï¼Œè¿™é‡Œå”¯ä¸€çš„`tileId`æ˜¯é€šè¿‡ç»„åˆ`row`å’Œ`column`çš„å€¼æ¥å®šä¹‰çš„ã€‚

æœ€åï¼Œæ‰“å¼€**src/components/Column/Column . module . css**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ CSS ä»£ç :

```
.column {
  display: flex;
  flex-direction: column;
  cursor: pointer;
}
```

æˆ‘ä»¬å¿«åˆ°äº†ï¼ğŸ™Œ

## åˆ›å»ºç”µè·¯æ¿ç»„ä»¶

ç±»ä¼¼åœ°ï¼Œå¯¼èˆªåˆ°**ç»„ä»¶**æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º**æ¿**çš„æ–°æ–‡ä»¶å¤¹ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä»¥ä¸‹æ–‡ä»¶:ä¸€ä¸ªç”¨äºå­˜å‚¨ css ä»£ç çš„ **Board.module.css** æ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äº React ç»„ä»¶é€»è¾‘çš„ **Board.tsx** æ–‡ä»¶å’Œä¸€ä¸ªç”¨äºç»„ä»¶ç±»å‹è„šæœ¬çš„ **types.ts** æ–‡ä»¶ã€‚

> **æ³¨:**ä½ åœ¨åˆ›å»ºç»„ä»¶æ—¶çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å¼å—ï¼Ÿ

æ‰“å¼€**src/components/Board/types . ts**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹å®šä¹‰**æ¿**ç»„ä»¶é“å…·(åˆåŒ)çš„ä»£ç :

```
import { ChipsPositions } from â€œ../App/typesâ€;export interface Props {
  columns: number;
  rows: number;
  chipsPositions: ChipsPositions;
  onTileClick: (id: string) => any;
}
```

è¿™æ®µä»£ç å‘Šè¯‰ç»„ä»¶çš„ä½¿ç”¨è€…:

*   å®ƒå¿…é¡»æä¾›ç”µè·¯æ¿ä¸Šçš„`columns`å’Œ`rows`çš„æ•°é‡ã€‚
*   å®ƒå¿…é¡»å‘é€`chipsPositions`å¯¹è±¡ã€‚*ä½†æ˜¯è¿™ä¸ªä¿¡æ¯æ˜¯ç”±* ***æ çš„*** *ç»„ä»¶ä½¿ç”¨çš„ï¼Œè€Œä¸æ˜¯* ***æ¿çš„*** *ã€‚*
*   å®ƒå¿…é¡»æä¾›ä¸€ä¸ª`onTileClick`å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ç”± **Tile** ç»„ä»¶åœ¨è¢«ç‚¹å‡»æ—¶å‘å‡ºä¿¡å·ã€‚

ç„¶åï¼Œæ‰“å¼€**src/components/board . tsx**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹æ¼”ç¤ºä»£ç :

```
import React from "react";
import Column from "../Column/Column";
import styles from "./Board.module.css";
import { Props } from "./types";export default class Board extends React.PureComponent<Props> {

  renderColumns() {
    const { columns, rows, chipsPositions, onTileClick } = this.props;
    const columnsComponents = []; for (let column = 0; column < columns; column++) {
      columnsComponents.push(
        <Column
          key={column}
          column={column}
          rows={rows}
          chipsPositions={chipsPositions}
          onTileClick={onTileClick}
        />
      );
    } return <>{columnsComponents}</>;
  } render() {
    return <div className={styles.board}>{this.renderColumns()}</div>;
  }
}
```

è¿™æ®µä»£ç ç±»ä¼¼äº**åˆ—**ç»„ä»¶çš„ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰åˆ›å»º**å—**ï¼Œè€Œæ˜¯åˆ›å»ºäº†å¤šä¸ªåˆ—ï¼Œå°†æ‰€éœ€çš„ä¿¡æ¯ä¼ é€’ç»™å®ƒä»¬ï¼Œç„¶åå‘ˆç°ç»“æœã€‚`this.renderColumns()`æ–¹æ³•å°è£…äº†è¿™ä¸ªé€»è¾‘ã€‚

> ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°æˆ‘ä»¬ä¹Ÿç”¨ Reactã€‚è¿™é‡Œæœ‰ç¢ç‰‡å—ï¼Ÿå¤§æ¦‚ä¸æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†ç®€å†™çš„â€œ`<></>â€, which is`ç›¸å½“äºâ€œ<çš„ Reactã€‚ç‰‡æ®µ></ååº”è¿‡æ¥ã€‚ç‰‡æ®µ>â€ã€‚

æœ€åï¼Œæ‰“å¼€**src/components/Board/Board . module . css**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ CSS ä»£ç :

```
.board {
  display: flex;
  flex-direction: row;
  border: solid 5px #002bff;
  border-radius: 5px;
  background-color: #3355ff;
}.columns {
  display: flex;
  flex-direction: row;
}
```

## åˆ›å»ºåº”ç”¨ç¨‹åºç»„ä»¶

æˆ‘ä»¬ç°åœ¨è¦ä¸ºæˆ‘ä»¬çš„æ¸¸æˆå¼€å‘ä¸»è¦çš„é€»è¾‘ã€‚ç‰¹åˆ«æ³¨æ„è¿™ä¸€èŠ‚

åœ¨ **src/components** æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º **App** çš„æ–‡ä»¶å¤¹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»º **App.module.css** æ–‡ä»¶ã€ **App.tsx** æ–‡ä»¶å’Œ **types.ts** æ–‡ä»¶ã€‚

æ‰“å¼€**src/components/App/types . ts**æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ç±»å‹:

```
export interface ChipsPositions {
  [key: string]: Player;
}export type Player = "red" | "yellow" | "";export interface Props {
  columns: number;
  rows: number;
}export interface State {
  chipsPositions: ChipsPositions;
  gameStatus: string;
  playerTurn: Player;
}
```

è¿™é‡Œçš„å®šä¹‰æ˜¯:

*   `ChipsPositions`å¯¹è±¡çš„å½¢çŠ¶:ä¸€ä¸ªå­—å…¸ï¼Œåœ¨æ¯ä¸ªä½ç½®åŒ…å«è¿™äº›`Player`ç±»å‹çš„å€¼ä¹‹ä¸€:`"red"`ã€`"yellow"`æˆ–`""` (ä»£è¡¨ä¸€ä¸ªç©ºå€¼)ã€‚
*   App çš„`Props`å’Œ`State`çš„å½¢çŠ¶ã€‚å‰è€…å‘Šè¯‰æˆ‘ä»¬éœ€è¦ä¸º **App** ç»„ä»¶æä¾›`columns`å’Œ`rows`çš„ç¼–å·è¿›è¡Œåˆå§‹åŒ–ï¼Œåè€…å‘Šè¯‰æˆ‘ä»¬ç»„ä»¶å°†å­˜å‚¨çš„æ‰€æœ‰ä¿¡æ¯ã€‚

ç°åœ¨ï¼Œæ‰“å¼€**src/components/App/App . tsx**å¹¶ç²˜è´´ä»¥ä¸‹ä»£ç :

```
import React from "react";
import Board from "../Board/Board";
import { Props, State, ChipsPositions } from "./types";
import styles from "./App.module.css";export default class App extends React.PureComponent<Props, State> {
  state: State = {
    chipsPositions: {},
    playerTurn: "red",
    gameStatus: "It's red's turn"
  }; calculateGameStatus = (playerTurn: string, chipsPositions: ChipsPositions): string => {
    // TODO
  }; handleTileClick = (tileId: string) => {
    // TODO
  }; renderBoard() {
    const { columns, rows } = this.props;
    const { chipsPositions } = this.state;
    return (
      <Board
        columns={columns}
        rows={rows}
        chipsPositions={chipsPositions}
        onTileClick={this.handleTileClick}
      />
    );
  } renderStatusMessage() {
    const { gameStatus } = this.state;
    return <div className={styles.statusMessage}>{gameStatus}</div>;
  } render() {
    return (
      <div className={styles.app}>
        {this.renderBoard()}
        {this.renderStatusMessage()}
      </div>
    );
  }
}
```

è¿™æ˜¯ç»„ä»¶çš„åŸºæœ¬ç»“æ„:ç»˜åˆ¶/å‘ˆç°**æ¿**å’Œ**çŠ¶æ€**æ¶ˆæ¯çš„è¡¨ç¤ºé€»è¾‘ï¼Œä»¥åŠé»˜è®¤çš„**åº”ç”¨**çš„çŠ¶æ€ã€‚è¿™æ®µä»£ç å®Œå…¨æ˜¯åŠŸèƒ½æ€§çš„ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸æ¸¸æˆè¿›è¡Œäº¤äº’ï¼Œåº”ç”¨ç¨‹åºä»ç„¶ä¸ä¼šåšå‡ºååº”ã€‚*æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„å‡ è¡Œ*ä¸­ç¼–å†™è¿™ä¸ªé€»è¾‘ã€‚

å®ç°`handleTileClick()`æ–¹æ³•ä»¥åœ¨ç”¨æˆ·ç‚¹å‡»**å›¾å—**æ—¶åšå‡ºååº”ã€‚

```
handleTileClick = (tileId: string) => {
  const { chipsPositions, playerTurn } = this.state; // Get the last empty tile of the column
  const column = parseInt(tileId.split(":")[1]);
  let lastEmptyTileId = this.getLastEmptyTile(column); // If there is no empty tile in the column, do nothing
  if (!lastEmptyTileId) {
    return;
  } // Add chip to empty tile
  const newChipsPositions = {
    ...chipsPositions,
    [lastEmptyTileId]: playerTurn
  }; // Change player turn
  const newPlayerTurn = playerTurn === "red" ? "yellow" : "red"; // Calculate game status
  const gameStatus = this.calculateGameStatus(newPlayerTurn, newChipsPositions); // Save new state
  this.setState({ chipsPositions: newChipsPositions, playerTurn: newPlayerTurn, gameStatus });
  };getLastEmptyTile(column: number) {
  const { rows } = this.props;
  const { chipsPositions } = this.state; for (let row = rows - 1; row >= 0; row--) {
    const tileId = `${row}:${column}`;

    if (!chipsPositions[tileId]) {
      return tileId;
    }
  }
}
```

èŠ±å‡ åˆ†é’Ÿæ—¶é—´ç†è§£ä»£ç çš„ä½œç”¨:

*   é¦–å…ˆï¼Œå®ƒéœ€è¦è¢«ç‚¹å‡»çš„åˆ—çš„æœ€åä¸€ä¸ªç©ºçš„**ç£è´´**ã€‚å®ƒé€šè¿‡è§£æ`tileId`è·å¾—åˆ—å·ã€‚
*   ç„¶åï¼Œå®ƒæ ¹æ®ç©å®¶çš„å›åˆå‘é€‰å®šçš„ç‰Œæ·»åŠ ä¸€ä¸ªç­¹ç ï¼Œè¿™ä»…ç”± **App** ç»„ä»¶çŸ¥é“ã€‚å®ƒä¼šé‡æ–°è®¡ç®—æ¸¸æˆçŠ¶æ€ã€‚
*   æœ€åï¼Œå®ƒå°†æ‰€æœ‰æ–°ä¿¡æ¯å­˜å‚¨åœ¨ç»„ä»¶çš„çŠ¶æ€ä¸­ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œå°±é‡æ–°å‘ˆç°æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚ *React ä¼šä¸ºæˆ‘ä»¬å†³å®šè¿™ä¸ª*ã€‚

æœ€åï¼Œé€šè¿‡å°†ä¸‹é¢çš„ä»£ç ç²˜è´´åˆ° **App** ç»„ä»¶ä¸­æ¥å®ç°`calculateGameStatus()`æ–¹æ³•ã€‚ä»£ç åŒ…å«å†³å®šè°æ˜¯èµ¢å®¶ï¼Œæˆ–è€…è°æ˜¯ä¸‹ä¸€ä¸ªç©å®¶çš„é€»è¾‘:

```
calculateGameStatus = (playerTurn: string, chipsPositions: ChipsPositions): string => {
  const { columns, rows } = this.props; // Check four in a row horizontally
  for (let row = 0; row < rows; row++) {
    let repetitionCountStatus = { playerChip: "", count: 0 }; for (let column = 0; column < columns; column++) {
      const chip = chipsPositions[`${row}:${column}`];

      // If there is a chip in that position, and belongs
      // to a player, count that chip for that player 
      // (either increase the count or start over)
      if (chip && chip === repetitionCountStatus.playerChip) {
        repetitionCountStatus.count++;
      } else {
        repetitionCountStatus = { playerChip: chip, count: 1 };
      } // If the count for a player is 4, that player won
      if (repetitionCountStatus.count === 4) {
         return `Player ${repetitionCountStatus.playerChip} won!`;
      }
    }
  } // Check four in a row vertically
  for (let column = 0; column < columns; column++) {
    let repetitionCountStatus = { playerChip: "", count: 0 };

    for (let row = 0; row < rows; row++) {
      const chip = chipsPositions[`${row}:${column}`]; // If there is a chip in that position, and belongs 
      // to a player, count that chip for that player
      // (either increase the count or start over)
      if (chip && chip === repetitionCountStatus.playerChip) {
        repetitionCountStatus.count++;
      } else {
        repetitionCountStatus = { playerChip: chip, count: 1 };
      } // If the count for a player is 4, that player won
      if (repetitionCountStatus.count === 4) {
        return `Player ${repetitionCountStatus.playerChip} won!`;
      }
    }
  } // TODO: Check four in a row diagonally

  return `It's ${playerTurn}'s turn`;
};
```

> ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªä»£ç æ²¡æœ‰æ£€æŸ¥å¯¹è§’çº¿ä¸Šå››ä¸ªè¿ç»­çš„ç›¸åŒå€¼çš„èŠ¯ç‰‡ï¼Ÿä½ èƒ½ä¸ºæ­¤æå‡ºä¸€ä¸ªå®ç°å—ï¼Ÿå¦‚æœæœ‰ï¼Œä½œä¸ºæ‹‰å–è¯·æ±‚å‘é€ç»™æˆ‘[ï¼](https://help.github.com/en/articles/creating-a-pull-request)

## æ­£åœ¨åˆå§‹åŒ–åº”ç”¨ç¨‹åº

æ‰“å¼€ **src/index.tsx** æ–‡ä»¶ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢å…¶å†…å®¹:

```
import React from "react";
import ReactDOM from "react-dom";
import App from "./components/App";
import "./index.css";// Initialize the app with 7 columns and 6 rows
ReactDOM.render(
  <App columns={7} rows={6} />, 
  document.getElementById("root")
);
```

é€šè¿‡åœ¨ç»ˆç«¯è¿è¡Œ`npm start`æ¥å¯åŠ¨åº”ç”¨ç¨‹åºã€‚

åœ¨æ–°æ‰“å¼€çš„æµè§ˆå™¨çª—å£ä¸­ï¼Œæ‰“å¼€**å¼€å‘è€…æ§åˆ¶å°**ï¼Œç„¶åç‚¹å‡»**ç»„ä»¶**æ ‡ç­¾ã€‚æ‚¨å°†çœ‹åˆ° React åº”ç”¨ç¨‹åºçš„å±‚æ¬¡æ ‘ï¼Œç”±æ‚¨åˆšåˆšåˆ›å»ºçš„ç»„ä»¶ç»„æˆ:

![](img/03e935413c40e7e8ad74e9345d78652b.png)

Connect Four app hierarchy tree in the Developer Console

ä¸€ç‚¹ç‚¹ç©æ¸¸æˆï¼Œå¾€æ£‹ç›˜é‡ŒåŠ å‡ ä¸ªç­¹ç ï¼Œç„¶ååœ¨å¼€å‘è€…æ§åˆ¶å°é‡ŒæŸ¥çœ‹æ£‹ç›˜ä¸åŒçš„**å¹³é“º**ã€‚è¯·æ³¨æ„ï¼Œæ”¶åˆ°çš„å±æ€§åœ¨æ‚¨ä¸å®ƒä»¬äº¤äº’åå‘ç”Ÿäº†å˜åŒ–ã€‚

![](img/f2c0d92ac0f7c882d9b9cb6cba06a097.png)

When you click on an empty tile, its chipType changes

> **æ³¨æ„:**ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å³è¾¹é¢æ¿ä¿®æ”¹é“å…·çš„å€¼æ¥æ”¹å˜é“å…·ã€‚é€šè¿‡å°†**ç‰Œ**çš„ç­¹ç ç±»å‹ä»`*"red"*`æˆ–`*undefined*`è½¬åˆ°`*"yellow"*`æ¥äº²è‡ªå°è¯•ã€‚

æ­å–œä½ ï¼æ‚¨åˆšåˆšç”¨ React å’Œ TypeScript åˆ›å»ºäº†æ‚¨çš„ç¬¬ä¸€ä¸ªæ¸¸æˆğŸ’ªğŸ’ªğŸ’ª

## åŒ…æ‰

åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å­¦åˆ°äº†ä»¥ä¸‹å†…å®¹:

*   å¦‚ä½•ä½¿ç”¨ React å’Œ TypeScript ä»å¤´å¼€å§‹åˆ›å»ºåº”ç”¨ç¨‹åºã€‚
*   å¦‚ä½•æŠŠä½ çš„ app çš„ä¸šåŠ¡é€»è¾‘æ‹†åˆ†æˆå°ç»„ä»¶ï¼Ÿ
*   å¦‚ä½•é€šè¿‡é“å…·å‘é€ä¿¡æ¯å’Œé€šçŸ¥ç”¨æˆ·äº‹ä»¶ï¼Ÿ
*   å¦‚ä½•ä½¿ç”¨ React å¼€å‘äººå‘˜å·¥å…·æ¥å¯è§†åŒ–æ‚¨çš„åº”ç”¨ç¨‹åºçš„ç»„ä»¶æ ‘åŠå…¶çŠ¶æ€ã€‚

ğŸ‰ğŸ‰

> è®°ä½ä½ å¯ä»¥åœ¨ [**è¿™ä¸ª GitHub èµ„æºåº“**](https://github.com/nanovazquez/reactjs-training) æ‰¾åˆ°å®Œæ•´çš„åŸ¹è®­ã€‚