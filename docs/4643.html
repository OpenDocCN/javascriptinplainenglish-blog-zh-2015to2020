<html>
<head>
<title>Add Size Limit to GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向GitHub操作添加大小限制</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-size-limit-to-github-actions-551c8fe9e7d7?source=collection_archive---------13-----------------------#2020-12-27">https://javascript.plainenglish.io/add-size-limit-to-github-actions-551c8fe9e7d7?source=collection_archive---------13-----------------------#2020-12-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d35a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇文章讲述了如何将JavaScript的性能预算工具<a class="ae ki" href="https://github.com/ai/size-limit" rel="noopener ugc nofollow" target="_blank">大小限制</a>添加到<a class="ae ki" href="https://b.remarkabl.org/github-actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>中。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/43204db4cfabe222f675d030db81fb75.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*EKKLnv3qoSzerOm9llJJHA.png"/></div></div></figure><h1 id="a8c4" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">设置</h1><p id="29b4" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">安装<code class="fe ly lz ma mb b"><a class="ae ki" href="https://www.npmjs.com/package/size-limit" rel="noopener ugc nofollow" target="_blank">size-limit</a></code>:</p><pre class="kk kl km kn gt mc mb md me aw mf bi"><span id="dfce" class="mg kw in mb b gy mh mi l mj mk">$ npm install --save-dev size-limit</span></pre><p id="9959" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行<code class="fe ly lz ma mb b">size-limit</code>二进制文件以获取消息:</p><pre class="kk kl km kn gt mc mb md me aw mf bi"><span id="60ea" class="mg kw in mb b gy mh mi l mj mk">$ npx size-limit<br/>Install Size Limit preset depends on type of the project</span><span id="123f" class="mg kw in mb b gy ml mi l mj mk">For application, where you send JS bundle directly to users<br/>  npm install --save-dev @size-limit/preset-app</span><span id="df44" class="mg kw in mb b gy ml mi l mj mk">For frameworks, components and big libraries<br/>  npm install --save-dev @size-limit/preset-big-lib</span><span id="0fc3" class="mg kw in mb b gy ml mi l mj mk">For small (&lt; 10 KB) libraries<br/>  npm install --save-dev @size-limit/preset-small-lib</span><span id="13a6" class="mg kw in mb b gy ml mi l mj mk">Check out docs for more complicated cases<br/>  <a class="ae ki" href="https://github.com/ai/size-limit/" rel="noopener ugc nofollow" target="_blank">https://github.com/ai/size-limit/</a></span></pre><p id="8312" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们的例子中，我们将安装大库预置<code class="fe ly lz ma mb b"><a class="ae ki" href="https://www.npmjs.com/package/@size-limit/preset-big-lib" rel="noopener ugc nofollow" target="_blank">@size-limit/preset-big-lib</a></code>:</p><pre class="kk kl km kn gt mc mb md me aw mf bi"><span id="0968" class="mg kw in mb b gy mh mi l mj mk">$ npm install --save-dev @size-limit/preset-big-lib</span></pre><p id="6f4a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">再次运行<code class="fe ly lz ma mb b">size-limit</code>得到错误:</p><pre class="kk kl km kn gt mc mb md me aw mf bi"><span id="b562" class="mg kw in mb b gy mh mi l mj mk">$ npx size-limit<br/> ERROR  Create Size Limit config in package.json</span><span id="156b" class="mg kw in mb b gy ml mi l mj mk">  "size-limit": [<br/>    {<br/>      "path": "dist/bundle.js",<br/>      "limit": "10 KB"<br/>    }<br/>  ]</span></pre><h1 id="0b3a" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">配置</h1><p id="4445" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated"><a class="ae ki" href="https://github.com/ai/size-limit#config" rel="noopener ugc nofollow" target="_blank">配置</a>选项有:</p><ul class=""><li id="3203" class="mm mn in jm b jn jo jr js jv mo jz mp kd mq kh mr ms mt mu bi translated"><code class="fe ly lz ma mb b">path</code> : <strong class="jm io">路径</strong>到你的捆绑</li><li id="e8b4" class="mm mn in jm b jn mv jr mw jv mx jz my kd mz kh mr ms mt mu bi translated"><code class="fe ly lz ma mb b">limit</code> : <strong class="jm io">您捆绑的大小</strong>(如<code class="fe ly lz ma mb b">42 B</code>、<code class="fe ly lz ma mb b">1337 KB</code>)或<strong class="jm io">时限</strong>(如<code class="fe ly lz ma mb b">314 ms</code>、<code class="fe ly lz ma mb b">1.618 s</code>)</li></ul><h2 id="79d4" class="mg kw in bd kx na nb dn lb nc nd dp lf jv ne nf lj jz ng nh ln kd ni nj lr nk bi translated">例子</h2><p id="015b" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">如果您的包路径是<code class="fe ly lz ma mb b">build/my-bundle.js</code>并且您不希望您的包超过<code class="fe ly lz ma mb b">9000</code>字节，那么将以下内容添加到您的<code class="fe ly lz ma mb b">package.json</code>中:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="f3a7" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">成功</h1><p id="ed85" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated"><code class="fe ly lz ma mb b">size-limit</code>的成功消息如下所示:</p><pre class="kk kl km kn gt mc mb md me aw mf bi"><span id="8daa" class="mg kw in mb b gy mh mi l mj mk">$ npx size-limit<br/>✔ Adding to empty webpack project<br/>✔ Running JS in headless Chrome</span><span id="8562" class="mg kw in mb b gy ml mi l mj mk">  Size limit:   8.79 KB<br/>  Size:         8.69 KB with all dependencies, minified and gzipped<br/>  Loading time: 50 ms   on slow 3G<br/>  Running time: 60 ms   on Snapdragon 410<br/>  Total time:   110 ms</span></pre><h1 id="688e" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">失败</h1><p id="e8e6" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated"><code class="fe ly lz ma mb b">size-limit</code>的失败消息如下所示:</p><pre class="kk kl km kn gt mc mb md me aw mf bi"><span id="0b0f" class="mg kw in mb b gy mh mi l mj mk">$ npx size-limit<br/>✔ Adding to empty webpack project<br/>✔ Running JS in headless Chrome</span><span id="beed" class="mg kw in mb b gy ml mi l mj mk">  Package size limit has exceeded by 1 KB<br/>  Size limit:   8.79 KB<br/>  Size:         9.79 KB with all dependencies, minified and gzipped<br/>  Loading time: 50 ms   on slow 3G<br/>  Running time: 70 ms   on Snapdragon 410<br/>  Total time:   120 ms</span><span id="bc34" class="mg kw in mb b gy ml mi l mj mk">  Try to reduce size or increase limit at .size-limit.json</span></pre><h1 id="fd05" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">GitHub操作</h1><p id="6b49" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">创建使用<a class="ae ki" href="https://github.com/marketplace/actions/size-limit-action" rel="noopener ugc nofollow" target="_blank">尺寸限制动作</a>的<code class="fe ly lz ma mb b">.github/workflows/size-limit.yml</code>:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="1f71" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加工作流的初始PR (pull request)将会失败，因为该操作试图与没有添加<code class="fe ly lz ma mb b">size-limit</code>的基本分支进行比较(参见<a class="ae ki" href="https://github.com/andresz1/size-limit-action/issues/33" rel="noopener ugc nofollow" target="_blank"> #33 </a>)。</p><p id="c474" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦<code class="fe ly lz ma mb b">size-limit</code>打开<code class="fe ly lz ma mb b">master</code>，所有新创建的PR将测量束尺寸/性能。</p><p id="b79a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参见<a class="ae ki" href="https://github.com/remarkablemark/html-react-parser/pull/197" rel="noopener ugc nofollow" target="_blank">添加该工作流程的示例PR </a>。</p></div><div class="ab cl nn no hr np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ig ih ii ij ik"><p id="3733" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://b.remarkabl.org/2Kv374v" rel="noopener ugc nofollow" target="_blank"> <em class="nu">本文原载于2020年12月20日《remarkablemark.org》。</em>T3】</a></p></div></div>    
</body>
</html>