<html>
<head>
<title>Error handling in Express.js applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Express.js应用程序中的错误处理</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/error-handling-for-express-js-applications-a26a3002ef82?source=collection_archive---------10-----------------------#2020-05-05">https://javascript.plainenglish.io/error-handling-for-express-js-applications-a26a3002ef82?source=collection_archive---------10-----------------------#2020-05-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f38f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在express应用程序中处理错误可能比构建web应用程序和API更具挑战性</h2></div><p id="8a13" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用express.js构建web应用或API在我看来并不难。我认为更难的是正确处理错误、错误状态码和错误消息。下面，我将列出一些我在express.js应用程序中处理错误的技巧。</p><p id="99be" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想应用我将要建议的技术，我们需要理解中间件来处理错误。简单地说，express中的中间件是一种可以访问特定路由的请求和响应对象的功能。此外，它们接受一个参数<strong class="ke io"> next </strong>，这是一个在中间件功能执行后被调用的功能。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="ld le l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Middleware example</figcaption></figure><p id="5210" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的例子中，如果你发送一个get请求给<em class="lj">/some route</em>route‘请求已发出’将被记录在控制台上。</p><h2 id="0087" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">控制器和中间件</h2><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/bf876a0f2b4d6e9d379073be6148cdf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l2TQeHYVqpZgjcEqC30VNg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Controllers and Middlewares</figcaption></figure><p id="8a19" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上图解释了什么是控制器，什么是中间件。当在特定路由上接收到请求时，在调用该路由的控制器之前，中间件1、2和3被调用。控制器然后可以发送响应。但是，中间件功能也可以访问响应对象，中间件也可以发送响应并关闭请求。所以，你可以假设任何中间件都是控制器，任何控制器都是中间件。</p><p id="4cea" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，可以创建一个验证jwt的中间件功能。中间件将验证令牌是否有效。如果无效，中间件将向客户端发回错误响应并关闭请求。在这种情况下，JWT验证中间件之后的中间件/控制器将不会被调用。</p><h2 id="8d3b" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">项目结构</h2><p id="391b" class="pw-post-body-paragraph kc kd in ke b kf mk jo kh ki ml jr kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">Express是一个非个人化的web框架，用于使用Node.JS构建web应用程序。因为它是一个非个人化的web框架，所以框架创建者并不严格推荐用于组织项目的目录结构。下面，我将向您展示我的项目结构的截图，您可以按照它来组织您的项目，但是，如果感觉合适，您也可以按照您自己的结构来组织。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/6f249f98d16b70a9ca5dfd7123bff3c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*4giy3gvBa0c6szlo0aZPrw.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Project Structure</figcaption></figure><h2 id="b773" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">函数来创建错误对象</h2><p id="b103" class="pw-post-body-paragraph kc kd in ke b kf mk jo kh ki ml jr kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">在<em class="lj"> utils/createError.js </em>文件中，我有一个函数，它接受两件事:一个状态代码和一个错误消息，并返回一个错误对象。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="ld le l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk"><strong class="ak">utils/createError.js</strong></figcaption></figure><h1 id="87dd" class="mq ll in bd lm mr ms mt lp mu mv mw ls jt mx ju lv jw my jx ly jz mz ka mb na bi translated">app.js中的集中式错误处理程序</h1><p id="425f" class="pw-post-body-paragraph kc kd in ke b kf mk jo kh ki ml jr kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">这是这个故事的主要部分。我们将创建一个中间件函数，它可以接受错误对象，如果收到错误，它可以向发出请求的客户端发送错误响应。为此，我们将创建两个中间件功能。如果上面的路由都没有被调用，一个中间件将被触发，如果任何一个中间件/控制器出错，另一个将被触发。</p><p id="cb2f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的app.js的结构如下所示。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="ld le l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Middleware functions</figcaption></figure><p id="d7ae" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一般来说，所有的错误都有一个消息属性，所以你可以相信在我们的错误处理中间件中会有一个包含错误对象的消息。如果没有，那么默认情况下“将发送内部服务器错误”</p><h2 id="7e5d" class="lk ll in bd lm ln lo dn lp lq lr dp ls kl lt lu lv kp lw lx ly kt lz ma mb mc bi translated">如何利用我们的集中式错误处理程序触发错误？</h2><p id="429b" class="pw-post-body-paragraph kc kd in ke b kf mk jo kh ki ml jr kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">假设您有一个让用户登录应用程序的控制器。这里的示例将展示一个高级实现示例。在这个故事的底部，我将添加一个快速应用程序的GitHub库，其中将包括所有这些应用于一个真实项目。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="ld le l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Login and error handling example</figcaption></figure><p id="8c99" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是在express.js应用程序中应用错误处理实践的方法。</p><p id="3af8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想看一个应用了所有这些的项目，去这个<a class="ae nb" href="https://github.com/prashantacharya/idea-submission" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>看看代码的运行。</p><p id="d160" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读。我也为我自己的网站<a class="ae nb" href="https://bigomega.dev." rel="noopener ugc nofollow" target="_blank">写内容。你可以订阅我的时事通讯。</a></p><h1 id="7c26" class="mq ll in bd lm mr ms mt lp mu mv mw ls jt mx ju lv jw my jx ly jz mz ka mb na bi translated"><strong class="ak">用简单英语写的便条</strong></h1><p id="7afb" class="pw-post-body-paragraph kc kd in ke b kf mk jo kh ki ml jr kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">你知道我们有四份出版物和一个YouTube频道吗？你可以在我们的主页<a class="ae nb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> plainenglish.io </strong> </a>找到所有这些内容——关注我们的出版物并<a class="ae nb" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io">订阅我们的YouTube频道</strong> </a> <strong class="ke io">来表达你的爱吧！</strong></p></div></div>    
</body>
</html>