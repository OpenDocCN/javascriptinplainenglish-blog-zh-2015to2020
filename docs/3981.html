<html>
<head>
<title>Jasmine — Spies and Matchers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">茉莉——间谍和媒人</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/jasmine-spies-and-matchers-6338ec628a92?source=collection_archive---------6-----------------------#2020-11-07">https://javascript.plainenglish.io/jasmine-spies-and-matchers-6338ec628a92?source=collection_archive---------6-----------------------#2020-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3a5574cfae7f703545d6d394cca7f861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1e7DQwl3-Iz7wAGG"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@pharmahempcomplex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pharma Hemp Complex</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8bc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试是JavaScript的一个重要部分。</p><p id="6eb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Jasmine创建更复杂的测试。</p><h1 id="05df" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">createSpy</code></h1><p id="fffe" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以调用<code class="fe lz ma mb mc b">createSpy</code>来存根一个函数。</p><p id="37cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们可以用来跟踪争论。</p><p id="5a46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="a225" class="mq lc iq mc b gy mr ms l mt mu">describe("A spy", function () {<br/>  let spy;</span><span id="8808" class="mq lc iq mc b gy mv ms l mt mu">  beforeEach(function () {<br/>    spy = jasmine.createSpy('spy');<br/>    spy('foo', 'bar');<br/>  });</span><span id="047a" class="mq lc iq mc b gy mv ms l mt mu">  it("tracks that the spy was called", function () {<br/>    expect(spy).toHaveBeenCalled();<br/>  });<br/>});</span></pre><p id="0643" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe lz ma mb mc b">jasmine.createSpy</code>创造了一个间谍。</p><p id="fa08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一个可以用Jasmine观看的函数。</p><p id="8088" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样我们就可以检查它是否已经用<code class="fe lz ma mb mc b">toHaveBeenCalled</code>调用过了。</p><h1 id="8588" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">createSpyObj</code></h1><p id="1757" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">createSpyObj</code>方法创建一个有多个间谍的模拟。</p><p id="a19c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="8f20" class="mq lc iq mc b gy mr ms l mt mu">describe("Multiple spies", function () {<br/>  let person;</span><span id="8c89" class="mq lc iq mc b gy mv ms l mt mu">  beforeEach(function () {<br/>    person = jasmine.createSpyObj('person', ['eat', 'drink', 'sleep', 'walk']);<br/>    person.eat();<br/>    person.drink();<br/>    person.sleep(0);<br/>    person.walk(0);<br/>  });</span><span id="18ac" class="mq lc iq mc b gy mv ms l mt mu">  it("creates spies for each requested function", function () {<br/>    expect(person.eat).toBeDefined();<br/>    expect(person.drink).toBeDefined();<br/>    expect(person.sleep).toBeDefined();<br/>    expect(person.walk).toBeDefined();<br/>  });<br/>});</span></pre><p id="2ee8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用间谍名作为第一个参数调用了<code class="fe lz ma mb mc b">createSpyObj</code>。</p><p id="7d80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以及第二个参数中的spy对象中可用的方法。</p><p id="cf17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以检查这些方法是否被定义</p><h1 id="748e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">匹配和间谍</h1><p id="822d" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以添加更多匹配的支票。</p><p id="e172" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="311b" class="mq lc iq mc b gy mr ms l mt mu">describe("Tests", function () {<br/>  it("matches any value", function () {<br/>    expect({}).toEqual(jasmine.any(Object));<br/>    expect(12).toEqual(jasmine.any(Number));<br/>  });</span><span id="e9a6" class="mq lc iq mc b gy mv ms l mt mu">  describe("when used with a spy", function () {<br/>    it("is useful for comparing arguments", function () {<br/>      const foo = jasmine.createSpy('foo');<br/>      foo(12, () =&gt; true);<br/>      expect(foo).toHaveBeenCalledWith(jasmine.any(Number), jasmine.any(Function));<br/>    });<br/>  });<br/>});</span></pre><p id="e5dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">toEqual</code>来检查带有<code class="fe lz ma mb mc b">jasmine.any</code>的值的类型。</p><p id="99af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">jasmine.any</code>和<code class="fe lz ma mb mc b">toHaveBeenCalledWith</code>来检查是否调用了一个带有给定数据类型的间谍。</p><h1 id="08bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">茉莉，什么都行</h1><p id="7d78" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">jasmine.anythibng</code>来检查某个东西是否匹配不属于<code class="fe lz ma mb mc b">null</code>或<code class="fe lz ma mb mc b">undefined</code>的任何东西。</p><p id="800f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="896f" class="mq lc iq mc b gy mr ms l mt mu">describe("jasmine.anything", function () {<br/>  it("matches anything", function () {<br/>    expect(1).toEqual(jasmine.anything());<br/>  });</span><span id="08d2" class="mq lc iq mc b gy mv ms l mt mu">  describe("when used with a spy", function () {<br/>    it("is useful when the argument can be ignored", function () {<br/>      const foo = jasmine.createSpy('foo');<br/>      foo(12, 'bar');<br/>      expect(foo).toHaveBeenCalledWith(12, jasmine.anything());<br/>    });<br/>  });<br/>});</span></pre><p id="6640" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe lz ma mb mc b">jasmine.anything()</code>调用来检查是否有任何东西不是<code class="fe lz ma mb mc b">null</code>或<code class="fe lz ma mb mc b">undefined</code>。</p><h1 id="9c41" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查对象结构</h1><p id="4cf4" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用<code class="fe lz ma mb mc b">jasmine.objectContaining</code>方法检查对象结构。</p><p id="ce91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="a5d7" class="mq lc iq mc b gy mr ms l mt mu">describe("jasmine.objectContaining", function () {<br/>  let foo;</span><span id="717c" class="mq lc iq mc b gy mv ms l mt mu">  beforeEach(function () {<br/>    foo = {<br/>      a: 1,<br/>      b: 2,<br/>      bar: "baz"<br/>    };<br/>  });</span><span id="d44c" class="mq lc iq mc b gy mv ms l mt mu">  it("matches objects with key-value pairs", function () {<br/>    expect(foo).toEqual(jasmine.objectContaining({<br/>      a: 1, bar: "baz"<br/>    }));<br/>  });</span><span id="394b" class="mq lc iq mc b gy mv ms l mt mu">  describe("when used with a spy", function () {<br/>    it("is useful for comparing arguments", function () {<br/>      const callback = jasmine.createSpy('callback');</span><span id="4526" class="mq lc iq mc b gy mv ms l mt mu">      callback({<br/>        bar: "baz"<br/>      });</span><span id="3e50" class="mq lc iq mc b gy mv ms l mt mu">      expect(callback)<br/>        .toHaveBeenCalledWith(<br/>          jasmine.objectContaining({<br/>            bar: "baz"<br/>          })<br/>        );<br/>    });<br/>  });<br/>});</span></pre><p id="a6e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe lz ma mb mc b">jasmine.objectContaining</code>方法来观察对象结构。</p><p id="0463" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是传入想要检查的键值对。</p><p id="c3ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它可以与值和函数参数一起使用。</p><h1 id="bc04" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="32b3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用各种Jasmine方法检查值和对象，并监视间谍。</p><p id="e6a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>