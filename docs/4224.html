<html>
<head>
<title>Creating A WordPress Login In React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native中创建WordPress登录</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/wordpress-login-in-react-native-3bee73c7537a?source=collection_archive---------2-----------------------#2020-11-26">https://javascript.plainenglish.io/wordpress-login-in-react-native-3bee73c7537a?source=collection_archive---------2-----------------------#2020-11-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/37dad0896569f2274e54513c46c2fb1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ki9c5EyrMwp_jUimPyQgkw.png"/></div></div></figure><p id="6089" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们最近的一个项目中，我们的客户要求我们提供一个应用程序，作为他们产品技术表单的前端。他们已经将内容和用户存储在WordPress站点中(内容使用自定义帖子),他们不想转移到其他平台，因为创建一个新的后端接口来添加数据和用户(例如，如果转移到firebase)太费钱了，还因为他们的团队已经知道如何管理WordPress。</p><p id="5483" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其他要求是，内容只对注册和登录的用户(有访问级别)可用，并且登录应该是持久的；所以我们的第一个任务是在React Native中实现一个登录WordPress站点的系统。</p><p id="64bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是React中我们的WordPress登录系统的简化版本。</p><p id="17b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想继续学习本教程，您可以在<a class="ae kw" href="https://github.com/popeating/wp-login" rel="noopener ugc nofollow" target="_blank">https://github.com/popeating/wp-login</a>克隆项目的存储库</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="15a5" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">我们要开发什么</h2><p id="a261" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">一个简单的登录界面，使用电子邮件和密码将登录到一个远程WordPress网站，并将在设备上存储一些登录数据的持久性。<br/>我们还将实现PHP登录脚本，该脚本将被添加到Worpdress中，以处理来自应用程序的登录请求。</p><h2 id="a490" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">警告信息</h2><p id="1ff5" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">应用程序和PHP文件都是生产就绪文件的简化版本，它们没有考虑很多安全方面(尤其是PHP文件)，也没有处理它们可能遇到的所有错误。总之，它们只是演示了用React Native实现远程WordPress站点的登录是多么容易</p><h2 id="36d5" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">概念</h2><p id="d363" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们基本上要做的是创建一个WordPress登录脚本(在PHP中)，该脚本将接受电子邮件和密码作为POST输入，然后将使用它们在WordPress中进行身份验证，如果身份验证成功，我们将创建一个用户令牌，将其存储在用户元中(供将来使用)，并将用户数据和令牌发送回应用程序。该应用程序将如下工作:在启动时，它将检查用户是否存储在设备中，如果是，我们假设登录状态(或在更安全的情况下，我们根据WordPress重新检查数据)，如果用户没有存储在设备上，我们将提交一个登录表单，该表单将发布到我们创建的WordPress脚本，一旦PHP登录响应，我们将获得响应数据，并且(如果用户正确认证)我们存储用户数据并将设备设置为已登录，否则我们会显示一个错误。如果设备已登录(来自登录表单或设备数据)，我们向用户显示登录屏幕。</p><h2 id="012b" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">我们将跟随的一步</h2><p id="a9d9" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">首先，我们将在WordPress上工作:</p><ul class=""><li id="1c9c" class="mc md iq ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">保护WordPress的访问权限，并且仅限于已登录的用户</li><li id="ec9f" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">编写一个用于认证的小PHP</li></ul><p id="8629" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们将设置我们的应用程序:</p><ul class=""><li id="b912" class="mc md iq ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">使用Expo创建应用程序(但即使没有它也能工作)</li><li id="31a1" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">安装我们将在应用程序中使用的模块和依赖项</li><li id="820d" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">定义我们将要使用的组件</li><li id="fdf7" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">编写函数</li><li id="6a31" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">把一切都包起来</li></ul><h2 id="1a51" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">WordPress部分</h2><p id="472a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">首先，我们将禁止除登录用户之外的所有用户访问WordPress，如果你只是想让WordPress只被应用程序访问，这可能会更加严格</p><p id="f3ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将functions.php的这段代码放在你的主题文件夹中</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="4284" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们将创建一个新的PHP文件(我们称之为wp-react-login.php ),我们把它放在WordPress根文件夹中，如前所述，这个文件不能被认为是安全的:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="44fb" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">应用程序部分</h2><p id="8f91" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们开始使用Expo构建我们的应用程序(但是我们也可以使用npm create-react-app):</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="9972" class="le lf iq mx b gy nb nc l nd ne">expo-init wp-login</span></pre><p id="5b37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们安装了一些我们将要使用的模块:<a class="ae kw" href="https://reactnavigation.org/" rel="noopener ugc nofollow" target="_blank"> React Navigation </a>，<a class="ae kw" href="https://callstack.github.io/react-native-paper/" rel="noopener ugc nofollow" target="_blank"> React Native Paper </a>(为了便于样式化)，AsyncStrorage(保存/读取设备):</p><pre class="mq mr ms mt gt mw mx my mz aw na bi"><span id="794f" class="le lf iq mx b gy nb nc l nd ne">npm install react-native-paper<br/>npm install <a class="ae kw" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-navigation/native<br/>npm install <a class="ae kw" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-navigation/stack<br/>//navigation dependencies<br/>expo install react-native-gesture-handler react-native-reanimated react-native-screens react-native-safe-area-context <a class="ae kw" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-native-community/masked-view</span></pre><p id="a685" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦一切都设置好了，我们进入项目文件夹，我们创建3个新文件夹:组件(我们将存储我们的屏幕组件)，上下文(我们将在这里保存上下文文件)，常量(杂项文件，喜欢配置)，树应该看起来像这样:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/5a2fa77bedc9cca9b37493f84117dd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvhFASKcsrRCxcDi3vXfQw.png"/></div></div></figure><p id="afdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我们将在组件之间共享数据(用户状态、应用状态、用户数据),而不是在组件之间来回传递属性，所以我们使用上下文:</p><p id="a3dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上下文文件夹中创建一个新文件，并将其命名为Context.js</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="f4a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该文件稍后将被导入App.js，并用于包装所有子组件，以便它们共享上下文中的所有内容；doSome()函数这只是一个虚拟函数，我用它来检查一切是否正常。</p><p id="25fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在const文件夹中创建了一个const.js，此时我们只在文件中保存了WordPress登录脚本的URL。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c28e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在组件中创建两个空文件Home.js和Login.js，它们将作为我们的屏幕:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="a8a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以开始构建我们的App.js. <br/>首先是所需的导入，除了标准和导航导入，我们还导入我们的const、我们的组件和上下文:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="3ba8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这之后，我们开始编码，在useState的帮助下，我们设置了一些可以在以后使用的状态:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="1fb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，当运行应用程序时，我们希望检查用户是否登录(即。在设备上具有简档数据)；我们可以使用useEffect和AsyncStorage来实现它，这是非常基本的，并且假设如果我在设备上有数据，我就登录，当然，可以通过检查存储的令牌在服务器上是否仍然有效来改进它(例如，我们可以让登录在一段时间后过期，或者站点管理员可能删除了用户)。在此过程中，我们将isLoading状态设置为true，在结束时，其他状态会根据状态进行更改。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="8fdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要一个登录函数和一个注销函数。最简单的是注销，我们只需要从存储器中删除条目并重置一些状态(比如清空用户配置文件)，我们也可以做一些远程操作(比如从WordPress上的用户meta中删除令牌，或者在用户meta上保存执行的时间和操作)。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="5954" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录只是稍微复杂一点，因为我们需要与服务器通信，并根据回复保存或不保存异步存储；我们还需要跟踪过程中可能发生的一些错误。在任何情况下，登录基本上都是设置或取消登录状态。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="f4e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一部分是通过我们的上下文“公开”所有的状态和功能，这样我们就可以在children组件中访问它们(稍后将详细介绍)。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="90c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是渲染的时候了，使用状态我们可以有条件地渲染代码片段，向正确的用户显示正确的“屏幕”。开始时，应用程序将状态isLoading设置为true，当应用程序(通过useEffect钩子)检查异步存储时，保持该状态；即使这几乎是即时的，当应用程序加载时，我们使用这段代码来呈现一个旋转的轮子:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="bc35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦isLoading被设置为false(在useEffect hook的末尾)，我们就可以向用户显示一个基于其状态的“真实”界面:如果注销，则显示一个登录表单，如果登录，则显示一个欢迎回来的屏幕；这可以通过条件渲染来实现；此外，该代码包含在上下文中，因此所有子组件都将访问上下文本身中定义的对象、变量和函数:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="17da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，我们只缺少登录和主页组件。</p><p id="514a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两个组件都非常基础，都“导入”上下文(因此它们可以访问上下文数据)，登录将呈现一个2字段表单，按下按钮doLogin(在App.js中)将被执行。该表单在登录过程中被禁用(通过登录状态)，如果状态错误有一些值，将出现一个错误文本。</p><div class="mq mr ms mt gt ab cb"><figure class="ng jr nh ni nj nk nl paragraph-image"><img src="../Images/a08a3d4a70b5baaa189c347bde51a69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*jJqPlQ-kKl5gVMHbRTLOdw.png"/></figure><figure class="ng jr nh ni nj nk nl paragraph-image"><img src="../Images/a4c36cb464dc9fdaec024ac375b15a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*vss9Xw_7TpFicG9GyUavyQ.png"/></figure></div><p id="a1d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录呈现在几个组件里面:<em class="nm">touchablewithoutbeedback</em>和<em class="nm"> KeyboardAvoidingView </em>第一个组件有一个附加的动作，允许在屏幕上点击时关闭键盘，第二个组件允许表单移动而不被键盘覆盖。它们都是标准的本地组件</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="d8a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Home组件甚至更简单，它显示了一些用户数据(从userProfile状态获得)和一个执行App.js doLogout函数的注销按钮。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8ef8c9427c02f98a9e95d4f56daa2797.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*x86hCRVYUMOVK_yd4F4uOw.png"/></div></figure><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="b1fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">下一步是什么</strong></p><p id="15b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果内容仅针对经过身份验证的用户，我们可以考虑一种请求数据的机制，该机制将检查用户是否拥有令牌，以及令牌是否与有权阅读特定内容的用户相关联，等等。在我们的例子中，来自经过身份验证的用户的所有请求都会在请求的有效负载中包含令牌，因此在后端，根据令牌(我们从中派生出用户)我们可以决定用户可以看到或不能看到的内容，在所有情况下，如果令牌丢失，您总是会看到登录屏幕。<br/>我们还实现了令牌过期和管理令牌刷新，如果用户拥有令牌，则不会自动进行身份验证(如示例所示),而是对令牌进行检查和重新验证。我们还在设备上存储来自远程服务器的一些内容(不会经常改变的内容，例如，一些类别)。</p><p id="f6e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更多登录方式</strong></p><p id="529f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您对使用远程服务实现登录的更多方法感兴趣吗？<br/>check out<strong class="ka ir">React Native:Firebase email authentic ation in a Expo project</strong>=&gt;<a class="ae kw" href="https://medium.com/react-native-playground/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890" rel="noopener">https://medium . com/React-Native-playground/React-Native-Firebase-email-authenticaton-in-an-Expo-project-2e 413 e 9 a 4890</a>和<strong class="ka ir">添加</strong><strong class="ka ir">Google log in to Firebase in Expo project</strong>=&gt;<a class="ae kw" href="https://medium.com/react-native-playground/react-native-firebase-adding-google-authenticaton-in-an-expo-project-2-ed20cb440732" rel="noopener">https://medium . com/@ popeating/React-Native-Firebase-Firebase</a></p></div></div>    
</body>
</html>