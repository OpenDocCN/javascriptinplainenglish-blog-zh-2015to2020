<html>
<head>
<title>How I dealt with over 30,000 ESLint errors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何处理超过30，000个ESLint错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-i-dealt-with-over-30-000-eslint-errors-640472eecc0?source=collection_archive---------8-----------------------#2020-09-30">https://javascript.plainenglish.io/how-i-dealt-with-over-30-000-eslint-errors-640472eecc0?source=collection_archive---------8-----------------------#2020-09-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b5d6" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">ESLint —迁移到综合配置</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8f09b0ee70535db2c75a546a7de6b6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VhyWoGLtpWlvIeoq"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@rofotoqoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Rohan Reddy</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="472a" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的旅程</h1><p id="0c29" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">当我第一次了解ESLint 的时候，我非常兴奋能够在我的代码库中启用它。我渴望获得支持ESLint的代码库提供的所有好处。然而，这涉及到相当密集的迁移，以将我的代码库升级到我的ESLint配置标准。这是我的经历。</p><h1 id="adf6" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的配置</h1><p id="9f3e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我研究了很多，并最终决定采用这种配置。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="93cd" class="mm ku in mi b gy mn mo l mp mq">module.exports = {<br/>  extends: [<br/>    'airbnb',<br/>    'airbnb/hooks',<br/>    'plugin:jest/recommended',<br/>    'plugin:jest/style',<br/>    'plugin:prettier/recommended',<br/>    'plugin:testing-library/react',<br/>    'prettier/react',<br/>  ],<br/>};</span></pre><p id="a7e7" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated"><a class="ae ks" href="https://www.npmjs.com/package/eslint-config-airbnb" rel="noopener ugc nofollow" target="_blank"> Airbnb的ESLint </a>似乎是Javascript社区中事实上的编码标准，自从我开始使用React Hooks以来，我也包括了Airbnb的Hooks规则。我使用了<a class="ae ks" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>和<a class="ae ks" href="https://testing-library.com/docs/react-testing-library/intro" rel="noopener ugc nofollow" target="_blank"> React测试库</a>，所以包含他们推荐的ESLint配置是有意义的。最后，我加入了更漂亮的T8和T9，因为我听说了关于它如何从根本上消除了思考和担心代码格式的需求的好消息。</p><h1 id="8460" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">移民</h1><p id="efbd" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">有了这个配置，我第一次运行了ESLint。哦，天啊，我的肚子上挨了一拳。我的代码库有超过30，000个错误！我做了什么！？</p><p id="38d2" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">经过几分钟的震惊、怀疑和后悔我的主动，我运行了ESLint的自动修复。这次我只有大约5000个错误。嗯，这样好多了。自动修复修复了25，000个错误，但我仍然有大量的问题需要手动解决。</p><h1 id="fed6" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">关闭规则</h1><p id="a33b" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在这一点上，我只需要坐下来一个一个地解决它们。我首先列出了每一条被违反的规则。然后，我把所有这些规则都关掉了。就这样——我通过了棉绒！</p><p id="7fe4" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">不完全是。虽然我的代码看起来不错，因为ESLint没有抛出任何错误，但我只是通过禁用规则来掩盖这个问题。但这是有意的——我想一次处理一条规则的违反，而不被所有的错误一次分散注意力和过载。总而言之，我已经禁用了50多条规则。现在真正的工作开始了——让他们一个接一个地修复错误。</p><h1 id="a294" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">那些简单的</h1><p id="b206" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">一些规则非常容易修改。诸如<code class="fe mw mx my mi b">no-unused-vars</code>、<code class="fe mw mx my mi b">no-constant-condition</code>或<code class="fe mw mx my mi b">react/no-unused-state</code>之类的规则涉及简单地删除有问题的代码，而不必理解代码。要是有更多这样的简单修复就好了。</p><h1 id="6652" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">那些复杂的</h1><p id="1e65" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">有些规则需要复杂得多。像<code class="fe mw mx my mi b">import/cycle</code>这样的规则，让我重新组织导出和导入以避免循环依赖，需要很大的努力才能解决。这使得意外错误和回归的风险更高，因此还需要额外的努力来验证变更。虽然我不喜欢每次违反规则所付出的努力，但我不得不低下头去做。修正这些规则无疑是整个努力的低谷。</p><h1 id="5d11" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我从他们身上学到的</h1><p id="50d5" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">一些规则让我受益匪浅。特别是，我从<code class="fe mw mx my mi b">jsx-a11y</code>规则中学到了可访问性。像<code class="fe mw mx my mi b">jsx-a11y/no-static-element-interactions</code>、<code class="fe mw mx my mi b">jsx-a11y/interactive-supports-focus</code>和<code class="fe mw mx my mi b">jsx-a11y/click-events-have-key-events</code>这样的规则告诉我，像div这样有一些交互(例如<code class="fe mw mx my mi b">onClick</code>)的静态元素需要有一个<code class="fe mw mx my mi b">role</code>、<code class="fe mw mx my mi b">tabIndex</code>和一个键盘事件，这样辅助技术才能与元素交互。这是一个我没有预料到的附带好处。</p><h1 id="6900" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">那些需要调整的</h1><p id="090d" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">有些规则是不可避免的。但幸运的是，他们提供了配置选项，允许我所需要的，所以我不需要永久关闭规则。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="1c46" class="mm ku in mi b gy mn mo l mp mq">module.exports = {<br/>  rules: {<br/>    'no-empty': ['error', { allowEmptyCatch: true }],<br/>    'no-underscore-dangle': ['error', { allow: ['_id'] }],<br/>    'react/jsx-filename-extension': [<br/>      'error',<br/>      { extensions: ['.js', '.jsx'] }<br/>    ],<br/>  },<br/>}</span></pre><h1 id="70bb" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">需要内联的会禁用</h1><p id="9b8e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">一些规则在原则上是好的，但在某些情况下需要禁用它们。如果你将道具扩展到JSX，那么<code class="fe mw mx my mi b">react/jsx-props-no-spreading</code>规则会出错，但是这对于高阶组件和基于钩子的库是必要的，比如<a class="ae ks" href="https://github.com/react-dropzone/react-dropzone" rel="noopener ugc nofollow" target="_blank"> React Dropzone </a>或<a class="ae ks" href="https://github.com/tannerlinsley/react-table" rel="noopener ugc nofollow" target="_blank"> React Table </a>。因为我只希望在少数情况下需要适当的传播，所以我选择了内联禁用规则，而不是永久禁用。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="4b4a" class="mm ku in mi b gy mn mo l mp mq">const withAuth = (WrappedComponent, permissions) =&gt; {<br/>  const PermissionCheck = props =&gt; {<br/>    const hasPermission = ...;<br/>    if (hasPermission) {<br/>      /* eslint-disable-next-line react/jsx-props-no-spreading */<br/>      return &lt;WrappedComponent {...props} /&gt;;<br/>    }<br/>    return &lt;Redirect to="/" /&gt;;<br/>  };<br/>  return PermissionCheck;<br/>};<br/><br/>export default withAuth;</span></pre><h1 id="0d1f" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">那些暂时被禁用的</h1><p id="fe4e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">有些规则我很想启用，但是一次完成要花很长时间，因为它们占了大部分错误。作为临时措施，我会暂时禁用它们，然后一个文件夹一个文件夹地慢慢修复错误，直到有一天，希望这些规则可以永久启用。</p><p id="decc" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">ESLint提供了一个<code class="fe mw mx my mi b">overrides</code>部分，可以定位文件并对这些文件应用特定的规则。使用这一点，我禁用了整个文件夹，后来，我删除了禁用一个接一个，并解决了错误。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="95ba" class="mm ku in mi b gy mn mo l mp mq">module.exports = {<br/>  overrides: [<br/>    {<br/>      // todo: slowly enable<br/>      files: [<br/>        'src/views/dashboard/**/*.js',<br/>        'src/views/users/**/*.js',<br/>        'src/views/settings/**/*.js',<br/>      ],<br/>      rules: {<br/>        'react/destructuring-assignment': 'off',<br/>        'react/prop-types': 'off',<br/>      },<br/>    },<br/>  ],<br/>}</span></pre><h1 id="41b4" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">那些永久残疾的人</h1><p id="7e51" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">幸运的是，我不认为任何规则保证这一点。确实有一些令人头疼的规则，但我理解它们背后的原因。我想尽最大努力遵循Airbnb编码标准和框架建议，这意味着保持所有规则的启用。</p><h1 id="d293" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">整体流程</h1><p id="6b88" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">总之，完全集成我的ESLint配置花了将近一个月的时间。但不要让这吓走你！解决简单的问题和微调规则只花了一天时间。更复杂、更费力的项目需要大约一周时间。其中，80%的ESLint错误得到了解决。</p><p id="b0b2" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">剩下的就是我暂时禁用的有问题的文件夹。这些，我花了我的时间。因为我只是逐个文件夹地禁用它们，所以不在这些文件夹中的任何新代码都将应用这些规则。我觉得，这是完成ESLint迁移和产品特性开发的时间压力之间的一个很大的妥协。</p></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="77b1" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">最后的想法</h1><p id="d19f" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">虽然移植ESLint配置的整个过程很漫长，但我很高兴我做到了。由于这种最初的努力——设置适当的ESLint配置并修复代码库——我们不再需要考虑代码格式或花费时间担心代码质量，因此，我们可以将所有时间用于提高工作效率。为了内心的平静，努力是值得的。</p></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><h1 id="0e5b" class="kt ku in bd kv kw ng ky kz la nh lc ld jt ni ju lf jw nj jx lh jz nk ka lj lk bi translated">资源</h1><ul class=""><li id="2d12" class="nl nm in ln b lo lp lr ls lu nn ly no mc np mg nq nr ns nt bi translated"><a class="ae ks" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank">ESLint官方文档</a></li><li id="360e" class="nl nm in ln b lo nu lr nv lu nw ly nx mc ny mg nq nr ns nt bi translated"><a class="ae ks" href="https://medium.com/javascript-in-plain-english/eslint-a-proofreader-for-your-code-cd7e56ae391f" rel="noopener">建立ESLint </a></li></ul></div></div>    
</body>
</html>