<html>
<head>
<title>How to Send an Email with Image Attachment in Node.js &amp; React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Node.js中发送带有图像附件的电子邮件&amp;如何回应</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-send-an-email-with-image-attachment-in-node-js-react-657479d49587?source=collection_archive---------1-----------------------#2019-11-26">https://javascript.plainenglish.io/how-to-send-an-email-with-image-attachment-in-node-js-react-657479d49587?source=collection_archive---------1-----------------------#2019-11-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c313a2117d59f298b65e28cbbb473f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMYX_IJ5f6TqDgTcWGCDlQ.png"/></div></div></figure><p id="546d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在现代网络中，具有图像附加特征的接触形式变得越来越流行。你可能会问我为什么需要它？那么，如果您的客户发现了一个bug并想向您发送一个截图呢？有道理，对吧？互联网上有很多关于使用Node.js和Nodemailer发送电子邮件的教程，但是没有一个涵盖使用node . js和node mailer发送附件。我们将更进一步，使用Node.js Express为后端构建带有图像附件的联系人表单，并使用Redux为前端做出反应。我们开始吧:</p><p id="6832" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">设置后端</strong></p><p id="efae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们需要建立我们的项目:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4bf8" class="lc ld in ky b gy le lf l lg lh">npm init</span></pre><p id="feb2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我假设您已经熟悉了使用Node.js和React生成项目，所以我不会进一步讨论基本的主题。我们需要安装Express框架、正文解析器和其他依赖项。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="eda6" class="lc ld in ky b gy le lf l lg lh">npm install express body-parser nodemailer cors</span></pre><p id="4a1f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们创建一个名为<strong class="jx io"> index.js </strong>的主服务器文件:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="3e4a" class="lc ld in ky b gy le lf l lg lh">const express = require('express');</span><span id="0f8b" class="lc ld in ky b gy li lf l lg lh">const bodyParser = require('body-parser');</span><span id="76f3" class="lc ld in ky b gy li lf l lg lh">const nodemailer = require('nodemailer');</span><span id="e843" class="lc ld in ky b gy li lf l lg lh">const cors = require('cors');</span><span id="13d7" class="lc ld in ky b gy li lf l lg lh">const app = express();</span><span id="ce01" class="lc ld in ky b gy li lf l lg lh">const port = 4444;</span><span id="364e" class="lc ld in ky b gy li lf l lg lh">app.use(bodyParser.json({ limit: '10mb', extended: true }))</span><span id="2541" class="lc ld in ky b gy li lf l lg lh">app.use(bodyParser.urlencoded({ limit: '10mb', extended: true }))</span><span id="3955" class="lc ld in ky b gy li lf l lg lh">app.use(cors());</span><span id="19f1" class="lc ld in ky b gy li lf l lg lh">app.listen(port, () =&gt; {</span><span id="cff2" class="lc ld in ky b gy li lf l lg lh">console.log('We are live on port 4444');</span><span id="9956" class="lc ld in ky b gy li lf l lg lh">});</span><span id="2e5a" class="lc ld in ky b gy li lf l lg lh">app.get('/', (req, res) =&gt; {</span><span id="9598" class="lc ld in ky b gy li lf l lg lh">res.send('Welcome to my api');</span><span id="257b" class="lc ld in ky b gy li lf l lg lh">})</span></pre><p id="5bb2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是一个由Express支持的简单的Node.js API。在创建它之后，我们需要从节点邮件程序中获得所有的好处，并包括发送带有图像的提交电子邮件的控制器功能。</p><p id="2ee9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建接触控制器功能</strong></p><p id="0923" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用Gmail进行身份验证。但是，您可以使用<a class="ae lj" href="https://sendgrid.com/" rel="noopener ugc nofollow" target="_blank"> Sendgrid的API </a>，这提供了一个更好、更安全的选项。我们在<strong class="jx io"> Index.js </strong>中创建它，因为没有任何其他功能。我们只需要这个简单的控制器和API路由来发送帖子请求。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="783a" class="lc ld in ky b gy le lf l lg lh">app.post('/api/v1/contact', (req, res) =&gt; {</span><span id="6ca8" class="lc ld in ky b gy li lf l lg lh">var data = req.body;</span><span id="04fa" class="lc ld in ky b gy li lf l lg lh">var smtpTransport = nodemailer.createTransport({</span><span id="9468" class="lc ld in ky b gy li lf l lg lh">service: 'Gmail',</span><span id="b6e0" class="lc ld in ky b gy li lf l lg lh">port: 465,</span><span id="3817" class="lc ld in ky b gy li lf l lg lh">auth: {</span><span id="05f4" class="lc ld in ky b gy li lf l lg lh">user: 'username',</span><span id="33df" class="lc ld in ky b gy li lf l lg lh">pass: 'password'</span><span id="778f" class="lc ld in ky b gy li lf l lg lh">}</span><span id="2fb0" class="lc ld in ky b gy li lf l lg lh">});</span><span id="5f94" class="lc ld in ky b gy li lf l lg lh">var mailOptions = {</span><span id="911d" class="lc ld in ky b gy li lf l lg lh">from: data.email,</span><span id="b65d" class="lc ld in ky b gy li lf l lg lh">replyto: data.email,</span><span id="9505" class="lc ld in ky b gy li lf l lg lh">to: 'goshareitio@gmail.com',</span><span id="d5dd" class="lc ld in ky b gy li lf l lg lh">subject: data.title,</span><span id="7b4d" class="lc ld in ky b gy li lf l lg lh">html: `&lt;p&gt;${data.email}&lt;/p&gt;</span><span id="a10a" class="lc ld in ky b gy li lf l lg lh">&lt;p&gt;${data.message}&lt;/p&gt;`,</span><span id="8bab" class="lc ld in ky b gy li lf l lg lh">attachments: [</span><span id="d558" class="lc ld in ky b gy li lf l lg lh">{</span><span id="6420" class="lc ld in ky b gy li lf l lg lh">filename: data.title + ".jpg",</span><span id="46fe" class="lc ld in ky b gy li lf l lg lh">contentType:  'image/jpeg',</span><span id="d2ff" class="lc ld in ky b gy li lf l lg lh">content: new Buffer.from(req.body.image.split("base64,")[1], "base64"),</span><span id="1871" class="lc ld in ky b gy li lf l lg lh">}</span><span id="931b" class="lc ld in ky b gy li lf l lg lh">]</span><span id="5b31" class="lc ld in ky b gy li lf l lg lh">};</span><span id="193c" class="lc ld in ky b gy li lf l lg lh">smtpTransport.sendMail(mailOptions,</span><span id="6727" class="lc ld in ky b gy li lf l lg lh">(error, response) =&gt; {</span><span id="3845" class="lc ld in ky b gy li lf l lg lh">if (error) {</span><span id="4a10" class="lc ld in ky b gy li lf l lg lh">res.status(400).send(error)</span><span id="80e4" class="lc ld in ky b gy li lf l lg lh">} else {</span><span id="3ba7" class="lc ld in ky b gy li lf l lg lh">res.send('Success')</span><span id="2a3a" class="lc ld in ky b gy li lf l lg lh">}</span><span id="eb1b" class="lc ld in ky b gy li lf l lg lh">smtpTransport.close();</span><span id="25e4" class="lc ld in ky b gy li lf l lg lh">});</span><span id="d35c" class="lc ld in ky b gy li lf l lg lh">})</span></pre><p id="6e6c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在控制器功能中，您将看到带有支持的文件类型的附件字段。这是节点邮件程序附带的一个内置功能。</p><p id="c9f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是时候转向前端了。</p><p id="90b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建React.js项目</strong></p><p id="840c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用创建反应应用程序来生成我们的项目。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="2bbc" class="lc ld in ky b gy le lf l lg lh">npx create-react-app Contact</span></pre><p id="bf34" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我猜你熟悉反应，也有一些知识，所以不会进一步解释项目结构。虽然本教程只介绍了现实世界项目的一小部分，但我们将创建可重用组件，因为可以预见，您不仅会将这些可重用组件用于联系人表单，还会将其用于项目中的其他表单，如签到。张贴，评论等等…</p><p id="2a5c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建可重用的表单组件</strong></p><p id="cd21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们将从简单的输入组件开始:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="7e8f" class="lc ld in ky b gy le lf l lg lh">import React from ‘react’;</span><span id="6c80" class="lc ld in ky b gy li lf l lg lh">export const ProjectInput = ({<br/> input,<br/> label,<br/> type,<br/> symbol,<br/> className,<br/> meta: { touched, error, warning }<br/>}) =&gt; (<br/> &lt;div className=’form-group’&gt;<br/> &lt;label&gt;{label}&lt;/label&gt;<br/> &lt;div className=’input-group’&gt;<br/> {symbol &amp;&amp;<br/> &lt;div className=’input-group-prepend’&gt;<br/> &lt;div className=’input-group-text’&gt;{symbol}&lt;/div&gt;<br/> &lt;/div&gt;<br/> }<br/> &lt;input {…input} type={type} className={className} /&gt;<br/> &lt;/div&gt;<br/> {touched &amp;&amp;<br/> ((error &amp;&amp; &lt;div className=’alert alert-danger’&gt;{error}&lt;/div&gt;))}<br/> &lt;/div&gt;<br/> )</span></pre><p id="21c8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后将创建<strong class="jx io">文本区域</strong></p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="f44f" class="lc ld in ky b gy le lf l lg lh">import React from ‘react’;</span><span id="4644" class="lc ld in ky b gy li lf l lg lh">export const ProjectTextArea = ({<br/> input,<br/> label,<br/> type,<br/> rows,<br/> className,<br/> meta: { touched, error, warning }<br/>}) =&gt; (<br/> &lt;div className=’form-group’&gt;<br/> &lt;label&gt;{label}&lt;/label&gt;<br/> &lt;div className=’input-group’&gt;<br/> &lt;textarea {…input} type={type} rows={rows} className={className}&gt;&lt;/textarea&gt;<br/> &lt;/div&gt;<br/> {touched &amp;&amp;<br/> ((error &amp;&amp; &lt;div className=’alert alert-danger’&gt;{error}&lt;/div&gt;))}<br/> &lt;/div&gt;<br/> )</span></pre><p id="b153" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是时候创建这个表单最重要的可重用组件了，一个上传图像的输入。</p><p id="b9fb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建ImgFileUpload组件</strong></p><p id="7605" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用<strong class="jx io">文件阅读器</strong>。它是一个对象，唯一的目的是从<code class="fe lk ll lm ky b">Blob</code>(因此也是<code class="fe lk ll lm ky b">File</code>对象中读取数据。</p><p id="0346" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它使用事件传递数据，因为从磁盘读取可能需要时间。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="ad4c" class="lc ld in ky b gy le lf l lg lh">import React from ‘react’;</span><span id="4eb1" class="lc ld in ky b gy li lf l lg lh">export class ImgFileUpload extends React.Component {</span><span id="6b1f" class="lc ld in ky b gy li lf l lg lh">constructor() {<br/> super();</span><span id="b6d7" class="lc ld in ky b gy li lf l lg lh">this.setupReader()</span><span id="089e" class="lc ld in ky b gy li lf l lg lh">this.state = {<br/> selectedFile: undefined,<br/> imageBase64: ‘’,<br/> initialImageBase64: ‘’,<br/> pending: false,<br/> status: ‘INIT’,<br/> }</span><span id="7aed" class="lc ld in ky b gy li lf l lg lh">this.onChange = this.onChange.bind(this);<br/> }</span><span id="4bd0" class="lc ld in ky b gy li lf l lg lh">setupReader() {<br/> this.reader = new FileReader();<br/> this.reader.addEventListener(‘load’, (event) =&gt; {<br/> const { initialImageBase64 } = this.state;<br/> var { changedImage } = this.props;<br/> const imageBase64 = event.target.result;<br/> changedImage(imageBase64);</span><span id="6651" class="lc ld in ky b gy li lf l lg lh">if (initialImageBase64) {<br/> this.setState({ imageBase64 });<br/> } else {<br/> this.setState({ imageBase64, initialImageBase64: imageBase64 });<br/> }<br/> });<br/> }</span><span id="4cbe" class="lc ld in ky b gy li lf l lg lh">onChange(event) {<br/> const selectedFile = event.target.files[0];<br/> var { checkImageState } = this.props;<br/> if (selectedFile) {<br/> checkImageState(‘selected’);<br/> } else {<br/> checkImageState(‘unselected’);<br/> }<br/> if (selectedFile) {<br/> this.setState({<br/> selectedFile,<br/> initialImageBase64: ‘’<br/> });</span><span id="99bc" class="lc ld in ky b gy li lf l lg lh">this.reader.readAsDataURL(selectedFile);<br/> }<br/> }</span><span id="f4ef" class="lc ld in ky b gy li lf l lg lh">render() {</span><span id="8744" class="lc ld in ky b gy li lf l lg lh">return (<br/> &lt;div className=’img-upload-container’&gt;<br/> &lt;label className=’img-upload btn’&gt;<br/> &lt;span className=’upload-text’&gt; Select an image &lt;/span&gt;<br/> &lt;input type=’file’<br/> accept=’.jpg, .png, .jpeg’<br/> onChange={this.onChange} /&gt;<br/> &lt;/label&gt;<br/> &lt;/div&gt;</span><span id="8775" class="lc ld in ky b gy li lf l lg lh">)<br/> }<br/>}</span></pre><p id="a9a4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可能会找到许多第三方库用于文件选择和上传，但是，建议忽略这些库。其中一些会导致不同的问题，最常见的是因为单一的第三方库而无法创建产品版本。我们在过去使用Angular的第三方包时遇到了类似的问题。所以随着你使用的图书馆越来越少，将来的发行也会越来越少。</p><p id="13a5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">建立完整的联系方式</strong></p><p id="75c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们需要将上面创建的所有组件放在一个地方，以获得最终的表单，但在此之前，我们需要安装一些依赖项。</p><p id="1019" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lk ll lm ky b">npm install --save redux react-redux redux-form axios</code></p><p id="b936" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们需要创建一个<strong class="jx io"> index.js </strong>文件，它将包含我们所有的Reducer以及f<strong class="jx io">form reducer</strong></p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="8e9f" class="lc ld in ky b gy le lf l lg lh">import { createStore, compose, combineReducers } from 'redux';</span><span id="aa0a" class="lc ld in ky b gy li lf l lg lh">import { reducer as formReducer } from 'redux-form';</span><span id="2dd8" class="lc ld in ky b gy li lf l lg lh">export const init = () =&gt; {</span><span id="c02f" class="lc ld in ky b gy li lf l lg lh">const reducer = combineReducers({</span><span id="c31a" class="lc ld in ky b gy li lf l lg lh">form: formReducer,</span><span id="4c79" class="lc ld in ky b gy li lf l lg lh">});</span><span id="a1fb" class="lc ld in ky b gy li lf l lg lh">const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><span id="35d5" class="lc ld in ky b gy li lf l lg lh">const store = createStore(reducer);</span><span id="4d51" class="lc ld in ky b gy li lf l lg lh">return store;</span><span id="e2a0" class="lc ld in ky b gy li lf l lg lh">}</span></pre><p id="9a13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后别忘了实现我们store inside <strong class="jx io"> App.js </strong>:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="2f69" class="lc ld in ky b gy le lf l lg lh">import React, { Component } from 'react';</span><span id="3ed8" class="lc ld in ky b gy li lf l lg lh">import { BrowserRouter, Route } from 'react-router-dom';</span><span id="88f1" class="lc ld in ky b gy li lf l lg lh">import { Provider } from 'react-redux';</span><span id="08f3" class="lc ld in ky b gy li lf l lg lh">import Contact from './components/contact';</span><span id="a0e4" class="lc ld in ky b gy li lf l lg lh">import './App.css';</span><span id="bda5" class="lc ld in ky b gy li lf l lg lh">const store = require('./reducers').init();</span><span id="4da0" class="lc ld in ky b gy li lf l lg lh">class App extends Component {</span><span id="8f60" class="lc ld in ky b gy li lf l lg lh">render() {</span><span id="a266" class="lc ld in ky b gy li lf l lg lh">return (</span><span id="a739" class="lc ld in ky b gy li lf l lg lh">&lt;Provider store={store}&gt;</span><span id="716a" class="lc ld in ky b gy li lf l lg lh">&lt;BrowserRouter&gt;</span><span id="873b" class="lc ld in ky b gy li lf l lg lh">&lt;div className='App'&gt;</span><span id="e54c" class="lc ld in ky b gy li lf l lg lh">&lt;div className='container'&gt;</span><span id="56dc" class="lc ld in ky b gy li lf l lg lh">&lt;Route exact path='/' component={Contact} /&gt;</span><span id="5c53" class="lc ld in ky b gy li lf l lg lh">&lt;/div&gt;</span><span id="5c9f" class="lc ld in ky b gy li lf l lg lh">&lt;/div&gt;</span><span id="aeb4" class="lc ld in ky b gy li lf l lg lh">&lt;/BrowserRouter&gt;</span><span id="eb5f" class="lc ld in ky b gy li lf l lg lh">&lt;/Provider&gt;</span><span id="789d" class="lc ld in ky b gy li lf l lg lh">);</span><span id="6300" class="lc ld in ky b gy li lf l lg lh">}</span><span id="4ccb" class="lc ld in ky b gy li lf l lg lh">}</span><span id="f2b9" class="lc ld in ky b gy li lf l lg lh">export default App;</span></pre><p id="95e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们可以继续构建我们的最终联系表单。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4dc6" class="lc ld in ky b gy le lf l lg lh">import React from 'react';</span><span id="e468" class="lc ld in ky b gy li lf l lg lh">import { Field, reduxForm } from 'redux-form';</span><span id="5ba0" class="lc ld in ky b gy li lf l lg lh">import { ProjectInput } from './ProjectInput';</span><span id="9d21" class="lc ld in ky b gy li lf l lg lh">import { ProjectTextArea } from './ProjectTextArea';</span><span id="8567" class="lc ld in ky b gy li lf l lg lh">import { ImgFileUpload } from './ImgFileUpload';</span><span id="7788" class="lc ld in ky b gy li lf l lg lh">class ContactForm extends React.Component {</span><span id="5a5c" class="lc ld in ky b gy li lf l lg lh">state = {</span><span id="7eea" class="lc ld in ky b gy li lf l lg lh">imageState: false</span><span id="2a17" class="lc ld in ky b gy li lf l lg lh">}</span><span id="4af7" class="lc ld in ky b gy li lf l lg lh">render() {</span><span id="8442" class="lc ld in ky b gy li lf l lg lh">const {</span><span id="94d4" class="lc ld in ky b gy li lf l lg lh">handleSubmit,</span><span id="e581" class="lc ld in ky b gy li lf l lg lh">pristine,</span><span id="4db8" class="lc ld in ky b gy li lf l lg lh">submitting,</span><span id="fed0" class="lc ld in ky b gy li lf l lg lh">submitCb,</span><span id="e52d" class="lc ld in ky b gy li lf l lg lh">valid,</span><span id="6281" class="lc ld in ky b gy li lf l lg lh">SetImage,</span><span id="92aa" class="lc ld in ky b gy li lf l lg lh">loading</span><span id="8a96" class="lc ld in ky b gy li lf l lg lh">} = this.props;</span><span id="078f" class="lc ld in ky b gy li lf l lg lh">return (</span><span id="17ec" class="lc ld in ky b gy li lf l lg lh">&lt;form onSubmit={handleSubmit(submitCb).bind(this)}</span><span id="4762" class="lc ld in ky b gy li lf l lg lh">onClick={this.resetValues}&gt;</span><span id="a74d" class="lc ld in ky b gy li lf l lg lh">&lt;Field</span><span id="b24c" class="lc ld in ky b gy li lf l lg lh">name="email"</span><span id="0e1a" class="lc ld in ky b gy li lf l lg lh">type="email"</span><span id="8dec" class="lc ld in ky b gy li lf l lg lh">label='Email'</span><span id="5222" class="lc ld in ky b gy li lf l lg lh">className='form-control'</span><span id="a998" class="lc ld in ky b gy li lf l lg lh">component={ProjectInput}</span><span id="4188" class="lc ld in ky b gy li lf l lg lh">/&gt;</span><span id="5c9e" class="lc ld in ky b gy li lf l lg lh">&lt;Field</span><span id="3bc9" class="lc ld in ky b gy li lf l lg lh">name="title"</span><span id="e1c6" class="lc ld in ky b gy li lf l lg lh">type="text"</span><span id="4706" class="lc ld in ky b gy li lf l lg lh">label='Title'</span><span id="5fcd" class="lc ld in ky b gy li lf l lg lh">className='form-control'</span><span id="1a32" class="lc ld in ky b gy li lf l lg lh">component={ProjectInput}</span><span id="49d2" class="lc ld in ky b gy li lf l lg lh">/&gt;</span><span id="e1ec" class="lc ld in ky b gy li lf l lg lh">&lt;Field</span><span id="25f1" class="lc ld in ky b gy li lf l lg lh">name="message"</span><span id="e367" class="lc ld in ky b gy li lf l lg lh">type="text"</span><span id="8f39" class="lc ld in ky b gy li lf l lg lh">label='Description'</span><span id="baae" class="lc ld in ky b gy li lf l lg lh">rows='6'</span><span id="0f75" class="lc ld in ky b gy li lf l lg lh">className='form-control'</span><span id="7bfc" class="lc ld in ky b gy li lf l lg lh">component={ProjectTextArea}</span><span id="ecd2" class="lc ld in ky b gy li lf l lg lh">/&gt;</span><span id="5924" class="lc ld in ky b gy li lf l lg lh">&lt;Field</span><span id="d7a4" class="lc ld in ky b gy li lf l lg lh">name="image"</span><span id="8639" class="lc ld in ky b gy li lf l lg lh">label='Image'</span><span id="c390" class="lc ld in ky b gy li lf l lg lh">className='form-control'</span><span id="ad8b" class="lc ld in ky b gy li lf l lg lh">component={ImgFileUpload}</span><span id="2262" class="lc ld in ky b gy li lf l lg lh">props={{</span><span id="cd05" class="lc ld in ky b gy li lf l lg lh">changedImage: (e) =&gt; {</span><span id="c7fb" class="lc ld in ky b gy li lf l lg lh">SetImage(e);</span><span id="8541" class="lc ld in ky b gy li lf l lg lh">this.setState({</span><span id="6665" class="lc ld in ky b gy li lf l lg lh">imageState: true</span><span id="f34d" class="lc ld in ky b gy li lf l lg lh">})</span><span id="6f99" class="lc ld in ky b gy li lf l lg lh">},</span><span id="7686" class="lc ld in ky b gy li lf l lg lh">checkImageState: (e) =&gt; {</span><span id="074d" class="lc ld in ky b gy li lf l lg lh">if (e === 'selected') {</span><span id="26a7" class="lc ld in ky b gy li lf l lg lh">this.setState({</span><span id="d292" class="lc ld in ky b gy li lf l lg lh">imageState: true</span><span id="1b3b" class="lc ld in ky b gy li lf l lg lh">});</span><span id="e703" class="lc ld in ky b gy li lf l lg lh">} else {</span><span id="ae61" class="lc ld in ky b gy li lf l lg lh">this.setState({</span><span id="7f2c" class="lc ld in ky b gy li lf l lg lh">imageState: false</span><span id="9e81" class="lc ld in ky b gy li lf l lg lh">});</span><span id="d9b7" class="lc ld in ky b gy li lf l lg lh">}</span><span id="eab0" class="lc ld in ky b gy li lf l lg lh">},</span><span id="688e" class="lc ld in ky b gy li lf l lg lh">}}</span><span id="a47c" class="lc ld in ky b gy li lf l lg lh">key={this.props.key}</span><span id="f8b6" class="lc ld in ky b gy li lf l lg lh">/&gt;</span><span id="fa6f" class="lc ld in ky b gy li lf l lg lh">{</span><span id="b489" class="lc ld in ky b gy li lf l lg lh">loading ?</span><span id="d777" class="lc ld in ky b gy li lf l lg lh">&lt;button</span><span id="9c43" class="lc ld in ky b gy li lf l lg lh">className='btn btn-primary'</span><span id="5518" class="lc ld in ky b gy li lf l lg lh">type="button"</span><span id="08d5" class="lc ld in ky b gy li lf l lg lh">disabled={true}</span><span id="930d" class="lc ld in ky b gy li lf l lg lh">&gt;</span><span id="c7df" class="lc ld in ky b gy li lf l lg lh">Sending...</span><span id="2e95" class="lc ld in ky b gy li lf l lg lh">&lt;/button&gt;</span><span id="97bf" class="lc ld in ky b gy li lf l lg lh">:</span><span id="1a71" class="lc ld in ky b gy li lf l lg lh">&lt;button</span><span id="5312" class="lc ld in ky b gy li lf l lg lh">className='btn btn-primary'</span><span id="365a" class="lc ld in ky b gy li lf l lg lh">type="submit"</span><span id="0562" class="lc ld in ky b gy li lf l lg lh">disabled={!valid || pristine || submitting || !this.state.imageState}</span><span id="bcd6" class="lc ld in ky b gy li lf l lg lh">&gt;</span><span id="95dc" class="lc ld in ky b gy li lf l lg lh">Send</span><span id="a426" class="lc ld in ky b gy li lf l lg lh">&lt;/button&gt;</span><span id="be33" class="lc ld in ky b gy li lf l lg lh">}</span><span id="6b42" class="lc ld in ky b gy li lf l lg lh">&lt;/form&gt;</span><span id="a32a" class="lc ld in ky b gy li lf l lg lh">)</span><span id="c09c" class="lc ld in ky b gy li lf l lg lh">}</span><span id="e700" class="lc ld in ky b gy li lf l lg lh">}</span><span id="20f1" class="lc ld in ky b gy li lf l lg lh">const validate = values =&gt; {</span><span id="5da2" class="lc ld in ky b gy li lf l lg lh">const errors = {};</span><span id="88ac" class="lc ld in ky b gy li lf l lg lh">if (!values.email) {</span><span id="a4da" class="lc ld in ky b gy li lf l lg lh">errors.email = 'Please enter email!';</span><span id="a3ec" class="lc ld in ky b gy li lf l lg lh">}</span><span id="71c6" class="lc ld in ky b gy li lf l lg lh">if (!values.title) {</span><span id="13ac" class="lc ld in ky b gy li lf l lg lh">errors.title = 'Please enter title!';</span><span id="78da" class="lc ld in ky b gy li lf l lg lh">}</span><span id="1377" class="lc ld in ky b gy li lf l lg lh">if (!values.message) {</span><span id="12f3" class="lc ld in ky b gy li lf l lg lh">errors.message = 'Please enter message!';</span><span id="6513" class="lc ld in ky b gy li lf l lg lh">}</span><span id="336b" class="lc ld in ky b gy li lf l lg lh">return errors;</span><span id="c218" class="lc ld in ky b gy li lf l lg lh">}</span><span id="4f7e" class="lc ld in ky b gy li lf l lg lh">export default reduxForm({</span><span id="55c1" class="lc ld in ky b gy li lf l lg lh">form: 'ContactForm',</span><span id="b603" class="lc ld in ky b gy li lf l lg lh">validate</span><span id="9c91" class="lc ld in ky b gy li lf l lg lh">})(ContactForm)</span></pre><p id="3f7c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们使用先前创建的可重用组件，并使用redux-form来支持我们的表单。此外，我们为这个表单实现了一些验证，但是，由于这是一个完全不同的主题，我建议为每个字段单独添加更多的验证。除此之外，我们禁用了发送按钮，直到所有字段都被填充。看起来做了很多工作，对吗？作为使我们的联系表单完全起作用的最后一步，我们将为它创建一个容器组件。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="41c2" class="lc ld in ky b gy le lf l lg lh">import React from 'react';</span><span id="7caa" class="lc ld in ky b gy li lf l lg lh">import ContactForm from './ContactForm';</span><span id="1a9b" class="lc ld in ky b gy li lf l lg lh">import { reset } from 'redux-form';</span><span id="9abe" class="lc ld in ky b gy li lf l lg lh">import axios from 'axios';</span><span id="b686" class="lc ld in ky b gy li lf l lg lh">import { connect } from "react-redux";</span><span id="afab" class="lc ld in ky b gy li lf l lg lh">import { ToastContainer, toast } from 'react-toastify';</span><span id="7dd0" class="lc ld in ky b gy li lf l lg lh">class Contact extends React.Component {</span><span id="11c7" class="lc ld in ky b gy li lf l lg lh">constructor(props) {</span><span id="05bf" class="lc ld in ky b gy li lf l lg lh">super(props);</span><span id="8b0d" class="lc ld in ky b gy li lf l lg lh">this.state = {</span><span id="3033" class="lc ld in ky b gy li lf l lg lh">errors: [],</span><span id="77da" class="lc ld in ky b gy li lf l lg lh">note: '',</span><span id="451c" class="lc ld in ky b gy li lf l lg lh">loading: false</span><span id="36b7" class="lc ld in ky b gy li lf l lg lh">}</span><span id="954a" class="lc ld in ky b gy li lf l lg lh">this.pristine = false;</span><span id="75f2" class="lc ld in ky b gy li lf l lg lh">this.Send = this.Send.bind(this);</span><span id="bb7c" class="lc ld in ky b gy li lf l lg lh">}</span><span id="f454" class="lc ld in ky b gy li lf l lg lh">SetImage = async (image) =&gt; {</span><span id="81b0" class="lc ld in ky b gy li lf l lg lh">await this.setState({ image });</span><span id="19ad" class="lc ld in ky b gy li lf l lg lh">};</span><span id="f83c" class="lc ld in ky b gy li lf l lg lh">Send(userData) {</span><span id="5849" class="lc ld in ky b gy li lf l lg lh">let { image } = this.state;</span><span id="1dd1" class="lc ld in ky b gy li lf l lg lh">userData = { ...userData, image };</span><span id="f3d1" class="lc ld in ky b gy li lf l lg lh">this.setState({ loading: true });</span><span id="f8f3" class="lc ld in ky b gy li lf l lg lh">this.sendEmail(userData).then(</span><span id="595f" class="lc ld in ky b gy li lf l lg lh">submited =&gt; {</span><span id="6157" class="lc ld in ky b gy li lf l lg lh">toast.success('Email sent successfully');</span><span id="2b38" class="lc ld in ky b gy li lf l lg lh">this.props.dispatch(reset('ContactForm'));</span><span id="095b" class="lc ld in ky b gy li lf l lg lh">this.setState({ key: 'cleared' })</span><span id="ed8e" class="lc ld in ky b gy li lf l lg lh">this.setState({ note: 'Email sent successfully', loading: false });</span><span id="5e98" class="lc ld in ky b gy li lf l lg lh">},</span><span id="eb18" class="lc ld in ky b gy li lf l lg lh">).catch(errors =&gt; {</span><span id="0baa" class="lc ld in ky b gy li lf l lg lh">toast.error('Error occured')</span><span id="26ae" class="lc ld in ky b gy li lf l lg lh">this.setState({ errors, loading: false })</span><span id="90a2" class="lc ld in ky b gy li lf l lg lh">});</span><span id="1667" class="lc ld in ky b gy li lf l lg lh">};</span><span id="1a9a" class="lc ld in ky b gy li lf l lg lh">sendEmail = async emailData =&gt; {</span><span id="9447" class="lc ld in ky b gy li lf l lg lh">console.log(emailData);</span><span id="338b" class="lc ld in ky b gy li lf l lg lh">return axios.post('/api/v1/contact', emailData).then(</span><span id="09a2" class="lc ld in ky b gy li lf l lg lh">res =&gt; res.data,</span><span id="dc15" class="lc ld in ky b gy li lf l lg lh">err =&gt; Promise.reject(err.response.data.errors)</span><span id="7615" class="lc ld in ky b gy li lf l lg lh">)</span><span id="1fb3" class="lc ld in ky b gy li lf l lg lh">};</span><span id="f85d" class="lc ld in ky b gy li lf l lg lh">render() {</span><span id="01db" class="lc ld in ky b gy li lf l lg lh">const { errors } = this.state;</span><span id="c438" class="lc ld in ky b gy li lf l lg lh">return (</span><span id="355c" class="lc ld in ky b gy li lf l lg lh">&lt;section id='contact'&gt;</span><span id="1ba0" class="lc ld in ky b gy li lf l lg lh">&lt;ToastContainer /&gt;</span><span id="ddc5" class="lc ld in ky b gy li lf l lg lh">&lt;div className='bwm-form'&gt;</span><span id="aaf0" class="lc ld in ky b gy li lf l lg lh">&lt;div className='row'&gt;</span><span id="8b48" class="lc ld in ky b gy li lf l lg lh">&lt;div className='col-md-5'&gt;</span><span id="83f7" class="lc ld in ky b gy li lf l lg lh">&lt;h1&gt;Contact Us&lt;/h1&gt;</span><span id="c32d" class="lc ld in ky b gy li lf l lg lh">&lt;ContactForm</span><span id="eecf" class="lc ld in ky b gy li lf l lg lh">loading={this.state.loading}</span><span id="ed73" class="lc ld in ky b gy li lf l lg lh">submitCb={this.Send}</span><span id="a1b3" class="lc ld in ky b gy li lf l lg lh">errors={errors}</span><span id="1184" class="lc ld in ky b gy li lf l lg lh">SetImage={this.SetImage}</span><span id="f25b" class="lc ld in ky b gy li lf l lg lh">pristine={this.pristine}</span><span id="2f4b" class="lc ld in ky b gy li lf l lg lh">key={this.state.key}</span><span id="a875" class="lc ld in ky b gy li lf l lg lh">/&gt;</span><span id="1c38" class="lc ld in ky b gy li lf l lg lh">&lt;/div&gt;</span><span id="340f" class="lc ld in ky b gy li lf l lg lh">&lt;/div&gt;</span><span id="db72" class="lc ld in ky b gy li lf l lg lh">&lt;/div&gt;</span><span id="8044" class="lc ld in ky b gy li lf l lg lh">&lt;/section&gt;</span><span id="d997" class="lc ld in ky b gy li lf l lg lh">)</span><span id="848d" class="lc ld in ky b gy li lf l lg lh">}</span><span id="8b9b" class="lc ld in ky b gy li lf l lg lh">}</span><span id="ee92" class="lc ld in ky b gy li lf l lg lh">export default connect(null, null)(Contact);</span></pre><p id="3d3c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上面的组件中，我们将数据发送到后端。如果电子邮件发送成功，表格会自动重置。另外，我们使用了一个烤面包机库来显示警告，但是你可以忽略这个库。如您所见，我们使用Axios来执行post请求并将数据发送到后端。至于Redux-form只支持重置基本字段，我们通过使用contact表单和contact组件中的特殊键，从头开始创建了重置文件输入的功能。</p><p id="ff42" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！希望这篇教程对你有帮助。<br/>你可以在这里下载完整的源代码:<br/> <a class="ae lj" href="https://github.com/haykoyaghubyan/react-node-contact" rel="noopener ugc nofollow" target="_blank"> Github </a></p></div></div>    
</body>
</html>