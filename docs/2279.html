<html>
<head>
<title>Build a RESTful API backend on MongoDB using Node.js and Mongoose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js和Mongoose在MongoDB上构建一个RESTful API后端</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-restful-api-backend-on-mongodb-using-node-js-and-mongoose-63f0866e4603?source=collection_archive---------2-----------------------#2020-06-07">https://javascript.plainenglish.io/build-a-restful-api-backend-on-mongodb-using-node-js-and-mongoose-63f0866e4603?source=collection_archive---------2-----------------------#2020-06-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="189d" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">Node.js开发</h2><div class=""/><div class=""><h2 id="6a1e" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">MongoDB是一个优秀的NoSQL数据库</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1119c45dc0c6416462e9a8119855f916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vuJXreBV3uRsGh0VEzP7Q.png"/></div></div></figure><p id="5688" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在本教程中，我们将创建一个Node.js应用程序，为一家已建立的书店存储图书。</p><h1 id="135b" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">先决条件</h1><ol class=""><li id="ce45" class="ml mm in kz b la mn ld mo lg mp lk mq lo mr ls ms mt mu mv bi translated"><a class="ae mw" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="fef5" class="ml mm in kz b la mx ld my lg mz lk na lo nb ls ms mt mu mv bi translated"><a class="ae mw" href="https://www.mongodb.com/try/download/community" rel="noopener ugc nofollow" target="_blank"> MongoDB </a></li><li id="589c" class="ml mm in kz b la mx ld my lg mz lk na lo nb ls ms mt mu mv bi translated"><a class="ae mw" href="https://www.mongodb.com/products/compass" rel="noopener ugc nofollow" target="_blank">用于MongoDB的指南针</a></li></ol><h1 id="d432" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">启动MongoDB</h1><p id="8166" class="pw-post-body-paragraph kx ky in kz b la mn jx lc ld mo ka lf lg nc li lj lk nd lm ln lo ne lq lr ls ig bi translated">打开命令提示符。键入，</p><p id="7804" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">默认情况下，这将在本地主机的端口27017上启动一个MongoDB服务器。</p><p id="50bd" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">打开指南针并连接到MongoDB。它允许您更容易地检查数据，而不需要shell命令。</p><h1 id="e091" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">创建新项目</h1><p id="0622" class="pw-post-body-paragraph kx ky in kz b la mn jx lc ld mo ka lf lg nc li lj lk nd lm ln lo ne lq lr ls ig bi translated">在这里克隆简单的Node.js项目<a class="ae mw" href="https://github.com/bdcorps/serve-static-website-nodejs" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="7380" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">Node.js新手？参考此<a class="ae mw" href="https://medium.com/@adnanrahic/hello-world-app-with-node-js-and-express-c1eb7cfa8a30" rel="noopener">链接</a>获取详细的演练。</p><p id="e529" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">安装NPM软件包，</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="bcc3" class="nk lu in ng b gy nl nm l nn no">npm install body-parser express mongoose</span></pre><p id="5c0c" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">使用以下命令在本地运行它，</p><p id="6add" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">转到<a class="ae mw" href="https://saasbase.dev/build-a-restful-api-backend-on-mongodb-using-nodejs-and-mongoose/localhost:3000" rel="noopener ugc nofollow" target="_blank">localhost:3000</a>,“Hello World”应该会出现在屏幕上。</p><h1 id="2494" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">创建数据模型</h1><p id="e329" class="pw-post-body-paragraph kx ky in kz b la mn jx lc ld mo ka lf lg nc li lj lk nd lm ln lo ne lq lr ls ig bi translated">因为我们保存了我们最喜欢的书的记录，所以让我们定义我们的<code class="fe np nq nr ng b">book</code>模型。</p><p id="8f0d" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">创建一个新文件，<code class="fe np nq nr ng b">book/book.model.js</code></p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="3c97" class="nk lu in ng b gy nl nm l nn no">var mongoose = require("mongoose");<br/>var Schema = mongoose.Schema;<br/><br/>var bookSchema = new Schema({<br/>  title: String,<br/>  author: String,<br/>  rating: Number,<br/>});<br/><br/>var bookModel = mongoose.model("book", bookSchema, "book");<br/><br/>module.exports = bookModel;</span></pre><h1 id="061b" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">创建服务层</h1><p id="e60a" class="pw-post-body-paragraph kx ky in kz b la mn jx lc ld mo ka lf lg nc li lj lk nd lm ln lo ne lq lr ls ig bi translated">作为最佳实践的一部分，拥有一组像<code class="fe np nq nr ng b">createBook</code>、<code class="fe np nq nr ng b">getBooks</code>这样的标准化函数总比直接从主应用程序与模型交互要好。这也使得添加单元测试更加容易。</p><p id="5c97" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">创建一个新文件，<code class="fe np nq nr ng b">book/book.service.js</code></p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="df69" class="nk lu in ng b gy nl nm l nn no">const addBook = (Book) =&gt; (title, author, rating) =&gt; {<br/>  if (!title || !author || !rating)<br/>    throw new Error(<br/>      "Missing Data. Please provide values for title, author, and rating."<br/>    );<br/>  const book = new Book({ title, author, rating });<br/>  return book.save();<br/>};<br/><br/>const listBooks = (Book) =&gt; () =&gt; {<br/>  return Book.find({});<br/>};<br/><br/>module.exports = (Book) =&gt; {<br/>  return {<br/>    addBook: addBook(Book),<br/>    listBooks: listBooks(Book),<br/>  };<br/>};</span></pre><p id="2fab" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">创建一个新文件，<code class="fe np nq nr ng b">book/index.js</code></p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="c6f9" class="nk lu in ng b gy nl nm l nn no">const Book = require("./book.model");<br/>const BookService = require("./book.service");<br/><br/>module.exports = BookService(Book);</span></pre><h1 id="c74c" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">添加API端点</h1><p id="afb9" class="pw-post-body-paragraph kx ky in kz b la mn jx lc ld mo ka lf lg nc li lj lk nd lm ln lo ne lq lr ls ig bi translated">让我们设置API端点，这些端点将用于添加和列出书店中当前可用的书籍。</p><p id="2241" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">创建一个名为<code class="fe np nq nr ng b">app.js</code>的文件</p><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="ed13" class="nk lu in ng b gy nl nm l nn no">"use strict";<br/>var express = require("express");<br/>var bodyParser = require("body-parser");<br/>var mongoose = require("mongoose");<br/><br/>const BookService = require("./book");<br/><br/>var app = express();<br/><br/>mongoose.Promise = global.Promise;<br/><br/>var uri = "mongodb://localhost:27017/bookstore";<br/>mongoose.connect(uri, {<br/>  useUnifiedTopology: true,<br/>  useNewUrlParser: true,<br/>});<br/><br/>app.use(<br/>  bodyParser.urlencoded({<br/>    extended: false,<br/>  })<br/>);<br/>app.use(bodyParser.json());<br/><br/>app.get("/listBooks", async function (req, res, next) {<br/>  try {<br/>    const books = await BookService.listBooks();<br/>    res.json(books);<br/>  } catch (e) {<br/>    next(e);<br/>  }<br/>});<br/><br/>app.get("/addBook", async function (req, res, next) {<br/>  const title = req.query.title;<br/>  const author = req.query.author;<br/>  const rating = req.query.rating;<br/><br/>  try {<br/>    const books = await BookService.addBook(title, author, rating);<br/>    res.json(books);<br/>  } catch (e) {<br/>    next(e);<br/>  }<br/>});<br/><br/>app.listen(3000, "0.0.0.0", function () {<br/>  console.log("server starting on localhost:3000");<br/>});</span></pre><h1 id="dde3" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">测试应用程序</h1><pre class="km kn ko kp gt nf ng nh ni aw nj bi"><span id="2df1" class="nk lu in ng b gy nl nm l nn no"><strong class="ng ix">node app</strong></span></pre><p id="5701" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">通过运行以下命令启动应用程序，</p><p id="2d55" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">书店应用程序的启动命令</p><p id="ea4f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">让我们打开Postman，尝试添加一本新书。</p><p id="7b4a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我们可以打开Compass并确认图书记录确实已经被添加。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ns"><img src="../Images/01177c317cff6d4a4338527dde0afd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-uzn9fPHKa5AN62W.png"/></div></div></figure><p id="8f7f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">让我们试着列出所有可得到的书。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/69a9b1696289dc3c01edd1c13a1d537d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5Oo6Cn3s4r7HzsZZ.png"/></div></div></figure><h1 id="b9d9" class="lt lu in bd lv lw lx ly lz ma mb mc md kc me kd mf kf mg kg mh ki mi kj mj mk bi translated">后续步骤</h1><p id="5779" class="pw-post-body-paragraph kx ky in kz b la mn jx lc ld mo ka lf lg nc li lj lk nd lm ln lo ne lq lr ls ig bi translated">在本教程中，我们将本地MongoDB服务器连接到Node.js应用程序，以便保存和读取数据。为<code class="fe np nq nr ng b">updateBook</code>和<code class="fe np nq nr ng b">deleteBook</code>添加端点以构建更多功能。添加一个简单的HTML页面，使用户可以轻松地创建和列出图书。</p><p id="2ab9" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在<a class="ae mw" href="https://twitter.com/sssaini_" rel="noopener ugc nofollow" target="_blank">推特</a>上找到我，我们聊聊:)</p></div><div class="ab cl nu nv hr nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ig ih ii ij ik"><p id="9edb" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><em class="ob">原载于2020年6月7日</em><a class="ae mw" href="https://saasbase.dev/build-a-restful-api-backend-on-mongodb-using-nodejs-and-mongoose/" rel="noopener ugc nofollow" target="_blank"><em class="ob">https://SaaS base . dev</em></a><em class="ob">。</em></p></div></div>    
</body>
</html>