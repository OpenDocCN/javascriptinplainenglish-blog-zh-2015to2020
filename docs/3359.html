<html>
<head>
<title>Maintainable JavaScript — Comparisons and Code Strings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可维护的JavaScript —比较和代码字符串</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/maintainable-javascript-comparisons-and-code-strings-ee2f821d0ed7?source=collection_archive---------5-----------------------#2020-09-22">https://javascript.plainenglish.io/maintainable-javascript-comparisons-and-code-strings-ee2f821d0ed7?source=collection_archive---------5-----------------------#2020-09-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e91a3c7161243b81fff85aad4d7253c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8vo0EkuVbPJwvhyg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@rajivperera?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Rajiv Perera</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c339" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果想继续使用代码，创建可维护的JavaScript代码很重要。</p><p id="9221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过比较和<code class="fe lb lc ld le b">eval</code>来了解创建可维护的JavaScript代码的基础。</p><h1 id="c516" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">布尔比较</h1><p id="b33e" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">与<code class="fe lb lc ld le b">==</code>和<code class="fe lb lc ld le b">!=</code>的布尔比较也会做一些我们意想不到的事情。</p><p id="bdf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为在比较完成之前，任何操作数都被转换为<code class="fe lb lc ld le b">true</code>或<code class="fe lb lc ld le b">false</code>。</p><p id="a096" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="1c08" class="mq lg iq le b gy mr ms l mt mu">console.log(1 == true);</span></pre><p id="6fea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe lb lc ld le b">true</code>，因为1被转换为<code class="fe lb lc ld le b">true</code>。</p><p id="c6f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，如果我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="ecaf" class="mq lg iq le b gy mr ms l mt mu">console.log(0 == false);</span></pre><p id="6250" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也long <code class="fe lb lc ld le b">true</code>，因为0是falsy，它被转换为<code class="fe lb lc ld le b">false</code>。</p><h1 id="3077" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">对象比较</h1><p id="6e88" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">如果对象被比较，就用<code class="fe lb lc ld le b">valueOf</code>方法将其转换成原始值。</p><p id="cafd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe lb lc ld le b">valueOf</code>不存在，则调用<code class="fe lb lc ld le b">toString</code>。</p><p id="b909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后比较继续进行，就像其他类型的比较一样。</p><p id="d6fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为如果我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="b25f" class="mq lg iq le b gy mr ms l mt mu">const object = {<br/>  toString() {<br/>    return "0xFF";<br/>  }<br/>};<br/>console.log(object == 255);</span></pre><p id="5d2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后控制台日志记录<code class="fe lb lc ld le b">true</code>，因为<code class="fe lb lc ld le b">object</code>用<code class="fe lb lc ld le b">toString</code>方法转换成字符串。</p><p id="b682" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后<code class="fe lb lc ld le b">Number</code>函数将其转换成十进制数。</p><h1 id="293e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">空值和未定义的值</h1><p id="3caa" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">此外，类型强制发生在<code class="fe lb lc ld le b">null</code>和<code class="fe lb lc ld le b">undefined</code>之间。</p><p id="0f45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们被<code class="fe lb lc ld le b">==</code>操作符认为是等价的。</p><p id="785b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="25d0" class="mq lg iq le b gy mr ms l mt mu">console.log(null == undefined);</span></pre><p id="d16b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后那个日志<code class="fe lb lc ld le b">true</code>。</p><h1 id="2d5a" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">===而且！==</h1><p id="76c2" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">类型强制是用<code class="fe lb lc ld le b">==</code>和<code class="fe lb lc ld le b">!=</code>完成的，所以我们不应该用它们来做比较。</p><p id="1760" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">强制规则太复杂了。</p><p id="44e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，我们应该使用<code class="fe lb lc ld le b">===</code>和<code class="fe lb lc ld le b">!==</code>操作符，它们不做任何类型强制。</p><p id="73de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="f386" class="mq lg iq le b gy mr ms l mt mu">console.log(5 === "5");</span></pre><p id="e924" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们记录<code class="fe lb lc ld le b">false</code>。</p><p id="0510" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="091f" class="mq lg iq le b gy mr ms l mt mu">console.log(25 === "0x19");</span></pre><p id="767d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也记录了<code class="fe lb lc ld le b">false</code>。</p><p id="bffe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="e5bb" class="mq lg iq le b gy mr ms l mt mu">const object = {<br/>  toString() {<br/>    return "0xFF";<br/>  }<br/>};<br/>console.log(object == 255);</span></pre><p id="5af2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也记录了<code class="fe lb lc ld le b">false</code>,因为没有进行类型强制。</p><p id="ea0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe lb lc ld le b">===</code>和<code class="fe lb lc ld le b">!==</code>是道格·克罗克福德的风格指南、谷歌风格指南等推荐的。</p><p id="6cec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这几乎是所有风格指南之间的普遍推荐。</p><p id="3f71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像ESLint和JSHint这样的Linters都警告我们使用了<code class="fe lb lc ld le b">==</code>和<code class="fe lb lc ld le b">!=</code>操作符。</p><h1 id="7c4c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">eval()</h1><p id="1afa" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lb lc ld le b">eval</code>是一个获取一串JavaScript代码并运行它的函数。</p><p id="be14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="009c" class="mq lg iq le b gy mr ms l mt mu">eval("console.log('hello')");</span></pre><p id="1f85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在控制台日志中记录<code class="fe lb lc ld le b">'hello'</code>。</p><p id="0390" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">eval</code>函数不是唯一一个从字符串运行JavaScript代码的函数。</p><p id="ee3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">setTimeout</code>和<code class="fe lb lc ld le b">setInterval</code>函数也接受一个函数并运行该代码。</p><p id="b3c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">Function</code>也接受带有参数和代码的字符串，并返回一个函数。</p><p id="247b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从JavaScript字符串运行代码被普遍认为是一种不好的做法，因为运行可能从任何来源运行的代码会带来安全问题。</p><p id="29cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，字符串中的JavaScript代码无法通过JavaScript引擎进行性能优化。</p><p id="42bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们不应该使用<code class="fe lb lc ld le b">eval</code>函数或<code class="fe lb lc ld le b">Function</code>构造函数。</p><p id="a596" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们应该在实际代码中使用<code class="fe lb lc ld le b">setTimeout</code>和<code class="fe lb lc ld le b">setInterval</code>，而不是字符串。</p><p id="9072" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们通过写来恰当地使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="af21" class="mq lg iq le b gy mr ms l mt mu">setTimeout(() =&gt; {<br/>  document.body.style.background = 'red';<br/>}, 50);</span><span id="f724" class="mq lg iq le b gy mv ms l mt mu">setInterval(() =&gt; {<br/>  document.title = `the tiome is ${new Date()}`;<br/>}, 1000);</span></pre><p id="63cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在回调中运行代码，而不是从字符串中运行代码。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/5f7c1e62b9c7b4aee097d515d97d8a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q6GctruFupg_d9oz"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@richard_bagan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Richard Bagan</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ab05" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="df4d" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们要用<code class="fe lb lc ld le b">===</code>和<code class="fe lb lc ld le b">!==</code>进行比较。</p><p id="7105" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们不应该从字符串中运行代码。</p><h2 id="d10f" class="mq lg iq bd lh mx my dn ll mz na dp lp ko nb nc lt ks nd ne lx kw nf ng mb nh bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="85e4" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>找到所有内容的链接！</p></div></div>    
</body>
</html>