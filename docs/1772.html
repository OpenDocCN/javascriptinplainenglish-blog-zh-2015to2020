<html>
<head>
<title>How to add Google Analytics to your Gatsby.js website</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将谷歌分析添加到你的Gatsby.js网站</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-connect-your-gatsby-js-landing-page-to-google-analytics-and-deploy-to-netlify-step-by-step-8352467583df?source=collection_archive---------0-----------------------#2020-04-21">https://javascript.plainenglish.io/how-to-connect-your-gatsby-js-landing-page-to-google-analytics-and-deploy-to-netlify-step-by-step-8352467583df?source=collection_archive---------0-----------------------#2020-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f975" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在用Gatsby.js、Netlify和Mailgun 一步一步地制作了联系表之后，我想继续我的系列文章，讲述如何一步一步地用Gatsby.js建立一个经典的登录页面。今天的文章将是关于设置谷歌分析。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/9efa36baa1dbca858d2c5ca11889bac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tI3hYxlIm5gRGCjTl030QA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">The traffic I wished I had on my website. Photo by <a class="ae kl" href="https://unsplash.com/@webaroo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Webaroo</a> on <a class="ae kl" href="https://unsplash.com/s/photos/analytics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5760" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将Google Analytics连接到您的登录页面非常重要。事实上，它允许你跟踪页面的使用情况。不久前，我与一位企业家交谈，她不明白为什么人们会在购买任何东西之前就离开她的网站。在快速浏览了一下她的分析后，我发现她的90%的用户都在使用移动设备，如果你使用移动设备，结账前的页面会弹出一个无法关闭的窗口。那么，让我们开始设置它:</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="22a3" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第一步。创建一个Gatsby.js启动器，并将其推送到GitHub上</h1><p id="417b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">如果您已经有了登录页面，您可以直接进入步骤2。</p><p id="3c7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和以前一样，我们将从创建一个Gatsby.js启动器开始。如果你还没有建立你的开发环境，你可以按照<a class="ae kl" href="https://www.gatsbyjs.org/tutorial/part-zero/" rel="noopener ugc nofollow" target="_blank">这个步骤</a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mm"><img src="../Images/f7d3620f5c19818e509bd321934f7898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNnYmwbgkpNEjJqWWnTmWA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Gatsby starter</figcaption></figure><p id="1ce1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，我们将创建一个新的gatsby站点，并使用以下命令进行第一次运行。</p><pre class="kn ko kp kq gt mn mo mp mq aw mr bi"><span id="4b0c" class="ms lk iq mo b gy mt mu l mv mw">gatsby new gatsby-site<br/>gatsby develop</span></pre><p id="7086" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你到了这里，你可以打开浏览器，进入<a class="ae kl" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>查看你的网站运行情况。</p><p id="dc3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将在Github上发布我们的代码。创建存储库后，Github会给出发布存储库的说明。如果您选择在命令行上创建一个新的存储库，那么您不需要添加一个read me，因为Gatsby.js starter已经提供了一个。</p><p id="0c4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想看的话，我在Github上的知识库可以在这里找到。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="9545" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第二步。创建您的谷歌分析帐户</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mx"><img src="../Images/0ba66be7448b440f490d5b51b0cfddb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTRU9aFgGdQ-oUX2vYXaIA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Create a Google Analytics account</figcaption></figure><p id="3cf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你上了<a class="ae kl" href="https://analytics.google.com/analytics/web/provision/?authuser=1#/provision" rel="noopener ugc nofollow" target="_blank">谷歌分析</a>，你就需要开一个账户。</p><p id="dd1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这非常简单，你只需要给你的项目取一个名字。</p><p id="85c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是棘手的部分。你必须选择你想测量的东西。在我们的例子中，它是一个“网站”。我第一次设置google analytics时，选择了“应用和网络”,但我从来没有成功地使用Gatsby.js。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mx"><img src="../Images/f9a898252bb449552af723f867997584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6q8G859QdovBMsvh7uWv9Q.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Pick Website</figcaption></figure><p id="acec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一部分，你必须填写你的财产细节。你可以在网址中看到，我放了一个随机的网址。一旦我们的网站部署在Netlify上，我们将改变这一点。如果你已经知道你的网址，请随意直接把它放上去。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mx"><img src="../Images/ce39ca8b8653ce5328811e5fcdd7ca06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzWzSE_QTkKY7wj1AVWChw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Create your google analytics account</figcaption></figure><p id="d5e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击创建，同意服务条款，你就都好了！谷歌会给你一个追踪ID。它应该出现在你点击创建后打开的页面上。如果不是，你可以在管理面板，跟踪信息，然后跟踪代码中找到它。你可以在紫色方块中看到它:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi my"><img src="../Images/aa8f8faad1cf49f0cd0db8a57912c231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtwMpuCy6KSrpG2yhWB2GQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Find your Tracking ID</figcaption></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="885a" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第三步:安装谷歌分析插件并进行设置</h1><p id="e548" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">首先，我们要做的是安装谷歌分析插件:</p><p id="b8fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mz na nb mo b">npm install --save gatsby-plugin-google-analytics</code></p><p id="99d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将根据最低需求对其进行配置:</p><pre class="kn ko kp kq gt mn mo mp mq aw mr bi"><span id="fe36" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir">// In your gatsby-config.js</strong></span><span id="39e2" class="ms lk iq mo b gy nc mu l mv mw">module.exports = {<br/>  plugins: [<br/>    {<br/>      resolve: `gatsby-plugin-google-analytics`,<br/>      options: {<br/>        // The property ID; the tracking code won't be generated without it<br/>        trackingId: "YOUR_GOOGLE_ANALYTICS_TRACKING_ID",<br/>      },<br/>    },<br/>  ],<br/>}</span></pre><p id="5d8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你所看到的，有一个空间来放置你的谷歌分析跟踪ID。您的谷歌分析跟踪ID是私人的，如果您不小心，它很容易被盗。它不应该被公开。所以比如<strong class="jp ir">不要在GitHub上推</strong>。这就是为什么我们要在设置中保存它们。</p><p id="62b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.gatsbyjs.org/docs/environment-variables/" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>需要在我们的函数文件中安装环境变量和几行代码(<code class="fe mz na nb mo b">npm install dotenv</code>):</p><pre class="kn ko kp kq gt mn mo mp mq aw mr bi"><span id="33e4" class="ms lk iq mo b gy mt mu l mv mw"><strong class="mo ir">// In your gatsby-config.js<br/></strong>// Gatsby settings for the environment variables</span><span id="3500" class="ms lk iq mo b gy nc mu l mv mw">require("dotenv").config({<br/>  path: `.env.${process.env.NODE_ENV}`,<br/>})</span></pre><p id="76dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以添加环境变量:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="cc84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要将它与你的谷歌分析连接起来，你需要在你的根文件夹中创建一个名为<code class="fe mz na nb mo b">.env.development</code>的文件。你应该小心这个文件的拼写，如果拼写不正确，它将无法工作。这个文件不会上传到Github上，因为这些类型的文件包含在Gatsby.js starter提供的git ignore中。</p><p id="f355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的<code class="fe mz na nb mo b">.env.development</code>文件将只包含一行:</p><pre class="kn ko kp kq gt mn mo mp mq aw mr bi"><span id="6b1d" class="ms lk iq mo b gy mt mu l mv mw">GA_TRACKING_ID="UA-163788217-1"</span></pre><p id="0c28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果你离开你的服务器(CTRL + C)并再次启动它(<code class="fe mz na nb mo b">gatsby develop</code>)。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="56f9" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第四步。在Netlify上部署并更新您的google analytics设置</h1><p id="bdaf" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">如果你还没有一个Netlify账户，在这里注册并点击右上角的按钮“来自Git的新网站”。然后，您将被重定向到一个新的屏幕，在这里您可以选择GitHub作为您的Git提供者。一旦它链接到GitHub并选择您之前创建的存储库。</p><p id="2702" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所知，您的google analytics跟踪ID在您的环境设置中。因此，一旦部署到Netlify上，不要忘记将它添加到部署设置中。</p><p id="7e79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，是时候在部署变量中添加您的google analytics跟踪ID了。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/f7863eb676488a1efa99c3f58acc31a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phmiKq5ERoGOEI82xQ952w.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Netlify settings before deployment</figcaption></figure><p id="a940" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，点击“部署网站”。</p><p id="fcb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您已经有一个已部署的登录页面，您可以通过进入设置，单击构建和部署(紫色方块)，然后单击环境(红色方块)。然后，在“编辑变量”(蓝色方块)中，您将能够为每个变量输入一个键和值的组合。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/67c6363cf707dfca056a233cd6592880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ds9e5Fgqlw5ULCdYJESFrA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Changing your environment variable from Netlify’s settings</figcaption></figure><p id="d2c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建完成后，您将能够看到您的站点URL。所以，现在你可以回到你的谷歌分析仪表板，进入你的属性设置(红色方块)并更新你的默认网址(紫色方块):</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/ece1f0ec57af22b46890f7371ef6b37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dwfSaD-j4-g3wYAWx3qUdw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Property settings to change</figcaption></figure><p id="aa29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，不要忘记保存页面底部。几分钟后，你可以进入跟踪信息(紫色方块)，点击“发送流量请求”(红色方块)。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/3fe4e4f6361c9cd11670b4ed40c68724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bHiC4fms7aYJfJ0zwjasQw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Traffic Test</figcaption></figure><p id="efef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你点击了这个按钮，它就会在一个新的页面上打开你的网站。一旦你重新加载谷歌分析，你会看到有人(猜猜谁是🕵️‍♀️🔎？)连接到您的网站。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/ce31e7f5575492cf8bcb3046db5872d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TaY8nRIIMusG6UVh406xEQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Result of the traffic test</figcaption></figure><p id="1902" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜🎉，一切正常，你的网站连接到谷歌分析。如果你在路上迷路了，我们会在这里结束。</p></div></div>    
</body>
</html>