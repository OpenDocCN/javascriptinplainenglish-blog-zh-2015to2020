<html>
<head>
<title>Making Requests with the Angular HTTP Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular HTTP客户端发出请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-requests-with-the-angular-http-client-f9030c925206?source=collection_archive---------8-----------------------#2020-04-22">https://javascript.plainenglish.io/making-requests-with-the-angular-http-client-f9030c925206?source=collection_archive---------8-----------------------#2020-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7884d31150b8f8ba23d65363a8d77079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P7-fSz3X9JG7L8nJ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@sne5ha?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sneha</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0438" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Angular是Google制作的一个流行的前端框架。像其他流行的前端框架一样，它使用基于组件的架构来构建应用程序。</p><p id="a4ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何使用Angular <code class="fe lb lc ld le b">HttpClient</code>来发出HTTP请求。</p><h1 id="37f0" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">设置</h1><p id="90b8" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">要使用Angular HTTP客户端，我们必须导入<code class="fe lb lc ld le b">HttpClientModule</code>。</p><p id="d25f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以这样做:</p><p id="be70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.module.ts</code>:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="6fe5" class="mq lg iq le b gy mr ms l mt mu">import { BrowserModule } from "@angular/platform-browser";<br/>import { NgModule } from "@angular/core";<br/>import { HttpClientModule } from "@angular/common/http";<br/>import { AppComponent } from "./app.component";</span><span id="a08d" class="mq lg iq le b gy mv ms l mt mu">@NgModule({<br/>  declarations: [AppComponent],<br/>  imports: [BrowserModule, HttpClientModule],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule {}</span></pre><p id="7dad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们这样做了，我们必须注入<code class="fe lb lc ld le b">HttpClient</code>模块作为依赖项，如下所示:</p><p id="18f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.component.ts</code>:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="5085" class="mq lg iq le b gy mr ms l mt mu">import { Component } from "@angular/core";<br/>import { HttpClient } from "@angular/common/http";</span><span id="c2bd" class="mq lg iq le b gy mv ms l mt mu">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  constructor(private http: HttpClient) {}<br/>}</span></pre><h1 id="f283" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">提出请求</h1><p id="c920" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">为了发出请求，我们通过调用<code class="fe lb lc ld le b">http</code>模块中可用的方法来调用请求方法。</p><p id="9123" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们想发出一个GET请求，我们可以写如下:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="8cf3" class="mq lg iq le b gy mr ms l mt mu">import { Component } from "@angular/core";<br/>import { HttpClient } from "@angular/common/http";</span><span id="c4a1" class="mq lg iq le b gy mv ms l mt mu">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  constructor(private http: HttpClient) {}</span><span id="6961" class="mq lg iq le b gy mv ms l mt mu">  ngOnInit() {<br/>    this.getPost();<br/>  }</span><span id="23e0" class="mq lg iq le b gy mv ms l mt mu">  getPost() {<br/>    this.http<br/>      .get("https://jsonplaceholder.typicode.com/posts/1")<br/>      .subscribe(res =&gt; console.log(res));<br/>  }<br/>}</span></pre><p id="363a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们用我们可以向其发出请求的URL调用了<code class="fe lb lc ld le b">get</code>方法。然后我们订阅带有<code class="fe lb lc ld le b">subscribe</code>的响应。</p><p id="879f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">res</code>已响应的数据。</p><p id="2635" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有更大的应用程序，我们应该编写服务来保存HTTP请求代码，这样我们就可以在多个地方使用这些方法。</p><h1 id="19c9" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">请求键入的响应</h1><p id="ea16" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以在响应中添加类型注释，这样我们就可以自动完成响应。</p><p id="e2d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以通过运行以下命令来创建一个接口:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="ab09" class="mq lg iq le b gy mr ms l mt mu">ng g interface post</span></pre><p id="f6c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lb lc ld le b">post.ts</code>中，我们添加:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="138a" class="mq lg iq le b gy mr ms l mt mu">export interface Post {<br/>    userId: number,<br/>    id: number,<br/>    title: string,<br/>    body: string,<br/>}</span></pre><p id="2792" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后在<code class="fe lb lc ld le b">app.component.ts</code>中，我们写道:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="3cdb" class="mq lg iq le b gy mr ms l mt mu">import { Component } from "@angular/core";<br/>import { HttpClient } from "@angular/common/http";<br/>import { Post } from './post';</span><span id="0321" class="mq lg iq le b gy mv ms l mt mu">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  post: Post;<br/>  constructor(private http: HttpClient) { }</span><span id="0d0c" class="mq lg iq le b gy mv ms l mt mu">  ngOnInit() {<br/>    this.getPost();<br/>  }</span><span id="efbf" class="mq lg iq le b gy mv ms l mt mu">  getPost() {<br/>    this.http<br/>      .get&lt;Post&gt;("https://jsonplaceholder.typicode.com/posts/1")<br/>      .subscribe(post =&gt; {<br/>        this.post = post;<br/>      });<br/>  }<br/>}</span></pre><p id="a682" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们确保我们的响应是类型<code class="fe lb lc ld le b">Post</code>。我们将<code class="fe lb lc ld le b">post</code>设置为类型<code class="fe lb lc ld le b">Post</code>，它仍然可以编译和运行。</p><p id="e49f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将JSON转换为我们在传递到括号中的类型名中指明的数据类型。</p><h1 id="9e87" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">阅读完整回复</h1><p id="08b7" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">observe</code>选项获得完整响应，如下所示:</p><p id="920c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.component.ts</code>:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="e8bd" class="mq lg iq le b gy mr ms l mt mu">import { Component } from "<a class="ae kc" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>";<br/>import { HttpClient } from "<a class="ae kc" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http";<br/>import { Post } from './post';</span><span id="b9b9" class="mq lg iq le b gy mv ms l mt mu"><a class="ae kc" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  post: Post;<br/>  headers;<br/>  constructor(private http: HttpClient) { }</span><span id="f5f7" class="mq lg iq le b gy mv ms l mt mu">  ngOnInit() {<br/>    this.getPost();<br/>  }</span><span id="92f2" class="mq lg iq le b gy mv ms l mt mu">  getPost() {<br/>    this.http<br/>      .get&lt;Post&gt;("https://jsonplaceholder.typicode.com/posts/1", { observe: 'response' })<br/>      .subscribe(res =&gt; {<br/>        const keys = res.headers.keys();<br/>        this.headers = keys.map(key =&gt;<br/>          `${key}: ${res.headers.get(key)}`);<br/>        this.post = { ...res.body };<br/>      });<br/>  }<br/>}</span></pre><p id="e87f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们使用带有对象中的<code class="fe lb lc ld le b">observe</code>的<code class="fe lb lc ld le b">'response'</code>值的<code class="fe lb lc ld le b">get</code>方法，并将其传递给第二个参数以获得完整的响应。</p><p id="ddc5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lb lc ld le b">subscribe</code>回调中，我们用<code class="fe lb lc ld le b">res.header.keys()</code>得到响应头键，用<code class="fe lb lc ld le b">res.body</code>得到响应体。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/237aac00eaf24a561e99bf5ba420c048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ck5v2enE99OzC0Ug"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@bgauzere?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Benoit Gauzere</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f7f8" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">发出JSONP请求</h1><p id="fe12" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">要发出JSONP请求，我们必须将<code class="fe lb lc ld le b">HttpClientJsonpModule</code>添加到应用程序的模块中。然后我们调用<code class="fe lb lc ld le b">http.jsonp</code>方法来发出请求。</p><p id="1d66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了做到这一切，我们写道:</p><p id="2b43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.module.ts</code>:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="98b8" class="mq lg iq le b gy mr ms l mt mu">import { BrowserModule } from "@angular/platform-browser";<br/>import { NgModule } from "@angular/core";<br/>import { HttpClientModule, HttpClientJsonpModule } from "@angular/common/http";<br/>import { AppComponent } from "./app.component";</span><span id="f01c" class="mq lg iq le b gy mv ms l mt mu">@NgModule({<br/>  declarations: [AppComponent],<br/>  imports: [BrowserModule, HttpClientModule, HttpClientJsonpModule],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule { }</span></pre><p id="9ea6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">app.component.ts</code>:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="1338" class="mq lg iq le b gy mr ms l mt mu">import { Component } from "@angular/core";<br/>import { HttpClient } from "@angular/common/http";<br/>import { Post } from './post';</span><span id="434b" class="mq lg iq le b gy mv ms l mt mu">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  post: Post;<br/>  headers;<br/>  constructor(private http: HttpClient) { }</span><span id="88f4" class="mq lg iq le b gy mv ms l mt mu">  ngOnInit() {<br/>    this.getPost();<br/>  }</span><span id="3491" class="mq lg iq le b gy mv ms l mt mu">  getPost() {<br/>    this.http.jsonp&lt;Post&gt;("https://jsonplaceholder.typicode.com/posts/1", 'callback')<br/>      .subscribe(post =&gt; {<br/>        this.post = post;<br/>      })<br/>  }<br/>}</span></pre><p id="3cd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们将<code class="fe lb lc ld le b">HttpClientJsonpModule</code>放入<code class="fe lb lc ld le b">AppModule</code>。</p><p id="7e19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe lb lc ld le b">http.jsonp</code>来发出我们想要的请求，并在订阅回调中得到响应。</p><h1 id="2926" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="8c02" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">Angular附带了一个HTTP客户端来发出HTTP请求。</p><p id="5019" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须添加<code class="fe lb lc ld le b">HttpClientModule</code>来使用我们应用程序模块中的客户端。</p><p id="af4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了发出请求，我们调用请求方法，然后调用<code class="fe lb lc ld le b">subscribe</code>并在回调中获取数据。</p><p id="6049" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，它只发出响应正文，但是也可以配置它来获得整个响应。</p><h2 id="c128" class="mq lg iq bd lh mx my dn ll mz na dp lp ko nb nc lt ks nd ne lx kw nf ng mb nh bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="3982" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们已经推出了三种新的出版物！<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"> <strong class="kf ir"> AI说白了</strong></a><a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX说白了</strong></a><a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python说白了</strong> </a> <strong class="kf ir">。跟随你感兴趣的人继续你的成长——谢谢，继续学习！</strong></p><p id="2c5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>