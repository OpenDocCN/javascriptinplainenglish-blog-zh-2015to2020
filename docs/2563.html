<html>
<head>
<title>Writing Better GET Requests With TDD in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript中用TDD编写更好的GET请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/writing-better-http-get-requests-with-tdd-in-javascript-daef16d9ead?source=collection_archive---------10-----------------------#2020-07-05">https://javascript.plainenglish.io/writing-better-http-get-requests-with-tdd-in-javascript-daef16d9ead?source=collection_archive---------10-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="78b0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以测试驱动的开发方式编写代码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/44b9f842353039c6f4485e0dfb74249b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtUu0b2ib_LROGXkWoqjrg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@atik1616?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Atik sulianami</a> on <a class="ae kv" href="https://unsplash.com/s/photos/network?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="22b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试驱动开发也称为TDD是一种软件开发方法，在这种方法中，您必须在编写任何功能代码之前编写测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/3d41701ab5f213ad3c38ce2229b881a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIhZrjXhmItUVSIaY3nzDA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Demonstration of TDD. Failed test → Pass Test → Refactor</figcaption></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="2db3" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">概观</h2><p id="8490" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">这里我们有一个GET API:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="1142" class="ma mb iq mz b gy nd ne l nf ng">url = "https://jsonplaceholder.typicode.com/photos"</span></pre><p id="3bec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它返回如下所示的对象数组:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="0fa2" class="ma mb iq mz b gy nd ne l nf ng">[<br/>  {<br/>    "albumId": 1,<br/>    "id": 1,<br/>    "title": "accusamus beatae ad facilis cum similique qui sunt",<br/>    "url": "https://via.placeholder.com/600/92c952",<br/>    "thumbnailUrl": "https://via.placeholder.com/150/92c952"<br/>  },<br/>  {<br/>    "albumId": 1,<br/>    "id": 2,<br/>    "title": "reprehenderit est deserunt velit ipsam",<br/>    "url": "https://via.placeholder.com/600/771796",<br/>    "thumbnailUrl": "https://via.placeholder.com/150/771796"<br/>  }<br/>]</span></pre><p id="186b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将创建一个API管理器类，它在内部使用<a class="ae kv" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Axios </strong> </a>来实现REST。</p><p id="a1a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们必须创建一个名为<strong class="ky ir"> ApiManager.js </strong>的类和相应的名为<strong class="ky ir"> ApiManager.test.js </strong>的测试文件</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="82bf" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">编写基本测试和类对象</h2><p id="a95a" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">让我们从编写一些测试开始。假设我们的ApiManager类需要用某个url实例化，并且apiManagerInstance有一个名为url的属性要用构造函数实例化。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="82b3" class="ma mb iq mz b gy nd ne l nf ng">import ApiManager from "./ApiManager";</span><span id="b13d" class="ma mb iq mz b gy nh ne l nf ng">describe('ApiManager Construction test', () =&gt; {<br/> <br/> const mockURL = "https://mockurl.com"; //<br/> let instance = new ApiManager(mockURL);<br/> <br/> it("instance url property set properly",()=&gt;{<br/>    expect(instance.url).toEqual(mockURL)<br/> })</span><span id="8840" class="ma mb iq mz b gy nh ne l nf ng">})</span></pre><p id="a5d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试显然会失败，因为我们在<strong class="ky ir"> ApiManager.js. </strong>中什么都没有</p><p id="de0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们编写代码来通过<strong class="ky ir"> ApiManager.js. </strong>中的测试</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="ae16" class="ma mb iq mz b gy nd ne l nf ng">export default class ApiManager{<br/> <br/> constructor(url){<br/>     this.url = url<br/> }</span><span id="76f7" class="ma mb iq mz b gy nh ne l nf ng">}</span></pre><p id="46a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们的测试通过了，是时候重构实际的实现了。似乎一切都很好。所以没什么可重构的。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="0c18" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">使用测试驱动开发获取方法实现</h2><p id="111c" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">现在我们的ApiManager将有一个getPhotos方法，该方法将返回一个包含来自对象的必要数据的照片数组。对于我们的例子，我们只需要来自对象{相册id，url }的两个字段</p><p id="8a0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">场景将会是这样的</p><ul class=""><li id="ebee" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated">ApiManager将有一个名为<strong class="ky ir"> getPhotos </strong>的方法</li><li id="e41a" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">getPhotos将使用<strong class="ky ir"> instance.url </strong>调用axios get方法</li><li id="f5bd" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">getPhotos将从axios.get返回的对象数组中返回包含<strong class="ky ir">{相册id，url } </strong>的数组。</li><li id="1b1c" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">如果axios.get返回错误，getPhotos将<strong class="ky ir">抛出</strong>错误</li></ul><h2 id="8339" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">设置</h2><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="867d" class="ma mb iq mz b gy nd ne l nf ng">describe('getPhotos method Test', () =&gt; {<br/>    <br/>  const mockURL = "https://mockurl.com";<br/>  let instance = new ApiManager(mockURL);</span><span id="7985" class="ma mb iq mz b gy nh ne l nf ng">     // Our Test cases will Goes Here !!!!<br/>}</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="7e5d" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">场景1 : ApiManager将有一个名为getPhotos的方法</h2><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="c08f" class="ma mb iq mz b gy nd ne l nf ng">it(“getPhotos method defined”,()=&gt;{<br/>  expect(instance.getPhotos).toBeDefined();<br/>})</span></pre><p id="5728" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要通过这种情况，编写一个名为getPhotos的方法</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="5b21" class="ma mb iq mz b gy nd ne l nf ng">getPhotos(){</span><span id="3dea" class="ma mb iq mz b gy nh ne l nf ng">}</span></pre><p id="5215" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在测试通过了。👌</p><h2 id="c78c" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">场景2 : getPhotos将使用instance.url调用axios get方法</h2><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="e35b" class="ma mb iq mz b gy nd ne l nf ng">it(“getPhotos will call axios.get method with instance.utl”,()=&gt;{<br/>  <br/>  jest.spyOn(Axios,”get”) // Axios get need to be spied by Jest <br/>  <br/>  instance.getPhotos(); //<br/>  expect(Axios.get).toHaveBeenCalledWith(instance.url);</span><span id="b3f3" class="ma mb iq mz b gy nh ne l nf ng">})</span></pre><p id="a0cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向右失败。别担心。让我们超过他们</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="5bc1" class="ma mb iq mz b gy nd ne l nf ng">getPhotos(){<br/>  Axios.get(this.url)<br/>}</span></pre><p id="1451" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在它又要过去了，✔️。</p><h2 id="517a" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">场景3 : getPhotos将返回{相册id，url }的数组</h2><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="4eef" class="ma mb iq mz b gy nd ne l nf ng">it("getPhotos will return proper array of object for axios mock response",async ()=&gt;{</span><span id="7155" class="ma mb iq mz b gy nh ne l nf ng"><br/>const mockPhotos = [{ <br/>  "albumId": 1,<br/>  "id": 1,<br/>  "title": "accusamus beatae ad facilis cum similique qui sunt",<br/>  "url": "https://via.placeholder.com/600/92c952",<br/>  "thumbnailUrl": "https://via.placeholder.com/150/92c952"},<br/> { <br/>  "albumId": 1,<br/>  "id": 2,<br/>  "title": "reprehenderit est deserunt velit ipsam",<br/>  "url": "https://via.placeholder.com/600/771796",<br/>  "thumbnailUrl": "https://via.placeholder.com/150/771796"<br/>}]<br/>const expectedResponse =[ {<br/> "albumId": 1,<br/> "url": "https://via.placeholder.com/600/92c952",<br/> },<br/>{<br/> "albumId": 1,<br/> "url": "https://via.placeholder.com/600/771796",<br/>}]</span><span id="6e57" class="ma mb iq mz b gy nh ne l nf ng"> jest.spyOn(Axios,"get").mockResolvedValueOnce(mockPhotos);<br/> const response = await instance.getPhotos();<br/> expect(response).toEqual(expectedResponse);</span><span id="baf9" class="ma mb iq mz b gy nh ne l nf ng">})</span></pre><p id="4418" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过这个</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="7f15" class="ma mb iq mz b gy nd ne l nf ng">getPhotos(){<br/> return  new Promise((resolve,reject)=&gt;{<br/>    Axios.get(this.url).then(response=&gt;{<br/>       const filterArr = response.map(item=&gt; {<br/>           return {<br/>                "albumId": item.albumId,<br/>                "url": item.url<br/>                }<br/>        })<br/>       resolve(filterArr)<br/> }).catch(error=&gt;{<br/>       <br/> })</span><span id="31fe" class="ma mb iq mz b gy nh ne l nf ng">});</span><span id="a103" class="ma mb iq mz b gy nh ne l nf ng">}</span></pre><p id="5c1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太棒了，现在一切都好了。对吗？🤘</p><h2 id="ca4b" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">场景4:如果axios.get返回错误，getPhotos将抛出错误</h2><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="c786" class="ma mb iq mz b gy nd ne l nf ng">it("getPhotos will throw error if axios.get return error",async ()=&gt;{<br/> const mockError = {<br/>    error:{<br/>       msg:"Something Wrong"<br/>    }<br/> }</span><span id="54f6" class="ma mb iq mz b gy nh ne l nf ng"> jest.spyOn(Axios,"get").mockRejectedValueOnce(mockError);<br/> await instance.getPhotos().catch(error=&gt;{<br/> expect(error.error.msg).toEqual("Something Wrong")<br/> });</span><span id="09fb" class="ma mb iq mz b gy nh ne l nf ng">})</span></pre><p id="d349" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过只添加一行来解决这个问题，即<strong class="ky ir">拒绝(错误)</strong>在catch块内。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="fb4f" class="ma mb iq mz b gy nd ne l nf ng">getPhotos(){<br/> return  new Promise((resolve,reject)=&gt;{<br/>    Axios.get(this.url).then(response=&gt;{<br/>       const filterArr = response.map(item=&gt; {<br/>           return {<br/>                "albumId": item.albumId,<br/>                "url": item.url<br/>                }<br/>        })<br/>       resolve(filterArr)<br/> }).catch(error=&gt;{<br/>       reject(error) // only add this<br/>})</span><span id="42bf" class="ma mb iq mz b gy nh ne l nf ng">});</span><span id="6c7c" class="ma mb iq mz b gy nh ne l nf ng">}</span></pre><p id="e5ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在已经过去了，对吗？✔️</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="add6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得称赞。通过采用测试驱动开发，我们有了HTTP GET的完整实现。👍🏻</p><p id="5e78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:如果需要的话，记得在通过测试用例之后进行重构。</p><h1 id="3548" class="nw mb iq bd mc nx ny nz mf oa ob oc mi jw od jx ml jz oe ka mo kc of kd mr og bi translated">感谢阅读！🍻</h1></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="7929" class="ma mb iq bd mc md me dn mf mg mh dp mi lf mj mk ml lj mm mn mo ln mp mq mr ms bi translated">简单英语的JavaScript</h2><p id="3560" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">订阅我们的YouTube频道</strong> </a> <strong class="ky ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>