<html>
<head>
<title>Building a React “Ice Cream finder” App with the Google Maps API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Google Maps API构建一个React“冰激凌查找器”应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-react-ice-cream-finder-app-with-the-google-maps-api-7e39339e0261?source=collection_archive---------1-----------------------#2019-04-17">https://javascript.plainenglish.io/building-a-react-ice-cream-finder-app-with-the-google-maps-api-7e39339e0261?source=collection_archive---------1-----------------------#2019-04-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/11e702a260b641945212b3fcfe1202fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jVMwaRiATo6cpLj65IX7yw.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Get yo Ice creams</figcaption></figure><h1 id="ed40" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">冰淇淋！</h1><p id="fa58" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">现在我已经引起了你的注意…</p><p id="1297" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">用一个新的库创建任何自定义组件总是很困难的。谷歌地图应用编程接口的情况更加夸张，这里不是只有一个，而是有几个你必须学习的T2应用编程接口。</p><p id="1843" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">在本帖中，我们将使用谷歌地图API创建一个React web应用程序，以<strong class="lc ir">过滤乘车前往</strong>一段时间内供应冰淇淋的地点列表。</p><p id="988e" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated"><a class="ae md" href="https://github.com/marxlow/google-maps-component-guide" rel="noopener ugc nofollow" target="_blank">Github上的完整源代码在这里</a>。</p><h1 id="1644" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">放弃</h1><p id="cf5d" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">让我先说谷歌地图API是一个非常强大的服务。但是随着强大的能力而来的是大量的文档。</p><p id="6fbc" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">这篇文章的目标不是涵盖Google Maps API的所有功能。谷歌已经在这方面做得非常出色。</p><p id="6ae4" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">然而，您将学到的是足够的知识来导航他们的许多服务，并希望能够在它们的基础上构建您自己的组件。</p><p id="c685" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">我们将专注于构建谷歌地图的三个主要服务。</p><ul class=""><li id="0b01" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">自动完成-查找位置作为行驶时间的参考点。</li><li id="a07d" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">地点——找到卖冰淇淋的地方。</li><li id="9061" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">方向-过滤行驶时间限制内的地点。</li></ul></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h2 id="f96b" class="mz kd iq bd ke na nb dn ki nc nd dp km ll ne nf kq lp ng nh ku lt ni nj ky nk bi translated">设置—获取Google Maps API密钥</h2><ol class=""><li id="1f79" class="me mf iq lc b ld le lh li ll nl lp nm lt nn lx no mk ml mm bi translated">首先，按照这里的指南<a class="ae md" href="https://developers.google.com/maps/documentation/embed/get-api-key" rel="noopener ugc nofollow" target="_blank">注册谷歌云平台</a>。在注册时，你应该会得到价值400美元的信用点数，所以不要担心被收费。</li><li id="0edb" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx no mk ml mm bi translated">登录后，导航至<a class="ae md" href="https://console.cloud.google.com/apis/" rel="noopener ugc nofollow" target="_blank">控制台</a>，点击“启用API和服务”以搜索并添加以下4项服务。<br/> <strong class="lc ir">地点，地图Javascript，地理编码，</strong>和<strong class="lc ir">方向</strong> API。</li><li id="3539" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx no mk ml mm bi translated">通过在控制台上导航，搜索上述服务的API密钥。(重要:确保这也是您其余服务的相同密钥)<br/>位置API →凭证→密钥</li></ol><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/2ab7f0cae41d532fd8d38c73ed0928dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2aNf0HA4a3ytDACLxC1RQA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Cloud Console Dashboard</figcaption></figure><h2 id="a6ef" class="mz kd iq bd ke na nb dn ki nc nd dp km ll ne nf kq lp ng nh ku lt ni nj ky nk bi translated">创建地图组件</h2><p id="76de" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">首先，安装React <a class="ae md" href="https://github.com/google-map-react/google-map-react" rel="noopener ugc nofollow" target="_blank">谷歌地图库</a>。</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="4f48" class="mz kd iq nv b gy nz oa l ob oc">npm install google-map-react</span></pre><p id="f49f" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">安装了库之后，我们可以创建第一个组件来加载地图。姑且称之为<code class="fe od oe of nv b">MapContainer.js</code>。代码:</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="ee5f" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">一些笔记。</p><ul class=""><li id="64fa" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">记得使用你自己的API密匙。</li><li id="bb9c" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">在渲染我们的<code class="fe od oe of nv b">MapContainer.js</code>时，我们应该看到由<code class="fe od oe of nv b">defaultCenter</code>和<code class="fe od oe of nv b">defaultZoom</code>字段设置的以<strong class="lc ir">新加坡</strong>为中心的地图。</li></ul><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/7d064fa21560336d9eb2c7b529ff1880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9NJamwMSw2rA6pfydS4HYw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Rendered Google Maps Component</figcaption></figure><ul class=""><li id="322f" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">我们想要使用的库必须被明确声明，这样我们才能访问它们的服务。参考<code class="fe od oe of nv b">bootstrapURLKeys</code>处的字段。</li><li id="42d4" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">我们可以将标记(谷歌地图上的大头针)渲染成<code class="fe od oe of nv b">&lt;GoogleMapReact&gt;</code>的孩子。</li></ul><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="41ec" class="mz kd iq nv b gy nz oa l ob oc">&lt;GoogleMapReact ... &gt;<br/>  &lt;AnyReactComponent lat={123} lng={123} name="Some pin"/&gt;<br/>&lt;/GoogleMapReact&gt;</span></pre><ul class=""><li id="64a2" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">我们的<code class="fe od oe of nv b">&lt;GoogleMapReact&gt;</code>组件<strong class="lc ir">必须由父HTML标签包装</strong>。</li><li id="b375" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">父HTML标签必须显式设置其<strong class="lc ir">高度</strong>。你会发现<code class="fe od oe of nv b">h-lg</code> CSS类是这样声明的:</li></ul><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="7929" class="mz kd iq nv b gy nz oa l ob oc">.h-lg {<br/>  height: 35rem; // This will work<br/>  /* height: 100%; This will NOT work */<br/>}</span></pre><h2 id="bc72" class="mz kd iq bd ke na nb dn ki nc nd dp km ll ne nf kq lp ng nh ku lt ni nj ky nk bi translated">创建自动完成组件</h2><p id="0007" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">随着地图的加载，我们终于可以开始访问它的服务了。</p><p id="39ac" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">我们这样做的方式是通过我们的地图库提供的<code class="fe od oe of nv b">onGoogleApiLoaded</code>字段。该字段接受一个回调函数，该函数在地图加载后运行。</p><p id="5bc5" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated"><code class="fe od oe of nv b">onGoogleApiLoaded</code>给我们两个对象，分别是<code class="fe od oe of nv b">map</code> &amp; <code class="fe od oe of nv b">maps</code>。对于我们的自动完成组件，我们只对<code class="fe od oe of nv b">maps</code>中的感兴趣，这使我们能够访问我们的<strong class="lc ir">自动完成服务</strong> <strong class="lc ir"> API </strong>。让我们将它加载到我们的<code class="fe od oe of nv b">mapsContainer</code>状态中。</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="7cc8" class="mz kd iq nv b gy nz oa l ob oc">// maps === mapsApi. But I changed it for clearer naming.</span><span id="303e" class="mz kd iq nv b gy oj oa l ob oc">apiHasLoaded = ((map, mapsApi) =&gt; {<br/>  this.setState({<br/>    mapsApi,<br/>    autoCompleteService: new mapsApi.places.AutocompleteService(),<br/>    placesService: new mapsApi.places.PlacesService(map),<br/>    directionService: new mapsApi.DirectionsService(),<br/>    geoCoderService: new mapsApi.Geocoder(),<br/>    singaporeLatLng: new mapsApi.LatLng(1.3521, 103.8198)<br/>});</span></pre><p id="f4e7" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">现在，我们可以将API传递给自动完成组件，以便从文本中检索地点建议。我将使用<strong class="lc ir">和</strong>库来自动完成<a class="ae md" href="https://ant.design/components/auto-complete/#header" rel="noopener ugc nofollow" target="_blank">。代码:</a></p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="3b9e" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">再来点笔记。</p><ul class=""><li id="d583" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">检查我们的<code class="fe od oe of nv b">MapAutoComplete.js</code>组件是否工作。</li></ul><figure class="nq nr ns nt gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/5d4bcaf623bf39bf06dd9a6231044530.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*m1ua06V7mtSVnlV_ffKKKA.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Hello World is actually a real place…</figcaption></figure><ul class=""><li id="066e" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">我们的<code class="fe od oe of nv b">onSelect</code>(第28行)函数需要<code class="fe od oe of nv b">geoCoderService</code>来帮助我们检索地址字符串的经度和纬度信息。这些是我们在地图上绘制标记所需的信息。</li><li id="8ecf" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">您可以通过<code class="fe od oe of nv b">location</code>(使用mapsApi创建的特殊<strong class="lc ir"> LatLng </strong>对象)和<code class="fe od oe of nv b">searchQuery</code>中的<code class="fe od oe of nv b">radius</code> (int)字段来配置搜索。</li><li id="90c6" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">为了从一个字符串中获得建议位置的列表，我们必须调用函数<code class="fe od oe of nv b">getQueryPredictions(searchQuery, callback function)</code>。搜索结果可以在我们的回调函数中访问。</li><li id="ec86" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">回调函数中的<code class="fe od oe of nv b">response</code>对象是一个形状为:</li></ul><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="63d6" class="mz kd iq nv b gy nz oa l ob oc">[ { description: 'Place A' ... }, { description: 'Place B' ... }]</span></pre><h2 id="00f4" class="mz kd iq bd ke na nb dn ki nc nd dp km ll ne nf kq lp ng nh ku lt ni nj ky nk bi translated">当下</h2><p id="6813" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">是的，我们已经到了。</p><h2 id="3b1b" class="mz kd iq bd ke na nb dn ki nc nd dp km ll ne nf kq lp ng nh ku lt ni nj ky nk bi translated">寻找冰淇淋</h2><p id="95ed" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们现在将为冰淇淋构建我们的<strong class="lc ir">搜索&amp;过滤函数</strong>。我们只需要两项服务。</p><ul class=""><li id="b8fe" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated"><code class="fe od oe of nv b">placesService</code>:查找提供冰淇淋的地方(咖啡馆&amp;餐馆)列表。</li><li id="6bfb" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated"><code class="fe od oe of nv b">directionService</code>:从一个位置检索每个地方的旅行时间(设置这个位置可以在我们的自动完成组件中完成。参考源代码)</li></ul><p id="693f" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">您可以在<code class="fe od oe of nv b">MapContainer.js</code>中构建这个功能，或者将其重构为一个更小的组件(将这些服务作为道具传递给另一个组件，如<code class="fe od oe of nv b">MapAutoComplete.js</code>)。我选择了前者。</p><p id="d603" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">让我们来看一下这个函数的代码。应该比较直截了当。</p><figure class="nq nr ns nt gt jr"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="df05" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">更多注意事项:</p><ul class=""><li id="5f98" class="me mf iq lc b ld ly lh lz ll mg lp mh lt mi lx mj mk ml mm bi translated">【步骤1】<code class="fe od oe of nv b">types</code>(第9行)是搜索中包含的字符串数组。选项非常广泛，有关支持类型的完整列表，请查看此处的<a class="ae md" href="https://developers.google.com/places/supported_types" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="6f8d" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">[步骤3]我们的<code class="fe od oe of nv b">iceCreamPlace</code>对象(第20行)包含许多其他字段，如照片URL、价格水平、评级等等。有关返回响应的更多信息，请查看这里的<a class="ae md" href="https://developers.google.com/places/web-service/search" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="bbba" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">[Step 4–5]有关directionsService的请求和返回响应的更多信息，请查看此处<a class="ae md" href="https://developers.google.com/maps/documentation/javascript/directions" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="a4c5" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">并非文档中提到的所有字段都被返回。一定要测试。</li><li id="00e4" class="me mf iq lc b ld mn lh mo ll mp lp mq lt mr lx mj mk ml mm bi translated">【第七步，*重要*】确保你的总决赛成绩<code class="fe od oe of nv b">setState</code>的代码<strong class="lc ir">在</strong> <code class="fe od oe of nv b">placesService.TextSearch</code> <strong class="lc ir">回调函数</strong>的范围内。这是为了避免运行空数组<code class="fe od oe of nv b">setState</code>的风险，因为异步回调函数还没有执行完。</li></ul></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h2 id="95f1" class="mz kd iq bd ke na nb dn ki nc nd dp km ll ne nf kq lp ng nh ku lt ni nj ky nk bi translated">结论</h2><p id="cb0b" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我只介绍了应用程序的重要功能和组件。在<a class="ae md" href="https://github.com/marxlow/google-maps-component-guide" rel="noopener ugc nofollow" target="_blank"> Github上浏览完整的源代码可能有助于更好地理解应用程序的工作流程。</a></p><p id="9774" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">我希望这对您开始使用GoogleMaps API的旅程有所帮助。祝你好运！</p></div></div>    
</body>
</html>