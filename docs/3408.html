<html>
<head>
<title>Gatsby Up &amp; Running: Creating a CD Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby启动和运行:创建CD管道</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/gatsby-up-running-creating-a-cd-pipeline-68e561bb5f8e?source=collection_archive---------9-----------------------#2020-09-26">https://javascript.plainenglish.io/gatsby-up-running-creating-a-cd-pipeline-68e561bb5f8e?source=collection_archive---------9-----------------------#2020-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/89f725f30873bdc8d78acef7f5bac608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*ReJCeRt3UrdFp65T8mWs1A.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">source: <a class="ae jy" href="https://docs.travis-ci.com/" rel="noopener ugc nofollow" target="_blank">https://docs.travis-ci.com/</a></figcaption></figure><p id="b90d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我的最后一次冒险是把我简陋的Jekyll网站迁移到盖茨比。我曾经通过在本地构建Jekyll站点并将生成的静态内容推送到GitHub上的<code class="fe kx ky kz la b">gh-pages</code>分支来手动部署我的Jekyll站点。有了新网站后，我决定是时候抛弃我的旧方式，建立一个自动管道来将我的网站部署到GitHub页面。</p><h1 id="4c2c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为什么选择GitHub页面？</h1><p id="bfc5" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">我一直使用GitHub页面来托管我的博客，因为它是轻量级的，并且与GitHub无缝集成。它是简单的，免费的，并提供免费的好处，如强制HTTPS默认，也支持添加一个自定义域。</p><h1 id="ef87" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在本地部署Gatsby站点</h1><p id="7d26" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">在自动化部署我的新Gatsby站点之前，我学习了如何在本地部署它。为此，我在<code class="fe kx ky kz la b">package.json</code>的<code class="fe kx ky kz la b">scripts</code>标签中添加了一个条目，为我的Gatsby站点创建了一个生产就绪的构建。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="cd00" class="mm lc iq la b gy mn mo l mp mq">"scripts": { <br/>  ...<br/>  "build": "gatsby build"<br/>}</span></pre><p id="cf39" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><code class="fe kx ky kz la b">npm run build</code>构建站点并将生成的资产放在一个名为<code class="fe kx ky kz la b">public</code>的文件夹中。将这个<code class="fe kx ky kz la b">public</code>文件夹复制到任何HTTP服务器都会将我的站点部署到那个服务器上。</p><p id="263c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我使用<a class="ae jy" href="https://www.npmjs.com/package/http-server" rel="noopener ugc nofollow" target="_blank"> http-server </a>启动了一个HTTP服务器，为<code class="fe kx ky kz la b">public</code>文件夹中的资产提供服务，这有效地在本地部署了我的站点。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="613d" class="mm lc iq la b gy mn mo l mp mq">➜  cd public<br/>➜  http-server</span><span id="4f5b" class="mm lc iq la b gy mr mo l mp mq">Starting up http-server, serving ./<br/>Available on:  <br/>http://127.0.0.1:8082  <br/>http://10.10.10.10:8082 <br/>http://192.168.13.12:8082</span></pre><h1 id="27fd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将Gatsby站点手动部署到Github页面</h1><h2 id="13c0" class="mm lc iq bd ld ms mt dn lh mu mv dp ll kk mw mx lp ko my mz lt ks na nb lx nc bi translated">设置Github页面</h2><p id="06c1" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">自从我在我的Jekyll站点上使用GitHub以来，我已经设置了GitHub页面，但是为了完整起见，我将在这里重复这些步骤。</p><p id="fea1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我前往我的GitHub库的设置页面，向下滚动到<code class="fe kx ky kz la b">GitHub Pages</code>部分。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/5caf346f7b3235f717622ca7a1eedde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y7ih9SLO9YpwQqqR.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Settings for a GitHub Repository</figcaption></figure><p id="1dcd" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我不想让Gatsby构建过程生成的文件弄乱我的<code class="fe kx ky kz la b">master</code>分支，所以我选择了<code class="fe kx ky kz la b">gh-pages</code>分支作为我的GitHub Pages站点的源分支。我推送到这个分支的任何静态站点都会在<code class="fe kx ky kz la b">deborah-digges.github.io</code>发布。我还喜欢默认启用<code class="fe kx ky kz la b">Enforce HTTPS</code>的事实。所有的保安！</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/70b17694aa53e97b54a2709ff577cd5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YwApmXKR15GacKXp.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">GitHub Pages Configuration</figcaption></figure><h2 id="c007" class="mm lc iq bd ld ms mt dn lh mu mv dp ll kk mw mx lp ko my mz lt ks na nb lx nc bi translated">手动部署</h2><p id="42eb" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">我通过在本地构建站点并仅将文件夹<code class="fe kx ky kz la b">public</code>推送到GitHub上的<code class="fe kx ky kz la b">gh-pages</code>分支，将站点手动部署到GitHub页面。</p><p id="4ef5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这需要一系列相当笨拙的命令。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="ff2d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这很难理解，而且很容易用<code class="fe kx ky kz la b">rm -r *</code>这样的命令意外地毁掉你的整个电脑。这是一件好事，gh-pages包的存在拯救了我们自己。</p><p id="fb8a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我将依赖项添加到我的项目中，让它有所变化。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="3c98" class="mm lc iq la b gy mn mo l mp mq">yarn add gh-pages</span></pre><p id="9161" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">为了让<code class="fe kx ky kz la b">gh-pages</code>知道我的存储库位于哪里，我在<code class="fe kx ky kz la b">package.json</code>中添加了<code class="fe kx ky kz la b">homepage</code>属性。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="3484" class="mm lc iq la b gy mn mo l mp mq">{<br/>  ...</span><span id="c93c" class="mm lc iq la b gy mr mo l mp mq">  "homepage": "deborah-digges.github.io"</span><span id="8dac" class="mm lc iq la b gy mr mo l mp mq">  ...<br/>}</span></pre><p id="1dd8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我给我的<code class="fe kx ky kz la b">package.json</code>添加了另一个脚本<code class="fe kx ky kz la b">deploy</code>，它执行<code class="fe kx ky kz la b">build</code>，然后将<code class="fe kx ky kz la b">public</code>文件夹推送到我在Github上的库的<code class="fe kx ky kz la b">gh-pages</code>分支。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="e27d" class="mm lc iq la b gy mn mo l mp mq">"scripts": {<br/>  "build": "gatsby build",<br/>  "deploy": "npm run build &amp;&amp; gh-pages -d public"<br/>}</span></pre><p id="83d5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">瞧啊。我能够使用<code class="fe kx ky kz la b">npm run deploy</code>脚本从我的计算机手动部署我的站点。那时，我的网站在deborah-digges.github.io运行</p><h1 id="134a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">✨Continuously✨与Travis CI一起部署盖茨比站点</h1><p id="4854" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">太好了！我部署了我的盖茨比站点！然而，我不想在周五下午从我的笔记本电脑上手动部署一个站点。</p><p id="b13d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我决定<a class="ae jy" href="https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment" rel="noopener ugc nofollow" target="_blank">持续部署</a>我的站点，这样每个新的提交都会自动部署到我的GitHub Pages站点。这很令人兴奋，但是我忽略了一个重要的步骤，那就是对我的网站进行自动化测试，以确保一个错误的提交不会导致我的整个博客瘫痪。然而，我决定在<em class="ni">过危险的生活，并为将来的博客帖子保留我的盖茨比网站的测试。</em></p><h2 id="2d47" class="mm lc iq bd ld ms mt dn lh mu mv dp ll kk mw mx lp ko my mz lt ks na nb lx nc bi translated">报名</h2><p id="55e3" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">我用我的GitHub账户注册了Travis CI网站，并同意与Travis分享我的GitHub数据。</p><h2 id="cbd6" class="mm lc iq bd ld ms mt dn lh mu mv dp ll kk mw mx lp ko my mz lt ks na nb lx nc bi translated">启用存储库</h2><p id="107f" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">然后，我前往<a class="ae jy" href="https://travis-ci.org/account/repositories" rel="noopener ugc nofollow" target="_blank">存储库</a>页面，并为<code class="fe kx ky kz la b">deborah-digges.github.io</code>存储库启用构建。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/2227f9a06f08b9fcd930aeb44a59730d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LvOzc5o1oqWDMcNE.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Toggle for Enabling a Repository on Travis CI</figcaption></figure><h2 id="f58f" class="mm lc iq bd ld ms mt dn lh mu mv dp ll kk mw mx lp ko my mz lt ks na nb lx nc bi translated">添加travis.yml文件</h2><p id="bb33" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">我将一个<code class="fe kx ky kz la b">travis.yml</code>文件添加到我的存储库的根目录，告诉Travis在每次提交<code class="fe kx ky kz la b">master</code>时做什么。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">.travis.yml</figcaption></figure><p id="24c0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><code class="fe kx ky kz la b">script</code>运行我之前用来在本地部署站点的<code class="fe kx ky kz la b">yarn run deploy</code>步骤。它做了一些额外的步骤来给Travis CI正确的访问权限，以推送至我的GitHub存储库。</p><p id="df81" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">它告诉安装在Travis CI上的<code class="fe kx ky kz la b">git</code>客户端我是谁。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="4443" class="mm lc iq la b gy mn mo l mp mq">git config --global user.name $GH_USERNAME<br/>git config --global user.email $GH_EMAIL</span></pre><p id="5714" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">为了提供对我的GitHub存储库的脚本推送访问，我在远程URL中嵌入了我的<a class="ae jy" href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token" rel="noopener ugc nofollow" target="_blank"> Github令牌</a>环境变量。</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="378e" class="mm lc iq la b gy mn mo l mp mq">git remote set-url origin "https://${GH_USERNAME}:${GH_TOKEN}@github.com/deborah-digges/</span></pre><p id="3f72" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这些环境变量从何而来？</p><h2 id="1182" class="mm lc iq bd ld ms mt dn lh mu mv dp ll kk mw mx lp ko my mz lt ks na nb lx nc bi translated">配置Travis环境变量</h2><p id="61c5" class="pw-post-body-paragraph jz ka iq kb b kc lz ke kf kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw ij bi translated">我转到我的存储库设置，让以下环境变量对我的脚本可用。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/c248ddd114854d1c770f72c3d38e4be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A8K4nPwByV14QW_s.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Environment Variables in Travis CI</figcaption></figure><p id="b9bb" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我尝试了几次才把它做好，但是我很自豪地说，我的站点现在在每次提交到我的库的<code class="fe kx ky kz la b">master</code>分支时都被持续地部署到GitHub页面上。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/a5215769beec829369bc115c9b10e59c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BBcMIZOCD-7s_wwy.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Latest Git Commits with Travis CI Enabled</figcaption></figure><p id="9d2a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这是一项繁重的工作，在我寻找更简单的解决方案的过程中，我将探索使用GitHub动作来持续部署我的站点。敬请关注更危险的生活！</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="7701" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="ni">原载于</em><a class="ae jy" href="https://deborah-digges.github.io/2020/09/24/gatsby-deploy/" rel="noopener ugc nofollow" target="_blank"><em class="ni">https://Deborah-digges . github . io</em></a><em class="ni">。</em></p></div></div>    
</body>
</html>