<html>
<head>
<title>How to make an API call in Svelte</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Svelte中进行API调用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-an-api-call-with-sveltejs-and-reactive-declarations-63328ca6ba2d?source=collection_archive---------10-----------------------#2020-10-26">https://javascript.plainenglish.io/making-an-api-call-with-sveltejs-and-reactive-declarations-63328ca6ba2d?source=collection_archive---------10-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b5a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近我迷上了苗条身材。JavaScript框架的这一个人军团既吸引人又活跃，就像它是被动的一样。在本文中，我将向您介绍该框架的一些基本特性。在26行代码中，我将介绍一些有趣的SvelteJS特性:反应式声明、带有承诺的异步API获取，以及一些简洁的SvelteJS特性。</p><p id="1ba9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将要向您展示的代码允许用户通过在常规的旧输入字段中输入搜索查询，从外部API获取开源照片。我们从中获取图像的API是由Unsplash 开发的<a class="ae kl" href="https://source.unsplash.com/" rel="noopener ugc nofollow" target="_blank">开放API——开源图像的免费资源。</a></p><p id="8eea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我从展示我的代码开始:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="db32" class="kv kw iq kr b gy kx ky l kz la">&lt;script&gt;<br/>  let searchTerm = '';<br/>  let promise;<br/>  let src = '';</span><span id="4f82" class="kv kw iq kr b gy lb ky l kz la">  $: if (searchTerm != '') {<br/>      promise = getPhoto();<br/>  }<br/>  <br/>  async function getPhoto() {<br/>      let thisSearchTerm = searchTerm;<br/>      const res = await fetch(`https://source.unsplash.com/featured/1600x900/?${searchTerm}`);<br/>      let photoUrl = res.url;</span><span id="4274" class="kv kw iq kr b gy lb ky l kz la">      if (res.ok &amp;&amp; thisSearchTerm == searchTerm) {<br/>          src = photoUrl;<br/>      }<br/>  }<br/>&lt;/script&gt;</span><span id="d3c4" class="kv kw iq kr b gy lb ky l kz la">&lt;input type="text" placeholder="dog, car, house" bind:value={searchTerm} /&gt;</span><span id="c121" class="kv kw iq kr b gy lb ky l kz la">&lt;img {src} alt="An image generated by searching for {searchTerm}." class:invisible={!src} /&gt;</span><span id="73bf" class="kv kw iq kr b gy lb ky l kz la">{#await promise}<br/>  &lt;div class="loading"&gt;&lt;img src="/loading.gif" alt="Loading..."&gt;&lt;/div&gt;<br/>{/await}</span></pre><p id="856a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码片段可能有点难以阅读，这取决于您阅读本文的设备。为了您的阅读乐趣，我还提供了图片形式的代码。这张图片中的行数是我将在本文的其余部分中用作参考的，不管上面的代码片段中的行数看起来如何。</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lc"><img src="../Images/0a592773574198a359daee1de9e1da72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GM4KBWtx3_UfH7k7zNIIg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">A screenshot of the code. The image is captured by the author.</figcaption></figure><p id="62e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们浏览一下这段代码。</p><p id="3d03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从第21行开始，那里有一个输入字段。这个输入字段是我们用来让用户输入搜索查询的。注意，在这一行的末尾，我将输入字段的值绑定到了我的变量“searchTerm”，该变量在第2行声明。“bind:value”的意思是指定的变量将反映输入字段的值。</p><p id="c292" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，将注意力转移到第6行。这一行以一个美元符号开始，后跟一个逗号，这可能看起来像奇怪的语法。在《窈窕淑女》中，这个二人组象征着<a class="ae kl" href="https://svelte.dev/tutorial/reactive-declarations" rel="noopener ugc nofollow" target="_blank">反应宣言</a>的开始。这是我最喜欢的苗条身材的特征之一。任何写在“$:”之后的代码都是被动的——只要在它被改变之后提到一个变量，它就会被触发。在我们的例子中，变量“searchTerm”是在冒号后面提到的，这就是每当变量被更新时代码块就会被触发的原因。当然，每当用户在输入字段中键入字符时，该变量都会更新，因为输入字段的值绑定到该变量。</p><p id="fbe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，对于我们的代码，我们实际上不需要使用反应式声明。SvelteJS配备了大量的<a class="ae kl" href="https://svelte.dev/docs" rel="noopener ugc nofollow" target="_blank">监听器</a>。例如，我们可以简单地使用keydown-listener来代替，并获得相同的结果。</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lo"><img src="../Images/e99eacc7ca35325acaa688410e51b281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JjORZKAOC4YM1yMrpAoHZw.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Instead if using a reactive declaration, you could, of course, use a standard observer. The image is captured by the author.</figcaption></figure><p id="3a77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，我想说明如何在SvelteJS中使用反应式声明。就像魔法观察者一样，它们可以用于几乎无限的场景。</p><p id="5ecc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论是通过被动声明还是使用标准侦听器，代码都将调用一个名为“getPhoto”的异步函数。这个函数在第7行被调用。如果您查看函数内部，您将在第10行到第18行找到，您会发现一些看起来冗余的代码。我们声明了一些局部变量，比如“thisSearchTerm”和“photoUrl ”,它们可能是现有变量的多余副本。但是，请记住，这是一个异步函数，每次用户在输入字段中输入一个字母时都会触发该函数。如果用户键入搜索词“doghouse”，我们将输入这个函数不下八次，第七次调用实际上可能在第八次调用之后结束，这就是为什么我们在第15行有一个If语句，确保我们总是显示正确的结果，而不是最近的<em class="lp"/>。</p><p id="b6d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在第12行调用<a class="ae kl" href="https://source.unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash的开放API </a>。这个调用是一个简单的URL，我们将搜索词放在它的最后。您可能已经注意到，在第7行，我们将这个异步调用存储在一个承诺中。只要我们在等待一个承诺，第25行的代码就会一直运行。在我们的例子中，我们只是在等待图像时显示一个正在加载的gif。等待承诺在编程语言中很常见。承诺实现后，它返回一个结果。在SvelteJS中，处理结果可能是这样的:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lq"><img src="../Images/b2611cb95189419948f4aa0cac828016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dzxtZl-DKpqRpbqqahatg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">We could also collect the result from the promise, roughly like this. This would make it so that an image is only displayed when no promise is running, as opposed to our current solution, which shows the last image fetched while fetching another. The image is captured by the author.</figcaption></figure><p id="2975" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，我们的代码看起来不是这样的。我们的代码不需要它。SvelteJS中的所有变量都是反应性的，包括我们的“src”变量。当我们在第16行更新“src”变量时，图像也在这个过程中被更新。事实上，我们可以重写这段代码，完全不使用承诺——我们可以简单地根据异步函数中的布尔集合显示和隐藏gif。</p><p id="d4a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第22行，我们显示图像。“{src}”是“src={src}”的简写形式。如果变量名与属性名相同，可以这样缩短。每当“src”变量更新时，图像显示也会更新。还有，注意线上的最右边。“class:invisible={！src}”意味着只要变量“src”未定义或为空，图像就会有“不可见”类。这是苗条身材的另一种简写。观察下面的两行—输出是相同的:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lr"><img src="../Images/aa8709f5b5114887c889f23a17805ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o4hQUnoNTNTajcEB8PyUbQ.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">The top line is a shorthand for the second line. Indeed, these two lines output the same result. The image is captured by the author.</figcaption></figure><p id="6b3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是一个功能齐全的应用程序，从一个开放的API获取图像。稍加设计，该应用程序可能如下所示:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ls"><img src="../Images/0d5577f09a6f68dc63abc2792241b90b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Db7_1P0DQdSJiVYVIQA9w.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">An example of what the above code could look like in a browser with a touch of CSS applied to it. In this example, “cat” has been entered into the search bar as a query, and a random image associated with the keyword has been returned from the Unsplash API. If you enter the word “cat” yourself, you will most likely receive a different photo. <a class="ae kl" href="https://unsplash.com/photos/1vNvGY11Lds" rel="noopener ugc nofollow" target="_blank">This particular photo</a> that I received is a photo by <a class="ae kl" href="https://unsplash.com/@linataly1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Lina Angelov</a> on Unsplash.</figcaption></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="b6f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SvelteJS是一个非常适合初学者的JavaScript框架，很容易上手。也就是说，这种语言背后的社区仍然很小，所以请在评论中随意发表任何问题，我会尽我所能回答他们。我绝不是苗条身材方面的专家，但正如我所说，我越来越喜欢这个框架。我很欣赏它在不删除任何功能的情况下删除了React的许多冗余样板文件。</p><p id="3edb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你苗条的冒险之旅好运！</p></div></div>    
</body>
</html>