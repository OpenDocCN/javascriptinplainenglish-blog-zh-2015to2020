<html>
<head>
<title>Implementing a Persistent Shopping Cart In ReactJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在ReactJS中实现持久购物车</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-persistent-cart-in-react-f287ed4b4df0?source=collection_archive---------0-----------------------#2020-06-27">https://javascript.plainenglish.io/creating-a-persistent-cart-in-react-f287ed4b4df0?source=collection_archive---------0-----------------------#2020-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a0a75c8903fa5740258c9b87b185704f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BDl8xSHOKx2os-bP"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@bruno_kelzer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bruno Kelzer</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="4928" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">为您的客户创造更好的体验，即使他们没有登录</h2></div><h2 id="781a" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">你知道react，你想实现一个购物车。假设你已经尝试过了，即使你没有。</h2><p id="d91e" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">在重新加载页面之前，一切都很好，很流畅，正常工作。就这样，你购物车里的所有东西都不见了，现在你脑子里只有一个遥远的记忆。</p><p id="dfb1" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">你如何实现一个购物车，或者类似的东西，即使在页面重新加载，或者关闭并重新加载你的网站之后，仍然保存信息？</p><p id="5540" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">实际上很简单，使用一个叫做<strong class="lt jh"> localStorage </strong>的小东西。</p><h1 id="ac6b" class="mp kw jg bd kx mq mr ms la mt mu mv ld km mw kn lh kp mx kq ll ks my kt lp mz bi translated">什么是本地存储？</h1><p id="ebaf" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">顾名思义，本地存储是浏览器的本地存储，嗯…</p><p id="ee54" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">不过说真的，你需要知道的是，这个漂亮的小工具将无限期地存在，直到你删除它——当注销一个用户，或完成一个订单——或者在用户硬重新加载或重置他们的浏览器的情况下。</p><h1 id="7ccf" class="mp kw jg bd kx mq mr ms la mt mu mv ld km mw kn lh kp mx kq ll ks my kt lp mz bi translated">使用本地存储的好处</h1><p id="51d2" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">您可能想知道，本地存储用于存储用户登录时的关键信息，这确保用户可以访问某项服务或功能，而无需每次客户端发出请求时都向服务器或其他方请求许可。</p><p id="2b02" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">换句话说，只要内存存在，您就可以即时访问它，所以您不必担心异步函数或类似的问题。</p><p id="a6a1" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">没有一些代码，这不会是一个很酷的教程，所以让我们开始吧。然而，在我们开始之前，让我解释一下localStorage实际上是如何工作的。</p><p id="d226" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">重要的是要理解，在本地存储中存储的任何内容都保存为字符串，基本上是JSON格式。</p><h1 id="5ecd" class="mp kw jg bd kx mq mr ms la mt mu mv ld km mw kn lh kp mx kq ll ks my kt lp mz bi translated">有三种方法可以用来修改这个结构</h1><h2 id="289b" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak">local storage . setitem(key:string，value: string) </strong></h2><p id="68e7" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">请注意，要设置(保存)。我们需要把它作为一个键值对，两者都由字符串组成。这很重要，因为正如我之前所说，localStorage只会正确地保存字符串。</p><p id="6a20" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">要设置我们想要的值——cart数组——我们可以简单地调用<strong class="lt jh"> JSON.stringify(cart) </strong>,它将被转换成一个字符串表示。</p><h2 id="63a9" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak">local storage . getitem(key:string)</strong></h2><p id="0e85" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">要获得一个项目，我们只需输入我们之前用来设置该项目的键，这也是一个字符串。</p><p id="c436" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">因为该值是一个字符串，所以我们调用<strong class="lt jh"> JSON.parse(cartString) </strong>将其转换为存储前的值——在我们的例子中是一个数组。</p><h2 id="9caf" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="ak"> localStorage.removeItem(键:字符串)</strong></h2><p id="54a3" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">最后，要删除一个值，我们只需传递它的键，它就会永远从浏览器的本地存储中删除，只存在于你的梦里。</p><p id="b892" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们将首先创建一个数组，通过使用useState钩子并将其初始值设置为一个空数组来保存购物车的状态。</p><figure class="na nb nc nd gt is"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="95c9" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">那很容易。您还可以看到，我添加了一些空函数，我们也将使用它们来实现购物车的逻辑。</p><p id="5be7" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">还可以看到我实现了useEffect，这是一个钩子，可以作为componentDidMount或componentWillMount的功能组件版本运行。这样做是因为如果用户刷新页面，本地状态将会丢失，因此我们需要在localStorage中加载购物车(如果存在的话),以将其恢复到应用程序的状态。</p><h1 id="3f5c" class="mp kw jg bd kx mq mr ms la mt mu mv ld km mw kn lh kp mx kq ll ks my kt lp mz bi translated">添加新项目</h1><p id="1c20" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">向购物车添加商品时，我们必须考虑两个条件。</p><ul class=""><li id="0ce2" class="ng nh jg lt b lu mk lx ml le ni li nj lm nk mj nl nm nn no bi translated">添加购物车中尚不存在的商品</li><li id="0252" class="ng nh jg lt b lu np lx nq le nr li ns lm nt mj nl nm nn no bi translated">添加购物车中已经存在的商品。</li></ul><p id="f8e1" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">首先，我们需要检查数组中是否存在该项目，如果不存在，就添加它，但如果存在，我们需要更新现有项目的数量。</p><p id="6307" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">最后，我们需要将更新后的购物车保存到localStorage，以防用户对刷新按钮非常满意。</p><figure class="na nb nc nd gt is"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="61eb" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">希望前面的解释和详细的注释足以让您了解到目前为止localStorage是如何工作的。</p><h1 id="0016" class="mp kw jg bd kx mq mr ms la mt mu mv ld km mw kn lh kp mx kq ll ks my kt lp mz bi translated">更新项目</h1><p id="e3d4" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">为了更新一个条目，我们的函数将接收两个参数，itemID和要加或减的数量。</p><p id="bd7c" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">数量可以是负数，这意味着我们从现有的项目中减去x质量，如果是正数，则加上它们。</p><p id="2a4d" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们可以假设该函数总是在列表中存在的项目上被调用，但是无论发生什么情况，让您的代码工作总是一个好主意，所以我们将解决这种情况。</p><p id="21a3" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们需要担心两件事。</p><ul class=""><li id="3a76" class="ng nh jg lt b lu mk lx ml le ni li nj lm nk mj nl nm nn no bi translated">如果一个项目不存在会发生什么。</li><li id="ace4" class="ng nh jg lt b lu np lx nq le nr li ns lm nt mj nl nm nn no bi translated">如果最终数量等于或小于0，会发生什么</li></ul><p id="2677" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们可以像以前一样简单地在数组上使用find，并检查它是否存在。如果没有，我们简单地返回来停止这个函数。</p><p id="846e" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">如果确实存在，我们可以更新并验证受影响物品的最终数量。</p><p id="a86a" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们通过简单地更新数量并检查结果是否≤ 0来做到这一点。如果是，我们必须从购物车中删除该商品。</p><figure class="na nb nc nd gt is"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e06c" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们可以从数组中过滤掉上面显示的项目。同样，我们必须用结果状态更新localState。</p><figure class="na nb nc nd gt is"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="55bf" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我们的功能终于完成了。即使用户刷新或关闭浏览器，我们的购物车现在也将保存在localStorage中。</p><p id="53bc" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">此外，如果用户结账或完成购买，您可以通过调用<em class="nu">local storage . remove item(" cart ")</em>从内存中重置购物车。</p><p id="6d6b" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">唷！您现在离为客户创造完美体验又近了一步。</p><p id="282d" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">我知道我们没有看到任何视觉上的东西，但这个帖子就这个话题已经够长了。</p><p id="dda6" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">在任何情况下，我可能会写一个后续版本，通过实际实现和渲染一个购物车，这样如果你不知道如何完成它，你可以学习连接这个功能。</p><p id="1357" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">所以请继续关注，如果你想看到更多这样的内容，也许还有后续版本。😉</p><p id="071b" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">干杯。</p></div></div>    
</body>
</html>