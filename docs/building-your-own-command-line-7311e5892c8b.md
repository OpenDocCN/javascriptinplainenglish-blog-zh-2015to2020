# æ„å»ºæ‚¨è‡ªå·±çš„å‘½ä»¤è¡Œ

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/building-your-own-command-line-7311e5892c8b?source=collection_archive---------6----------------------->

> æ¥ä¸‹æ¥çš„ä¸€å‘¨ï¼Œæˆ‘å®Œæˆäº†æˆ‘çš„ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œâ€œpackage app â€,æˆ‘é€‰æ‹©åˆ›å»ºä¸€ä¸ªå…³äºå®ƒçš„å¸–å­ï¼Œæˆ‘èŠ±äº†æ•´æ•´ä¸€å‘¨çš„æ—¶é—´å­¦ä¹ å’Œæ•™è‡ªå·±å¦‚ä½•åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œï¼Œå› ä¸ºè¿™å¯¹æˆ‘æ¥è¯´æ˜¯æ–°çš„ä¸œè¥¿ã€‚å½“æˆ‘å¼€å§‹å­¦ä¹ ååº”æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªç±»ä¼¼ create-react-app çš„å‘½ä»¤è¡Œæ˜¯æˆ‘å¾ˆä¹…ä»¥æ¥çš„ä¸€ä¸ªæƒ³æ³•ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å°†æ•™ä½ å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œã€‚

![](img/71bc3af18911c94154fde17688e94018.png)

æˆ‘å–œæ¬¢æŠŠè¿™ä¸ªå¸–å­çœ‹åšæ˜¯æ™®é²é¡¿æ˜Ÿçƒï¼Œå½“æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå‘½ä»¤è¡Œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¦‚ä½•ä½¿å®ƒå˜å¾—å°è€Œæ¼‚äº®ã€‚ä½ åº”è¯¥çœ‹åˆ°ä¸€äº›å‘½ä»¤è¡Œæœ‰ç€æƒŠäººçš„é¢œè‰²å’Œç›´è§‚çš„ç”¨æˆ·ç•Œé¢ï¼Œä¸€ä¸ªä¾‹å­å¯èƒ½æ˜¯ Netlifyï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŸå› ï¼Œå› ä¸ºæˆ‘ä¸å†ä½¿ç”¨â€œGithub Pagesâ€æ¥éƒ¨ç½²æˆ‘çš„åº”ç”¨ç¨‹åºäº†ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å…³äºå‘½ä»¤è¡Œçš„åŸºæœ¬æ¦‚å¿µï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬æƒ³é¦–å…ˆæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å‘½ä»¤è¡Œçš„å«ä¹‰ã€‚

# å‘½ä»¤è¡Œç•Œé¢

â€œå‘½ä»¤è¡Œç•Œé¢â€æ˜¯ä¸€ç§å…è®¸ç”¨æˆ·é€šè¿‡ä¸€è¡Œæ–‡æœ¬å‘æŸäº›ä¿¡æ¯ç¨‹åºç»™å‡ºæŒ‡ä»¤çš„æ–¹æ³•ã€‚CLI å’Œ Shell ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œå› ä¸º Shell æ˜¯ä¸€ä¸ªä¿¡æ¯ç¨‹åºï¼ŒCLI æ˜¯ä¸€ç§æ–¹æ³•ã€‚å…³äºä»€ä¹ˆæ˜¯å‘½ä»¤è¡Œçš„ä¸€ä¸ªå¾ˆå¤§çš„ä¾‹å­å¯èƒ½æ˜¯ *create-react-app* å’Œ Netlifyï¼Œå½“æ‚¨ç¼–å†™ *create-react-app* æ¥æ‰§è¡ŒæŸä»¶äº‹æƒ…æ—¶ï¼Œè¿™å°±æ˜¯å‘½ä»¤è¡Œçš„ä»»åŠ¡ï¼Œåœ¨ *create-react-app* çš„æƒ…å†µä¸‹ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«ä¸€äº›æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚

*   å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“å‘½ä»¤è¡Œä¸æ˜¯ä¿¡æ¯å­¦ç¨‹åºï¼Œè€Œæ˜¯ä¸€ç§æ–¹æ³•ã€‚
*   å‘½ä»¤è¡Œç”¨è¡Œæ–‡æœ¬å‘ä¿¡æ¯ç¨‹åºç»™å‡ºæŒ‡ä»¤ã€‚
*   é€šè¿‡å‘½ä»¤è¡Œï¼Œæ‚¨å¯ä»¥æ‰§è¡Œæ–‡ä»¶æˆ–ç¨‹åºã€‚

# æˆ‘ä»¬å¼€å§‹å§ï¼

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›åŒ…ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³æ‰‹åŠ¨æ„å»ºæ‰€æœ‰ä¸œè¥¿ï¼Œæœ‰äº›äººèŠ±äº†å‡ ä¸ªæœˆæˆ–å‡ ä¸ªæ˜ŸæœŸæ¥æ„å»ºè¿™äº›åŒ…ï¼Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰æ—¶é—´ã€‚

*   **esm** :æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¯¼å…¥ï¼Œæ‰€ä»¥ esm ä¼šä¸ºæˆ‘ä»¬é…ç½®æ‰€æœ‰çš„ä¸œè¥¿ã€‚
*   **figlet** :ç”Ÿæˆå¸¦æœ‰ä¸€äº›å°åˆ·å­—ä½“çš„æ¨ªå¹…æ–‡æœ¬ã€‚
*   **listr** :ä¸€äº›å‘½ä»¤è¡Œæœ‰ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æŸ¥çœ‹ç±»ä¼¼è½¯ä»¶åŒ…å®‰è£…çš„è¿›åº¦ã€‚
*   **ncp** :æˆ‘ä»¬éœ€è¦å¤åˆ¶ç²˜è´´ä¸€äº›æ–‡ä»¶ï¼Œç”± ncp è´Ÿè´£ã€‚
*   **util** :æˆ‘ä»¬ä½¿ç”¨å…è¯º

> -NPM init
> -NPM I ESM fig let listr NCP

## åŒ…é…ç½®

æˆ‘ä»¬éœ€è¦åšä¸€äº›é…ç½®ï¼Œå¦‚æ”¾ç½® binï¼Œå¹¶å¯¹åŒ…è¯´ï¼Œå¦‚æœé¡¹ç›®å°†æ˜¯å…¬å…±çš„æˆ–å¦ï¼Œé»˜è®¤æ–‡ä»¶å¤¹:

![](img/942fa51628443019c157532856ad2ed0.png)

ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä¼šå‘æ‚¨è§£é‡ŠåŒ…å†…å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ‚¨å¦‚ä½•çœ‹åˆ°æˆ‘ä»¬æœ‰æˆ‘ç»™ä½ çš„ç›¸åŒä¾èµ–å…³ç³»ï¼Œæ–‡ä»¶å†…å”¯ä¸€çš„åŒºåˆ«æ˜¯:

*   bin:ä½¿ç”¨ binï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªåŒ…è¯´ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€äº›å‘½ä»¤æ¥æ‰§è¡Œä¸€äº›æ–‡ä»¶ã€‚æœ‰äº›äººæœ€åˆç¼–å†™ cli.js(æˆ‘ä»¬å°†åœ¨å…¶ä¸­ç¼–å†™å‘½ä»¤å±æ€§çš„æ–‡ä»¶)ã€‚
*   **å‘å¸ƒé…ç½®**:è¿™æœ‰åŠ©äºæˆ‘ä»¬ç¡®ä¿ç»™å®šçš„åŒ…æ²¡æœ‰è¢«æ ‡è®°ä¸ºâ€œæœ€æ–°çš„â€ï¼Œæ²¡æœ‰å‘å¸ƒåˆ°å…¨å±€å…¬å…±æ³¨å†Œä¸­å¿ƒï¼Œæˆ–è€…é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªä½œç”¨åŸŸæ¨¡å—æ˜¯ç§æœ‰çš„ã€‚
*   **æ–‡ä»¶**:å¯é€‰æ–‡ä»¶å­—æ®µæ˜¯ä¸€ä¸ªæ–‡ä»¶æ¨¡å¼æ•°ç»„ï¼Œå®ƒæè¿°äº†å½“ä½ çš„åŒ…ä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹è¢«å®‰è£…æ—¶è¦åŒ…å«çš„æ¡ç›®ã€‚

## é¡¹ç›®æ ‘

æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€äº›æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä½†ä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä¼šç»™ä½ ç•™ä¸‹æˆ‘çš„é¡¹ç›®æ ‘:

```
â”œâ”€bin
â”œâ”€â”€ command-line
â”œâ”€src
â”œâ”€â”€ cli.js
â”œâ”€templates
â”œâ”€â”€ template.txt
â”œâ”€ .gitignore
â”œâ”€ packpage.json 
â”œâ”€ package-lock
```

# ä¹¦å†™è¯´æ˜

å¥½çš„ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ CLI å‡½æ•°å¹¶å¯¼å‡ºå®ƒï¼Œå› ä¸ºç¨åæˆ‘ä»¬å°†åœ¨â€œå‘½ä»¤è¡Œâ€ä¸­æ‰§è¡Œ require(åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šä¸€æ­¥ä¸€æ­¥è§£é‡Š):

*   åœ¨ cli.js ä¸­ç¼–å†™ cli å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥æ”¶ argvï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·ç¼–å†™çš„æ–‡æœ¬ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥æ–‡æœ¬æ˜¯æˆ‘ä»¬å°†åˆ›å»ºçš„æ–‡ä»¶å¤¹çš„åç§°ã€‚

*   æ‰€ä»¥ï¼Œåœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä» cli.js å¯¼å…¥ cli å‡½æ•°ï¼Œå¹¶åƒå‚æ•°ä¸€æ ·ä¼ é€’å®ƒ
    ***" process . argv "***ã€‚
*   **#ï¼/usr/bin/env node** :æ˜¯ shebang è¡Œçš„ä¸€ä¸ªå®ä¾‹:åœ¨ç±» Unix å¹³å°ä¸Šçš„å¯æ‰§è¡Œçº¯æ–‡æœ¬æ–‡ä»¶ä¸­çš„ç¬¬ä¸€è¡Œ*ï¼Œå®ƒå‘Šè¯‰ç³»ç»Ÿå°†è¯¥æ–‡ä»¶ä¼ é€’ç»™å“ªä¸ªè§£é‡Šå™¨æ¥æ‰§è¡Œ*ã€‚[æ›´å¤šä¿¡æ¯](https://stackoverflow.com/questions/33509816/what-exactly-does-usr-bin-env-node-do-at-the-beginning-of-node-files)ã€‚

# é¦–æ¬¡æµ‹è¯•

å¥½çš„ï¼Œæˆ‘ä»¬æœ‰å¿…è¦çš„ä»£ç æ¥è·å–æˆ‘ä»¬çš„å‘½ä»¤ï¼Œä½†æ˜¯åœ¨è¿è¡Œå®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œ **npm é“¾æ¥**ï¼Œç„¶åè¿è¡Œæˆ‘ä»¬çš„**å‘½ä»¤**ã€‚

æˆ‘çŸ¥é“è¿™ä¸ªå‘½ä»¤è¡Œçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šèµ‹äºˆå®ƒå¤æ‚æ€§ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œæ¥å¤åˆ¶æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œç„¶åå°†å…¶ç²˜è´´åˆ°ä¸åŒçš„ç›®å½•ä¸­ã€‚

# æ¬¢è¿æ–¹æ³•

ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å‘½ä»¤æ›´æ¼‚äº®ï¼Œæœ‰ä¸€ä¸ªæ¼”ç¤ºä¿¡æ¯æ˜¯å¾ˆå¥½çš„ã€‚è¯¥å‡½æ•°éœ€è¦å†™å…¥ cli æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨ figletï¼Œå› ä¸ºè¯¥è½¯ä»¶åŒ…ä¸ºæˆ‘ä»¬æä¾›äº†æ¼‚äº®çš„æ¨ªå¹…:

![](img/84c18e1cbe2d7acc6c0210a61fb28bfc.png)

# å¤åˆ¶å’Œç²˜è´´åŠŸèƒ½

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä» *util* ä¸­å¯¼å…¥ promisifyï¼Œå› ä¸ºæœ‰æ—¶æˆ‘ä»¬éœ€è¦å¤åˆ¶å¹¶ç²˜è´´å¤§é‡æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™å°†æ˜¯ä¸€ç§æ¯«æ— é—®é¢˜åœ°è·å–æ‰€æœ‰è¿™äº›æ–‡ä»¶çš„æ–¹æ³•:

copyTempalteFiles å‡½æ•°çš„è¯´æ˜:

*   æ¨¡æ¿ç›®å½•:è¿™å°†æ˜¯æˆ‘ä»¬æ‹¥æœ‰æ¨¡æ¿çš„æ–¹å‘ã€‚
*   targetDir :æˆ‘ä»¬å°†è¦ç²˜è´´æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶çš„æ–¹å‘ã€‚
*   **clobber** :ä¸è¦é‡å†™æ–‡ä»¶ã€‚

æˆ‘ä»¬éœ€è¦å¯¼å…¥**è·¯å¾„**ï¼Œå› ä¸ºè¿™å°†ç»™æˆ‘ä»¬æ¨¡æ¿çš„æ–¹å‘ã€‚

# ä»»åŠ¡åˆ—è¡¨

é¦–å…ˆæˆ‘ç»™ä½ ç®€å•ä»‹ç»ä¸€ä¸‹ **listr** :è¿™æ˜¯ä¸€ä¸ªåˆ¶ä½œä»»åŠ¡åˆ—è¡¨çš„åŒ…ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­æŸ¥çœ‹å‘½ä»¤çš„æ¯ä¸ªçŠ¶æ€ã€‚

è§£é‡Š:

*   **å®é™…è·¯å¾„**:æˆ‘ä»¬ä½¿ç”¨ *import.meta.url* æ¥ç»™å‡ºå®é™…è·¯å¾„ã€‚
*   **templatesDir** :æˆ‘ä»¬ä½¿ç”¨*â€œpath resolveâ€*ä¸ºæ­¤ï¼Œ *resolve* æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†æ˜¯è·å–å…¶è·¯å¾„åçš„å®é™…è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°å°†æ˜¯æˆ‘ä»¬çš„æ¨¡æ¿æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚
*   **TaskList** :æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå› ä¸ºä»»åŠ¡éœ€è¦ç”¨ await è°ƒç”¨ï¼Œå› ä¸ºæœ‰æ—¶è¿™ä¸ªä»»åŠ¡ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª constï¼Œè°ƒç”¨ä¸€ä¸ªç±»æ¥æ”¾ç½®æˆ‘ä»¬çš„ä»»åŠ¡ã€‚

# è°ƒç”¨å‡½æ•°

æˆ‘ä»¬å°†è°ƒç”¨æˆ‘ä»¬çš„ä¸¤ä¸ªå‡½æ•° **HelloMessage** å’Œ **TaskListã€‚**é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒç”¨ HelloMessage æ–¹æ³•ï¼Œå› ä¸ºè¿™å°†æ˜¯æ¼”ç¤ºæ–‡ç¨¿ï¼Œç„¶åæˆ‘ä»¬å°†â€œargvâ€ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå› ä¸ºé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥è·å¾—æ–‡ä»¶å¤¹çš„åç§°(æˆ‘ä»¬å°†åˆ›å»ºçš„æ–‡ä»¶å¤¹çš„åç§°)ã€‚

## æœ€ç»ˆä»£ç :

# è¿è¡Œæˆ‘ä»¬çš„å‘½ä»¤ğŸŠ

è¿™æ˜¯æˆ‘ä»¬çš„è¸ªè¿¹çš„ç»“æŸï¼Œè¿è¡Œå‘½ä»¤å¹¶ä¸”è§‚çœ‹é­”æœ¯

![](img/df47211a1b99613c0a8f73fdedc9799e.png)

> å˜¿ï¼Œå¦‚æœè¿™å¯¹ä½ æœ‰ç”¨ï¼Œç»™æˆ‘ä¸€äº›æŒå£°ï¼Œåœ¨æˆ‘çš„ç½‘ç»œä¸Šå…³æ³¨æˆ‘ï¼

æ¨ç‰¹:@ ToyoJhornan
Github:[https://github.com/karttofer](https://github.com/karttofer)