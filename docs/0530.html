<html>
<head>
<title>Upcoming new JavaScript features You should know if you use JavaScript everyday</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如果您每天都在使用JavaScript，您应该知道即将推出的新JavaScript特性</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/upcoming-new-javascript-features-you-should-know-if-you-use-javascript-everyday-8208b477b7a2?source=collection_archive---------0-----------------------#2019-11-04">https://javascript.plainenglish.io/upcoming-new-javascript-features-you-should-know-if-you-use-javascript-everyday-8208b477b7a2?source=collection_archive---------0-----------------------#2019-11-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/161162e397ab2e77a6bd645836050a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oYERjNNFMUQoiKJt.png"/></div></div></figure><p id="dda2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated">自从ECMAScript2015(也称为ES6)发布以来，JavaScript发生了广泛的变化和改进。这对所有JavaScript开发人员来说都是一个好消息。此外，每年都会发布新的ECMAScript版本。你可能没有注意到2019年6月发布的最新ECMAScript中添加了哪些功能。我简单给大家展示一下最新版本增加的新特性，说说未来版本的新特性。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><blockquote class="lm ln lo"><p id="c27d" class="jy jz lp ka b kb kc kd ke kf kg kh ki lq kk kl km lr ko kp kq ls ks kt ku kv ij bi translated"><strong class="ka ir">免责声明</strong> <br/>我将向您展示的功能尚未决定是否会出现在下一个版本中。我将在这篇文章中谈论的所有内容目前都处于第三阶段。如果你想了解更多细节，请查看这份回购协议。</p></blockquote><h1 id="2d1c" class="lu lv iq bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">编辑(2019年12月)—第四阶段</h1><p id="b9da" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated"><a class="ae lt" href="https://github.com/tc39/proposal-nullish-coalescing" rel="noopener ugc nofollow" target="_blank">无效合并操作符</a>和<a class="ae lt" href="https://github.com/tc39/proposal-optional-chaining" rel="noopener ugc nofollow" target="_blank">可选链接</a>现在处于阶段4，这是最终阶段！你可以从<a class="ae lt" href="https://github.com/tc39/proposals/blob/master/finished-proposals.md" rel="noopener ugc nofollow" target="_blank">这里</a>查看这条新闻。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="25ba" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">ECMAScript2019 (ES10)中的功能</h1><h2 id="fcf9" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated"><code class="fe no np nq nr b">1. Array.prototype.flat</code></h2><p id="cc9d" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">一种创建新数组的方法，其中所有子数组元素递归连接到新数组中，直到指定深度。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="1fc8" class="nc lv iq nr b gy oa ob l oc od">const array = [1, 2, [3, 4]];<br/>array.flat(); // [1, 2, 3, 4];</span></pre><p id="ed3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是非常有用的，尤其是当你想展平嵌套数组的时候。如果数组的深度超过一个深度，调用一次<code class="fe no np nq nr b">flat</code>不能完全展平数组。<code class="fe no np nq nr b">flat</code>接受一个深度参数，它指的是你想要它进入多少深度来展平数组。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="6a28" class="nc lv iq nr b gy oa ob l oc od">// Crazy example<br/>const crazyArray = [1, 2, [3, 4], [[5], [6, [7,8]]]];<br/>crazyArray.flat(Infinity); // [1, 2, 3, 4, 5, 6, 7, 8];</span><span id="eb53" class="nc lv iq nr b gy oe ob l oc od">// The parameter must be the number type</span></pre><p id="8c26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你想搜索的数组越深，展平它所需要的计算时间就越多。注意ie和Edge不支持这个功能。</p><h2 id="b89a" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">2.Array.prototype.flatMap</h2><p id="521d" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">方法首先使用映射函数映射每个元素，然后将结果展平到一个新数组中。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="a4e0" class="nc lv iq nr b gy oa ob l oc od">const arr = <!-- -->["it's Sunny in", "", "California"];</span><span id="92e3" class="nc lv iq nr b gy oe ob l oc od">arr.flatMap(x =&gt; x.split(" "));<br/>// <!-- -->["it's","Sunny","in", "", "California"]</span></pre><p id="61e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe no np nq nr b">flat</code>和<code class="fe no np nq nr b">flatMap</code>的区别在于，你可以在<code class="fe no np nq nr b">flatMap</code>中放一个自定义函数来操作每个值。此外，与<code class="fe no np nq nr b">flat</code>不同的是，<code class="fe no np nq nr b">flatMap</code>只展平一个深度数组。返回值应该是数组类型。当您应该在展平阵列之前做些事情时，这将非常有用。</p><p id="fb8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ES10增加了更多功能。如果你想了解更多，请点击这里。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="874c" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">第三阶段的新功能</h1><p id="6a66" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">在第三阶段，有一些有趣的功能建议。我将向你简单介绍其中的一些。</p><h2 id="379a" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">数字分隔符</h2><p id="49d2" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">当你把一个很大的数字赋给一个变量的时候，你不觉得这个数字有多大或者你写的对吗？这个提议允许你在数字之间加一条下划线，这样你就可以更容易地计算了。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="601e" class="nc lv iq nr b gy oa ob l oc od">1_000_000_000           // Ah, so a billion<br/>101_475_938.38          // And this is hundreds of millions</span><span id="00b5" class="nc lv iq nr b gy oe ob l oc od">let fee = 123_00;       // $123 (12300 cents, apparently)<br/>let fee = 12_300;       // $12,300 (woah, that fee!)<br/>let amount = 12345_00;  // 12,345 (1234500 cents, apparently)<br/>let amount = 123_4500;  // 123.45 (4-fixed financial)<br/>let amount = 1_234_500; // 1,234,500</span><span id="d959" class="nc lv iq nr b gy oe ob l oc od">let budget = 1_000_000_000_000;</span><span id="d2e7" class="nc lv iq nr b gy oe ob l oc od">// What is the value of `budget`? It's 1 trillion!<br/>// <br/>// Let's confirm:<br/>console.log(budget === 10 ** 12); // true</span></pre><p id="14a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦这个特性发布，是否使用它将由每个开发者决定，但是有一点是肯定的，这个特性将减少你计算一个数字有多大的麻烦！</p><h2 id="46a1" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">顶级等待</h2><blockquote class="lm ln lo"><p id="6d4e" class="jy jz lp ka b kb kc kd ke kf kg kh ki lq kk kl km lr ko kp kq ls ks kt ku kv ij bi translated">顶级<code class="fe no np nq nr b"><em class="iq">await</em></code>使模块能够充当大型异步函数:有了顶级<code class="fe no np nq nr b"><em class="iq">await</em></code>，ECMAScript模块(ESM)可以<code class="fe no np nq nr b"><em class="iq">await</em></code>资源，导致其他模块<code class="fe no np nq nr b"><em class="iq">import</em></code>它们在开始评估自己的身体之前等待。</p></blockquote><p id="a24f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个特性的动机是当你<code class="fe no np nq nr b">import</code>一个有<code class="fe no np nq nr b">async</code>功能的模块时，<code class="fe no np nq nr b">async</code>功能的输出是<code class="fe no np nq nr b">undefined</code>。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="fbde" class="nc lv iq nr b gy oa ob l oc od">// awaiting.mjs<br/>import { process } from "./some-module.mjs";<br/>const dynamic = import(computedModuleSpecifier);<br/>const data = fetch(url);<br/>export const output = process((await dynamic).default, await data);</span></pre><p id="0a69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有两个文件。<code class="fe no np nq nr b">output</code>可能是<code class="fe no np nq nr b">undefined</code>如果它在承诺任务完成之前被调用。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="ac73" class="nc lv iq nr b gy oa ob l oc od">// usage.mjs<br/>import { output } from "./awaiting.mjs";<br/>export function outputPlusValue(value) { return output + value }</span><span id="fa7c" class="nc lv iq nr b gy oe ob l oc od">console.log(outputPlusValue(100));<br/>setTimeout(() =&gt; console.log(outputPlusValue(100), 1000);</span></pre><p id="2ed7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe no np nq nr b">awaiting.mjs</code>中的<code class="fe no np nq nr b">await</code>的承诺得到解决之前，<code class="fe no np nq nr b">usage.mjs</code>不会执行其中的任何语句。</p><h2 id="2a96" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">JavaScript的无效合并</h2><p id="e8b7" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">这将是第三阶段提案中最有用的特征之一。我们经常编写这种代码。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="5ca9" class="nc lv iq nr b gy oa ob l oc od">const obj = { <br/>  name: 'James'<br/>};</span><span id="3090" class="nc lv iq nr b gy oe ob l oc od">const name = obj.name || 'Jane'; // James</span></pre><p id="a565" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe no np nq nr b">obj.name</code>为falsy，则返回‘Jane’，所以<code class="fe no np nq nr b">undefined</code>不会被返回。但问题是，在这种情况下，空字符串(<code class="fe no np nq nr b">‘’</code>)也被认为是falsy。那我们应该像下面这样重新写一遍。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="5939" class="nc lv iq nr b gy oa ob l oc od">const name = (obj.name &amp;&amp; obj.name !== '') ? obj.name : 'Jane';</span></pre><p id="7fa8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每次都像那样写代码是件痛苦的事。该建议仅允许您检查<code class="fe no np nq nr b">null</code>和<code class="fe no np nq nr b">undefined</code>。</p><figure class="ns nt nu nv gt jr"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="bb5d" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">可选链接</h2><p id="8311" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">这个提议与JavaScript 的<em class="lp"> Nullish合并相一致，尤其是在TypeScript中。TypeScript宣布他们将在下一个发布版本3.7.0中包含JavaScript的Nullish合并。</em></p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="3386" class="nc lv iq nr b gy oa ob l oc od">const city = country &amp;&amp; country.city; <br/>// undefined if city doesn't exist</span></pre><p id="05a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请看示例代码。为了获取<code class="fe no np nq nr b">country</code>对象中的<code class="fe no np nq nr b">city</code>，我们应该检查<code class="fe no np nq nr b">country</code>是否存在，以及<code class="fe no np nq nr b">city</code>是否存在于<code class="fe no np nq nr b">country</code>中。</p><p id="0122" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<em class="lp">可选链接</em>，这段代码可以这样重构。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="0410" class="nc lv iq nr b gy oa ob l oc od">const city = country?.city; // undefined if city doesn't exist</span></pre><p id="8851" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这种情况，这个特性似乎非常方便和有用。</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="fc81" class="nc lv iq nr b gy oa ob l oc od">import { fetch } from '../yourFetch.js';</span><span id="9058" class="nc lv iq nr b gy oe ob l oc od">(async () =&gt; {<br/>  const res = await fetch();</span><span id="ec10" class="nc lv iq nr b gy oe ob l oc od">  // res &amp;&amp; res.data &amp;&amp; res.data.cities || undefined<br/>  const cities = res?.data?.cities;<br/>})();</span></pre><h2 id="6c1f" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">承诺。任何</h2><blockquote class="lm ln lo"><p id="8648" class="jy jz lp ka b kb kc kd ke kf kg kh ki lq kk kl km lr ko kp kq ls ks kt ku kv ij bi translated"><code class="fe no np nq nr b"><em class="iq">Promise.any</em></code>接受一系列承诺并返回由第一个要履行的给定承诺履行的承诺，或者如果所有给定承诺都被拒绝，则返回一系列拒绝原因。</p></blockquote><p id="d025" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用<code class="fe no np nq nr b">async</code> - <code class="fe no np nq nr b">await</code>，</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="f613" class="nc lv iq nr b gy oa ob l oc od">try {<br/>  const first = await Promise.any(promises);<br/>  // Any of the promises was fulfilled.<br/>} catch (error) {<br/>  // All of the promises were rejected.<br/>}</span></pre><p id="91e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了承诺模式，</p><pre class="ns nt nu nv gt nw nr nx ny aw nz bi"><span id="5112" class="nc lv iq nr b gy oa ob l oc od">Promise.any(promises).then(<br/>  (first) =&gt; {<br/>    // Any of the promises was fulfilled.<br/>  },<br/>  (error) =&gt; {<br/>    // All of the promises were rejected.<br/>  }<br/>);</span></pre><p id="1398" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然有承诺<code class="fe no np nq nr b">all</code>、<code class="fe no np nq nr b">allSettled</code>、<code class="fe no np nq nr b">race</code>，就没有<code class="fe no np nq nr b">any</code>。所以这个特性很简单，但是在需要的情况下很强大。</p><p id="3645" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，这个提议还没有经过测试，所以这个提议可能需要更长的时间才能在ECMAScript的未来版本中被接受。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="15a3" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">结论</h1><p id="67dd" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">第三阶段有很多有趣的提议。我迫不及待地想在ES11或ES12中见到他们。当然，我不需要全部，但是其中一些肯定会使我的代码更加优雅。</p><h2 id="6128" class="nc lv iq bd lw nd ne dn ma nf ng dp me kj nh ni mi kn nj nk mm kr nl nm mq nn bi translated">参考</h2><ul class=""><li id="cb61" class="oh oi iq ka b kb ms kf mt kj oj kn ok kr ol kv om on oo op bi translated"><a class="ae lt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flat" rel="noopener ugc nofollow" target="_blank"> Array.prototype.flat </a></li><li id="7ac6" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flatMap" rel="noopener ugc nofollow" target="_blank">array . prototype . flat map</a></li><li id="0115" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://github.com/tc39/proposals" rel="noopener ugc nofollow" target="_blank">Github中的TC39提案</a></li><li id="3366" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://github.com/tc39/proposal-numeric-separator" rel="noopener ugc nofollow" target="_blank">数字分隔符</a></li><li id="047d" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://github.com/tc39/proposal-top-level-await" rel="noopener ugc nofollow" target="_blank">顶级等待</a></li><li id="9430" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://github.com/tc39/proposal-nullish-coalescing" rel="noopener ugc nofollow" target="_blank">JavaScript的无效合并</a></li><li id="cfea" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://github.com/tc39/proposal-optional-chaining" rel="noopener ugc nofollow" target="_blank">可选链接</a></li><li id="5ffe" class="oh oi iq ka b kb oq kf or kj os kn ot kr ou kv om on oo op bi translated"><a class="ae lt" href="https://github.com/tc39/proposal-promise-any" rel="noopener ugc nofollow" target="_blank">言而无信</a></li></ul></div></div>    
</body>
</html>