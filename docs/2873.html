<html>
<head>
<title>Server-side-rendering styled-components with Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js在服务器端呈现样式化组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/server-side-rendering-styled-components-with-next-js-3197e527763b?source=collection_archive---------3-----------------------#2020-07-31">https://javascript.plainenglish.io/server-side-rendering-styled-components-with-next-js-3197e527763b?source=collection_archive---------3-----------------------#2020-07-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8600" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">融合了两个世界的精华</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f983b096d99417a4ab5846db3c8b9781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Msuu8ek5kMUk-P_yVepRuw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Combining Next.js &amp; styled-components</figcaption></figure><h1 id="15f7" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">为什么要在服务器端呈现样式化组件呢？</h1><p id="4361" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">因此，我们应该仔细看看样式化组件，尤其是它实际上是如何工作的。</p><p id="bc45" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">多亏了这个库，我们可以直接用JavaScript编写CSS代码。这有很多优点，但是从性能的角度来看是有问题的。</p><p id="a0c7" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这与传统的客户端渲染存在相同的问题。由于一切都只在JavaScript中可用，但浏览器只理解CSS，而CSS可以通过内联样式、样式标签或外部CSS文件来集成和理解，因此在执行我们的web应用程序时，CSS是通过执行JavaScript直接生成的。<br/> <br/>只有在这个过程之后，CSS代码对于浏览器才是可读的，但不是立即可读的，就像我们简单地在头部区域写CSS一样。</p><p id="1a63" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">所以让我们记住，CSS-in-JS解决方案总是需要多一个步骤——这当然会对性能产生不良影响，即使影响很小。</p><p id="021f" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这里有一个有趣的关于风格化组件与原生CSS的<a class="ae mo" href="https://blog.primehammer.com/the-performance-of-styled-react-components/" rel="noopener ugc nofollow" target="_blank">基准</a>。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="7f0d" class="kv kw iq bd kx ky mw la lb lc mx le lf jw my jx lh jz mz ka lj kc na kd ll lm bi translated">让我们首先创建一个新的Next.js项目</h1><p id="c9b5" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">要将Next.js用于样式化组件，我们需要一个新的基本项目。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="505d" class="ng kw iq nc b gy nh ni l nj nk">mkdir &lt;project-name&gt;<br/>cd &lt;project-name&gt;</span><span id="a81a" class="ng kw iq nc b gy nl ni l nj nk">npm init -y </span><span id="b6c8" class="ng kw iq nc b gy nl ni l nj nk">npm install react react-dom next styled-components</span><span id="d1e6" class="ng kw iq nc b gy nl ni l nj nk">mkdir pages </span></pre><p id="1c78" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">确保更新<strong class="lp ir"> package.json，</strong>以便我们可以实际运行和构建我们的项目:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="18c7" class="ng kw iq nc b gy nh ni l nj nk">“scripts”: {<br/> “start”: “next start”,<br/> “dev”: “next dev”,<br/> “build”: “next build”,<br/> “export”: “next export”<br/> }</span></pre><p id="7544" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">让我们创建<strong class="lp ir"> index.js </strong>作为我们的开始页面。它应该放在/pages目录中，该目录是Next.js中路由的默认目录。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="98b7" class="ng kw iq nc b gy nh ni l nj nk"><em class="nm">export</em> <em class="nm">default</em> () =&gt; (<br/>  &lt;React.Fragment&gt;<br/>    &lt;h1&gt;Welcome!&lt;/h1&gt;<br/>    &lt;p&gt;This is our next.js app&lt;/p&gt;<br/>  &lt;/React.Fragment&gt;<br/>)</span></pre><p id="3bea" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">如果您现在启动开发模式，使用“<strong class="lp ir"> npm run dev </strong>”，应用程序应该工作正常。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="bdf0" class="kv kw iq bd kx ky mw la lb lc mx le lf jw my jx lh jz mz ka lj kc na kd ll lm bi translated">让我们实现支持SSR的样式化组件</h1><p id="b8a3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">让我们进入有趣的部分，因为我们的基本Next.js应用程序已经在运行了。</p><ol class=""><li id="e5ad" class="nn no iq lp b lq mj lt mk lw np ma nq me nr mi ns nt nu nv bi translated">我们需要实现Babel，以便能够在服务器上呈现样式化的组件:NPM install-D Babel-plugin-style-components</li><li id="d609" class="nn no iq lp b lq nw lt nx lw ny ma nz me oa mi ns nt nu nv bi translated">在这个文件中，我们将SSR设置为true，这意味着我们的样式组件样式将在服务器上呈现。</li></ol><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="cbd2" class="ng kw iq nc b gy nh ni l nj nk">{<br/>  “presets”: [“next/babel”],<br/>  “plugins”: [[“styled-components”, { “ssr”: true }]]<br/>}</span></pre><p id="a7ba" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在我们可以开始在Next.js中使用样式化组件了:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="2945" class="ng kw iq nc b gy nh ni l nj nk"><em class="nm">import</em> styled <em class="nm">from</em> “styled-components”</span><span id="1f9e" class="ng kw iq nc b gy nl ni l nj nk">const Headline = styled.h1`<br/>  color: red;<br/>  font-family: Arial, Helvetica, sans-serif;<br/>`</span><span id="a7ed" class="ng kw iq nc b gy nl ni l nj nk"><em class="nm">export</em> <em class="nm">default</em> () =&gt; (<br/>  &lt;React.Fragment&gt;<br/>    &lt;Headline&gt;Welcome!&lt;/Headline&gt;<br/>  &lt;/React.Fragment&gt;<br/>)</span></pre><p id="f6c1" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">同样，运行开发模式，并使用“npm run build”创建生产版本，并使用“npm start”为其提供服务，这一次，输出将使用样式化组件进行样式化。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/9d43ba3ce7aa9aa90d313fcf3f4305ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*X764NMhgrb7H5hKBLNZ2Dg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The working Next.js app, using styled-components</figcaption></figure><p id="7e35" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><strong class="lp ir">但是只有一个问题:</strong>样式化组件的服务器端渲染还没有激活。您可以从服务器的响应和HTML文档中不提供CSS样式这一事实看出这一点。</p><p id="0798" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">运行“npm run build &amp;&amp; npm run start”来创建和提供我们的应用程序的构建版本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/f0634678834743e294b9a85913842f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KGCCujnyzV3v92oBr4WKA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Sourcecode of our Next.js app, displayed in the browser</figcaption></figure><p id="edce" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">如果您现在进入页面并查看页面源代码，您将看到应用了h1的样式，但是它的CSS代码在文档中并不直接可用。服务器端呈现仍然被禁用。</p><p id="3c5f" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">为了解决这个问题，我们首先必须包含<strong class="lp ir"> _document.js </strong>这是我们必须创建并填充Next.js的默认文件，以创建一个自定义文档来影响我们web应用程序的&lt; html &gt;和&lt; head &gt;部分。</p><p id="a6f5" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这个文件默认位于<strong class="lp ir"> /pages/_document.js </strong>下，只在那里工作。我们仍然需要创造它。</p><p id="5397" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">幸运的是，在<a class="ae mo" href="https://github.com/vercel/next.js/tree/canary/examples/with-styled-components" rel="noopener ugc nofollow" target="_blank"> GitHub </a>，我们发现了一个Next.js + styled-components的官方示例，其中<strong class="lp ir"> _document.js </strong>已经完成。</p><p id="72f3" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">可以忽略<strong class="lp ir"> _app.js </strong>，GitHub上的代码示例里也有。简单地包含样式化组件，这并不重要。只要确保你的<strong class="lp ir"> _document.js </strong>看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">our _document.js</figcaption></figure><p id="bf79" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">如果我们现在以这种方式运行项目，我们会看到样式化组件实际上是在服务器端呈现的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/d6c314aec95da118747edef9b4f3246f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9QnlbgiMBe-Lt7J3C-mE2Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">CSS Code hardcoded into the HTML</figcaption></figure><p id="08b8" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">就是这样。</p><h2 id="e615" class="ng kw iq bd kx og oh dn lb oi oj dp lf lw ok ol lh ma om on lj me oo op ll oq bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="e7ee" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae mo" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="lp ir">订阅解码，我们的YouTube频道</strong> </a> <strong class="lp ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>