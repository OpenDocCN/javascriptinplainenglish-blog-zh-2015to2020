<html>
<head>
<title>How to Build Realtime Face Detection in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript构建实时人脸检测</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-realtime-face-detection-in-javascript-64b083b7d88a?source=collection_archive---------6-----------------------#2020-08-27">https://javascript.plainenglish.io/how-to-build-realtime-face-detection-in-javascript-64b083b7d88a?source=collection_archive---------6-----------------------#2020-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="87f7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用JavaScript构建实时人脸检测和应用过滤器，如instagram。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/68031b0a1b4446485b9641093d87b643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4s4VKp08C76p1KUt"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@aditya_ali?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aditya Ali</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="401a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">读者你好！</p><p id="b050" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天在这篇文章中，我们讨论实时人脸检测以及如何应用instagram或snapchat功能等过滤器。在这个项目中，我们将创建一些超级酷的过滤器，如蜘蛛侠面具，狗过滤器等</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4f55" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">检测人脸特征</h1><p id="cf18" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在JavaScript中有一个名为<strong class="ky ir"> clmtrackr的库。</strong>用于检测图像上的人脸。它还发现了鼻子、耳朵等…</p><p id="0d16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，这个库提供了通用模型，它已经预先训练，并准备使用下列数量的功能。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/b1cfe244fb0eb3f99d719caaaf2c5121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A3Q2dSgjkf-kps746vMwyQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Point map</figcaption></figure><p id="23e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们用这个库处理一个图像，它将为地图上的每个点返回一个数组。每个点由<strong class="ky ir"> x </strong>和<strong class="ky ir"> y </strong>轴位置标识。如果你想替换任何东西，你可以用那个点上的数字。让我们开始建设这个惊人的项目。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0ad7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">基本代码结构</h1><p id="c06d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了构建这个应用程序，我们将使用<strong class="ky ir"> p5.js </strong>。这是一个JavaScript库，主要用于处理canvas。它不是一个传统的用户界面库，但是当需要更新时，它将定义何时构建用户界面。它包含三个主要事件:</p><ul class=""><li id="2461" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated"><strong class="ky ir"> preload </strong>:用于执行在屏幕上构建任何UI前后加载的右库。</li><li id="1d5c" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><strong class="ky ir">设置</strong>:在<strong class="ky ir">预加载</strong>之后，当我们准备构建初始UI时，也执行一次。</li><li id="083d" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><strong class="ky ir"> draw </strong>:循环内调用的函数，每次系统需要渲染屏幕时执行。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d508" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">事先装好</h1><p id="dd4b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在我们将使用preload事件将图像加载到屏幕中。让我们看看下面的代码:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="fa60" class="nq ma iq nm b gy nr ns l nt nu">function preload() {<br/>    // Spiderman Mask Filter asset<br/>    imgSpidermanMask = loadImage("https://i.ibb.co/9HB2sSv/spiderman-mask-1.png");<br/>    <br/>    // Dog Face Filter assets<br/>    imgDogEarRight = loadImage("https://i.ibb.co/bFJf33z/dog-ear-right.png");<br/>    imgDogEarLeft = loadImage("https://i.ibb.co/dggwZ1q/dog-ear-left.png");<br/>    imgDogNose = loadImage("https://i.ibb.co/PWYGkw1/dog-nose.png");<br/>}</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="15de" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建画布</h1><p id="740c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了提高响应速度，画布必须根据窗口大小动态调整大小。长宽比为4∶3。这不是理想的选择，但是我们必须做一些假设来保持代码的效率。现在我们将使用下面的代码用<strong class="ky ir"> P5.js </strong>函数<strong class="ky ir"> createCanvas </strong>创建一个:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="1302" class="nq ma iq nm b gy nr ns l nt nu">const maxWidth = Math.min(windowWidth, windowHeight);<br/>pixelDensity(1);<br/>outputWidth = maxWidth;<br/>outputHeight = maxWidth * 0.75; // 4:3<br/><br/>createCanvas(outputWidth, outputHeight);</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f21c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">捕捉视频流</h1><p id="70ab" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在我们知道画布工作正常，然后我们需要通过我们的网络摄像头或相机捕捉视频。<strong class="ky ir"> P5.js </strong>函数将使用<strong class="ky ir"> videoCapture </strong>函数来实现这一点。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="37d1" class="nq ma iq nm b gy nr ns l nt nu">// webcam capture<br/>videoInput = createCapture(VIDEO);<br/>videoInput.size(outputWidth, outputHeight);<br/>videoInput.hide();</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2074" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建过滤器选择</h1><p id="b7ea" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在我们需要建立一个过滤器，我们必须为过滤器提供更多的选项。我们可以简单地使用这个项目的下拉功能。我们可以使用<strong class="ky ir">P5 . js</strong><strong class="ky ir">create select()</strong>函数来创建它。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="ab80" class="nq ma iq nm b gy nr ns l nt nu">// select filter<br/>const sel = createSelect();<br/>const selectList = ['Spiderman Mask', 'Dog Filter']; // list of filters<br/>sel.option('Select Filter', -1); // Default no filter<br/>for (let i = 0; i &lt; selectList.length; i++)<br/>{<br/>    sel.option(selectList[i], i);<br/>}<br/>sel.changed(applyFilter);</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6e49" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建图像捕捉</h1><p id="8b66" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在，对于图像捕捉，图像跟踪器是视频馈送的对象，它将识别面部的每一帧。跟踪器只需要设置一次。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="8f18" class="nq ma iq nm b gy nr ns l nt nu">// tracker<br/>faceTracker = new clm.tracker();<br/>faceTracker.init();<br/>faceTracker.start(videoInput.elt);</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0cc9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">绘制视频滤镜</h1><p id="1728" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为此我们需要更新<strong class="ky ir"> P5.js </strong>中的<strong class="ky ir"> draw </strong>事件。视频源到画布的输出将应用我们在其中被选择的任何过滤器。在我们的例子中，draw函数非常简单。这将把复杂性推进到每个过滤器定义中。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="d89d" class="nq ma iq nm b gy nr ns l nt nu">function draw() {<br/>  image(videoInput, 0, 0, outputWidth, outputHeight); // render video from webcam<br/><br/>  // apply filter based on choice<br/>  switch(selected)<br/>  {<br/>    case '-1': break;<br/>    case '0': drawSpidermanMask(); break;<br/>    case '1': drawDogFace(); break;<br/>  }<br/>}</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8204" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建过滤器</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/be4aaf32848a48579959b2ccb789a2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*TlqTwldjF-OqH9UoaFXnpg.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Dog filter</figcaption></figure><p id="facb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建过滤器的过程既简单又复杂。实际上，这取决于我们将要构建的过滤器。为了构建遮罩，我们需要将遮罩图像添加到屏幕的中心。首先，我们必须使用<strong class="ky ir">facetraker . getcurrentposition()</strong>来确保我们的faceTracker对象确实检测到一张人脸。</p><p id="4ad9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦检测到面部，我们必须使用<strong class="ky ir"> P5.js </strong>来渲染图像，使用面部点62来使图像居中。然后用宽度和高度表示面部的大小，如下所示。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="2f87" class="nq ma iq nm b gy nr ns l nt nu">const positions = faceTracker.getCurrentPosition();<br/>if (positions !== false)<br/>{<br/>    push();<br/>    const wx = Math.abs(positions[13][0] - positions[1][0]) * 1.2; // The width is given by the face width, based on the geometry<br/>    const wy = Math.abs(positions[7][1] - Math.min(positions[16][1], positions[20][1])) * 1.2; // The height is given by the distance from nose to chin, times 2<br/>    translate(-wx/2, -wy/2);<br/>    image(imgSpidermanMask, positions[62][0], positions[62][1], wx, wy); // Show the mask at the center of the face<br/>    pop();<br/>}</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="aa15" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="5205" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我希望你喜欢它，并且学会了如何使用JavaScript库创建一个基本的过滤器。您可以自己创建更多令人惊叹的滤镜并添加到其中。</p><p id="ff36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>