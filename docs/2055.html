<html>
<head>
<title>Creating a CRUD API in Deno with Oak and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Oak和MongoDB在Deno中创建CRUD API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deno-oak-mongo-3d29542333fd?source=collection_archive---------6-----------------------#2020-05-16">https://javascript.plainenglish.io/deno-oak-mongo-3d29542333fd?source=collection_archive---------6-----------------------#2020-05-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><blockquote class="jk jl jm"><p id="cfaf" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">Deno是一个简单、现代和安全的JavaScript和TypeScript运行时，它使用V8并内置于Rust中。</p></blockquote><p id="230a" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">2020年5月13日，Deno的v1.0正式上线。Deno是由Ryan Dahl开发的，他也在Node.js的开发中发挥了重要作用。看看几个月前的视频，Ryan Dahl和麦显杰·凯利在视频中谈论了创建Deno背后的想法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk"><a class="ae la" href="https://www.youtube.com/watch?v=1gIiZfSbEAE" rel="noopener ugc nofollow" target="_blank">Deno is a New Way to JavaScript — Ryan Dahl &amp; Kitson Kelly</a></figcaption></figure><p id="9dd1" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">下面是Deno和Node.js的一些基本的异同点。</p><ul class=""><li id="d4e4" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl lg lh li lj bi translated">Deno是用Rust在核心构建的，不像Node.js用C++。</li><li id="7631" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl lg lh li lj bi translated">而且，Deno支持开箱即用的typeScript。在Node.js中使用like之前，它们不需要编译成javascript文件。</li><li id="05d8" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl lg lh li lj bi translated">Deno和Node.js都使用V8 javascript运行时。</li><li id="293f" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl lg lh li lj bi translated">除非明确启用，否则Deno没有文件、网络或环境访问权限。而Node.js可以访问本地文件和网络，而不需要任何额外的权限，这是一个安全问题。</li><li id="d881" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl lg lh li lj bi translated">Deno不使用节点模块和npm。当程序第一次运行时，直接从URL导入并缓存的包。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/03dc282e3ddfd3427fe60ab1ea86bfb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FAR2HAOsTukGu4BrI1Lkew.jpeg"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">DENO</figcaption></figure><h2 id="efe9" class="lw lx in bd ly lz ma dn mb mc md dp me km mf mg mh kn mi mj mk ko ml mm mn mo bi translated">装置</h2><p id="42e2" class="pw-post-body-paragraph jn jo in jq b jr mp jt ju jv mq jx jy km mr kb kc kn ms kf kg ko mt kj kk kl ig bi translated">使用Shell (Linux):</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="ddda" class="lw lx in mv b gy mz na l nb nc">curl -fsSL https://deno.land/x/install/install.sh | sh</span></pre><p id="3859" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">使用自制软件(macOS):</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="6e6e" class="lw lx in mv b gy mz na l nb nc">brew install deno</span></pre><p id="a355" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">使用巧克力(Windows):</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="636d" class="lw lx in mv b gy mz na l nb nc">choco install deno</span></pre><p id="6e57" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">在这篇博客中，我将使用oak和deno_mongo库在Deno中创建一个服务器应用程序。</p><ul class=""><li id="cd51" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl lg lh li lj bi translated"><a class="ae la" href="https://deno.land/x/oak" rel="noopener ugc nofollow" target="_blank"> <strong class="jq io">橡树</strong> </a> <strong class="jq io"> : </strong>它是Deno的<a class="ae la" href="https://github.com/denoland/deno_std/tree/master/http#http" rel="noopener ugc nofollow" target="_blank"> Http </a>服务器的中间件框架，包括一个路由器中间件。这个中间件框架的灵感来自于<a class="ae la" href="https://github.com/koajs/koa" rel="noopener ugc nofollow" target="_blank"> Koa </a>和中间件路由器，灵感来自于<a class="ae la" href="https://github.com/alexmingoia/koa-router/" rel="noopener ugc nofollow" target="_blank"> koa-router </a>与Node.js一起使用。</li><li id="19b6" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl lg lh li lj bi translated"><a class="ae la" href="https://deno.land/x/mongo" rel="noopener ugc nofollow" target="_blank"> <strong class="jq io"> deno_mongo </strong> </a>:是为deno开发的MongoDB数据库驱动，基于Rust的<a class="ae la" href="https://crates.io/crates/mongodb" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>库包。</li></ul><p id="5d1f" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">所以，让我们从编码部分开始。这个迷你项目是一个简单的服务器应用程序来创建我们的朋友名单。我们将能够在MongoDB数据库中添加、获取、更新和删除我们朋友的数据。</p><p id="8cdf" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">下面是我们目录的结构</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/6d7430c86c2849b32725f67b7fd8f356.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*Z0NTcyTMZkgM0W-vQ_ukDg.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Directory structure</figcaption></figure><p id="b66e" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">这是app.ts文件。这是我们将用来启动服务器和声明路由的文件。</p><p id="b003" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><code class="fe ne nf ng mv b"><strong class="jq io">./app.ts</strong></code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh kv l"/></div></figure><p id="6c48" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">然后创建helper文件夹，我们将在其中创建用于连接MongoDB数据库的<code class="fe ne nf ng mv b">dbconnect.ts</code>。</p><p id="ed4e" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><code class="fe ne nf ng mv b"><strong class="jq io">./helpers/dbconnect.ts</strong></code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh kv l"/></div></figure><p id="46f2" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">现在我们将进入主要部分。为路线创建控制器。</p><p id="c203" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">这个项目我们有4个控制器。</p><ol class=""><li id="52bc" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl ni lh li lj bi translated"><strong class="jq io">add friend</strong>(POST)<strong class="jq io">:</strong>向数据库添加好友。(插入操作)</li><li id="b921" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><strong class="jq io"> getFriend </strong> (GET):获取指定id的好友数据。(查找操作)</li><li id="a7dd" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><strong class="jq io"> updateFriend </strong>(补丁):更新给定id的朋友的电子邮件和pno。(更新操作)</li><li id="4e9e" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><strong class="jq io">删除好友</strong>(删除):使用id删除好友。(删除操作)</li></ol><p id="fe72" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">1.<code class="fe ne nf ng mv b"><strong class="jq io"> ./Controllers/addFriend.ts</strong></code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh kv l"/></div></figure><p id="c4e0" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">路线-</strong>T2】</p><p id="7e78" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">样本输入</strong>:请求体，内容类型:json</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="5b91" class="lw lx in mv b gy mz na l nb nc">{<br/> “name”: “Subhra”,<br/> “pno”: “9003814273”,<br/> “email”: “<a class="ae la" href="mailto:subhrapaladhi9@gmail.com" rel="noopener ugc nofollow" target="_blank">subhrapaladhi9@gmail.com</a>”<br/>}</span></pre><p id="386c" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">样本输出</strong>:mongoID返回。</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="361d" class="lw lx in mv b gy mz na l nb nc">{</span><span id="77a9" class="lw lx in mv b gy nj na l nb nc">"$oid": "5ec0a99c003430240011550b"</span><span id="11fe" class="lw lx in mv b gy nj na l nb nc">}</span></pre><p id="6257" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">2.<code class="fe ne nf ng mv b"><strong class="jq io">./Controllers/getFriend.ts</strong></code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh kv l"/></div></figure><p id="daa8" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">路线-</strong>T4】</p><p id="9d7c" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">样本输出</strong>:返回好友数据</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="4d5d" class="lw lx in mv b gy mz na l nb nc">{<br/>  "_id": {<br/>    "$oid": "5ec0a99c003430240011550b"<br/>  },<br/>  "name": "Subhra",<br/>  "pno": "9003814273",<br/>  "email": "subhrapaladhi9@gmail.com"<br/>}</span></pre><p id="5b13" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io"> 3。</strong> <code class="fe ne nf ng mv b"><strong class="jq io">./Controllers/updateFriend.ts</strong></code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh kv l"/></div></figure><p id="5578" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">路线- </strong> <code class="fe ne nf ng mv b"><strong class="jq io">PATCH: </strong>localhost:3000/updateFriend/5ec0a99c0034302411550b</code></p><p id="aae9" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">样本输入</strong>:请求体，内容类型:json</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="0a28" class="lw lx in mv b gy mz na l nb nc">{<br/> "pno": "9458059340",<br/> "email": "<a class="ae la" href="mailto:subhrapaladhi9@outlook.com" rel="noopener ugc nofollow" target="_blank">subhrapaladhi9@outlook.com</a>"<br/>}</span></pre><p id="14ca" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">样本输出</strong>:返回以下3个字段。</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="1fb1" class="lw lx in mv b gy mz na l nb nc">{<br/>  "matchedCount": 1,<br/>  "modifiedCount": 1,<br/>  "upsertedId": null<br/>}</span></pre><p id="8708" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io"> 4 </strong>。<code class="fe ne nf ng mv b"><strong class="jq io">./Controllers/deleteFriend.ts</strong></code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh kv l"/></div></figure><p id="53ba" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">路线- </strong> <code class="fe ne nf ng mv b"><strong class="jq io">DELETE: </strong>localhost:3000/deleteFriend/5ec0a99c0034302411550b</code></p><p id="41d6" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">样本输出</strong> : <code class="fe ne nf ng mv b">“result”</code>删除成功时为1，否则为0。</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="e445" class="lw lx in mv b gy mz na l nb nc">{<br/>  "result": 1<br/>}</span></pre><p id="92db" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">现在让我们运行我们的项目。在项目的根目录下打开终端/命令提示符，粘贴这个命令。</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="bbae" class="lw lx in mv b gy mz na l nb nc">deno run --allow-net --allow-write --allow-read --allow-plugin --unstable app.ts</span></pre><p id="9b98" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><code class="fe ne nf ng mv b">- — allow-write --allow-read --allow-plugin --unstable</code> —这些是授予Deno访问网络和其他资源的权限所需的标志。</p><p id="8f1a" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">当您第一次运行该命令时，它将下载依赖项并在本地缓存它们。还将创建一个<code class="fe ne nf ng mv b">./.deno_plugins</code>文件夹。您可以在提交代码之前将其添加到<code class="fe ne nf ng mv b">.gitignore</code>文件中。</p><p id="b8b4" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">Deno的一个小更新刚刚发布(2020年5月20日)。它主要有一些错误修复。运行以下命令进行升级:-</p><pre class="kp kq kr ks gt mu mv mw mx aw my bi"><span id="a3bf" class="lw lx in mv b gy mz na l nb nc">deno upgrade --version 1.0.1</span></pre><p id="5d8b" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated">希望这能帮助你开始使用Deno。我附上了一些资源链接，你可以从中了解更多关于Deno的知识。</p><h2 id="117b" class="lw lx in bd ly lz ma dn mb mc md dp me km mf mg mh kn mi mj mk ko ml mm mn mo bi translated"><strong class="ak">参考资料和资源:</strong></h2><p id="eb2c" class="pw-post-body-paragraph jn jo in jq b jr mp jt ju jv mq jx jy km mr kb kc kn ms kf kg ko mt kj kk kl ig bi translated"><strong class="jq io">该项目的GitHub链接</strong></p><ol class=""><li id="609c" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl ni lh li lj bi translated"><a class="ae la" href="https://github.com/subhrapaladhi/Friend-List-with-Deno" rel="noopener ugc nofollow" target="_blank">好友列表带号</a></li></ol><p id="4c83" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">视频</strong></p><ol class=""><li id="25de" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl ni lh li lj bi translated"><a class="ae la" href="https://youtu.be/ll-8rtmq2Zc" rel="noopener ugc nofollow" target="_blank"> Deno视频速成班</a></li><li id="4986" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><a class="ae la" href="https://www.youtube.com/watch?v=M3BM9TB-8yA" rel="noopener ugc nofollow" target="_blank">node . js我后悔的10件事——Ryan Dahl——JSConf EU</a></li></ol><p id="98ce" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">单据</strong></p><ol class=""><li id="7a9d" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl ni lh li lj bi translated"><a class="ae la" href="https://deno.land/" rel="noopener ugc nofollow" target="_blank"> Deno官网</a></li><li id="f2f2" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><a class="ae la" href="https://deno.land/x/oak" rel="noopener ugc nofollow" target="_blank">橡树</a></li><li id="3af8" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><a class="ae la" href="https://deno.land/x/mongo" rel="noopener ugc nofollow" target="_blank">德诺_蒙戈</a></li></ol><p id="aa56" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy km ka kb kc kn ke kf kg ko ki kj kk kl ig bi translated"><strong class="jq io">博客</strong></p><ol class=""><li id="c954" class="lb lc in jq b jr js jv jw km ld kn le ko lf kl ni lh li lj bi translated"><a class="ae la" href="https://dev.to/slimhmidi/create-a-server-with-deno-and-mongo-206l" rel="noopener ugc nofollow" target="_blank">使用Deno和Mongo创建服务器(使用abc框架)</a></li><li id="cbdc" class="lb lc in jq b jr lk jv ll km lm kn ln ko lo kl ni lh li lj bi translated"><a class="ae la" href="https://blog.logrocket.com/creating-your-first-rest-api-with-deno-and-postgres/" rel="noopener ugc nofollow" target="_blank">使用Deno和Postgres创建您的第一个REST API</a></li></ol><h1 id="2bfa" class="nk lx in bd ly nl nm nn mb no np nq me nr ns nt mh nu nv nw mk nx ny nz mn oa bi translated"><strong class="ak">来自简明英语团队的笔记</strong></h1><p id="d0ed" class="pw-post-body-paragraph jn jo in jq b jr mp jt ju jv mq jx jy km mr kb kc kn ms kf kg ko mt kj kk kl ig bi translated">你知道我们有四份出版物和一个YouTube频道吗？你可以在我们的主页<a class="ae la" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jq io">plain English . io</strong></a>找到所有这些信息——关注我们的出版物并<a class="ae la" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="jq io">订阅我们的YouTube频道</strong> </a> <strong class="jq io">来表达你的爱吧！</strong></p></div></div>    
</body>
</html>