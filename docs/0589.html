<html>
<head>
<title>Setting Up Google Analytics and Facebook Pixel in Angular 8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Angular 8中设置谷歌分析和脸书像素</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/setting-up-google-analytics-and-facebook-pixel-in-angular-8-b934219991d4?source=collection_archive---------1-----------------------#2019-11-13">https://javascript.plainenglish.io/setting-up-google-analytics-and-facebook-pixel-in-angular-8-b934219991d4?source=collection_archive---------1-----------------------#2019-11-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="73a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">谷歌分析是最常用的网站分析工具。它帮助开发者和网站管理员跟踪用户在他们网站上的活动，也为我们提供了许多功能来评估我们网站的性能。</p><p id="af39" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Pixel是脸书开发的一款追踪工具，可以帮助你追踪访客和他们在你的网站/应用中的活动。这也有助于你在脸书上做广告时锁定这些访问者。</p><p id="5bea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Angular应用程序是一个单页面应用程序(SPA ),因此谷歌分析和脸书像素不会有效地与它合作。</p><h2 id="7eb4" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">先决条件</h2><ol class=""><li id="a3d3" class="lb lc in jm b jn ld jr le jv lf jz lg kd lh kh li lj lk ll bi translated">角度CLI。</li><li id="8188" class="lb lc in jm b jn lm jr ln jv lo jz lp kd lq kh li lj lk ll bi translated">Firebase CLI。</li><li id="5666" class="lb lc in jm b jn lm jr ln jv lo jz lp kd lq kh li lj lk ll bi translated">一个Firebase项目(假设名称空间是sample-app-xxxx)。</li><li id="8cf0" class="lb lc in jm b jn lm jr ln jv lo jz lp kd lq kh li lj lk ll bi translated">一个谷歌分析和脸书商业帐户。</li></ol><p id="0f71" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们开始吧。</p><h2 id="a914" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤1:创建和配置角度应用程序</h2><p id="d313" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">通过运行命令创建角度应用程序</p><blockquote class="lu lv lw"><p id="00ba" class="jk jl lx jm b jn jo jp jq jr js jt ju ly jw jx jy lz ka kb kc ma ke kf kg kh ig bi translated">ng新样本应用程序</p></blockquote><p id="4e0d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当提示是否应该启用路由时，键入<em class="lx"> y </em>并选择您喜欢的样式格式。</p><p id="a135" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将创建一个Angular应用程序“SampleApp”并在其中安装所有依赖项。</p><p id="b367" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们添加一些页面，并在我们的应用程序中设置路由。我们正在创建两个组件，<em class="lx">主页</em>和<em class="lx">测试</em>。</p><p id="989b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">键入以下命令创建2个组件</p><blockquote class="lu lv lw"><p id="a9c5" class="jk jl lx jm b jn jo jp jq jr js jt ju ly jw jx jy lz ka kb kc ma ke kf kg kh ig bi translated">ng g c home &amp; &amp; ng g c test</p></blockquote><p id="3aa0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这将创建两个组件<em class="lx"> home </em>和<em class="lx"> test </em>，并且还将更新<em class="lx"> app.module.ts </em>。</p><p id="cf51" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们在<em class="lx"> app-routing.module.ts </em>中进行一些编辑</p><p id="eebc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在编辑器中打开项目，并将<em class="lx"> app-routing.module.ts </em>的内容更新为以下内容</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="1757" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经成功地创建了一个Angular应用程序，添加了2个组件并设置了路由。</p><h2 id="8dc8" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤2:设置Firebase托管</h2><p id="3fbc" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">运行以下命令来初始化Firebase</p><blockquote class="lu lv lw"><p id="8ee0" class="jk jl lx jm b jn jo jp jq jr js jt ju ly jw jx jy lz ka kb kc ma ke kf kg kh ig bi translated">火灾基地初始化</p></blockquote><p id="c1c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">并选择以下选项</p><p id="6d0e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lx">您想使用的CLI功能:托管</em></p><p id="5c87" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lx">公共目录:dist/SampleApp </em></p><p id="7fed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lx">配置为单页应用:是</em></p><p id="8e62" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们在项目中初始化了Firebase。</p><h2 id="50a5" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤3:在谷歌分析中创建属性</h2><p id="c5b7" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">1.进入<a class="ae mi" href="https://analytics.google.com" rel="noopener ugc nofollow" target="_blank">https://analytics.google.com</a>，点击左侧边栏底部的<strong class="jm io">管理</strong>。</p><p id="60db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.点击创建属性，选择网站，然后点击继续。</p><p id="0198" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.填写表格，从firebase dashboard复制url。</p><p id="bc83" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">4.单击Create并复制这里显示的代码。</p><h2 id="490f" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤4:在脸书上创建一个新的像素</h2><p id="e467" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">1.转到<a class="ae mi" href="https://business.facebook.com/settings/pixels/" rel="noopener ugc nofollow" target="_blank">https://business.facebook.com/settings/pixels/</a>并点击添加像素。</p><p id="88f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.给出一个名称，并从Firebase dashboard输入url</p><p id="83d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.复制ID以备后用。</p><h2 id="8f48" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤5:在我们的应用程序中添加像素和分析代码</h2><p id="fb42" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">将步骤3的代码和下面的像素代码粘贴到我们应用程序的<em class="lx">index.html</em>中。</p><blockquote class="lu lv lw"><p id="dd52" class="jk jl lx jm b jn jo jp jq jr js jt ju ly jw jx jy lz ka kb kc ma ke kf kg kh ig bi translated">！function(f，b，e，v，n，t，s) {if(f.fbq)返回；n = f . fbq = function(){ n . call method？n.callMethod.apply(n，参数):n.queue.push(参数)}；如果(！f . _ fbq)f . _ fbq = n；n.push = nn.loaded=！0;n.version = ' 2.0n . queue =[]；t = b . createelement(e)；t.async=！0;t . src = v；s = b . getelementsbytagname(e)[0]；s.parentNode.insertBefore(t，s)}(window，document，' script '，' https://connect . Facebook . net/en _ US/FB events . js ')；fbq('init '，' { your-pixel-id-goes-here } ')；</p></blockquote><p id="c7ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我们的<em class="lx">index.html</em>会变成</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="d304" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">别忘了用你的谷歌分析ID替换<em class="lx"> UA-{ID} </em>，用你的像素ID替换<em class="lx">{ your-Pixel-ID-goes-here }</em>。</p><p id="f94d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们在Angular应用程序中添加了谷歌分析和脸书像素。</p><p id="ae4c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">那么这里有什么问题呢？</strong></p><p id="1961" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Angular是一个单页应用程序。在路线之间导航时，页面不会重新加载。因此，分析和像素脚本不会检测到变化，并发送页面视图。</p><p id="2d70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">怎么修？</strong></p><p id="29dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要以编程方式发送页面视图。为此，我们需要在我们的<em class="lx"> app.component.ts </em>中做一些改变</p><h2 id="94b8" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤6:配置SPA以使用Google Analytics</h2><p id="98c7" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">1.从<em class="lx"> @angular/router </em>导入<em class="lx">路由器</em>和<em class="lx">导航和</em></p><p id="58d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.声明<em class="lx"> gtag </em>和<em class="lx"> fbq </em>为函数。<em class="lx"> gtag </em>是Google Analytics使用的函数，函数定义从位于<a class="ae mi" href="https://www.googletagmanager.com/gtag/js." rel="noopener ugc nofollow" target="_blank">https://www.googletagmanager.com/gtag/js</a>的远程脚本加载。<br/> <em class="lx"> fbq </em>是脸书像素使用的函数，函数定义从<a class="ae mi" href="https://connect.facebook.net/en_US/fbevents.js" rel="noopener ugc nofollow" target="_blank">https://connect.facebook.net/en_US/fbevents.js</a>加载。<br/> Typescript检测不到。所以我们需要将它声明为一个函数。</p><p id="1c68" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">3.订阅<em class="lx">路由器</em>的<em class="lx">导航和</em>事件，并将页面视图发送给谷歌和脸书。</p><p id="4695" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以<em class="lx"> app.component.ts </em>的内容会变成</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mg mh l"/></div></figure><h2 id="36b1" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤7:构建和部署</h2><p id="6fb8" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">现在，通过运行以下命令，将应用程序构建并部署到Firebase。</p><blockquote class="lu lv lw"><p id="5451" class="jk jl lx jm b jn jo jp jq jr js jt ju ly jw jx jy lz ka kb kc ma ke kf kg kh ig bi translated">ng构建-产品- aot和firebase部署</p></blockquote><p id="16d2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当人们通过路线导航时，我们的应用程序将向谷歌和脸书发送页面查看事件，我们可以在分析仪表板和事件管理器仪表板中跟踪他们</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/e429d1d9a9e8bb932b8c5307bd4d40ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/0*Y2TUiIuEmvciEfLk.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Google Analytics Real Time Report Section</figcaption></figure><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mu"><img src="../Images/419633be2a66b58f6a6461b5b12db600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rsusPvlJJ8d8NzlB.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Sample Screenshot of Facebook Pixel Events Manager Dashboard</figcaption></figure></div></div>    
</body>
</html>