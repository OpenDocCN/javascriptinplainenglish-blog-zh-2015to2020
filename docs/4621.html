<html>
<head>
<title>Migrate Travis CI to GitHub Actions for Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Travis CI迁移到Node.js的GitHub操作</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/migrate-travis-ci-to-github-actions-for-node-js-4ab21e28d63c?source=collection_archive---------4-----------------------#2020-12-25">https://javascript.plainenglish.io/migrate-travis-ci-to-github-actions-for-node-js-4ab21e28d63c?source=collection_archive---------4-----------------------#2020-12-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/721c4ee7e1bdc0823a55416f5718d07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y8lmoZfmG8zTgkiV.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk"><a class="ae jz" href="https://b.remarkabl.org/github-actions" rel="noopener ugc nofollow" target="_blank">GitHub Actions</a></figcaption></figure><p id="692e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文将介绍如何为GitHub 上的<a class="ae jz" href="https://b.remarkabl.org/nodejs-site" rel="noopener ugc nofollow" target="_blank"> Node.js </a>项目从<a class="ae jz" href="https://b.remarkabl.org/travis-ci" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>迁移到<a class="ae jz" href="https://b.remarkabl.org/github-actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>。</p><h1 id="3df0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">特拉维斯·CI</h1><p id="3030" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">鉴于<code class="fe mb mc md me b">.travis.yml</code>:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="3e2a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">GitHub操作</h1><p id="c7ec" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">首先制作目录<code class="fe mb mc md me b">.github/workflows</code>:</p><pre class="mf mg mh mi gt ml me mm mn aw mo bi"><span id="2cd7" class="mp kz in me b gy mq mr l ms mt">mkdir -p .github/workflows/</span></pre><p id="bc86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创造<code class="fe mb mc md me b">.github/workflows/build.yml</code>:</p><pre class="mf mg mh mi gt ml me mm mn aw mo bi"><span id="0b98" class="mp kz in me b gy mq mr l ms mt">touch .github/workflows/build.yml</span></pre><p id="f714" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加Node.js工作流:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="af15" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">工作流程受<a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/guides/building-and-testing-nodejs#starting-with-the-nodejs-workflow-template" rel="noopener ugc nofollow" target="_blank">模板</a>的启发。</p><h1 id="0a03" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">工作流程</h1><p id="3dd5" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">下面是每个YAML场的作用分析。</p><h2 id="6eca" class="mp kz in bd la mu mv dn le mw mx dp li kl my mz lm kp na nb lq kt nc nd lu ne bi translated">名字</h2><p id="5768" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#name" rel="noopener ugc nofollow" target="_blank">name</a></code>是工作流名称。这是可选的，您可以随意命名:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h2 id="e401" class="mp kz in bd la mu mv dn le mw mx dp li kl my mz lm kp na nb lq kt nc nd lu ne bi translated">在</h2><p id="4c12" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#on" rel="noopener ugc nofollow" target="_blank">on</a></code>是触发工作流的事件。在我们的例子中，git <code class="fe mb mc md me b">push</code>触发了我们的工作流。</p><p id="c6a0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加<code class="fe mb mc md me b">pull_request</code>事件:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="dd78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这和:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="5268" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">工作</h1><p id="9c1a" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobs" rel="noopener ugc nofollow" target="_blank">jobs</a></code>是工作流运行的作业。在我们的示例中，我们有一个名为<code class="fe mb mc md me b">build</code>的作业:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="9a11" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">连续运行</h1><p id="8700" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idruns-on" rel="noopener ugc nofollow" target="_blank">runs-on</a></code>是工作流运行的环境。要指定操作系统版本:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="fbff" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">战略矩阵</h1><p id="3949" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix" rel="noopener ugc nofollow" target="_blank">strategy.matrix</a></code>是构建矩阵。在我们的示例中，我们正在为单节点版本运行一个作业。要为多个节点版本运行作业，请执行以下操作:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="0530" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步伐</h1><p id="c4f0" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">是一项工作的任务。在我们的例子中，我们使用GitHub动作:</p><ul class=""><li id="4386" class="nf ng in kc b kd ke kh ki kl nh kp ni kt nj kx nk nl nm nn bi translated"><a class="ae jz" href="https://github.com/marketplace/actions/checkout" rel="noopener ugc nofollow" target="_blank">结账</a></li><li id="f70c" class="nf ng in kc b kd no kh np kl nq kp nr kt ns kx nk nl nm nn bi translated"><a class="ae jz" href="https://github.com/marketplace/actions/setup-node-js-environment" rel="noopener ugc nofollow" target="_blank">设置Node.js环境</a></li><li id="bfaa" class="nf ng in kc b kd no kh np kl nq kp nr kt ns kx nk nl nm nn bi translated"><a class="ae jz" href="https://github.com/marketplace/actions/coveralls-github-action" rel="noopener ugc nofollow" target="_blank">连体工作服GitHub动作</a></li></ul><p id="22b8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mb mc md me b">actions/checkout</code>签出存储库，<code class="fe mb mc md me b">actions/setup-node</code>设置节点环境:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="91fc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mb mc md me b">coverallsapp/github-action</code>发送覆盖报告给<a class="ae jz" href="https://coveralls.io/" rel="noopener ugc nofollow" target="_blank">工作服</a>:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="0173" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤.运行</h1><p id="7d72" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsrun" rel="noopener ugc nofollow" target="_blank">steps.run</a></code>运行命令。这些命令可以是来自<code class="fe mb mc md me b">package.json</code>的<a class="ae jz" href="https://docs.npmjs.com/cli/v6/commands/npm-run-script/" rel="noopener ugc nofollow" target="_blank"> npm脚本</a>或其他bash命令:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f82d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mb mc md me b">actions/setup-node@v2</code>安装<code class="fe mb mc md me b">npm</code>、<code class="fe mb mc md me b">npx</code>和<code class="fe mb mc md me b">yarn</code>。<code class="fe mb mc md me b">--if-present</code>选项仅在脚本存在时运行脚本。</p><h1 id="01aa" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">包封/包围（动词envelop的简写）</h1><p id="02ba" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idenv" rel="noopener ugc nofollow" target="_blank">env</a></code>为整个工作流程或单个步骤设置环境变量。参见<code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#env" rel="noopener ugc nofollow" target="_blank">env</a></code>和<code class="fe mb mc md me b"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsenv" rel="noopener ugc nofollow" target="_blank">jobs.&lt;job_id&gt;.steps.env</a></code>。</p><p id="9ec9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然<a class="ae jz" href="https://docs.travis-ci.com/user/environment-variables/#default-environment-variables" rel="noopener ugc nofollow" target="_blank"> Travis CI设置了默认的环境变量</a>，但是我们不需要为我们的工作设置<code class="fe mb mc md me b">CI=true</code>，因为<code class="fe mb mc md me b">actions/checkout@v2</code>已经为我们做了:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="3eb9" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">资源</h1><ul class=""><li id="7477" class="nf ng in kc b kd lw kh lx kl nt kp nu kt nv kx nk nl nm nn bi translated"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/migrating-from-travis-ci-to-github-actions" rel="noopener ugc nofollow" target="_blank">从Travis CI迁移到GitHub动作</a></li><li id="1346" class="nf ng in kc b kd no kh np kl nq kp nr kt ns kx nk nl nm nn bi translated"><a class="ae jz" href="https://docs.github.com/en/free-pro-team@latest/actions/guides/building-and-testing-nodejs" rel="noopener ugc nofollow" target="_blank">构建并测试Node.js </a></li></ul></div><div class="ab cl nw nx hr ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ig ih ii ij ik"><p id="b4fe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://b.remarkabl.org/3mOZa7B" rel="noopener ugc nofollow" target="_blank"> <em class="od">本文原载于2020年12月11日《remarkablemark.org》。</em>T11】</a></p></div></div>    
</body>
</html>