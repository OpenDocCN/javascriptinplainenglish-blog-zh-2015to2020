<html>
<head>
<title>Maintainable JavaScript — Handling Errors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可维护的JavaScript —处理错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/maintainable-javascript-handling-errors-752a1f943d2d?source=collection_archive---------11-----------------------#2020-09-30">https://javascript.plainenglish.io/maintainable-javascript-handling-errors-752a1f943d2d?source=collection_archive---------11-----------------------#2020-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8a08188446ac0f5170cd5380c92d65a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*70E9qge-KjdL1PMC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jackson_893?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Michael Geiger</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="df88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果想继续使用代码，创建可维护的JavaScript代码很重要。</p><p id="9221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过查看处理错误的方法来了解创建可维护的JavaScript代码的基础。</p><h1 id="e518" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">投掷失误的优势</h1><p id="c73c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">抛出我们自己的错误允许我们提供浏览器显示的准确文本。</p><p id="c09a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了行号和列号之外，我们还可以包含任何我们喜欢的信息。</p><p id="7944" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">提供的信息越多，我们就越容易找到问题。</p><p id="b54c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b79b" class="mn lc iq mj b gy mo mp l mq mr">function getDivs(element) {<br/>  if (element &amp;&amp; element.getElementsByTagName) {<br/>    return element.getElementsByTagName("div");<br/>  } else {<br/>    throw new Error("divs not found");<br/>  }<br/>}</span></pre><p id="9235" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果在元素中没有发现div，我们就会抛出一个错误。</p><p id="9bdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">知道了这一点，问题就更容易发现了。</p><h1 id="c68d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">何时抛出错误</h1><p id="9a86" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">到处抛出错误是不切实际的，会降低我们应用程序的性能。</p><p id="3ccf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f14c" class="mn lc iq mj b gy mo mp l mq mr">function addClass(element, className) {<br/>  if (!element || typeof element.className !== "string") {<br/>    throw new Error("element class name must be a string");<br/>  }<br/>  if (typeof className !== "string") {<br/>    throw new Error("class name must be a string");<br/>  }<br/>  element.className += ` ${className}`;<br/>}</span></pre><p id="e307" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么大部分功能都被错误抛出代码占用了。</p><p id="f745" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这在JavaScript中是多余的。</p><p id="7a4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该只为最有可能抛出错误的代码抛出错误。</p><p id="cef3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们不需要为<code class="fe ms mt mu mj b">className</code>参数抛出错误。</p><p id="5959" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8ab3" class="mn lc iq mj b gy mo mp l mq mr">function addClass(element, className) {<br/>  if (!element || typeof element.className !== "string") {<br/>    throw new Error("element class name must be a string");<br/>  }<br/>  element.className += ` ${className}`;<br/>}</span></pre><p id="e90a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">element.className</code>很可能不是一个字符串，所以我们检查它。</p><p id="6aa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已知实体不需要错误检查。</p><p id="48ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们不能提前确定函数将被调用的位置，那么在出现意外情况时抛出错误是一个好主意。</p><p id="ac7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于已知的错误情况，JavaScript库应该从它们的公共接口抛出错误。</p><p id="bb91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，如果程序员使用不当，他们可以知道问题出在哪里。</p><p id="5256" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用堆栈应该在库的接口中终止。</p><p id="90f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也适用于私人图书馆。</p><p id="7402" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们修复了难以调试的错误，我们应该抛出一些让我们更容易识别问题的错误。</p><p id="d267" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们正在编写代码，如果它做了一些意想不到的事情，可能会把事情弄糟，那么我们应该检查这些条件并抛出错误。</p><p id="9b98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果代码将被我们不认识的人使用，那么代码的公共接口应该为意料之外的事情抛出错误。</p><h1 id="6802" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">try-catch语句</h1><p id="5f34" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript为我们提供了try-catch语句，让我们在浏览器处理抛出的错误之前拦截它们。</p><p id="23b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可能导致错误的代码在try块中，错误处理代码在catch块中。</p><p id="ff19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c158" class="mn lc iq mj b gy mo mp l mq mr">try {<br/>  errorFunc();<br/>} catch (ex) {<br/>  handleError(ex);<br/>}</span></pre><p id="2053" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以在<code class="fe ms mt mu mj b">catch</code>块下面添加一个<code class="fe ms mt mu mj b">finally</code>子句。</p><p id="85cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">finally</code>块中的代码不管是否发生错误都会运行。</p><p id="8998" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7cfa" class="mn lc iq mj b gy mo mp l mq mr">try {<br/>  errorFunc();<br/>} catch (ex) {<br/>  handleError(ex);<br/>} finally {<br/>  cleanUp();<br/>}</span></pre><p id="3135" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">finally</code>条款可能很棘手。</p><p id="8840" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe ms mt mu mj b">try</code>子句有一个<code class="fe ms mt mu mj b">return</code>语句，那么在<code class="fe ms mt mu mj b">finally</code>运行之前它不会返回。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/e3a2f4203fc2eed66b52cc36f7ebe545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DH3hifbC2_DpCkzd"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@hhh13?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">傅甬 华</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="226b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d351" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该只在接口级别抛出错误，并且是针对最经常发生的错误。</p><p id="3f2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用<code class="fe ms mt mu mj b">try-catch-finally</code>子句来处理错误。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/787be6c671be8d345dc786dad8729ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-sOyyG8NoRbKpCG_y4Cmw@2x.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank">Subscribe to Decoded, our official YouTube channel!</a></figcaption></figure></div></div>    
</body>
</html>