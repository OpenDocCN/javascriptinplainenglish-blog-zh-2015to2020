<html>
<head>
<title>How to create URL Shortener in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Node.js中创建网址缩写</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-url-shortener-in-node-js-568027027b91?source=collection_archive---------10-----------------------#2020-09-13">https://javascript.plainenglish.io/how-to-create-url-shortener-in-node-js-568027027b91?source=collection_archive---------10-----------------------#2020-09-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/7dd0d6f78806393cea5c0caa70794dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T5dI492m4Ip73_kD.png"/></div></div></figure><div class=""/><p id="8af6" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将在Node.js中创建一个最小的URL Shortener。</p><p id="1303" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们现在开始工作吧！</p><p id="eb38" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们启动终端并编写以下命令:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="8116" class="lc ld iy ky b gy le lf l lg lh">npm init -y</span></pre><p id="c98c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们安装一些我们需要的软件包。为此，启动终端并编写以下命令:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="a7ea" class="lc ld iy ky b gy le lf l lg lh">npm i dotenv express mongoose shortid validator</span></pre><p id="1a6a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用这个命令，我们已经安装了<code class="fe li lj lk ky b">dotenv</code>、<code class="fe li lj lk ky b">express</code>、<code class="fe li lj lk ky b">mongoose</code>、<code class="fe li lj lk ky b">shortid</code>、<code class="fe li lj lk ky b">validator</code>。<code class="fe li lj lk ky b">dotenv</code>包帮助我们访问<strong class="jx iz">。env </strong>文件。我们将使用<code class="fe li lj lk ky b">shortid</code>包为我们的URL生成一个短id。安装完成后，我们的文件夹结构应该如下所示:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/5fa8cb1d4a7ce9c22918838f888395b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*hN0vxBymwtVICoH5Xe-tgA.png"/></div></figure><p id="dd24" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们创建一个名为<strong class="jx iz">的文件。env </strong>在我们的主项目目录中。让我们打开文件<strong class="jx iz">。env </strong>并编写以下内容:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="ecf2" class="lc ld iy ky b gy le lf l lg lh">MONGO_URI=   // Enter mongo URI here</span></pre><p id="a3f3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您需要按照上面注释中的说明将值输入到<code class="fe li lj lk ky b">MONGO_URI</code>。<code class="fe li lj lk ky b">MONGO_URI</code>应该包含您的Mongo DB数据库的URL。</p><p id="c80b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们在主项目目录中创建一个名为<strong class="jx iz"> index.js </strong>的文件。这应该使我们的文件夹结构看起来像这样:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/0c18523e1dd674dbd06accc5a62bbd1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*dpJJq8AvcbmlXZs3mNIGng.png"/></div></figure><p id="1015" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们打开文件<strong class="jx iz"> index.js </strong>并编写以下代码行:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="2986" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第1行，我们导入了<code class="fe li lj lk ky b">express</code>；在第2行，我们导入了<code class="fe li lj lk ky b">mongoose</code>。然后，在第4行，我们导入并配置了<code class="fe li lj lk ky b">dotenv</code>。在第5行，我们导入了<code class="fe li lj lk ky b">route</code>。</p><p id="c08c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第7行，我们创建了一个存储<code class="fe li lj lk ky b">express()</code>的<code class="fe li lj lk ky b">app</code>常量。</p><p id="c06b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第9行，我们使用了<code class="fe li lj lk ky b">express.json()</code>中间件。这个<code class="fe li lj lk ky b">express.json()</code>中间件帮助我们读取从客户端接收的JSON数据。</p><p id="ac80" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第11行，我们使用了<code class="fe li lj lk ky b">route</code>中间件。</p><p id="a21b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第13行，我们为<code class="fe li lj lk ky b">PORT</code>创建了一个常量。</p><p id="3ef1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从第15行到第21行，我们使用<code class="fe li lj lk ky b">mongoose.connect()</code>连接到MongoDB数据库。我们提供了MongoDB数据库作为<code class="fe li lj lk ky b">connect()</code>的第一个参数。如果在连接过程中出现任何错误，我们将记录该错误(在第21行)。</p><p id="a794" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第23行，我们在<code class="fe li lj lk ky b">PORT</code>启动了我们的服务器。</p><p id="07b5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然我们已经完成了我们的<strong class="jx iz"> index.js </strong>文件，现在让我们开始工作我们的路线。为此，让我们在主项目目录中创建一个名为<em class="lp"> routes </em>的目录。让我们在我们的<em class="lp"> routes </em>目录中创建一个名为<strong class="jx iz"> ShortenerRoute.js </strong>的文件。在这之后，我们的文件夹结构看起来像这样:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/67519eb1ef024c30515fb0ea45f645bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:452/format:webp/1*8FcwVh8lRs4QoZk7go2h1A.png"/></div></figure><p id="83fc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们打开文件<strong class="jx iz"> ShortenerRoute.js </strong>并编写以下代码行:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="385c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第1行，我们导入了<code class="fe li lj lk ky b">express</code>。在第3行，我们导入了<code class="fe li lj lk ky b">Redirect</code>和<code class="fe li lj lk ky b">AddUrl</code>控制器。</p><p id="05af" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第5行，我们创建了存储<code class="fe li lj lk ky b">express.Router()</code>的<code class="fe li lj lk ky b">router</code>常量。</p><p id="f851" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第8行，我们为GET请求创建了<em class="lp"> /:shortId </em>的路由，并为该路由提供了<code class="fe li lj lk ky b">Redirect</code>控制器。</p><p id="6438" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第11行，我们用POST请求创建了路由，并提供了<code class="fe li lj lk ky b">AddUrl</code>控制器。</p><p id="6b3c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，在第13行，我们导出了<code class="fe li lj lk ky b">router</code>。</p><p id="6de1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，让我们研究控制器。为此，让我们在主项目目录中创建一个名为<em class="lp">控制器</em>的目录。之后，在<em class="lp">控制器</em>目录下创建一个名为<strong class="jx iz"> ShortenerController.js </strong>的文件。这应该使我们的文件夹结构看起来像这样:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/5bd8c72c39934e4fb13d2c2e357d8e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*4p10TdcIQe09xM70sy1Tnw.png"/></div></figure><p id="4ef2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们打开文件<strong class="jx iz"> ShortenerController.js </strong>并编写以下代码行:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="c465" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第1 &amp; 3行，我们分别导入了<code class="fe li lj lk ky b">validator</code>和<code class="fe li lj lk ky b">Url</code>。<code class="fe li lj lk ky b">Url</code>是一个模型，我们很快就会开发它。</p><p id="7e4a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第5行，我们创建了一个名为<code class="fe li lj lk ky b">Redirect</code>的箭头函数，并在第48行将其导出。这个<code class="fe li lj lk ky b">Redirect</code>控制器的目的是根据提供的<code class="fe li lj lk ky b">shortId</code>将用户重定向到URL。在第6行，我们使用对象析构从<code class="fe li lj lk ky b">req.params</code>中提取了<code class="fe li lj lk ky b">shortId</code>。如果<code class="fe li lj lk ky b">shortId</code>不存在，我们在第8行提供一个id未提供的错误消息。在<code class="fe li lj lk ky b">shortId</code>的帮助下，我们在第11行查询了<code class="fe li lj lk ky b">Url</code>模型，并将其存储在<code class="fe li lj lk ky b">URL</code>常量中。如果<code class="fe li lj lk ky b">URL</code>存在，我们将用户重定向到第13行的路线<code class="fe li lj lk ky b">URL.url</code>。<code class="fe li lj lk ky b">url</code>是<code class="fe li lj lk ky b">Url</code>模型中的一个字段，存储网站的URI。我们在<code class="fe li lj lk ky b">Url</code>模型中也有<code class="fe li lj lk ky b">shortId</code>字段，用于存储<code class="fe li lj lk ky b">shortId</code>。过一会儿我们在做的时候，你就会知道我们的模型是什么样子的了。如果<code class="fe li lj lk ky b">URL</code>不存在，我们在第12行返回一个错误消息。如果在这个过程中出现任何错误，我们在第15行记录这个错误。然后，我们在第16行发送错误消息。</p><p id="d610" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第20行，我们创建了一个名为<code class="fe li lj lk ky b">AddUrl</code>的箭头函数，并在第49行将其导出。这个函数的目的是向数据库添加一个新的URL，并向用户提供唯一的id。在第21行，我们从<code class="fe li lj lk ky b">req.body</code>中提取了<code class="fe li lj lk ky b">url</code>。如果<code class="fe li lj lk ky b">url</code>不存在，我们在第23行提供一个错误消息。然后，在第25到30行，我们使用<code class="fe li lj lk ky b">validator</code>对<code class="fe li lj lk ky b">url</code>进行了验证。<code class="fe li lj lk ky b">validator</code>的<code class="fe li lj lk ky b">isUrl</code>方法接受一个要验证的字符串作为第一个参数，在我们的例子中是<code class="fe li lj lk ky b">url</code>。第二个参数接受options对象。这里，我们在第27行设置了<code class="fe li lj lk ky b">require_protocol</code>到<code class="fe li lj lk ky b">true</code>。如果验证不匹配，我们在第30行向用户发送一条错误消息。在第33行，我们用<code class="fe li lj lk ky b">url</code>查询了<code class="fe li lj lk ky b">Url</code>模型，并将其存储在<code class="fe li lj lk ky b">URL</code>常量中。如果<code class="fe li lj lk ky b">URL</code>存在，我们在第40行从<code class="fe li lj lk ky b">URL.shortId</code>和<code class="fe li lj lk ky b">url</code>本身向用户发送相同的<code class="fe li lj lk ky b">shortId</code>。如果<code class="fe li lj lk ky b">URL</code>不存在，我们在第35行从<code class="fe li lj lk ky b">Url</code>模型创建一个<code class="fe li lj lk ky b">newUrl</code>。然后，我们保存第36行的<code class="fe li lj lk ky b">newUrl</code>。之后，我们在第37行将<code class="fe li lj lk ky b">shortId</code>和<code class="fe li lj lk ky b">url</code>发送给用户。请注意，我们在创建<code class="fe li lj lk ky b">newUrl</code>时没有提供<code class="fe li lj lk ky b">shortId</code>，但我们已经收到了。那是因为我们的<code class="fe li lj lk ky b">Url</code>模型为我们完成了生成<code class="fe li lj lk ky b">shortId</code>的任务。如果在这个过程中出现任何错误，我们在第42行记录这个错误。然后，在第43行，我们向用户发送错误消息。</p><p id="4b4b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然我们已经完成了控制器的工作，现在让我们来研究一下我们的<code class="fe li lj lk ky b">Url</code>模型。为此，让我们在主项目目录中创建一个名为<em class="lp"> model </em>的目录。在目录内部，创建一个名为<strong class="jx iz"> url.js </strong>的文件。这应该使我们的文件夹结构看起来像这样:</p><figure class="kt ku kv kw gt ip gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/5e343cede1a491da85223470ef222d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*e70uZqVhqj0nO-vfYguxiA.png"/></div></figure><p id="0458" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们打开文件<strong class="jx iz"> url.js </strong>并编写以下代码行:</p><figure class="kt ku kv kw gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="4d86" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们看看上面的代码。在第1行，我们导入了<code class="fe li lj lk ky b">mongoose</code>。在第2行，我们导入了<code class="fe li lj lk ky b">shortid</code>。</p><p id="a810" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从第4行到第7行，我们创建了一个新的模式，并将其存储在<code class="fe li lj lk ky b">UrlSchema</code>常量中。<code class="fe li lj lk ky b">UrlSchema</code>有两个字段:<code class="fe li lj lk ky b">url</code>、<code class="fe li lj lk ky b">shortId</code>。<code class="fe li lj lk ky b">url</code>字段存储字符串，是必填字段。<code class="fe li lj lk ky b">shortId</code>字段存储字符串，也是必填字段。我们已经为<code class="fe li lj lk ky b">shortId</code>字段设置了默认值<code class="fe li lj lk ky b">shortid.generate()</code>。该方法生成一个id，存储在<code class="fe li lj lk ky b">shortId</code>字段中。然后，我们终于在第9行导出了<code class="fe li lj lk ky b">”url”</code>模型。</p><p id="f518" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们来试试这个应用程序。尝试使用Postman向路由<em class="lp"> localhost:3000/ </em>发出post请求，其中<code class="fe li lj lk ky b">url</code>字段包含有效的URL。你应该会从它那里收到一个<code class="fe li lj lk ky b">shortId</code>。然后，打开浏览器，输入网址<em class="lp">localhost:3000/:short id</em>。这里的<code class="fe li lj lk ky b">:shortId</code>应该是你向路由<em class="lp"> localhost:3000/ </em>发出post请求时收到的shortId。这应该会将您重定向到链接到<code class="fe li lj lk ky b">shortId</code>的页面。</p><p id="a9d5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这意味着我们已经创建了一个网址缩写！</p><h2 id="e66b" class="lc ld iy bd lt lu lv dn lw lx ly dp lz kg ma mb mc kk md me mf ko mg mh mi mj bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="4160" class="pw-post-body-paragraph jv jw iy jx b jy mk ka kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae mp" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="jx iz">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="jx iz">！</strong></p></div></div>    
</body>
</html>