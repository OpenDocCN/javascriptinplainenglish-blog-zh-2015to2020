<html>
<head>
<title>Dynamic Imports in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的动态导入</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/discuss-native-support-for-on-the-fly-import-of-modules-in-es-2020-also-called-es-11-ad4f899e0c2?source=collection_archive---------5-----------------------#2020-05-06">https://javascript.plainenglish.io/discuss-native-support-for-on-the-fly-import-of-modules-in-es-2020-also-called-es-11-ad4f899e0c2?source=collection_archive---------5-----------------------#2020-05-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4643" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">ES 2020/ES 11新功能综述</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c00abaa1efd86496099d9ca79a585eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibQ7bd0wnGLXY3jMlhpgYA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://500px.com/vencki-vista" rel="noopener ugc nofollow" target="_blank">Image — vencki-vista</a></figcaption></figure><p id="5081" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">过去，RequireJS是一个流行的库，它用JavaScript提供模块系统。它是AMD(异步模块定义)的一个实现。该库有助于组织代码和托管依赖项。它允许定义和导入模块(根据需要，预先或有条件地)。随着JavaScript的发展，ES 6(也称为ES 2015)为该语言增加了对模块的本地支持。最初，只支持静态导入，这需要在运行前进行评估。</p><p id="5143" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们中的许多人都使用过ES 6导入语句，这些语句放在文件的顶部。所有的导入都需要在运行前进行评估，这意味着模块名不能是动态的。需要指定完整的模块名称字符串——没有变量插值。它帮助了一些特性，比如JavaScript绑定，树抖动等等。但是，不能动态导入模块。比方说，我们想只在点击一个按钮时导入一个模块，当我们启动一个模型对话框，导航到一个页面时，这些场景最初是不支持的。</p><p id="51af" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有人提议支持动态导入。这是一个类似语法的功能，可以动态导入新模块。动态进口的TC 39提案现在处于第4阶段。在本文的后面，有一节详细介绍了TC 39提案和四个阶段。</p><p id="a988" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">动态导入已准备好在ES 2020 (ES 11)黄金时间推出。已被各大浏览器改编。Mozilla Web Docs上的浏览器兼容性图表见图1。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lp"><img src="../Images/5d9826cb30c2eae09608d5df18ab0510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfrTBMiKJY8fdIcqlqSIvQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Figure-1: Browser Compatibility- <a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" rel="noopener ugc nofollow" target="_blank">link to the documentation</a></figcaption></figure><h2 id="f60c" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">在待办事项代码示例中使用import()</h2><p id="e44c" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">让我们借助一个用例来看看这个特性。我们将使用JavaScript在待办事项应用程序中构建几个屏幕。第一个屏幕显示待办事项列表。第二个屏幕有一个文本字段和一个创建新待办事项的按钮。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mo"><img src="../Images/8dd502c2165fa728e3e5498fe65262e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V6KXv6SZw6g1On6XXJ6RTQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Figure-2: To-do sample screens</figcaption></figure><p id="697f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们使用三个模块。</p><ul class=""><li id="eee4" class="mp mq in kv b kw kx kz la lc mr lg ms lk mt lo mu mv mw mx bi translated">第一个模块data-module.js提供了待办事项列表。为简单起见，示例使用硬编码的JSON数组。</li><li id="c006" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated">第二个模块todo-list-module.js导出一个函数getTodosMarkup()。该函数的输入参数是待办事项列表数据。它返回用数据创建的DOM字符串。考虑下面的代码片段，它导入了index.js中的两个模块。</li></ul><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="65c2" class="lq lr in ne b gy ni nj l nk nl">import getData from './data-module.js';<br/>import { getTodosMarkup } from './todo-list-module.js';</span><span id="bc09" class="lq lr in ne b gy nm nj l nk nl">let list = getData();<br/>document.getElementById("todos").innerHTML = getTodosMarkup(list.todos);</span></pre><ul class=""><li id="a635" class="mp mq in kv b kw kx kz la lc mr lg ms lk mt lo mu mv mw mx bi translated">如果用户仅使用列表屏幕，则不会导入其他模块。但是，如果用户试图导航到<em class="nn">创建待办事项</em>功能，第三个模块会被动态导入。考虑下面的代码片段和图3。注意，只有当用户导航到创建待办事项屏幕时，create-todo.js才会出现在Google Chrome网络标签中。</li></ul><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="d5bf" class="lq lr in ne b gy ni nj l nk nl">const handler = () =&gt; {<br/>  import ('./create-todo.js').then((module) =&gt; { <br/>   // access any exported function in the module.<br/>   // following createTodo() generates DOM string for Create Todo <br/>   // set the DOM string on an element. <br/>   document.getElementById("createTodo").innerHTML = module.createTodo();<br/>});<br/>}</span><span id="e9d5" class="lq lr in ne b gy nm nj l nk nl">// click event handler added on the hyperlink, “Create Todos”.<br/>document<br/>.getElementById("btnCreateTodo")<br/>.addEventListener("click", handler);</span></pre><p id="9edd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">handler()函数执行动态导入。注意，import()以模块名作为参数。该函数返回一个承诺，解析后提供一个模块引用。在模块对象上，可以访问所有导出的函数。在上面的代码示例中，我们使用createTodo()函数(从模块中导出)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/6788251254eabee15b597d437601e1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLqnVWEgB--4mRpGmBjSmw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Figure-3: Script loads only after navigating to Create to-do screen</figcaption></figure><h2 id="207b" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">代码示例</h2><p id="f9b1" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">跟随<a class="ae ks" href="https://github.com/kvkirthy/todo-samples/tree/master/js-modules-demo" rel="noopener ugc nofollow" target="_blank">链接</a>获取完整的代码示例。参见JavaScript模块<a class="ae ks" href="https://github.com/kvkirthy/todo-samples/blob/master/js-modules-demo/JS/data-module.js" rel="noopener ugc nofollow" target="_blank"> data-module.js </a>、<a class="ae ks" href="https://github.com/kvkirthy/todo-samples/blob/master/js-modules-demo/JS/todo-list-module.js" rel="noopener ugc nofollow" target="_blank"> todo-list-module.js </a>和<a class="ae ks" href="https://github.com/kvkirthy/todo-samples/blob/master/js-modules-demo/JS/create-todo.js" rel="noopener ugc nofollow" target="_blank"> create-todo.js </a>。<a class="ae ks" href="https://github.com/kvkirthy/todo-samples/blob/master/js-modules-demo/JS/index.js" rel="noopener ugc nofollow" target="_blank"> Index.js </a>是导入其他模块的主模块。</p><p id="2feb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要在您的机器上运行代码示例，请遵循这里的说明<a class="ae ks" href="https://github.com/kvkirthy/todo-samples/tree/master/js-modules-demo" rel="noopener ugc nofollow" target="_blank"/>。</p><blockquote class="np nq nr"><p id="1df0" class="kt ku nn kv b kw kx jo ky kz la jr lb ns ld le lf nt lh li lj nu ll lm ln lo ig bi translated">使用promise时，请注意async/await的以下替代语法。我们可以对任何JavaScript承诺使用async/await方法，不必是模块的动态导入。这是ES 8 (ES 2017)的一个特点。点击阅读更多关于<a class="ae ks" href="https://www.dotnetcurry.com/javascript/1405/es8-es2017-javascript-new-features" rel="noopener ugc nofollow" target="_blank"> ES 8特性的信息。</a></p></blockquote><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="d934" class="lq lr in ne b gy ni nj l nk nl">const asyncHandler = <strong class="ne io"><em class="nn">async</em></strong>() =&gt; {</span><span id="6101" class="lq lr in ne b gy nm nj l nk nl"> if (isList) {<br/>   isList = false;<br/>   let module = <strong class="ne io"><em class="nn">await</em></strong> import ('./create-todo.js')<br/>   document.getElementById("createTodo").innerHTML =  <br/><strong class="ne io">     module.createTodo();</strong></span><span id="c0ed" class="lq lr in ne b gy nm nj l nk nl">};</span></pre><p id="0f7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">import()函数还支持模块名的运行时字符串插值。考虑下面的代码片段。模块名可以根据变量名动态定义。这不适用于静态导入。</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="5a6d" class="lq lr in ne b gy ni nj l nk nl">/* The module name is unavailable pre-runtime as it's created on the fly with using CREATE_TODO_URL */</span><span id="0fe9" class="lq lr in ne b gy nm nj l nk nl">import (`./${CREATE_TODO_URL}.js`)</span></pre><p id="c3f1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">动态导入的TC 39提案已经存在一段时间了。根据TC 39 GitHub知识库中的提交，它将从2016年开始提供。(<a class="ae ks" href="https://github.com/tc39/proposal-dynamic-import/commits/master?before=43e869ce8bb38d95f6b082dbc4c49d3f0fa1bdf2+35" rel="noopener ugc nofollow" target="_blank">链接到提案</a>)。Chrome从63版开始就一直支持该功能。然而，作为《ECMA脚本2020》的一部分，该提案正处于第4阶段(ES 11)。</p><h2 id="e3f5" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">笔记</h2><blockquote class="np nq nr"><p id="4d24" class="kt ku nn kv b kw kx jo ky kz la jr lb ns ld le lf nt lh li lj nu ll lm ln lo ig bi translated">为浏览器使用带有type属性的<script>元素，将JavaScript视为一个模块。&lt;/root&gt;</script></p></blockquote><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="5f16" class="lq lr in ne b gy ni nj l nk nl">&lt;script <strong class="ne io">type="module" </strong>src="./JS/index.js"&gt;&lt;/script&gt;</span></pre><blockquote class="np nq nr"><p id="a8a4" class="kt ku nn kv b kw kx jo ky kz la jr lb ns ld le lf nt lh li lj nu ll lm ln lo ig bi translated">Common JS是Node.js和服务器端JavaScript开发中模块系统的流行选择。对于JavaScript中的本机模块系统支持，Node.js建议用。mjs扩展名(而不是。js)。</p></blockquote><h2 id="eb2e" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">JavaScript是如何增加新特性的？</h2><p id="866a" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">对于许多其他语言，只需要升级一个运行时或一个编译器来支持新特性。JavaScript是独一无二的；功能需要通过各种浏览器来实现。它们由不同组织拥有的不同团队构建和维护。每个人都必须走到一起，不断升级语言。</p><p id="42fa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ECMA脚本(简称ES)是为标准化JavaScript而创建的语言规范。ES5是2009年发布的流行JavaScript版本。ES 6于2015年发布。也被称为ES 2015。从ES 6开始，每年都会进行一次升级。如前所述，本文描述的动态导入特性是ES 2020或ES 11的一部分。</p><p id="96f2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ECMA TC39是一个负责发展ECMA文字的委员会。TC 39使用以下阶段定义将JavaScript特性转移到ECMA脚本版本之一。每一个新的JavaScript提案都要经过几个阶段才能在所有浏览器上可用。</p><ul class=""><li id="9605" class="mp mq in kv b kw kx kz la lc mr lg ms lk mt lo mu mv mw mx bi translated">阶段0——straw person或一个新的规范(被称为strawman，现在改名了——正确的名称:)</li><li id="3c1c" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated">第一阶段—提案。用正式的规范语言展示对附加产品、解决方案和挑战的需求。</li><li id="b172" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated">第二阶段—草稿。描述语法和语义。</li><li id="1292" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated">第三阶段—候选人。允许用户进行实验并提供反馈。规范可能会根据反馈重新定义。大多数浏览器在这个阶段就开始调整功能。功能可能还没有准备好黄金时间。</li><li id="b2db" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated">第四阶段——完成。所有用户都可以使用该功能。</li></ul><p id="f789" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">点击<a class="ae ks" href="https://tc39.es/process-document/" rel="noopener ugc nofollow" target="_blank">链接获取TC 39流程文件</a></p></div><div class="ab cl nv nw hr nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ig ih ii ij ik"><h2 id="17cd" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated"><strong class="ak">简明英语团队的笔记</strong></h2><p id="d28a" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">你知道我们有四种出版物吗？给他们一个关注来表达爱意:<a class="ae ks" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="kv io">JavaScript in Plain English</strong></a><a class="ae ks" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kv io">AI in Plain English</strong></a><a class="ae ks" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kv io">UX in Plain English</strong></a><a class="ae ks" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kv io">Python in Plain English</strong></a><strong class="kv io"/>——谢谢，继续学习！</p><p id="5570" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，我们总是有兴趣帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae ks" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">submissions @ plain English . io</strong></a><strong class="kv io"/>，并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div><div class="ab cl nv nw hr nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ig ih ii ij ik"><h2 id="3ca0" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">参考</h2><ul class=""><li id="5955" class="mp mq in kv b kw mj kz mk lc oc lg od lk oe lo mu mv mw mx bi translated"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" rel="noopener ugc nofollow" target="_blank">导入MDN web文档</a></li><li id="4448" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated"><a class="ae ks" href="https://tc39.es/process-document/" rel="noopener ugc nofollow" target="_blank"> TC 39工艺文件</a>。</li><li id="263d" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated"><a class="ae ks" href="https://www.dotnetcurry.com/javascript/1405/es8-es2017-javascript-new-features" rel="noopener ugc nofollow" target="_blank">ES 8上的DotNet库里文章</a></li><li id="57d8" class="mp mq in kv b kw my kz mz lc na lg nb lk nc lo mu mv mw mx bi translated"><a class="ae ks" href="https://github.com/tc39/proposal-dynamic-import" rel="noopener ugc nofollow" target="_blank"> TC-39动态提案</a></li></ul><h2 id="5949" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">你能在哪里找到我</h2><p id="5b05" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">推特<a class="ae ks" href="http://twitter.com/keertikotaru" rel="noopener ugc nofollow" target="_blank"> @KeertiKotaru </a>。</p><p id="86a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://www.amazon.com/Angular-Material-Design-TypeScript-Interface/dp/1484254333/ref=sr_1_4?crid=IPQSCYP20TBM&amp;keywords=angular+material&amp;qid=1578619358&amp;sprefix=angular+mater%2Caps%2C139&amp;sr=8-4" rel="noopener ugc nofollow" target="_blank">角材本</a> | <a class="ae ks" href="https://www.amazon.com/Material-Design-Implementation-AngularJS-Component/dp/1484221893/ref=sr_1_10?crid=IPQSCYP20TBM&amp;keywords=angular+material&amp;qid=1578619358&amp;sprefix=angular+mater%2Caps%2C139&amp;sr=8-10" rel="noopener ugc nofollow" target="_blank">角材v1.x </a></p><p id="8888" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="https://www.dotnetcurry.com/author/v-keerti-kotaru" rel="noopener ugc nofollow" target="_blank">https://www.dotnetcurry.com/author/v-keerti-kotaru</a></p><p id="7b35" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><a class="ae ks" href="http://venckicode.blogspot.com/" rel="noopener ugc nofollow" target="_blank">http://venckicode.blogspot.com/</a></p></div></div>    
</body>
</html>