<html>
<head>
<title>[…].forEach(saveFromZombies) does not always save people</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[…].forEach(saveFromZombies)并不总是救人</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/foreach-savefromzombies-does-not-always-save-people-217108c6921d?source=collection_archive---------5-----------------------#2019-10-12">https://javascript.plainenglish.io/foreach-savefromzombies-does-not-always-save-people-217108c6921d?source=collection_archive---------5-----------------------#2019-10-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="63af" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">JavaScript中forEach工作方式的奇怪之处</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c4361ff5b675d7135ef4ab3ebb0e2235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1b132gl04Zqs2HV3Ko7OEg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Walking dead!!</figcaption></figure><h2 id="d070" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">第一次遇到这个问题。</h2><p id="0e45" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我像往常一样编码。我遇到了一个关于<code class="fe mh mi mj mk b">forEach</code>如何工作的奇怪问题。下面的代码给出了一个例子。假设下面的代码是我正在使用的某个库中的代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="909a" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">我在我公司的应用程序中发现了这样的代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="ad58" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">当然，我不想这样。这是违反干燥原则的。所以我将代码重构为:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="b03b" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">更酷更简洁。</p><p id="4a91" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">但是我被骗了，以为这样就可以了。看看这段代码给出了什么:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="677f" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">哎呀。所有人都死了。好的。现在你开始明白为什么了。</p><p id="aa1e" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">是装订的问题。让我们检查一下<code class="fe mh mi mj mk b">this</code>在我们的代码中到底做了什么:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8448" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">嗯，不奇怪。它输出:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="f552" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">好的。所以这篇文章的要点是:</p><blockquote class="ms mt mu"><p id="2b3a" class="lo lp mv lq b lr mn jo lt lu mo jr lw mw mp ly lz mx mq mb mc my mr me mf mg ig bi translated"><strong class="lq io"> <em class="in">只是传入一个函数的引用，使用</em> </strong> <code class="fe mh mi mj mk b"><strong class="lq io"><em class="in">this</em></strong></code> <strong class="lq io"> <em class="in">引用某个地方而不是某个</em> </strong> <code class="fe mh mi mj mk b"><strong class="lq io"><em class="in">globalThis</em></strong></code> <strong class="lq io"> <em class="in">，变成</em> </strong> <code class="fe mh mi mj mk b"><strong class="lq io"><em class="in">forEach</em></strong></code> <strong class="lq io"> <em class="in">可能会导致javascript错误，因为</em> </strong> <code class="fe mh mi mj mk b"><strong class="lq io"><em class="in">this</em></strong></code> <strong class="lq io"> <em class="in">会指向一个全局</em> </strong> <code class="fe mh mi mj mk b"><strong class="lq io"><em class="in">this</em></strong></code> <strong class="lq io"> <em class="in">。</em> </strong></p></blockquote><p id="874d" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">那我们该怎么办？这里有一些事情让你知道:</p><h1 id="fb93" class="mz kt in bd ku na nb nc kx nd ne nf la jt ng ju le jw nh jx li jz ni ka lm nj bi translated">1.显式调用该函数</h1><p id="fe40" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">是的，这个管用。这会救一些人的命。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="022f" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">普通<code class="fe mh mi mj mk b">function</code>也一样:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="2c54" class="mz kt in bd ku na nb nc kx nd ne nf la jt ng ju le jw nh jx li jz ni ka lm nj bi translated">2.<a class="ae nk" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Syntax" rel="noopener ugc nofollow" target="_blank">传</a> <code class="fe mh mi mj mk b"><a class="ae nk" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Syntax" rel="noopener ugc nofollow" target="_blank">thisArg</a></code> <a class="ae nk" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Syntax" rel="noopener ugc nofollow" target="_blank">作引数</a></h1><p id="3da9" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">这些是<code class="fe mh mi mj mk b">forEach</code>的参数:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="2418" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">你可以在<code class="fe mh mi mj mk b">saveFromZombies</code>里面放入被指向的对象<code class="fe mh mi mj mk b">this</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="a5be" class="mz kt in bd ku na nb nc kx nd ne nf la jt ng ju le jw nh jx li jz ni ka lm nj bi translated">3.使用绑定</h1><p id="7e8a" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">这是一个显式绑定。您告诉javascript引擎，您希望将<code class="fe mh mi mj mk b">saveFromZombies</code>绑定到<code class="fe mh mi mj mk b">walkingDead</code>对象。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="2973" class="mz kt in bd ku na nb nc kx nd ne nf la jt ng ju le jw nh jx li jz ni ka lm nj bi translated">进一步地..</h1><p id="c74d" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">当然，我们可以也应该在处理<code class="fe mh mi mj mk b">map</code>、<code class="fe mh mi mj mk b">filter</code>问题时运用同样的原则，...还有更多。</p><h1 id="b41c" class="mz kt in bd ku na nb nc kx nd ne nf la jt ng ju le jw nh jx li jz ni ka lm nj bi translated">摘要</h1><ul class=""><li id="8b24" class="nl nm in lq b lr ls lu lv lb nn lf no lj np mg nq nr ns nt bi translated">我们已经看到了当我们将一个函数的引用作为对<code class="fe mh mi mj mk b">forEach</code>的回调时<code class="fe mh mi mj mk b">this</code>可能会丢失上下文。</li><li id="c695" class="nl nm in lq b lr nu lu nv lb nw lf nx lj ny mg nq nr ns nt bi translated">解决方案是:(1)显式调用函数，(2)将<code class="fe mh mi mj mk b">thisArg</code>作为参数传递，(3)使用<code class="fe mh mi mj mk b">bind</code>。</li></ul><p id="47db" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated">快乐<code class="fe mh mi mj mk b">forEach</code>编码！</p></div><div class="ab cl nz oa hr ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ig ih ii ij ik"><p id="d794" class="pw-post-body-paragraph lo lp in lq b lr mn jo lt lu mo jr lw lb mp ly lz lf mq mb mc lj mr me mf mg ig bi translated"><a class="ae nk" href="https://9oelm.github.io/2019-10-12--[...].forEach(sayHello)-does-not-always-say-hello/" rel="noopener ugc nofollow" target="_blank"> <em class="mv">最初发表于https://9oelm.github.io/2019-10-12-[...].forEach(say hello)-does-not-always-say-hello/</em>T12】</a></p></div></div>    
</body>
</html>