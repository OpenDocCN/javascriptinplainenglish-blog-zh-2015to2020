<html>
<head>
<title>Using Geolocation to a Locate a User on Google Maps in React-Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React-Redux中使用地理定位在Google Maps上定位用户</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-geolocation-to-a-locate-a-user-on-google-maps-in-react-redux-4dc33a34bf2e?source=collection_archive---------3-----------------------#2020-10-19">https://javascript.plainenglish.io/using-geolocation-to-a-locate-a-user-on-google-maps-in-react-redux-4dc33a34bf2e?source=collection_archive---------3-----------------------#2020-10-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2c97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个博客将教你如何获得用户的大概坐标，并在GoogleMapReact地图上标记出来。</p><h2 id="4df7" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">步骤概述:</h2><ul class=""><li id="68ab" class="lb lc in jm b jn ld jr le jv lf jz lg kd lh kh li lj lk ll bi translated">获取一个<a class="ae lm" href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="noopener ugc nofollow" target="_blank"> Google API密钥</a>。</li><li id="8063" class="lb lc in jm b jn ln jr lo jv lp jz lq kd lr kh li lj lk ll bi translated"><strong class="jm io">获取用户的坐标。</strong>这篇博客将向你展示实现这一目标的两种不同方式。<strong class="jm io"> <em class="ls">选项1是使用内置的</em></strong><a class="ae lm" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ls">Google Chrome地理定位</em> </strong> </a>和<strong class="jm io"> <em class="ls">选项2是利用</em> </strong> <a class="ae lm" href="https://developers.google.com/maps/documentation/geocoding/overview?hl=en_US" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ls"> Google的地理编码API </em> </strong> </a>(针对可能不支持第一种方法的浏览器或选择不通过浏览器处理其位置的用户。)</li><li id="abd5" class="lb lc in jm b jn ln jr lo jv lp jz lq kd lr kh li lj lk ll bi translated">将<a class="ae lm" href="https://developers.google.com/maps/documentation/geocoding/overview?hl=en_US" rel="noopener ugc nofollow" target="_blank">地理编码AP </a> I添加到项目的API列表中。这个API将允许您通过将一个地址或城市&amp;状态(最低限度)转换成近似的纬度&amp;经度坐标来获得用户坐标。</li><li id="6a3b" class="lb lc in jm b jn ln jr lo jv lp jz lq kd lr kh li lj lk ll bi translated">安装<a class="ae lm" href="https://github.com/google-map-react/google-map-react" rel="noopener ugc nofollow" target="_blank">‘谷歌地图反应’</a></li><li id="b90e" class="lb lc in jm b jn ln jr lo jv lp jz lq kd lr kh li lj lk ll bi translated">使用用户的位置标记渲染地图。</li></ul><p id="b4c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本教程将有代码片段和复制粘贴友好的代码位于最后。🔥</p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/e138d508d42fce9996847419da875e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXjblMmNZUevv-HhA6FgHw.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Current Location button will handle browser geolocation (Option 1). Submit Location will handle manual submission (Option 2).</figcaption></figure><h2 id="1ab7" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">选项1。使用Google Chrome地理定位方法:</strong></h2><p id="50a8" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv mq jx jy jz mr kb kc kd ms kf kg kh ig bi translated">您需要知道的第一件事是，位置只能在用户事件后由浏览器收集。这意味着您需要在用户允许浏览器这样做之后触发这个函数。对于这个例子，我们将在一个简单的表单上点击一个按钮。</p><p id="0ee5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“当前位置”按钮有以下事件监听器</p><pre class="mb mc md me gt mt mu mv mw aw mx bi"><span id="f72f" class="ki kj in mu b gy my mz l na nb">onClick={() =&gt; getPosition()}</span></pre><p id="a3eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第一个功能是事件链如下:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nc"><img src="../Images/3da60f61dbfec3df4b20db50b30a8df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gms6anregs6C-kukzhcJ_A.png"/></div></div></figure><p id="cf7f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此函数使用navigator . geolocation . getcurrentposition来处理您的位置。它接受一个成功回调函数、一个错误回调函数和一个选项参数(我选择不使用它)。下面是成功和错误回调。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nd"><img src="../Images/66faf1271e1d99d72e4dde05337f0773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDFrzzUzDkN2alKiIiS18Q.png"/></div></div></figure><p id="2f11" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">函数convertToAddress是可选的，它已包含在下面。该函数将使用google API键将您的经纬度坐标转换为城市、州和邮政编码。它使用Google API密钥和<a class="ae lm" href="https://developers.google.com/maps/documentation/geocoding/overview?hl=en_US" rel="noopener ugc nofollow" target="_blank"> Google地理编码API </a>。对于这个例子，我已经从后端获取了API键。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ne"><img src="../Images/654bca2d2c028cc01ff408ce88ac5791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0goa7zS16zbcRwgw3lh85w.png"/></div></div></figure><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nf"><img src="../Images/edf580cb5f675345dc94a9b8c4dcb416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D4Atl6cjxL5ELEDHHv_gYw.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Browser geolocation combined with Google’s Geocoding API were used to populate the 3 fields above.</figcaption></figure><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/03872c517eadec4913919c926a328e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*F52dERKAcACqnuOs9NSkGg.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">State containing Lat &amp; Long coordinates, City, State, and ZipCode/PostalCode.</figcaption></figure><p id="ced2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此时，你应该可以通过谷歌浏览器访问经纬度坐标。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nh"><img src="../Images/82b97df3ba0168ca295b3b4fb031f0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KBAIk4ahp9YnORE8kLJA6A.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">User elects to “Block” location sharing.</figcaption></figure><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ni"><img src="../Images/5771adee3e5d81b0135a99e23fc7641f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uku1y02Wqt2-mOvRyNCs9Q.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Browser cannot process a location that has not been shared.</figcaption></figure><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nj"><img src="../Images/4d455c52d6c298079e94acd8de890ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TvlFFwi0oJ_M05iSJp8zvg.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Browser does not support geolocation processing.</figcaption></figure><p id="3ab7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果由于用户选择不与浏览器共享他们的位置或者浏览器不支持地理定位处理而导致您无法访问纬度和经度坐标，该怎么办？选项2。</p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="1a00" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated">选项2。使用谷歌的地理编码API:</h2><p id="c229" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv mq jx jy jz mr kb kc kd ms kf kg kh ig bi translated">我们将使用用户在下面的表单中输入的城市和州，将它们转换成表单提交上的经度和纬度坐标。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nk"><img src="../Images/48a2c79268d7f07d2f7ec30f5166252c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAj7weNw0sDDU03zRqS7nw.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">User has entered a location (Postal Code is not necessary)</figcaption></figure><p id="38ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“提交位置”按钮有以下事件监听器</p><pre class="mb mc md me gt mt mu mv mw aw mx bi"><span id="7fcd" class="ki kj in mu b gy my mz l na nb">onClick={() =&gt; processManualLocation()}</span></pre><p id="ba1b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">第一个功能是事件链如下:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nl"><img src="../Images/867f8228b07d6a8fb02fc25389e835ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y09KMr4wwlb51onmIxQSng.png"/></div></div></figure><p id="c718" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该函数使用城市和州的手动条目以及存储在。前端的env文件。您可以在获取url中包含完整的街道地址，Google地理编码响应的位置会更准确。对于这个特定的用例，城市和州就足够了。如果google地理编码API响应状态为“OK”，此函数将调用链中的下一个函数:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nm"><img src="../Images/016d48b70c23b5c4bb16f33c86514a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YlyUnyZo2mCCx05J-XFn-g.png"/></div></div></figure><p id="4045" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在链中的最后一个函数运行之后，您应该可以访问用户的大概纬度和经度坐标。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/a2bd7b19c33371dfa041d791221dda49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*hzOwiX42R7k3GeeKJ-hf5Q.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">State containing Lat &amp; Long coordinates, City, State, and ZipCode/PostalCode.</figcaption></figure><p id="232c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们有了用户坐标，让我们在React-Redux应用程序中将它们映射到Google Maps上。我选择了使用“谷歌地图反应”。</p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="f40e" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">使用用户标记创建“谷歌地图反应”地图:</strong></h2><p id="8f0a" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv mq jx jy jz mr kb kc kd ms kf kg kh ig bi translated">在您安装了<a class="ae lm" href="https://github.com/google-map-react/google-map-react" rel="noopener ugc nofollow" target="_blank">‘Google-map-react’</a>并获得用户坐标后，您将需要编写以下代码(或类似代码):</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi no"><img src="../Images/3096c0d41b2326df13279f0281281182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t13Kklm5HMEyCujqkBHvIg.png"/></div></div></figure><p id="b867" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我没有评论这部分代码，因为理解它所需的知识是基本的React-Redux。</p><p id="1746" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">地图应该是这样的:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi np"><img src="../Images/2d74e413799a0bf73ed2c6a93814bbbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0boGazABlhoe9YfXU3YTnQ.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Google Maps with a User Marker in my React-Redux app.</figcaption></figure><p id="f9ff" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望你喜欢这个教程。如果有任何问题，请告诉我！</p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><h2 id="b1df" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">复制粘贴友好的代码和注释:</strong></h2><p id="757a" class="pw-post-body-paragraph jk jl in jm b jn ld jp jq jr le jt ju jv mq jx jy jz mr kb kc kd ms kf kg kh ig bi translated"><strong class="jm io">从Google Chrome地理位置获取纬度/经度、城市、州和邮政编码:</strong></p><pre class="mb mc md me gt mt mu mv mw aw mx bi"><span id="3b86" class="ki kj in mu b gy my mz l na nb">// If browser supports navigator.geolocation, generate Lat/Long else let user know there is an error</span><span id="7010" class="ki kj in mu b gy nq mz l na nb">const getPosition = () =&gt; {</span><span id="4cee" class="ki kj in mu b gy nq mz l na nb">if (navigator.geolocation) {</span><span id="a29c" class="ki kj in mu b gy nq mz l na nb">navigator.geolocation.getCurrentPosition(showPosition, posError); // Passing in a success callback and an error callback fn</span><span id="f1f9" class="ki kj in mu b gy nq mz l na nb">} else {</span><span id="10b7" class="ki kj in mu b gy nq mz l na nb">alert("Sorry, Geolocation is not supported by this browser."); // Alert is browser does not support geolocation</span><span id="24c8" class="ki kj in mu b gy nq mz l na nb">}</span><span id="0aab" class="ki kj in mu b gy nq mz l na nb">}</span><span id="7f5f" class="ki kj in mu b gy nq mz l na nb">// Geolocation error callback fn. Query permissions to check if the error occured due to user not allowing location to be shared</span><span id="acba" class="ki kj in mu b gy nq mz l na nb">const posError = () =&gt; {</span><span id="686a" class="ki kj in mu b gy nq mz l na nb">if (navigator.permissions) {</span><span id="4b52" class="ki kj in mu b gy nq mz l na nb">navigator.permissions.query({ name: 'geolocation' }).then(res =&gt; {</span><span id="68f1" class="ki kj in mu b gy nq mz l na nb">if (res.state === 'denied') {</span><span id="e60b" class="ki kj in mu b gy nq mz l na nb">alert('Enable location permissions for this website in your browser settings.')</span><span id="2934" class="ki kj in mu b gy nq mz l na nb">}</span><span id="10e3" class="ki kj in mu b gy nq mz l na nb">})</span><span id="fa88" class="ki kj in mu b gy nq mz l na nb">} else {</span><span id="5972" class="ki kj in mu b gy nq mz l na nb">alert('Unable to access your location. You can continue by submitting location manually.') // Obtaining Lat/long from address necessary</span><span id="079c" class="ki kj in mu b gy nq mz l na nb">}</span><span id="122f" class="ki kj in mu b gy nq mz l na nb">}</span><span id="2f14" class="ki kj in mu b gy nq mz l na nb">// Geolocation success callback fn</span><span id="fec9" class="ki kj in mu b gy nq mz l na nb">const showPosition = (position) =&gt; {</span><span id="aa75" class="ki kj in mu b gy nq mz l na nb">let lat = position.coords.latitude // You have obtained latitude coordinate!</span><span id="6d8a" class="ki kj in mu b gy nq mz l na nb">let long = position.coords.longitude // You have obtained longitude coordinate!</span><span id="ae48" class="ki kj in mu b gy nq mz l na nb">props.set_lat(lat) // Using dispatch to modify lat store state</span><span id="faf8" class="ki kj in mu b gy nq mz l na nb">props.set_long(long) // Using dispatch to modify long store state</span><span id="8de3" class="ki kj in mu b gy nq mz l na nb">convertToAddress(lat, long) // Will convert lat/long to City, State, &amp; Zip code</span><span id="698d" class="ki kj in mu b gy nq mz l na nb">}</span><span id="87aa" class="ki kj in mu b gy nq mz l na nb">// Fetching for google API key from back-end (Optional, you can store it in .env file in front-end)</span><span id="8352" class="ki kj in mu b gy nq mz l na nb">const convertToAddress = (lat, long) =&gt; {</span><span id="5a2a" class="ki kj in mu b gy nq mz l na nb">fetch('http://localhost:3000/googlemaps')</span><span id="3fe4" class="ki kj in mu b gy nq mz l na nb">.then(res =&gt; res.json())</span><span id="c35d" class="ki kj in mu b gy nq mz l na nb">.then(obj =&gt; getAddress(lat, long, obj.api_key))</span><span id="9ddb" class="ki kj in mu b gy nq mz l na nb">}</span><span id="df9a" class="ki kj in mu b gy nq mz l na nb">// Converting lat/long from browser geolocation into city, state, and zip code using Google Geocoding API</span><span id="2781" class="ki kj in mu b gy nq mz l na nb">const getAddress = (lat, long, googleKey) =&gt; {</span><span id="1880" class="ki kj in mu b gy nq mz l na nb">fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${long}&amp;key=${googleKey}`)</span><span id="c87f" class="ki kj in mu b gy nq mz l na nb">.then(res =&gt; res.json())</span><span id="b523" class="ki kj in mu b gy nq mz l na nb">.then(address =&gt; setZip(address))</span><span id="7962" class="ki kj in mu b gy nq mz l na nb">}</span><span id="8f8d" class="ki kj in mu b gy nq mz l na nb">// Dispatching city, state, and zip code to store state</span><span id="8b87" class="ki kj in mu b gy nq mz l na nb">const setZip = (address) =&gt; {</span><span id="d5ce" class="ki kj in mu b gy nq mz l na nb">let city = address.results[5].address_components[2].short_name</span><span id="bf04" class="ki kj in mu b gy nq mz l na nb">let state = address.results[5].address_components[4].short_name</span><span id="091c" class="ki kj in mu b gy nq mz l na nb">let postal = address.results[5].address_components[0].short_name</span><span id="02e9" class="ki kj in mu b gy nq mz l na nb">props.set_city(city)</span><span id="e5e3" class="ki kj in mu b gy nq mz l na nb">props.set_state(state)</span><span id="5a0d" class="ki kj in mu b gy nq mz l na nb">props.set_postal_code(postal)</span><span id="6b45" class="ki kj in mu b gy nq mz l na nb">}</span></pre><p id="bc01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">将城市和州手动条目转换为纬度/经度:</strong></p><pre class="mb mc md me gt mt mu mv mw aw mx bi"><span id="e657" class="ki kj in mu b gy my mz l na nb">// Function that will convert city &amp; state to approximate user lat/long coordinates from manual entry</span><span id="26f4" class="ki kj in mu b gy nq mz l na nb">const processManualLocation = () =&gt; {</span><span id="892e" class="ki kj in mu b gy nq mz l na nb">if (props.userState !== "" &amp;&amp; props.userCity !== "") {</span><span id="7f75" class="ki kj in mu b gy nq mz l na nb">let city = props.userCity // manual lat entry is already in store state</span><span id="ada6" class="ki kj in mu b gy nq mz l na nb">let state = props.userPostalCode // manual long entry is already in store state</span><span id="901c" class="ki kj in mu b gy nq mz l na nb">// This fetch uses the API key stored in your fron-end .env file "process.env.REACT_APP_googleKey"</span><span id="9786" class="ki kj in mu b gy nq mz l na nb">let url = `https://maps.googleapis.com/maps/api/geocode/json?address=+${city},+${state}&amp;key=${process.env.REACT_APP_googleKey}`</span><span id="b52e" class="ki kj in mu b gy nq mz l na nb">fetch(url)</span><span id="59c3" class="ki kj in mu b gy nq mz l na nb">.then(res =&gt; res.json())</span><span id="3149" class="ki kj in mu b gy nq mz l na nb">.then(res =&gt; {</span><span id="d875" class="ki kj in mu b gy nq mz l na nb">if (res.status === "OK") {</span><span id="c11f" class="ki kj in mu b gy nq mz l na nb">getUserCoords(res.results)</span><span id="8d25" class="ki kj in mu b gy nq mz l na nb">} else if (res.status === "ZERO_RESULTS") {</span><span id="73dc" class="ki kj in mu b gy nq mz l na nb">alert('Unable to process this location. Please revise location fields and try submitting again.')</span><span id="99d3" class="ki kj in mu b gy nq mz l na nb">}</span><span id="a433" class="ki kj in mu b gy nq mz l na nb">})</span><span id="86f3" class="ki kj in mu b gy nq mz l na nb">} else {</span><span id="22ad" class="ki kj in mu b gy nq mz l na nb">alert('Please ensure State and City are provided.')</span><span id="421d" class="ki kj in mu b gy nq mz l na nb">}</span><span id="4a34" class="ki kj in mu b gy nq mz l na nb">}</span><span id="0c1a" class="ki kj in mu b gy nq mz l na nb">// Obtaining and dispatching lat and long coords from google geocoding API response</span><span id="6020" class="ki kj in mu b gy nq mz l na nb">const getUserCoords = (googleRes) =&gt; {</span><span id="5b86" class="ki kj in mu b gy nq mz l na nb">let lat = googleRes[0].geometry.location.lat // You have obtained latitude coordinate!</span><span id="c9f5" class="ki kj in mu b gy nq mz l na nb">let long = googleRes[0].geometry.location.lng // You have obtained longitude coordinate!</span><span id="db1e" class="ki kj in mu b gy nq mz l na nb">props.set_lat(lat) // dispatching to store state</span><span id="8fa2" class="ki kj in mu b gy nq mz l na nb">props.set_long(long) //dispatching to store state</span><span id="9043" class="ki kj in mu b gy nq mz l na nb">}</span></pre><p id="7b9c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">完整的“谷歌地图反应”代码:</strong></p><pre class="mb mc md me gt mt mu mv mw aw mx bi"><span id="f6ba" class="ki kj in mu b gy my mz l na nb">import React from 'react';</span><span id="c726" class="ki kj in mu b gy nq mz l na nb">import { connect } from "react-redux";</span><span id="cc52" class="ki kj in mu b gy nq mz l na nb">import GoogleMapReact from 'google-map-react';</span><span id="14db" class="ki kj in mu b gy nq mz l na nb">const UserMap = (props) =&gt; {</span><span id="63ff" class="ki kj in mu b gy nq mz l na nb">let userInfo = {</span><span id="af2e" class="ki kj in mu b gy nq mz l na nb">center: {</span><span id="1852" class="ki kj in mu b gy nq mz l na nb">lat: props.userLat,</span><span id="99c0" class="ki kj in mu b gy nq mz l na nb">lng: props.userLong</span><span id="8418" class="ki kj in mu b gy nq mz l na nb">},</span><span id="8211" class="ki kj in mu b gy nq mz l na nb">zoom: 10</span><span id="427f" class="ki kj in mu b gy nq mz l na nb">};</span><span id="46b4" class="ki kj in mu b gy nq mz l na nb">const renderMarker = (map, maps) =&gt; {</span><span id="4d01" class="ki kj in mu b gy nq mz l na nb">let marker = new maps.Marker({</span><span id="df27" class="ki kj in mu b gy nq mz l na nb">position: userInfo.center,</span><span id="090e" class="ki kj in mu b gy nq mz l na nb">map,</span><span id="31a4" class="ki kj in mu b gy nq mz l na nb">title: "User Location"</span><span id="f557" class="ki kj in mu b gy nq mz l na nb">});</span><span id="8e8b" class="ki kj in mu b gy nq mz l na nb">return marker;</span><span id="97d6" class="ki kj in mu b gy nq mz l na nb">};</span><span id="6b6c" class="ki kj in mu b gy nq mz l na nb">return (</span><span id="314a" class="ki kj in mu b gy nq mz l na nb">&lt;div className="user-map" style={{ height: '600px', width: '600px' }}&gt;</span><span id="ba9f" class="ki kj in mu b gy nq mz l na nb">&lt;GoogleMapReact</span><span id="e12c" class="ki kj in mu b gy nq mz l na nb">bootstrapURLKeys={{ key: process.env.REACT_APP_googleKey }} // My Google API is stored in the .env file in front-end</span><span id="cadc" class="ki kj in mu b gy nq mz l na nb">defaultCenter={userInfo.center}</span><span id="8b67" class="ki kj in mu b gy nq mz l na nb">defaultZoom={userInfo.zoom}</span><span id="4415" class="ki kj in mu b gy nq mz l na nb">yesIWantToUseGoogleMapApiInternals={true}</span><span id="e441" class="ki kj in mu b gy nq mz l na nb">onGoogleApiLoaded={({ map, maps }) =&gt; {</span><span id="be88" class="ki kj in mu b gy nq mz l na nb">renderMarker(map, maps)</span><span id="76d1" class="ki kj in mu b gy nq mz l na nb">}}</span><span id="5598" class="ki kj in mu b gy nq mz l na nb">&gt;</span><span id="342a" class="ki kj in mu b gy nq mz l na nb">&lt;/GoogleMapReact&gt;</span><span id="862d" class="ki kj in mu b gy nq mz l na nb">&lt;/div&gt;</span><span id="9d74" class="ki kj in mu b gy nq mz l na nb">);</span><span id="c63f" class="ki kj in mu b gy nq mz l na nb">}</span><span id="5c5e" class="ki kj in mu b gy nq mz l na nb">const mapStateToProps = (state) =&gt; {</span><span id="3174" class="ki kj in mu b gy nq mz l na nb">return {</span><span id="bef5" class="ki kj in mu b gy nq mz l na nb">userLat: state.userState.userLat,</span><span id="ac05" class="ki kj in mu b gy nq mz l na nb">userLong: state.userState.userLong,</span><span id="1cca" class="ki kj in mu b gy nq mz l na nb">}</span><span id="f8a8" class="ki kj in mu b gy nq mz l na nb">}</span><span id="9b9b" class="ki kj in mu b gy nq mz l na nb">export default connect(mapStateToProps)(UserMap);</span></pre></div></div>    
</body>
</html>