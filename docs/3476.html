<html>
<head>
<title>Adding Dark Mode to my Expo based React Native app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将黑暗模式添加到我基于Expo的React原生应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-dark-mode-to-my-expo-based-react-native-app-4ad37ef97511?source=collection_archive---------3-----------------------#2020-10-02">https://javascript.plainenglish.io/adding-dark-mode-to-my-expo-based-react-native-app-4ad37ef97511?source=collection_archive---------3-----------------------#2020-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="29be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上周，我在React本地应用程序中添加了一个新的日期选择器组件。这个日期选择器在我的组件库中看起来很棒，我对它的工作方式感到非常自豪。</p><p id="bbc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我在新版本的组件库中更新了我的应用程序pull，添加了新组件，在我的iPhone上进行了测试，出现了一个空白框，日期选择器应该在那里。</p><p id="a9fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在绝望地试图改变代码以使其工作并失败的几个新版本之后，我终于找到了问题的答案——日期选择器在那里，只是因为我的手机处于黑暗模式，文本是白色的，而我的选择器恰好也在白色背景上。</p><p id="4c92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我觉得自己像个十足的白痴，浪费时间认为这是一个代码修复，但后来我开始思考——如果我的手机处于黑暗模式，那么我的组件库为什么没有同样的问题？原来，storybook将主题设置为灯光模式，而不考虑手机的设置。</p><p id="d82e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我意识到，如果我有这些问题，那么很可能其他人也会有类似的问题，我可能应该同时支持黑暗和光明模式。</p><h1 id="de68" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">为黑暗模式设计</h1><p id="2ff7" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在设计应用程序时，我使用Figma构建原型，以便进行一些用户测试，并在编写任何代码之前验证这个想法。</p><p id="6da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我在最初的设计中已经为应用程序布置好了所有的屏幕，所以我能够使用Figma的调色板交换功能来创建设计的副本，并更改用于黑暗模式颜色的颜色。</p><p id="2057" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得工作变得非常容易，并大大加快了设计的迭代速度，而且有很多迭代，因为事实证明为黑暗模式设计并不容易。</p><p id="772d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黑暗模式不仅仅是颠倒光明模式调色板的情况，你仍然需要传达正确的信息层次，简单的白色-&gt;黑色颠倒将颠倒这种层次。</p><p id="756b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，如果你有明亮的颜色，你可能会发现它们在黑暗模式下使用时变得非常不和谐，我不得不为我的强调色创建一组柔和的色调，因为在黑暗模式下亮度太大了。</p><p id="5b09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">比较下面三张图片；左边是光模式的反转，中间是确保屏幕元素的层次保持不变，右边是光模式版本。</p><div class="lp lq lr ls gt ab cb"><figure class="lt lu lv lw lx ly lz paragraph-image"><img src="../Images/f85f81ec5468b2fc79b4eb8c17c11799.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*FYBAppkYPAGd9eCWhRQUkw.png"/></figure><figure class="lt lu mc lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><img src="../Images/bd7e3721825a17cb14971f73f561909f.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*zJjcj8cE8gEYRnvcB1LIwQ.png"/></div></figure><figure class="lt lu mh lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><img src="../Images/20b0825659c69c9f71769d8138065fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*twR0KyKw343DT_stWF_pDA.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk mm di mn mo">As you can see the middle one maintains the visual hierarchy of light mode making the UI far easier to understand</figcaption></figure></div><p id="a14c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在已经非常暗的设计中创造一种深度感，我使用了“适当的”黑色(#000000)作为最暗的颜色，而不是我在亮模式中使用的稍微亮一点的阴影。</p><p id="740b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这让我可以用稍微亮一点的颜色作为设计的基础色(在我的设计中，基本上变成了白色的暗模式)。</p><p id="1207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个重要因素是对比度，因为背景色的变化，你可能会发现任何符合WCAG的强调色都不再有足够的对比度来通过。这与前面提到的不和谐效果相结合，意味着很难使设计适应黑暗模式。</p><h1 id="29f1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">将黑暗模式引入基于Expo的React原生应用</h1><p id="569f" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Expo使得处理你的应用程序如何响应用户在它的<code class="fe mp mq mr ms b">app.json</code>文件中的颜色设置变得非常简单，使用<code class="fe mp mq mr ms b">userInterfaceStyle</code>属性，该属性可以被设置为<code class="fe mp mq mr ms b">automatic</code>来支持用户当前的颜色方案选择，或者使用<code class="fe mp mq mr ms b">light</code>和<code class="fe mp mq mr ms b">dark</code>来强制应用程序进入其中一种颜色方案。</p><p id="7ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以在<code class="fe mp mq mr ms b">ios</code>和<code class="fe mp mq mr ms b">android</code>对象中设置<code class="fe mp mq mr ms b">userInterfaceStyle</code>属性，以便在平台级别管理它们。对于我的应用程序，我选择了<code class="fe mp mq mr ms b">automatic</code>。</p><p id="0a41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要检测应用程序中的配色方案，您需要将<code class="fe mp mq mr ms b">react-native-appearance</code>包添加到您的项目中，因为这为我们提供了用于包装应用程序的<code class="fe mp mq mr ms b">AppearanceProvider</code>上下文和用于组件级别的<code class="fe mp mq mr ms b">useColorScheme</code>钩子，以确保使用正确的样式表。</p><p id="90af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个使用<code class="fe mp mq mr ms b">AppearanceProvider</code>包装应用程序的例子。</p><figure class="lp lq lr ls gt lu"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">In side MainApp we can use the useColorScheme hook to get the colour scheme value</figcaption></figure><p id="2814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个在组件中使用<code class="fe mp mq mr ms b">useColorScheme</code>钩子的例子，如果用户使用黑暗模式，钩子返回<code class="fe mp mq mr ms b">'dark'</code>，因此对它的检查可以用来加载黑暗模式样式表。</p><figure class="lp lq lr ls gt lu"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">useColorScheme returns ‘dark’ if the use is using dark mode, ‘light’ if using light mode</figcaption></figure><p id="c77d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在我的组件中既有亮模式样式又有暗模式样式，我采用了亮模式中使用的现有样式表，并将样式对象提取到一个名为<code class="fe mp mq mr ms b">baseStyles</code>的常量中。</p><p id="f8b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我创建了一个<code class="fe mp mq mr ms b">darkModeOverrides</code> const，在根据各自的对象创建亮暗模式的样式表实例之前，它复制并修改了<code class="fe mp mq mr ms b">baseStyles</code>。</p><p id="a4a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我使用<code class="fe mp mq mr ms b">useColorScheme</code>的输出在我的组件中使用正确的样式表。</p><p id="8dd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法允许我通过只关注我需要改变的东西来快速实现黑暗模式，但如果我要重构，我很可能会从彩色样式中删除结构样式，使其更加整洁。</p><figure class="lp lq lr ls gt lu"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">This is a simple example of how I converted my existing app, as you can see I can keep the padding on the view by only updating the values I need to change for dark mode</figcaption></figure><p id="c0f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在亮暗模式下测试我的UI，我为<code class="fe mp mq mr ms b">react-native-appearance</code>创建了一个简单的mock，当我需要在暗模式下测试UI时，它允许我返回‘dark’。</p><figure class="lp lq lr ls gt lu"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">As the checks we’re doing in the component are for the value to be ‘dark’ we can just use jest.fn() until we need to set the return value</figcaption></figure><h2 id="35e8" class="mv kn iq bd ko mw mx dn ks my mz dp kw jy na nb la kc nc nd le kg ne nf li ng bi translated">抓住了——反应本地故事书</h2><p id="f64e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我使用Expo在其一个入门项目中提供的React Native版本的Storybook构建了我的组件库。</p><p id="ce66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最终不得不将<code class="fe mp mq mr ms b">@storybook/.react-native</code>升级到<code class="fe mp mq mr ms b">5.3.23</code>，以便让《故事书》尊重<code class="fe mp mq mr ms b">userInterfaceStyle</code>的设定。</p><p id="df9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还必须对<code class="fe mp mq mr ms b">App.tsx</code>文件进行修改，以便在<code class="fe mp mq mr ms b">AppearanceProvider</code>中包装主故事书视图。这看起来如何的要点可以在下面找到。</p><figure class="lp lq lr ls gt lu"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">Wrapping the storybook UI in appearance provider allows all components in the component library to use the useColorScheme hook</figcaption></figure><p id="2f56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，虽然你可以为Storybook提供一个主题，但它只会对它的元素进行样式化。应用程序的基本视图仍然是白色背景，但这些变化至少足以让我在创建组件时测试它们。</p><h1 id="a769" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">摘要</h1><p id="9059" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">除非你使用的组件不支持配色方案，否则你可以构建一个应用程序，而不必考虑构建一个自适应的UI。</p><p id="0a3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果你像我一样在iOS上使用原生日期选择器，你可能会发现自己的UI不起作用，除非你决定强制一种特定的模式或构建一些更具适应性的东西。</p><p id="6114" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你决定建立一个自适应的用户界面，那么理解和测试你的用户界面在黑暗模式下如何工作是很重要的，而不是仅仅改变你现有的配色方案。</p><p id="40e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你对UI的工作方式感到满意，那么<code class="fe mp mq mr ms b">react-native-appearance</code>将帮助你检测用户正在使用的配色方案，并允许你构建自适应的UI组件。</p></div></div>    
</body>
</html>