<html>
<head>
<title>How to Add Form Validation to React Dynamic Forms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何添加表单验证来反应动态表单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-add-form-validation-to-dynamic-forms-1a3dbddb80f?source=collection_archive---------0-----------------------#2019-12-01">https://javascript.plainenglish.io/how-to-add-form-validation-to-dynamic-forms-1a3dbddb80f?source=collection_archive---------0-----------------------#2019-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb8f22e958ba828c348cfc7e641ebc2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XrxbY2ayyxHy9lmV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@martin_schmidli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Martin Schmidli</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c0db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">动态表单是从一些动态数据派生的表单。它们没有被硬编码到代码中。通常，它们是通过遍历一些数据并从数据中呈现表单来显示的。</p><p id="6fc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Yup可以很容易地遍历对象的字段，然后将它们添加到您的验证模式中，从而允许您验证没有固定字段的表单。</p><p id="600a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以像这样构建一个示例Yup模式:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="855a" class="lk ll iq lg b gy lm ln l lo lp">let schemaObj = {<br/>  to: yup.string().required("This field is required"),<br/>  from: yup.string().required("This field is required"),<br/>  subject: yup.string().required("This field is required")<br/>};</span><span id="0e76" class="lk ll iq lg b gy lq ln l lo lp">fields.forEach(f =&gt; {<br/>  schemaObj[f] = yup.string().required("This field is required");<br/>});</span><span id="70ce" class="lk ll iq lg b gy lq ln l lo lp">let newSchema = yup.object(schemaObj);</span></pre><p id="84a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们遍历<code class="fe lr ls lt lg b">fields </code>来获取占位符，并将它们添加到<code class="fe lr ls lt lg b">schema </code>对象中。这就是使用Yup添加动态字段进行验证所需的全部内容。</p><p id="3e66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将构建一个允许用户输入电子邮件模板的应用程序。然后，他们可以使用这些模板通过SendGrid API向不同的电子邮件地址发送电子邮件。我们的应用程序将包括后端和前端。前端会用React构建，后端会用Express构建。</p><p id="910d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">SendGrid是Twilio为发送电子邮件提供的一项出色服务。我们使用SendGrid来为我们做艰苦的工作，而不是建立自己的电子邮件服务器来发送带有应用程序的电子邮件。它还减少了电子邮件成为垃圾邮件的机会，因为它是一项众所周知的值得信赖的服务。</p><p id="7df0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它也有很容易使用的各种平台发送电子邮件的图书馆。Node.js是受支持的平台之一。</p><p id="81fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用SendGrid发送电子邮件，运行<code class="fe lr ls lt lg b">npm i @sendgrid/mail</code>安装SendGrid SDK包。然后在您的代码中，添加<code class="fe lr ls lt lg b">const sgMail = require(‘@sendgrid/mail’);</code>来导入已安装的包。</p><p id="294c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在您的代码中，您通过以下方式发送电子邮件:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="aef1" class="lk ll iq lg b gy lm ln l lo lp">sgMail.setApiKey(process.env.SENDGRID_API_KEY);<br/>const msg = {<br/>  to: email,<br/>  from: 'email@example.com',<br/>  subject: 'Example Email',<br/>  text: `<br/>    Dear user,    Here is your email.<br/>  `,<br/>  html: `<br/>    &lt;p&gt;Dear user,&lt;/p&gt;    &lt;p&gt;Here is your email.&lt;/p&gt;<br/>  `,<br/>};<br/>sgMail.send(msg);</span></pre><p id="4034" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中<code class="fe lr ls lt lg b">process.env.SENDGRID_API_KEY</code>是SendGrid的API，它应该作为一个环境变量存储，因为它是一个秘密。</p><h1 id="c51b" class="lu ll iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">后端</h1><p id="213c" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">首先，我们将创建一个项目文件夹，并在其中添加一个<code class="fe lr ls lt lg b">backend</code>文件夹。我们将使用Express Generator为我们的项目生成代码。为此，运行<code class="fe lr ls lt lg b">backend</code>文件夹中的<code class="fe lr ls lt lg b">npx express-generator</code>。然后运行<code class="fe lr ls lt lg b">npm i</code>安装<code class="fe lr ls lt lg b">package.json</code>中列出的软件包。</p><p id="5f94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们安装自己的软件包。我们将使用Sequelize作为我们的ORM，Babel用于使用最新的JavaScript特性，Dotenv用于存储环境变量，SendGrid Nodejs用于发送电子邮件，CORS用于支持前端的跨域请求，SQLite3用于数据库。</p><p id="62ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它们，运行<code class="fe lr ls lt lg b">npm i @babel/cli @babel/core @babel/node @babel/preset-env @sendgrid/mail cors sendgrid-nodejs sequelize sqlite3</code>。</p><p id="49b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装好这些之后，我们就可以开始构建后端了。首先，我们添加<code class="fe lr ls lt lg b">.babelrc</code>来使我们的应用程序中的Babel能够使用最新的JavaScript解释器运行应用程序。为此，将<code class="fe lr ls lt lg b">.babelrc</code>添加到<code class="fe lr ls lt lg b">backend</code>文件夹中，并添加:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="1a62" class="lk ll iq lg b gy lm ln l lo lp">{<br/>    "presets": [<br/>        "<a class="ae kc" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>"<br/>    ]<br/>}</span></pre><p id="2df4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lr ls lt lg b">package.json</code>中，在<code class="fe lr ls lt lg b">scripts</code>部分用以下代码替换现有代码:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e21b" class="lk ll iq lg b gy lm ln l lo lp">"start": "nodemon --exec npm run babel-node --  ./bin/www",<br/>"babel-node": "babel-node"</span></pre><p id="8626" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我们可以运行最新的Babel Node运行时，而不是常规的Node运行时，这样我们就可以使用最新的JavaScript特性，比如<code class="fe lr ls lt lg b">import</code></p><p id="1878" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，运行Sequelize CLI来创建数据库样板代码，并为创建数据库进行迁移。运行<code class="fe lr ls lt lg b">backend</code>文件夹中的<code class="fe lr ls lt lg b">npx sequelize-cli init</code>，就会得到<code class="fe lr ls lt lg b">config.json</code>。在<code class="fe lr ls lt lg b">config.json</code>中，将现有代码改为:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="1d9c" class="lk ll iq lg b gy lm ln l lo lp">{<br/>  "development": {<br/>    "dialect": "sqlite",<br/>    "storage": "development.db"<br/>  },<br/>  "test": {<br/>    "dialect": "sqlite",<br/>    "storage": "test.db"<br/>  },<br/>  "production": {<br/>    "dialect": "sqlite",<br/>    "storage": "production.db"<br/>  }<br/>}</span></pre><p id="f75f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建我们的数据迁移。运行:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="b51c" class="lk ll iq lg b gy lm ln l lo lp">npx sequelize-cli model:create --name EmailTemplate --attributes name:string,type:string,template:text,subject,previewText:string</span></pre><p id="0729" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在SQLite数据库中创建<code class="fe lr ls lt lg b">EmailTemplates</code>表。上面的命令也应该为这个表创建相应的模型。</p><p id="d171" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来运行<code class="fe lr ls lt lg b">npx sequelize-cli db:migrate</code>创建数据库。</p><p id="e84b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以继续创建我们的路线。在<code class="fe lr ls lt lg b">routes</code>文件夹中创建一个名为<code class="fe lr ls lt lg b">email.js</code>的文件，并添加:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e03a" class="lk ll iq lg b gy lm ln l lo lp">var express = require("express");<br/>const models = require("../models");<br/>const sgMail = require("<a class="ae kc" href="http://twitter.com/sendgrid/mail" rel="noopener ugc nofollow" target="_blank">@sendgrid/mail</a>");<br/>sgMail.setApiKey(process.env.SENDGRID_API_KEY);<br/>var router = express.Router();</span><span id="8121" class="lk ll iq lg b gy lq ln l lo lp">router.get("/templates", async (req, res, next) =&gt; {<br/>  const templates = await models.EmailTemplate.findAll();<br/>  res.json(templates);<br/>});</span><span id="6a20" class="lk ll iq lg b gy lq ln l lo lp">router.get("/template/:id", async (req, res, next) =&gt; {<br/>  const id = req.params.id;<br/>  const templates = await models.EmailTemplate.findAll({ where: { id } });<br/>  res.json(templates[0]);<br/>});</span><span id="9ea4" class="lk ll iq lg b gy lq ln l lo lp">router.post("/template", async (req, res, next) =&gt; {<br/>  try {<br/>    const template = await models.EmailTemplate.create(req.body);<br/>    res.json(template);<br/>  } catch (ex) {<br/>    res.json(ex);<br/>  }<br/>});</span><span id="26c2" class="lk ll iq lg b gy lq ln l lo lp">router.put("/template/:id", async (req, res, next) =&gt; {<br/>  try {<br/>    const id = req.params.id;<br/>    const { name, description, template, subject } = req.body;<br/>    const temp = await models.EmailTemplate.update(<br/>      {<br/>        name,<br/>        description,<br/>        template,<br/>        subject<br/>      },<br/>      {<br/>        where: { id }<br/>      }<br/>    );<br/>    res.json(temp);<br/>  } catch (ex) {<br/>    res.json(ex);<br/>  }<br/>});</span><span id="1a8e" class="lk ll iq lg b gy lq ln l lo lp">router.delete("/template/:id", async (req, res, next) =&gt; {<br/>  try {<br/>    const id = req.params.id;<br/>    await models.EmailTemplate.destroy({ where: { id } });<br/>    res.json({});<br/>  } catch (ex) {<br/>    res.json(ex);<br/>  }<br/>});</span><span id="c19e" class="lk ll iq lg b gy lq ln l lo lp">router.post("/send", async (req, res, next) =&gt; {<br/>  try {<br/>    const { template, variables, to, subject, from } = req.body;<br/>    let html = template;<br/>    Object.keys(variables).forEach(variable =&gt; {<br/>      html = html.replace(`[[${variable}]]`, variables[variable]);<br/>    });<br/>    const msg = {<br/>      to,<br/>      from,<br/>      subject,<br/>      html<br/>    };<br/>    sgMail.send(msg);<br/>    res.json({});<br/>  } catch (ex) {<br/>    res.json(ex);<br/>  }<br/>});</span><span id="d260" class="lk ll iq lg b gy lq ln l lo lp">module.exports = router;</span></pre><p id="2f6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些都是保存我们的模板和用模板发送电子邮件的方法。GET <code class="fe lr ls lt lg b">templates</code>路线获取我们保存的所有模板。<code class="fe lr ls lt lg b">templates/:id</code>路由通过ID获取模板。我们使用带有where语句<code class="fe lr ls lt lg b">id = {id}</code>的<code class="fe lr ls lt lg b">findAll</code>来获取结果，并且只获取第一个通过ID获取的结果。</p><p id="ecce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">POST <code class="fe lr ls lt lg b">template</code> route用<code class="fe lr ls lt lg b">create</code>函数创建我们的模板。PUR <code class="fe lr ls lt lg b">template</code>路由使用<code class="fe lr ls lt lg b">update</code>功能更新通过ID查找找到的条目。第二个参数有我们的选择条件。删除<code class="fe lr ls lt lg b">template</code>路线通过使用<code class="fe lr ls lt lg b">destroy</code>功能查找要删除的ID条目进行删除。</p><p id="d045" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lr ls lt lg b">send</code>路由调用SendGrid API发送电子邮件，邮件模板中声明的变量用用户设置的值填充。请求体有一个<code class="fe lr ls lt lg b">variables</code>字段来发送变量和值，其中键是变量名，值是值。</p><p id="6949" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为模型的一部分，Sequelize提供了<code class="fe lr ls lt lg b">create</code>、<code class="fe lr ls lt lg b">findAll</code>、<code class="fe lr ls lt lg b">update</code>和<code class="fe lr ls lt lg b">destroy</code>功能。</p><p id="b930" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lr ls lt lg b">app.js</code>中，我们将现有代码替换为:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="0c23" class="lk ll iq lg b gy lm ln l lo lp">require('dotenv').config();<br/>const createError = require("http-errors");<br/>const express = require("express");<br/>const path = require("path");<br/>const cookieParser = require("cookie-parser");<br/>const logger = require("morgan");<br/>const cors = require("cors");</span><span id="e1f4" class="lk ll iq lg b gy lq ln l lo lp">const indexRouter = require("./routes/index");<br/>const emailRouter = require("./routes/email");</span><span id="8699" class="lk ll iq lg b gy lq ln l lo lp">const app = express();</span><span id="0bf1" class="lk ll iq lg b gy lq ln l lo lp">// view engine setup<br/>app.set("views", path.join(__dirname, "views"));<br/>app.set("view engine", "jade");</span><span id="7155" class="lk ll iq lg b gy lq ln l lo lp">app.use(logger("dev"));<br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: false }));<br/>app.use(cookieParser());<br/>app.use(express.static(path.join(__dirname, "public")));<br/>app.use(cors());</span><span id="0c78" class="lk ll iq lg b gy lq ln l lo lp">app.use("/", indexRouter);<br/>app.use("/email", emailRouter);</span><span id="2740" class="lk ll iq lg b gy lq ln l lo lp">// catch 404 and forward to error handler<br/>app.use(function(req, res, next) {<br/>  next(createError(404));<br/>});</span><span id="8862" class="lk ll iq lg b gy lq ln l lo lp">// error handler<br/>app.use(function(err, req, res, next) {<br/>  // set locals, only providing error in development<br/>  res.locals.message = err.message;<br/>  res.locals.error = req.app.get("env") === "development" ? err : {};</span><span id="9c18" class="lk ll iq lg b gy lq ln l lo lp">// render the error page<br/>  res.status(err.status || 500);<br/>  res.render("error");<br/>});</span><span id="85f7" class="lk ll iq lg b gy lq ln l lo lp">module.exports = app;</span></pre><p id="98df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过添加以下内容来支持CORS:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="667b" class="lk ll iq lg b gy lm ln l lo lp">app.use(cors());</span></pre><p id="7634" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们增加了我们的路线:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6fa6" class="lk ll iq lg b gy lm ln l lo lp">const emailRouter = require("./routes/email");<br/>app.use("/email", emailRouter);</span></pre><p id="3cd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就完成了我们的电子邮件应用程序的后端。</p><h1 id="f957" class="lu ll iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">前端</h1><p id="7b4c" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">接下来，我们继续讨论前端。我们通过运行<code class="fe lr ls lt lg b">npx create-react-app frontend</code>在<code class="fe lr ls lt lg b">project</code>文件夹中启动一个新的React项目。</p><p id="62fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们需要安装一些软件包。我们需要用于样式化的Bootstrap、用于状态管理的MobX、用于发出HTTP请求的Axios、分别用于表单值处理和表单验证的Formik和Yup，以及用于将URL路由到页面的React Router。</p><p id="5772" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装软件包，运行<code class="fe lr ls lt lg b">npm i axios bootstrap formik mobx mobx-react react-bootstrap react-router-dom yup</code>。</p><p id="c810" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装完所有的包之后，我们就可以开始构建应用程序了。首先我们用我们的代码替换现有的代码<code class="fe lr ls lt lg b">App.js</code>:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="48f8" class="lk ll iq lg b gy lm ln l lo lp">import React from "react";<br/>import HomePage from "./HomePage";<br/>import { Router, Route } from "react-router-dom";<br/>import { createBrowserHistory as createHistory } from "history";<br/>import "./App.css";<br/>import TopBar from "./TopBar";<br/>import EmailPage from "./EmailPage";<br/>import { EmailTemplateStore } from "./store";<br/>const history = createHistory();<br/>const emailTemplateStore = new EmailTemplateStore();</span><span id="ec3f" class="lk ll iq lg b gy lq ln l lo lp">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Router history={history}&gt;<br/>        &lt;TopBar /&gt;<br/>        &lt;Route<br/>          path="/"<br/>          exact<br/>          component={props =&gt; (<br/>            &lt;HomePage {...props} emailTemplateStore={emailTemplateStore} /&gt;<br/>          )}<br/>        /&gt;<br/>        &lt;Route<br/>          path="/email/:id"<br/>          exact<br/>          component={props =&gt; (<br/>            &lt;EmailPage {...props} emailTemplateStore={emailTemplateStore} /&gt;<br/>          )}<br/>        /&gt;<br/>      &lt;/Router&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="d1be" class="lk ll iq lg b gy lq ln l lo lp">export default App;</span></pre><p id="c2ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们的应用程序的入口组件，它包含我们将添加的路线。路线有<code class="fe lr ls lt lg b">emailTemplateStore</code>，这是我们将创建的一个MobX商店。</p><p id="f2f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lr ls lt lg b">App.css</code>中，将现有代码替换为:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="881b" class="lk ll iq lg b gy lm ln l lo lp">.page {<br/>  padding: 20px;<br/>}</span></pre><p id="6ef6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给我们的页面添加一些填充。</p><p id="2160" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们创建一个用于添加和编辑电子邮件模板的表单。在<code class="fe lr ls lt lg b">src</code>文件夹中创建一个名为<code class="fe lr ls lt lg b">EmailForm.js</code>的文件，并添加:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="fc45" class="lk ll iq lg b gy lm ln l lo lp">import React from "react";<br/>import * as yup from "yup";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";<br/>import Button from "react-bootstrap/Button";<br/>import { observer } from "mobx-react";<br/>import { Formik } from "formik";<br/>import { addTemplate, getTemplates, editTemplate } from "./request";</span><span id="f548" class="lk ll iq lg b gy lq ln l lo lp">const schema = yup.object({<br/>  name: yup.string().required("Name is required"),<br/>  template: yup.string().required("Template is required"),<br/>  subject: yup.string().required("Subject is required")<br/>});</span><span id="ec84" class="lk ll iq lg b gy lq ln l lo lp">function EmailForm({ emailTemplateStore, edit, onSave, template }) {<br/>  const handleSubmit = async evt =&gt; {<br/>    const isValid = await schema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    if (!edit) {<br/>      await addTemplate(evt);<br/>    } else {<br/>      await editTemplate(evt);<br/>    }<br/>    getAllTemplates();<br/>  };</span><span id="13dc" class="lk ll iq lg b gy lq ln l lo lp">  const getAllTemplates = async () =&gt; {<br/>    const response = await getTemplates();<br/>    emailTemplateStore.setTemplates(response.data);<br/>    onSave();<br/>  };</span><span id="aa70" class="lk ll iq lg b gy lq ln l lo lp">  return (<br/>    &lt;&gt;<br/>      &lt;Formik<br/>        validationSchema={schema}<br/>        onSubmit={handleSubmit}<br/>        initialValues={edit ? template : {}}<br/>      &gt;<br/>        {({<br/>          handleSubmit,<br/>          handleChange,<br/>          handleBlur,<br/>          values,<br/>          touched,<br/>          isInvalid,<br/>          errors<br/>        }) =&gt; (<br/>          &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="name"&gt;<br/>                &lt;Form.Label&gt;Name&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="name"<br/>                  placeholder="Name"<br/>                  value={values.name || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.name &amp;&amp; errors.name}<br/>                /&gt;<br/>                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.name}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;</span><span id="eac5" class="lk ll iq lg b gy lq ln l lo lp">&lt;Form.Group as={Col} md="12" controlId="description"&gt;<br/>                &lt;Form.Label&gt;Description&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="description"<br/>                  placeholder="Description"<br/>                  value={values.description || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.description &amp;&amp; errors.description}<br/>                /&gt;</span><span id="1e7b" class="lk ll iq lg b gy lq ln l lo lp">              &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.description}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;</span><span id="94c7" class="lk ll iq lg b gy lq ln l lo lp">              &lt;Form.Group as={Col} md="12" controlId="subject"&gt;<br/>                &lt;Form.Label&gt;Subject&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="subject"<br/>                  placeholder="Subject"<br/>                  value={values.subject || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.subject &amp;&amp; errors.subject}<br/>                /&gt;</span><span id="8f67" class="lk ll iq lg b gy lq ln l lo lp">&lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.subject}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;</span><span id="9bf8" class="lk ll iq lg b gy lq ln l lo lp">&lt;Form.Group as={Col} md="12" controlId="template"&gt;<br/>                &lt;Form.Label&gt;<br/>                  Template - Enter Template in HTML, Put Variables Between<br/>                  Double Brackets.<br/>                &lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  as="textarea"<br/>                  rows="20"<br/>                  name="template"<br/>                  placeholder="Template"<br/>                  value={values.template || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.template &amp;&amp; errors.template}<br/>                /&gt;</span><span id="a9fa" class="lk ll iq lg b gy lq ln l lo lp">                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.template}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;<br/>            &lt;Button type="submit" style={{ marginRight: 10 }}&gt;<br/>              Save<br/>            &lt;/Button&gt;<br/>            &lt;Button type="button"&gt;Cancel&lt;/Button&gt;<br/>          &lt;/Form&gt;<br/>        )}<br/>      &lt;/Formik&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="fce3" class="lk ll iq lg b gy lq ln l lo lp">export default observer(EmailForm);</span></pre><p id="42cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们输入电子邮件模板的表单。我们将“名称”和“模板”字段作为必填字段，将“描述”作为可选字段。我们使用Formik自动更新表单值，并将它们填充到<code class="fe lr ls lt lg b">handleSubmit</code>函数的<code class="fe lr ls lt lg b">evt</code>参数中。通过消除我们自己为每个字段编写<code class="fe lr ls lt lg b">onChange</code>处理程序的需要，这为我们节省了很多工作。</p><p id="5f1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于表单验证，我们定义用<code class="fe lr ls lt lg b">yup</code>制作的<code class="fe lr ls lt lg b">schema</code>对象，并将其传递给<code class="fe lr ls lt lg b">Formik</code>组件。一旦在<code class="fe lr ls lt lg b">Form.Control.Feedback</code>组件中输入无效值，表单验证会自动进行，并显示错误。</p><p id="8f41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lr ls lt lg b">Form</code>组件由React Boostrap提供。如果我们在<code class="fe lr ls lt lg b">Formik</code>组件中设置了<code class="fe lr ls lt lg b">initialialValues</code>，那么<code class="fe lr ls lt lg b">edit</code>属性会告诉我们。只有当我们<code class="fe lr ls lt lg b">edit</code>为<code class="fe lr ls lt lg b">true</code>时，我们才将其设置为<code class="fe lr ls lt lg b">template</code>道具，因为只有这样我们才有东西可编辑。</p><p id="d7d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">提交表单时会调用<code class="fe lr ls lt lg b">handleSubmit</code>函数，它包含所有表单字段的值。我们调用<code class="fe lr ls lt lg b">schema.validate</code>在提交表单之前根据模式验证表单值。如果它们有效，那么我们调用<code class="fe lr ls lt lg b">addTemplate</code>或<code class="fe lr ls lt lg b">editTemplate</code>，这取决于你是否想要添加或编辑模板。<code class="fe lr ls lt lg b">edit</code>将区分它们。如果成功，我们调用<code class="fe lr ls lt lg b">getAllTemplates</code>来获取所有的模板，并将它们放入我们的商店。</p><p id="9b07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe lr ls lt lg b">observer</code>包装在<code class="fe lr ls lt lg b">EmailForm</code>组件之外，以便在MobX存储更新后立即获取最新的值。</p><p id="e267" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们添加一个发送电子邮件的页面。在<code class="fe lr ls lt lg b">src</code>文件夹中添加一个名为<code class="fe lr ls lt lg b">EmailPage.js</code>的文件，并添加:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="20a9" class="lk ll iq lg b gy lm ln l lo lp">import React, { useState, useEffect } from "react";<br/>import { withRouter } from "react-router-dom";<br/>import { getTemplate, sendEmail } from "./request";<br/>import * as yup from "yup";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";<br/>import Button from "react-bootstrap/Button";<br/>import { Formik } from "formik";</span><span id="b11d" class="lk ll iq lg b gy lq ln l lo lp">function EmailPage({ match: { params } }) {<br/>  const [template, setTemplate] = useState({});<br/>  const [schema, setSchema] = useState(yup.object({}));<br/>  const [variables, setVariables] = useState([]);<br/>  const [initialized, setInitialized] = useState(false);</span><span id="cebd" class="lk ll iq lg b gy lq ln l lo lp">  const handleSubmit = async evt =&gt; {<br/>    const isValid = await schema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    let data = { variables: {} };<br/>    data.template = evt.template;<br/>    variables.forEach(v =&gt; {<br/>      const variable = v.replace("[[", "").replace("]]", "");<br/>      data.variables[variable] = evt[variable];<br/>    });<br/>    data.to = evt.to;<br/>    data.from = evt.from;<br/>    data.subject = evt.subject;<br/>    await sendEmail(data);<br/>    alert("Email sent");<br/>  };</span><span id="83d6" class="lk ll iq lg b gy lq ln l lo lp">  const getSingleTemplate = async () =&gt; {<br/>    const response = await getTemplate(params.id);<br/>    setTemplate(response.data);<br/>    const placeholders = response.data.template.match(/\[\[(.*?)\]\]/g);<br/>    setVariables(placeholders);<br/>    let schemaObj = {<br/>      to: yup.string().required("This field is required"),<br/>      from: yup.string().required("This field is required"),<br/>      subject: yup.string().required("This field is required")<br/>    };<br/>    placeholders.forEach(p =&gt; {<br/>      p = p.replace("[[", "").replace("]]", "");<br/>      schemaObj[p] = yup.string().required("This field is required");<br/>    });<br/>    let newSchema = yup.object(schemaObj);<br/>    setSchema(newSchema);<br/>    setInitialized(true);<br/>  };</span><span id="be7a" class="lk ll iq lg b gy lq ln l lo lp">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getSingleTemplate();<br/>    }<br/>  });</span><span id="b99e" class="lk ll iq lg b gy lq ln l lo lp">  return (<br/>    &lt;div className="page"&gt;<br/>      &lt;h1 className="text-center"&gt;Send Email&lt;/h1&gt;<br/>      &lt;Formik<br/>        validationSchema={schema}<br/>        onSubmit={handleSubmit}<br/>        enableReinitialize={true}<br/>        initialValues={template}<br/>      &gt;<br/>        {({<br/>          handleSubmit,<br/>          handleChange,<br/>          handleBlur,<br/>          values,<br/>          touched,<br/>          isInvalid,<br/>          errors<br/>        }) =&gt; (<br/>          &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>            {variables.map((v, i) =&gt; {<br/>              const variable = v.replace("[[", "").replace("]]", "");<br/>              return (<br/>                &lt;Form.Row key={i}&gt;<br/>                  &lt;Form.Group as={Col} md="12" controlId="name"&gt;<br/>                    &lt;Form.Label&gt;Variable - {variable}&lt;/Form.Label&gt;<br/>                    &lt;Form.Control<br/>                      type="text"<br/>                      name={variable}<br/>                      value={values[variable] || ""}<br/>                      onChange={handleChange}<br/>                      isInvalid={touched[variable] &amp;&amp; errors[variable]}<br/>                    /&gt;<br/>                    &lt;Form.Control.Feedback type="invalid"&gt;<br/>                      {errors[variable]}<br/>                    &lt;/Form.Control.Feedback&gt;<br/>                  &lt;/Form.Group&gt;<br/>                &lt;/Form.Row&gt;<br/>              );<br/>            })}</span><span id="fdd1" class="lk ll iq lg b gy lq ln l lo lp">            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="from"&gt;<br/>                &lt;Form.Label&gt;From Email&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="from"<br/>                  placeholder="From Email"<br/>                  value={values.from || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.from &amp;&amp; errors.from}<br/>                /&gt;</span><span id="80a0" class="lk ll iq lg b gy lq ln l lo lp">               &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.from}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;</span><span id="8ef6" class="lk ll iq lg b gy lq ln l lo lp">            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="to"&gt;<br/>                &lt;Form.Label&gt;To Email&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="to"<br/>                  placeholder="To Email"<br/>                  value={values.to || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.to &amp;&amp; errors.to}<br/>                /&gt;</span><span id="906b" class="lk ll iq lg b gy lq ln l lo lp">                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.to}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;</span><span id="a9ae" class="lk ll iq lg b gy lq ln l lo lp">            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="subject"&gt;<br/>                &lt;Form.Label&gt;Subject&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="subject"<br/>                  placeholder="Subject"<br/>                  value={values.subject || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.subject &amp;&amp; errors.subject}<br/>                /&gt;</span><span id="90ae" class="lk ll iq lg b gy lq ln l lo lp">               &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.subject}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;</span><span id="190e" class="lk ll iq lg b gy lq ln l lo lp">            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="template"&gt;<br/>                &lt;Form.Label&gt;Template&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  as="textarea"<br/>                  rows="20"<br/>                  name="template"<br/>                  placeholder="Template"<br/>                  value={values.template || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.template &amp;&amp; errors.template}<br/>                  readOnly<br/>                /&gt;</span><span id="2156" class="lk ll iq lg b gy lq ln l lo lp">               &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.template}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;<br/>            &lt;Button type="submit" style={{ marginRight: 10 }}&gt;<br/>              Send<br/>            &lt;/Button&gt;<br/>          &lt;/Form&gt;<br/>        )}<br/>      &lt;/Formik&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="6292" class="lk ll iq lg b gy lq ln l lo lp">export default withRouter(EmailPage);</span></pre><p id="87cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个组件中，我们通过ID获取电子邮件模板，并在<code class="fe lr ls lt lg b">getSingleTemplate</code>函数中从模板文本中提取变量。我们还使用Yup创建了一个验证模式:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6110" class="lk ll iq lg b gy lm ln l lo lp">let schemaObj = {<br/>  to: yup.string().required("This field is required"),<br/>  from: yup.string().required("This field is required"),<br/>  subject: yup.string().required("This field is required")<br/>};<br/>placeholders.forEach(p =&gt; {<br/>  p = p.replace("[[", "").replace("]]", "");<br/>  schemaObj[p] = yup.string().required("This field is required");<br/>});<br/>let newSchema = yup.object(schemaObj);</span></pre><p id="4968" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了构建Yup模式，我们首先添加静态字段<code class="fe lr ls lt lg b">to</code>、<code class="fe lr ls lt lg b">from</code>和<code class="fe lr ls lt lg b">subject</code>进行验证。然后我们遍历<code class="fe lr ls lt lg b">response.data</code>对象的<code class="fe lr ls lt lg b">variable</code>字段的键，并通过删除括号然后使用每个占位符条目作为键来动态构建Yup表单验证模式。</p><p id="d10a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lr ls lt lg b">Formik</code>组件中，我们把道具:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="be35" class="lk ll iq lg b gy lm ln l lo lp">enableReinitialize={true}</span></pre><p id="11fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样我们就可以用<code class="fe lr ls lt lg b">name</code> prop <code class="fe lr ls lt lg b">template</code>填充表单字段中的模板文本。</p><p id="7327" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lr ls lt lg b">Form</code>组件中，我们有:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="540a" class="lk ll iq lg b gy lm ln l lo lp">{variables.map((v, i) =&gt; {<br/>   const variable = v.replace("[[", "").replace("]]", "");<br/>      return (<br/>        &lt;Form.Row key={i}&gt;<br/>          &lt;Form.Group as={Col} md="12" controlId="name"&gt;<br/>            &lt;Form.Label&gt;Variable - {variable}&lt;/Form.Label&gt;<br/>            &lt;Form.Control<br/>              type="text"<br/>              name={variable}<br/>              value={values[variable] || ""}<br/>              onChange={handleChange}<br/>              isInvalid={touched[variable] &amp;&amp; errors[variable]}<br/>          /&gt;<br/>          &lt;Form.Control.Feedback type="invalid"&gt;<br/>              {errors[variable]}<br/>          &lt;/Form.Control.Feedback&gt;<br/>        &lt;/Form.Group&gt;<br/>    &lt;/Form.Row&gt;<br/>    );<br/>})}</span></pre><p id="278e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">动态循环通过我们在<code class="fe lr ls lt lg b">getSingleTemplate</code>函数中设置的<code class="fe lr ls lt lg b">variables</code>，并使用表单验证消息呈现表单字段。我们将<code class="fe lr ls lt lg b">name</code>道具设置为<code class="fe lr ls lt lg b">variable</code>，以便显示正确的信息。A <code class="fe lr ls lt lg b">variable</code>与a <code class="fe lr ls lt lg b">placeholder</code>相同，但去掉了支架。</p><p id="213b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要将<code class="fe lr ls lt lg b">withRouter</code>函数包装在<code class="fe lr ls lt lg b">EmailPage</code>之外，这样我们就可以获得<code class="fe lr ls lt lg b">match</code>属性，从而从URL中获得电子邮件模板的ID。</p><p id="dd28" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们构建主页，它将有一个显示保存的模板列表的表格，并且在每个表格行中有按钮，让用户发送带有模板的电子邮件，或者删除或编辑模板。还会有一个按钮，让用户添加一个电子邮件模板。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="82fe" class="lk ll iq lg b gy lm ln l lo lp">import React, { useState, useEffect } from "react";<br/>import { withRouter } from "react-router-dom";<br/>import EmailForm from "./EmailForm";<br/>import Modal from "react-bootstrap/Modal";<br/>import ButtonToolbar from "react-bootstrap/ButtonToolbar";<br/>import Button from "react-bootstrap/Button";<br/>import Table from "react-bootstrap/Table";<br/>import { observer } from "mobx-react";<br/>import { getTemplates, deleteTemplate } from "./request";</span><span id="0778" class="lk ll iq lg b gy lq ln l lo lp">function HomePage({ emailTemplateStore, history }) {<br/>  const [openAddModal, setOpenAddModal] = useState(false);<br/>  const [openEditModal, setOpenEditModal] = useState(false);<br/>  const [initialized, setInitialized] = useState(false);<br/>  const [template, setTemplate] = useState([]);</span><span id="cc34" class="lk ll iq lg b gy lq ln l lo lp">const openAddTemplateModal = () =&gt; {<br/>    setOpenAddModal(true);<br/>  };</span><span id="6e75" class="lk ll iq lg b gy lq ln l lo lp">const closeAddModal = () =&gt; {<br/>    setOpenAddModal(false);<br/>    setOpenEditModal(false);<br/>  };</span><span id="1ecf" class="lk ll iq lg b gy lq ln l lo lp">const cancelAddModal = () =&gt; {<br/>    setOpenAddModal(false);<br/>  };</span><span id="e1c8" class="lk ll iq lg b gy lq ln l lo lp">const cancelEditModal = () =&gt; {<br/>    setOpenEditModal(false);<br/>  };</span><span id="0163" class="lk ll iq lg b gy lq ln l lo lp">const getAllTemplates = async () =&gt; {<br/>    const response = await getTemplates();<br/>    emailTemplateStore.setTemplates(response.data);<br/>    setInitialized(true);<br/>  };</span><span id="fdc2" class="lk ll iq lg b gy lq ln l lo lp">  const editTemplate = template =&gt; {<br/>    setTemplate(template);<br/>    setOpenEditModal(true);<br/>  };</span><span id="ff66" class="lk ll iq lg b gy lq ln l lo lp">  const onSave = () =&gt; {<br/>    cancelAddModal();<br/>    cancelEditModal();<br/>  };</span><span id="e615" class="lk ll iq lg b gy lq ln l lo lp">  const deleteSelectedTemplate = async id =&gt; {<br/>    await deleteTemplate(id);<br/>    getAllTemplates();<br/>  };</span><span id="bfd4" class="lk ll iq lg b gy lq ln l lo lp">  const sendEmail = template =&gt; {<br/>    history.push(`/email/${template.id}`);<br/>  };</span><span id="7a15" class="lk ll iq lg b gy lq ln l lo lp">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getAllTemplates();<br/>    }<br/>  });</span><span id="c54e" class="lk ll iq lg b gy lq ln l lo lp">  return (<br/>    &lt;div className="page"&gt;<br/>      &lt;h1 className="text-center"&gt;Templates&lt;/h1&gt;<br/>      &lt;ButtonToolbar onClick={openAddTemplateModal}&gt;<br/>        &lt;Button variant="primary"&gt;Add Template&lt;/Button&gt;<br/>      &lt;/ButtonToolbar&gt;</span><span id="8fa3" class="lk ll iq lg b gy lq ln l lo lp">      &lt;Modal show={openAddModal} onHide={closeAddModal}&gt;<br/>        &lt;Modal.Header closeButton&gt;<br/>          &lt;Modal.Title&gt;Add Template&lt;/Modal.Title&gt;<br/>        &lt;/Modal.Header&gt;<br/>        &lt;Modal.Body&gt;<br/>          &lt;EmailForm<br/>            onSave={onSave.bind(this)}<br/>            cancelModal={cancelAddModal.bind(this)}<br/>            emailTemplateStore={emailTemplateStore}<br/>          /&gt;<br/>        &lt;/Modal.Body&gt;<br/>      &lt;/Modal&gt;</span><span id="a907" class="lk ll iq lg b gy lq ln l lo lp">      &lt;Modal show={openEditModal} onHide={cancelEditModal}&gt;<br/>        &lt;Modal.Header closeButton&gt;<br/>          &lt;Modal.Title&gt;Edit Template&lt;/Modal.Title&gt;<br/>        &lt;/Modal.Header&gt;<br/>        &lt;Modal.Body&gt;<br/>          &lt;EmailForm<br/>            edit={true}<br/>            template={template}<br/>            onSave={onSave.bind(this)}<br/>            cancelModal={cancelEditModal.bind(this)}<br/>            emailTemplateStore={emailTemplateStore}<br/>          /&gt;<br/>        &lt;/Modal.Body&gt;<br/>      &lt;/Modal&gt;<br/>      &lt;br /&gt;<br/>      &lt;Table striped bordered hover&gt;<br/>        &lt;thead&gt;<br/>          &lt;tr&gt;<br/>            &lt;th&gt;Name&lt;/th&gt;<br/>            &lt;th&gt;Description&lt;/th&gt;<br/>            &lt;th&gt;Subject&lt;/th&gt;<br/>            &lt;th&gt;Send Email&lt;/th&gt;<br/>            &lt;th&gt;Edit&lt;/th&gt;<br/>            &lt;th&gt;Delete&lt;/th&gt;<br/>          &lt;/tr&gt;<br/>        &lt;/thead&gt;<br/>        &lt;tbody&gt;<br/>          {emailTemplateStore.templates.map(t =&gt; (<br/>            &lt;tr key={t.id}&gt;<br/>              &lt;td&gt;{t.name}&lt;/td&gt;<br/>              &lt;td&gt;{t.description}&lt;/td&gt;<br/>              &lt;td&gt;{t.subject}&lt;/td&gt;<br/>              &lt;td&gt;<br/>                &lt;Button<br/>                  variant="outline-primary"<br/>                  onClick={sendEmail.bind(this, t)}<br/>                &gt;<br/>                  Send Email<br/>                &lt;/Button&gt;<br/>              &lt;/td&gt;<br/>              &lt;td&gt;<br/>                &lt;Button<br/>                  variant="outline-primary"<br/>                  onClick={editTemplate.bind(this, t)}<br/>                &gt;<br/>                  Edit<br/>                &lt;/Button&gt;<br/>              &lt;/td&gt;<br/>              &lt;td&gt;<br/>                &lt;Button<br/>                  variant="outline-primary"<br/>                  onClick={deleteSelectedTemplate.bind(this, t.id)}<br/>                &gt;<br/>                  Delete<br/>                &lt;/Button&gt;<br/>              &lt;/td&gt;<br/>            &lt;/tr&gt;<br/>          ))}<br/>        &lt;/tbody&gt;<br/>      &lt;/Table&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="d29d" class="lk ll iq lg b gy lq ln l lo lp">export default withRouter(observer(HomePage));</span></pre><p id="d19f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有React Boostrap提供的<code class="fe lr ls lt lg b">Table</code>。同样，我们将<code class="fe lr ls lt lg b">withRouter</code>函数包装在底部的<code class="fe lr ls lt lg b">HomePage</code>组件之外，以便在props中获得<code class="fe lr ls lt lg b">history</code>对象，这让我们可以调用<code class="fe lr ls lt lg b">history.push</code>来重定向到我们的电子邮件页面。</p><p id="ecdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe lr ls lt lg b">openAddTemplateModal</code>、<code class="fe lr ls lt lg b">closeAddModal</code>、<code class="fe lr ls lt lg b">cancelAddModal</code>、<code class="fe lr ls lt lg b">cancelEditModal</code>和<code class="fe lr ls lt lg b">onSave</code>功能来打开或关闭添加或编辑模式。<code class="fe lr ls lt lg b">onSave</code>被<code class="fe lr ls lt lg b">EmailForm</code>组件作为道具传递给<code class="fe lr ls lt lg b">EmailForm</code>使用。我们有一个<code class="fe lr ls lt lg b">getAllTemplates</code>函数来获取我们保存的模板。我们使用<code class="fe lr ls lt lg b">useEffect</code>的回调函数，通过检查<code class="fe lr ls lt lg b">initialized</code>变量在第一次加载时获取模板，如果为假，则<code class="fe lr ls lt lg b">getAllTemplates</code>加载并将<code class="fe lr ls lt lg b">initialized</code>设置为<code class="fe lr ls lt lg b">false</code>，这样就不会再次加载。</p><p id="643e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lr ls lt lg b">Modal</code>组件由React Bootstrap提供。在添加和编辑模式中，我们使用相同的<code class="fe lr ls lt lg b">EmailForm</code>来保存模板。我们可以通过使用<code class="fe lr ls lt lg b">edit</code>道具来判断用户是在添加还是编辑。</p><p id="a9bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，创建一个名为<code class="fe lr ls lt lg b">requests.js</code>的文件并添加:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="ce3a" class="lk ll iq lg b gy lm ln l lo lp">const APIURL = "<a class="ae kc" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>";<br/>const axios = require("axios");</span><span id="c40d" class="lk ll iq lg b gy lq ln l lo lp">export const getTemplates = () =&gt; axios.get(`${APIURL}/email/templates`);</span><span id="570c" class="lk ll iq lg b gy lq ln l lo lp">export const getTemplate = id =&gt; axios.get(`${APIURL}/email/template/${id}`);</span><span id="ca59" class="lk ll iq lg b gy lq ln l lo lp">export const addTemplate = data =&gt; axios.post(`${APIURL}/email/template`, data);</span><span id="caa1" class="lk ll iq lg b gy lq ln l lo lp">export const editTemplate = data =&gt;<br/>  axios.put(`${APIURL}/email/template/${data.id}`, data);</span><span id="8d1b" class="lk ll iq lg b gy lq ln l lo lp">export const deleteTemplate = id =&gt;<br/>  axios.delete(`${APIURL}/email/template/${id}`);</span><span id="954d" class="lk ll iq lg b gy lq ln l lo lp">export const sendEmail = data =&gt; axios.post(`${APIURL}/email/send`, data);</span></pre><p id="fa40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让用户向我们的后端发出HTTP请求。</p><p id="2e1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在<code class="fe lr ls lt lg b">src</code>中创建<code class="fe lr ls lt lg b">store.js</code>并放入:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2677" class="lk ll iq lg b gy lm ln l lo lp">import { observable, action, decorate } from "mobx";</span><span id="a599" class="lk ll iq lg b gy lq ln l lo lp">class EmailTemplateStore {<br/>  templates = [];</span><span id="ee97" class="lk ll iq lg b gy lq ln l lo lp">setTemplates(templates) {<br/>    this.templates = templates;<br/>  }<br/>}</span><span id="0bc7" class="lk ll iq lg b gy lq ln l lo lp">EmailTemplateStore = decorate(EmailTemplateStore, {<br/>  templates: observable,<br/>  setTemplates: action<br/>});</span><span id="8889" class="lk ll iq lg b gy lq ln l lo lp">export { EmailTemplateStore };</span></pre><p id="d9ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们将模板数组存储在一个中心位置，以便于所有组件访问。我们通过组件的<code class="fe lr ls lt lg b">emailTemplateStore</code>属性在组件中传递一个这样的实例来调用<code class="fe lr ls lt lg b">setTemplates</code>函数来设置模板，并通过使用<code class="fe lr ls lt lg b">emailTemplateStore.templates</code>来访问模板。这就是为什么我们将<code class="fe lr ls lt lg b">observable</code>函数包装在我们的组件周围。我们需要最新的值，因为它们在此处更新。此外，我们在<code class="fe lr ls lt lg b">decorate</code>函数中将<code class="fe lr ls lt lg b">templates</code>指定为<code class="fe lr ls lt lg b">observable</code>，以允许<code class="fe lr ls lt lg b">templates</code>字段在被访问时拥有最新的值。<code class="fe lr ls lt lg b">setTemplates</code>被指定为<code class="fe lr ls lt lg b">action</code>这样我们就可以调用它来操纵商店。</p><p id="4f75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，创建<code class="fe lr ls lt lg b">TopBar.js</code>并添加:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d37d" class="lk ll iq lg b gy lm ln l lo lp">import React from "react";<br/>import Navbar from "react-bootstrap/Navbar";<br/>import Nav from "react-bootstrap/Nav";<br/>import { withRouter } from "react-router-dom";</span><span id="94ec" class="lk ll iq lg b gy lq ln l lo lp">function TopBar({ location }) {<br/>  return (<br/>    &lt;Navbar bg="primary" expand="lg" variant="dark"&gt;<br/>      &lt;Navbar.Brand href="#home"&gt;Email App&lt;/Navbar.Brand&gt;<br/>      &lt;Navbar.Toggle aria-controls="basic-navbar-nav" /&gt;<br/>      &lt;Navbar.Collapse id="basic-navbar-nav"&gt;<br/>        &lt;Nav className="mr-auto"&gt;<br/>          &lt;Nav.Link href="/" active={location.pathname == "/"}&gt;<br/>            Home<br/>          &lt;/Nav.Link&gt;<br/>        &lt;/Nav&gt;<br/>      &lt;/Navbar.Collapse&gt;<br/>    &lt;/Navbar&gt;<br/>  );<br/>}</span><span id="6324" class="lk ll iq lg b gy lq ln l lo lp">export default withRouter(TopBar);</span></pre><p id="b3e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用React Boostrap提供的<code class="fe lr ls lt lg b">Navbar</code>组件创建一个顶栏。我们检查<code class="fe lr ls lt lg b">pathname</code>以通过设置<code class="fe lr ls lt lg b">active</code>属性来突出显示正确的链接。</p><p id="e45f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，在<code class="fe lr ls lt lg b">index.html</code>中，将现有代码替换为:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="782c" class="lk ll iq lg b gy lm ln l lo lp">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>    &lt;meta name="theme-color" content="#000000" /&gt;<br/>    &lt;meta<br/>      name="description"<br/>      content="Web site created using create-react-app"<br/>    /&gt;<br/>    &lt;link rel="apple-touch-icon" href="logo192.png" /&gt;<br/>    &lt;!--<br/>      manifest.json provides metadata used when your web app is installed on a<br/>      user's mobile device or desktop. See <a class="ae kc" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/web-app-manifest/</a><br/>    --&gt;<br/>    &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>    &lt;!--<br/>      Notice the use of %PUBLIC_URL% in the tags above.<br/>      It will be replaced with the URL of the `public` folder during the build.<br/>      Only files inside the `public` folder can be referenced from the HTML.</span><span id="5977" class="lk ll iq lg b gy lq ln l lo lp">Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will<br/>      work correctly both with client-side routing and a non-root public URL.<br/>      Learn how to configure a non-root public URL by running `npm run build`.<br/>    --&gt;<br/>    &lt;title&gt;Email App&lt;/title&gt;<br/>    &lt;link<br/>      rel="stylesheet"<br/>      href="<a class="ae kc" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css</a>"<br/>      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"<br/>      crossorigin="anonymous"<br/>    /&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>    &lt;!--<br/>      This HTML file is a template.<br/>      If you open it directly in the browser, you will see an empty page.</span><span id="63a1" class="lk ll iq lg b gy lq ln l lo lp">You can add webfonts, meta tags, or analytics to this file.<br/>      The build step will place the bundled scripts into the &lt;body&gt; tag.</span><span id="0851" class="lk ll iq lg b gy lq ln l lo lp">To begin the development, run `npm start` or `yarn start`.<br/>      To create a production bundle, use `npm run build` or `yarn build`.<br/>    --&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="bedd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加引导CSS并更改应用程序的标题。</p><p id="2121" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦完成所有操作，进入<code class="fe lr ls lt lg b">backend</code>文件夹并运行<code class="fe lr ls lt lg b">npm start</code>启动后端，进入<code class="fe lr ls lt lg b">frontend</code>文件夹并运行相同的命令。如果问你是否想从不同的端口运行应用程序，请回答<code class="fe lr ls lt lg b">yes</code>。</p><p id="12c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们得到:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/8a3f7f4064ede3dc8d12536872ae66b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kK1HsxN931tHnYkhleMnAw.png"/></div></div></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/ad2ff971ce04b032f668ce35a5929a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikI1J1bV-DX48fRlJEQbOA.png"/></div></div></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/ac210d84f04a01e34c4d3ab134bbe267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ic6SL8-WgmgOZDqRN2pnjg.png"/></div></div></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/f0d697e04d2f6ead6f9f7a279cd74c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bRNWzqy9DWYKM9uNOuoZNQ.png"/></div></div></figure></div></div>    
</body>
</html>