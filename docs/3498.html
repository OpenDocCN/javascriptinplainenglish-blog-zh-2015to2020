<html>
<head>
<title>Testing Accessibility Before you Deploy with GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在使用GitHub操作部署之前测试可访问性</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/testing-accessibility-before-you-deploy-with-github-actions-ad6ec7ef129a?source=collection_archive---------6-----------------------#2020-10-04">https://javascript.plainenglish.io/testing-accessibility-before-you-deploy-with-github-actions-ad6ec7ef129a?source=collection_archive---------6-----------------------#2020-10-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="24df" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何为你的Jekyll网站编写测试</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/82f44a2edd25f17b49541f8290bb728e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OZn8c9b4ojbxM62S"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@pgreen1983?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Paul Green</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5caf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在离开前端开发几个月后，我发现了一个需要解决的问题。如果你读过我关于测试的另一个故事，你会知道这是我在工作中经常思考的事情。编写Web组件在部署代码之前创建要运行的测试是很简单的。有人问我，在部署你的网站之前，如何为你的Jekyll网站编写可访问性测试。幸运的是，我们可以使用GitHub动作来执行您的测试，并在您失败时暂停构建。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lw"><img src="../Images/1bd28da647b05c828914cbf81603f056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eWrOvcfz8AlI_i42"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@yancymin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Yancy Min</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="3bf0" class="lx ly in bd lz ma mb dn mc md me dp mf lc mg mh mi lg mj mk ml lk mm mn mo mp bi translated">GitHub操作</h2><p id="75bc" class="pw-post-body-paragraph kt ku in kv b kw mq jo ky kz mr jr lb lc ms le lf lg mt li lj lk mu lm ln lo ig bi translated">什么是GitHub动作？来自GitHub网站</p><blockquote class="mv mw mx"><p id="3990" class="kt ku my kv b kw kx jo ky kz la jr lb mz ld le lf na lh li lj nb ll lm ln lo ig bi translated">GitHub Actions现在拥有世界一流的CI/CD，可以轻松实现所有软件工作流程的自动化。直接从GitHub构建、测试和部署您的代码。按照您想要的方式进行代码审查、分支管理和问题分类。</p></blockquote><p id="0ed6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">GitHub Actions是你的CI/CD。操作使用YAML文件来定义CI/CD管道的步骤。在我们的YAML文件中，我们将定义我们的管道。我们想做的步骤是</p><ul class=""><li id="07a4" class="nc nd in kv b kw kx kz la lc ne lg nf lk ng lo nh ni nj nk bi translated">下载代码</li><li id="c81b" class="nc nd in kv b kw nl kz nm lc nn lg no lk np lo nh ni nj nk bi translated">将我们下载代码的权限更改为777</li><li id="9db0" class="nc nd in kv b kw nl kz nm lc nn lg no lk np lo nh ni nj nk bi translated">NPM安装</li><li id="717b" class="nc nd in kv b kw nl kz nm lc nn lg no lk np lo nh ni nj nk bi translated">建立一个Jekyll网站</li><li id="64cc" class="nc nd in kv b kw nl kz nm lc nn lg no lk np lo nh ni nj nk bi translated">进行我们的测试。</li><li id="d587" class="nc nd in kv b kw nl kz nm lc nn lg no lk np lo nh ni nj nk bi translated">继续我们的CI/CD</li></ul><p id="afe2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我已经创建了一个<a class="ae ks" href="https://github.com/jcdalton2201/jekyll-accessibility-test" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a>来展示这将如何工作。YAML文件中的步骤目录下的blank.yml。github/workflows/blank.yml。</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="7cbb" class="lx ly in nr b gy nv nw l nx ny">steps:</span><span id="4676" class="lx ly in nr b gy nz nw l nx ny"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span><span id="777d" class="lx ly in nr b gy nz nw l nx ny">- uses: actions/checkout@v2</span><span id="dda3" class="lx ly in nr b gy nz nw l nx ny">- name: update permissions</span><span id="db2b" class="lx ly in nr b gy nz nw l nx ny">run: |</span><span id="f052" class="lx ly in nr b gy nz nw l nx ny">cd ..</span><span id="3b7c" class="lx ly in nr b gy nz nw l nx ny">sudo chmod -R 777 .</span><span id="6ce5" class="lx ly in nr b gy nz nw l nx ny"># NPM installs</span><span id="0fa3" class="lx ly in nr b gy nz nw l nx ny">- name: NPM installs</span><span id="4ae6" class="lx ly in nr b gy nz nw l nx ny">run: npm install</span><span id="e9e6" class="lx ly in nr b gy nz nw l nx ny"># start up a jekyll server</span><span id="538f" class="lx ly in nr b gy nz nw l nx ny">- name: Build the stack</span><span id="1028" class="lx ly in nr b gy nz nw l nx ny">run: docker-compose up -d</span><span id="ee09" class="lx ly in nr b gy nz nw l nx ny"># Test and show the container running</span><span id="6bcc" class="lx ly in nr b gy nz nw l nx ny">- name: Show running containers</span><span id="e337" class="lx ly in nr b gy nz nw l nx ny">run: docker ps -a</span><span id="3127" class="lx ly in nr b gy nz nw l nx ny">#Sleep for 30s to give Jekyll a chance to spin up</span><span id="bc9b" class="lx ly in nr b gy nz nw l nx ny">- name: Sleep for 30 seconds</span><span id="8488" class="lx ly in nr b gy nz nw l nx ny">uses: jakejarvis/wait-action@master</span><span id="8e24" class="lx ly in nr b gy nz nw l nx ny">with:</span><span id="c346" class="lx ly in nr b gy nz nw l nx ny">time: '30s'</span><span id="26c6" class="lx ly in nr b gy nz nw l nx ny">#start the tests</span><span id="678f" class="lx ly in nr b gy nz nw l nx ny">- name: Test is site</span><span id="b59d" class="lx ly in nr b gy nz nw l nx ny">run: npm run test</span></pre><p id="8698" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一行是我们对Jekyll网站的检查。下一步是更新我们的签出目录的权限。我们必须更改权限，因为我们的Jekyll版本在构建时会更新目录。下一步是安装NPM。在这一点上，一切都应该是直截了当的。下一步是事情变得有趣的地方。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h2 id="3982" class="lx ly in bd lz ma mb dn mc md me dp mf lc mg mh mi lg mj mk ml lk mm mn mo mp bi translated">码头工人</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oa"><img src="../Images/24b789183d9acf278f283e3b50dd0a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3K6VjExmEgtd4zGo"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@jonassmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jonas Smith</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c19c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">GitHub Actions在Docker容器中运行。他们使用的Docker容器上安装了Docker。它允许我们在GitHub内部运行一个单独的Docker容器。当我们运行测试时，我们需要能够这样做来运行我们自己的Jekyll服务器。</p><p id="0fa0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我用启动时启动的Jekyll服务器创建了一个Docker映像。我会推荐建立你的哲基尔形象，但这里有一个是我做的<a class="ae ks" href="https://hub.docker.com/r/jcdalton2201/jekyll-ci-cd" rel="noopener ugc nofollow" target="_blank">jcdalton 2201/Jekyll-ci-CD</a>。我们现在可以使用YAML文件中的docker-compose命令启动容器，并使用-d属性在后台运行。如果需要的话，我们也可以对一个简单的web服务器这样做。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h2 id="0f90" class="lx ly in bd lz ma mb dn mc md me dp mf lc mg mh mi lg mj mk ml lk mm mn mo mp bi translated">操纵木偶的人</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/fc834f2b56c7d22bcefbfc04c6b8cb5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OGfIknZj6SDrkgqA"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@blackpoetry?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">pixpoetry</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="70ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后一步是运行我们的测试。我使用Jasmine、木偶师和Axe-Core进行测试。如果你看我的GitHub repo，你会在spec目录中找到我的测试。如果你过去用过木偶戏，这些测试是基本的。您创建了您的木偶页面，并在容器中访问您的网站。</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="c485" class="lx ly in nr b gy nv nw l nx ny">await page.goto(‘<a class="ae ks" href="http://localhost:4000/',{waitUntil" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/',<br/>  {<br/>    waitUntil</a>: ‘networkidle0’<br/>  }<br/>);</span></pre><p id="f729" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">networkidle0将一直等到页面停止加载。然后我用下面的代码运行Axe。</p><pre class="kd ke kf kg gt nq nr ns nt aw nu bi"><span id="c57b" class="lx ly in nr b gy nv nw l nx ny">const results = await new AxePuppeteer(page).include(‘body’).analyze();</span><span id="9caf" class="lx ly in nr b gy nz nw l nx ny">expect(axeUtils.isValid(results)).toBeTruthy();</span></pre><p id="355d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们刚刚在车身上运行了Axe进行可访问性测试。</p><p id="d6e9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，我们可以在将静态网站部署到环境中之前测试它的可访问性。我希望这个例子能帮助团队在测试中增加可访问性，并在它影响到任何环境之前完成。</p></div></div>    
</body>
</html>