<html>
<head>
<title>Server-side rendering (SSR) in Angular applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度应用中的服务器端渲染(SSR)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/server-side-rendering-ssr-in-angular-applications-f3f141e44ebf?source=collection_archive---------4-----------------------#2020-07-13">https://javascript.plainenglish.io/server-side-rendering-ssr-in-angular-applications-f3f141e44ebf?source=collection_archive---------4-----------------------#2020-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6edf8c6ff94b5ccf4d795c2a1e7e7a85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_heXqQ9V1rUdtKeNilQXtw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@tvick" rel="noopener ugc nofollow" target="_blank">Taylor Vick</a></figcaption></figure><h2 id="f86d" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">服务器端呈现和客户端呈现</h2><p id="0a89" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">默认情况下，Angular应用程序依赖浏览器来编译所有代码。即使这是行为，也有办法改变这一点。您可以将应用程序更改为在服务器上编译，而不是在客户端的浏览器上编译。</p><p id="5335" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这个讨论归结为客户端渲染(CSR)和服务器端渲染(SSR)。在本文中，我将介绍什么是SSR和CSR，它们的优缺点，以及如何将您的应用程序转换为SSR。</p><p id="8439" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">简单来说，CSR依靠客户端的浏览器来编译代码。另一方面，SSR依赖于服务器来编译代码，然后将编译好的代码返回给客户端。</p><p id="2e41" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">众所周知，软件开发中的任何问题都没有完美的解决方案。和其他事情一样，这两种选择各有利弊。</p><h2 id="b28d" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">让我们从一个例子开始</h2><p id="3149" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">首先，从创建一个角度应用程序开始。您可以通过运行下面的命令<code class="fe lz ma mb mc b">ng init my-application</code>来做到这一点。</p><p id="d724" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">之后，通过运行<code class="fe lz ma mb mc b">npm run start</code>启动您的应用程序。</p><p id="3f9f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果您打开终端的一个实例并运行<code class="fe lz ma mb mc b">curl http://localhost:4200</code>，您将会得到类似这样的结果。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/79acb5fd32006f8edf42844c9e49eaf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpTJrbfOtvUCx8aFRe9B0w.png"/></div></div></figure><p id="dc3f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这有什么不好？没什么。如果你看一看，你会发现里面只有<code class="fe lz ma mb mc b">&lt;app-root&gt;</code>，什么也没有。但是你的页面确实有其他内容，对吗？其余的在哪里？</p><p id="7c96" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果你用浏览器访问这个页面，你会看到完全不同的东西。正如您所看到的，您确实看到了您的<code class="fe lz ma mb mc b">app-root</code>组件的内容。这是因为浏览器是编译您的应用程序的浏览器。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/00d760b04c3b8f4809b00b3f2701b3fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkpZnjsghYStfTfPiCq2YQ.png"/></div></div></figure><p id="df81" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">一些开发者也可能利用Angular的API进行SEO优化。例如，您可以以编程方式设置<code class="fe lz ma mb mc b">meta</code>或<code class="fe lz ma mb mc b">title</code>标签。在下面的例子中，您可以为这个页面设置标题和一些meta标签。</p><pre class="me mf mg mh gt mj mc mk ml aw mm bi"><span id="0804" class="kd ke iq mc b gy mn mo l mp mq">@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent {<br/>  constructor(<br/>    private readonly titleService: Title,<br/>    private readonly meta: Meta) {<br/>      this.meta.addTag({ name: 'description', content: 'My description' });<br/>      this.meta.addTag({ name: 'author', content: 'author name' });<br/>      this.meta.addTag({ name: 'keywords', content: 'Angular, SSR' });<br/>      this.titleService.setTitle('My App!');<br/>  }<br/>}</span></pre><p id="9732" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果您运行这个页面，您将再次检索到以下内容。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/79acb5fd32006f8edf42844c9e49eaf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpTJrbfOtvUCx8aFRe9B0w.png"/></div></div></figure><p id="4295" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">另一方面，从浏览器检查DOM最终会包含应用程序的所有内容。这包括您在<code class="fe lz ma mb mc b">app-root</code>组件中添加的meta和title标签。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/15060cc47f1969a56eb04fbfb70324a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcuZhx9W6K3s_AuTyShtkw.png"/></div></div></figure><p id="3c1b" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如你所见，浏览器是这个过程中能够编译你的Angular代码的关键角色。</p><h2 id="efdc" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">SSR的利与弊</h2><p id="d797" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">因为代码在服务器中编译，所以对于低性能设备来说这是一个胜利。服务器可以完成所有繁重的工作，因此您的用户设备不必做这些工作。</p><p id="56b1" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这种方法的另一个大赢家是搜索引擎优化(SEO)。当搜索引擎抓取你的网站时，你页面的所有内容都会在第一次加载时出现。SEO和SSR配合使用效果更好。</p><p id="e05c" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">另一方面，如果您预计服务器上会出现高流量高峰，那么您可能最终需要一个性能更高的服务器。这可能最终导致更高的成本，或者，如果您没有考虑这些峰值，在低性能的服务器上。</p><p id="b2f3" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">因为您现在必须添加代码来使您的页面进行SSR，所以您的代码库将会更加复杂。此外，这会导致更大的代码库。</p><h2 id="dfe3" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">企业社会责任的利弊</h2><p id="e930" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">CSR的缺点与SSR的优点正好相反。它对搜索引擎优化不友好，性能差的设备不会从中受益，因为它们必须为编译你的页面做所有艰苦的工作。</p><p id="01f1" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">关于CSR的好处，你的应用程序会更简单，因为你不需要更多的代码。除此之外，在使用CSR时，前端代码有更多的重用空间。这样做的原因是，如果您有几个跨组件共享的JavaScript文件，这些文件将被缓存在浏览器中。</p><h2 id="7dfe" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">将角度应用转换为SSR</h2><p id="2f8f" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">让我们来看一下将您的应用程序转换为服务器端呈现所需的步骤。这是一个非常简单的过程。从Angular 10开始，您只需要运行以下命令。</p><pre class="me mf mg mh gt mj mc mk ml aw mm bi"><span id="db5a" class="kd ke iq mc b gy mn mo l mp mq">ng add @nguniversal/express-engine</span></pre><p id="b664" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">运行该命令后，您会看到生成了一些文件。如果你去<code class="fe lz ma mb mc b">package.json</code>，你会看到有新的脚本被添加。这些脚本是<code class="fe lz ma mb mc b">dev:ssr</code>、<code class="fe lz ma mb mc b">serve:ssr</code>、<code class="fe lz ma mb mc b">build:ssr</code>和<code class="fe lz ma mb mc b">prerender</code>。</p><p id="a452" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果您想构建并运行您的应用程序，运行<code class="fe lz ma mb mc b">npm run dev:ssr</code>。您的应用程序将在端口4200上运行。</p><p id="0034" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果您在终端<code class="fe lz ma mb mc b">curl http://localhost:4200</code>上运行，您将会看到您的页面内容，就好像您是从浏览器中查看一样。服务器端渲染来拯救这里！</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/6616e62a17f0ed6707250ad62eb45f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UERsR-arHtnhKu4UoxEweQ.png"/></div></div></figure><p id="3a72" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">既然您的应用程序可以进行服务器端呈现，您就可以利用它现在为您的应用程序带来的所有好处。</p><p id="ed65" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">根据我的个人经验，我已经注意到在我换成SSR的应用上有更好的SEO结果。但是，与此同时，我经历了拥有一个高性能web应用程序的额外服务器成本。</p><p id="a04f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">希望这篇文章能帮助你清楚地了解CSR和SSR的利弊。尽情享受吧！</p><h2 id="c8d9" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">资源</h2><div class="mt mu gp gr mv mw"><a href="https://angular.io/guide/universal" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">有角的</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">Angular是一个构建移动和桌面web应用程序的平台。加入数百万开发者的社区…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">angular.io</p></div></div></div></a></div></div></div>    
</body>
</html>