<html>
<head>
<title>Creating 3d Animated Gradient Effects with Javascript and WebGL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Javascript和WebGL创建3d动画渐变效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-an-animated-html5-canvas-gradient-effect-62e7f84d7c2f?source=collection_archive---------4-----------------------#2020-11-15">https://javascript.plainenglish.io/making-an-animated-html5-canvas-gradient-effect-62e7f84d7c2f?source=collection_archive---------4-----------------------#2020-11-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jk jl jm jn"><div class="bz fp l di"><div class="jo jp l"/></div></figure><p id="9e44" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">我最近对渐变背景很感兴趣。大部分卖产品的网站都是相对静态的，带点活的可以帮助提高转化率。最近，我试图创造一个引人注目的渐变效果，作为我正在做的一个项目网站的背景。我想要的效果应该是a)简单，b)随机，c)微妙。<a class="ae ko" href="https://github.com/smpnjn/webgl-gradient" rel="noopener ugc nofollow" target="_blank">最终结果可以在这里找到。</a></p><figure class="kq kr ks kt gt jn gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi kp"><img src="../Images/7aa68189f7c9e729a84414d989c27a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SB25DH2CbTjkyhCcKEzIuw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">A single frame from the gradient animation</figcaption></figure><p id="b305" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">所以我开始了，像任何人一样有一个基本的CSS渐变。CSS渐变曾经是一项相当新的技术，但现在得到了主流浏览器的广泛支持，但对于仍在使用Internet Explorer的人来说，拥有一个背景标签作为备份总是好的。</p><pre class="kq kr ks kt gt le lf lg lh aw li bi"><span id="de81" class="lj lk in lf b gy ll lm l ln lo"><strong class="lf io">background: rgba(0,0,0,1);<br/>background: linear-gradient(315deg, rgba(0,0,0,1) 0%, rgba(255,255,255,1),1) 100%);</strong></span></pre><p id="b42b" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">那么很容易——我想——我会写一个简单的JavaScript函数来替换上面的rgba数字。这很容易做到——但这是一场灾难，所以我不会在这里分享结果。我的第二个尝试是用混合模式在HTML画布上移动圆圈。这更有希望，但同样，这并不完全是我所追求的。</p><p id="b46b" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">最后，受够了，我决定进入第三维度，使用three.js</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="622b" class="lw lk in bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">入门—three.js</h1><p id="c6e1" class="pw-post-body-paragraph jq jr in js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn ig bi translated">我在这个实验中使用three.js，因为它使WebGL变得非常容易。首先，我在同一个文件夹中创建了一个名为index.html的新文件和一个名为script.js的文件。在index.html，粘贴下面的空心HTML结构。</p><pre class="kq kr ks kt gt le lf lg lh aw li bi"><span id="3e8c" class="lj lk in lf b gy ll lm l ln lo">&lt;!DOCTYPE html&gt;</span><span id="7906" class="lj lk in lf b gy my lm l ln lo">&lt;html&gt;</span><span id="e5f3" class="lj lk in lf b gy my lm l ln lo">&lt;head&gt;</span><span id="9ef4" class="lj lk in lf b gy my lm l ln lo">    &lt;title&gt;The best gradient effect of your life&lt;/title&gt;</span><span id="dd50" class="lj lk in lf b gy my lm l ln lo">    &lt;script src="script.js"&gt;&lt;/script&gt;</span><span id="cb78" class="lj lk in lf b gy my lm l ln lo">&lt;/head&gt;</span><span id="b8db" class="lj lk in lf b gy my lm l ln lo">&lt;body&gt;</span><span id="6604" class="lj lk in lf b gy my lm l ln lo">&lt;/body&gt;</span><span id="c0ca" class="lj lk in lf b gy my lm l ln lo">&lt;/html&gt;</span></pre><h1 id="484e" class="lw lk in bd lx ly mz ma mb mc na me mf mg nb mi mj mk nc mm mn mo nd mq mr ms bi translated">概念</h1><p id="adff" class="pw-post-body-paragraph jq jr in js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn ig bi translated">如果你对WebGL一无所知的话，它是一个非常强大的概念，在我开始渐变填充之旅之前我也不知道。据我所知，一个成功的WebGL基本上有三个部分——两个着色器和一点JavaScript来操纵生成的形状。</p><h2 id="4457" class="lj lk in bd lx ne nf dn mb ng nh dp mf kb ni nj mj kf nk nl mn kj nm nn mr no bi translated">什么是着色器？</h2><p id="7309" class="pw-post-body-paragraph jq jr in js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn ig bi translated">正如我们在这里所描述的，着色器本质上是调整3D渲染输出的功能。它们是在屏幕上以3D形式呈现某些内容时发生的任务流水线的一部分。</p><p id="79c3" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">其中一个着色器叫做<strong class="js io">顶点着色器</strong>——这将调整页面上的每个‘顶点’点。它基本上对每个点进行迭代，并根据函数中的内容进行调整。另一个是<strong class="js io">片段着色器</strong>。把这想象成调整页面上每个点的颜色。</p><p id="2b6f" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">着色器不是用JavaScript编写的，它是用GLSL编写的，这是一种类似C的语言，由three.js直接传递给你的GPU。你可以将这些直接粘贴到HTML页面的<code class="fe np nq nr lf b">&lt;body /&gt;</code>中。正如有人习惯用JavaScript编写的那样，这些着色器看起来很奇怪，但它基本上可以分解成几个关键部分。</p><ul class=""><li id="17e3" class="ns nt in js b jt ju jx jy kb nu kf nv kj nw kn nx ny nz oa bi translated">snoise()或simplex noise 是我们两个着色器中用于生成噪声或随机顶点的函数。你会看到这是如何工作的，但在我们的顶点着色器中，我们调整每个点的x和z位置来创建一个类似布料的效果。我是怎么想出这个的？事实证明，许多人以前都尝试过这种方法。在这里查看你所有的着色器噪波函数:<a class="ae ko" href="https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/patricio Gonzalez vivo/670 c22 f 3966 e 662 D2 f 83</a></li><li id="040d" class="ns nt in js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated"><strong class="js io">统一变量</strong>是我们可以用three.js直接从JavaScript实时操纵的变量。我们在下面的代码中定义它们，简单地通过在JavaScript中更新它们，我们将更新页面上的3D形状(这是这个实验中最酷的发现)</li><li id="5af6" class="ns nt in js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated"><strong class="js io"> gl_Position </strong>和<strong class="js io"> gl_FragColor </strong>是保留变量，控制我们着色器的最终输出。</li><li id="bd57" class="ns nt in js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated"><strong class="js io"> vUv </strong>和<strong class="js io"> uv </strong>是携带我们当前正在调整的顶点信息的变量。</li></ul><p id="9be5" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">了解更多信息的最佳方式是下载本文中的文件，并尝试更改着色器和JavaScript中的一些内容。下面是着色器的最终输出，您可以将其直接粘贴到HTML的主体中:</p><figure class="kq kr ks kt gt jn"><div class="bz fp l di"><div class="og jp l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">The shader code is in the HTML, although can be pulled into Javascript through any means (for example, a variable containing the code within the Javascript itself)</figcaption></figure><h1 id="8614" class="lw lk in bd lx ly mz ma mb mc na me mf mg nb mi mj mk nc mm mn mo nd mq mr ms bi translated">Java Script语言</h1><p id="b6c4" class="pw-post-body-paragraph jq jr in js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn ig bi translated">我已经在顶部的codepen中导入了Three.js文件，只要记住，如果你想这样做，你必须在服务器上有你的代码。你不能只在浏览器中打开文件。为此，您也可以使用自己计算机的本地主机。</p><p id="16b3" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">要想更好地了解这三个工具，您可以查看这三个文档。本质上，我们需要创建一个摄像头(用于查看)、一个渲染器(用于将所有内容显示在屏幕上)和一个场景(用于放置对象)。然后，我们将在场景中放置一个薄片或矩形。</p><p id="1cfb" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">这就是统一变量的用武之地。我们将在JavaScript中定义它们，然后我们可以更新它们来改变JavaScript的呈现过程。我们在这里有一些其他的实用函数，所以请在codepen中或者在最后的git中查看完整的代码以获得更多的信息。</p><figure class="kq kr ks kt gt jn"><div class="bz fp l di"><div class="og jp l"/></div></figure><p id="f996" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">如果你调整第42行，multiplyScalar(5)到multiplyScalar(1)，你可以完全看到物体，而不用大规模放大。这将让你知道这是如何工作的，因为你会看到它只是一张被扭曲的纸，而渐变中产生的锐线实际上只是纸的一部分与自身重叠。</p><p id="628a" class="pw-post-body-paragraph jq jr in js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ig bi translated">好了——现在是<strong class="js io">动画</strong>。我们将使用JavaScript动画帧，因为这个过程可能会变得相当CPU/GPU密集型。同样，这里的代码很少，我们可以重新渲染场景，并为requestAnimationFrame()生成的每一帧更新其值。</p><figure class="kq kr ks kt gt jn"><div class="bz fp l di"><div class="og jp l"/></div></figure><h1 id="a5ef" class="lw lk in bd lx ly mz ma mb mc na me mf mg nb mi mj mk nc mm mn mo nd mq mr ms bi translated">结论</h1><p id="2143" class="pw-post-body-paragraph jq jr in js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn ig bi translated">当我开始这样做时，我知道我想要产生的效果，但不知道如何去做。你可以对这种效果进行应用和调整，为网站背景、标题元素或任何类似的东西提供很大的灵活性。</p><h2 id="2f28" class="lj lk in bd lx ne nf dn mb ng nh dp mf kb ni nj mj kf nk nl mn kj nm nn mr no bi translated">相关链接</h2><ul class=""><li id="20a7" class="ns nt in js b jt mt jx mu kb oh kf oi kj oj kn nx ny nz oa bi translated"><a class="ae ko" href="https://github.com/smpnjn/webgl-gradient" rel="noopener ugc nofollow" target="_blank"> Github回购</a></li><li id="c75c" class="ns nt in js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated"><a class="ae ko" href="https://codepen.io/smpnjn/pen/pobGMKp" rel="noopener ugc nofollow" target="_blank"> Codepen演示</a></li><li id="a962" class="ns nt in js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated"><a class="ae ko" href="https://threejs.org/docs/index.html#manual/en/introduction/Creating-a-scene" rel="noopener ugc nofollow" target="_blank"> Three.js文档</a></li></ul></div></div>    
</body>
</html>