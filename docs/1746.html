<html>
<head>
<title>GraphQL Mutation &amp; Subscription</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraphQL变异和订阅</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/graphql-mutation-subscription-4f9b6f086d9d?source=collection_archive---------9-----------------------#2020-04-18">https://javascript.plainenglish.io/graphql-mutation-subscription-4f9b6f086d9d?source=collection_archive---------9-----------------------#2020-04-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f620" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">理解GraphQL的基本和高级概念</h2></div><blockquote class="kc kd ke"><p id="d76b" class="kf kg kh ki b kj kk jo kl km kn jr ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated"><strong class="ki io"> GraphQL </strong>通俗地说就是一种带有运行时的查询语言，使用API来查询现有数据，客户端有权力询问到底需要什么。这使得API随着时间的推移而进化。更多可以在这里了解到<a class="ae lc" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><p id="9416" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">在本文中，我们将讨论如何使用<strong class="ki io">突变</strong>和<strong class="ki io">订阅</strong>类型来操作和观察数据的变化。</p><h2 id="46db" class="lg lh in bd li lj lk dn ll lm ln dp lo ld lp lq lr le ls lt lu lf lv lw lx ly bi translated">变化</h2><p id="1736" class="pw-post-body-paragraph kf kg in ki b kj lz jo kl km ma jr ko ld mb kr ks le mc kv kw lf md kz la lb ig bi translated">在使用GraphQL时，我们需要通过编辑、删除和添加数据来更改数据，这可以使用mutation来完成。处理<strong class="ki io"> CUD </strong>操作是GraphQL的核心特性。下面的代码用来给<strong class="ki io">添加</strong>数据。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/7181b4ef1704c4df212fc756a4be6a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANrJLeBV6_R4UAIWnaZDRw.png"/></div></div></figure><p id="68ac" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">所有的变异都将在<strong class="ki io">类型变异</strong>下定义，就像查询在<strong class="ki io">类型查询下定义一样。</strong>客户端将向用户发送不可为空的数据，数据保存后将接收一个新用户。类型<strong class="ki io">输入</strong>是构造操作参数的一种高级方法。请记住，自定义类型不能成为变异中参数列表的一部分。</p><p id="5b52" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">接下来，定义一个<strong class="ki io">解析器</strong>方法作为变异，就像我们在<strong class="ki io">查询</strong>中定义解析器一样，然后实现这个方法。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mq"><img src="../Images/e3d3a1842bc36bff15ddf50f9a6156f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qK48s5_1LhJBESk77aqn-g.png"/></div></div></figure><p id="0fe3" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">对于<strong class="ki io">删除</strong> a数据，我们必须遵循在类型<strong class="ki io">变异</strong>中定义方法并在解析器中实现它的相同过程。我们可以相应地修改删除代码，因为我使用了一个静态用户列表来存储数据。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mr"><img src="../Images/684cbc4c0ff2d688621b2dadb61bea13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xFiKq8ABgs8Uw6Uzn4pAQ.png"/></div></div></figure><p id="fcd9" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">对于<strong class="ki io">更新</strong>数据，我们必须遵循相同的步骤，即在类型<strong class="ki io">变异</strong>中定义方法，并在<strong class="ki io">解析器</strong>中实现方法。对于这个例子，我修改了代码并使用GraphQL上下文来传递数据的静态列表(<strong class="ki io"> db </strong>)，使用了输入类型<strong class="ki io"> UpdateUserInput </strong>，它不应该为null，因为用户可以更新一些或所有参数，并使用了析构运算符。看看吧:)</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ms"><img src="../Images/f34fab369c1a3014460b43ece4ae95e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htPTUFN__rHAxePxHzC6aA.png"/></div></div></figure></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><h2 id="d8fd" class="lg lh in bd li lj lk dn ll lm ln dp lo ld lp lq lr le ls lt lu lf lv lw lx ly bi translated">捐款</h2><p id="4a4f" class="pw-post-body-paragraph kf kg in ki b kj lz jo kl km ma jr ko ld mb kr ks le mc kv kw lf md kz la lb ig bi translated">顾名思义，我们可以订阅数据更改，这允许我们与客户端和服务器进行实时通信。假设我们必须创建一个用户，为此我们将触发一个<strong class="ki io"> createUser API </strong>并创建用户，但是当将来这个用户数据被修改或删除时会发生什么，没有办法得到通知。我们必须启动相同的<strong class="ki io"> getUser </strong> <strong class="ki io"> API </strong>查询来获取更新的数据。<strong class="ki io">订阅</strong>是为了拯救，它在后台使用web sockets，使用客户端和服务器之间的开放通信通道，这可以用于聊天应用程序、实时订购应用程序等等。在本例中，我们必须订阅用户，因此当与任何用户相关的数据发生变化时，服务器会向所有订阅的客户端发送一条消息，该消息可以在UI中呈现。让我们看看它的运行情况；)</p><blockquote class="kc kd ke"><p id="aa0f" class="kf kg kh ki b kj kk jo kl km kn jr ko kp kq kr ks kt ku kv kw kx ky kz la lb ig bi translated">在这个例子中，我使用全功能的GraphQL服务器<a class="ae lc" href="https://github.com/prisma-labs/graphql-yoga" rel="noopener ugc nofollow" target="_blank"> <strong class="ki io"> GraphQL-Yoga </strong> </a>。我将使用<a class="ae lc" href="https://github.com/apollographql/graphql-subscriptions" rel="noopener ugc nofollow" target="_blank"><strong class="ki io">graph QL-Subscription</strong></a>库，帮助使用publibsubutility的整个应用程序进行通信。这可以通过在应用程序的上下文中重新注册PubSub对象来完成。</p></blockquote><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi na"><img src="../Images/8c8dc3b4aa19c9cf1d219613ef88b388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WR5R3jeLXyu03M9L00Us2Q.png"/></div></div></figure><h2 id="2dfb" class="lg lh in bd li lj lk dn ll lm ln dp lo ld lp lq lr le ls lt lu lf lv lw lx ly bi translated">代码解释</h2><p id="b7f7" class="pw-post-body-paragraph kf kg in ki b kj lz jo kl km ma jr ko ld mb kr ks le mc kv kw lf md kz la lb ig bi translated">用户方法有一个只有一个方法的对象。每次客户端订阅用户时，这个subscribe方法都会运行。这个方法将保持所有前面的4个属性作为变异解析器方法。因为我们已经在GraphQL上下文中绑定了pubsub方法，所以我们可以析构它并使用它的<strong class="ki io"> asyncIterator </strong>方法，该方法只有一个参数通道名。一旦订阅，它将开始监听发布的数据。通道名必须是唯一的，我们可以从数据已经改变的突变方法中发布它，如<strong class="ki io"> createUser </strong>、<strong class="ki io"> deleteUser </strong>和<strong class="ki io"> updateUser </strong>。publish方法将通道名称和要发布的对象作为属性。我们在发布的数据上增加了一个<strong class="ki io">突变</strong>属性，用于跟踪CUD操作类型，并增加了<strong class="ki io">数据</strong>属性，用于发送修改后的数据。</p></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><p id="d49e" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">我在本文中使用了GraphQL节点客户端，而<a class="ae lc" href="https://www.npmjs.com/package/uuid" rel="noopener ugc nofollow" target="_blank"> uuid </a>是获取唯一id的节点插件。请在这里填写自由玩代码<a class="ae lc" href="https://github.com/GanjuV/GraphQL-Mutation-Subscription.git" rel="noopener ugc nofollow" target="_blank"/></p><p id="c573" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">不断学习，不断探索。<br/>快乐编码，尽情享受！</p><h2 id="0105" class="lg lh in bd li lj lk dn ll lm ln dp lo ld lp lq lr le ls lt lu lf lv lw lx ly bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="4801" class="pw-post-body-paragraph kf kg in ki b kj lz jo kl km ma jr ko ld mb kr ks le mc kv kw lf md kz la lb ig bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae lc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ki io">AI in Plain English</strong></a><a class="ae lc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ki io">UX in Plain English</strong></a><a class="ae lc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ki io">Python in Plain English</strong></a><strong class="ki io"/>——谢谢，继续学习！</p><p id="b7b4" class="pw-post-body-paragraph kf kg in ki b kj kk jo kl km kn jr ko ld kq kr ks le ku kv kw lf ky kz la lb ig bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae lc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ki io">submissions @ plain English . io</strong></a><strong class="ki io"/>，并附上您的Medium用户名，我们会将您添加为作者。此外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>