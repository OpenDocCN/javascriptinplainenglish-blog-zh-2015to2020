<html>
<head>
<title>Making This Amazing Earth Effect with JavaScript and WebGL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript和WebGL制作这个神奇的地球效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-this-amazing-earth-effect-with-javascript-and-webgl-f3a342133edf?source=collection_archive---------5-----------------------#2020-12-10">https://javascript.plainenglish.io/making-this-amazing-earth-effect-with-javascript-and-webgl-f3a342133edf?source=collection_archive---------5-----------------------#2020-12-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jk jl jm jn"><div class="bz fp l di"><div class="jo jp l"/></div><figcaption class="jq jr gj gh gi js jt bd b be z dk">Demo of the effect</figcaption></figure><p id="c730" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">所以有一天我在摆弄球体和纹理，偶然发现了一些非常惊人的例子，人们用纹理把一个球体弄得非常尖。这让我想到了地球上的山脉，以及它们在WebGL中的样子。在本教程中，我们将学习如何创造世界，但会使用极其夸张的地理环境。</p><p id="cbba" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">我想涵盖三个。js)本教程的主要内容</p><ul class=""><li id="00be" class="ks kt in jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><strong class="jw io">着色器</strong>如何在高层次上工作</li><li id="4831" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">如何创建<strong class="jw io">高度图</strong></li><li id="7a12" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">如何<strong class="jw io">跨JS和着色器</strong>使用形状 <strong class="jw io"/></li></ul><figure class="lh li lj lk gt jn gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lg"><img src="../Images/0f6dc599223d1b7e3af83eb8e6d35ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49yICvGtp2GF0zd0NupMFw.png"/></div></div></figure></div><div class="ab cl lr ls hr lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ig ih ii ij ik"><h1 id="4104" class="ly lz in bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">第一步:美国宇航局，不，真的</h1><figure class="lh li lj lk gt jn gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mw"><img src="../Images/76e829814da290b8bc488ee949f7e212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*497KtV5qI8zFChFidmdYaQ.png"/></div></div></figure><p id="a410" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">所以你要做的第一件事就是去美国国家航空航天局找到他们的地球高度图。美国宇航局在地球上实际上有大量的数据资源，比如海洋深度图，但也许那是未来的项目。</p><p id="9eea" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">下一步是移除海洋。说起来容易做起来难——我必须找到前面提到的海洋地图，减去海洋，因为在海平面上，美国宇航局的高度图完全是黑色的，很难区分。我在Photoshop中做了这个，但是在git存储库中也有，所以你甚至不用做这个。</p><h2 id="7c85" class="my lz in bd ma mz na dn me nb nc dp mi kf nd ne mm kj nf ng mq kn nh ni mu nj bi translated">但是我们为什么需要这张地图呢？</h2><p id="2c68" class="pw-post-body-paragraph ju jv in jw b jx nk jz ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr ig bi translated">所以这张地图上每个像素的黑暗程度代表了它离海平面有多近。我们可以获取这些数据，并使用着色器，将像素转换到不同的高度。我们可以让山更高，让地更低，我们甚至可以用这些数据来改变像素的颜色。很酷，对吧？</p><h1 id="db4e" class="ly lz in bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">步骤2: Three.js</h1><p id="a720" class="pw-post-body-paragraph ju jv in jw b jx nk jz ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr ig bi translated">Three.js是一个3D WebGL包，可以帮助你更容易地完成WebGL。<strong class="jw io">什么是WebGL？</strong>这是我们在网络上制作3D东西的方式，也是一种网络标准。</p><h2 id="a93f" class="my lz in bd ma mz na dn me nb nc dp mi kf nd ne mm kj nf ng mq kn nh ni mu nj bi translated">我们如何用我们的地球纹理创建一个球体？</h2><p id="54ca" class="pw-post-body-paragraph ju jv in jw b jx nk jz ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr ig bi translated">首先我们需要从<strong class="jw io"> three.js </strong>导入适当的包。您可以创建一个名为script.js的新文件，并添加以下代码。<em class="nu">注意——导入只能在服务器上运行，所以你不能只打开index.html就指望它能运行，你需要在你的本地主机上运行它。</em></p><figure class="lh li lj lk gt jn"><div class="bz fp l di"><div class="nv jp l"/></div></figure><p id="5b58" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">好了，现在我们开始吧。所有这些都将在DOM加载后开始，但是我们将使用三个来构建。我没有包括下面所有的代码——你可以在codepen或git repo中找到——但是有几个要点需要注意:</p><ul class=""><li id="aaeb" class="ks kt in jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><strong class="jw io">在第13行，</strong>我已经把多边形的数量设置为1024。这需要一点时间来加载，但对于我们想要的效果来说，多边形越多越好。如果你愿意，你可以在测试期间减少1024以加快加载速度。</li><li id="93d9" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw io">在第15行</strong>，我们提到了‘制服’。这些是我们可以在Javascript中编辑的变量，但是会传递给着色器。我们将使用着色器来制作我们稍后讨论过的高度贴图。</li><li id="f205" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw io">在第19行</strong>我们提到了纹理，这是我们对地球的描述。</li><li id="0a29" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw io">在第21/22行</strong>，我们提到了着色器。这些都在HTML文档中，并且是用类似C语言编写的</li><li id="0153" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">在第45行我们更新了球体的旋转。这是实时发生的，您可以从Javascript更新几乎任何您想要的属性，这给了您很大的灵活性。</li></ul><figure class="lh li lj lk gt jn"><div class="bz fp l di"><div class="nv jp l"/></div></figure><h1 id="77b4" class="ly lz in bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">步骤3:着色器</h1><figure class="lh li lj lk gt jn gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/8b65810559b6b8e6ab62fa888dc4d3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oedi3IdGdfPMrBz2R7iCtw.jpeg"/></div></div></figure><p id="a522" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">着色器是大多数Javascript开发人员可能会遇到的问题。它们有自己的语言，需要稍加研究才能掌握，但它们存储在HTML文档中的<script>标记内，应该很熟悉。&lt;/root&gt;</script></p><p id="d317" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">简单地说，<strong class="jw io">我们有两个着色器</strong> — <strong class="jw io">顶点着色器</strong>，它改变形状上的每个像素，还有<strong class="jw io">片段着色器</strong>，它改变像素的颜色。</p><p id="8f25" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">我们的顶点着色器是相对简单的</p><ul class=""><li id="183f" class="ks kt in jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><strong class="jw io">在第1行</strong>上，我们有vUv，这是我们当前所在像素的坐标。我们可以做vUv.x和vUv.y来得到我们的(x，y)坐标</li><li id="0ba7" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw io">在第7行</strong>，我们从‘gettexture 1’变量导入纹理。这在之前的Javascript变量中被定义为统一的(见上文)。我们可以从中获得大量数据——x、y和z坐标，以及r、g、b和a颜色细节。在着色器中，每种颜色都在1之外，所以应该是0到1之间的数字。</li><li id="c13f" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw io">在第8行</strong>，我们获取红色数据和阿尔法数据，并将其乘以20。那有什么用？它计算一个点有多红(在我们的例子中表示它有多黑)，以及它有多透明。所以透明元素将为0，总位移将等于0。对于非常白的区域，bumpData将为1，这将给出最大值20。</li><li id="2f60" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw io">在第12行</strong>上，我们将“高度”数据传递到gl_Position，它实际上存储了传递给GPU的所有像素的最终位置。</li></ul><figure class="lh li lj lk gt jn"><div class="bz fp l di"><div class="nv jp l"/></div></figure><p id="cdb2" class="pw-post-body-paragraph ju jv in jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ig bi translated">好的——现在我们所有的像素都正确定位了，让<strong class="jw io">用<strong class="jw io">片段着色器</strong>给它们正确着色。我们将使用与之前相同的技巧，唯一的复杂性是我们的Javascript颜色的统一值是255中的rgb值——所以我们创建了一个函数，将它们除以255，得到1的值。我们也为完全透明的像素返回不同的颜色(例如水)。</strong></p><figure class="lh li lj lk gt jn"><div class="bz fp l di"><div class="nv jp l"/></div></figure><h1 id="af74" class="ly lz in bd ma mb np md me mf nq mh mi mj nr ml mm mn ns mp mq mr nt mt mu mv bi translated">结论</h1><p id="789b" class="pw-post-body-paragraph ju jv in jw b jx nk jz ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr ig bi translated">这就是我们看到的，一个有人造高峰旋转的冰冷世界。要了解更多信息，您可以查看three.js文档。我还建议更新Javascript中的一些数字和<strong class="jw io"> </strong>统一颜色变量，看看你最终会得到什么。你可以做的另一个很酷的技巧是<strong class="jw io">把开花调到最大</strong>来获得一些非常奇妙的效果</p><h2 id="173a" class="my lz in bd ma mz na dn me nb nc dp mi kf nd ne mm kj nf ng mq kn nh ni mu nj bi translated">相关链接</h2><ul class=""><li id="aea0" class="ks kt in jw b jx nk kb nl kf nx kj ny kn nz kr kx ky kz la bi translated"><a class="ae mx" href="https://github.com/smpnjn/webgl-globe" rel="noopener ugc nofollow" target="_blank"> Github回购</a></li><li id="11d0" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><a class="ae mx" href="https://codepen.io/smpnjn/pen/vYXXjOZ" rel="noopener ugc nofollow" target="_blank"> Codepen演示</a></li><li id="90a4" class="ks kt in jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><a class="ae mx" href="https://threejs.org/docs/" rel="noopener ugc nofollow" target="_blank"> Three.js文档</a></li></ul></div></div>    
</body>
</html>