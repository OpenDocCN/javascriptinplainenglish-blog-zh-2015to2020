<html>
<head>
<title>How to Persist State with localStorage in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular中用本地存储持久化状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-persist-state-with-localstorage-in-angular-42a4a47ed123?source=collection_archive---------1-----------------------#2020-11-11">https://javascript.plainenglish.io/how-to-persist-state-with-localstorage-in-angular-42a4a47ed123?source=collection_archive---------1-----------------------#2020-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9441" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个简单的状态存储实现</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9fb1c4815082558c06f22d769cf4fc2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kGTO8bTqlfkXyD25"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@steve_j?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Steve Johnson</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c00c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将向您展示如何使用web浏览器的存储在Angular中实现简单的状态持久化功能。这将允许您保存对应用程序很重要的设置或某些值。</p><p id="8efc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现这个功能，我们将利用JavaScripts的localStorage。但不是像普通JavaScript那样直接调用localStorage。我们将创建一个简单的服务包装器来封装localStorage功能。一切都干净简单。</p><p id="074f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们进入代码之前，请允许我简单介绍一下localStorage。</p><h1 id="f758" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">背景</h1><p id="ea0d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">localStorage是一个允许您使用浏览器的文档对象访问和存储数据的系统。</p><p id="d74d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据以键-值对的形式存储，键和值使用UTF-16 DOMString格式。</p><p id="20cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过localStorage存储的数据在浏览器会话中保持不变。</p><h2 id="1cb3" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">本地存储剖析</h2><p id="5fed" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">localStorage基本上有四个主要功能，我们将在服务包装器中实现它们。</p><ul class=""><li id="68cb" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">localStorage.setItem('key', 'value')</code> -允许您在浏览器存储器中存储一个项目</li><li id="3bf2" class="nb nc iq ky b kz no lc np lf nq lj nr ln ns lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">localStorage.getItem('key')</code> -允许您从浏览器存储器中读取指定关键项目的值。</li><li id="83ee" class="nb nc iq ky b kz no lc np lf nq lj nr ln ns lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">localStorage.removeItem('key')</code> -允许您从浏览器存储器中移除/删除带有指定键的项目。</li><li id="412f" class="nb nc iq ky b kz no lc np lf nq lj nr ln ns lr ng nh ni nj bi translated"><code class="fe nk nl nm nn b">localStorage.clear()</code> -移除仓库中的所有物品</li></ul><h1 id="5202" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建角度应用程序</h1><p id="5981" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对于那些想跟进的人，我们将使用Angular CLI和下面的命令创建一个starter Angular应用程序。</p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="5c2c" class="mp lt iq nn b gy nx ny l nz oa">ng new local-storage-app --defaults</span></pre><h1 id="2d81" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建服务包装</h1><p id="1080" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">创建应用程序后，您可以通过在项目的根文件夹中运行下面的CLI命令来创建包含我们的localStorage功能的服务。</p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="65d7" class="mp lt iq nn b gy nx ny l nz oa">ng g s local-storage</span></pre><p id="92c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将以下代码复制并粘贴到我们刚刚创建的服务文件中。该服务只是包装了localStorage提供的默认功能。</p><p id="6fab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，您就有了一个功能的中心位置。</p><p id="9b73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">T5【本地存储服务】tsT7】</strong></p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="bb26" class="mp lt iq nn b gy nx ny l nz oa">import { Injectable } from '@angular/core';</span><span id="e191" class="mp lt iq nn b gy oc ny l nz oa">@Injectable({<br/>    providedIn: 'root'<br/>})</span><span id="33d2" class="mp lt iq nn b gy oc ny l nz oa">export class LocalStorageService {<br/>  constructor() { }<br/>  public setItem(key: string, value: string) {<br/>    localStorage.setItem(key, value);<br/>  }<br/>    <br/>  public getItem(key: string){ <br/>    return localStorage.getItem(key)<br/>  }</span><span id="3cdb" class="mp lt iq nn b gy oc ny l nz oa">  public removeItem(key:string) {<br/>    localStorage.removeItem(key);<br/>  }</span><span id="7e6e" class="mp lt iq nn b gy oc ny l nz oa">  public clear(){<br/>    localStorage.clear(); <br/>  }</span><span id="ecf4" class="mp lt iq nn b gy oc ny l nz oa">}</span></pre><p id="fe49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>为了简单起见，我用等价的localStorage函数来命名我们服务中的函数。请随意根据您的喜好进行重命名。</p><h1 id="4573" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在组件中使用服务</h1><p id="2e16" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要在应用程序的任何组件中使用本地存储服务，我们只需导入服务，然后通过依赖注入在构造函数中注入它。</p><p id="e767" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与服务包装器提供的功能进行交互。我将创建一个简单的用户界面，允许您输入和存储一个人的详细信息，通过键查询和删除存储的数据。</p><p id="f98b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GUI使用普通的HTML来保持简单。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/f2d1f1821df0df190579fb279161a409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kV--aNd6xrLR7W7e233cNQ.png"/></div></div></figure><p id="0362" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面提供了这个GUI的HTML代码。删除<strong class="ky ir"><em class="ob"/></strong>模板文件中的所有默认代码，替换为下面的代码。</p><p id="dfb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码只是获取用户输入，并使用双向数据绑定来获取组件中的值。单击任何按钮都会触发组件中的必要功能。</p><p id="44c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">【app.component.html】T5<strong class="ky ir">T6</strong></p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="690e" class="mp lt iq nn b gy nx ny l nz oa">&lt;h4&gt; Add person &lt;/h4&gt;<br/>  &lt;table&gt;<br/>    &lt;tr&gt;<br/>      &lt;td&gt;Firstname&lt;/td&gt;<br/>     &lt;td&gt; &lt;input [(ngModel)]="firstname" name="firstname" type="text"&gt;&lt;/td&gt;<br/>   &lt;/tr&gt;</span><span id="8a89" class="mp lt iq nn b gy oc ny l nz oa">   &lt;tr&gt;<br/>     &lt;td&gt;Lastname&lt;/td&gt;<br/>     &lt;td&gt; &lt;input [(ngModel)]="lastname" name="lastname" type="text"&gt;&lt;/td&gt; <br/>   &lt;/tr&gt;</span><span id="e90b" class="mp lt iq nn b gy oc ny l nz oa">  &lt;tr&gt; <br/>    &lt;td&gt;Age&lt;/td&gt; <br/>    &lt;td&gt; &lt;input [(ngModel)]="age" name="age" type="number"&gt;&lt;/td&gt; &lt;/tr&gt;</span><span id="d117" class="mp lt iq nn b gy oc ny l nz oa">&lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;button (click)="addPerson()"&gt;Add&lt;/button&gt;&lt;/td&gt;</span><span id="9cfc" class="mp lt iq nn b gy oc ny l nz oa">&lt;/tr&gt;<br/>&lt;/table&gt;</span><span id="28c7" class="mp lt iq nn b gy oc ny l nz oa">&lt;h4&gt; Get person &lt;/h4&gt;<br/>&lt;input [(ngModel)]="queryKey" name="queryKey" type="text"&gt;&lt;br&gt;<br/>&lt;button (click)="getPerson(queryKey)"&gt; Get &lt;/button&gt;</span><span id="e2e2" class="mp lt iq nn b gy oc ny l nz oa">&lt;h4&gt;Result&lt;/h4&gt;<br/>{{queryResult}}</span><span id="b1d5" class="mp lt iq nn b gy oc ny l nz oa">&lt;h4&gt; Delete person&lt;/h4&gt;<br/>  &lt;input [(ngModel)]="removeKey" name="removeKey" type="text"&gt; &lt;br&gt;<br/>  &lt;button (click)="deletePerson(removeKey)"&gt; Delete &lt;/button&gt;</span><span id="db5b" class="mp lt iq nn b gy oc ny l nz oa">&lt;h4&gt; Reset store &lt;/h4&gt;<br/>&lt;button (click)="reset()"&gt; Reset &lt;/button&gt;</span></pre><p id="e9be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记得导入<strong class="ky ir"> <em class="ob"> FormsModule </em> </strong>并添加到主模块文件<strong class="ky ir"><em class="ob">app . module . ts</em></strong>的imports数组中。我们需要<strong class="ky ir"> <em class="ob"> FormsModule </em> </strong>，因为我们正在使用双向数据绑定。粗体的代码是我添加的。</p><p id="c369" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">T21ts</strong></p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="b9a0" class="mp lt iq nn b gy nx ny l nz oa">import { BrowserModule } from '@angular/platform-browser';<br/>import { NgModule } from '@angular/core';<br/>import { AppComponent } from './app.component';</span><span id="2771" class="mp lt iq nn b gy oc ny l nz oa"><strong class="nn ir">import { FormsModule } from '@angular/forms';</strong></span><span id="dbd2" class="mp lt iq nn b gy oc ny l nz oa">@NgModule({<br/>  declarations: [<br/>    AppComponent<br/>],<br/>imports: [<br/>  BrowserModule,<br/>  <strong class="nn ir">FormsModule</strong><br/>],</span><span id="2856" class="mp lt iq nn b gy oc ny l nz oa">providers: [],</span><span id="cbf6" class="mp lt iq nn b gy oc ny l nz oa">bootstrap: [AppComponent]</span><span id="e531" class="mp lt iq nn b gy oc ny l nz oa">})</span><span id="b91b" class="mp lt iq nn b gy oc ny l nz oa">export class AppModule { }</span></pre><p id="bb0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">模板代码的逻辑在对应的<strong class="ky ir"><em class="ob">app . component . ts</em></strong>文件中实现。代码非常简单。有几个用于双向数据绑定的个人详细信息属性。</p><p id="6965" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后有一个person对象，它被JSON字符串化，存储在浏览器存储器中。我用一个对象简单地展示了可以用localStorage将复杂数据存储为字符串。</p><p id="ca1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我有一些方法来响应按钮点击并调用必要的服务函数。</p><p id="8210" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"><em class="ob">app . component . ts</em></strong>文件的完整代码如下。随意编码或复制粘贴。</p><p id="b18f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">T33】app . component . tsT35】</strong></p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="e3ef" class="mp lt iq nn b gy nx ny l nz oa">import { Component } from '@angular/core';<br/>import { LocalStorageService } from './local-storage.service';</span><span id="4e7a" class="mp lt iq nn b gy oc ny l nz oa">@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})</span><span id="0239" class="mp lt iq nn b gy oc ny l nz oa">export class AppComponent {<br/>  title = 'local-storage-app';<br/>  constructor( private localStorageService: LocalStorageService) {}</span><span id="4413" class="mp lt iq nn b gy oc ny l nz oa">  public firstname: string = '';<br/>  public lastname: string = '';<br/>  public age: number = null;</span><span id="c913" class="mp lt iq nn b gy oc ny l nz oa">  public queryKey: string;<br/>  public removeKey: string;</span><span id="aa55" class="mp lt iq nn b gy oc ny l nz oa">  public queryResult: string;</span><span id="f8ef" class="mp lt iq nn b gy oc ny l nz oa">  public person = {firstName: this.firstname, lastName: this.lastname, age: this.age }</span><span id="cfc2" class="mp lt iq nn b gy oc ny l nz oa">public addPerson(){<br/>  this.person.firstName = this.firstname<br/>  this.person.age = this.age;<br/>  this.person.lastName = this.lastname;<br/>  this.localStorageService.setItem(this.firstname,  JSON.stringify(this.person))<br/>}</span><span id="945f" class="mp lt iq nn b gy oc ny l nz oa"> public getPerson(nameToRemove:string){<br/>  this.queryResult = this.localStorageService.getItem(nameToRemove);<br/>}</span><span id="a215" class="mp lt iq nn b gy oc ny l nz oa">public deletePerson(nameToDelete:string){<br/>   this.localStorageService.removeItem(nameToDelete);<br/>}</span><span id="82d3" class="mp lt iq nn b gy oc ny l nz oa">public reset(){<br/>   this.localStorageService.clear();<br/>}</span><span id="2734" class="mp lt iq nn b gy oc ny l nz oa">}</span></pre><h1 id="108d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为应用服务</h1><p id="e2b8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为浏览器中的应用程序提供服务。只需运行下面的Angular CLI命令。</p><pre class="kg kh ki kj gt nt nn nu nv aw nw bi"><span id="c753" class="mp lt iq nn b gy nx ny l nz oa">ng serve -o</span></pre><p id="c261" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序在默认浏览器中运行后，打开浏览器的开发工具。</p><p id="b309" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加一个人的详细信息，并观察浏览器存储更新。您也可以删除或清除存储。</p><h1 id="7e57" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">查看浏览器存储中的值</h1><p id="5723" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在Chrome中，可以在应用程序选项卡&gt;存储&gt;本地存储下访问localStorage值。如下图。</p><p id="b1cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Firefox中，这些值存储在存储选项卡下，然后是本地存储。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/befbc50264b5c002c2de8596b38e9094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xr5vijULGJTyC8MoHZCojA.png"/></div></div></figure><p id="fb72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面你可以看到数据被保存在浏览器的存储器中，最后被删除。</p><p id="513e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注</strong>:我用过下面的火狐浏览器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/bd6e97a14542f3dba4f867cd552203bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*z-sTZkOVpR1QD139_5-pnw.gif"/></div></figure><h1 id="61ff" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最后的想法</h1><p id="1cb5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">localStorage为您提供了一个以方便和安全的方式存储和持久化应用程序数据的绝佳选择。</p><p id="67ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能考虑存储在浏览器存储器中的一些东西是用户偏好。例如，主题风格和位置特定的偏好。</p></div></div>    
</body>
</html>