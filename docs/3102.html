<html>
<head>
<title>The Ultimate Guide To Integrate AWS Amplify Authentication For React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为React Native集成AWS Amplify身份验证的最终指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-ultimate-guide-for-integrate-aws-amplify-authentication-for-react-native-15a8eec10890?source=collection_archive---------0-----------------------#2020-08-29">https://javascript.plainenglish.io/the-ultimate-guide-for-integrate-aws-amplify-authentication-for-react-native-15a8eec10890?source=collection_archive---------0-----------------------#2020-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fec9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><a class="ae kf" href="https://docs.amplify.aws/" rel="noopener ugc nofollow" target="_blank"> AWS Amplify </a>是一个框架，通过访问AWS提供的后端云服务，你可以快速开发web或移动应用。在本文中，我们将通过构建一个全功能的登录和注册流程来学习如何在React Native中使用AWS Amplify。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/7333d66b51b3b7f410b12ff7728f9985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*989FAOUKEVzwYfhG.png"/></div></div></figure><p id="8617" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><em class="lo">原载于2020年8月29日</em><a class="ae kf" href="https://www.instamobile.io/mobile-development/react-native-aws-amplify/" rel="noopener ugc nofollow" target="_blank"><em class="lo">https://www . insta mobile . io</em></a><em class="lo">。</em></p><p id="7553" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">本教程将介绍移动应用程序最重要的特性之一——身份验证。你知道这个场景。您需要存储一些用户信息(凭证),以便他们可以取回并重用应用程序，而不是创建一个新帐户。</p><p id="e824" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在开始本教程之前，请确保拥有一个AWS帐户。如果没有，<a class="ae kf" href="https://portal.aws.amazon.com/billing/signup?redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start" rel="noopener ugc nofollow" target="_blank">请报名</a>一个。</p><h2 id="03ba" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">什么是AWS Amplify？</h2><p id="cef0" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">Amazon Web Service是一种提供云服务的技术。自2017年推出以来，Amplify在以工具链的形式提供一系列服务方面取得了很大进展。它也是开源的。</p><p id="0757" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要使用Amplify将身份验证构建到React Native和Expo应用程序中，首先需要安装AWS Amplify CLI。打开终端窗口，执行以下命令安装CLI。我们将把它作为一个全局模块来安装。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="4fd2" class="lp lq iq mo b gy ms mt l mu mv">npm install -g @aws-amplify/cli</span></pre><p id="ed02" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">使用Amplify的CLI工具，你会发现几个真正有用的CLI插件和服务，在与React Native等框架集成时，只需点击一下即可启用。诸如GraphQL和REST APIs、身份验证UI以及后端支持、存储、托管等服务都可以通过Amplify的CLI获得。</p><h2 id="f924" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">React Native和AWS Amplify入门</h2><p id="db0d" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">首先创建一个新的应用程序项目。我们将通过Expo CLI生成项目。打开一个终端窗口，创建一个新的React原生应用。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="40d7" class="lp lq iq mo b gy ms mt l mu mv">npx expo-cli init expo-amplify-example</span></pre><p id="1b4a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这个命令创建一个名为<code class="fe mw mx my mo b">expo-amplify-example</code>的新目录。你想叫它什么都可以。在这个目录中，您将发现一个完整的React Native + Expo SDK项目。请注意，在运行上述命令时，CLI会询问您使用哪个模板。本教程使用受管工作流中的<code class="fe mw mx my mo b">blank</code>模板。如果您熟悉任何其他模板，请随意选择。</p><p id="3661" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Expo CLI是一个命令行实用程序，无需构建配置即可创建React本地应用。我们依赖它的原因是，首先，对于这样的用例来说，它是一个非常棒的工具。</p><h2 id="e77a" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">创建新的AWS IAM用户</h2><p id="1595" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">登录AWS帐户后，从终端窗口运行以下命令。此命令要求您登录AWS控制台。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="eca6" class="lp lq iq mo b gy ms mt l mu mv">amplify configure</span></pre><p id="e8ad" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这将打开AWS控制台仪表板。回到终端，按回车键继续。这将引导您回答一系列问题，以便配置一个用户帐户，将Amplify与React本机应用程序一起使用。</p><ul class=""><li id="f41f" class="mz na iq ku b kv kw ky kz lb nb lf nc lj nd ln ne nf ng nh bi translated"><strong class="ku ir">选择一个地区</strong>:美国东部-2</li><li id="7505" class="mz na iq ku b kv ni ky nj lb nk lf nl lj nm ln ne nf ng nh bi translated"><strong class="ku ir">指定新IAM用户的用户名</strong> : expo-amplify</li></ul><p id="01ea" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">输入用户名后，按enter键，AWS控制台将在浏览器窗口中再次打开，供您添加用户。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/61c9d0abce9d3d796650a48b8093bc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hi9V2215xxDu9Io0.png"/></div></div></figure><p id="0f25" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在上面的屏幕中，确保勾选了<strong class="ku ir">编程访问</strong>。它允许新用户以不同的API和工具的形式创建资源，为您提供访问密钥和秘密密钥。然后点击按钮<strong class="ku ir">下一步:权限</strong>。请注意，在下面的屏幕中，默认情况下选择了一个策略。应用默认设置。这通过使AWS用户(您正在创建的当前用户)成为管理员，为您提供了对AWS服务的完全访问权限。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/28c982aa79dae7f5f5cc5a08f13073c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_PhlBmBzSs0NGlgW.png"/></div></div></figure><p id="47ec" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然后，点击<strong class="ku ir">下一步:标签</strong>。当前用例不需要修改。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/9f03ef16ca7aacc05c78f2a632933520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GEyCZs9OGxlyxUVt.png"/></div></div></figure><p id="ab86" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然后，点击<strong class="ku ir">下一步:复习</strong>。同样，不需要修改。点击<strong class="ku ir">创建用户</strong>按钮，您将被定向到一个新页面，在此您可以找到访问密钥和秘密密钥。转到您的终端窗口，按下回车键，并在出现提示时按顺序输入访问键和密钥。它将询问一个配置文件名。您可以在此输入项目名称或用户名。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/4e693d99feeb4df798f2a6a1e65c4bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Acbe8BClR1m-CAh.png"/></div></div></figure><p id="041b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最后一次按enter键创建一个新的AWS用户。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nn"><img src="../Images/f5dde4d715737ff5853ce6de4d30b573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HfVIZzjb3KIsN21O.png"/></div></div></figure><h2 id="babb" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">在React Native中集成AWS Amplify</h2><p id="2fac" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">要使用React Native应用程序初始化AWS Amplify，请运行以下命令，然后提示您更多问题。返回终端窗口，运行如下初始化命令:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="71bb" class="lp lq iq mo b gy ms mt l mu mv">amplify init</span></pre><p id="a1e6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">运行此命令后，系统会提示您一些配置问题。对于当前的演示，我们选择所有默认选项。作为参考，您可以找到问题旁边列出的选项，如下所示:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi no"><img src="../Images/016b7e43504e6debf44acf327491d429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OwxT6O8xF-850g4D.png"/></div></div></figure><p id="dc4e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Amplify SDK初始化过程完成后，请注意项目目录中有一些新的文件更改。一个名为<code class="fe mw mx my mo b">amplify/</code>的存储任何本地或云更改的新目录被添加到React本地项目的根目录中。一个名为<code class="fe mw mx my mo b">aws-exports.js</code>的新文件出现在你没有提交到公共Github库的根目录下。<code class="fe mw mx my mo b">amplify init</code>司令部负责此事。它将更新React本地项目中的<code class="fe mw mx my mo b">.gitignore</code>文件。</p><p id="cdf2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要将Amplify SDK与Expo或React本机应用程序集成，请安装以下依赖项。返回终端窗口并执行命令:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="2c92" class="lp lq iq mo b gy ms mt l mu mv">yarn add aws-amplify aws-amplify-react-native</span></pre><p id="7a68" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">包<code class="fe mw mx my mo b">aws-amplify</code>允许您向AWS提供的auth和API服务发出请求。另一个包<code class="fe mw mx my mo b">aws-amplify-react-native</code>是特定于框架的，包含现成的UI组件。</p><p id="6205" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">安装完这些依赖项后，打开<code class="fe mw mx my mo b">App.js</code>文件并添加以下导入语句。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="0399" class="lp lq iq mo b gy ms mt l mu mv">import config from './aws-exports'; <br/>Amplify.configure(config);</span></pre><p id="0241" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这就是将Amplify与Expo应用程序集成的原因。</p><h2 id="4122" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">添加放大认证资源</h2><p id="b3e6" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">Amplify使用Amazon Cognito进行身份验证。Amazon Cognito是一个功能齐全的用户目录，处理用户注册、登录和帐户恢复。放大与Cognito用户池的接口，以存储用户信息，包括脸书、谷歌等社交提供商。</p><p id="ba8e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要使用Amplify添加用户身份验证，首先从终端窗口运行命令。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="305c" class="lp lq iq mo b gy ms mt l mu mv">amplify add auth</span></pre><p id="e52b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">运行该命令后，系统会提示您以下问题:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="6452" class="lp lq iq mo b gy ms mt l mu mv">Do you want to use the default authentication and security configuration? Default configuration<br/>How do you want users to be able to sign in? Email <br/>Do you want to configure advanced settings? No, I am done.</span></pre><p id="e0a5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">第一个选项是选择默认的身份验证和安全配置。让我们默认。第二种选择是使用身份验证提供者。在我们的例子中，让我们选择<code class="fe mw mx my mo b">Email</code>。您还可以添加脸书或谷歌登录等社交提供商。</p><p id="7485" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在运行以下命令，将所有本地更改发布到AWS，以便创建一个用户池。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="e16b" class="lp lq iq mo b gy ms mt l mu mv">amplify push</span></pre><p id="f5ac" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">执行上述命令后，您会看到以下屏幕。显示当前工作环境<code class="fe mw mx my mo b">dev</code>的详细信息，并显示当前使用的资源<code class="fe mw mx my mo b">Auth</code>的状态。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi np"><img src="../Images/4f4b6fa32aac9cb0d7a305f2c5f2e620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NcB1R-mymUQE7r0l.png"/></div></div></figure><p id="39f0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">执行命令可能需要一些时间来推动更改以启用和创建用户池。使用Amazon Cognito初始化用户身份验证设置完成。</p><h2 id="04fb" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">构建注册和登录用户界面</h2><p id="5edf" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">Amplify附带了一个名为<code class="fe mw mx my mo b">withAuthenticator</code>的高阶组件，用于包装React原生应用的根组件。将其导入到<code class="fe mw mx my mo b">App.js</code>文件中，然后用它来包装<code class="fe mw mx my mo b">App</code>功能组件。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="3d61" class="lp lq iq mo b gy ms mt l mu mv">// ... after other import statements<br/>import { withAuthenticator } from 'aws-amplify-react-native';</span><span id="64d7" class="lp lq iq mo b gy nq mt l mu mv">// ... contents of App component<br/>function App() {<br/>  return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;Text&gt;💙 + 💛 = React Native + Amplify &lt;/Text&gt;<br/>      &lt;StatusBar style="auto" /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>}</span><span id="f3ae" class="lp lq iq mo b gy nq mt l mu mv">// wrap the App component as shown below<br/>export default withAuthenticator(App);</span></pre><p id="60bb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><code class="fe mw mx my mo b">withAuthenticator</code>组件在用户成功登录后呈现<code class="fe mw mx my mo b">App</code>组件，它阻止未登录的用户与您的应用程序交互。它会自动检测身份验证状态并更新UI。</p><p id="48be" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在，回到终端窗口，使用<code class="fe mw mx my mo b">yarn start</code>命令启动世博开发服务器。</p><p id="94bd" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">一旦加载了应用程序，您将会看到下面的初始屏幕，其中包含一些已经由用于包装<code class="fe mw mx my mo b">App</code>组件的HOC提供的UI组件。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/64bdcf035d426c73fd917b724a871a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*j7Nim3O7MXX-S43C.png"/></div></figure><p id="bdd8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">由于没有用户，如果您尝试登录，您将无法访问。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/ee4631732ed3bed924efa2d484ab6c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*Qnj4VhhZbGTSRTQO.png"/></div></figure><p id="77fa" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">AWS Amplify在这方面非常棒，它们甚至提供了基本而有用的细节，比如当你试图用错误的用户名或不存在的用户名登录时，会显示一条错误消息。</p><p id="97d6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">点击注册按钮下面的注册按钮，进入注册界面，注册一个新用户。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/5b366973dd8a9a49089a52085c141d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*33YqO_XnOu1l4-bQ.png"/></div></figure><p id="eb96" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">确保在<code class="fe mw mx my mo b">Username</code>和<code class="fe mw mx my mo b">Email</code>字段输入有效的电子邮件。它会向用户发送一个验证码来创建一个新帐户。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/fc96cb3c7763dd99e657d686a09c6184.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*Z7L4nlldmR9dSeW9.png"/></div></figure><p id="15fb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">创建新用户帐户后，您将被重定向回登录屏幕。若要登录，请输入您注册新用户时使用的凭据。</p><p id="4a6c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">成功登录后，您将看到主应用程序。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/7e0795f146174047bd2ad97c35234662.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*mNcz5y-0-rAtN5Zn.png"/></div></figure><h2 id="a72f" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">在React Native中使用AWS Amplify添加注销功能</h2><p id="280d" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">要使用默认UI组件将用户从React本地应用中注销，您必须在包装<code class="fe mw mx my mo b">App</code>组件时向<code class="fe mw mx my mo b">withAuthenticator</code>高阶组件传递第二个参数。</p><p id="9a40" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">修改<code class="fe mw mx my mo b">App.js</code>文件:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="26b4" class="lp lq iq mo b gy ms mt l mu mv">export default withAuthenticator(App, true);</span></pre><p id="70c0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这将显示一个注销按钮，如下所示。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/68eb4392c2593706d6b8bdce04984e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*r1B8ULeIKBZVVuOL.png"/></div></figure><p id="9adb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">从导入<code class="fe mw mx my mo b">App.js</code>文件中的<code class="fe mw mx my mo b">Auth</code>对象开始。然后，在<code class="fe mw mx my mo b">App</code>函数中，创建一个名为<code class="fe mw mx my mo b">signOut</code>的新异步处理程序方法，它使用了<code class="fe mw mx my mo b">Auth.signOut()</code>方法。</p><p id="700f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然后自定义方法被用作来自<code class="fe mw mx my mo b">react-native</code>的<code class="fe mw mx my mo b">Button</code>组件上的<code class="fe mw mx my mo b">onPress</code>属性的值。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="76da" class="lp lq iq mo b gy ms mt l mu mv">// other import statements<br/>import { withAuthenticator } from 'aws-amplify-react-native';</span><span id="b397" class="lp lq iq mo b gy nq mt l mu mv">function App() {<br/>  async function signOut() {<br/>    try {<br/>      await Auth.signOut();<br/>    } catch (error) {<br/>      console.log('Error signing out: ', error);<br/>    }<br/>  }</span><span id="30ac" class="lp lq iq mo b gy nq mt l mu mv">return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;Text&gt;💙 + 💛 = React Native + Amplify &lt;/Text&gt;<br/>      &lt;Button title="Sign Out" color="tomato" onPress={signOut} /&gt;<br/>      &lt;StatusBar style="auto" /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>}</span><span id="2d10" class="lp lq iq mo b gy nq mt l mu mv">// make sure to remove the second argument<br/>export default withAuthenticator(App);</span></pre><p id="152a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这是完成此步骤后您将得到的输出:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/77118e9d70dcef9f476eb10f93194c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*abl13X1KwtRCaaUb.png"/></div></figure><p id="b9ac" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">按下退出按钮后，您将返回登录屏幕。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b504fa277a23e4df1eaf7fadf7dc2fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/0*QYKCC8tAFybQUfup.gif"/></div></figure><h2 id="5f90" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">使用React导航库创建自定义身份验证流</h2><p id="dce5" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">从这一节开始，我们将学习如何使用React导航创建自定义身份验证流，并创建自定义屏幕来登录、注册、确认验证码和注销用户。</p><p id="74d3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">首先在React原生应用中添加<code class="fe mw mx my mo b">react-navigation</code>库。返回到终端窗口并安装下列依赖项。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="d3cb" class="lp lq iq mo b gy ms mt l mu mv">expo install @react-navigation/native @react-navigation/stack react-native-gesture-handler react-native-reanimated react-native-screens react-native-safe-area-context @react-native-community/masked-view</span></pre><p id="48cf" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">安装完依赖项后，创建以下目录结构。<code class="fe mw mx my mo b">screens/</code>目录包含所有不同的屏幕组件。<code class="fe mw mx my mo b">components/</code>包含两个可重用的组件，将用于构建表单屏幕。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="df51" class="lp lq iq mo b gy ms mt l mu mv">├──src/<br/>│  └──screens/<br/>│    └── SignIn.js<br/>│    └── SignUp.js<br/>│    └── ConfirmSignUp.js<br/>│    └── Home.js<br/>|  └──components/<br/>│    └── AppButton.js<br/>│    └── AppTextInput.js</span></pre><p id="eb34" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们首先从构建可重用组件开始。在<code class="fe mw mx my mo b">AppButton.js</code>文件中添加以下代码片段:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="e509" class="lp lq iq mo b gy ms mt l mu mv">import React from 'react';<br/>import { StyleSheet, Text, TouchableOpacity } from 'react-native';</span><span id="88c8" class="lp lq iq mo b gy nq mt l mu mv">export default function AppButton({ title, onPress }) {<br/>  return (<br/>    &lt;TouchableOpacity style={styles.button} onPress={onPress}&gt;<br/>      &lt;Text style={styles.buttonText}&gt;{title}&lt;/Text&gt;<br/>    &lt;/TouchableOpacity&gt;<br/>  );<br/>}</span><span id="6b75" class="lp lq iq mo b gy nq mt l mu mv">const styles = StyleSheet.create({<br/>  button: {<br/>    marginVertical: 10,<br/>    borderRadius: 25,<br/>    justifyContent: 'center',<br/>    alignItems: 'center',<br/>    padding: 15,<br/>    width: '80%',<br/>    backgroundColor: 'tomato'<br/>  },<br/>  buttonText: {<br/>    color: 'white',<br/>    fontSize: 18,<br/>    fontWeight: '600',<br/>    textTransform: 'uppercase'<br/>  }<br/>});</span></pre><p id="b5b3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">按钮组件由一个<code class="fe mw mx my mo b">TouchableOpacity</code>和一个<code class="fe mw mx my mo b">Text</code>组件组成，这两个组件从将要使用按钮的屏幕组件接收按钮标签和<code class="fe mw mx my mo b">onPress</code>处理程序方法作为道具。类似地，在文件<code class="fe mw mx my mo b">AppTextInput.js</code>中添加代码片段，该代码片段将显示一个<code class="fe mw mx my mo b">TextInput</code>字段，并在输入字段的左侧显示一个图标。为了显示图标，让我们使用包<a class="ae kf" href="https://icons.expo.fyi/" rel="noopener ugc nofollow" target="_blank"> @expo-vector-icons </a>。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="2a42" class="lp lq iq mo b gy ms mt l mu mv">import React from 'react';<br/>import { View, StyleSheet, TextInput } from 'react-native';<br/>import { MaterialCommunityIcons } from '@expo/vector-icons';<br/><br/>export default function AppTextInput({ leftIcon, ...otherProps }) {<br/>  return (<br/>    &lt;View style={styles.container}&gt;<br/>      {leftIcon &amp;&amp; (<br/>        &lt;MaterialCommunityIcons<br/>          name={leftIcon}<br/>          size={20}<br/>          color="#6e6869"<br/>          style={styles.icon}<br/>        /&gt;<br/>      )}<br/>      &lt;TextInput<br/>        style={styles.input}<br/>        placeholderTextColor="#6e6869"<br/>        {...otherProps}<br/>      /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>}<br/><br/>const styles = StyleSheet.create({<br/>  container: {<br/>    backgroundColor: '#f9f9f9',<br/>    borderRadius: 25,<br/>    flexDirection: 'row',<br/>    padding: 15,<br/>    marginVertical: 10<br/>  },<br/>  icon: {<br/>    marginRight: 10<br/>  },<br/>  input: {<br/>    width: '80%',<br/>    fontSize: 18,<br/>    color: '#101010'<br/>  }<br/>});</span></pre><p id="69f4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在下一节中，让我们构建允许用户登录的第一个屏幕。</p><h2 id="c056" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">创建自定义登录屏幕</h2><p id="0e72" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated"><code class="fe mw mx my mo b">SignIn.js</code>文件将包含两个输入字段和两个按钮，让用户输入他们的凭证登录到应用程序。该屏幕的工作方式将与您在早期默认登录屏幕中看到的类似，该屏幕带有Amplify的高阶组件<code class="fe mw mx my mo b">withAuthenticator</code>。</p><p id="a421" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">来自<code class="fe mw mx my mo b">aws-amplify</code>的<code class="fe mw mx my mo b">Auth</code>模块包含所有用于定制导航流的方法。例如，在下面的代码片段中，您会发现<code class="fe mw mx my mo b">Auth.signIn(username, password);</code>允许用户登录应用程序。这两个参数将是来自登录表单的用户凭证。为了跟踪<code class="fe mw mx my mo b">username</code>和<code class="fe mw mx my mo b">password</code>字段的值，我们使用React Hook <code class="fe mw mx my mo b">useState</code>。</p><p id="e4cf" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">暂时忽略<code class="fe mw mx my mo b">updateAuthState</code>道具。当导航流的配置完成时，它是否被使用以及用于什么变得更加清楚。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="c433" class="lp lq iq mo b gy ms mt l mu mv">import React, { useState } from 'react';<br/>import { View, Text, TouchableOpacity, StyleSheet } from 'react-native';<br/>import { Auth } from 'aws-amplify';<br/>import { SafeAreaView } from 'react-native-safe-area-context';<br/><br/>import AppTextInput from '../components/AppTextInput';<br/>import AppButton from '../components/AppButton';<br/><br/>export default function SignIn({ navigation, updateAuthState }) {<br/>  const [username, setUsername] = useState('');<br/>  const [password, setPassword] = useState('');<br/><br/>  async function signIn() {<br/>    try {<br/>      await Auth.signIn(username, password);<br/>      console.log('</span><span id="88a4" class="lp lq iq mo b gy nq mt l mu mv">Success');<br/>      updateAuthState('loggedIn');<br/>    } catch (error) {<br/>      console.log('</span><span id="7e3d" class="lp lq iq mo b gy nq mt l mu mv">Error signing in...', error);<br/>    }<br/>  }<br/><br/>  return (<br/>    &lt;SafeAreaView style={styles.safeAreaContainer}&gt;<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;Text style={styles.title}&gt;Sign in to your account&lt;/Text&gt;<br/>        &lt;AppTextInput<br/>          value={username}<br/>          onChangeText={text =&gt; setUsername(text)}<br/>          leftIcon="account"<br/>          placeholder="Enter username"<br/>          autoCapitalize="none"<br/>          keyboardType="email-address"<br/>          textContentType="emailAddress"<br/>        /&gt;<br/>        &lt;AppTextInput<br/>          value={password}<br/>          onChangeText={text =&gt; setPassword(text)}<br/>          leftIcon="lock"<br/>          placeholder="Enter password"<br/>          autoCapitalize="none"<br/>          autoCorrect={false}<br/>          secureTextEntry<br/>          textContentType="password"<br/>        /&gt;<br/>        &lt;AppButton title="Login" onPress={signIn} /&gt;<br/>        &lt;View style={styles.footerButtonContainer}&gt;<br/>          &lt;TouchableOpacity onPress={() =&gt; navigation.navigate('SignUp')}&gt;<br/>            &lt;Text style={styles.forgotPasswordButtonText}&gt;<br/>              Don't have an account? Sign Up<br/>            &lt;/Text&gt;<br/>          &lt;/TouchableOpacity&gt;<br/>        &lt;/View&gt;<br/>      &lt;/View&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>}</span></pre><p id="b428" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">第二个按钮将使用<code class="fe mw mx my mo b">react-navigation</code>库中的<code class="fe mw mx my mo b">navigation.navigate()</code>功能将用户导航到注册屏幕。</p><p id="ecab" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">添加以下<code class="fe mw mx my mo b">styles</code>对象:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="ce6e" class="lp lq iq mo b gy ms mt l mu mv">const styles = StyleSheet.create({<br/>  safeAreaContainer: {<br/>    flex: 1,<br/>    backgroundColor: 'white'<br/>  },<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center'<br/>  },<br/>  title: {<br/>    fontSize: 20,<br/>    color: '#202020',<br/>    fontWeight: '500',<br/>    marginVertical: 15<br/>  },<br/>  footerButtonContainer: {<br/>    marginVertical: 15,<br/>    justifyContent: 'center',<br/>    alignItems: 'center'<br/>  },<br/>  forgotPasswordButtonText: {<br/>    color: 'tomato',<br/>    fontSize: 18,<br/>    fontWeight: '600'<br/>  }<br/>});</span></pre><h2 id="37e5" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">制作自定义注册屏幕</h2><p id="d4c0" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">创建自定义注册屏幕，您可以控制他们使用您的应用创建新帐户所需的用户数据或凭据。自定义注册屏幕代码片段将有三个字段:<code class="fe mw mx my mo b">username</code>、<code class="fe mw mx my mo b">password</code>和<code class="fe mw mx my mo b">email</code>。</p><p id="6170" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><code class="fe mw mx my mo b">Auth.signUp({ username, password, attributes: { email } });</code>是成功允许用户创建新账户的方法。<code class="fe mw mx my mo b">attributes</code>对象可以有其他字段，如<code class="fe mw mx my mo b">phone_number</code>或其他自定义字段。通过该对象传递的值总是可选的。有了React Hook <code class="fe mw mx my mo b">useState</code>,你可以跟踪你的应用程序需要的任意多的属性。</p><p id="f1f0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">请注意，Amazon Cognito不动态创建定制属性。为了使用自定义属性，必须在用户池中创建它。关于如何使用Amplify CLI完成此过程的更多信息，请参见<a class="ae kf" href="https://docs.amplify.aws/lib/auth/emailpassword/q/platform/js#custom-attributes" rel="noopener ugc nofollow" target="_blank"> Amplify的文档，此处为</a>。</p><p id="2cb1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">打开文件<code class="fe mw mx my mo b">SignUp.js</code>并添加以下代码片段:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="1a5f" class="lp lq iq mo b gy ms mt l mu mv">import React, { useState } from 'react';<br/>import { View, Text, TouchableOpacity, StyleSheet } from 'react-native';<br/>import { Auth } from 'aws-amplify';<br/>import { SafeAreaView } from 'react-native-safe-area-context';</span><span id="ecf7" class="lp lq iq mo b gy nq mt l mu mv">import AppTextInput from '../components/AppTextInput';<br/>import AppButton from '../components/AppButton';</span><span id="d80a" class="lp lq iq mo b gy nq mt l mu mv">export default function SignUp({ navigation }) {<br/>  const [username, setUsername] = useState('');<br/>  const [password, setPassword] = useState('');<br/>  const [email, setEmail] = useState('');</span><span id="155f" class="lp lq iq mo b gy nq mt l mu mv">async function signUp() {<br/>    try {<br/>      await Auth.signUp({ username, password, attributes: { email } });<br/>      console.log('✅ Sign-up Confirmed');<br/>      navigation.navigate('ConfirmSignUp');<br/>    } catch (error) {<br/>      console.log('❌ Error signing up...', error);<br/>    }<br/>  }</span><span id="7718" class="lp lq iq mo b gy nq mt l mu mv">return (<br/>    &lt;SafeAreaView style={styles.safeAreaContainer}&gt;<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;Text style={styles.title}&gt;Create a new account&lt;/Text&gt;<br/>        &lt;AppTextInput<br/>          value={username}<br/>          onChangeText={text =&gt; setUsername(text)}<br/>          leftIcon="account"<br/>          placeholder="Enter username"<br/>          autoCapitalize="none"<br/>          keyboardType="email-address"<br/>          textContentType="emailAddress"<br/>        /&gt;<br/>        &lt;AppTextInput<br/>          value={password}<br/>          onChangeText={text =&gt; setPassword(text)}<br/>          leftIcon="lock"<br/>          placeholder="Enter password"<br/>          autoCapitalize="none"<br/>          autoCorrect={false}<br/>          secureTextEntry<br/>          textContentType="password"<br/>        /&gt;<br/>        &lt;AppTextInput<br/>          value={email}<br/>          onChangeText={text =&gt; setEmail(text)}<br/>          leftIcon="email"<br/>          placeholder="Enter email"<br/>          autoCapitalize="none"<br/>          keyboardType="email-address"<br/>          textContentType="emailAddress"<br/>        /&gt;<br/>        &lt;AppButton title="Sign Up" onPress={signUp} /&gt;<br/>        &lt;View style={styles.footerButtonContainer}&gt;<br/>          &lt;TouchableOpacity onPress={() =&gt; navigation.navigate('SignIn')}&gt;<br/>            &lt;Text style={styles.forgotPasswordButtonText}&gt;<br/>              Already have an account? Sign In<br/>            &lt;/Text&gt;<br/>          &lt;/TouchableOpacity&gt;<br/>        &lt;/View&gt;<br/>      &lt;/View&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>}</span></pre><p id="a2d6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">上述组件将具有以下样式:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="6380" class="lp lq iq mo b gy ms mt l mu mv">const styles = StyleSheet.create({<br/>  safeAreaContainer: {<br/>    flex: 1,<br/>    backgroundColor: 'white'<br/>  },<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center'<br/>  },<br/>  title: {<br/>    fontSize: 20,<br/>    color: '#202020',<br/>    fontWeight: '500',<br/>    marginVertical: 15<br/>  },<br/>  footerButtonContainer: {<br/>    marginVertical: 15,<br/>    justifyContent: 'center',<br/>    alignItems: 'center'<br/>  },<br/>  forgotPasswordButtonText: {<br/>    color: 'tomato',<br/>    fontSize: 18,<br/>    fontWeight: '600'<br/>  }<br/>});</span></pre><h2 id="4514" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">构建自定义验证码屏幕</h2><p id="f4a7" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">一旦用户创建了一个新的帐户，他们将被引导到确认注册屏幕，这将要求验证码。在这种情况下使用<code class="fe mw mx my mo b">Auth.confirmSignUp()</code>方法。它需要两个参数:<code class="fe mw mx my mo b">username</code>和<code class="fe mw mx my mo b">authCode</code>。<code class="fe mw mx my mo b">authCode</code>是作为验证码发送到用户电子邮件的内容。</p><p id="87f8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">将以下代码片段添加到文件<code class="fe mw mx my mo b">ConfirmSignUp.js</code>中。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="b65e" class="lp lq iq mo b gy ms mt l mu mv">import React, { useState } from 'react';<br/>import { View, Text, StyleSheet } from 'react-native';<br/>import { Auth } from 'aws-amplify';<br/>import { SafeAreaView } from 'react-native-safe-area-context';</span><span id="8d53" class="lp lq iq mo b gy nq mt l mu mv">import AppTextInput from '../components/AppTextInput';<br/>import AppButton from '../components/AppButton';</span><span id="e468" class="lp lq iq mo b gy nq mt l mu mv">export default function ConfirmSignUp({ navigation }) {<br/>  const [username, setUsername] = useState('');<br/>  const [authCode, setAuthCode] = useState('');</span><span id="b6be" class="lp lq iq mo b gy nq mt l mu mv">async function confirmSignUp() {<br/>    try {<br/>      await Auth.confirmSignUp(username, authCode);<br/>      console.log('✅ Code confirmed');<br/>      navigation.navigate('SignIn');<br/>    } catch (error) {<br/>      console.log(<br/>        '❌ Verification code does not match. Please enter a valid verification code.',<br/>        error.code<br/>      );<br/>    }<br/>  }</span><span id="da6c" class="lp lq iq mo b gy nq mt l mu mv">return (<br/>    &lt;SafeAreaView style={styles.safeAreaContainer}&gt;<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;Text style={styles.title}&gt;Confirm Sign Up&lt;/Text&gt;<br/>        &lt;AppTextInput<br/>          value={username}<br/>          onChangeText={text =&gt; setUsername(text)}<br/>          leftIcon="account"<br/>          placeholder="Enter username"<br/>          autoCapitalize="none"<br/>          keyboardType="email-address"<br/>          textContentType="emailAddress"<br/>        /&gt;<br/>        &lt;AppTextInput<br/>          value={authCode}<br/>          onChangeText={text =&gt; setAuthCode(text)}<br/>          leftIcon="numeric"<br/>          placeholder="Enter verification code"<br/>          keyboardType="numeric"<br/>        /&gt;<br/>        &lt;AppButton title="Confirm Sign Up" onPress={confirmSignUp} /&gt;<br/>      &lt;/View&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>}</span></pre><p id="881e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在此屏幕中，您可以添加更多业务逻辑来处理各种情况，例如当用户输入的验证码与发送到用户电子邮件的验证码不匹配时。一旦验证码匹配，用户将被重定向到登录屏幕。该组件将具有以下样式:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="b11f" class="lp lq iq mo b gy ms mt l mu mv">const styles = StyleSheet.create({<br/>  safeAreaContainer: {<br/>    flex: 1,<br/>    backgroundColor: 'white'<br/>  },<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center'<br/>  },<br/>  title: {<br/>    fontSize: 20,<br/>    color: '#202020',<br/>    fontWeight: '500',<br/>    marginVertical: 15<br/>  }<br/>});</span></pre><h2 id="9150" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">添加带有注销按钮的主屏幕</h2><p id="f824" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">当前导航流中的最后一个屏幕将是一个主屏幕，带有一些文本和一个退出按钮。注销按钮背后的处理程序方法与您在本教程前面章节中看到的方法相同。将以下代码片段添加到<code class="fe mw mx my mo b">Home.js</code>文件中:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="7223" class="lp lq iq mo b gy ms mt l mu mv">import React from 'react';<br/>import { View, Text, StyleSheet, Button } from 'react-native';<br/>import { Auth } from 'aws-amplify';</span><span id="3ef1" class="lp lq iq mo b gy nq mt l mu mv">export default function Home({ updateAuthState }) {<br/>  async function signOut() {<br/>    try {<br/>      await Auth.signOut();<br/>      updateAuthState('loggedOut');<br/>    } catch (error) {<br/>      console.log('Error signing out: ', error);<br/>    }<br/>  }</span><span id="39b4" class="lp lq iq mo b gy nq mt l mu mv">return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;Text&gt; 💙 + 💛&lt;/Text&gt;<br/>      &lt;Button title="Sign Out" color="tomato" onPress={signOut} /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>}</span><span id="043d" class="lp lq iq mo b gy nq mt l mu mv">const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center',<br/>    marginTop: 20<br/>  }<br/>});</span></pre><h2 id="e354" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">检查用户的登录状态</h2><p id="83a9" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated"><code class="fe mw mx my mo b">App.js</code>文件将包含所有自定义导航流程以及默认放大配置。打开文件，通过添加以下导入语句开始:</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="6297" class="lp lq iq mo b gy ms mt l mu mv">import React, { useState, useEffect } from 'react';<br/>import { ActivityIndicator, View } from 'react-native';<br/>import Amplify, { Auth } from 'aws-amplify';<br/>import { NavigationContainer } from '<a class="ae kf" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-navigation/native';<br/>import { createStackNavigator } from '<a class="ae kf" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-navigation/stack';</span><span id="bcae" class="lp lq iq mo b gy nq mt l mu mv">import config from './aws-exports';<br/>import SignIn from './src/screens/SignIn';<br/>import SignUp from './src/screens/SignUp';<br/>import ConfirmSignUp from './src/screens/ConfirmSignUp';<br/>import Home from './src/screens/Home';</span><span id="7523" class="lp lq iq mo b gy nq mt l mu mv">Amplify.configure(config);</span></pre><p id="9dc9" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">导航流程将分为两个堆栈。第一个堆栈称为<code class="fe mw mx my mo b">AuthenticationNavigator</code>，当用户没有登录时，所有屏幕都是相关的。</p><p id="6915" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">第二个堆栈导航器被称为<code class="fe mw mx my mo b">AppNavigator</code>，它只有一个屏幕:<code class="fe mw mx my mo b">Home</code>屏幕。此屏幕仅在用户成功登录时可用。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="f7a3" class="lp lq iq mo b gy ms mt l mu mv">const AuthenticationStack = createStackNavigator();<br/>const AppStack = createStackNavigator();<br/><br/>const AuthenticationNavigator = props =&gt; {<br/>  return (<br/>    &lt;AuthenticationStack.Navigator headerMode="none"&gt;<br/>      &lt;AuthenticationStack.Screen name="SignIn"&gt;<br/>        {screenProps =&gt; (<br/>          &lt;SignIn {...screenProps} updateAuthState={props.updateAuthState} /&gt;<br/>        )}<br/>      &lt;/AuthenticationStack.Screen&gt;<br/>      &lt;AuthenticationStack.Screen name="SignUp" component={SignUp} /&gt;<br/>      &lt;AuthenticationStack.Screen<br/>        name="ConfirmSignUp"<br/>        component={ConfirmSignUp}<br/>      /&gt;<br/>    &lt;/AuthenticationStack.Navigator&gt;<br/>  );<br/>};<br/><br/>const AppNavigator = props =&gt; {<br/>  return (<br/>    &lt;AppStack.Navigator&gt;<br/>      &lt;AppStack.Screen name="Home"&gt;<br/>        {screenProps =&gt; (<br/>          &lt;Home {...screenProps} updateAuthState={props.updateAuthState} /&gt;<br/>        )}<br/>      &lt;/AppStack.Screen&gt;<br/>    &lt;/AppStack.Navigator&gt;<br/>  );<br/>};</span></pre><p id="4ecd" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们创建一个名为<code class="fe mw mx my mo b">Initializing</code>的功能组件，它将负责在检查用户是否登录时显示一个加载指示器。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="bfee" class="lp lq iq mo b gy ms mt l mu mv">const Initializing = () =&gt; {<br/>  return (<br/>    &lt;View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}&gt;<br/>      &lt;ActivityIndicator size="large" color="tomato" /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};</span></pre><p id="78db" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">为了检查用户是否登录的状态，在<code class="fe mw mx my mo b">App</code>组件中定义了一个名为<code class="fe mw mx my mo b">isUserLoggedIn</code>的状态变量。默认值为<code class="fe mw mx my mo b">initializing</code>，表示检查用户身份状态时，显示加载指示灯。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="d981" class="lp lq iq mo b gy ms mt l mu mv">function App() {<br/>  const [isUserLoggedIn, setUserLoggedIn] = useState('initializing');<br/><br/>  // ...<br/>}</span></pre><p id="f625" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Amplify的<code class="fe mw mx my mo b">Auth</code>对象提供了一种称为<code class="fe mw mx my mo b">currentAuthenticatedUser() </code>的方法来实时检查用户是否登录。添加一个名为<code class="fe mw mx my mo b">checkAuthState</code>的异步处理方法来处理这个任务。根据该方法的结果，通过使用<code class="fe mw mx my mo b">setUserLoggedIn()</code>更新状态变量值来设置用户的登录状态。成功后，将值更新为<code class="fe mw mx my mo b">loggedIn</code>。如果出现错误或者用户没有登录，则更新为<code class="fe mw mx my mo b">loggedOut</code>。</p><p id="7723" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">添加另一个名为<code class="fe mw mx my mo b">updateAuthState</code>的处理方法，它将作为道具传递给两个屏幕:<code class="fe mw mx my mo b">Home</code>和<code class="fe mw mx my mo b">SignIn</code>。传递道具很有帮助，因为在这两个特定的屏幕上，身份验证的状态会发生变化。用户登录后，使用道具将<code class="fe mw mx my mo b">setUserLoggedIn</code>的值更新为<code class="fe mw mx my mo b">loggedIn</code>，用户退出时，将<code class="fe mw mx my mo b">setUserLoggedIn</code>的值更新为<code class="fe mw mx my mo b">loggedIn</code>。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="a81b" class="lp lq iq mo b gy ms mt l mu mv">function App() {<br/>  // ...</span><span id="6762" class="lp lq iq mo b gy nq mt l mu mv">useEffect(() =&gt; {<br/>    checkAuthState();<br/>  }, []);</span><span id="5f5a" class="lp lq iq mo b gy nq mt l mu mv">async function checkAuthState() {<br/>    try {<br/>      await Auth.currentAuthenticatedUser();<br/>      console.log('✅ User is signed in');<br/>      setUserLoggedIn('loggedIn');<br/>    } catch (err) {<br/>      console.log('❌ User is not signed in');<br/>      setUserLoggedIn('loggedOut');<br/>    }<br/>  }</span><span id="3385" class="lp lq iq mo b gy nq mt l mu mv">function updateAuthState(isUserLoggedIn) {<br/>    setUserLoggedIn(isUserLoggedIn);<br/>  }</span><span id="6dea" class="lp lq iq mo b gy nq mt l mu mv">// ...<br/>}</span></pre><p id="33f3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然后，根据<code class="fe mw mx my mo b">isUserLoggedIn</code>状态变量在<code class="fe mw mx my mo b">NavigationContainer</code>内的值，从<code class="fe mw mx my mo b">react-navigation</code>库中返回并包装所有不同的条件。</p><pre class="kh ki kj kk gt mn mo mp mq aw mr bi"><span id="8970" class="lp lq iq mo b gy ms mt l mu mv">function App() {<br/>  {<br/>    // ...</span><span id="a94d" class="lp lq iq mo b gy nq mt l mu mv">return (<br/>      &lt;NavigationContainer&gt;<br/>        {isUserLoggedIn === 'initializing' &amp;&amp; &lt;Initializing /&gt;}<br/>        {isUserLoggedIn === 'loggedIn' &amp;&amp; (<br/>          &lt;AppNavigator updateAuthState={updateAuthState} /&gt;<br/>        )}<br/>        {isUserLoggedIn === 'loggedOut' &amp;&amp; (<br/>          &lt;AuthenticationNavigator updateAuthState={updateAuthState} /&gt;<br/>        )}<br/>      &lt;/NavigationContainer&gt;<br/>    );<br/>  }<br/>}</span><span id="9a45" class="lp lq iq mo b gy nq mt l mu mv">export default App;</span></pre><h2 id="1be7" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">运行AWS放大器反应原生移动应用程序</h2><p id="cc78" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">启动世博开发服务器，执行<code class="fe mw mx my mo b">yarn start</code>命令。回到模拟器设备或您正在使用的任何其他设备，您将受到以下<code class="fe mw mx my mo b">SignIn</code>屏幕的欢迎。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/91f41d39166229bcf14d63d5e41f52e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/0*4ay9ijpgavzg-7_4.png"/></div></figure><p id="e2ee" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要创建新用户，请转到<code class="fe mw mx my mo b">SignUp</code>屏幕。注册成功后，它会要求验证授权码。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nu"><img src="../Images/ed9a76addb991b174959f341f4dc41b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/0*70YKuurjzXyteZDz.gif"/></div></div></figure><p id="d6ef" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">代码通过验证后，您将被重定向至<code class="fe mw mx my mo b">SignIn</code>屏幕。成功登录后，您将看到<code class="fe mw mx my mo b">Home</code>屏幕。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nu"><img src="../Images/bafde2deafd86b85327a7faa93bd079b.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/0*l17tENl-iE9kGvmg.gif"/></div></div></figure><h1 id="6106" class="nv lq iq bd lr nw nx ny lu nz oa ob lx jw oc jx ma jz od ka md kc oe kd mg of bi translated">摘要</h1><p id="5c70" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">这是一篇很长的帖子，但我们希望涵盖所有方面，以开始使用AWS Amplify、Expo和React本机应用程序设置和配置用户身份验证。</p><p id="d8c6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">正如您所看到的，AWS Amplify框架是一个非常强大的库，它连接了对AWS云服务的访问，允许我们只需几行代码就可以立即实现登录、注册和注销等极其安全的功能。</p><p id="9291" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在<a class="ae kf" href="https://www.instamobile.io" rel="noopener ugc nofollow" target="_blank"> Instamobile </a>，我们正在构建随时可用的React原生应用，由各种后端支持，如AWS Amplify或Firebase，以帮助开发者更快地制作他们自己的移动应用。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><h2 id="8175" class="lp lq iq bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">简单英语的JavaScript</h2><p id="2510" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kf" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> plainenglish.io </strong> </a>找到所有内容的链接！</p></div></div>    
</body>
</html>