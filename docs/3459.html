<html>
<head>
<title>Create a reusable Event Countdown Timer in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中创建一个可重复使用的事件倒计时器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-reusable-event-countdown-timer-in-react-580c0356a32?source=collection_archive---------6-----------------------#2020-09-30">https://javascript.plainenglish.io/create-a-reusable-event-countdown-timer-in-react-580c0356a32?source=collection_archive---------6-----------------------#2020-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b1cbf83a0352b6af5798ee5313cae5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jy_qnlTmCHo0tMkx1qgIZA.jpeg"/></div></div></figure><p id="3402" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">React是前端开发最流行的JavaScript框架之一。它让UI开发变得轻松。使用React，很容易构建管理自己状态的封装组件。</p><p id="364d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个简短的教程中，我将构建一个组件，负责为未来事件倒计时。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/a9a175f15dfdd0cc8d34eab56074c2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxELU54dypybJcYK585kIQ.png"/></div></div></figure><p id="2d8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，需要React的设置，还需要您的JavaScript知识(React组件、道具和状态)。</p><h1 id="81d8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">让我们开始编码</strong></h1><p id="6b1e" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">我更喜欢以这样一种方式构建我的应用程序，这样我就可以更容易地根据它们的功能来定位文件。我通常将可重用模块放在src/components/common目录中。(<em class="me">你可以随心所欲地构建你的应用</em>)。</p><p id="385f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在src/components/common文件夹中，创建一个文件并将其命名为CountDownTimer.jsx。</p><pre class="kx ky kz la gt mf mg mh mi aw mj bi"><span id="e428" class="mk lc iq mg b gy ml mm l mn mo">import React, { Component } from ‘react’;</span><span id="dcb3" class="mk lc iq mg b gy mp mm l mn mo">class CountDownTimer extends Component {<br/>   render() {<br/>     return &lt;&gt;&lt;/&gt;<br/>   }<br/>}</span></pre><p id="3385" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要在组件中定义一些状态，这些状态将用于显示以天、小时、分钟和秒为单位的当前倒计时。用下面的代码更新CountDownTimer类。</p><pre class="kx ky kz la gt mf mg mh mi aw mj bi"><span id="80eb" class="mk lc iq mg b gy ml mm l mn mo">...<br/>class CountDownTimer extends Component { </span><span id="35e8" class="mk lc iq mg b gy mp mm l mn mo">  state = {<br/>     days: 0,<br/>     hours: '00',<br/>     minutes: '00',<br/>     seconds: '00',<br/>     timeUp: false</span><span id="f241" class="mk lc iq mg b gy mp mm l mn mo">  }</span><span id="1b02" class="mk lc iq mg b gy mp mm l mn mo">  render() {<br/>     const {days, hours, minutes, seconds, timeUp} = <em class="me">this</em>.state;<br/>     const dayString = days &gt; 1 ? 'days' : 'day';</span><span id="1e81" class="mk lc iq mg b gy mp mm l mn mo">     return (<br/>        timeUp ?<br/>          &lt;p&gt;Event in progress&lt;/p&gt; <br/>          :<br/>          &lt;p&gt;{ `${days} ${dayString} ${hours} hours ${minutes}  minutes ${seconds} seconds` }&lt;/p&gt;<br/>     );</span><span id="cfc1" class="mk lc iq mg b gy mp mm l mn mo">  }<br/>...</span></pre><p id="c4cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面，我们定义了一些状态并将它们的值初始化为0，这样我们就可以有一个默认值<strong class="ka ir"> 0天00小时00分钟00秒。</strong>还定义了超时状态，并将其初始化为<strong class="ka ir">假，</strong>这有助于跟踪事件日期是否在过去，然后向最终用户显示<strong class="ka ir">事件正在进行中</strong>。</p><p id="2f76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们来定义计算活动日期倒计时的逻辑。用下面的代码片段更新您的代码。</p><pre class="kx ky kz la gt mf mg mh mi aw mj bi"><span id="1b43" class="mk lc iq mg b gy ml mm l mn mo">...</span><span id="9186" class="mk lc iq mg b gy mp mm l mn mo">componentDidMount() {<br/>   setInterval(() =&gt; {<br/>      let eventDate = +new Date(<em class="me">this</em>.props.date);<br/>      let difference = eventDate - +new Date();</span><span id="5229" class="mk lc iq mg b gy mp mm l mn mo">      if (difference &lt; 1) {<br/>         <em class="me">this</em>.setState({ timeUp: true });<br/>      } else {<br/>         let days = <em class="me">Math</em>.floor(difference / (1000 * 60 * 60 * 24));<br/>         let hours = <em class="me">Math</em>.floor((difference / (1000 * 60 * 60)) % 24);<br/>         let minutes = <em class="me">Math</em>.floor((difference / (1000 * 60)) % 60);<br/>         let seconds = <em class="me">Math</em>.floor((difference / (1000)) % 60);<br/>         <em class="me">this</em>.setState({<br/>            hours: hours &gt; 9 ? hours : `0${hours}`,<br/>            minutes: minutes &gt; 9 ? minutes : `0${minutes}`,<br/>            seconds: seconds &gt; 9 ? seconds : `0${seconds}`,<br/>            days<br/>         });<br/>      }<br/>   }, 1000)<br/>}</span><span id="1b61" class="mk lc iq mg b gy mp mm l mn mo">render() {<br/>     <br/>...</span></pre><p id="a0ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，我们从props获得了事件日期(它将作为date传递给这个组件)。在前面的<strong class="ka ir"> + </strong>的帮助下，这个日期被传递给date对象以创建一个时间戳(从1970年1月1日开始，以毫秒为单位)。此外，我们得到了未来日期和当前时间之间的差异。如果差值不小于1，那么我们将计算日、小时、分钟和秒并更新它们的状态，否则我们将<strong class="ka ir"> timeUp </strong>的状态设置为<strong class="ka ir"> true </strong>。所有这些都封装在<strong class="ka ir"> setInterval </strong>中，setInterval每1秒运行一次，并使render方法以此间隔刷新。</p><p id="9086" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请参见下面out CountDownTimer组件的完整代码:</p><pre class="kx ky kz la gt mf mg mh mi aw mj bi"><span id="053e" class="mk lc iq mg b gy ml mm l mn mo">import React, { Component } from ‘react’;</span><span id="040c" class="mk lc iq mg b gy mp mm l mn mo">class CountDownTimer extends Component {</span><span id="3639" class="mk lc iq mg b gy mp mm l mn mo">state = {<br/>     days: 0,<br/>     hours: '00',<br/>     minutes: '00',<br/>     seconds: '00',<br/>     timeUp: false</span><span id="2450" class="mk lc iq mg b gy mp mm l mn mo">}</span><span id="ef16" class="mk lc iq mg b gy mp mm l mn mo">componentDidMount() {<br/>   setInterval(() =&gt; {<br/>      let eventDate = +new Date(<em class="me">this</em>.props.date);<br/>      let difference = date - +new Date();</span><span id="78de" class="mk lc iq mg b gy mp mm l mn mo">if (difference &lt; 1) {<br/>         <em class="me">this</em>.setState({ timeUp: true });<br/>      } else {<br/>         let days = <em class="me">Math</em>.floor(difference / (1000 * 60 * 60 * 24));<br/>         let hours = <em class="me">Math</em>.floor((difference / (1000 * 60 * 60)) % 24);<br/>         let minutes = <em class="me">Math</em>.floor((difference / (1000 * 60)) % 60);<br/>         let seconds = <em class="me">Math</em>.floor((difference / (1000)) % 60);<br/>         <em class="me">this</em>.setState({<br/>            hours: hours &gt; 9 ? hours : `0${hours}`,<br/>            minutes: minutes &gt; 9 ? minutes : `0${minutes}`,<br/>            seconds: seconds &gt; 9 ? seconds : `0${seconds}`,<br/>            days<br/>         });<br/>      }<br/>   }, 1000)<br/>}</span><span id="e697" class="mk lc iq mg b gy mp mm l mn mo">render() {<br/>     const {days, hours, minutes, seconds, timeUp} = <em class="me">this</em>.state;<br/>     const dayString = days &gt; 1 ? 'days' : 'day';</span><span id="1c82" class="mk lc iq mg b gy mp mm l mn mo">return (<br/>        timeUp ?<br/>          &lt;p&gt;Event in progress&lt;/p&gt; <br/>          :<br/>          &lt;p&gt;{ `${days} ${dayString} ${hours} hours ${minutes}  minutes ${seconds} seconds` }&lt;/p&gt;<br/>     );</span><span id="23e9" class="mk lc iq mg b gy mp mm l mn mo">   }<br/>}</span><span id="7919" class="mk lc iq mg b gy mp mm l mn mo">export default CountDownTimer;</span></pre><p id="1200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是时候在其他组件中使用倒计时时间了。该组件可以在任何其他组件中使用，但是出于本教程的目的，我们将在App.js文件中使用它。打开App.js文件，用下面的代码更新render方法。</p><pre class="kx ky kz la gt mf mg mh mi aw mj bi"><span id="448d" class="mk lc iq mg b gy ml mm l mn mo">import React, { Component } from "react";<br/>import "./App.css";<br/>import CountDownTimer from "components/common/CountDownTimer";</span><span id="f19d" class="mk lc iq mg b gy mp mm l mn mo">class App extends Component {</span><span id="2895" class="mk lc iq mg b gy mp mm l mn mo">   render() {<br/>      return (<br/>         <strong class="mg ir">&lt;CountDownTimer date="01/20/2021" /&gt;</strong></span><span id="7338" class="mk lc iq mg b gy mp mm l mn mo">      );<br/>   }</span><span id="dc9e" class="mk lc iq mg b gy mp mm l mn mo">}</span><span id="08fb" class="mk lc iq mg b gy mp mm l mn mo">export default App;</span></pre><p id="127e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行应用程序并在浏览器上查看结果。</p></div></div>    
</body>
</html>