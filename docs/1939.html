<html>
<head>
<title>Your First Higher-Order Next.js Config: Generating a Sitemap for your Next.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ‚¨çš„ç¬¬ä¸€ä¸ªé«˜é˜¶Next.jsé…ç½®:ä¸ºæ‚¨çš„Next.jsåº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªç«™ç‚¹åœ°å›¾</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/your-first-higher-order-next-js-config-cf8813b15807?source=collection_archive---------12-----------------------#2020-05-05">https://javascript.plainenglish.io/your-first-higher-order-next-js-config-cf8813b15807?source=collection_archive---------12-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b5738cc38717c5d102dc9e3bd515a061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqzeBpBYP_flMswfYLS_JQ.png"/></div></div></figure><p id="598c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘æƒŠè®¶åœ°æ„è¯†åˆ°<a class="ae kw" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>æ²¡æœ‰ç°æˆçš„å·¥å…·æ¥ç”Ÿæˆ<em class="kx"> sitemap.xml </em>ã€‚åœ¨æˆ‘çš„ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œæˆ‘å¶ç„¶å‘ç°äº†ä¸€ä¸ª<a class="ae kw" href="https://github.com/IlusionDev/nextjs-sitemap-generator" rel="noopener ugc nofollow" target="_blank">åº“</a>ï¼Œä½†æ˜¯æˆ‘å¯¹å®ƒä»¬æä¾›çš„æ¥å£æ²¡æœ‰ä»€ä¹ˆå°è±¡ã€‚æ‰€ä»¥ï¼Œæˆ‘å†³å®šäº²è‡ªåŠ¨æ‰‹ï¼Œè®¾è®¡ä¸€ä¸ªæ›´é«˜é˜¶çš„Next.jsé…ç½®ã€‚è®©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ï¼Œè¿™æ ·å½“æ‚¨éœ€è¦æ—¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ›´é«˜é˜¶çš„é…ç½®ã€‚</p><p id="2919" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">TLï¼›DR â€” </strong>è®¿é—®<strong class="ka ir"/><a class="ae kw" href="https://github.com/cansin/next-with-sitemap" rel="noopener ugc nofollow" target="_blank">https://github.com/cansin/next-with-sitemap</a>ï¼Œå¼€å§‹ä½¿ç”¨npmåŒ…ï¼Œå¦‚æœä½ åªæ˜¯æƒ³ä¸ºä½ çš„åº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªç«™ç‚¹åœ°å›¾ï¼Œæˆ–è€…ç»§ç»­é˜…è¯»äº†è§£æ›´å¤šã€‚</p><h2 id="c4f5" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">é«˜é˜¶Next.jsé…ç½®çš„å‰–æ</h2><p id="ca36" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">æ‰€ä»¥é¦–å…ˆè¦åšçš„æ˜¯ã€‚æ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é«˜é˜¶é…ç½®ï¼Ÿç©¶ç«Ÿä»€ä¹ˆæ˜¯é«˜é˜¶é…ç½®ï¼Ÿé«˜é˜¶é…ç½®æ˜¯å¯¹<a class="ae kw" href="https://en.wikipedia.org/wiki/Higher-order_function" rel="noopener ugc nofollow" target="_blank">é«˜é˜¶åŠŸèƒ½</a>æ¦‚å¿µçš„æ–‡å­—æ¸¸æˆã€‚å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå°†ä¸€ä¸ªé…ç½®ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªé…ç½®ä½œä¸ºç»“æœçš„å‡½æ•°ã€‚</p><blockquote class="lw"><p id="ab55" class="lx ly iq bd lz ma mb mc md me mf kv dk translated">é«˜é˜¶é…ç½®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†ä¸€ä¸ªé…ç½®ä½œä¸ºå…¶å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„é…ç½®ä½œä¸ºå…¶ç»“æœã€‚</p></blockquote><p id="dbc0" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">ä»…ä»…é€šè¿‡åœ¨<code class="fe ml mm mn mo b">next.config.js</code>å†…éƒ¨ç¼–å†™æˆ‘ä»¬éœ€è¦çš„ä»£ç ï¼Œå°±æœ‰å¯èƒ½å®ç°æˆ‘ä»¬åœ¨è¿™é‡Œè¦åšçš„äº‹æƒ…ã€‚ä½†æ˜¯æ ¹æ®ä¸€èˆ¬ç»éªŒï¼Œéšç€é¡¹ç›®çš„å¢é•¿ï¼Œå°†æŸäº›æ–¹é¢å°è£…æˆä¸€æ®µä»£ç æ›´æ˜“äºç®¡ç†ã€‚å› æ­¤ï¼Œå¸Œæœ›å°†å…¶ä½œä¸ºé«˜é˜¶é…ç½®ã€‚</p><p id="2d20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼Œæˆ‘ä»¬éœ€è¦ä»åˆ›å»ºä¸€ä¸ªå‡½æ•°å¼€å§‹ï¼Œè¯¥å‡½æ•°å°†åœ¨<code class="fe ml mm mn mo b">next.config.js</code>è·å–ç°æœ‰çš„Next.jsé…ç½®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆç«™ç‚¹åœ°å›¾çš„å¢å¼ºç‰ˆæœ¬ã€‚å› æ­¤ï¼Œåœ¨æ‚¨çš„é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ª<code class="fe ml mm mn mo b">config/withSitemap.js</code>æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="7fb1" class="ky kz iq mo b gy mx my l mz na">// at config/withSitemap.js</span><span id="a92d" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">function </strong><em class="kx">withSitemap</em>(nextConfig = {}) {<br/>  <strong class="mo ir">return </strong>{<br/>    ...nextConfig,<br/>    webpack(webpackConfig, options) {<br/>      <strong class="mo ir">let </strong>config = webpackConfig;<br/>      <strong class="mo ir">if </strong>(<strong class="mo ir">typeof </strong>nextConfig.<strong class="mo ir">webpack </strong>=== <strong class="mo ir">"function"</strong>) {<br/>        config = nextConfig.<strong class="mo ir">webpack</strong>(config, options);<br/>      }</span><span id="546b" class="ky kz iq mo b gy nb my l mz na">      // Do something with the config</span><span id="da5c" class="ky kz iq mo b gy nb my l mz na">      <strong class="mo ir">return </strong>config;<br/>    },<br/>  };<br/>}</span><span id="8248" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir"><em class="kx">module</em></strong>.<strong class="mo ir">exports </strong>= <em class="kx">withSitemap</em>;</span></pre><p id="f369" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™ä¸ªéª¨æ¶åšäº†ä¸¤ä»¶äº‹ã€‚ç”±äº<code class="fe ml mm mn mo b">...nextConfig</code>çš„æ‰©å±•ï¼Œå®ƒå°†ä¸‹ä¸€ä¸ªé…ç½®ä¸­æœªè¢«è§¦åŠçš„éƒ¨åˆ†ä¼ é€’ä¸‹å»ã€‚å®ƒè¿˜è¿è¡Œä»»ä½•ç°æœ‰çš„webpacké…ç½®ï¼Œè¿™è¦æ„Ÿè°¢åœ¨<code class="fe ml mm mn mo b">nextConfig.webpack</code>ä¸Šçš„æ¡ä»¶è¿è¡Œã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä¸ºwebpackè´¹å¿ƒï¼Ÿå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šæ­£è¦æ‰©å……æˆ‘ä»¬çš„webpacké…ç½®æ¥ç”Ÿæˆç«™ç‚¹åœ°å›¾æ–‡ä»¶ã€‚ä½†ç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚</p><h2 id="43d0" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">å¸¦æœ‰itemapçš„é€‰é¡¹åº”è¯¥æœ‰</h2><p id="a04b" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">å¤§å¤šæ•°ç°ä»£çš„Next.jsåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå­˜æ”¾å…¬å…±é™æ€å†…å®¹çš„<code class="fe ml mm mn mo b">public</code>æ–‡ä»¶å¤¹ï¼Œä»¥åŠä¸€ä¸ªå­˜æ”¾æ¯ä¸ªé¡µé¢çš„JavaScriptæ–‡ä»¶çš„<code class="fe ml mm mn mo b">pages</code>æ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“æ‰€æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„çœŸå®é¢†åŸŸï¼Œä»¥ä¾¿<em class="kx"> sitemap.xml </em>æ–‡ä»¶èƒ½å¤Ÿæ­£ç¡®åœ°è¡¨ç¤ºå®ƒã€‚åˆå¤šäº†ä¸€ä¸ªè¿›å…¥çš„é€‰æ‹©ã€‚åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªé€‰é¡¹æ¥ç¦ç”¨<em class="kx"> sitemap.xml </em>ç”Ÿæˆï¼Œä»¥åŠå¦ä¸€ä¸ªé€‰é¡¹æ¥ç¦ç”¨<em class="kx"> robots.txt </em>ç”Ÿæˆã€‚</p><p id="0ddc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬å¸Œæœ›åœ¨Next.jsé…ç½®ä¸­çš„<code class="fe ml mm mn mo b">sitemap</code>å¯¹è±¡ä¸­æ¥æ”¶è¿™äº›é€‰é¡¹ã€‚è¿™æ ·<code class="fe ml mm mn mo b">next.config.js</code>å°±å¯ä»¥æ˜¯:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="8f39" class="ky kz iq mo b gy mx my l mz na">// at next.config.js (final code)</span><span id="bcfe" class="ky kz iq mo b gy nb my l mz na">const withSitemap = require("./config/withSitemap");</span><span id="85d7" class="ky kz iq mo b gy nb my l mz na">module.exports = withSitemap({<br/>  sitemap: {<br/>    domain: "https://www.example.com",<br/>    destFolder: "public",<br/>    pagesFolder: "pages",<br/>    generateRobots: true,<br/>    generateSitemap: true,<br/>  },<br/>  // .<br/>  // ..<br/>  // ... other Next.js config<br/>});</span></pre><p id="165d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">çœ‹èµ·æ¥å¾ˆå¹²å‡€ï¼Œä¸æ˜¯å—ï¼Ÿå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†è¦è¿”å›ç»™Next.jsé…ç½®çš„æ¥å£ã€‚è®©æˆ‘ä»¬ç»§ç»­è®¨è®ºä»£ç çš„å®è´¨å†…å®¹ã€‚</p><h2 id="76c8" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">åˆ›å»ºè‡ªå®šä¹‰Webpackæ’ä»¶</h2><p id="2220" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">ä¸ºäº†ç”Ÿæˆç«™ç‚¹åœ°å›¾æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†æŠŠä¸€ä¸ªwebpackæ’ä»¶æŒ‚æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸Šï¼Œå®ƒå°†ä»ç»™å®šçš„é€‰é¡¹å’Œæ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–å¿…è¦çš„æ•°æ®ï¼Œå¹¶å‘å‡º<code class="fe ml mm mn mo b">sitemap.xml</code>å’Œ<code class="fe ml mm mn mo b">robots.txt</code>ã€‚Webpackæœ¬èº«æœ‰å…³äº<a class="ae kw" href="https://webpack.js.org/contribute/writing-a-plugin/" rel="noopener ugc nofollow" target="_blank">ç¼–å†™æ’ä»¶</a>çš„ä¼˜ç§€æ–‡æ¡£ã€‚æˆ‘ä»¬å°†éµå¾ªé‚£é‡Œæè¿°çš„æœ€ä½³å®è·µã€‚è®©æˆ‘ä»¬ç»§ç»­åœ¨<code class="fe ml mm mn mo b">config/webpack/SitemapPlugin.js</code>ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe ml mm mn mo b">SitemapPlugin</code>çš„webpackæ’ä»¶ï¼Œå¹¶å°†å…¶å¡«å†™ä¸º:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="812d" class="ky kz iq mo b gy mx my l mz na">// at config/webpack/SitemapPlugin.js</span><span id="f6ef" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>validateOptions = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"schema-utils"</strong>);</span><span id="5334" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>schema = {<br/>  <strong class="mo ir">type</strong>: <strong class="mo ir">"object"</strong>,<br/>  <strong class="mo ir">properties</strong>: {<br/>    <strong class="mo ir">domain</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">destPath</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">pagesPath</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">generateRobots</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"boolean"</strong>,<br/>    },<br/>    <strong class="mo ir">generateSitemap</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"boolean"</strong>,<br/>    },<br/>  },<br/>};</span><span id="6201" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">class </strong>SitemapPlugin {<br/>  constructor(options) {<br/>    validateOptions(schema, options, <strong class="mo ir">"SitemapPlugin"</strong>);<br/>    <strong class="mo ir">this</strong>.<strong class="mo ir">options </strong>= options;<br/>  }</span><span id="bd0a" class="ky kz iq mo b gy nb my l mz na">  apply(compiler) {<br/>    // This is where the magic happens<br/>  }<br/>}</span><span id="1b92" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir"><em class="kx">module</em></strong>.<strong class="mo ir">exports </strong>= SitemapPlugin;</span></pre><p id="f10f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">æ¨¡å¼</em>å°†å¸®åŠ©æˆ‘ä»¬éªŒè¯æ’ä»¶çš„ç»™å®šé€‰é¡¹ã€‚æ­£å¦‚ä½ å¯èƒ½çŒœåˆ°çš„ï¼Œæˆ‘ä»¬å°†æŠŠç»™é«˜é˜¶é…ç½®çš„é€‰é¡¹ä¼ é€’ç»™webpackæ’ä»¶ã€‚</p><h2 id="629f" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">ä½¿ç”¨withSitemapä¸­çš„SitemapPlugin</h2><p id="01f3" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">ä¸‹ä¸€æ­¥æ˜¯ç”¨é¡¹ç›®åœ°å›¾å‡½æ•°ä»<em class="kx">ä¸­è°ƒç”¨<em class="kx">ç½‘ç«™åœ°å›¾æ’ä»¶</em>ã€‚è¿™å¾ˆç®€å•ï¼Œå› ä¸º:</em></p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="fb28" class="ky kz iq mo b gy mx my l mz na">// at config/withSitemap.js (final code)</span><span id="6fd2" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>path = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"path"</strong>);</span><span id="67fa" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>SitemapPlugin = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"./webpack/SitemapPlugin"</strong>);</span><span id="51b5" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">function </strong><em class="kx">withSitemap</em>(nextConfig = {}) {<br/>  <strong class="mo ir">return </strong>{<br/>    ...nextConfig,<br/>    webpack(webpackConfig, options) {<br/>      <strong class="mo ir">let </strong>config = webpackConfig;<br/>      <strong class="mo ir">if </strong>(<strong class="mo ir">typeof </strong>nextConfig.<strong class="mo ir">webpack </strong>=== <strong class="mo ir">"function"</strong>) {<br/>        config = nextConfig.<strong class="mo ir">webpack</strong>(config, options);<br/>      }<br/>      <br/>      // Hooking the Sitemap Plugin - start<br/>      <strong class="mo ir">const </strong>{<br/>        isServer,<br/>        config: {<br/>          pageExtensions,<br/>          sitemap: { <br/>            destFolder = <strong class="mo ir">"public"</strong>, <br/>            pagesFolder = <strong class="mo ir">"pages"</strong>, <br/>            ...sitemapOptions <br/>          } = {},<br/>        },<br/>      } = options;</span><span id="ccd9" class="ky kz iq mo b gy nb my l mz na">      <strong class="mo ir">if </strong>(isServer) {<br/>        <strong class="mo ir">return </strong>config;<br/>      }</span><span id="d335" class="ky kz iq mo b gy nb my l mz na">      <strong class="mo ir">const </strong>destPath = path.join(options.<strong class="mo ir">dir</strong>, destFolder);<br/>      <strong class="mo ir">const </strong>pagesPath = path.join(options.<strong class="mo ir">dir</strong>, pagesFolder);</span><span id="a13b" class="ky kz iq mo b gy nb my l mz na">      <strong class="mo ir"><em class="kx">console</em></strong>.log(<strong class="mo ir">"&gt; Generating sitemap.xml and robots.txt"</strong>);<br/>      <strong class="mo ir"><em class="kx">console</em></strong>.log(<strong class="mo ir">`&gt; Pages path: "</strong>${pagesPath}<strong class="mo ir">"`</strong>);<br/>      <strong class="mo ir"><em class="kx">console</em></strong>.log(<strong class="mo ir">`&gt; Destination path: "</strong>${destPath}<strong class="mo ir">"`</strong>);</span><span id="5201" class="ky kz iq mo b gy nb my l mz na">      config.<strong class="mo ir">plugins</strong>.push(<br/>        <strong class="mo ir">new </strong>SitemapPlugin({<br/>          destPath,<br/>          pagesPath,<br/>          pageExtensions,<br/>          ...sitemapOptions,<br/>        })<br/>      );<br/>      // Hooking the Sitemap Plugin - end</span><span id="d2aa" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">return </strong>config;<br/>    },<br/>  };<br/>}</span><span id="bcef" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir"><em class="kx">module</em></strong>.<strong class="mo ir">exports </strong>= <em class="kx">withSitemap</em>;</span></pre><p id="ab13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬æ­£åœ¨åšä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ææ„è¯­æ³•ä¸ºæˆ‘ä»¬æœŸæœ›çš„é€‰é¡¹æä¾›ä¸€äº›åˆç†çš„é»˜è®¤å€¼ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œå¤§å¤šæ•°Next.jsåº”ç”¨ç¨‹åºå°†ä½¿ç”¨<code class="fe ml mm mn mo b">public</code>ä½œä¸ºé»˜è®¤çš„<em class="kx">å…¬å…±</em>æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨<code class="fe ml mm mn mo b">pages</code>ä½œä¸ºé»˜è®¤çš„<em class="kx">é¡µé¢</em>æ–‡ä»¶å¤¹ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª<em class="kx">è·¯å¾„è®¡ç®—è¿™äº›æ–‡ä»¶å¤¹çš„å®é™…è·¯å¾„ã€‚å°†</em>è¿æ¥åˆ°ç”±<em class="kx"> options.dir </em>æŒ‡å®šçš„æ ¹ç›®å½•ã€‚æˆ‘ä»¬ä¹Ÿå°†<code class="fe ml mm mn mo b">pageExtensions</code> Next.jsé…ç½®ä¼ é€’ç»™æˆ‘ä»¬çš„æ’ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„é…ç½®ï¼Œå…è®¸å¼€å‘äººå‘˜å®šä¹‰å“ªäº›æ–‡ä»¶æ‰©å±•åå°†è¢«è§†ä¸ºpagesæ–‡ä»¶å¤¹ä¸‹çš„é¡µé¢æ–‡ä»¶(ä¾‹å¦‚ï¼Œ<code class="fe ml mm mn mo b">.page.js</code>è€Œä¸æ˜¯<code class="fe ml mm mn mo b">.js</code>)ã€‚</p><h2 id="f613" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">å®ç°å®é™…çš„ç«™ç‚¹åœ°å›¾ç”ŸæˆğŸ‰</h2><p id="8f1e" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">æˆ‘ä»¬æœ€ç»ˆæŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ†ç»‘åˆ°äº†æˆ‘ä»¬çš„webpackæ’ä»¶ä¸Šã€‚ç°åœ¨æ˜¯ç”Ÿæˆå®é™…æ–‡ä»¶çš„æ—¶å€™äº†ã€‚æˆ‘ä»¬å°†ä¾é å‡ ä¸ªå¤–éƒ¨åº“æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚è®©æˆ‘ä»¬æ·»åŠ å®ƒä»¬:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="4fcb" class="ky kz iq mo b gy mx my l mz na">$ yarn add x2js xml-formatter glob schema-utils clean-webpack-plugin</span></pre><p id="51a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨åº“å·²ç»å®‰è£…å¥½äº†ï¼Œè®©æˆ‘ä»¬æŠŠä»£ç æ”¾åˆ°æ’ä»¶ä¸­ï¼Œè®¨è®ºä¸€ä¸‹:</p><pre class="mp mq mr ms gt mt mo mu mv aw mw bi"><span id="a5b2" class="ky kz iq mo b gy mx my l mz na">// at config/webpack/SitemapPlugin.js (final code)</span><span id="3d40" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>fs = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"fs"</strong>);<br/><strong class="mo ir">const </strong>path = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"path"</strong>);</span><span id="462d" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>{ CleanWebpackPlugin } = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"clean-webpack-plugin"</strong>);<br/><strong class="mo ir">const </strong>validateOptions = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"schema-utils"</strong>);<br/><strong class="mo ir">const </strong>X2JS = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"x2js"</strong>);<br/><strong class="mo ir">const </strong><em class="kx">format </em>= <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"xml-formatter"</strong>);<br/><strong class="mo ir">const </strong>glob = <strong class="mo ir"><em class="kx">require</em></strong>(<strong class="mo ir">"glob"</strong>);</span><span id="4df7" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>schema = {<br/>  <strong class="mo ir">type</strong>: <strong class="mo ir">"object"</strong>,<br/>  <strong class="mo ir">properties</strong>: {<br/>    <strong class="mo ir">domain</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">destPath</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">pagesPath</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">pagesExtension</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"array"</strong>,<br/>    },<br/>    <strong class="mo ir">generateRobots</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"boolean"</strong>,<br/>    },<br/>    <strong class="mo ir">generateSitemap</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"boolean"</strong>,<br/>    },<br/>    <strong class="mo ir">robotsFilename</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>    <strong class="mo ir">sitemapFilename</strong>: {<br/>      <strong class="mo ir">type</strong>: <strong class="mo ir">"string"</strong>,<br/>    },<br/>  },<br/>};</span><span id="bbf1" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">class </strong>SitemapPlugin {<br/>  constructor(options) {<br/>    validateOptions(schema, options, <strong class="mo ir">"SitemapPlugin"</strong>);<br/>    <strong class="mo ir">this</strong>.<strong class="mo ir">options </strong>= options;<br/>  }</span><span id="110f" class="ky kz iq mo b gy nb my l mz na">  apply(compiler) {<br/>    <strong class="mo ir">const </strong>{<br/>      domain,<br/>      destPath,<br/>      pagesPath,<br/>      pageExtensions,<br/>      generateRobots = <strong class="mo ir">true</strong>,<br/>      generateSitemap = <strong class="mo ir">true</strong>,<br/>      robotsFilename = <strong class="mo ir">"robots.txt"</strong>,<br/>      sitemapFilename = <strong class="mo ir">"sitemap.xml"</strong>,<br/>    } = <strong class="mo ir">this</strong>.<strong class="mo ir">options</strong>;<br/>    <strong class="mo ir">const </strong>robotsDest = path.join(destPath, robotsFilename);<br/>    <strong class="mo ir">const </strong>sitemapDest = path.join(destPath, sitemapFilename);</span><span id="ee06" class="ky kz iq mo b gy nb my l mz na">    <strong class="mo ir">new </strong>CleanWebpackPlugin({<br/>      <strong class="mo ir">cleanOnceBeforeBuildPatterns</strong>: [robotsDest, sitemapDest],<br/>    }).apply(compiler);</span><span id="9003" class="ky kz iq mo b gy nb my l mz na">compiler.<strong class="mo ir">hooks</strong>.<strong class="mo ir">done</strong>.<strong class="mo ir">tap</strong>(<strong class="mo ir">"SitemapPlugin"</strong>, () =&gt; {<br/>      <strong class="mo ir">const </strong>x2js = <strong class="mo ir">new </strong>X2JS();<br/>      <strong class="mo ir">const </strong>pages = glob<br/>        .<em class="kx">sync</em>(<strong class="mo ir">`**/*.+(</strong>${pageExtensions.join(<strong class="mo ir">","</strong>)}<strong class="mo ir">)`</strong>, { <strong class="mo ir">cwd</strong>: pagesPath })<br/>        .map((page) =&gt;<br/>          page.replace(<br/>            <strong class="mo ir">new <em class="kx">RegExp</em></strong>(<br/>              <strong class="mo ir">`(.*?)(index)?\\.(</strong>${pageExtensions<br/>                .map((ext) =&gt; ext.replace(<strong class="mo ir">"."</strong>, <strong class="mo ir">"\\."</strong>))<br/>                .join(<strong class="mo ir">"|"</strong>)}<strong class="mo ir">)`<br/>            </strong>),<br/>            <strong class="mo ir">"$1"<br/>          </strong>)<br/>        )<br/>        .filter((page) =&gt; !page.startsWith(<strong class="mo ir">"_"</strong>));</span><span id="475b" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir">const </strong>date = <strong class="mo ir">new <em class="kx">Date</em></strong>().toISOString().slice(0, 10);<br/>      <strong class="mo ir">const </strong>sitemapObj = {<br/>        <strong class="mo ir">urlset</strong>: {<br/>          <strong class="mo ir">_xmlns</strong>: <strong class="mo ir">"https://www.sitemaps.org/schemas/sitemap/0.9/"</strong>,<br/>          <strong class="mo ir">url</strong>: [],<br/>        },<br/>      };</span><span id="5bd5" class="ky kz iq mo b gy nb my l mz na">      pages.forEach((page) =&gt; {<br/>        sitemapObj.<strong class="mo ir">urlset</strong>.<strong class="mo ir">url</strong>.push({<br/>          <strong class="mo ir">loc</strong>: <strong class="mo ir">`</strong>${domain}<strong class="mo ir">/</strong>${page}<strong class="mo ir">`</strong>,<br/>          <strong class="mo ir">lastmod</strong>: date,<br/>        });<br/>      });</span><span id="cbe7" class="ky kz iq mo b gy nb my l mz na">      <strong class="mo ir">if </strong>(robots) {<br/>        <strong class="mo ir">const </strong>robotsTxt = <strong class="mo ir">`User-agent: *\nAllow: /\nSitemap: </strong>${domain}<strong class="mo ir">/</strong>${sitemapFilename}<strong class="mo ir">`</strong>;<br/>        fs.<em class="kx">writeFileSync</em>(robotsDest, robotsTxt, {<br/>          <strong class="mo ir">flag</strong>: <strong class="mo ir">"as"</strong>,<br/>        });<br/>      }</span><span id="b574" class="ky kz iq mo b gy nb my l mz na">      <strong class="mo ir">if </strong>(sitemap) {<br/>        <strong class="mo ir">const </strong>sitemapXml = <em class="kx">format</em>(<br/>          <strong class="mo ir">`&lt;?xml version="1.0" encoding="UTF-8"?&gt;</strong>${x2js.js2xml(sitemapObj)}<strong class="mo ir">`</strong>,<br/>          {<br/>            <strong class="mo ir">collapseContent</strong>: <strong class="mo ir">true</strong>,<br/>          }<br/>        );<br/>        fs.<em class="kx">writeFileSync</em>(sitemapDest, sitemapXml, {<br/>          <strong class="mo ir">flag</strong>: <strong class="mo ir">"as"</strong>,<br/>        });<br/>      }<br/>    });<br/>  }<br/>}</span><span id="e706" class="ky kz iq mo b gy nb my l mz na"><strong class="mo ir"><em class="kx">module</em></strong>.<strong class="mo ir">exports </strong>= SitemapPlugin;</span></pre><p id="3d3b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¥½çš„ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨CleanWebpackPluginä¸º<em class="kx"> sitemap.xml </em>å’Œ<em class="kx"> robots.txt </em>æ¸…é™¤ä»»ä½•ç°æœ‰æ–‡ä»¶(å¯èƒ½æ¥è‡ªä»¥å‰çš„æ„å»º)ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé’©å­ï¼Œä¸€æ—¦ç¼–è¯‘å™¨åšäº†å…¶ä»–çš„äº‹æƒ…ï¼Œå®ƒå°±ä¼šè¿è¡Œã€‚åœ¨è¿™ä¸ªé’©å­çš„å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª<a class="ae kw" href="https://en.wikipedia.org/wiki/Glob_(programming)" rel="noopener ugc nofollow" target="_blank"> globæ¨¡å¼</a>æ¥éå†<em class="kx"> pagesPathä¸­çš„æ¯ä¸ªé¡µé¢æ–‡ä»¶åã€‚</em>æˆ‘ä»¬åˆ©ç”¨æ¨¡å¼ä¸­çš„<em class="kx">é¡µé¢æ‰©å±•</em>æ¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šéå†ä¸åº”è¯¥è¢«è®¤ä¸ºæ˜¯é¡µé¢æ–‡ä»¶çš„æ–‡ä»¶åã€‚ç„¶åï¼Œæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢ï¼Œåé¢è·Ÿç€ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥è·å¾—è¿™äº›é¡µé¢æ–‡ä»¶å°†æ˜ å°„åˆ°çš„URLçš„å¹²å‡€åˆ—è¡¨(ä¾‹å¦‚ï¼Œ<code class="fe ml mm mn mo b">pages/auth/login.js</code>å˜æˆäº†<code class="fe ml mm mn mo b">auth/login</code>)ã€‚</p><blockquote class="lw"><p id="e7e8" class="lx ly iq bd lz ma mb mc md me mf kv dk translated">æ­å–œï¼Œæ‚¨åˆšåˆšåˆ›å»ºäº†ä¸€ä¸ªæ›´é«˜é˜¶çš„Next.jsé…ç½®ï¼Œå®ƒä¸ºæ‚¨çš„é¡µé¢ç”Ÿæˆsitemap.xmlã€‚</p></blockquote><p id="9ce0" class="pw-post-body-paragraph jy jz iq ka b kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ij bi translated">ä¸€æ—¦æˆ‘ä»¬çŸ¥é“å°†ä»€ä¹ˆè·¯å¾„æ”¾å…¥<em class="kx"> sitemap.xml </em>ä¸­ï¼Œä¸‹ä¸€æ­¥å®é™…ä¸Šå°±æ˜¯ç”Ÿæˆxmlã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¾èµ–è¿™ä¸ªå«åš<a class="ae kw" href="https://github.com/x2js/x2js#readme" rel="noopener ugc nofollow" target="_blank"> x2js </a>çš„é…·åº“ã€‚è¿™ä¸ªåº“ä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†æ™®é€šçš„JavaScriptå¯¹è±¡è½¬æ¢æˆXMLå­—ç¬¦ä¸²ã€‚ä½¿ç”¨<code class="fe ml mm mn mo b">domain</code>é€‰é¡¹å’Œæˆ‘ä»¬åˆšåˆšè®¡ç®—çš„ç›¸å¯¹é¡µé¢URLï¼Œæˆ‘ä»¬å¼€å§‹åˆ›å»ºæˆ‘ä»¬çš„XMLå¯¹è±¡ï¼Œå…¶ä¸­æ ¹æ˜¯<code class="fe ml mm mn mo b">&lt;urlset&gt;</code>ã€<em class="kx">ã€</em>ï¼Œæ¯ä¸ªURLéƒ½æœ‰ä¸€ä¸ª<code class="fe ml mm mn mo b">&lt;url&gt;</code>æ¡ç›®ã€‚æœ€åï¼Œæˆ‘ä»¬ä¾é <code class="fe ml mm mn mo b">fs</code>å°†æˆ‘ä»¬ç”Ÿæˆçš„å†…å®¹æ”¾å…¥<em class="kx"> sitemap.xml </em>å’Œ<em class="kx"> robots.txt. </em></p><h2 id="6436" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å®é™…æ•ˆæœã€‚</h2><p id="a896" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">ç°åœ¨ï¼Œå¦‚æœæ‚¨ç»§ç»­è¿è¡Œ<code class="fe ml mm mn mo b">yarn next build</code>ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°<code class="fe ml mm mn mo b">sitemap.xml</code>å’Œ<code class="fe ml mm mn mo b">robots.txt</code>éƒ½åœ¨æ‚¨çš„<code class="fe ml mm mn mo b">public</code>æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆï¼Œå®ƒä»¬å°†ç”±Next.jsåœ¨æ‚¨çš„æ ¹åŸŸä¸­æä¾›æœåŠ¡ã€‚gitå¿½ç•¥è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šæäº¤åˆ°æ‚¨çš„ç‰ˆæœ¬æ§åˆ¶ä¸­ã€‚</p><h2 id="6374" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">æ½œåœ¨çš„æ”¹è¿›</h2><p id="37d6" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">äººä»¬å¯ä»¥å°†æ›´å¤šçš„ä¿¡æ¯æ”¾åˆ°<em class="kx"> sitemap.xml </em>ä¸­ï¼Œæ¯”å¦‚<em class="kx"> changefreq </em>å’Œ<em class="kx"> priority </em>(ä»¥åŠ<em class="kx"> robots.txt </em> ) <em class="kx">ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨Next.jsé…ç½®ä¸­æ·»åŠ æ›´å¤šé€‰é¡¹æ¥æ•è·è¿™äº›æ•°æ®ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„æ’ä»¶ã€‚æˆ‘ä»¬ç›®å‰ä¹Ÿä¸å¤„ç†ä»»ä½•åŠ¨æ€URL(ä¾‹å¦‚<code class="fe ml mm mn mo b">pages/user/[id].js</code>)ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå—æ¬¢è¿çš„è¡¥å……ã€‚</em></p><p id="da62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¬èµ·æ¥æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼Ÿä¹Ÿè®¸åœ¨https://github.com/cansin/next-with-sitemap<a class="ae kw" href="https://github.com/cansin/next-with-sitemap" rel="noopener ugc nofollow" target="_blank">åˆ›å»ºä¸€ä¸ªæ‹‰è¯·æ±‚(æ— è€»çš„æ’å¤´ğŸ¤“).</a></p><h2 id="820b" class="ky kz iq bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">ç»“è®º</h2><p id="d9a6" class="pw-post-body-paragraph jy jz iq ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">ä¸€æ—¦ä½ å­¦ä¼šäº†è¿™ç§é€šç”¨æ¨¡å¼æ¥å®ç°è‡ªæˆ‘å°è£…çš„Next.jsé…ç½®æ”¹è¿›ï¼Œç®¡ç†ä½ çš„é…ç½®å°†å˜å¾—æ¯«ä¸è´¹åŠ›ï¼Œä¹Ÿè®¸è¿˜èƒ½å¾—åˆ°ä½ å¸Œæœ›å­˜åœ¨çš„åº“ã€‚æˆ‘å¸Œæœ›è¿™æ˜¯å¯¹ä½ å½“å‰/ä¸‹ä¸€ä¸ªé¡¹ç›®æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚</p></div></div>    
</body>
</html>