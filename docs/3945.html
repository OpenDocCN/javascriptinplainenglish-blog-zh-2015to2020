<html>
<head>
<title>How to Show a Loader Until the Fetch API Has Finished Loading the Page</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在获取API完成页面加载之前显示加载器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-loader-to-your-deployed-projects-d8f389e8c928?source=collection_archive---------1-----------------------#2020-11-05">https://javascript.plainenglish.io/adding-loader-to-your-deployed-projects-d8f389e8c928?source=collection_archive---------1-----------------------#2020-11-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/075a448bb9cab1beb7b6811c4587fd5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*x9VoAionFNY7DkMw.jpg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">is it loading or …</figcaption></figure><p id="a4e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我最近分享了我完成的香草JavaScript和Rails项目。这是Rails后端的Heroku和前端的github.io最新部署的。</p><p id="01f2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，我的朋友对我的项目感到困惑，因为除了几个按钮之外，什么也没有加载。我不得不告诉她，她需要等待大约30秒到5分钟，这取决于该应用程序最近被获取的时间。这是一个我需要解决的问题。如果我的用户没有得到通知，没有耐心等待数据加载，该怎么办？甚至没有迹象表明数据加载会很慢。</p><p id="6228" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我进行了头脑风暴和研究，找到了解决这个问题的简单方法——添加一个加载器，直到后端数据被完全获取。我想在本文中与您分享如何实现加载器。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/09a53addb7d170c2a2d8caba5a127716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*IRZcaDCODVROyAav.jpg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">loading cat meme</figcaption></figure><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kz"><img src="../Images/0fa6a71e92a0fa90143837fede3eac6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ptNryIozfOcXxSR3jv0x2Q.gif"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">This is the finished product with the clock emoji loader</figcaption></figure><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">create parent-child div in index.html</figcaption></figure><p id="3d88" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们需要创建一个父div和一个子div——在index.html的<strong class="jx io">中总共有两个div标签，我们希望在这里定位加载程序。最好将div标签放在主体内部。我们将调用父div、<em class="lg"> preload </em>和子div、<em class="lg"> emoji </em>的类。</strong></p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">index.js</figcaption></figure><p id="f122" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们在<strong class="jx io"> index.js </strong>中编写div标签的逻辑。首先，让我们创建两个变量，这样我们就可以轻松地选择HTML中的元素。一个，选择名为<em class="lg">的div类preload </em>，另一个，选择<em class="lg">表情符号</em>。</p><p id="4878" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还将创建一个名为<em class="lg">表情符号</em>的数组，其中我们将单个时钟表情符号作为字符串值作为单个元素进行定位。<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval" rel="noopener ugc nofollow" target="_blank"> setInterval </a>逻辑将在每次调用之间以固定的时间延迟调用该函数。在第7行，我们将时间间隔声明为125毫秒。您可以根据自己的意愿更改延迟时间。</p><p id="e62b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用单一责任原则并编写两个助手函数，<em class="lg">loade moji</em>和<em class="lg"> init </em>。首先，我们调用第19行的函数<em class="lg"> init </em>。位于第16行的init函数将<em class="lg">表情符号</em>数组作为函数<em class="lg"> loadEmojis </em>的参数。所以我们遍历第9行，它利用了setInterval逻辑。</p><blockquote class="lh li lj"><p id="1095" class="jv jw lg jx b jy jz ka kb kc kd ke kf lk kh ki kj ll kl km kn lm kp kq kr ks ig bi translated">e moji . innertext = arr[math . floor(math . random()* arr . length)]</p></blockquote><p id="5516" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于第11行，我们来分解一下。<em class="lg"> emoji.innerText </em>是第3行，<em class="lg"> emoji </em> div。我们将用<em class="lg">表情符号</em>数组中的一个时钟表情符号元素替换表情符号div。</p><p id="dc6a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random" rel="noopener ugc nofollow" target="_blank"> Math.random() </a>函数返回一个介于0到小于1之间的浮点伪随机数，例如0.742。然后我们将随机数乘以<em class="lg">数组长度</em>，然后使用<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/floor" rel="noopener ugc nofollow" target="_blank"> Math.floor() </a>返回小于或等于给定数字的最大整数，因此它是小于<em class="lg">数组长度</em>且大于0的任何数字。这种逻辑将让时钟表情符号不断变化，所以它看起来像是在加载。</p><figure class="kv kw kx ky gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ln"><img src="../Images/86727a72b7f5abe9c76b43a2fbf0ab98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*H7Mv_2LJ-rIXv9-U1Ffapg.gif"/></div></div></figure><p id="4d41" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你！现在页面上有了加载器！但是等等。这不是我们想要的。当从后端获取数据时，我们需要停止加载程序。下面是解决这个问题的一行代码。</p><figure class="kv kw kx ky gt jo"><div class="bz fp l di"><div class="le lf l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">loader stopper inside of the fetch</figcaption></figure><p id="bb14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将获取后端数据并解析它。当获取数据时，我们将停止加载程序，因此我们更改显示逻辑的位置在第6行。</p><blockquote class="lh li lj"><p id="8c32" class="jv jw lg jx b jy jz ka kb kc kd ke kf lk kh ki kj ll kl km kn lm kp kq kr ks ig bi translated">document.querySelector("。preload "). style . display = " none "//停止加载。</p></blockquote><p id="510c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你没有获取，你可以在调用了<em class="lg"> init </em>函数之后，把这一行放到<em class="lg"> init()的下面。</em>只需将style.display重新指定为“无”即可停止加载程序。</p><p id="8b68" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">干得好！我们希望您现在感觉已经很好地掌握了如何实现加载器以及如何停止它。现在，您的用户被告知，如果有加载程序，数据仍在加载。</p><p id="3c3d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="lg">更多内容尽在plainenglish.io </em> </a></p></div></div>    
</body>
</html>