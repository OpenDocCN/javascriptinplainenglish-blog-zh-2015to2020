# Auth0 ç®€åŒ–äº† Nuxt.js è®¤è¯(åŒ…æ‹¬åˆ·æ–°ä»¤ç‰Œï¼)

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/nuxt-authentication-made-easy-with-auth0-9c20cc690462?source=collection_archive---------1----------------------->

![](img/db5e0a9adb0e79390cd4fb4db2a9ccb0.png)

[Nuxt.](https://vivicrema.cremaonline.it/Domicilio/)js + Auth0

# æˆ‘ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ

æˆ‘æœ€è¿‘å†³å®šæ¢ç´¢ä¸€ç§ç°æˆçš„èº«ä»½éªŒè¯æœåŠ¡ï¼Œå› ä¸ºæˆ‘åŒå€¦äº†ä¸€æ¬¡åˆä¸€æ¬¡åœ°é‡æ–°å®ç°èº«ä»½éªŒè¯

æˆ‘å‘ç° [Auth0 æ–‡æ¡£](https://auth0.com/docs/getting-started)éå¸¸å®¹æ˜“ç†è§£ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ•´ä¸ªè®¤è¯æµç¨‹åœ¨ SPAs ä¸­éå¸¸å®¹æ˜“å®ç°

è¡¨å•éªŒè¯ 0 ç½‘ç«™:

> å¿«é€Ÿé›†æˆ webã€ç§»åŠ¨å’Œä¼ ç»Ÿåº”ç”¨ç¨‹åºçš„èº«ä»½éªŒè¯å’Œæˆæƒï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡ã€‚

ä¸“æ³¨äºä½ çš„æ ¸å¿ƒä¸šåŠ¡ï¼

è¿™æ˜¯æˆ‘ä»¬åº”è¯¥æ°¸è¿œè®°ä½çš„äº‹æƒ…ã€‚

# å…¥é—¨æŒ‡å—

æœ¬æ•™ç¨‹è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ [Auth0](https://auth0.com/) å’Œ PKCE è®¤è¯æµä¸º [Nuxt.js](https://nuxtjs.org/) SPA è®¾ç½®è®¤è¯

æˆ‘ä»¬å°†å­¦ä¹ ä»¥ä¸‹å†…å®¹:

*   è®¾ç½® Auth0 å®¢æˆ·ç«¯
*   è®¾ç½®ä¸€ä¸ª [Nuxt.js](https://nuxtjs.org/) SPA
*   å°†æˆ‘ä»¬ SPA ä¸­çš„ Auth0 ä¸ [auth0-spa-js](https://github.com/auth0/auth0-spa-js) é›†æˆ

# Auth0 å®¢æˆ·ç«¯è®¾ç½®

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šåˆ¶ Auth0 ç™»å½•æ¡†

![](img/ac76398503df919335614e5c4f629f73.png)

Click on customize button

ç„¶åï¼Œä» Auth0 çš„**åº”ç”¨ç¨‹åº**ä¸­ï¼Œç‚¹å‡»**åˆ›å»ºåº”ç”¨ç¨‹åº**

![](img/9fdf55e741e7ea9975b014c1a5eda07c.png)

Give it a name and select Single Page Web Applications Type

åœ¨æ‰“å¼€çš„é…ç½®é¡µé¢ä¸Šï¼Œé€‰æ‹©**è®¾ç½®**é€‰é¡¹å¡

![](img/012634795f122528690a5ad61dfbdce5.png)

Copy Domain and Client ID values for later use

æ»šåŠ¨é¡µé¢ï¼Œå°†[*http://localhost:3000*](http://localhost:3000)*æ·»åŠ åˆ°æ¯ä¸ªåº”ç”¨ URI(åº”ç”¨ç™»å½• URI é™¤å¤–)*

*![](img/e49a85187c68b6a8777e7632089093d3.png)*

## *åˆ·æ–°ä»¤ç‰Œ*

*æˆ‘ä»¬ç°åœ¨èƒ½å¤Ÿé€‰æ‹©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦å“ªç§ç±»å‹çš„åˆ·æ–°ä»¤ç‰Œã€‚*

*ç³»ç»Ÿä¼šæç¤ºæˆ‘ä»¬åœ¨ä¸¤ç§åˆ·æ–°ä»¤ç‰Œè¡Œä¸ºä¹‹é—´è¿›è¡Œé€‰æ‹©:*

*![](img/23ecd8558b76f05ddf169bb6b3efc0c2.png)*

*I suggest to select Rotating*

*åˆ·æ–°ä»¤ç‰Œå¾ªç¯ä¼šå‘å‡ºæ–°çš„åˆ·æ–°ä»¤ç‰Œï¼Œå¹¶ä½¿å‰ä»»ä»¤ç‰Œå¤±æ•ˆã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è¯´**è½®æ¢åˆ·æ–°ä»¤ç‰Œé™ä½äº†æ³„éœ²åˆ·æ–°ä»¤ç‰Œçš„é£é™©**ã€‚*

*æ›´å¤šå…³äºåˆ·æ–°ä»¤ç‰Œå¾ªç¯[çš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»](https://auth0.com/docs/tokens/concepts/refresh-token-rotation)ã€‚*

*æˆ‘ä»¬å°†è¢«è¦æ±‚è¾“å…¥åˆ·æ–°ä»¤ç‰Œçš„ç”Ÿå‘½å‘¨æœŸå’Œé‡ç”¨é—´éš”*

*![](img/8f72dfc259a7af9fed8170bbbcceef81.png)*

*Look at [this](https://auth0.com/docs/tokens/guides/configure-refresh-token-rotation) page for help choosing this values*

*ç°åœ¨æ‰“å¼€**é«˜çº§è®¾ç½®ï¼Œ**é€‰æ‹©**æˆæƒç±»å‹**é€‰é¡¹å¡å¹¶ç¡®ä¿é€‰æ‹©*æˆæƒç *å’Œ*åˆ·æ–°ä»¤ç‰Œ*å¤é€‰æ¡†*

*![](img/3c2d99ae9ac2d4e733922adc01bccb24.png)*

*æœ€åï¼Œç‚¹å‡»**ä¿å­˜æ›´æ”¹ã€‚***

# *Nuxt.js SPA è®¾ç½®*

*ä»åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ [Nuxt.js](https://nuxtjs.org/) åº”ç”¨ç¨‹åºå¼€å§‹*

```
*create-nuxt-app nuxt-auth0*
```

*CLI å·¥å…·ç°åœ¨å°†è¯¢é—®å‡ ä¸ªé—®é¢˜ã€‚
é‡è¦æç¤º:å½“è¦æ±‚æ¸²æŸ“æ¨¡å¼æ—¶ï¼Œé€‰æ‹©å•é¡µåº”ç”¨*

```
*? Choose rendering mode
  Universal (SSR)
â¯ Single Page App*
```

*å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼Œå¹¶é€šè¿‡é”®å…¥(åŸºäºæˆ‘ä»¬ä¹‹å‰é€‰æ‹©çš„åŒ…ç®¡ç†å™¨)æ¥å¯åŠ¨åº”ç”¨ç¨‹åº*

```
*yarn dev//ORnpm run dev*
```

*è®©æˆ‘ä»¬çœ‹çœ‹åœ¨[è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œhttp://localhost:3000](http://localhost:3000) ã€‚*

*![](img/491aa49cd259ec64146704d09efdbc16.png)*

*[http://localhost:3000](http://localhost:3000)*

*æ˜¯æ—¶å€™ä¿æŠ¤æˆ‘ä»¬çš„ç´¢å¼•é¡µé¢äº†ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å®‰è£…äº† [auth0-spa-js](https://github.com/auth0/auth0-spa-js)*

## *auth0-spa-js*

```
*yarn add @auth0/auth0-spa-js//ORnpm install @auth0/auth0-spa-js*
```

***æ³¨æ„**:å®‰è£… auth0-spa-js åº“æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šåœ¨ Nuxt æ§åˆ¶å°é‡åˆ°é”™è¯¯:è¿™ä¸ªåŒ…éœ€è¦å®‰è£…`core-js@2`ã€‚*

```
*yarn add core-js@2//ORnpm install --save core-js@2*
```

*æˆ‘çŸ¥é“`core-js@2`å·²ç»ä¸å­˜åœ¨äº†ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“å“ªä¸ªæ˜¯é—®é¢˜(å¦‚æœä½ æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œå†™åœ¨ä¸‹é¢çš„è¯„è®ºéƒ¨åˆ†ğŸ™)*

*ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º **auth0.js** çš„æ–°æ’ä»¶ã€‚*

*Insert domain and client ids saved before*

*è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®çš„æ¯ä¸ªæ–‡ä»¶ä¸­è®¿é—® *$auth0* ã€‚*

*ç„¶åï¼Œæˆ‘ä»¬å°†åˆšåˆšåˆ›å»ºçš„æ’ä»¶æ·»åŠ åˆ° **nuxt.config.js** æ–‡ä»¶ä¸­*

*![](img/2e82dd0e2888e683f68d8d3c1b2d2c3a.png)*

*æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªå¤„ç†ç™»å½•åå›è°ƒçš„ä¸­é—´ä»¶æ¥ä¿æŠ¤æˆ‘ä»¬çš„ç´¢å¼•é¡µé¢ï¼Œå°è¯•åˆ·æ–°è®¿é—®ä»¤ç‰Œï¼Œç„¶åå¦‚æœç”¨æˆ·æœªé€šè¿‡èº«ä»½éªŒè¯ï¼Œåˆ™é‡å®šå‘åˆ° Auth0 ç™»å½•æ¡†*

***æ³¨æ„**:è¯¥åŠŸèƒ½é¦–å…ˆå°è¯•å¤„ç†ç™»å½•é‡å®šå‘å›è°ƒã€‚å¦‚æœè¯·æ±‚çš„å—è¯¥ä¸­é—´ä»¶ä¿æŠ¤çš„é¡µé¢æ˜¯ç™»å½•åè°ƒç”¨çš„ç¬¬ä¸€ä¸ªé¡µé¢**è€Œä¸æ˜¯**ï¼Œåˆ™`handleRedirectCallback`å‡½æ•°ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚
æˆ‘ä»¬é€šè¿‡è°ƒç”¨`getTokenSilently` æ¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦é€šè¿‡è®¤è¯:å¦‚æœå‡ºç°å¦å®šçš„å“åº”(å¯èƒ½æ˜¯æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰é€šè¿‡è®¤è¯ï¼Œæˆ–è€…è®¿é—®ä»¤ç‰Œå·²ç»è¿‡æœŸï¼Œæ— æ³•åˆ·æ–°)ï¼Œç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ°æ˜¾ç¤º Auth0 ç™»å½•æ¡†çš„ Auth0 `/authorize` url(å¸¦æœ‰`redirect`åŠŸèƒ½)ã€‚*

***æ³¨é‡Š 2** :å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªé¡µé¢éœ€è¦ä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æˆ‘ä»¬è¯•å›¾è®¿é—®çš„ URL(`target.fullPath`)å¹¶å°†å…¶ä¼ é€’ç»™`buildAuthorizeUrl`è°ƒç”¨ã€‚è¯¥ URL å°†åœ¨éªŒè¯åè¿”å›åˆ°åº”ç”¨ç¨‹åºï¼Œå¹¶ç”¨äºå°†æˆ‘ä»¬é‡å®šå‘åˆ°ç™»å½•å‰è¯•å›¾åˆ°è¾¾çš„ä½ç½®ã€‚*

***æ³¨ 3** :æ³¨æ„æˆ‘ä»¬ç”¨`buildAuthorizeUrl`ä»£æ›¿`loginWithRedirect`ã€‚è¿™æ˜¯é¿å… [Nuxt.js](https://nuxtjs.org/) å‘ˆç°è¯·æ±‚é¡µé¢çš„å”¯ä¸€æ–¹æ³•ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è¢«è®¤è¯ã€‚åŸå› æ˜¯`loginWithRedirect`å‘¼å«`window.location.assign(url)`*

*æœ€åï¼Œæˆ‘ä»¬å°†ä¸­é—´ä»¶å’Œæ³¨é”€æŒ‰é’®æ·»åŠ åˆ°é¡µé¢ä¸­*

*è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œç°åœ¨æ˜¯æ—¶å€™åœ¨ [http://localhost:3000](http://localhost:3000) ä¸ŠæŸ¥çœ‹æ‰€æœ‰çš„æ´»åŠ¨äº†*

***TLï¼›æ­¤æ—¶ï¼Œä½ å¯èƒ½ä¼šå¾ˆå®¹æ˜“åœ°é—®æˆ‘:*ä½ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ä¼Ÿå¤§çš„* [*Nuxt.js Auth æ¨¡å—*](https://auth.nuxtjs.org/) *ï¼Ÿ*
ç›®å‰ï¼ŒAuth æ¨¡å—åªæä¾›éšå¼æˆæƒæµã€‚
**PKCE è®¤è¯æµç¨‹å’Œéšå¼æˆæƒæµç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ*****

> *å¸¦æœ‰éšå¼æˆæƒæµçš„è®¿é—®ä»¤ç‰Œåœ¨å®¢æˆ·ç«¯å…¬å¼€ï¼Œå¹¶ä¸”ä¸è¿”å›åˆ·æ–°ä»¤ç‰Œï¼Œå› ä¸ºæµè§ˆå™¨ä¸èƒ½ä¿æŒå…¶ç§æœ‰æ€§ã€‚*

*å¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£ï¼Œç‚¹å‡»[è¿™é‡Œ](https://tools.ietf.org/id/draft-ietf-oauth-security-topics-12.html)ã€‚*

# *é¦–æ¬¡è®¿é—®*

*å½“æˆ‘ä»¬è¯•å›¾è®¿é—® http://localhost:3000 æ—¶ï¼Œæˆ‘ä»¬å°†è¢«é‡å®šå‘åˆ° Auth0 ç™»å½•æ¡†*

*![](img/2ccf9011422bc7b1400e205fc48bff5e.png)*

*ä¸€æ—¦åˆ›å»ºäº†ç”¨æˆ·ï¼Œnuxt-auth0 åº”ç”¨ç¨‹åºå°†è¯·æ±‚è®¿é—®æˆ‘ä»¬çš„ç§Ÿæˆ·å¸æˆ·*

*![](img/ebbc66f6ad6cffd4f745ddb0448297c4.png)*

*Allow offline access is requested because of refresh tokens.*

*å•å‡»â€œæ¥å—â€åï¼Œæˆ‘ä»¬å°†é‡å®šå‘åˆ°æˆ‘ä»¬çš„ç´¢å¼•é¡µé¢ã€‚*

*å·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚*

*æˆ‘å¸Œæœ›è¿™ä¸ªæ•™ç¨‹å¯¹ä½ æœ‰å¸®åŠ©ï¼*

***èµ„æº***

*ä½ å¯ä»¥åœ¨è¿™ä¸ª [GitHub åº“](https://github.com/abelland/nuxt-auth0)ä¸­æ‰¾åˆ°æœ€ç»ˆä»£ç *

***ç”¨ç®€å•è‹±è¯­å†™çš„ JavaScript ç¬”è®°***

*æˆ‘ä»¬å·²ç»æ¨å‡ºäº†ä¸‰ç§æ–°çš„å‡ºç‰ˆç‰©ï¼è¯·å…³æ³¨æˆ‘ä»¬çš„æ–°å‡ºç‰ˆç‰©:[**AI in Plain English**](https://medium.com/ai-in-plain-english)ï¼Œ[**UX in Plain English**](https://medium.com/ux-in-plain-english)ï¼Œ[**Python in Plain English**](https://medium.com/python-in-plain-english)**â€”è°¢è°¢ï¼Œç»§ç»­å­¦ä¹ ï¼***

***æˆ‘ä»¬ä¹Ÿä¸€ç›´æœ‰å…´è¶£å¸®åŠ©æ¨å¹¿é«˜è´¨é‡çš„å†…å®¹ã€‚å¦‚æœæ‚¨æœ‰ä¸€ç¯‡æ–‡ç« æƒ³è¦æäº¤ç»™æˆ‘ä»¬çš„ä»»ä½•å‡ºç‰ˆç‰©ï¼Œè¯·å‘é€ç”µå­é‚®ä»¶è‡³[**submissions @ plain English . io**](mailto:submissions@plainenglish.io)**ï¼Œä½¿ç”¨æ‚¨çš„ Medium ç”¨æˆ·åï¼Œæˆ‘ä»¬ä¼šå°†æ‚¨æ·»åŠ ä¸ºä½œè€…ã€‚å¦å¤–ï¼Œè¯·è®©æˆ‘ä»¬çŸ¥é“æ‚¨æƒ³åŠ å…¥å“ªä¸ª/å“ªäº›å‡ºç‰ˆç‰©ã€‚*****