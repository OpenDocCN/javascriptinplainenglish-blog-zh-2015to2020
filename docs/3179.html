<html>
<head>
<title>Interaction Testing with React Testing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React测试库进行交互测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/interaction-testing-with-react-testing-library-d824f74ce48a?source=collection_archive---------3-----------------------#2020-09-07">https://javascript.plainenglish.io/interaction-testing-with-react-testing-library-d824f74ce48a?source=collection_archive---------3-----------------------#2020-09-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="13cb" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">React组件测试的窗口</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c4fb5d998fd8a36cb58f547a7a359dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fc4D7D9urHFu0rbm8cpP2Q.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@dtravisphd" rel="noopener ugc nofollow" target="_blank">David Travis</a> on <a class="ae ks" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="8e48" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的旅程</h1><p id="c68e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">测试很复杂。我从来都不擅长这个。很长时间以来，我只关注基本的功能输入输出单元测试。为什么？因为它们很简单——不需要呈现HTML，不需要查询DOM元素，不需要与上述DOM元素交互。但是当然，React组件测试对于任何成熟的代码库都是必要的。终于到了我坐下来想清楚的时候了。</p><p id="15ea" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这时我发现了<a class="ae ks" href="https://testing-library.com/docs/intro" rel="noopener ugc nofollow" target="_blank"> React测试库</a>。突然间，一切似乎变得简单多了。所有我遇到的，但不理解的，让我推迟React组件测试的复杂性都消失了。希望同样的事情也会发生在你身上。</p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><h1 id="d556" class="kt ku in bd kv kw mt ky kz la mu lc ld jt mv ju lf jw mw jx lh jz mx ka lj lk bi translated">交互测试</h1><p id="e25b" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">顾名思义，交互测试测试与React组件的交互。它可以被认为是React组件的单元测试。您的测试将假装是用户——通过输入内容、点击按钮等与组件交互——并检查应该发生的事情是否发生。</p><p id="5d33" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">以这个简单的<code class="fe my mz na nb b">Counter</code>组件为例。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="e93d" class="ng ku in nb b gy nh ni l nj nk">function Counter() {<br/>  const [count, setCount] = useState(0);<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;p&gt;Count: {count}&lt;/p&gt;<br/>      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;<br/>        Increment<br/>      &lt;/button&gt;<br/>      {<br/>        count &gt; 0 &amp;&amp; (<br/>          &lt;button onClick={() =&gt; setCount(0)}&gt;<br/>            Decrement<br/>          &lt;/button&gt;<br/>        )<br/>      }<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ae62" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">用户可以与该组件进行两次交互——递增计数器或递减计数器(如果<code class="fe my mz na nb b">count</code>大于0)。单击相应的按钮后，组件将显示新值。</p><p id="7df7" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们将使用这个示例组件来介绍如何使用React测试库进行交互测试。</p><h1 id="cdba" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">翻译</h1><p id="6922" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">因此，让我们开始了解React测试库提供的工具。React组件测试的第一个基础是渲染。这就像调用React测试库中包含的<code class="fe my mz na nb b">render</code>函数一样简单。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="c4be" class="ng ku in nb b gy nh ni l nj nk">import { render } from '<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react';</span><span id="c856" class="ng ku in nb b gy nl ni l nj nk">test('render', () =&gt; {<br/>  render(&lt;Counter /&gt;);<br/>});</span></pre><p id="096c" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">瞧！就是字面意思。说真的。谁知道呢？</p><h1 id="09d2" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">询问</h1><p id="e237" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">好了，第一关已经过了。现在我们已经呈现了我们的组件，我们必须得到HTML元素进行交互。幸运的是，<a class="ae ks" href="https://testing-library.com/docs/dom-testing-library/api-queries" rel="noopener ugc nofollow" target="_blank"> React测试库通过<code class="fe my mz na nb b">render</code>函数响应提供了许多简单而整洁的查询</a>。在我们的测试中，<code class="fe my mz na nb b">getByText</code>会帮助查询供我们点击的按钮。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="3b02" class="ng ku in nb b gy nh ni l nj nk">test('queries existence', () =&gt; {<br/>  const { getByText } = render(&lt;Counter /&gt;);<br/>  const increment = getByText('Increment');<br/>});</span></pre><p id="525c" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">如果呈现的话，可以做类似的事情来获得减量按钮。如果not(当<code class="fe my mz na nb b">count</code>为0时)，<code class="fe my mz na nb b">getByText('Decrement')</code>将抛出一个错误，导致测试自动失败，即使我们还没有测试任何东西！在这种情况下，我们可以使用<code class="fe my mz na nb b">queryByText</code>来尝试和查询按钮。如果找不到元素，<code class="fe my mz na nb b">queryByText</code>将返回<code class="fe my mz na nb b">null</code>。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="0f98" class="ng ku in nb b gy nh ni l nj nk">test('queries non-existence', () =&gt; {<br/>  const { queryByText } = render(&lt;Counter /&gt;);<br/>  const decrement = queryByText('Decrement');<br/>});</span></pre><h1 id="abfd" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">点火事件</h1><p id="c92a" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">是时候互动了！React测试库提供了一个<code class="fe my mz na nb b">fireEvent</code>函数，包括对几乎所有DOM事件的<a class="ae ks" href="https://github.com/testing-library/dom-testing-library/blob/master/src/event-map.js" rel="noopener ugc nofollow" target="_blank">支持——键盘、鼠标、动画等。因为我们已经为增量和减量按钮定义了<code class="fe my mz na nb b">onClick</code>，我们将使用click事件。</a></p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="28a2" class="ng ku in nb b gy nh ni l nj nk">import { fireEvent, render} from '<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react';</span><span id="0340" class="ng ku in nb b gy nl ni l nj nk">test('fireEvent', () =&gt; {<br/>  const { getByText } = render(&lt;Counter /&gt;);<br/>  const increment = getByText('Increment');<br/>  fireEvent.click(increment);<br/>});</span></pre><p id="cef4" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">触发正确的事件很重要——否则，您期望的交互将不会发生。触发的事件必须与附加到元素的事件侦听器类型相同。否则，将不会触发事件监听器。在我们的<code class="fe my mz na nb b">Counter</code>组件中，按钮附带了<code class="fe my mz na nb b">onClick</code>事件监听器，因此只会被点击事件触发。这与浏览器实现不同，在浏览器实现中，<code class="fe my mz na nb b">click</code>事件也会触发<code class="fe my mz na nb b">mousedown</code>、<code class="fe my mz na nb b">mouseup</code>和其他事件。</p><h1 id="c1ca" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">验证</h1><p id="b5f7" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">恭喜你，你现在是React测试库的专家了！渲染、查询和触发事件几乎是您真正需要了解的所有具体的React测试库工具。</p><p id="12cc" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">等等，但是我们的测试还没有完成！是的，但是现在您已经学会了完成我们的测试所需的所有工具。</p><p id="ce35" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">让我们回顾一下我们需要处理的交互:</p><ul class=""><li id="45f0" class="nm nn in ln b lo mh lr mi lu no ly np mc nq mg nr ns nt nu bi translated">点击增量按钮，我们的计数器将增加</li><li id="c7ce" class="nm nn in ln b lo nv lr nw lu nx ly ny mc nz mg nr ns nt nu bi translated">点击减量按钮，我们的计数器将减少</li></ul><p id="475b" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们现在知道了如何触发按钮上的click事件，但是我们如何验证我们的counterchanged是否如预期的那样？更多查询！</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="5a3a" class="ng ku in nb b gy nh ni l nj nk">test('validation existence', () =&gt; {<br/>  const { getByText } = render(&lt;Counter /&gt;);<br/>  const increment = getByText('Increment');<br/>  fireEvent.click(increment);<br/>  expect(getByText('Count: 1')).toBeTruthy();<br/>  const decrement = getByText('Decrement');<br/>  fireEvent.click(decrement);<br/>  expect(getByText('Count: 0')).toBeTruthy();<br/>});</span></pre><p id="ffd1" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">就像我们如何查询按钮一样，我们可以查询组件来查看我们期望的更新是否发生了。在我们点击increment按钮之后，我们的组件被更新以显示新的<code class="fe my mz na nb b">count</code>。通过查询我们期望的新计数值，我们可以检查它的存在，以确定<code class="fe my mz na nb b">Counter</code>是否如预期的那样运行。</p><p id="c0ba" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">太好了！我们刚刚进行了测试，以确保按钮按预期工作。但是，对于我们的<code class="fe my mz na nb b">Counter</code>组件的完整测试覆盖，我们还需要确保减量按钮仅在<code class="fe my mz na nb b">count</code>大于0时呈现。使用同样的技术，但是使用<code class="fe my mz na nb b">queryByText</code>，我们可以测试这个。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="c346" class="ng ku in nb b gy nh ni l nj nk">test('validation non-existence', () =&gt; {<br/>  const { getByText, queryByText } = render(&lt;Counter /&gt;);<br/>  expect(queryByText('Decrement')).toBeNull()<br/>  const increment = getByText('Increment');<br/>  fireEvent.click(increment);<br/>  expect(queryByText('Decrement')).toBeTruthy()<br/>});</span></pre><p id="271c" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们首先通过验证<code class="fe my mz na nb b">queryByText</code>响应为空来确保减量按钮不存在。然后，我们递增计数器并验证递减按钮是否存在。</p><p id="dcef" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">就是这样！我们的<code class="fe my mz na nb b">Counter</code>组件已经过全面测试，我们可以非常自信地说，它完全符合预期。</p><h1 id="27ea" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">屏幕记录</h1><p id="683c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">哦等等！React测试库还提供了一个更有价值的工具:<code class="fe my mz na nb b">screen.debug</code>。这个函数将记录DOM结构。默认情况下，它会记录<code class="fe my mz na nb b">document.body</code>。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="2247" class="ng ku in nb b gy nh ni l nj nk">import { render, screen } from '<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react';</span><span id="be3e" class="ng ku in nb b gy nl ni l nj nk">test('debug default', () =&gt; {<br/>  render(&lt;Counter /&gt;);<br/>  screen.debug();<br/>  // output:<br/>  //   &lt;body&gt;<br/>  //     &lt;div&gt;<br/>  //       &lt;div&gt;<br/>  //         &lt;p&gt;<br/>  //           Count:<br/>  //           0<br/>  //         &lt;/p&gt;<br/>  //         &lt;button&gt;<br/>  //           Increment<br/>  //         &lt;/button&gt;<br/>  //       &lt;/div&gt;<br/>  //     &lt;/div&gt;<br/>  //   &lt;/body&gt;<br/>});</span></pre><p id="6a05" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">您还可以传入一个DOM元素来专门记录这一点。</p><pre class="kd ke kf kg gt nc nb nd ne aw nf bi"><span id="6df7" class="ng ku in nb b gy nh ni l nj nk">import { fireEvent, render, screen } from '<a class="ae ks" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank">@testing</a>-library/react';</span><span id="a4b2" class="ng ku in nb b gy nl ni l nj nk">test('debug element', () =&gt; {<br/>  const { getByText } = render(&lt;Counter /&gt;);<br/>  const increment = getByText('Increment');<br/>  screen.debug(increment);<br/>  // output:<br/>  //   &lt;button&gt;<br/>  //     Increment<br/>  //   &lt;/button&gt;<br/>});</span></pre><p id="5c8e" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">使用这个工具，您可以直观地检查和理解组件的DOM结构，从而可以制定测试组件所需的查询。</p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><h1 id="f355" class="kt ku in bd kv kw mt ky kz la mu lc ld jt mv ju lf jw mw jx lh jz mx ka lj lk bi translated">最后的想法</h1><p id="ab29" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">React Testing Library极大地简化了，并且，由于缺乏更好的术语，把它简化成你我都能理解和使用的东西。它提供的四个工具——渲染、查询、触发事件和屏幕记录——涵盖了交互测试的基础。既然您已经了解了这一点，那么就出去确保您的React组件没有错误！</p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><h1 id="3506" class="kt ku in bd kv kw mt ky kz la mu lc ld jt mv ju lf jw mw jx lh jz mx ka lj lk bi translated">资源</h1><ul class=""><li id="4464" class="nm nn in ln b lo lp lr ls lu oa ly ob mc oc mg nr ns nt nu bi translated"><a class="ae ks" href="https://testing-library.com/docs/react-testing-library/intro" rel="noopener ugc nofollow" target="_blank">官方React测试库文档</a></li><li id="6d3a" class="nm nn in ln b lo nv lr nw lu nx ly ny mc nz mg nr ns nt nu bi translated"><a class="ae ks" href="https://github.com/mjchang/medium/tree/master/interaction-testing" rel="noopener ugc nofollow" target="_blank">本文Github repo</a></li><li id="2b5e" class="nm nn in ln b lo nv lr nw lu nx ly ny mc nz mg nr ns nt nu bi translated"><a class="ae ks" href="https://codesandbox.io/s/github/mjchang/medium/tree/master/interaction-testing?file=/src/demo.test.js" rel="noopener ugc nofollow" target="_blank">本文的code sandbox</a></li></ul></div></div>    
</body>
</html>