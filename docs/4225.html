<html>
<head>
<title>Global Theming in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native中的全局主题化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/global-theming-in-react-native-using-styled-components-redux-toolkit-typescript-7621d2bddbcb?source=collection_archive---------3-----------------------#2020-11-26">https://javascript.plainenglish.io/global-theming-in-react-native-using-styled-components-redux-toolkit-typescript-7621d2bddbcb?source=collection_archive---------3-----------------------#2020-11-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="648a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用样式化组件和Redux工具包—类型脚本</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/f65c9d51785a8108842155a390c25b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nZ_AzJ0r08J0xxhF"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@walling?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Walling</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="42ff" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们面对现实吧，这些天，一个没有黑暗模式的应用程序属于一个博物馆；介于恐龙和轮子之间。作为消费者，我们希望看到酷的东西，作为开发者，我们希望构建酷的东西，黑暗模式很酷！幸运的是，有太多的图书馆可以帮助我们。在这篇文章中，我们将实现一个亮/暗模式特性，它将根据你的设备主题设置而改变。我们将用Styled-Components和Redux Toolkit在一个基本的React本地应用程序中构建它。</p><h1 id="6128" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">样式组件</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mh"><img src="../Images/40df59187b12036720b9b294f1bbdc6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZpBYX5X5iD6MhhG3"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@nukanchik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Juan Ordonez</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6851" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我认为他们的主页总结了样式组件的特别之处:</p><p id="be07" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">“使用ES6和CSS的精华，轻松打造您的应用💅🏾”<a class="ae ks" href="https://styled-components.com/" rel="noopener ugc nofollow" target="_blank">https://styled-components.com</a></p><p id="8f69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">像RonSeal一样，它完全按照罐头上说的做，它设计了可重用的组件！使用样式化组件，全局主题化很容易。</p><h1 id="0579" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">Redux工具包</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/8f7a011e8abdbba7165cfd326d819929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Cjkw3IFcnepGTOCc"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@healing_photographer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aarón Blanco Tejedor</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1dd3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果像我一样，你讨厌样板文件，像躲避瘟疫一样躲避Redux，并且害怕服用红色药丸；不用担心，RTK是国家管理头痛的答案。它让你在幸福的无知中掉进兔子洞。我最喜欢RTK的一点就是它引擎盖下使用了immer(<a class="ae ks" href="https://github.com/immerjs/immer" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">link</strong></a><strong class="kv io">)</strong>。如果你想了解更多，这里有一篇关于RTK的精彩文章，作者是Ohans Emmanuel:<a class="ae ks" href="https://www.ohansemmanuel.com/what-is-redux-toolkit/" rel="noopener ugc nofollow" target="_blank">https://www.ohansemmanuel.com/what-is-redux-toolkit/</a>。</p><h1 id="2833" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">我们正在建造的东西</h1><p id="9e13" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">我们将从头开始构建这个项目，但是如果你愿意跟随，你可以在这里克隆我的回购<a class="ae ks" href="https://github.com/claysimps/reactNativeResponsiveTheme" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/07a4d081a3a8cc7cf9bfd35d68598a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/1*uDqDZJGh9oG-pM2oEu4upg.gif"/></div></figure><h1 id="532a" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">我们走吧！</h1><p id="48af" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">我们需要初始化我们的项目，并安装我们将要使用的所有包，所以从终端键入:</p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="8a25" class="mu lq in mq b gy mv mw l mx my">npx react-native init globalThemeExample  --template react-native-template-typescript &amp;&amp; cd globalThemeExample &amp;&amp; yarn add styled-components react-native-appearance @reduxjs/toolkit react-redux reselect &amp;&amp; yarn add -D @types/react-redux @types/styled-components &amp;&amp; npx react-native run-ios</span></pre><p id="ffe5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这将使用Typescript模板创建一个新的基本React本机应用程序，导航到新的项目文件夹，添加依赖项和开发依赖项，然后在iOS模拟器上构建该应用程序。</p><h1 id="39a3" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">1.全球主题</h1><p id="85b2" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">当我们制作一个“全球”主题时，我们需要全球背景。在项目文件夹中，创建一个名为constants的新文件夹，然后在新文件夹中创建一个名为Theme.ts的文件，并添加以下代码:</p><p id="203c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">常量/主题. ts </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="5f73" class="mu lq in mq b gy mv mw l mx my">export const dark = {<br/>  background: '#121212',<br/>  text: '#F5AD93',<br/>};</span><span id="7623" class="mu lq in mq b gy mz mw l mx my">export const light = {<br/>  background: '#ECF0F3',<br/>  text: '#A40000',<br/>};</span><span id="b3f6" class="mu lq in mq b gy mz mw l mx my">type Theme = {<br/>  background: typeof dark.background | typeof light.background;<br/>  text: typeof dark.text | typeof light.text;<br/>};</span><span id="29c9" class="mu lq in mq b gy mz mw l mx my">export interface CustomThemeProps {<br/>  theme?: Theme;<br/>}</span></pre><p id="f099" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你的屏幕是一块画布，那么这个文件就是调色板上的所有颜色，所有样式组件都可以访问它(一旦我们完成)。你可以随意扩展这个文件，但是对于这个例子，我们只需要一个背景和一个文本颜色。对于我们的文本，我们将选择一个漂亮的深糖果苹果红。请注意，黑暗模式的文本颜色有不同的十六进制代码；这是一种较浅的红色(去饱和)，使其更清晰，更容易阅读。</p><p id="02ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们用深灰色作为背景色，因为你不应该用黑色作为黑暗模式。如果你想了解更多关于黑暗主题设计的信息，请查看材质界面<a class="ae ks" href="https://material.io/design/color/dark-theme.html" rel="noopener ugc nofollow" target="_blank">https://material.io/design/color/dark-theme.html</a>。此外，Eva设计系统是寻找语义颜色的一个很好的资源，所以也值得一提——我用它来为我们的黑暗模式获得去饱和的文本颜色:【https://colors.eva.design/?utm_campaign=eva_colors】T2——主页——Eva _ Design网站&amp;UTM _ source = Eva _ Design&amp;UTM _ medium = referral&amp;UTM _ content = Eva _ website _ menu。</p><p id="a1c7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们已经定义了我们的主题，让我们使用它。创建一个文件夹并将其命名为components，在components中创建一个文件并将其命名为ThemeManager.tsx，然后添加以下内容:</p><p id="6107" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">components/theme manager . tsx</strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="cf24" class="mu lq in mq b gy mv mw l mx my">import React from 'react';<br/>import {StatusBar} from 'react-native';<br/>import styled, {ThemeProvider} from 'styled-components/native';</span><span id="0e4e" class="mu lq in mq b gy mz mw l mx my">import {CustomThemeProps, light} from '../../constants/theme';</span><span id="5616" class="mu lq in mq b gy mz mw l mx my">const StyledThemeContainer = styled.KeyboardAvoidingView&lt;CustomThemeProps&gt;`<br/>  flex: 1;<br/>  align-items: center;<br/>  justify-content: center;<br/>  background: ${(props) =&gt; props.theme.background};<br/>`;</span><span id="47b5" class="mu lq in mq b gy mz mw l mx my">export const ThemeManager = ({children}: {<br/>  children: React.reactNode<br/>}) =&gt; {<br/>  return (<br/>    &lt;ThemeProvider theme={light}&gt;<br/>      &lt;StatusBar barStyle={'light-content'} /&gt;<br/>      &lt;StyledThemeContainer&gt;{children}&lt;/StyledThemeContainer&gt;<br/>    &lt;/ThemeProvider&gt;<br/>  );<br/>};</span></pre><p id="2808" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ThemeProvider是向所有子组件提供主题设置的组件。由于我们提供了灯光主题，所有子组件都将呈现灯光主题的颜色。</p><p id="c222" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要在整个应用程序中使用主题，我们需要将新的ThemeManager组件添加到App.tsx文件中:</p><p id="2e2a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> App.tsx </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="a0bf" class="mu lq in mq b gy mv mw l mx my">import React from 'react';<br/>import {SafeAreaView, Text} from 'react-native';<br/>import {ThemeManager} from './components/ThemeManager';</span><span id="ee7a" class="mu lq in mq b gy mz mw l mx my">const App = () =&gt; {<br/>  return (<br/>      &lt;ThemeManager&gt;<br/>        &lt;SafeAreaView&gt;<br/>          &lt;Text&gt;Hello world&lt;/Text&gt;<br/>        &lt;/SafeAreaView&gt;<br/>      &lt;/ThemeManager&gt;<br/>  );<br/>};</span><span id="3df1" class="mu lq in mq b gy mz mw l mx my">export default App;</span></pre><h1 id="d5e2" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">2.Redux工具包</h1><p id="806a" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">在项目文件夹中，创建一个名为“state”的文件夹，并添加以下两个文件:</p><p id="5ee8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> state/themeMode.slice.ts </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="f7a2" class="mu lq in mq b gy mv mw l mx my">import {Appearance} from 'react-native';<br/>import {createSlice} from '@reduxjs/toolkit';</span><span id="4a44" class="mu lq in mq b gy mz mw l mx my">export enum ThemeModeEnum {<br/>  LIGHT = 'light',<br/>  DARK = 'dark',<br/>}</span><span id="b9e3" class="mu lq in mq b gy mz mw l mx my">export const defaultMode = Appearance.getColorScheme() || ThemeModeEnum.LIGHT;</span><span id="24b3" class="mu lq in mq b gy mz mw l mx my">const themeModeSlice = createSlice({<br/>  name: 'themeMode',<br/>  initialState: {<br/>    themeMode: defaultMode as ThemeModeEnum,<br/>  },<br/>  reducers: {<br/>    setThemeMode: (state, action: {payload: ThemeModeEnum}) =&gt; {<br/>      state.themeMode = action.payload;<br/>    },<br/>  },<br/>});</span><span id="f1fd" class="mu lq in mq b gy mz mw l mx my">export const {setThemeMode} = themeModeSlice.actions;</span><span id="2fac" class="mu lq in mq b gy mz mw l mx my">export default themeModeSlice.reducer;</span></pre><p id="43a4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们使用“外观”来获取设备当前的主题设置，稍后当我们编辑主题管理器文件时需要用到它。</p><p id="a8d2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">状态/索引. ts </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="e1e3" class="mu lq in mq b gy mv mw l mx my">import {configureStore} from '@reduxjs/toolkit';<br/>import themeModeReducer from './themeMode.slice';</span><span id="1745" class="mu lq in mq b gy mz mw l mx my">export const store = configureStore({<br/>  reducer: {<br/>    themeMode: themeModeReducer,<br/>  },<br/>});</span><span id="3934" class="mu lq in mq b gy mz mw l mx my">export type AppDispatch = typeof store.dispatch;<br/>export type RootState = ReturnType&lt;typeof store.getState&gt;;</span></pre><p id="cefd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是我们将减速器添加到商店的地方，在我们的例子中，只是themeModeReducer。要改变我们主题的状态，我们需要知道我们从什么地方改变它(当前状态)。为此，我们将使用来自重新选择的createSelector:</p><p id="cb23" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">选择器/getThemeMode.ts </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="7d49" class="mu lq in mq b gy mv mw l mx my">import {createSelector} from 'reselect';<br/>import {RootState} from '../state';</span><span id="5cd5" class="mu lq in mq b gy mz mw l mx my">export const getThemeMode = createSelector(<br/>  (state: RootState) =&gt; state,<br/>  (state) =&gt; state.themeMode,<br/>);</span></pre><p id="8512" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们可以检索主题的当前状态，但是我们还需要更新状态。为此，我们将创建自己的定制调度挂钩:</p><p id="1641" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">Utils/use app dispatch . ts</strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="02fe" class="mu lq in mq b gy mv mw l mx my">import {useDispatch} from 'react-redux';<br/>import {AppDispatch} from '../state';</span><span id="82c7" class="mu lq in mq b gy mz mw l mx my">export const useAppDispatch = () =&gt; useDispatch&lt;AppDispatch&gt;();</span></pre><p id="5b7f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们需要将我们的reducer添加到App文件中:</p><p id="ac7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> App.tsx </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="ff3f" class="mu lq in mq b gy mv mw l mx my">import React from 'react';<br/>import {SafeAreaView, Text} from 'react-native';<br/>import {Provider} from 'react-redux';</span><span id="b38d" class="mu lq in mq b gy mz mw l mx my">import {ThemeManager} from './components/ThemeManager';<br/>import {store} from './state';</span><span id="7d37" class="mu lq in mq b gy mz mw l mx my">const App = () =&gt; (<br/>  &lt;Provider store={store}&gt;<br/>    &lt;ThemeManager&gt;<br/>      &lt;SafeAreaView&gt;<br/>        &lt;Text&gt;Hello world&lt;/Text&gt;<br/>      &lt;/SafeAreaView&gt;<br/>    &lt;/ThemeManager&gt;<br/>  &lt;/Provider&gt;<br/>);</span><span id="8523" class="mu lq in mq b gy mz mw l mx my">export default App;</span></pre><h1 id="0313" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">3.主题模式开关</h1><p id="819b" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">为了让我们的开关组件可以控制主题，我们需要返回到我们的主题管理器文件，并将其更改为:</p><p id="8677" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">components/theme manager . tsx</strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="b09a" class="mu lq in mq b gy mv mw l mx my">import React from 'react';<br/>import {StatusBar} from 'react-native';<br/>import styled, {ThemeProvider} from 'styled-components/native';<br/>import {useSelector} from 'react-redux';</span><span id="e2b8" class="mu lq in mq b gy mz mw l mx my">import {CustomThemeProps, light, dark} from '../../constants/theme';<br/>import {getThemeMode} from '../../selectors/getThemeMode';<br/>import {ThemeModeEnum} from '../../state/themeMode.slice';</span><span id="2430" class="mu lq in mq b gy mz mw l mx my">const StyledThemeContainer = styled.KeyboardAvoidingView&lt;CustomThemeProps&gt;`<br/>  flex: 1;<br/>  align-items: center;<br/>  justify-content: center;<br/>  background: ${(props) =&gt; props.theme.background};<br/>`;</span><span id="0627" class="mu lq in mq b gy mz mw l mx my">const {DARK, LIGHT} = ThemeModeEnum;</span><span id="3194" class="mu lq in mq b gy mz mw l mx my">export const ThemeManager = <!-- -->({children}: {children: React.ReactNode}) =&gt; {</span><span id="dcf0" class="mu lq in mq b gy mz mw l mx my">const {themeMode} = useSelector(getThemeMode);</span><span id="e364" class="mu lq in mq b gy mz mw l mx my">const providedTheme = () =&gt; {<br/>    if (themeMode === DARK) {<br/>      return dark;<br/>    }<br/>    if (themeMode === LIGHT) {<br/>      return light;<br/>    }<br/>  };<br/>  return (<br/>    &lt;ThemeProvider theme={providedTheme}&gt;<br/>      &lt;StatusBar<br/>        barStyle={themeMode === DARK ? 'light-content' : 'dark-content'}<br/>      /&gt;<br/>      &lt;StyledThemeContainer&gt;{children}&lt;/StyledThemeContainer&gt;<br/>    &lt;/ThemeProvider&gt;<br/>  );</span></pre><p id="7e4e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在是时候构建我们的交换机了:</p><p id="4c42" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">components/theme mode switch . tsx</strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="52c1" class="mu lq in mq b gy mv mw l mx my">import React from 'react';<br/>import {Switch} from 'react-native';<br/>import {useSelector} from 'react-redux';</span><span id="5dc7" class="mu lq in mq b gy mz mw l mx my">import {getThemeMode} from '../../selectors/getThemeMode';<br/>import {useAppDispatch} from '../../utils/useAppDispatch';<br/>import {ThemeModeEnum, setThemeMode} from '../../state/themeMode.slice';<br/>import {<br/>  StyledSwitchWrapper,<br/>  StyledThemeContainer,<br/>  StyledToggleText,<br/>} from './ThemeModeSwitch.styles';</span><span id="aa9c" class="mu lq in mq b gy mz mw l mx my">const {LIGHT, DARK} = ThemeModeEnum;</span><span id="562c" class="mu lq in mq b gy mz mw l mx my">export const ThemeModeSwitch = () =&gt; {<br/>  const {themeMode} = useSelector(getThemeMode);<br/>  const dispatch = useAppDispatch();</span><span id="f8e7" class="mu lq in mq b gy mz mw l mx my">return (<br/>    &lt;StyledThemeContainer&gt;<br/>      &lt;StyledSwitchWrapper&gt;<br/>        &lt;StyledToggleText&gt;Dark mode&lt;/StyledToggleText&gt;<br/>        &lt;Switch<br/>          value={themeMode === DARK}<br/>          onValueChange={(value) =&gt; {<br/>            dispatch(setThemeMode(value ? DARK : LIGHT));<br/>          }}<br/>        /&gt;<br/>      &lt;/StyledSwitchWrapper&gt;<br/>    &lt;/StyledThemeContainer&gt;<br/>  );<br/>};</span></pre><p id="b6c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">components/thememodeswitch . styles . ts</strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="f912" class="mu lq in mq b gy mv mw l mx my">import styled from 'styled-components/native';<br/>import {CustomThemeProps} from '../../constants/theme';</span><span id="f28a" class="mu lq in mq b gy mz mw l mx my">export const StyledThemeContainer = styled.View`<br/>  flex: 1;<br/>  flex-direction: row;<br/>  align-items: center;<br/>  justify-content: center;<br/>  width: 90%;<br/>  padding: 30px 0;<br/>`;</span><span id="14ab" class="mu lq in mq b gy mz mw l mx my">export const StyledSwitchWrapper = styled.View`<br/>  flex-direction: row;<br/>  justify-content: space-between;<br/>  width: 90%;<br/>`;</span><span id="0ecf" class="mu lq in mq b gy mz mw l mx my">export const StyledToggleText = styled.Text&lt;CustomThemeProps&gt;`<br/>  color: ${(props) =&gt; props.theme.text};<br/>  font-size: 20px;</span></pre><p id="e2f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们将新的开关添加到我们的应用程序文件中，并进行测试！</p><p id="96ea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> App.tsx </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="dca7" class="mu lq in mq b gy mv mw l mx my">import React from 'react';<br/>import {SafeAreaView} from 'react-native';<br/>import {Provider} from 'react-redux';</span><span id="9f58" class="mu lq in mq b gy mz mw l mx my">import {ThemeManager} from './components/ThemeManager';<br/>import {store} from './state';<br/>import {ThemeModeSwitch} from './components/ThemeModeSwitch';</span><span id="a681" class="mu lq in mq b gy mz mw l mx my">const App = () =&gt; (<br/>  &lt;Provider store={store}&gt;<br/>    &lt;ThemeManager&gt;<br/>      &lt;SafeAreaView&gt;<br/>        &lt;ThemeModeSwitch /&gt;<br/>      &lt;/SafeAreaView&gt;<br/>    &lt;/ThemeManager&gt;<br/>  &lt;/Provider&gt;<br/>);</span><span id="bcbd" class="mu lq in mq b gy mz mw l mx my">export default App;</span></pre><h1 id="f661" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">4.响应主题</h1><p id="6dc5" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">现在剩下要做的就是让我们的主题响应设备的主题设置。</p><p id="bbea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> ThemeManager.tsx </strong></p><pre class="kd ke kf kg gt mp mq mr ms aw mt bi"><span id="ce53" class="mu lq in mq b gy mv mw l mx my">import React, {useEffect} from 'react';<br/>import {StatusBar, Appearance} from 'react-native';<br/>import styled, {ThemeProvider} from 'styled-components/native';<br/>import {useSelector} from 'react-redux';</span><span id="97b6" class="mu lq in mq b gy mz mw l mx my">import {CustomThemeProps, light, dark} from '../../constants/theme';<br/>import {getThemeMode} from '../../selectors/getThemeMode';<br/>import {ThemeModeEnum, setThemeMode} from '../../state/themeMode.slice';<br/>import {useAppDispatch} from '../../utils/useAppDispatch';</span><span id="636b" class="mu lq in mq b gy mz mw l mx my">const StyledThemeContainer = styled.KeyboardAvoidingView&lt;CustomThemeProps&gt;`<br/>  flex: 1;<br/>  align-items: center;<br/>  justify-content: center;<br/>  background: ${(props) =&gt; props.theme.background};<br/>`;</span><span id="b0ad" class="mu lq in mq b gy mz mw l mx my">const {DARK, LIGHT} = ThemeModeEnum;</span><span id="4803" class="mu lq in mq b gy mz mw l mx my">export const ThemeManager = ({children}: {children: React.ReactNode}) =&gt; {</span><span id="d9dc" class="mu lq in mq b gy mz mw l mx my">const {themeMode} = useSelector(getThemeMode);<br/>  const dispatch = useAppDispatch();</span><span id="4460" class="mu lq in mq b gy mz mw l mx my">const providedTheme = () =&gt; {<br/>    if (themeMode === DARK) {<br/>      return dark;<br/>    }<br/>    if (themeMode === LIGHT) {<br/>      return light;<br/>    }<br/>  };</span><span id="84dd" class="mu lq in mq b gy mz mw l mx my">useEffect(() =&gt; {<br/>    const subscription = Appearance.addChangeListener(({colorScheme}) =&gt; {<br/>      dispatch(setThemeMode(colorScheme as ThemeModeEnum));<br/>    });<br/>    return () =&gt; subscription.remove();<br/>  }, [dispatch]);<br/>  return (<br/>    &lt;ThemeProvider theme={providedTheme}&gt;<br/>      &lt;StatusBar<br/>        barStyle={themeMode === DARK ? 'light-content' : 'dark-content'}<br/>      /&gt;<br/>      &lt;StyledThemeContainer&gt;{children}&lt;/StyledThemeContainer&gt;<br/>    &lt;/ThemeProvider&gt;<br/>  );<br/>};</span></pre><p id="bb81" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">瞧啊。关闭你的应用程序，更改你的设备主题设置，回到你的应用程序，惊叹你的才华！</p></div></div>    
</body>
</html>