<html>
<head>
<title>Build your first Serverless App with AWS Lambda, API Gateway, Express, and Typescript — 2020</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda、API Gateway、Express和Typescript构建您的第一个无服务器应用程序— 2020</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-your-first-serverless-app-with-aws-lambda-api-gateway-express-and-typescript-2020-4841f54514eb?source=collection_archive---------0-----------------------#2020-07-11">https://javascript.plainenglish.io/build-your-first-serverless-app-with-aws-lambda-api-gateway-express-and-typescript-2020-4841f54514eb?source=collection_archive---------0-----------------------#2020-07-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/77fe861832ee9131d165439bf4fd2e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOUCJiB5xiETtu5Hu1nY_w.png"/></div></div></figure><p id="1b58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文将向您展示如何使用AWS Lambda和API Gateway在Typescript中构建一个无服务器Express应用程序。你会在这里找到代码<a class="ae kw" href="https://github.com/00karthik/serverless-typescript/" rel="noopener ugc nofollow" target="_blank"/>。我们将在本文中讨论的主题是:</p><ol class=""><li id="a7ff" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><a class="ae kw" href="#543d" rel="noopener ugc nofollow">项目设置</a></li><li id="1bd5" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="#3766" rel="noopener ugc nofollow">添加Express.js </a></li><li id="7c44" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="#525b" rel="noopener ugc nofollow">部署</a></li></ol><p id="7189" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器</a>框架是一个更通用的工具，用于部署和管理无服务器应用程序。它简化了功能及其连接服务的配置和部署。<a class="ae kw" href="https://aws.amazon.com/lambda/serverless-architectures-learn-more/" rel="noopener ugc nofollow" target="_blank">无服务器架构</a>让你执行一段代码，只对你使用的资源收费，不像静态服务器那样即使使用率低也收取固定价格。作为开发人员，这意味着您不必考虑管理服务器和扩展。你只需要专注于代码。本文将指导您使用<a class="ae kw" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lamd </a> a和<a class="ae kw" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> AWS API Gateway </a>构建一个在E <a class="ae kw" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> xpress.js </a>上运行的无服务器API的步骤。Typescript用于编写代码，因为它支持静态类型，这将减少编译时错误。</p><p id="2881" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始之前，您需要</p><ol class=""><li id="68c4" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">Typescript，Node.js，npm，Express.js的基础知识。</li><li id="88b9" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">亚马逊网络服务(AWS)帐户。</li></ol><p id="e349" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文假设您的系统中已经安装了Node.js和npm。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="543d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">项目设置</h1><p id="9b17" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">让我们使用以下命令全局安装<a class="ae kw" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器</a>框架和<a class="ae kw" href="https://www.npmjs.com/package/aws-sdk" rel="noopener ugc nofollow" target="_blank"> AWS-SDK </a>模块:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="b0ea" class="ne lt iq na b gy nf ng l nh ni">npm i -g serverless aws-sdk</span></pre><p id="b149" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在创建一个项目文件夹，并初始化一个npm来创建一个<code class="fe nj nk nl na b">package.json</code>文件。然后在项目文件夹中创建一个新的无服务器服务。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="002c" class="ne lt iq na b gy nf ng l nh ni">mkdir my-serverless-project<br/>cd my-serverless-project<br/>serverless create --template <!-- -->aws-nodejs-typescript<br/>npm install</span></pre><p id="744d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无服务器框架为应用程序生成样板文件。其中<code class="fe nj nk nl na b">handler.ts</code>和<code class="fe nj nk nl na b">serverless.yml</code>意义重大。文件<code class="fe nj nk nl na b">handler.ts</code>类似于传统Node.js应用程序中的<code class="fe nj nk nl na b">index.js</code>文件。这是开始执行的文件。</p><p id="996a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们将安装<code class="fe nj nk nl na b"><a class="ae kw" href="https://www.npmjs.com/package/serverless-offline" rel="noopener ugc nofollow" target="_blank">serverless-offline</a></code>,这是一个用于在本地主机上运行无服务器框架的插件。这将在您的本地机器上模拟Lambda和API网关，以加速您的开发周期。否则，您将不得不在每次测试变更时进行部署。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="ebe0" class="ne lt iq na b gy nf ng l nh ni">npm install -D serverless-offline</span></pre><p id="e0f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">修改<code class="fe nj nk nl na b">serverless.yml</code>文件以包含插件。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="1b7f" class="ne lt iq na b gy nf ng l nh ni">service:<br/>  name: serverless<em class="nm"><br/></em>custom:<br/>  webpack:<br/>    webpackConfig: ./webpack.config.js<br/>    includeModules: true<em class="nm"><br/></em>plugins:<br/>  - serverless-webpack<br/>  - serverless-offline<br/>provider:<br/>  name: aws<br/>  runtime: nodejs12.x<br/>  apiGateway:<br/>    minimumCompressionSize: 1024<br/>  environment:<br/>    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1<br/>functions:<br/>  hello:<br/>    handler: handler.hello<br/>    events:<br/>      - http:<br/>          method: get<br/>          path: /</span></pre><p id="2044" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在项目文件夹中运行以下命令来启动无服务器脱机服务器。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="748d" class="ne lt iq na b gy nf ng l nh ni">serverless offline start</span></pre><p id="f36d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你会看到下面的屏幕，当你在浏览器中输入<code class="fe nj nk nl na b"><a class="ae kw" href="http://localhost:3000/dev" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/dev</a></code>时，你会看到服务器的响应。默认情况下，无服务器脱机运行在端口3000</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/ea4f0474d5133f5628da1c3d7508e5fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moBI8wXMsCoBW1xIeDOi8A.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk">serverless in localhost:3000</figcaption></figure><p id="9272" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经完成了无服务器应用程序的基本设置。在下一节中，我们将向我们的应用程序添加Typescript。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="3766" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">向我们的应用程序添加Express.js</h1><p id="5a32" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">首先，我们将安装在我们的项目中运行express应用程序所需的必要包。我们必须用<code class="fe nj nk nl na b">handler.ts</code>替换<code class="fe nj nk nl na b">handler.js</code>文件。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="2bff" class="ne lt iq na b gy nf ng l nh ni">npm i aws-lambda serverless-http express @types/express<br/>rm handler.js<br/>touch handler.ts</span></pre><p id="1c73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将以下代码添加到我们的<code class="fe nj nk nl na b">handler.ts</code>文件中，以初始化我们的两条路由:</p><ol class=""><li id="91cb" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">一条<code class="fe nj nk nl na b">/message</code>路线。</li><li id="ff11" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">为除<code class="fe nj nk nl na b">/message</code>之外的所有路由发送<strong class="ka ir"> <em class="nm">服务器正在运行</em> </strong>消息的回退路由</li></ol><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="6481" class="ne lt iq na b gy nf ng l nh ni">import { APIGatewayProxyHandler } <em class="nm">from</em> 'aws-lambda';<br/>import serverless <em class="nm">from</em> 'serverless-http';<br/>import express, { Request, Response } <em class="nm">from</em> 'express';</span><span id="80d3" class="ne lt iq na b gy ns ng l nh ni">const app = express();</span><span id="5988" class="ne lt iq na b gy ns ng l nh ni">app.get('/message', (req: Request, res: Response) =&gt; {<br/>  res.send({ message: 'This is message route' });<br/>});</span><span id="d75c" class="ne lt iq na b gy ns ng l nh ni">app.use((req: Request, res: Response) =&gt; {<br/>  res.send({ message: 'Server is running' });<br/>});</span><span id="fa93" class="ne lt iq na b gy ns ng l nh ni"><em class="nm">export</em> const hello: APIGatewayProxyHandler = serverless(app);</span></pre><p id="93a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要修改<code class="fe nj nk nl na b">serverless.yml</code>来让hello函数捕获所有的HTTP请求。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="dd5c" class="ne lt iq na b gy nf ng l nh ni">service: <br/>  name: serverless<em class="nm"><br/></em>custom:<br/>  webpack:<br/>    webpackConfig: ./webpack.config.js<br/>    includeModules: true<em class="nm"><br/></em>plugins:<br/>  - serverless-webpack<br/>  - serverless-offline<br/>provider:<br/>  name: aws<br/>  runtime: nodejs12.x<br/>  apiGateway:<br/>    minimumCompressionSize: 1024<br/>  environment:<br/>    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1<br/>functions:<br/>  hello:<br/>    handler: handler.hello<br/>    events:<br/>      - http: ANY /<br/>      - http: 'ANY {proxy+}'</span></pre><p id="3bbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重启服务器并转到<code class="fe nj nk nl na b">http://localhost:3000/dev/message</code>查看响应。耶！您已经成功创建了一个无服务器lambda函数！</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="525b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">部署您的第一个无服务器应用程序</h1><p id="2631" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">此外，从拥有部署应用程序所需的所有权限的AWS帐户获取密钥和机密。运行以下命令将允许您添加密钥和机密。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="0da0" class="ne lt iq na b gy nf ng l nh ni">serverless config credentials — provider aws — key &lt;your-access-key-id&gt; — secret &lt;your-secret-key&gt;</span></pre><p id="8b69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行以下命令将您的应用程序部署到AWS。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="37e7" class="ne lt iq na b gy nf ng l nh ni">serverless deploy</span></pre><p id="8fe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">成功部署后，命令行中将显示一个链接。这将是API网关链接</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/f58342eb281dd6aea9d6ec522bdd1f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*np_Q2Gisp_CF9tI_E5zBOA.png"/></div></div></figure><p id="50e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经成功地创建了一个lambda函数，并将其部署到AWS。</p><p id="bdda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在这个<a class="ae kw" href="https://github.com/00karthik/serverless-typescript/" rel="noopener ugc nofollow" target="_blank">库</a>中找到完整的代码。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="f1a4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">下一步是什么？</h1><ol class=""><li id="e574" class="kx ky iq ka b kb mq kf mr kj nu kn nv kr nw kv lc ld le lf bi translated">现在，您可以将您的路线添加到应用程序中。您需要添加<code class="fe nj nk nl na b"><a class="ae kw" href="https://www.npmjs.com/package/body-parser" rel="noopener ugc nofollow" target="_blank">body-parser</a></code>作为中间件来解析传入的请求。</li><li id="8adf" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">添加<code class="fe nj nk nl na b"><a class="ae kw" href="https://www.npmjs.com/package/prettier" rel="noopener ugc nofollow" target="_blank">prettier</a></code>和<code class="fe nj nk nl na b"><a class="ae kw" href="https://www.npmjs.com/package/eslint" rel="noopener ugc nofollow" target="_blank">es-lint</a></code>进行代码格式化。</li><li id="ad49" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">您可以设置CI/CD管道来自动化部署过程。</li></ol><h1 id="b12f" class="ls lt iq bd lu lv nx lx ly lz ny mb mc md nz mf mg mh oa mj mk ml ob mn mo mp bi translated">参考</h1><ol class=""><li id="f49a" class="kx ky iq ka b kb mq kf mr kj nu kn nv kr nw kv lc ld le lf bi translated">https://www.serverless.com/blog/serverless-express-rest-api<a class="ae kw" href="https://www.serverless.com/blog/serverless-express-rest-api" rel="noopener ugc nofollow" target="_blank"/></li><li id="bf0f" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://medium.com/linkit-intecs/typescript-project-using-serverless-framework-c3bfc16c2a7c" rel="noopener">https://medium . com/linkit-intecs/typescript-project-using-server less-framework-C3 bfc 16 C2 a 7 c</a></li><li id="dd0b" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://www.freecodecamp.org/news/express-js-and-aws-lambda-a-serverless-love-story-7c77ba0eaa35/" rel="noopener ugc nofollow" target="_blank">https://www . freecodecamp . org/news/express-js-and-AWS-lambda-a-server less-love-story-7c 77 ba 0 EAA 35/</a></li></ol></div></div>    
</body>
</html>