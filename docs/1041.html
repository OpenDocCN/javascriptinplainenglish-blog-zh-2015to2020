<html>
<head>
<title>Redux-Thunk vs Redux-Saga</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux-Thunk vs Redux-Saga</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/redux-thunk-vs-redux-saga-8c93fc822de?source=collection_archive---------0-----------------------#2020-01-20">https://javascript.plainenglish.io/redux-thunk-vs-redux-saga-8c93fc822de?source=collection_archive---------0-----------------------#2020-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/382a0f9d3a799096d65b71056258dae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMM7BJOflHvgiU-eqXkLIg.jpeg"/></div></div></figure><p id="4c44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如今，所有动态web应用程序都需要使用异步任务。作为一名react开发人员，您可能会在职业生涯中使用Redux-Thunk，并对迁移另一个解决方案感到不舒服，例如最近几年成为趋势的Redux-Saga。是的，它有不同的语法，当你第一次检查它时，它看起来很混乱，没有意义。</p><p id="9e8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与Redux-Thunk相比，Redux-Saga的好处是您可以更容易地测试您的异步数据流。</p><p id="b731" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，Redux-Thunk对于小型项目和刚刚进入React生态系统的开发人员来说非常棒。thunks的逻辑都包含在函数内部。更重要的是，你不需要学习Redux-Saga附带的奇怪和不同的语法。然而，在本教程中，我将向您展示如何轻松地从Redux-Thunk迁移到Redux-Saga，并将解释那个奇怪的语法:d。</p><p id="86ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们先安装一些依赖项。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a535" class="lf lg iq lb b gy lh li l lj lk">npm i --save react-redux redux redux-logger redux-saga redux-thunk</span></pre><p id="7701" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要在项目中设置一个Redux。让我们创建一个Redux文件夹，然后在里面放入<strong class="ka ir"> store.js </strong>文件。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="8a7b" class="lf lg iq lb b gy lh li l lj lk">import { createStore, applyMiddleware } from 'redux';<br/>import logger from 'redux-logger';<br/>import thunk from 'redux-thunk';</span><span id="179d" class="lf lg iq lb b gy ll li l lj lk">import rootReducer from './root-reducer';</span><span id="dae7" class="lf lg iq lb b gy ll li l lj lk">const middlewares = [thunk];</span><span id="01bd" class="lf lg iq lb b gy ll li l lj lk">if (process.env.NODE_ENV === 'development') {<br/>  middlewares.push(logger);<br/>}</span><span id="7714" class="lf lg iq lb b gy ll li l lj lk">export const store = createStore(rootReducer, applyMiddleware(...middlewares));</span><span id="6687" class="lf lg iq lb b gy ll li l lj lk">export default store;</span></pre><p id="aa01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们需要创建<strong class="ka ir"> root-reducer.js </strong></p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="06a4" class="lf lg iq lb b gy lh li l lj lk">import { combineReducers } from 'redux';<br/>import fetchTasksReducer from './reducers/fetchTasksReducer'</span><span id="5477" class="lf lg iq lb b gy ll li l lj lk">const rootReducer = combineReducers({<br/> tasks: <!-- -->fetchTasksReducer<!-- -->,<br/>});</span><span id="1410" class="lf lg iq lb b gy ll li l lj lk">export default rootReducer;</span></pre><p id="92d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">别忘了在<strong class="ka ir"> App.js </strong>里面导入我们的商店</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a139" class="lf lg iq lb b gy lh li l lj lk">import React, { Component } from 'react';<br/>import { BrowserRouter, Route } from 'react-router-dom';<br/>import { Provider } from 'react-redux';<br/>import Tasks from './components/tasks';<br/>import './App.css';</span><span id="86f6" class="lf lg iq lb b gy ll li l lj lk">const store = require('./reducers').init();</span><span id="58f1" class="lf lg iq lb b gy ll li l lj lk">class App extends Component {<br/>render() {<br/>return (<br/>&lt;Provider store={store}&gt;<br/>&lt;BrowserRouter&gt;<br/>&lt;div className='App'&gt;<br/>&lt;div className='container'&gt;<br/>&lt;Route exact path='/' component={Tasks} /&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;/BrowserRouter&gt;<br/>&lt;/Provider&gt;<br/>);<br/>}<br/>}<br/>export default App;</span></pre><p id="7e9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要创建一个<code class="fe lm ln lo lb b">fetchTasksReducer</code>。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="414b" class="lf lg iq lb b gy lh li l lj lk">...</span><span id="b2b8" class="lf lg iq lb b gy ll li l lj lk">const INITIAL_STATE = {<br/>  tasks: null,<br/>  isFetching: false,<br/>  errorMessage: undefined<br/>};</span><span id="f80b" class="lf lg iq lb b gy ll li l lj lk">const <!-- -->fetchTasksReducer<!-- --> = (state = INITIAL_STATE, action) =&gt; {<br/>  switch (action.type) {<br/>    case "<!-- -->FETCH_TASKS_START"<!-- -->:<br/>      return {<br/>        ...state,<br/>        isFetching: true<br/>      };<br/>    case <!-- -->"FETCH_TASKS_SUCCESS":<br/>      return {<br/>        ...state,<br/>        isFetching: false,<br/>        tasks: action.payload<br/>      };<br/>    case <!-- -->"FETCH_TASKS_ERROR":<br/>      return {<br/>        ...state,<br/>        isFetching: false,<br/>        errorMessage: action.payload<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="c9b2" class="lf lg iq lb b gy ll li l lj lk">export default <!-- -->fetchTasksReducer<!-- -->;</span></pre><p id="d577" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每当我们调度一个动作时，该动作会通过<code class="fe lm ln lo lb b">fetchTasksReducer</code>并根据需要更新我们的状态。这三个条件是如何工作的:</p><ul class=""><li id="dbf7" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated"><code class="fe lm ln lo lb b">FETCH_TASKS_START</code> : HTTP请求已经开始，这是展示一个spinner的好时机，比如让用户知道有一些进程正在运行。</li><li id="ca3a" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe lm ln lo lb b">FETCH_TASKS_SUCCESS</code> : HTTP请求成功，我们必须更新状态。</li><li id="56b1" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe lm ln lo lb b">FETCH_TASKS_ERROR</code> : HTTP请求失败。您可以显示一个错误组件，让用户了解问题。</li></ul><h1 id="d741" class="md lg iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">还原-thunk</h1><p id="0eb1" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">目前，我们的应用程序并不像预期的那样工作，因为我们需要一个动作创建器来触发我们的reducer处理的动作。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="969a" class="lf lg iq lb b gy lh li l lj lk">export const <!-- -->fetchTasksStarted<!-- --> = () =&gt; ({<br/>  type: <!-- --> "FETCH_TASKS_START"<br/>});</span><span id="e395" class="lf lg iq lb b gy ll li l lj lk">export const <!-- -->fetchTasksSuccess<!-- --> = tasks =&gt; ({<br/>  type: <!-- -->"FETCH_TASKS_SUCCESS"<!-- -->,<br/>  payload: tasks<br/>});</span><span id="9c85" class="lf lg iq lb b gy ll li l lj lk">export const <!-- -->fetchTasksError<!-- --> = errorMessage =&gt; ({<br/>  type: <!-- -->"FETCH_TASKS_ERROR"<!-- -->,<br/>  payload: errorMessage<br/>});</span><span id="c1ab" class="lf lg iq lb b gy ll li l lj lk">const fetchTasks =  () =&gt; async dispatch =&gt; {<br/>    dispatch(fetchTasksStarted())<br/>    try{<br/>        const TaskResponse = await fetch("API URL")</span><span id="8aae" class="lf lg iq lb b gy ll li l lj lk">const task = await taskResponse.json()<br/>        dispatch(fetchTasksSuccess(tasks))<br/>    }catch(exc){<br/>        dispatch(fetchTasksError(<!-- -->error.message<!-- -->))<br/>    }<br/>}</span></pre><p id="50d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lm ln lo lb b">fetchTasks</code>可能一开始看起来很奇怪，但它是一个返回另一个带有参数<code class="fe lm ln lo lb b">dispatch</code>的函数的函数。一旦dispatch被调用，控制流将转移到reducer来决定做什么。在上面的例子中，如果请求成功，它只更新应用程序状态。</p><h1 id="f8ee" class="md lg iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">还原传奇</h1><p id="9005" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">redux-saga是一个Redux中间件，允许我们使用Redux轻松实现异步代码。是Redux Thunk最热门的竞争对手。</p><p id="9db2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧。让我们假设我们有相同的项目，但是在Redux-Thunk实现之前。让我们在<strong class="ka ir"> Store.js </strong>中实现Redux-saga中间件</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="fe96" class="lf lg iq lb b gy lh li l lj lk">import { createStore, applyMiddleware } from 'redux';<br/>import createSagaMiddleware from 'redux-saga';<br/>import logger from 'redux-logger';</span><span id="75cd" class="lf lg iq lb b gy ll li l lj lk">import rootReducer from './root-reducer';</span><span id="4af7" class="lf lg iq lb b gy ll li l lj lk">import { <!-- -->watchFetchTasksSaga<!-- --> } from './saga/fetchTasks.saga';</span><span id="9343" class="lf lg iq lb b gy ll li l lj lk">const sagaMiddleware = createSagaMiddleware();</span><span id="cec8" class="lf lg iq lb b gy ll li l lj lk">const middlewares = [logger, sagaMiddleware];</span><span id="1e65" class="lf lg iq lb b gy ll li l lj lk">export const store = createStore(rootReducer, applyMiddleware(...middlewares));</span><span id="6ea5" class="lf lg iq lb b gy ll li l lj lk">sagaMiddleware.run(<!-- -->watchFetchTasksSaga<!-- -->);</span><span id="3509" class="lf lg iq lb b gy ll li l lj lk">export default store;</span></pre><p id="2646" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是时候创建<strong class="ka ir">动作了:</strong></p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="7d00" class="lf lg iq lb b gy lh li l lj lk">export const <!-- -->fetchTasksStarted<!-- --> = () =&gt; ({<br/>  type: <!-- --> "FETCH_TASKS_START"<br/>});</span><span id="f5ca" class="lf lg iq lb b gy ll li l lj lk">export const <!-- -->fetchTasksSuccess<!-- --> = tasks =&gt; ({<br/>  type: <!-- -->"FETCH_TASKS_SUCCESS"<!-- -->,<br/>  payload: tasks<br/>});</span><span id="a035" class="lf lg iq lb b gy ll li l lj lk">export const <!-- -->fetchTasksError<!-- --> = errorMessage =&gt; ({<br/>  type: <!-- -->"FETCH_TASKS_ERROR"<!-- -->,<br/>  payload: errorMessage<br/>});</span></pre><p id="532d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们创建一个<strong class="ka ir"> saga </strong>文件夹，并在<strong class="ka ir"> saga </strong>文件夹中创建一个名为<code class="fe lm ln lo lb b">fetchTasks.saga</code>的新文件。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0a28" class="lf lg iq lb b gy lh li l lj lk">import { takeLatest, put } from "redux-saga/effects";</span><span id="67b4" class="lf lg iq lb b gy ll li l lj lk">function* fetchTasksSaga(){<br/> try {</span><span id="55d5" class="lf lg iq lb b gy ll li l lj lk">const taskResponse = yield fetch("API URL")</span><span id="5ae5" class="lf lg iq lb b gy ll li l lj lk">const tasks = yield taskResponse.json()</span><span id="5fb0" class="lf lg iq lb b gy ll li l lj lk">yield put<!-- -->(<!-- -->fetchTasksSuccess<!-- -->(tasks));</span><span id="f3be" class="lf lg iq lb b gy ll li l lj lk">} <!-- -->catch (error) {</span><span id="5f0f" class="lf lg iq lb b gy ll li l lj lk">yield put(<!-- -->fetchTasksError<!-- -->(error.message));<br/>  }<br/>}</span><span id="29bf" class="lf lg iq lb b gy ll li l lj lk">export default function* watchFetchTasksSaga(){<br/>    yield takeLatest("FETCH_TASKS_START", fetchTasksSaga)<br/>}</span></pre><p id="0f54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那些东西叫做发生器函数。<br/>你可以同时使用<code class="fe lm ln lo lb b">takeLatest</code>和<code class="fe lm ln lo lb b">takeEvery </code>，但是我们用的是<code class="fe lm ln lo lb b">takeLatest</code></p><p id="1405" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只要它只需要最后一个事件。</p><p id="d407" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过调用<code class="fe lm ln lo lb b">put</code>函数，我们可以像使用<code class="fe lm ln lo lb b">dispatch</code>一样触发动作。它允许调整我们的减速器来处理我们的行动。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="8028" class="lf lg iq lb b gy lh li l lj lk">...</span><span id="bec2" class="lf lg iq lb b gy ll li l lj lk">const INITIAL_STATE = {<br/>  tasks: null,<br/>  isFetching: false,<br/>  errorMessage: undefined<br/>};</span><span id="99e3" class="lf lg iq lb b gy ll li l lj lk">const <!-- -->fetchTasksReducer<!-- --> = (state = INITIAL_STATE, action) =&gt; {<br/>  switch (action.type) {<br/>    case "<!-- -->FETCH_TASKS_START"<!-- -->:<br/>      return {<br/>        ...state,<br/>        isFetching: true<br/>      };<br/>    case <!-- -->"FETCH_TASKS_SUCCESS":<br/>      return {<br/>        ...state,<br/>        isFetching: false,<br/>        tasks: action.payload<br/>      };<br/>    case <!-- -->"FETCH_TASKS_ERROR":<br/>      return {<br/>        ...state,<br/>        isFetching: false,<br/>        errorMessage: action.payload<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="52d8" class="lf lg iq lb b gy ll li l lj lk">export default <!-- -->fetchTasksReducer<!-- -->;</span></pre><h1 id="fce7" class="md lg iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">结论</h1><p id="4095" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">就是这样。现在您已经熟悉了React和Redux中处理异步任务的两种方法。你可以根据你正在做的项目来决定选择哪一个。</p></div></div>    
</body>
</html>