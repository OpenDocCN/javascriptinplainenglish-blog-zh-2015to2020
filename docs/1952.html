<html>
<head>
<title>Weird Parts of JavaScript — Equality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript的奇怪部分——等式</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/weird-parts-of-javascript-equality-a1cce100ad45?source=collection_archive---------10-----------------------#2020-05-06">https://javascript.plainenglish.io/weird-parts-of-javascript-equality-a1cce100ad45?source=collection_archive---------10-----------------------#2020-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/15263c8c8ae7ff5ed0762fa919cc5260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tz6xwWKChZTCHpNx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@mattpopovich?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Matt Popovich</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a3ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript是一种简单易学的编程语言。编写运行并执行某些操作的程序很容易。</p><p id="842f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，它有许多奇怪的部分，我们应该知道。在本文中，我们将看到一些奇怪的比较结果，在我们编写JavaScript代码时应该注意这些结果。</p><h1 id="8085" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">[]</code>等于<code class="fe lz ma mb mc b">![]</code></h1><p id="e1f1" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">==</code>操作符以奇怪的方式比较事物，因为在进行任何比较之前，它基于一组复杂的规则进行类型强制。</p><p id="bad6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">奇怪的比较结果的一个例子是<code class="fe lz ma mb mc b">[] == ![];</code>返回<code class="fe lz ma mb mc b">true</code>。</p><p id="6c33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为<code class="fe lz ma mb mc b">==</code>运算符将两边都转换成数字，然后进行比较。在这种情况下，在比较之前，两边都转换为0。</p><p id="d169" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">右侧被转换为0，因为数组是真的，然后当我们对一个真值求反时，它变成了<code class="fe lz ma mb mc b">false</code>，然后被强制为0。</p><p id="fc13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在左侧，空数组被强制转换为一个数字，而不是一个布尔值。根据<code class="fe lz ma mb mc b">==</code>操作符的规则，它被直接转换为0。</p><p id="de5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们得到两边都是0，因此，根据<code class="fe lz ma mb mc b">==</code>运算符的标准，我们得到<code class="fe lz ma mb mc b">[]</code>等于<code class="fe lz ma mb mc b">![]</code>。</p><p id="f154" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript解释器进行比较的步骤如下:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="460a" class="mq lc iq mc b gy mr ms l mt mu">+[] == +![];<br/>0 == +false;<br/>0 == 0;<br/>true;</span></pre><h1 id="c1df" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">true</code>不等于<code class="fe lz ma mb mc b">![]</code>，但也不等于<code class="fe lz ma mb mc b">[]</code></h1><p id="2186" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在JavaScript中，空数组不等于<code class="fe lz ma mb mc b">true</code>，空数组的反运算也不等于<code class="fe lz ma mb mc b">true</code>。</p><p id="b0cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，根据<code class="fe lz ma mb mc b">==</code>运算符，两者都等于<code class="fe lz ma mb mc b">false</code>。</p><p id="fe70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们有以下两个表达式返回<code class="fe lz ma mb mc b">false</code>:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="cc49" class="mq lc iq mc b gy mr ms l mt mu">true == []; <br/>true == ![];</span></pre><p id="f825" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且以下表达式均返回<code class="fe lz ma mb mc b">true</code>:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="aaaa" class="mq lc iq mc b gy mr ms l mt mu">false == []; <br/>false == ![];</span></pre><p id="4b21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">true == [];</code>是<code class="fe lz ma mb mc b">false</code>，因为右边直接转换为0，如前一节所见。</p><p id="0698" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">于是<code class="fe lz ma mb mc b">true == [];</code>变成了<code class="fe lz ma mb mc b">toNumber(true)== toNumber([]);</code>，变成了<code class="fe lz ma mb mc b">1 == 0</code>，也就是<code class="fe lz ma mb mc b">false</code>。</p><p id="6eef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lz ma mb mc b">true == ![];</code>中。只有右侧被转换为不同的值。表达式转换成<code class="fe lz ma mb mc b">true == false</code>，也是<code class="fe lz ma mb mc b">false</code>。</p><p id="32d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于以下转换，<code class="fe lz ma mb mc b">false == [];</code>表达式返回<code class="fe lz ma mb mc b">true</code>:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="c73e" class="mq lc iq mc b gy mr ms l mt mu">toNumber(false) == toNumber([]);<br/>0 == 0;</span></pre><p id="29be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它首先用内置的<code class="fe lz ma mb mc b">toNumber</code>函数将<code class="fe lz ma mb mc b">false</code>和<code class="fe lz ma mb mc b">[]</code>转换成数字。</p><p id="e462" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后两个值都转换成0，由于两边都是0，所以返回<code class="fe lz ma mb mc b">true</code>。<code class="fe lz ma mb mc b">false</code>是falsy，所以换算成0。根据<code class="fe lz ma mb mc b">toNumber</code>函数，空数组也被转换为0。</p><p id="957c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在与<code class="fe lz ma mb mc b">==</code>运算符进行比较之前，根据以下过程将<code class="fe lz ma mb mc b">false == ![];</code>表达式转换为不同的值。</p><p id="4664" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">左侧保持不变，但是右侧被转换为<code class="fe lz ma mb mc b">false</code>，因为它是真值的否定。</p><p id="b512" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们得到<code class="fe lz ma mb mc b">false == false</code>，也就是<code class="fe lz ma mb mc b">true</code>。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/27b262f0a1bba3eeff331186f62a6761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HGLYY0e4kBiUQZ8Q"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lakus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lukas Boekhout</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ccbf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">真就是假</h1><p id="fb1c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在JavaScript中，布尔表达式:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="950b" class="mq lc iq mc b gy mr ms l mt mu">!!"false" == !!"true";<br/>!!"false" === !!"true";</span></pre><p id="08f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">双双返回<code class="fe lz ma mb mc b">true</code>。</p><p id="4a9b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为在第一种情况下，在用<code class="fe lz ma mb mc b">==</code>操作符进行比较之前，JavaScript再次将项目转换为不同的值。</p><p id="01d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二种情况下，双重否定会在进行比较之前将它们都转换为布尔型。在进行比较之前,<code class="fe lz ma mb mc b">===</code>操作符本身不做任何数据类型强制。</p><p id="8e6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lz ma mb mc b">!!”false” == !!”true”;</code>表达式中，右边的<code class="fe lz ma mb mc b">'true'</code>被转换为<code class="fe lz ma mb mc b">NaN</code>，因为它试图将非数字内容的字符串转换为数字。那么双重否定会把它转换成<code class="fe lz ma mb mc b">false</code>，因为<code class="fe lz ma mb mc b">NaN</code>是假的。</p><p id="4c3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">左侧的<code class="fe lz ma mb mc b">'false'</code>转换为内置<code class="fe lz ma mb mc b">ToBoolean</code>功能的<code class="fe lz ma mb mc b">false</code>。</p><p id="936a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为它们都是<code class="fe lz ma mb mc b">false</code>，我们得到<code class="fe lz ma mb mc b">!!”false” == !!”true”;</code>返回<code class="fe lz ma mb mc b">true</code>。</p><p id="68f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样的逻辑，从<code class="fe lz ma mb mc b">false === false</code>开始，<code class="fe lz ma mb mc b">!!”false” === !!”true”;</code>因为同样的数据类型被双重否定所强制。</p><h1 id="6625" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ca5c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">JavaScript的数据类型强制做了奇怪的事情。从上面的例子中我们可以看到，<code class="fe lz ma mb mc b">==</code>进行了自动的数据类型强制，这做了很多我们没有预料到的事情。</p><p id="ff14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用<code class="fe lz ma mb mc b">===</code>进行比较，可以避免自动数据类型强制，所以我们应该这样做。</p><p id="359e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像<code class="fe lz ma mb mc b">!!</code>这样的手动数据类型强制也有它的问题，但是它是不可避免的，所以我们必须记住规则，这样我们就不会犯错误。</p><h2 id="c2e6" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">简明英语笔记</strong></h2><p id="f4d7" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">你知道我们有四种出版物吗？给他们一个关注来表达爱意吧:<a class="ae kc" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="kf ir">JavaScript in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>—谢谢，继续学习！</p><p id="ed43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们总是有兴趣帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>