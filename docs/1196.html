<html>
<head>
<title>How to create a contact form with Netlify, Gatsby.js and Mailgun</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Netlify，Gatsby.js和Mailgun创建联系人表单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/jamstack-how-to-do-a-contact-form-step-by-step-with-gatsby-js-netlify-and-mailgun-52d26432a5c4?source=collection_archive---------1-----------------------#2020-02-11">https://javascript.plainenglish.io/jamstack-how-to-do-a-contact-form-step-by-step-with-gatsby-js-netlify-and-mailgun-52d26432a5c4?source=collection_archive---------1-----------------------#2020-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b782c69a0efad501d435ece578cdb9f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpiLyt5DwJTfXXoACqqD0g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@neonbrand?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">NeONBRAND</a> on <a class="ae kc" href="https://unsplash.com/s/photos/email?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6b26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今年，作为一名初级开发人员，我决定写两篇文章，介绍如何一步一步地用Gatsby.js建立一个经典的登录页面。今天的文章是关于联系方式的。</p><p id="afa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于JAMstack不是关于特定的技术，我们将使用的JAMstack的解释是:</p><ul class=""><li id="84cc" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">盖茨比前端(即。联系方式)</li><li id="5f4a" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Netlify静态托管</li><li id="58a9" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">网络云功能</li></ul><p id="48ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们希望通过这个表单从Gatsby页面的前端获取一些基本数据，将其发送到由Netlify生成的API端点，然后在将使用Mailgun的Netlify云函数中处理它。</p><p id="3323" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给你一个快速剧透，我们将遵循这个逻辑:</p><ul class=""><li id="4ebd" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">#1.创建一个Gatsby.js starter &amp;在GitHub上推送。</li><li id="e966" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/marieqg/contact-form-medium/tree/STEP%232" rel="noopener ugc nofollow" target="_blank"> #2 </a>。开始使用Netlify功能&amp;在Netlify上部署我们的网站。</li><li id="bd92" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/marieqg/contact-form-medium/tree/STEP%233" rel="noopener ugc nofollow" target="_blank"> #3 </a>。向MailGun注册，编写Netlify函数，测试它，并部署它。</li><li id="0268" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/marieqg/contact-form-medium/tree/STEP%234" rel="noopener ugc nofollow" target="_blank"> #4 </a>。使用材质UI创建前视图，并将其连接到我们的API端点。</li></ul><p id="cb7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的GitHub库是公开的，如果你在某个时候迷路了，可以在这里<a class="ae kc" href="https://github.com/marieqg/contact-form-medium" rel="noopener ugc nofollow" target="_blank">找到。此外，每一步都是一个分支，这样你就可以保持跟踪。</a></p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="53d7" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated"><strong class="ak">第一步:创建一个Gatsby.js starter &amp;在GitHub上推送</strong></h1><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/f7d3620f5c19818e509bd321934f7898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNnYmwbgkpNEjJqWWnTmWA.png"/></div></div></figure><p id="4910" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们要从设置Gatsby.js开始，如果你还没有设置好你的开发环境，你可以按照<a class="ae kc" href="https://www.gatsbyjs.org/tutorial/part-zero/" rel="noopener ugc nofollow" target="_blank">这个过程</a>。</p><p id="7a55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成后，我们将创建一个新的gatsby站点，并使用以下命令进行第一次运行。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="8d24" class="ne lx iq na b gy nf ng l nh ni">gatsby new gatsby-site<br/>gatsby develop </span></pre><p id="f192" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你到了这里，你就可以打开浏览器，进入<a class="ae kc" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>查看你的网站运行情况。</p><p id="20b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将在Github上发布我们的代码。创建存储库后，Github会给出发布存储库的说明。如果您选择在命令行上创建一个新的存储库，那么您不需要添加一个read me，因为Gatsby.js starter已经提供了一个。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="41f8" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated"><strong class="ak">第二步:从网络功能开始&amp;在网络上部署我们的网站</strong></h1><p id="10e9" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">Netlify是托管静态网站的一个很好的选择。它们提供了额外的功能，如<a class="ae kc" href="https://www.netlify.com/docs/identity/" rel="noopener ugc nofollow" target="_blank">认证管理</a>、<a class="ae kc" href="https://www.netlify.com/docs/form-handling/" rel="noopener ugc nofollow" target="_blank">表单处理</a>，最重要的是:<a class="ae kc" href="https://www.netlify.com/docs/continuous-deployment/" rel="noopener ugc nofollow" target="_blank">连续部署</a>和AWS lambda <a class="ae kc" href="https://www.netlify.com/docs/functions/" rel="noopener ugc nofollow" target="_blank">功能</a>。</p><p id="954c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动计划是完全免费的，将为一个基本的网站提供完整的功能。Netlify的lambda函数是一种计算服务，可以让您运行代码，而无需提供或管理服务器。免费层为一个功能提供125，000个请求。</p><p id="17db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行一个函数很容易，但是你需要使用<code class="fe no np nq na b">netlify-lambda</code>来模拟它。要启动并运行您的第一个Netlify函数，您可以遵循以下步骤:</p><h2 id="9792" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 1。安装依赖关系</strong>:</h2><p id="8f46" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">在终端运行中:</p><p id="2b74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe no np nq na b">npm install -D http-proxy-middleware netlify-lambda npm-run-all</code></p><h2 id="2e16" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 2。和盖茨比一起运行函数仿真</strong>:</h2><p id="a615" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">当您要部署您的Gatsby站点时，它将使用脚本来知道如何构建它以及以什么顺序来构建它。所以，把你的<code class="fe no np nq na b">scripts</code>换成你的<code class="fe no np nq na b">package.json</code>:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="a07e" class="ne lx iq na b gy nf ng l nh ni">"scripts": {<br/>    "develop": "gatsby develop",<br/>    "start": "run-p start:**",<br/>    "start:app": "npm run develop",<br/>    "start:lambda": "netlify-lambda serve src/lambda",<br/>    "build": "gatsby build &amp;&amp; netlify-lambda build src/lambda",<br/>    "build:app": "gatsby build",<br/>    "build:lambda": "netlify-lambda build src/lambda",<br/>  },</span></pre><h2 id="ed9b" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated">3.<strong class="ak">为你的功能创建一个文件夹</strong></h2><p id="49cc" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">Netlify函数接收请求上下文或事件数据，并将数据返回到您的前端。基本上，它将使您的网站从完全静态变为动态，因为它将按需运行服务器端代码，而不必管理专用服务器。</p><p id="227a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在<strong class="kf ir"> </strong> <code class="fe no np nq na b">netlify-lambda</code>将在你的<code class="fe no np nq na b">src/lambda</code>文件夹中建立每个文件作为一个独立的功能。要创建文件夹，请在终端中运行:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="f3bb" class="ne lx iq na b gy nf ng l nh ni">cd src <br/>mkdir lambda</span></pre><p id="c5c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不希望这个文件夹出现在GitHub上，所以我们将下面的内容添加到我们的<code class="fe no np nq na b">.gitignore</code>中。反斜杠“/”很重要，因为它告诉GitHub忽略我们文件夹根目录下的“lambda”文件夹，而不是另一个。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="4662" class="ne lx iq na b gy nf ng l nh ni">/lambda </span></pre><h2 id="4f8f" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated">4.配置您的网络版本:</h2><p id="4975" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">为了确保Netlify找到我们的函数的路径，在你的文件夹的根目录(即与你的<code class="fe no np nq na b">package.json</code> package.json在同一层)，我们将创建一个名为<code class="fe no np nq na b">netlify.toml</code>的文件，并编写如下内容:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7947" class="ne lx iq na b gy nf ng l nh ni">[build]<br/>  command = "npm run build"<br/>  functions = "lambda"<br/>  publish = "public"</span></pre><h2 id="b766" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 5。代理本地开发的仿真功能</strong>:</h2><p id="71b2" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">转到您的<code class="fe no np nq na b">gatsby-config.js</code>并将其添加到您的<code class="fe no np nq na b">module.exports</code>:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="6d7f" class="ne lx iq na b gy nf ng l nh ni">var proxy = require("http-proxy-middleware")</span><span id="ea1d" class="ne lx iq na b gy oc ng l nh ni">module.exports = {<br/>  // for avoiding CORS while developing Netlify Functions locally<br/>  // read more: <a class="ae kc" href="https://www.gatsbyjs.org/docs/api-proxy/#advanced-proxying" rel="noopener ugc nofollow" target="_blank">https://www.gatsbyjs.org/docs/api-proxy/#advanced-proxying</a><br/>  developMiddleware: app =&gt; {<br/>    app.use(<br/>      "/.netlify/functions/",<br/>      proxy({<br/>        target: "<a class="ae kc" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank">http://localhost:9000</a>",<br/>        pathRewrite: {<br/>          "/.netlify/functions/": "",<br/>        },<br/>      })<br/>    )<br/>  },<br/>  // ...<br/>}</span></pre><p id="2a8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="od">2004年19月更新:代理现在被createProxyMiddleware取代。现在导入需要:</em></p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="50b4" class="ne lx iq na b gy nf ng l nh ni">const { createProxyMiddleware } = require("http-proxy-middleware")</span></pre><p id="e496" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="od">另外，代码中需要用createProxyMiddleware替换代理。</em></p><h2 id="52d2" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 6。用MVP函数测试它</strong></h2><p id="cf53" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">您可以编写任意多的函数，只要每个函数都导出一个处理程序。它可以接受3个参数:</p><ul class=""><li id="8f9a" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><strong class="kf ir">事件</strong>:它是一个包含请求细节的对象。例如，您可以检索已过帐的数据或页眉。</li><li id="b3d4" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">上下文</strong>:这是关于调用函数的上下文的信息，比如某些用户信息。</li><li id="adc1" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">回调:</strong>是一个函数，我们调用这个函数向用户返回一个响应。应该调用它来返回错误或响应对象。在下面的例子中，回调的第一个参数为空。</li></ul><p id="ae06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想了解更多关于函数的知识，文档在这里。</p><p id="ed6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用无服务器功能时，Netlify将提供<code class="fe no np nq na b">event</code>和<code class="fe no np nq na b">context</code>参数。您提供了<code class="fe no np nq na b">callback</code>参数，这是可选的，但是推荐使用。</p><p id="4efc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以通过编写一个小函数来测试它。您可以在<code class="fe no np nq na b">src/lambda</code>文件夹中创建一个新文件，并将其命名为<code class="fe no np nq na b">hello.js</code>:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="5b3b" class="ne lx iq na b gy nf ng l nh ni">// For more info, check <a class="ae kc" href="https://www.netlify.com/docs/functions/#javascript-lambda-functions" rel="noopener ugc nofollow" target="_blank">https://www.netlify.com/docs/functions/#javascript-lambda-functions</a><br/>export function handler(event, context, callback) {<br/>  callback(null, {<br/>    statusCode: 200, <br/>// That's the status code which will be returned when the function is executed to indicates that everything is OK<br/>    body: JSON.stringify({<br/>      msg: "Hello, World! ",<br/>    }),<br/>  })<br/>}</span></pre><p id="7842" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了测试我们的功能，在终端中运行以创建一个生产版本:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="75de" class="ne lx iq na b gy nf ng l nh ni"><strong class="na ir">npm run start  </strong></span></pre><p id="ce71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后去<a class="ae kc" href="http://localhost:9000/hello" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/hello</a></p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/717136eb5943562b3f82c019d1a6f6df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-58wWOY8UX3sUekpJfassA.png"/></div></div></figure><p id="9528" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们的函数工作了，我们需要把它提交给Github。</p><p id="dcfe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在路上迷路了，我们就在这里。如果您还没有创建Netlify帐户，请在此注册并点击右上角的按钮“从Git创建新网站”。然后，您将被重定向到一个新的屏幕，在这里您可以选择GitHub作为您的Git提供者。一旦它链接到GitHub，选择您之前创建的存储库，然后点击“部署”。</p><h2 id="97c0" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated">7.在网络上部署</h2><p id="5053" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">您的部署可能需要几分钟时间。完成后，您可以在Netlify仪表板中查看您的功能:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/9528ad4db28714a6ac3f08bc64d96b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gr1P-TXjhJpovop30R_Icw.png"/></div></div></figure><p id="8b4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以通过以下URL模式在浏览器中测试它:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="682c" class="ne lx iq na b gy nf ng l nh ni"><a class="ae kc" href="https://heuristic-swartz-e6ce70.netlify.com/.netlify/functions/hello" rel="noopener ugc nofollow" target="_blank">https://[YOUR_URL]/.netlify/functions/[YOUR_FUNCTION_NAME]</a></span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="b8e0" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">步骤3:向Mailgun注册，编写Netlify函数，测试并部署它</h1><p id="2f6b" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">现在我们有了一个运行良好的功能，让我们从电子邮件开始。</p><h2 id="af0b" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 1。设置电子枪:</strong></h2><p id="1504" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">首先，你需要一个邮箱账号。你必须使用信用卡/借记卡，但Mailgun有一个慷慨的免费账户，因为他们允许你每月免费发送10 000封电子邮件。此外，他们有一个令人难以置信的支持团队，如果你有困难，他们会帮助你度过难关。</p><p id="0491" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在将使用Mailgun的沙箱，但是当你有了自己的域名，你就可以使用它了。</p><p id="5837" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你有你的Mailgun帐户，你将到达仪表板。然后，转到发送&gt;概述(红色方块)，并确保您所在的域是“沙箱”(蓝色方块)。之后，点击API，然后选择Node.js</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/0dbeddfbffac98c59536011fae160742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vuf2BD66vTUnH0Ww-UnUOA.png"/></div></div></figure><h2 id="306a" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 2。设置环境变量</strong></h2><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/714c24afd264b62b9bd298702887f7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T9vMuQfOuvlRpvAPbgNzWA.png"/></div></div></figure><p id="2367" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的Mailgun API密钥是私有的，如果您不小心，它很容易被窃取。它不应该被公开。所以比如<strong class="kf ir">不要在GitHub上推</strong>。这就是为什么我们要将它们保存在Netlify的设置中。</p><p id="8a96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">进入设置后，单击构建和部署以及环境。然后，在“编辑变量”中，您将能够为以后需要的每个变量输入一个键和值的组合。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/4071e9b9792b67cd5f64c69892ef61e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y4te9AZVnryN41t1EblkHw.png"/></div></div></figure><h2 id="4e69" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 3。启用并设置Postman以测试功能</strong></h2><p id="8ba7" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">我们函数的目的是向服务器发出请求。之前我们的请求是“GET ”,这意味着所有需要的数据都在URL中。在我们的例子中，我们的第一个函数不需要任何数据，它只需要URL中的函数名。</p><p id="ee9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们要做的是通过表单向服务器发送数据。换句话说，我们的前端接口将检索数据并将其发送到服务器。这将通过一个“POST”请求来完成。POST请求在消息体中从浏览器(即客户端)向服务器提供附加数据。</p><p id="4fd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了测试一个POST请求，我们需要使用一个软件(Postman)。它需要一个设置才能使用Mailgun。<a class="ae kc" href="https://www.mailgun.com/blog/together-at-last-postman-meets-mailgun/" rel="noopener ugc nofollow" target="_blank">这篇伟大的文章</a>将解释一切。</p><h2 id="45b9" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 4。POST请求从邮递员那里取回数据</strong></h2><p id="c5fe" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">让我们像创建MVP函数一样创建一个新函数。我们称之为<code class="fe no np nq na b">sendEmail.js</code>，从重用MVP函数的代码开始。我对MVP函数做了一个小改动，因为我想看看我的<code class="fe no np nq na b">event</code>是什么样子。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="e79e" class="ne lx iq na b gy nf ng l nh ni">export function handler(event, context, callback) {<br/>  callback(null, {<br/>    statusCode: 200, <br/>    body: JSON.stringify({<br/>      msg: "Hello, World! ",<br/>      event: event<br/>   }),<br/>  })<br/>}</span></pre><p id="fd4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在你开始用Postman测试它之前，不要忘记通过在你的终端中执行<code class="fe no np nq na b">ctrl + c </code>和<code class="fe no np nq na b">npm start</code>来重启你的服务器。</p><p id="8f34" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，在Postman中，选择POST请求并添加URL(蓝色方块)。发送的数据将放在“Body”中，选择“raw”和“JSON”(绿色方块)。在body字段中，您可以添加自己的数据(红色方块)。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/e051b991fe17f9dae9ea8a6f25220ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JOs3_mbxQOE9ZaAJQdWs6Q.png"/></div></div></figure><p id="5e3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们点击“发送”，我们将看到服务器的回复。如您所见，我们发送的参数在<code class="fe no np nq na b">body</code>对象(紫色方块)内部，但是作为一个JSON。因此，我们需要在对象之外创建一个字符串来使用它:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="938d" class="ne lx iq na b gy nf ng l nh ni">export function handler(event, context, callback) {<br/>  let data = JSON.parse(event.body)<br/>  callback(null, {<br/>    statusCode: 200,<br/>    body: JSON.stringify({<br/>      msg: "Hello, World! ",<br/>      event: event,<br/>      context: context,<br/>      data: data,<br/>    }),<br/>  })<br/>}</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/2e0deb4d24b97b8f30dd1674b990948f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*4Y67frt18VtVxQYq1u2N4g.png"/></div></figure><p id="aaff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦解析完毕，就可以在Postman中直接看到结果。</p><h2 id="3da8" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 5。函数:sendEmail.js </strong></h2><p id="c99d" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">现在，让我们回到Mailgun的仪表板，获取他们为我们预先编写的一段代码。我们现在可以定制它来满足我们自己的需求，并将其添加到我们的<code class="fe no np nq na b">sendEmail.js</code>函数文件中。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="e03f" class="ne lx iq na b gy nf ng l nh ni">const mailgun = require("mailgun-js")<br/>const mg = mailgun({<br/>  apiKey: process.env.MAILGUN_API_KEY,<br/>  domain: process.env.MAILGUN_DOMAIN,<br/>})<br/>const mailOptions = {<br/>  from: `${name} &lt;${email}&gt;`,<br/>  to: process.env.MY_EMAIL_ADDRESS,<br/>  replyTo: email,<br/>  text: `${message}`,<br/>}<br/>mg.messages().send(mailOptions, function(error, body) {<br/>  console.log(body)<br/>})</span></pre><p id="b1fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要让它发挥作用，还缺少三样东西:</p><ul class=""><li id="facc" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">如你所见，<code class="fe no np nq na b">mailgun</code>要求<code class="fe no np nq na b">mailgun-js</code>，这意味着我们必须做一个<code class="fe no np nq na b">npm install mailgun-js</code></li><li id="5ee2" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">此外，为了保护我们的密钥，我们在<code class="fe no np nq na b">process.env</code>中使用了环境变量。<a class="ae kc" href="https://www.gatsbyjs.org/docs/environment-variables/" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>需要在我们的函数文件中安装(<code class="fe no np nq na b">npm install dotenv</code>)环境变量和几行代码:</li></ul><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="75d4" class="ne lx iq na b gy nf ng l nh ni">// Gatsby settings for the environment variables<br/>require("dotenv").config({<br/>  path: `.env.${process.env.NODE_ENV}`,<br/>})</span></pre><ul class=""><li id="c97f" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">为了便于以后定制，我将发送电子邮件地址设置为一个环境变量，并解构了<code class="fe no np nq na b">data</code>对象。但是，您需要在Postman中配置环境变量。点击螺母(粉色方框)并点击“处理”。ENV "(蓝框)能够编辑您的环境变量(邮件枪_域，邮件枪_ API _密钥，我的_电子邮件_地址):</li></ul><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/5cfe37a0c2436f971bf00f4ddffc3c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5svVUEMZGRvEhkC70MW2Kg.png"/></div></div></figure><p id="c9e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们的功能几乎可以工作了。出于安全原因，浏览器将禁止一个网站从另一个网站获取数据。我们需要通过指定一个标题来取消这个安全措施。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="82ef" class="ne lx iq na b gy nf ng l nh ni">const headers = {<br/>  "Access-Control-Allow-Origin": "*",<br/>  "Access-Control-Allow-Headers": "Content-Type",<br/>}</span></pre><p id="1cad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也是一个很好的机会，通过指定在出错时如何工作来完成我们的功能:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="0ca9" class="ne lx iq na b gy nf ng l nh ni">(...)<br/>const headers = {<br/>  "Access-Control-Allow-Origin": "*",<br/>  "Access-Control-Allow-Headers": "Content-Type",<br/>}<br/>const successCode = 200<br/>const errorCode = 400</span><span id="37cd" class="ne lx iq na b gy oc ng l nh ni">(...) </span><span id="8301" class="ne lx iq na b gy oc ng l nh ni"><strong class="na ir">// Our Netlify function</strong></span><span id="87d4" class="ne lx iq na b gy oc ng l nh ni">export function handler(event, context, callback) {<br/>  let data = JSON.parse(event.body)<br/>  let { name, email, message } = data<br/>  let mailOptions = {<br/>    from: `${name} &lt;${email}&gt;`,<br/>    to: process.env.MY_EMAIL_ADDRESS,<br/>    replyTo: email,<br/>    text: `${message}`,<br/>  }</span><span id="ebf9" class="ne lx iq na b gy oc ng l nh ni"><strong class="na ir">// Our Mailgun code</strong></span><span id="961d" class="ne lx iq na b gy oc ng l nh ni">  mg.messages().send(mailOptions, function(error, body) {<br/>    if (error) {<br/>      callback(null, {<br/>        errorCode,<br/>        headers,<br/>        body: JSON.stringify(error),<br/>      })<br/>    } else {<br/>      callback(null, {<br/>        successCode,<br/>        headers,<br/>        body: JSON.stringify(body),<br/>      })<br/>    }<br/>  })<br/>}</span></pre><p id="fe79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署到<a class="ae kc" href="https://github.com/marieqg/contact-form-medium/tree/STEP%233" rel="noopener ugc nofollow" target="_blank"> GitHub </a>后，会自动部署到Netlify上(如果设置了选项)。并且，我们对PostMan进行了最后的测试，看它是否工作🎉 🥳:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/0ea487c50eef49a2299fb08e07fa5892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAevKy7bG1jS_i5umDceZQ.png"/></div></div></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/b596fcb6324984ae89ca95cff00ba4ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8Jxhvwk8hM9jlxgEl44xw.png"/></div></div></figure><p id="3345" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，如果您想走出Mailgun的沙盒，您将需要小心对待端点。API端点是一个特定的数字位置，一个程序在这里发送信息请求，资源也在这里。沙箱默认使用美国端点。如果您在欧洲，当您初始化Mailgun对象时，您需要包括选项“host”并指定“EU”(即欧洲)端点。</p><p id="3cca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请参见下面的示例:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="1071" class="ne lx iq na b gy nf ng l nh ni">const mg = mailgun({<br/>  apiKey: process.env.MAILGUN_API_KEY,<br/>  domain: process.env.MAILGUN_DOMAIN,<br/>  host: “api.eu.mailgun.net”<br/>})</span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="9190" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">第4步:创建前视图与材料用户界面，使接触形式的用户友好</h1><p id="73ed" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">现在，我们的最后一步:表单的前端部分。我们将使用它从客户端收集数据。</p><h2 id="be9d" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 1。设置素材UI和前端</strong></h2><p id="910a" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">为了更好地做到这一点，我们将安装Material UI及其gatsby插件:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7d60" class="ne lx iq na b gy nf ng l nh ni">npm install gatsby-plugin-material-ui @material-ui/styles <a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core</span></pre><p id="38fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并将其设置在我们的<code class="fe no np nq na b">gatsby-config.js</code>:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="4d2e" class="ne lx iq na b gy nf ng l nh ni">// gatsby-config.js  </span><span id="428c" class="ne lx iq na b gy oc ng l nh ni">module.exports = {   plugins: [`gatsby-plugin-material-ui`], };</span></pre><p id="6fa5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是时候布置前线了。我创建了一个名为<code class="fe no np nq na b">Contact</code>的组件。在我将从页面<code class="fe no np nq na b">index.js</code>调用的组件文件夹中:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="d464" class="ne lx iq na b gy nf ng l nh ni"><strong class="na ir">//Contact.js</strong></span><span id="d8e9" class="ne lx iq na b gy oc ng l nh ni">import React from "react"</span><span id="668b" class="ne lx iq na b gy oc ng l nh ni">export default class Contact extends React.Component {<br/>  state = {}</span><span id="af19" class="ne lx iq na b gy oc ng l nh ni">render() {<br/>    return &lt;div&gt;&lt;/div&gt;<br/>  }<br/>}</span><span id="0dad" class="ne lx iq na b gy oc ng l nh ni"><strong class="na ir">//index.js</strong></span><span id="7bfa" class="ne lx iq na b gy oc ng l nh ni">import React from "react"</span><span id="4c65" class="ne lx iq na b gy oc ng l nh ni">import Contact from "../components/Contact"</span><span id="4056" class="ne lx iq na b gy oc ng l nh ni">const IndexPage = () =&gt; &lt;Contact&gt;&lt;/Contact&gt;</span><span id="0dcb" class="ne lx iq na b gy oc ng l nh ni">export default IndexPage</span></pre><h2 id="f5ce" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 2。创建表单的前端:</strong></h2><p id="3843" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">作为一名MVP，我们将创建一个在视觉上看起来像表单的表单，但这是行不通的。从材质UI，我们将使用<a class="ae kc" href="https://material-ui.com/components/text-fields/" rel="noopener ugc nofollow" target="_blank">文本字段</a>和一个<a class="ae kc" href="https://material-ui.com/components/buttons/#button" rel="noopener ugc nofollow" target="_blank">按钮</a>。遵循材料UI编码指南，我们的contact组件将如下所示:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="37f5" class="ne lx iq na b gy nf ng l nh ni">import React from "react"<br/>import TextField from "<a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core/TextField"<br/>import Button from "<a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core/Button"</span><span id="ad9a" class="ne lx iq na b gy oc ng l nh ni">export default class Contact extends React.Component {<br/>  state = {}</span><span id="4f8e" class="ne lx iq na b gy oc ng l nh ni">render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;form noValidate autoComplete="off"&gt;<br/>          &lt;TextField id="standard-name" label="Name" /&gt;<br/>          &lt;TextField id="standard-email" label="Email" /&gt;<br/>          &lt;TextField id="standard-message" label="Message" /&gt;<br/>          &lt;Button variant="contained" color="primary"&gt;<br/>            Submit<br/>          &lt;/Button&gt;<br/>        &lt;/form&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/1612139e4ea97e805d5903d564364447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fs75o5CFKoBFPsWY1NkZuQ.png"/></div></div></figure><p id="6e66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使我们的形式在那里，没有什么工作。为了让它发挥作用，我们需要:</p><ul class=""><li id="714d" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">存储将要输入状态的内容，并创建一个函数来处理变量的变化</li><li id="3cf4" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">处理提交按钮上的点击</li><li id="ae32" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">创建一个函数来处理表单中的成功和错误</li></ul><h2 id="1d25" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 3。存储用户将要输入的值</strong></h2><p id="724b" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">让我们首先创建一个状态来存储将在表单中键入的值:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="d65f" class="ne lx iq na b gy nf ng l nh ni">import React from "react"<br/>import TextField from "<a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core/TextField"<br/>import Button from "<a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core/Button"</span><span id="cab3" class="ne lx iq na b gy oc ng l nh ni">export default class Contact extends React.Component {<br/>  state = {<br/>    name: "",<br/>    email: "",<br/>    message: "",<br/>  }</span><span id="5d03" class="ne lx iq na b gy oc ng l nh ni">render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;form noValidate autoComplete="off"&gt;<br/>          &lt;TextField<br/>            id="standard-name"<br/>            label="Name"<br/>            value={this.state.name}<br/>          /&gt;<br/>          &lt;TextField<br/>            id="standard-email"<br/>            label="Email"<br/>            value={this.state.email}<br/>          /&gt;<br/>          &lt;TextField<br/>            id="standard-message"<br/>            label="Message"<br/>            value={this.state.message}<br/>          /&gt;<br/>          &lt;Button variant="contained" color="primary"&gt;<br/>            Submit<br/>          &lt;/Button&gt;<br/>        &lt;/form&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="a508" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，文本字段中的值将是状态之一，但我们没有办法改变它。为此，我们需要一个新功能:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="91e2" class="ne lx iq na b gy nf ng l nh ni">handleChange = event =&gt; {<br/>    const name = event.target.name<br/>    const value = event.target.value<br/>    const statesToUpdate = {}<br/>    statesToUpdate[name] = value<br/>this.setState(statesToUpdate)<br/>  }</span></pre><p id="33e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如你所见，该函数将从文本字段中获取一个名为<code class="fe no np nq na b">event</code>的对象。在<code class="fe no np nq na b">event</code>对象中，它将使用一个<code class="fe no np nq na b">name</code>和一个<code class="fe no np nq na b">value</code>来创建一个新对象并设置状态。我们已经向每个文本字段传递了一个<code class="fe no np nq na b">value</code>，但是我们现在还需要向它传递一个名称和函数本身。每个文本字段应该如下所示:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="3c13" class="ne lx iq na b gy nf ng l nh ni">&lt;TextField<br/>  id="standard-name"<br/>  label="Name"<br/>  value={this.state.name}<br/>  onChange={this.handleChange}<br/>  name="name"/&gt;</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/654472e4334f27fed8c7c65cc90b63c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*fHXQq2CqOFTBAGSOBDmbTw.gif"/></div></figure><h2 id="694b" class="ne lx iq bd ly nr ns dn mc nt nu dp mg ko nv nw mk ks nx ny mo kw nz oa ms ob bi translated"><strong class="ak"> 4。处理点击提交按钮，错误和成功</strong></h2><p id="c4ed" class="pw-post-body-paragraph kd ke iq kf b kg nj ki kj kk nk km kn ko nl kq kr ks nm ku kv kw nn ky kz la ij bi translated">当我们点击按钮时，我们希望按钮做的是通过它的端点向我们之前创建的函数发送一个HTTP请求。要发送HTTP请求，我们将使用Axios。所以，我们先安装一下:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7cc1" class="ne lx iq na b gy nf ng l nh ni">npm install axios</span></pre><p id="4b8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的函数将做以下事情:它将从状态中获取数据，并将其作为一个对象。然后，我们将向Netlify的端点发送一个带有数据的HTTP请求(已经被转换成一个<code class="fe no np nq na b">String</code>):</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="4a1c" class="ne lx iq na b gy nf ng l nh ni">const axios = require("axios")</span><span id="0b66" class="ne lx iq na b gy oc ng l nh ni">handleSubmit = e =&gt; {<br/>    let { name, email, message } = this.state<br/>    let data = { name, email, message }<br/>    axios.post(endpoints.contact,     JSON.stringify(data)).then(response =&gt; {<br/>      if (response.status !== 200) {<br/>        this.handleError()<br/>      } else {<br/>        this.handleSuccess()<br/>      }<br/>    })<br/>    e.preventDefault()<br/>  }</span></pre><p id="78e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让这个函数工作，我们必须定义端点，并在我们的<code class="fe no np nq na b">Contact.js</code>中创建一个成功和错误函数。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="173e" class="ne lx iq na b gy nf ng l nh ni">const endpoints = { contact: "/.netlify/functions/sendEmail"}</span><span id="d8e0" class="ne lx iq na b gy oc ng l nh ni">handleSuccess = () =&gt; {<br/>    this.setState({<br/>      name: "",<br/>      email: "",<br/>      message: "",<br/>      loading: false,<br/>      error: false,<br/>    })<br/>  }</span><span id="7464" class="ne lx iq na b gy oc ng l nh ni">handleError = msg =&gt; {<br/>    this.setState({<br/>      loading: false,<br/>      error: true,<br/>      msg,<br/>    })<br/>  }</span></pre><p id="70bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">别忘了给我们的按钮添加一个提交类型:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="0a04" class="ne lx iq na b gy nf ng l nh ni">&lt;Button variant="contained" color="primary" type="submit"&gt;<br/> Submit<br/>&lt;/Button&gt;</span></pre><p id="7a11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们的组件将如下所示:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="9b65" class="ne lx iq na b gy nf ng l nh ni">import React from "react"<br/>import TextField from "<a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core/TextField"<br/>import Button from "<a class="ae kc" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core/Button"</span><span id="84df" class="ne lx iq na b gy oc ng l nh ni">const endpoints = {<br/>  contact: "/.netlify/functions/sendEmail",<br/>}<br/>const axios = require("axios")</span><span id="55ae" class="ne lx iq na b gy oc ng l nh ni">export default class Contact extends React.Component {<br/>  state = {<br/>    name: "",<br/>    email: "",<br/>    message: "",<br/>  }</span><span id="7379" class="ne lx iq na b gy oc ng l nh ni">handleChange = event =&gt; {<br/>    const name = event.target.name<br/>    const value = event.target.value<br/>    const statesToUpdate = {}<br/>    statesToUpdate[name] = value</span><span id="c76b" class="ne lx iq na b gy oc ng l nh ni">this.setState(statesToUpdate)<br/>  }</span><span id="93ca" class="ne lx iq na b gy oc ng l nh ni">handleSubmit = e =&gt; {<br/>    let { name, email, message } = this.state<br/>    let data = { name, email, message }<br/>    axios.post(endpoints.contact, JSON.stringify(data)).then(response =&gt; {<br/>      if (response.status !== 200) {<br/>        this.handleError()<br/>      } else {<br/>        this.handleSuccess()<br/>      }<br/>    })<br/>    e.preventDefault()<br/>  }</span><span id="078d" class="ne lx iq na b gy oc ng l nh ni">handleSuccess = () =&gt; {<br/>    this.setState({<br/>      name: "",<br/>      email: "",<br/>      message: "",<br/>      loading: false,<br/>      error: false,<br/>    })<br/>  }</span><span id="e7c9" class="ne lx iq na b gy oc ng l nh ni">handleError = msg =&gt; {<br/>    this.setState({<br/>      loading: false,<br/>      error: true,<br/>      msg,<br/>    })<br/>  }</span><span id="db31" class="ne lx iq na b gy oc ng l nh ni">render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;form noValidate autoComplete="off" onSubmit= {this.handleSubmit}&gt;<br/>          &lt;TextField<br/>            id="standard-name"<br/>            label="Name"<br/>            value={this.state.name}<br/>            onChange={this.handleChange}<br/>            name="name"<br/>          /&gt;<br/>          &lt;TextField<br/>            id="standard-email"<br/>            label="Email"<br/>            value={this.state.email}<br/>            onChange={this.handleChange}<br/>            name="email"<br/>          /&gt;<br/>          &lt;TextField<br/>            id="standard-message"<br/>            label="Message"<br/>            value={this.state.message}<br/>            onChange={this.handleChange}<br/>            name="message"<br/>          /&gt;<br/>          &lt;Button variant="contained" color="primary" type="submit"&gt;<br/>            Submit<br/>          &lt;/Button&gt;<br/>        &lt;/form&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="1437" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以在Github上添加、提交和推送。完成后，如果启用了Netlify上的自动部署，您只需等待几分钟，它就会联机并工作🎉 🥳 .如果您尝试发送电子邮件，您将会收到:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/02fe2181011598f0f5b33f20c02710d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-FwN-2ghnuiRuVL0IQl6g.png"/></div></div></figure><p id="0fd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常感谢你一直跟着我！如果你在这个过程中迷路了，最终版本可以在这里找到。如果有误导或者有任何问题，请随时发表评论。</p></div></div>    
</body>
</html>