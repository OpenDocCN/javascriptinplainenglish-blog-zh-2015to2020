<html>
<head>
<title>Testing React Native Components with Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest测试React本地组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-simplified-real-world-example-of-testing-a-react-native-component-with-jest-45dc7b1a31ad?source=collection_archive---------5-----------------------#2020-04-13">https://javascript.plainenglish.io/a-simplified-real-world-example-of-testing-a-react-native-component-with-jest-45dc7b1a31ad?source=collection_archive---------5-----------------------#2020-04-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2d74fcbc95a20a456ecda0674b342f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P5YzniwGBVET9EQn"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@frostroomhead?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Rodion Kutsaev</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1f59" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天我将向你展示如何用<strong class="kc io">React-Native-testing-library</strong>和<strong class="kc io"> Jest </strong>测试你的React原生组件。</p><p id="37d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将使用一个简单的组件来呈现一个<strong class="kc io">列表项</strong>，看起来像这样:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/b8c9f5c2fe4c79cb0d8777f9e0bf2cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*4PXn23Th56emogqttcg26Q.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">I am a person. Not even a cat person. I like dogs better.</figcaption></figure><p id="3715" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我假设您已经运行了一个expo/react-native项目，因此您可以向其中添加下面的组件代码:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="ed94" class="li lj in le b gy lk ll l lm ln">import * as <strong class="le io"><em class="lo">React </em></strong>from 'react';<br/>import { StyleSheet, Image } from 'react-native';<br/>import { ListItem } from 'react-native-elements';<br/><br/>export default function UserListItem(props) {<br/>    const { user, onPressItem } = props<br/><br/>    return (<br/>        &lt;ListItem<br/>            testID={'userListItemTestID'}<br/>            key={user.id}<br/>            avatar={&lt;Image source={{uri: user.profile_pic }} style={styles.avatarImage}/&gt;}<br/>            title={user.username}<br/>            titleStyle={{ color: 'white' }}<br/>            subtitle={user.bio}<br/>            onPress={() =&gt; { onPressItem(user) }}<br/>        /&gt;)<br/>}<br/><br/>const styles = StyleSheet.create({<br/>    avatarImage: {<br/>        height:35,<br/>        width:35,<br/>    }<br/>})</span></pre><p id="26af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在一切都准备好了，让我们开始测试吧。<br/>首先，我们需要用这些命令安装依赖项(这些步骤来自expo的<a class="ae jz" href="https://docs.expo.io/versions/latest/guides/testing-with-jest/" rel="noopener ugc nofollow" target="_blank"> Testing with Jest </a> guide，稍作调整，使用react-native-testing-library代替react-test-renderer):</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="17eb" class="li lj in le b gy lk ll l lm ln">npm i jest-expo react-native-testing-library --save-dev</span></pre><p id="4b18" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在将它添加到您的<code class="fe lp lq lr le b">package.json</code>文件中:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="fa44" class="li lj in le b gy lk ll l lm ln">"scripts": {<br/>  ...<br/>  "test": "jest"<br/>},<br/>"jest": {<br/>  "preset": "jest-expo",<br/>  "transformIgnorePatterns": [<br/>    "node_modules/(?!(jest-)?react-native|react-clone-referenced-element|@react-native-community|expo(nent)?|@expo(nent)?/.*|react-navigation|@react-navigation/.*|@unimodules/.*|unimodules|sentry-expo|native-base|@sentry/.*)"<br/>  ]<br/>}</span></pre><h2 id="420c" class="li lj in bd ls lt lu dn lv lw lx dp ly kl lz ma mb kp mc md me kt mf mg mh mi bi translated">现在我们准备好编写我们的第一个测试了！</h2><p id="2164" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">让我们从创建一个<code class="fe lp lq lr le b">__tests__</code>文件夹开始。因为我们组件的文件叫做<code class="fe lp lq lr le b">UserListItem.js</code>，所以只有调用我们的测试<code class="fe lp lq lr le b">UserListItem.test.js</code>才是相关的，这样jest会把它当作一个测试文件。我们将把我们的测试文件放到新创建的<code class="fe lp lq lr le b">__tests__</code>文件夹中，文件的内容如下:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="df21" class="li lj in le b gy lk ll l lm ln">import <strong class="le io"><em class="lo">React </em></strong>from 'react';<br/>import { <strong class="le io"><em class="lo">render</em></strong>, <strong class="le io"><em class="lo">cleanup</em></strong>, <strong class="le io"><em class="lo">fireEvent </em></strong>} from 'react-native-testing-library';<br/><br/>import UserListItem from '../Components/UserListItem';<br/><br/><strong class="le io"><em class="lo">describe</em></strong>('&lt;UserListItem /&gt;', () =&gt; {<br/>    afterEach(<strong class="le io"><em class="lo">cleanup</em></strong>)<br/><br/>    <strong class="le io"><em class="lo">it</em></strong>('calls onPress event to triger onPressItem with user as argument', () =&gt; {<br/>        const onPressItemMock = <strong class="le io"><em class="lo">jest</em></strong>.fn()<br/>        const user = {<br/>            "id": "123",<br/>            "profile_pic": "<a class="ae jz" href="https://placekitten.com/g/200/300" rel="noopener ugc nofollow" target="_blank"><strong class="le io">http://placekitten.com/g/200/300</strong></a>",<br/>            "username": "Lelbil",<br/>            "bio": "I am not a cat"<br/>        }<br/><br/>        const { getByTestId } = <strong class="le io"><em class="lo">render</em></strong>(&lt;UserListItem user={user} onPressItem={onPressItemMock} /&gt;)<br/><br/>        <strong class="le io"><em class="lo">fireEvent</em></strong>.press(getByTestId('userListItemTestID'))<br/>        <strong class="le io"><em class="lo">expect</em></strong>(onPressItemMock).toHaveBeenCalledWith(user);<br/>    });<br/>});</span></pre><p id="4ae2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">测试非常简单，当我们的<strong class="kc io"> UserListItem </strong>组件中的<strong class="kc io"> ListItem </strong>被按下时，我们启动一个要调用的模拟函数，然后我们触发press事件并检查我们的模拟是否用正确的参数调用。<code class="fe lp lq lr le b">afterEach</code>钩子确保每次测试运行后所有的东西都被清理干净，所以测试是等幂的。当然，还有更多的事情可以做或者测试，比如孩子，风格..等等</p><p id="3b11" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，关键时刻到了。转到终端，键入<code class="fe lp lq lr le b">npm run test</code>并按回车键。您的测试应该开始运行，几秒钟后，您应该会看到世界上最美丽的绿色在说:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="7996" class="li lj in le b gy lk ll l lm ln">PASS  __tests__/UserListItem.test.js<br/>  &lt;UserListItem /&gt;<br/>    ✓ calls onPress event to triger onPressItem with user as argument (51ms)</span><span id="d0bb" class="li lj in le b gy mo ll l lm ln">Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   0 total<br/>Time:        3.526s, estimated 4s<br/>Ran all test suites.</span></pre><p id="aeea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">恭喜你。您刚刚成功运行了您的第一个测试。狂野一点。</p></div><div class="ab cl mp mq hr mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ig ih ii ij ik"><h1 id="ee65" class="mw lj in bd ls mx my mz lv na nb nc ly nd ne nf mb ng nh ni me nj nk nl mh nm bi translated">快照测试</h1><p id="db1b" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">有些人可能会认为人类是一种极其懒惰的动物。如果你们中的一些人是人，因此懒惰，你可以让Jest为你写测试。这被称为<a class="ae jz" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">快照测试</a>。</p><p id="8725" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">快照测试实际上是获取组件的快照，然后对于每个未来的测试，将组件与第一次获取的快照进行比较。如果它们不同，测试就失败了。就这么简单。这对于确保我们不会意外更改组件非常有用。让我们一起编写我们的第一个快照测试。</p><p id="1c07" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，在第一个场景之后，我们将添加另一个场景，如下所示:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="f36f" class="li lj in le b gy lk ll l lm ln"><strong class="le io"><em class="lo">it</em></strong>('matches the snapshot', () =&gt; {<br/>    const onPressItemMock = <strong class="le io"><em class="lo">jest</em></strong>.fn()<br/>    const user = {<br/>        "id": "123",<br/>        "profile_pic": "http://placekitten.com/g/200/300",<br/>        "username": "Lelbil",<br/>        "bio": "I am not a cat"<br/>    }<br/>    const { toJSON } = <strong class="le io"><em class="lo">render</em></strong>(&lt;UserListItem user={user} onPressItem={onPressItemMock} /&gt;)<br/><br/>    <strong class="le io"><em class="lo">expect</em></strong>(toJSON()).toMatchSnapshot()<br/>})</span></pre><p id="e2ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这比第一个更简单。我们用<code class="fe lp lq lr le b">npm run test</code>再次运行测试。测试通过了，因为这是我们第一次运行快照测试，所以没有可用的快照。所以Jest为我们创造了一个。</p><p id="571e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您现在应该会注意到一个名为<code class="fe lp lq lr le b">__snapshots__</code>的新文件夹，您将在其中找到您的快照文件。现在，如果您再次运行测试，它将毫无问题地通过。但是如果有一天我不小心更改了UserListItem组件中的某个内容，这个测试就不会再通过了，我就会知道我破坏了我的小而美的组件。幸运的是，我将是第一个知道的人，而不是我的用户。</p><p id="fb83" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就这样，孩子们，现在出去写那些测试。你会对你的代码更有信心，引入更少的错误。记住:</p><blockquote class="nn"><p id="ad2b" class="no np in bd nq nr ns nt nu nv nw kx dk translated">未经测试的代码是被破坏的代码——莫里茨·范·里斯</p></blockquote><p id="f5ed" class="pw-post-body-paragraph ka kb in kc b kd nx kf kg kh ny kj kk kl nz kn ko kp oa kr ks kt ob kv kw kx ig bi translated">有用链接:<br/><a class="ae jz" href="https://callstack.github.io/react-native-testing-library/docs/api" rel="noopener ugc nofollow" target="_blank">https://call stack . github . io/react-native-testing-library/docs/API</a><br/><a class="ae jz" href="https://jestjs.io/docs/en/expect" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/expect</a></p></div><div class="ab cl mp mq hr mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ig ih ii ij ik"><h2 id="6410" class="li lj in bd ls lt lu dn lv lw lx dp ly kl lz ma mb kp mc md me kt mf mg mh mi bi translated"><strong class="ak">简明英语笔记</strong></h2><p id="0c1c" class="pw-post-body-paragraph ka kb in kc b kd mj kf kg kh mk kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">你知道我们有四种出版物吗？给他们一个follow来表达爱意:<a class="ae jz" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="kc io">JavaScript in Plain English</strong></a><a class="ae jz" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kc io">AI in Plain English</strong></a><a class="ae jz" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kc io">UX in Plain English</strong></a><a class="ae jz" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kc io">Python in Plain English</strong></a><strong class="kc io"/>—谢谢，继续学习！</p><p id="0767" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，我们总是有兴趣帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae jz" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">submissions @ plain English . io</strong></a><strong class="kc io"/>，并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>