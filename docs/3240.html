<html>
<head>
<title>Using React’s useEffect Hook to Fetch Data and Periodically Refresh The Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React的useEffect钩子获取数据并定期刷新数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-reacts-useeffect-hook-to-fetch-data-and-periodically-refresh-that-data-2a69b6d44081?source=collection_archive---------0-----------------------#2020-09-13">https://javascript.plainenglish.io/using-reacts-useeffect-hook-to-fetch-data-and-periodically-refresh-that-data-2a69b6d44081?source=collection_archive---------0-----------------------#2020-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="50a9" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">反应提示</h2><div class=""/><div class=""><h2 id="85c6" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用useEffect获取功能组件中的数据，并根据需要使用setInterval刷新数据。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/233574914ce1f70de4f67006080ecd69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XXvl42YX__m6xVja"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@spanic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Damir Spanic</a> on <a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2957" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">我们将学到什么</h1><p id="161e" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">尽管React的useEffect钩子允许你做很多事情，但在本教程中，我们将详细介绍如何使用useEffect钩子<strong class="lz ja">从API获取数据，</strong>和<strong class="lz ja">定期刷新数据</strong>。</p><p id="c930" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">你可以使用任何你喜欢的API，但我们将使用假的<a class="ae le" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank">API https://jsonplaceholder.typicode.com/</a>获取帖子。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="6178" class="nd lg iq mz b gy ne nf l ng nh">https://jsonplaceholder.typicode.com/posts</span></pre><h1 id="a6a1" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">使用效果</h1><p id="c8d5" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">通过使用这个钩子，你告诉React你的组件需要在渲染后做一些事情。React将记住您传递的函数(我们称之为“效果”)，并在执行DOM更新后调用它。</p><p id="fe76" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">在上面的语句中需要注意的一点是，useEffect钩子<strong class="lz ja">在DOM更新</strong>之后运行。因此，它不会阻止渲染过程。</p><p id="2466" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">其他重要的事情，尤其是从API获取数据，</p><p id="c163" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><em class="ni">默认情况下，它在第一次渲染后和每次更新</em>  <em class="ni">后都运行</em> <strong class="lz ja"> <em class="ni">。</em></strong></p><p id="661d" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">这意味着如果我们不小心，在我们获得数据和<strong class="lz ja">设置状态</strong>后，导致DOM更新，它将一次又一次地获取数据…</p><blockquote class="nj"><p id="6bf1" class="nk nl iq bd nm nn no np nq nr ns ms dk translated">我们将讨论如何避免这种无限的获取循环，以及如何定期获取数据，以便在添加新数据时“刷新”我们的数据。</p></blockquote><h1 id="7a2e" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf nt kg lr ki nu kj lt kl nv km lv lw bi translated">让我们开始吧</h1><p id="7072" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我将使用Visual Studio代码。您当然可以使用任何您想要的代码编辑器。</p><h2 id="515a" class="nd lg iq bd lh nw nx dn ll ny nz dp lp mg oa ob lr mk oc od lt mo oe of lv iw bi translated">初始设置</h2><ol class=""><li id="e732" class="og oh iq lz b ma mb md me mg oi mk oj mo ok ms ol om on oo bi translated">创建一个放置应用程序的目录。</li><li id="8da5" class="og oh iq lz b ma op md oq mg or mk os mo ot ms ol om on oo bi translated">启动VS代码，打开刚刚创建的文件夹。</li><li id="ce12" class="og oh iq lz b ma op md oq mg or mk os mo ot ms ol om on oo bi translated">打开一个终端窗口，输入这段代码来引导我们的React应用程序。</li></ol><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="090f" class="nd lg iq mz b gy ne nf l ng nh">npx create-react-app fetch-with-useeffect</span></pre><p id="8c79" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">接下来，我们需要切换到这个目录并运行npm start来启动开发服务器，以验证它正在运行我们的React应用程序。默认情况下，这将在本地主机端口3000上。</p><p id="926f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">4.应用程序启动后，在终端中键入以下内容。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="0be6" class="nd lg iq mz b gy ne nf l ng nh">cd fetch-with-useeffect<br/>npm start</span></pre><p id="a3ab" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">您应该会看到类似下图的内容。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/d9d421cc72e73db6cf13bdd2d40a3f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*GAF_DMLxwI39_m3o0Ly97Q.jpeg"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Basic React Application</figcaption></figure><p id="fc72" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们将使用Axios来获取数据。如果你愿意，你可以使用fetch或者任何你想要的东西。</p><p id="a34d" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">5.使用CTRL +C停止开发服务器并关闭浏览器选项卡。</p><p id="5b2f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">6.在终端窗口中键入以下内容来安装Axios。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="0501" class="nd lg iq mz b gy ne nf l ng nh">npm install axios</span></pre><p id="722c" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">7.打开App.js，用下面的代码替换默认代码。<em class="ni">注意useEffect钩子</em>的导入，以及useState和axios的导入。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="e5e5" class="nd lg iq mz b gy ne nf l ng nh">import React,<strong class="mz ja">{useEffect,useState}</strong> from 'react'<br/><strong class="mz ja">import axios from 'axios'</strong><br/>import './App.css'</span><span id="b3f4" class="nd lg iq mz b gy ov nf l ng nh">const App=()=&gt; {</span><span id="4ce5" class="nd lg iq mz b gy ov nf l ng nh">return (<br/>    &lt;div&gt;<br/>     &lt;h1&gt;useEffect&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="c1a0" class="nd lg iq mz b gy ov nf l ng nh">export default App;</span></pre><p id="fd39" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">8.保存并重新启动开发服务器，</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="cf38" class="nd lg iq mz b gy ne nf l ng nh">npm start</span></pre><p id="9a8f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">您应该在浏览器中只看到单词“<strong class="lz ja"> useEffect </strong>”。</p><h1 id="2fd6" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">使用UseEffect</h1><p id="f65b" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">现在我们准备使用useEffect！</p><p id="91a9" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">useEffect挂钩的基本语法如下。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="eafe" class="nd lg iq mz b gy ne nf l ng nh">useEffect(()=&gt;{</span><span id="88f6" class="nd lg iq mz b gy ov nf l ng nh">// Effect goes here  <br/>})</span></pre><blockquote class="nj"><p id="f439" class="nk nl iq bd nm nn ow ox oy oz pa ms dk translated">useEffect挂钩需要放在使用它的功能组件的主体中。</p></blockquote><p id="7900" class="pw-post-body-paragraph lx ly iq lz b ma pb ka mc md pc kd mf mg pd mi mj mk pe mm mn mo pf mq mr ms ij bi translated">我们将在一个名为<strong class="lz ja"> getPosts </strong>的javascript函数中获取我们的帖子。这个函数将从useEffect钩子中调用，它将驻留在功能性应用程序组件的主体中。</p><p id="1af3" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">getPosts的结果，即帖子本身，最初会显示在控制台中，但最终会使用useState钩子存储在State中。</p><p id="00f2" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">让我们编写一个函数来获取帖子，并从useEffect钩子调用这个函数。</p><p id="0eb8" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">1.像这样修改你的App.js。观察函数getPosts和对useEffect中函数的调用。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="de4b" class="nd lg iq mz b gy ne nf l ng nh">import React,{useEffect,useState} from 'react'<br/>import axios from 'axios'<br/>import './App.css'</span><span id="dfc7" class="nd lg iq mz b gy ov nf l ng nh">const App=()=&gt; {</span><span id="cedb" class="nd lg iq mz b gy ov nf l ng nh"><strong class="mz ja">const getPosts = async () =&gt; {<br/>  try {</strong></span><span id="3759" class="nd lg iq mz b gy ov nf l ng nh"><strong class="mz ja">const userPosts = await axios.get("</strong><a class="ae le" href="https://jsonplaceholder.typicode.com/posts" rel="noopener ugc nofollow" target="_blank"><strong class="mz ja">https://jsonplaceholder.typicode.com/posts</strong></a><strong class="mz ja">")<br/>    <br/>    console.log(userPosts.data);<br/>  <br/>  } catch (err) {<br/>    console.error(err.message);<br/>  }<br/>};</strong></span><span id="bc51" class="nd lg iq mz b gy ov nf l ng nh"><strong class="mz ja">useEffect(()=&gt;{<br/>    <br/>    getPosts()</strong></span><span id="eab4" class="nd lg iq mz b gy ov nf l ng nh"><strong class="mz ja">})</strong></span><span id="662d" class="nd lg iq mz b gy ov nf l ng nh">return (<br/>    &lt;div&gt;<br/>     &lt;h1&gt;useEffect&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="2c8e" class="nd lg iq mz b gy ov nf l ng nh">export default App;</span></pre><p id="99be" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">2.将您的开发工具保存并打开到控制台。您应该会看到一个帖子列表。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pg"><img src="../Images/f7f412c5f59e93f7702f3a2621553a75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xdo0rZMiELTw2sVLApXUnQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Posts obtained from <a class="ae le" href="https://jsonplaceholder.typicode.com/posts" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/posts</a></figcaption></figure><p id="59f0" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">注意，每篇文章都有一个id和一个标题。</strong></p><p id="d2fb" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们希望将这些帖子存储在一个名为posts的数组中，并在屏幕上显示这些帖子。</p><p id="cbe2" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们将添加一个useState钩子，初始化为一个空数组。</p><p id="bd7f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">const [posts，setPosts]=useState([])</p><p id="0404" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">数组<strong class="lz ja"> posts </strong>将存储GET调用返回的帖子数组，而<strong class="lz ja"> setPosts </strong>是设置帖子值的setter方法。</p><p id="213b" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">然后，我们将映射在屏幕上显示文章标题的文章，并使用文章id作为关键字。</p></div><div class="ab cl ph pi hu pj" role="separator"><span class="pk bw bk pl pm pn"/><span class="pk bw bk pl pm pn"/><span class="pk bw bk pl pm"/></div><div class="ij ik il im in"><p id="936f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja"> <em class="ni">重要:</em> </strong> <em class="ni">如前所述，useEffect是在DOM更新后运行的。如果我们随后改变getPosts中的状态，这会导致DOM更新，那么会再次获取posts。当这种情况发生时，状态被再次设置，无限地。当我们使用console.log()时，这不是问题，因为状态没有改变。</em></p><blockquote class="nj"><p id="6e51" class="nk nl iq bd nm nn no np nq nr ns ms dk translated">确保useEffect只运行一次的方法是使用一个空的依赖数组。</p></blockquote><p id="ce90" class="pw-post-body-paragraph lx ly iq lz b ma pb ka mc md pc kd mf mg pd mi mj mk pe mm mn mo pf mq mr ms ij bi translated">在本文中，我们不会关注依赖数组的所有用法，除非注意空数组会阻止useEffect在每次渲染后运行。更多关于依赖数组的信息可以在<a class="ae le" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8e9e" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">useEffect的新语法如下。请注意空数组。没有依赖关系，所以它只运行一次。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="d93f" class="nd lg iq mz b gy ne nf l ng nh">useEffect(() =&gt;{</span><span id="6bb9" class="nd lg iq mz b gy ov nf l ng nh">// Effect goes here  </span><span id="03bb" class="nd lg iq mz b gy ov nf l ng nh">}, <strong class="mz ja">[])</strong></span></pre><p id="44c5" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">如果没有使用空的依赖数组<strong class="lz ja">,下面是开发工具的网络部分的结果。</strong>从图像中无法明显看出GET正在连续执行。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi po"><img src="../Images/0c6227603055009e55b51c8387ae127a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bnx1b7MQiS0lgvr2Sfa8Gg.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Infinite loop of GET requests when not using an empty dependency array.</figcaption></figure></div><div class="ab cl ph pi hu pj" role="separator"><span class="pk bw bk pl pm pn"/><span class="pk bw bk pl pm pn"/><span class="pk bw bk pl pm"/></div><div class="ij ik il im in"><h2 id="2bbe" class="nd lg iq bd lh nw nx dn ll ny nz dp lp mg oa ob lr mk oc od lt mo oe of lv iw bi translated">显示帖子</h2><p id="7f80" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">在接下来的代码中，我们添加了useState，并将其传递给getPosts函数，这样它就可以将帖子的状态设置为userPosts.data。</p><p id="3b07" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><em class="ni">请注意，您可以将getPosts函数包含在功能性应用程序组件主体中。这将使您不必向函数传递setPosts。</em></p><p id="db6f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">在App.js的return语句中，我们映射了posts数组。</p><ol class=""><li id="05d6" class="og oh iq lz b ma mt md mu mg pp mk pq mo pr ms ol om on oo bi translated">对App.js进行这些更改，注意粗体显示的项目。</li></ol><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="2bcf" class="nd lg iq mz b gy ne nf l ng nh">import React,{useEffect,useState} from 'react'<br/>import axios from 'axios'<br/>import './App.css'</span><span id="90c3" class="nd lg iq mz b gy ov nf l ng nh">const App=()=&gt; {<br/> <strong class="mz ja"> const [posts, setPosts]=useState([])</strong></span><span id="98e1" class="nd lg iq mz b gy ov nf l ng nh">const getPosts = async () =&gt; {<br/>  try {</span><span id="16b1" class="nd lg iq mz b gy ov nf l ng nh">const userPosts = await axios.get("<a class="ae le" href="https://jsonplaceholder.typicode.com/posts" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/posts</a>")<br/>    <br/>    <strong class="mz ja">setPosts(userPosts.data);  // set State</strong><br/>  <br/>  } catch (err) {<br/>    console.error(err.message);<br/>  }<br/>};<br/>  <br/>  useEffect(()=&gt;{<br/>    <br/>    getPosts()</span><span id="9c0c" class="nd lg iq mz b gy ov nf l ng nh"><strong class="mz ja">},[])  // includes empty dependency array</strong></span><span id="ff6b" class="nd lg iq mz b gy ov nf l ng nh">return (<br/>    &lt;div&gt;<br/>     &lt;h1&gt;useEffect&lt;/h1&gt;<br/>     &lt;ul&gt;<br/>      <strong class="mz ja"> {posts.map(post=&gt;(<br/>         &lt;li key={post.id}&gt;{post.title}&lt;/li&gt;<br/>       ))}</strong><br/>     &lt;/ul&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="7cfb" class="nd lg iq mz b gy ov nf l ng nh">export default App;</span></pre><p id="afb9" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">2.在浏览器中保存并观察您的应用程序。它应该查看以下内容:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ps"><img src="../Images/37de2bbd6ea6d7a8781826c65bdeb15d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*wl_AdVedAt3IkZlBSap6UQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Posts returned from our App component</figcaption></figure><h2 id="e21b" class="nd lg iq bd lh nw nx dn ll ny nz dp lp mg oa ob lr mk oc od lt mo oe of lv iw bi translated">刷新帖子</h2><p id="6c93" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">虽然我们的帖子列表不会因为没有添加任何帖子而改变，但是在实际应用程序中，其他用户可能会添加帖子，您可能希望根据自己的选择定期刷新帖子列表。</p><p id="6311" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们将使用<strong class="lz ja"> setInterval </strong>每10秒更新一次我们的帖子列表。由于不会显示实际的新帖子(<a class="ae le" href="https://jsonplaceholder.typicode.com" rel="noopener ugc nofollow" target="_blank"> typicode </a>是一个假API)，我们将不得不使用我们的开发工具网络部分来观察每10秒的GET调用。</p><p id="a19d" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们还将增加一个间隙。这在较大的应用程序中很重要，这样当用户导航到另一个页面时，间隔就会被清除。</p><p id="4912" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">要完成刷新，请按如下方式修改useEffect，</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="fd69" class="nd lg iq mz b gy ne nf l ng nh">useEffect(()=&gt;{<br/>    <br/>   <strong class="mz ja"> getPosts()</strong></span><span id="713e" class="nd lg iq mz b gy ov nf l ng nh">    const interval=setInterval(()=&gt;{<br/>     <strong class="mz ja"> getPosts()</strong><br/>     },10000)<br/>       <br/>       <br/>    <strong class="mz ja"> return()=&gt;clearInterval(interval)</strong></span><span id="7c54" class="nd lg iq mz b gy ov nf l ng nh">},[])</span></pre><p id="e46c" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们最初获取帖子，然后每隔10秒钟再次调用getPosts。</p><p id="4524" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">使用您的开发人员工具，检查网络，您将看到每10秒就有一个GET。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/0a6c9703290c302e55950c40c4e579df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*_UsGA844A1G2VzUp1YMvsw.jpeg"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Initial GET and one every 10 seconds</figcaption></figure><h1 id="499a" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">结论</h1><p id="9d51" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">总之，我们已经看到了useEffect的一种用法，获取数据。我们还了解到，如果没有空的依赖数组，我们将会不断地调用GET调用；显然导致了巨大的网络流量。</p><p id="b421" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">然而，我们可能希望定期刷新数据，我们使用setInterval来实现这一点。</p><p id="0f6a" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><em class="ni">一如既往，我鼓励大家不仅要学习更多关于useEffect的知识，还要尝试这个应用程序，并对其进行扩展。</em></p><p id="c370" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><strong class="lz ja">感谢您的阅读和编码！</strong></p><p id="fe20" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><em class="ni">尽情阅读，加入Medium帮我继续写</em></p><div class="pu pv gp gr pw px"><a href="https://bobtomlin-70659.medium.com/membership" rel="noopener follow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd ja gy z fp qc fr fs qd fu fw iz bi translated">通过我的推荐链接加入灵媒——重力井(罗伯·汤姆林)</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">bobtomlin-70659.medium.com</p></div></div><div class="qg l"><div class="qh l qi qj qk qg ql ky px"/></div></div></a></div><p id="fbc5" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated"><em class="ni">您还可以享受:</em></p><div class="pu pv gp gr pw px"><a href="https://medium.com/javascript-in-plain-english/creating-your-first-react-application-db9dfe93b4f5" rel="noopener follow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd ja gy z fp qc fr fs qd fu fw iz bi translated">如何在你的第一个React应用中使用Props</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">建立一个产品展示器，而不是简单的Hello World！</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">medium.com</p></div></div><div class="qg l"><div class="qm l qi qj qk qg ql ky px"/></div></div></a></div><div class="pu pv gp gr pw px"><a href="https://medium.com/javascript-in-plain-english/react-router-and-spas-made-easy-19fd1db0d6fc" rel="noopener follow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd ja gy z fp qc fr fs qd fu fw iz bi translated">如何使用React-Router创建SPA</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">使用客户端路由创建单页应用程序</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">medium.com</p></div></div><div class="qg l"><div class="qn l qi qj qk qg ql ky px"/></div></div></a></div><div class="pu pv gp gr pw px"><a href="https://medium.com/javascript-in-plain-english/creating-your-second-react-application-d6d50e3e1e91" rel="noopener follow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd ja gy z fp qc fr fs qd fu fw iz bi translated">如何用useState钩子管理React中的状态</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">使用功能组件上的useState挂钩管理状态</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">medium.com</p></div></div><div class="qg l"><div class="qo l qi qj qk qg ql ky px"/></div></div></a></div><div class="pu pv gp gr pw px"><a href="https://medium.com/javascript-in-plain-english/two-ways-of-managing-state-in-a-functional-react-form-ef0929eefe67" rel="noopener follow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd ja gy z fp qc fr fs qd fu fw iz bi translated">在函数式反应表单中管理状态的两种方法</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">在注册表单中，对每个输入使用useState挂钩，而不是使用一个用户对象和一个useState挂钩。</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">medium.com</p></div></div><div class="qg l"><div class="qp l qi qj qk qg ql ky px"/></div></div></a></div><div class="pu pv gp gr pw px"><a rel="noopener  ugc nofollow" target="_blank" href="/what-is-next-js-and-server-side-rendering-9e24ea21c144"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd ja gy z fp qc fr fs qd fu fw iz bi translated">什么是Next.js和服务器端渲染</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">Next.js是由Vercel创建的React框架。与使用客户端渲染的React不同，Next.js使用服务器端…</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="qg l"><div class="qq l qi qj qk qg ql ky px"/></div></div></a></div><h2 id="1f05" class="nd lg iq bd lh nw nx dn ll ny nz dp lp mg oa ob lr mk oc od lt mo oe of lv iw bi translated"><strong class="ak">简单英语的JavaScript</strong></h2><p id="21b8" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae le" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="lz ja">订阅解码，我们的YouTube频道</strong> </a> <strong class="lz ja">获取更多类似内容！</strong></p></div></div>    
</body>
</html>