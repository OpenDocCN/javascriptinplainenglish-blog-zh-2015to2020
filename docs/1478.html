<html>
<head>
<title>Are Thunks Obsolete?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Thunks过时了吗？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/are-thunks-obsolete-2652681c39af?source=collection_archive---------2-----------------------#2020-03-21">https://javascript.plainenglish.io/are-thunks-obsolete-2652681c39af?source=collection_archive---------2-----------------------#2020-03-21</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="a3c4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为什么React-Redux挂钩可以取代React项目中对Thunks的需求。</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/a39180bff06d364cf3cc9c069fe0ac6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TPi3XEdyhTNql-5t"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Photo by <a class="ae lc" href="https://unsplash.com/@schluditsch?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniel Schludi</a> on <a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="632d" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">“铛”被定义为一种沉闷、沉重的声音，如物体落地时发出的声音。哦，等等…那是拟声词的字面解释。虽然，如果在本文结束时您同意我的前提，对thunk的文字描述可能是合适的，因为在React环境中，Thunk很可能已经过时了。</p><p id="a267" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">React land中的Thunk本质上是一种变通方法，允许调用异步函数，这些函数随后可以将操作分派给Redux存储。Thunks必须作为中间件连接起来才能完成这个工作，这很不幸也很麻烦，幸运的是我有启动我的项目的生成器，这样我就不用每次都自己动手了。考虑将清单1作为将Thunk作为中间件应用于<code class="fe ld le lf lg b">configure-store.ts</code>文件的例子。</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="lh li l"/></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Listing 1 — Adding ThunkMiddleware to a configure-store function.</figcaption></figure><p id="8f6b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这个存储现在被连接起来使用调度函数，这些函数生成正常的Redux操作或异步Thunk操作。清单2演示了一个异步的Thunk动作，该动作可以被分派到一个存储区，该存储区由清单2中作为默认导出导出的函数生成。</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="lh li l"/></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Listing 2 — An asynchronous action that dispatches an action upon completion of an http call.</figcaption></figure><p id="8eb2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">正如您所看到的，为了用Thunk创建一个异步动作，您的动作生成器必须返回一个将dispatch函数作为唯一参数的函数。在该函数中，您可以通过访问主体中的dispatch函数来执行任何想要的异步函数。因此，在这个例子中，当一个组件调用<code class="fe ld le lf lg b">dispatch(getDataWithThunk())</code>时，它将向一个未指定的URL发出一个HTTP请求(假设代码示例中有一个真实的URL ),然后这个HTTP调用返回的数据将作为一个参数提供给<code class="fe ld le lf lg b">setData</code>动作生成器，并发送到<code class="fe ld le lf lg b">Provider</code>组件在React应用程序中配置的Redux存储。这很有用，而且在React挂钩之前，这是用Redux完成异步操作的首选方式。</p><p id="e621" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">然而，你也可以很容易地用一个反模式编写这个函数，并直接从你提供给<code class="fe ld le lf lg b">Provider</code>组件的存储中导入调度函数。这将被认为是单例模式，在大多数情况下是不被允许的。这是因为在大多数情况下，您希望您的组件、动作和reducers都是模块化的，并且可以单独测试。通过使用singleton模式(如清单3所示),您可以在单个商店和使用该商店的组件之间创建紧密耦合。</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="lh li l"/></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Listing 3 — The anti-pattern of dispatching directly from a singleton store.</figcaption></figure><p id="062f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">虽然它是一个反模式，但它确实展示了如何在不使用Thunk的情况下，在异步调用后完成向存储分发数据。那么，我们能做得更好吗？我们能在不需要使用单例模式的情况下从我们的项目中消除Thunks吗？这就是钩子的用处。现在React已经引入了钩子，React-Redux库也开始使用它们，我认为Thunks已经没有必要了。考虑清单4，其中我使用React-Redux库中的<code class="fe ld le lf lg b">useDispatch</code>钩子创建了一个定制钩子。</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="lh li l"/></div><figcaption class="ky kz gk gi gj la lb bd b be z dk">Listing 4 — Creating a data service custom hook.</figcaption></figure><p id="503a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">在这个例子中，我创建了一个可以在组件内部实例化的数据服务钩子。这个钩子返回一个<code class="fe ld le lf lg b">getData</code>函数，当在一个组件中使用时，这个函数可以被析构。它被认为是一个自定义钩子，因为它在in中使用一个钩子，并且它返回可以在组件中使用的值。<code class="fe ld le lf lg b">useDispatch</code>钩子将从调用组件中推断哪个存储被配置到最近的<code class="fe ld le lf lg b">Provider</code>父组件，并针对该存储分派动作，从而消除了使用单例模式的需要。清单5展示了如何在功能组件中使用这个定制钩子。</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="lh li l"/></div></figure><p id="13d4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">注意<code class="fe ld le lf lg b">useDataService</code>定制钩子如何将<code class="fe ld le lf lg b">getData</code>函数作为一个析构变量返回，然后可以在组件内部的任何地方使用。在这个例子中，当组件挂载时,<code class="fe ld le lf lg b">useEffect</code>钩子调用<code class="fe ld le lf lg b">getData</code>,然后将HTTP请求返回的数据发送到redux存储。然后，React-Redux库中的<code class="fe ld le lf lg b">useSelector</code>钩子从存储中提取数据，供组件使用，并在选择器返回的数据发生变化时触发组件重新呈现。这演示了如何使用钩子而不是Thunks来完整地创建和使用一个完整的异步动作。</p><p id="68aa" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">那么，Thunks过时了吗？我很乐意在下面的评论中听到你的意见。</p><p id="217c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">杰森·李·霍奇斯是软件工程团队的领导者，也是《从零开始的软件工程》一书的作者你可以在这里  <em class="lj">了解更多关于这本书的信息或者在线订购</em> <a class="ae lc" href="http://bit.ly./JHODGES" rel="noopener ugc nofollow" target="_blank"> <em class="lj">。</em></a></p><p id="8123" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><em class="lj">更多内容请看</em><a class="ae lc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jq is"><em class="lj">plain English . io</em></strong></a></p></div></div>    
</body>
</html>