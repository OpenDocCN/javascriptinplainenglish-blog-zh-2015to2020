<html>
<head>
<title>How To Implement LinkedIn Sign In With Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Next.js实现LinkedIn签到</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-implement-linkedin-sign-in-with-next-js-3f00e7dee310?source=collection_archive---------2-----------------------#2020-10-15">https://javascript.plainenglish.io/how-to-implement-linkedin-sign-in-with-next-js-3f00e7dee310?source=collection_archive---------2-----------------------#2020-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f04a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">LinkedIn API如何工作，这样您就可以将LinkedIn登录添加到您的Next.js项目中！</h2></div><p id="339f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，我为一个客户在一个网站上实现LinkedIn OAuth。这很难。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/fff57c88137ad8e88362189d26e2e416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cm2s5fBnU_BqOFDlNMuagQ.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Photo by <a class="ae lr" href="https://unsplash.com/@inlytics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">inlytics</a> on <a class="ae lr" href="https://unsplash.com/s/photos/linkedin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="82ba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回想起来，我认为这很难，因为我的第一个错误是没有足够仔细地阅读LinkedIn文档。所以，不要和我犯同样的错误，这里是<a class="ae lr" href="https://docs.microsoft.com/fr-fr/linkedin/consumer/integrations/self-serve/sign-in-with-linkedin" rel="noopener ugc nofollow" target="_blank">这里是</a>。或者说吧，反正我会解释一切的！</p><h1 id="4d56" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.创建LinkedIn应用程序</h1><p id="747e" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">第一步是在LinkedIn上创建一个应用程序。这很简单。点击<a class="ae lr" href="https://www.linkedin.com/developers/" rel="noopener ugc nofollow" target="_blank">此处</a>，然后点击“我的应用”，然后点击“创建应用”。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mp"><img src="../Images/4ac1bb35eec35b02fde0b8c2710fc3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rwQWiNnN_hMtDKyIFv143w.png"/></div></div></figure><p id="a65d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建应用程序后，您将能够在“我的应用程序”中看到您需要的所有信息，单击您的应用程序，然后进入“验证”选项卡:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mq"><img src="../Images/a4900cecd1443e759fc1253979062c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGeLK9a5qiFYPLMiJZp3JA.png"/></div></div></figure><h1 id="4d44" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.创建新的next应用程序</h1><p id="6c46" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">对于本教程，我决定模拟我第一次登录LinkedIn的网站。因此，我将使用相同的技术，从头开始开发新的next应用程序。</p><pre class="lc ld le lf gt mr ms mt mu aw mv bi"><span id="f708" class="mw lt iq ms b gy mx my l mz na">npx create-next-app<!-- --> linkedin-sign-in<br/>cd linkedin-sign-in<br/>npm start # open http://localhost:3000</span></pre><p id="553b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果要跟着来，gitHub回购这里是<a class="ae lr" href="https://github.com/marieqg/medium-linkedIn-sign-in" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><h1 id="460d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.LinkedIn登录后面</h1><p id="3420" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">第一部分非常简单。现在，让我们首先从理解我们将要做的事情的概念开始:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nb"><img src="../Images/262c4436aec26bbf134249b50d436c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXTQlhZM1M_OyeaTibIROg.png"/></div></div></figure><h2 id="675e" class="mw lt iq bd lu nc nd dn ly ne nf dp mc ko ng nh me ks ni nj mg kw nk nl mi nm bi translated">3.1.创建您的前端</h2><p id="7cec" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">所以，第一步是最容易的。我们将创建一个带有按钮的前端。让我们从创建一个<code class="fe nn no np ms b">component</code>文件夹开始，我们将在其中创建一个名为<code class="fe nn no np ms b">LinkedInAuth.js</code>的文件，它看起来像这样:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6e4b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你在按钮中看到的，我使用了一个LinkedIn登录按钮的链接，这个链接是在网上找到的，用于演示目的。强烈建议你用自己的:)</p><p id="c346" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您在localhost:3000中看到的，它现在无法工作。这是因为我们没有创建按钮应该发送给你的<code class="fe nn no np ms b">LINKEDIN_URL</code>变量。那么，让我们开始吧，让我们创建一个<code class="fe nn no np ms b">helpers</code>文件夹，和一个文件<code class="fe nn no np ms b">auth.js</code>文件夹。在这个文件夹中，我们将有一个函数，它将从不同的参数创建一个查询URL。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ns"><img src="../Images/add5ffb9dd2df8c521a884bf75029b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrDlrCKgq0XCm4q3YlZ4Lw.png"/></div></div></figure><p id="44a1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个URL的目的是调用LinkedIn登录页面来获得LinkedIn用户的许可。根据<a class="ae lr" href="https://docs.microsoft.com/fr-fr/linkedin/shared/authentication/authorization-code-flow?context=linkedin/context" rel="noopener ugc nofollow" target="_blank"> LinkedIn文档</a>，将需要以下参数来处理请求。</p><p id="5554" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中一些参数非常机密，所以不要忘记将它们配置为环境变量，也不要放在GitHub上。</p><p id="beae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要将它们配置为环境变量，在项目的根目录下创建一个<code class="fe nn no np ms b">.env</code>文件(即。和你的a <code class="fe nn no np ms b">package.json</code>和a <code class="fe nn no np ms b">next.config.js</code>一个级别。在您的<code class="fe nn no np ms b">.env</code>文件中，添加我们在第一步中创建的LinkedIn应用程序中可以找到的以下变量:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">.env</figcaption></figure><p id="b9f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，做一个<code class="fe nn no np ms b">npm install dot-env</code>，并在你的<code class="fe nn no np ms b">next.config.js</code>中添加以下内容:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="aae7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成这些更改后，不要忘记重启开发服务器。这就是<code class="fe nn no np ms b">auth.js</code>文件应该看起来的样子:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">auth.js</figcaption></figure><p id="cd03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们有了一个重定向到LinkedIn登录页面的按钮🎊🎉：</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/3ef10b75930fc8886aef82c9a4844f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*HVz6oCGUfx4lnzzFnQ6bjA.gif"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Our button with the LinkedIn Sign In page</figcaption></figure><p id="2ebc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在路上的某个地方迷路了，我们就在这里。</p><h2 id="a355" class="mw lt iq bd lu nc nd dn ly ne nf dp mc ko ng nh me ks ni nj mg kw nk nl mi nm bi translated">3.2.调用LinkedIn API来获取登录页面</h2><p id="6827" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">让我们继续前进！现在，我们的用户可以登录他的LinkedIn帐户。一旦他成功登录，LinkedIn将向我们发送一个响应代码。因此，在这一步中，我们的工作是取回授权码，并将其交换为授权令牌。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nu"><img src="../Images/d57cd4ab774a1f4d74909e3c1eb527e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x04GX8n93XhxwiseJq3bTQ.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">LinkedInDoc</figcaption></figure><p id="04d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦用户成功登录LinkedIn，LinkedIn会将我们重定向到我们设置的页面。这个页面已经在我们的环境变量中设置为<code class="fe nn no np ms b">LINKEDIN_REDIRECT</code>。不要忘记在你的LinkedIn应用程序中添加URL，该URL位于授权URL要重定向的部分。</p><p id="82b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们在文件夹<code class="fe nn no np ms b">pages/api</code>中创建一个名为<code class="fe nn no np ms b">oauth.js</code>的文件:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">oauth.js</figcaption></figure><p id="ee2c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你所看到的，我们正在通过服务器的请求获取LinkedIn发送给我们的代码(即此处上下文)。有了这些代码，我们将使用之前创建的<code class="fe nn no np ms b">getURLWithQueryOParams</code>函数来创建一个新的URL进行查询。如果响应是好的，我们有我们的令牌。</p><p id="3751" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您尝试console.log(tok ),您将从LinkedIn获得如下授权令牌:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nv"><img src="../Images/0a90e90f8fc996b2700e10a3dc9a48d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jk6HOqpDGXX2vaO2up7c9A.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">console.log(tok)</figcaption></figure><p id="98f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在路上的某个地方迷路了，我们就在这里。</p><h2 id="6989" class="mw lt iq bd lu nc nd dn ly ne nf dp mc ko ng nh me ks ni nj mg kw nk nl mi nm bi translated">3.3.获取LinkedIn答案并收集用户信息</h2><p id="f8d1" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">现在我们有了令牌，我们离获取用户信息还有一步之遥。正如您在LinkedIn文档中看到的，您现在可以提出一个经过身份验证的请求:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nu"><img src="../Images/e0461833d22dd844425675d9986ac3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3EjVoIcDIW8mHrUpKYhEA.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Extract of the LinkedIn doc</figcaption></figure><p id="bc16" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，让我们在<code class="fe nn no np ms b">oauth.js</code>文件中提出这个请求:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="daff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您使用console.log(u ),您将得到以下响应:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nw"><img src="../Images/131b09068bd649a9fa3f0f329c965393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0HqV8gqVVCkKoZA6jQH1w.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">console.log of u</figcaption></figure><p id="7e75" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在路上的某个地方迷路了，我们就在这里。</p><p id="eb51" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，如果您想获得您的用户电子邮件，这是另一个需要完成的请求。这里的文档是<a class="ae lr" href="https://docs.microsoft.com/en-us/linkedin/shared/integrations/people/primary-contact-api" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="9690" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.再直接的</h1><p id="0808" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">如您所见，您正在设法获取数据。但是，您的前端页面保持不变。所以，现在是时候在用户登录后重定向他或她了。</p><p id="11b3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我一开始稍微清理了一下我的代码，只是为了让服务器的请求和响应出现(即请求和结果)。现在，有了响应，我可以在找到我的用户后重定向到另一个页面:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="64bb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在路上的某个地方迷路了，我们就在这里<a class="ae lr" href="https://github.com/marieqg/medium-linkedIn-sign-in/tree/4" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="782e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了LinkedIn用户登录后，还可以做更多的事情，但我在这里选择了一个快速取胜的方法，只是为了验证一下。回购在这里是<a class="ae lr" href="https://github.com/marieqg/medium-linkedIn-sign-in" rel="noopener ugc nofollow" target="_blank">这里是</a>，但是看看:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1c1ecf28f0c34cf391c2e4c44407fa32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*fUohQcp4MZNRqlSavd4ztg.gif"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Final result</figcaption></figure><p id="d528" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">祝贺你完成了项目🎉🎊，并感谢阅读到最后！</p></div></div>    
</body>
</html>