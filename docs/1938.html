<html>
<head>
<title>Build Your First Unikernel With Express.JS And NanoVMs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Express构建您的第一个单核。JS和NanoVMs</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-your-first-unikernel-with-express-js-and-nanovms-21d64ff7231c?source=collection_archive---------11-----------------------#2020-05-05">https://javascript.plainenglish.io/build-your-first-unikernel-with-express-js-and-nanovms-21d64ff7231c?source=collection_archive---------11-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a75c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">名列前茅</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4cd0ef4c0b683a17a64542be793cd56f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w6G4x0FhULJ1zb7k.png"/></div></div></figure><p id="d4c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">单核是云计算的下一个时代。与集装箱相比，它们的占地面积更小，安全性更高。在本文中，我将引导您部署一个Express。使用单内核的JS后端。</p><blockquote class="ln lo lp"><p id="5c10" class="kr ks lq kt b ku kv jr kw kx ky ju kz lr lb lc ld ls lf lg lh lt lj lk ll lm ij bi translated"><em class="iq">在任何情况下都不要将其用于生产。单核离发布阶段还很远，还缺少很多特性。</em></p></blockquote><h1 id="56a4" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">什么是单核？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/c7458e38f65a1dedac7e900dc822701b.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/0*B_oka5_rmRnt0lHm.png"/></div></figure><p id="7c60" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">单核本质上是一个容器，但不需要主机操作系统。所有系统调用和操作系统功能都作为库与应用程序捆绑在一起。如果你从来没有听说过Unikernels，我建议你先<a class="ae mn" href="https://everyday.codes/linux/unikernel-vs-container-vs-operating-system-side-by-side-comparison/" rel="noopener ugc nofollow" target="_blank">看看这个</a>。</p><h1 id="0168" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">步骤1:创建一个简单的后端</h1><p id="0f7a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">首先，我们将创建一个简单的Express。JS后端。Unikernels仍处于开发的早期阶段，所以我们将保持它非常简单，可以说是一个概念验证。首先创建一个<em class="lq"> npm </em>项目(在一个新的项目文件夹中运行这些项目):</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="fbce" class="my lv iq mu b gy mz na l nb nc">&gt; npm init<br/>&gt; npm i -S express</span></pre><p id="8331" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，将这段代码放入<code class="fe nd ne nf mu b">index.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="c0c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这应该很简单。我们创建了一个Express服务器，它监听端口3000并以文本消息进行响应。您可以通过运行<code class="fe nd ne nf mu b">node index.js</code>并在浏览器中打开<a class="ae mn" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>来验证一切是否正常。</p><h1 id="7f61" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">步骤2:安装OPS</h1><p id="386a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">对于本教程，我们将使用<a class="ae mn" href="https://nanovms.com/" rel="noopener ugc nofollow" target="_blank"> NanoVMs </a> unikernel，因为它支持JavaScript。这个单核的构建工具叫做<a class="ae mn" href="https://github.com/nanovms/ops" rel="noopener ugc nofollow" target="_blank"> OPS </a>。要安装它，请在您的终端中运行以下命令:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="4451" class="my lv iq mu b gy mz na l nb nc">&gt; curl https://ops.city/get.sh -sSfL | sh</span></pre><p id="3844" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">按照安装并回答几个问题。一切完成后，通过在一个新的<strong class="kt ir">终端会话中运行<code class="fe nd ne nf mu b">ops version</code>来验证安装。你的OPS版本至少应该是<code class="fe nd ne nf mu b">0.1.9</code>。</strong></p><h1 id="21b1" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">步骤3:捆绑您的依赖项</h1><p id="ce51" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">现在不可能在单内核中运行<code class="fe nd ne nf mu b">npm i</code>，所以我们必须将依赖项(<code class="fe nd ne nf mu b">express</code>)和我们的代码捆绑在一起。为此，我们将使用<code class="fe nd ne nf mu b">rollup</code>。安装所需的依赖项:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="65a5" class="my lv iq mu b gy mz na l nb nc">&gt; npm i -D rollup @rollup/plugin-commonjs @rollup/plugin-json @rollup/plugin-node-resolve</span></pre><p id="a1f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，用以下内容创建一个名为<code class="fe nd ne nf mu b">rollup.config.js</code>的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="55a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这告诉rollup将我们代码需要的所有东西打包到一个大文件中。要运行它，将以下内容添加到<code class="fe nd ne nf mu b">package.json</code>中的<code class="fe nd ne nf mu b">scripts</code>部分:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="76ff" class="my lv iq mu b gy mz na l nb nc">"build": "rollup -c"</span></pre><p id="d27c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，运行<code class="fe nd ne nf mu b">npm run build</code>。这应该会在<code class="fe nd ne nf mu b">output</code>中产生一个<code class="fe nd ne nf mu b">index.js</code>。</p><h1 id="d5a0" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">步骤4:运行单内核</h1><p id="cfc9" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">现在，我们已经做好了在单核上构建和运行您的应用程序的一切准备。令人惊讶的是，这是最简单的一步，这要归功于NanoVMs的OPS。在项目根目录中，运行:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="2ff3" class="my lv iq mu b gy mz na l nb nc">&gt; ops load node_v11.5.0 -a output/index.js -p 3000</span></pre><p id="3793" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个命令告诉OPS使用节点11.5的基本映像，加载<code class="fe nd ne nf mu b">output/index.js</code>文件并打开端口3000。运行它时，您应该会看到以下输出:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="1f14" class="my lv iq mu b gy mz na l nb nc">[node output/index.js] <br/>booting /home/mk/.ops/images/node.img ... <br/>assigned: 10.0.2.15 <br/>Example app listening at <a class="ae mn" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span></pre><p id="5989" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">恭喜，您刚刚在单内核中运行了您的Node应用程序！您可以通过在浏览器中访问<a class="ae mn" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>来验证一切正常；</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/20869dc4a304aacb5793ad5438be72d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/0*mgAfftF3t_fPoPov.png"/></div></figure><h1 id="03bc" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">结束语</h1><p id="1324" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">感谢您的阅读，希望您成功地用Unikernels部署了您的Node app。敬请关注更多教程！</p><h1 id="1084" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">资源</h1><ul class=""><li id="8158" class="nj nk iq kt b ku mo kx mp la nl le nm li nn lm no np nq nr bi translated"><a class="ae mn" href="https://nanovms.com/" rel="noopener ugc nofollow" target="_blank"> NanoVMs网站</a></li><li id="368b" class="nj nk iq kt b ku ns kx nt la nu le nv li nw lm no np nq nr bi translated"><a class="ae mn" href="https://everyday.codes/linux/unikernel-vs-container-vs-operating-system-side-by-side-comparison/" rel="noopener ugc nofollow" target="_blank">未知vs容器vs操作系统</a></li><li id="3f5d" class="nj nk iq kt b ku ns kx nt la nu le nv li nw lm no np nq nr bi translated"><a class="ae mn" href="http://unikernel.org/" rel="noopener ugc nofollow" target="_blank"> Unikernels项目网站</a></li></ul></div></div>    
</body>
</html>