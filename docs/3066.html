<html>
<head>
<title>JavaScript Unit Test Best Practices — Testing Behavior</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript单元测试最佳实践—测试行为</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-unit-test-best-practices-testing-behavior-4d1fd46ae03d?source=collection_archive---------7-----------------------#2020-08-25">https://javascript.plainenglish.io/javascript-unit-test-best-practices-testing-behavior-4d1fd46ae03d?source=collection_archive---------7-----------------------#2020-08-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/63ffdb88c2fbedb79479e4308d3a95a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A4UylzYviIUZAKsE"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@battlecreekcoffeeroasters?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Battlecreek Coffee Roasters</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b1b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序如何工作非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写JavaScript单元测试时应该遵循的一些最佳实践。</p><h1 id="be19" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试行为而不是内部实现</h1><p id="d577" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该只测试结果，不要担心内部实现。</p><p id="f814" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就不会担心一些不需要在测试中检查的东西。</p><p id="8c78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们不应该测试内部变量:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3e0a" class="mn lc iq mj b gy mo mp l mq mr">it('should add a user to database', () =&gt; {<br/>  userManager.addUser('james', 'password');</span><span id="ffbb" class="mn lc iq mj b gy ms mp l mq mr">  expect(userManager._users[0].name).toBe('james');<br/>  expect(userManager._users[0].password).toBe('password');<br/>});</span></pre><p id="edcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">相反，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eece" class="mn lc iq mj b gy mo mp l mq mr">it('should add a user to database', () =&gt; {<br/>  userManager.addUser('james', 'password');<br/>  expect(userManager.login('james', 'password')).toBe(true);<br/>});</span></pre><p id="8356" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是测试返回的结果，而不是内部变量。</p><p id="1876" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，当实现改变时，我们不必改变我们的测试。</p><h1 id="d418" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不要嘲笑一切</h1><p id="5888" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该嘲笑一切。</p><p id="11c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，至少我们在测试一些东西。</p><p id="8566" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="aa86" class="mn lc iq mj b gy mo mp l mq mr">describe('when the user has already visited the page', () =&gt; {<br/>  describe('when the message is available', () =&gt; {<br/>    it('should display the message', () =&gt; {<br/>      const storage = new MemoryStorage(); <br/>      storage.setItem('page-visited', '1');<br/>      const messageManager = new MessageManager(storage);<br/>      spyOn(messageManager, 'display');<br/>      messageManager.start();<br/>      expect(messageManager.display).toHaveBeenCalled();<br/>    });<br/>  });<br/>});</span></pre><p id="e1d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用内存存储解决方案，而不是真正的本地存储。</p><p id="a4d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们的测试不会对我们的测试产生任何副作用。</p><p id="7c91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们没有模仿<code class="fe mt mu mv mj b">messageManager.display</code>，因为我们只是想检查它是否被调用。</p><p id="0a2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果设置简单，我们使用真实版本的对象。</p><p id="5990" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们也不应该在测试之间创建共享状态。</p><p id="b4ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实物如果用的话速度应该很快。</p><p id="8427" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">真实对象也不应该发出任何网络请求或重新加载浏览器页面。</p><h1 id="3b87" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为每个缺陷创建新的测试</h1><p id="e0c9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">应该有针对所有已修复缺陷的新测试。</p><p id="2dda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以修复它，并且永远不会让它以相同的形式再次出现。</p><h1 id="7c29" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不要为复杂的用户交互编写单元测试</h1><p id="b8f2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">单元测试应该用来测试简单的动作。</p><p id="e5b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想要测试更复杂的工作流，那么我们应该添加集成或者端到端测试。</p><p id="ea07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们都是更复杂的工作流所需要的，比如填表和提交数据等。</p><p id="3194" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">功能测试可以用Selenium或Cypress这样的框架来编写。</p><h1 id="1f4a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试简单的用户操作</h1><p id="af93" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该测试简单的用户动作，比如点击和输入。</p><p id="5078" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="82de" class="mn lc iq mj b gy mo mp l mq mr">describe('clicking on the "Preview profile" link', () =&gt; {<br/>  it('should show the profile preview if it is hidden', () =&gt; {<br/>    const button = document.querySelector('button');<br/>    const profileModule = createProfileModule({ visible: false });   <br/>    spyOn(profileModule, 'show'); <br/>    button.click(previewLink);<br/>    expect(profileModule.show).toHaveBeenCalled();<br/>  });</span><span id="21d9" class="mn lc iq mj b gy ms mp l mq mr">  it('should hide the profile preview if it is displayed', () =&gt; {<br/>    const button = document.querySelector('button');<br/>    const profileModule = createProfileModule({ visible: true });<br/>    spyOn(profileModule, 'hide');<br/>    button.click();<br/>    expect(profileModule.hide).toHaveBeenCalled();<br/>  });<br/>});</span></pre><p id="29cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有各种状态的<code class="fe mt mu mv mj b">profileModule</code>,我们点击每个状态。</p><p id="6149" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们检查哪个函数被调用。</p><h1 id="6c59" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">审查测试代码</h1><p id="011f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">应该查看测试代码，这样我们就能很快知道开发人员的意图。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/3315cd48a65a95e7e9ada4c6521ff190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F4h-kzg5e0P-s8sp"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@nci?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">National Cancer Institute</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="5ffb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d7b6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该在测试中测试简单的行为。</p><p id="6e6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们不应该嘲笑一切来进行更真实的测试。</p><h2 id="0d8c" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="7e3c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> plainenglish.io </strong> </a>找到所有内容的链接！</p></div></div>    
</body>
</html>