<html>
<head>
<title>Structuring React Application For Scale (Part-II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结构化反应量表的应用(下)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/structuring-react-application-for-scale-part-ii-d652ff418da0?source=collection_archive---------7-----------------------#2020-10-11">https://javascript.plainenglish.io/structuring-react-application-for-scale-part-ii-d652ff418da0?source=collection_archive---------7-----------------------#2020-10-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/f70b157fc9142caae2453537cee00b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5XB1HojFlWIGvfNv"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@waguluz_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andreas Wagner</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="93a4" class="pw-subtitle-paragraph ka jc jd bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">构建一个Reddit客户端，用户可以在其中搜索多个主题，并以列表的形式获得结果。</h2></div><p id="efc4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在上一个教程中，我们定义了可伸缩React应用程序的基本结构。为了演示这一切是如何结合在一起的，我们将构建一个Reddit客户端，用户可以在其中搜索多个主题，并以列表的形式获得结果。</p><p id="d64c" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果你还不知道，请参考<a class="ae ja" href="https://medium.com/@anishkargaonkar/structuring-react-application-for-scale-part-i-1ce39f69bd42" rel="noopener">第一部分</a>以深入了解该结构。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lo"><img src="../Images/e4b8738e1c6e9cbe1abfac464fc98018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5VSQWpA9CXjOeR00WmNzjg.gif"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Final preview</figcaption></figure><p id="7a97" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">GitHub:<a class="ae ja" href="https://github.com/anishkargaonkar/react-reddit-client" rel="noopener ugc nofollow" target="_blank">https://github.com/anishkargaonkar/react-reddit-client</a><br/>主持:<a class="ae ja" href="https://reddit-client-88d34d.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://reddit-client-88d34d.netlify.app/</a></p><h1 id="ee8a" class="lt lu jd bd lv lw lx ly lz ma mb mc md kj me kk mf km mg kn mh kp mi kq mj mk bi translated">Reddit客户端</h1><p id="cb43" class="pw-post-body-paragraph ks kt jd ku b kv ml ke kx ky mm kh la lb mn ld le lf mo lh li lj mp ll lm ln ig bi translated">让我们从在<code class="fe mq mr ms mt b">/src/cotainers/Search/Search.tsx</code>创建一个名为<strong class="ku je"> Search </strong>的容器开始</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="c653" class="my lu jd mt b gy mz na l nb nc">// /src/cotainers/Search/Search.tsx<br/>import React, { FC } from "react";</span><span id="d6c0" class="my lu jd mt b gy nd na l nb nc">type Props = {};</span><span id="aa25" class="my lu jd mt b gy nd na l nb nc">const Search: FC&lt;Props&gt; = (props: Props) =&gt; {<br/>    return (<br/>        &lt;div&gt;Search Container&lt;/div&gt;<br/>    )<br/>};</span><span id="d669" class="my lu jd mt b gy nd na l nb nc">export { Search };</span></pre><p id="2c15" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">并在<code class="fe mq mr ms mt b">/src/navigator/Navigator.tsx</code>将其添加到<strong class="ku je">导航器</strong>组件中</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="3da5" class="my lu jd mt b gy mz na l nb nc">// /src/navigator/Navigator.tsx<br/>import React, { FC } from "react";<br/>import { Switch, Route, BrowserRouter as Router } from "react-router-dom";<br/>import { Search } from "../containers/Search/Search";</span><span id="890c" class="my lu jd mt b gy nd na l nb nc">type Props = {};</span><span id="c8fd" class="my lu jd mt b gy nd na l nb nc">const Navigator: FC&lt;Props&gt; = () =&gt; {<br/>  return (<br/>    &lt;Router&gt;<br/>      &lt;Switch&gt;<br/>        &lt;Route path="/" component={Search} /&gt;<br/>      &lt;/Switch&gt;<br/>    &lt;/Router&gt;<br/>  );<br/>};</span><span id="391b" class="my lu jd mt b gy nd na l nb nc">export { Navigator };</span></pre><p id="1e7b" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">完成上述更改后，文件夹结构应该如下所示</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/21756fbcde9479b8561ef355267b177c.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*GxfnTsTURWTXffrydRUg-Q.png"/></div></figure><h1 id="c97b" class="lt lu jd bd lv lw lx ly lz ma mb mc md kj me kk mf km mg kn mh kp mi kq mj mk bi translated">添加搜索状态</h1><p id="91d3" class="pw-post-body-paragraph ks kt jd ku b kv ml ke kx ky mm kh la lb mn ld le lf mo lh li lj mp ll lm ln ig bi translated">我们将使用Reddit的搜索API来查询和获取结果。格式如下所示</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="6071" class="my lu jd mt b gy mz na l nb nc">&lt;https://www.reddit.com/r/all/search.json?q=&gt;&lt;query&gt;&amp;limit=&lt;limit&gt;</span></pre><p id="ed63" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">你可以在Reddit的<a class="ae ja" href="https://www.reddit.com/dev/api/" rel="noopener ugc nofollow" target="_blank">官方文档</a>上找到更多细节</p><p id="5522" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们在<code class="fe mq mr ms mt b">.env</code>定义我们的API端点</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="dce0" class="my lu jd mt b gy mz na l nb nc">// /.env</span><span id="1c14" class="my lu jd mt b gy nd na l nb nc">REACT_APP_PRODUCTION_API_ENDPOINT = "&lt;https://www.reddit.com&gt;"<br/>REACT_APP_DEVELOPMENT_API_ENDPOINT = "&lt;https://www.reddit.com&gt;"</span></pre><p id="b18f" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在我们的例子中，两个端点将是相同的，因为我们没有单独的应用后端环境。</p><p id="ddba" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在定义我们的redux状态之前，我们首先需要知道我们的数据看起来如何，所以让我们首先通过在我们的<strong class="ku je"> Search </strong>容器中创建一个文件<code class="fe mq mr ms mt b">types.ts</code>来定义模型。</p><p id="fc85" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">一般来说，这些模型是在项目开始之前就决定的，而项目是在一段时间内逐步发展的。有时可能会发生这样的情况，我们事先没有一个模型，在这种情况下，开发人员可以根据用例自由地发挥他/她的想象力。但最好是有了起点之后再开始，这样有助于避免后期的大量变化。对于我们的用例，我们可以查询上面的搜索查询链接以获得响应，并使用类似于<a class="ae ja" href="http://json2ts.com/" rel="noopener ugc nofollow" target="_blank"> json2ts </a>的类型脚本生成器工具来获得我们的类型脚本模式。</p><p id="6628" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">注意:如果您使用的是JavaScript，您可以跳过这一部分，但是一定要看一下这个模型。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="32a8" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/types.ts<br/>export interface Result {<br/>  title: string;<br/>  thumbnail: string;<br/>  permalink: string;<br/>}</span><span id="7f7d" class="my lu jd mt b gy nd na l nb nc">export interface SearchResults {<br/>  after: string;<br/>  dist: number;<br/>  modhash: string;<br/>    children: {<br/>        kind: string;<br/>        data: Result;<br/>  };<br/>  before?: any;<br/>}</span><span id="2a72" class="my lu jd mt b gy nd na l nb nc">// reddit API response Model<br/>export interface Search {<br/>  kind: string;<br/>  data: SearchResults;<br/>}</span></pre><p id="3454" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们定义了一个名为<strong class="ku je"> Search </strong>的模型，它表示从Reddit搜索API发送的数据。为了简单起见，我们省略了应用程序中不使用的属性。<strong class="ku je">结果</strong>模型表示每个Reddit结果。</p><p id="5fc2" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们还将在<code class="fe mq mr ms mt b">types.ts</code>中添加一个<strong class="ku je"> SearchQuery </strong>接口，在这里我们将定义进行Reddit搜索所需的查询参数</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="f733" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/types.ts</span><span id="0249" class="my lu jd mt b gy nd na l nb nc">... // Search Result model</span><span id="3b7c" class="my lu jd mt b gy nd na l nb nc">export interface SearchQuery {<br/>  query: string;<br/>  limit: number;<br/>};</span></pre><p id="a924" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们为<code class="fe mq mr ms mt b">types.ts</code>中的<strong class="ku je">搜索</strong>容器定义redux状态和动作类型</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="e087" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/types.ts<br/>import { CustomError } from "../../utils/api-helper";</span><span id="643d" class="my lu jd mt b gy nd na l nb nc">... // Search Result interface </span><span id="3005" class="my lu jd mt b gy nd na l nb nc">... // Search Query interface</span><span id="b9f0" class="my lu jd mt b gy nd na l nb nc">// Search action types<br/>export enum SearchActionTypes {<br/>    GET_RESULTS_REQUEST = "@@search/GET_RESULTS_REQUEST",<br/>    GET_RESULTS_SUCCESS = "@@search/GET_RESULTS_SUCCESS",<br/>    GET_RESULTS_ERROR = "@@search/GET_RESULTS_ERROR",  <br/>}</span><span id="c2fe" class="my lu jd mt b gy nd na l nb nc">interface Errors {<br/>  results: CustomError | null<br/>}</span><span id="f986" class="my lu jd mt b gy nd na l nb nc">// Search redux state <br/>export interface SearchState {<br/>   isLoading: boolean,<br/>   results: Search | null,<br/>   errors: Errors<br/>}</span></pre><p id="7cf1" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">对于搜索API请求，在任何给定的时间点只能有3种状态，</p><ul class=""><li id="246e" class="nf ng jd ku b kv kw ky kz lb nh lf ni lj nj ln nk nl nm nn bi translated"><strong class="ku je">获取结果请求:</strong>获取结果时</li><li id="fe19" class="nf ng jd ku b kv no ky np lb nq lf nr lj ns ln nk nl nm nn bi translated"><strong class="ku je">获取结果成功:</strong>当我们收到成功的响应时</li><li id="a560" class="nf ng jd ku b kv no ky np lb nq lf nr lj ns ln nk nl nm nn bi translated"><strong class="ku je">获取结果错误:</strong>当我们收到错误响应时</li></ul><p id="698d" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">类似地，对于<strong class="ku je">搜索</strong>容器状态，我们定义了:</p><ul class=""><li id="207e" class="nf ng jd ku b kv kw ky kz lb nh lf ni lj nj ln nk nl nm nn bi translated"><strong class="ku je"> isLoading: </strong>布尔值，用于跟踪是否有任何API请求被发出</li><li id="d4af" class="nf ng jd ku b kv no ky np lb nq lf nr lj ns ln nk nl nm nn bi translated"><strong class="ku je">结果:</strong>搜索结果将存储在哪里。</li><li id="9cfd" class="nf ng jd ku b kv no ky np lb nq lf nr lj ns ln nk nl nm nn bi translated"><strong class="ku je">错误:</strong>每个属性最多跟踪1个错误响应(这里我们跟踪的是<code class="fe mq mr ms mt b">results</code>)。</li></ul><p id="83a1" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果你已经注意到我们使用了一个带有<code class="fe mq mr ms mt b">null</code>类型的管道(|)操作符，这意味着在任何给定点，它的值将是类型<strong class="ku je"> T </strong>或<strong class="ku je"> null </strong>。我们也可以使用<code class="fe mq mr ms mt b">undefined</code>,但是这样我们将需要总是声明那个属性，并分配一个空值，这反过来使我们的代码更可读。</p><p id="6380" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们将<strong class="ku je"> SearchState </strong>添加到<code class="fe mq mr ms mt b">src/store.ts</code>中定义的<strong class="ku je"> ApplicationState </strong>中，并将其命名为<code class="fe mq mr ms mt b">search</code></p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="5645" class="my lu jd mt b gy mz na l nb nc">// src/store.ts<br/>... // imports<br/><strong class="mt je">import { SearchState } from './containers/Search/reducer';</strong></span><span id="17e1" class="my lu jd mt b gy nd na l nb nc">export type ApplicationState = {<br/>  <strong class="mt je">search: SearchState</strong><br/>};</span><span id="b174" class="my lu jd mt b gy nd na l nb nc">function configureAppStore(initialState: ApplicationState) {<br/>  ... // store configuration <br/>}</span><span id="8fa1" class="my lu jd mt b gy nd na l nb nc">export { configureAppStore };</span></pre><p id="ab29" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们在redux中定义搜索状态的动作。为此，我们将使用redux-toolkit的<code class="fe mq mr ms mt b">createAction</code>和<code class="fe mq mr ms mt b">createReducer</code>助手函数分别用于动作和reducer。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="90a3" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/action.ts<br/>import { createAction } from "@reduxjs/toolkit";<br/>import { CustomError } from "../../utils/api-helper";<br/>import { Search, SearchActionTypes, SearchQuery } from "./types";</span><span id="db73" class="my lu jd mt b gy nd na l nb nc">export const getResultsRequest = createAction&lt;SearchQuery&gt;(<br/>  SearchActionTypes.GET_RESULTS_REQUEST<br/>);</span><span id="b2cf" class="my lu jd mt b gy nd na l nb nc">export const getResultsSuccess = createAction&lt;Search&gt;(<br/>  SearchActionTypes.GET_RESULTS_SUCCESS<br/>);</span><span id="899f" class="my lu jd mt b gy nd na l nb nc">export const getResultsError = createAction&lt;CustomError&gt;(<br/>  SearchActionTypes.GET_RESULTS_ERROR<br/>);</span></pre><p id="1d07" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里我们定义了3种动作类型。因为我们使用了TypeScript，所以我们也为<code class="fe mq mr ms mt b">getResultsRequest</code> <code class="fe mq mr ms mt b">getResultsSuccess</code>和<code class="fe mq mr ms mt b">getResultsError</code>定义了有效负载类型。有效负载类型将有助于连接流并避免错误。</p><p id="c28c" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">是时候为<strong class="ku je">搜索</strong>状态设置reducer了，它将监听调度的动作，如果动作类型匹配，redux状态将被更新。为了创建缩减器，我们将使用redux-toolkit中的<code class="fe mq mr ms mt b">createReducer</code> helper实用程序，使用TypeScript推荐的构建器回调符号。欲了解更多信息，请随时查看<a class="ae ja" href="https://redux-toolkit.js.org/api/createReducer" rel="noopener ugc nofollow" target="_blank"> redux-toolkit文档。</a></p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="d745" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/reducer.ts<br/>import { createReducer } from "@reduxjs/toolkit";<br/>import {<br/>  getResultsError,<br/>  getResultsRequest,<br/>  getResultsSuccess,<br/>} from "./action";<br/>import { SearchState } from "./types";</span><span id="6cf2" class="my lu jd mt b gy nd na l nb nc">const initalState: SearchState = {<br/>  isLoading: false,<br/>  results: null,<br/>  errors: {<br/>    results: null,<br/>  },<br/>};</span><span id="9c40" class="my lu jd mt b gy nd na l nb nc">const reducer = createReducer(initalState, (builder) =&gt; {<br/>  return builder<br/>    .addCase(getResultsRequest, (state, action) =&gt; {<br/>      state.isLoading = true;<br/>      state.results = null;<br/>      state.errors.results = null;<br/>    })<br/>    .addCase(getResultsSuccess, (state, action) =&gt; {<br/>      state.isLoading = false;<br/>      state.results = action.payload;<br/>    })<br/>    .addCase(getResultsError, (state, action) =&gt; {<br/>      state.isLoading = false;<br/>      state.errors.results = action.payload;<br/>    });<br/>});</span><span id="b73d" class="my lu jd mt b gy nd na l nb nc">export { initalState as searchInitialState, reducer as searchReducer };</span></pre><p id="ff47" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里我们创建了一个reducer，它将监听先前创建的<strong class="ku je"> SearchActionTypes </strong>，并相应地更新状态。现在为了保持这个例子简单，我们不考虑分页和其他预先列表操作。我们将假设搜索结果将只被提取一次，我们将为最近的请求保留数据，因此，当一个新的<code class="fe mq mr ms mt b">getResultsRequest</code>产生时，我们正在重置状态。我们还导出了初始状态(<strong class="ku je">searchininitialstate</strong>)，这也将表示应用程序引导时的搜索状态。</p><p id="bda4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">注意:你也可以使用redux-toolkit提供的<code class="fe mq mr ms mt b">createSlice</code>方法，它将为你创建两个动作和一个reducer。动作类型可以内联提供。更多信息，可以参考<a class="ae ja" href="https://redux-toolkit.js.org/api/createSlice" rel="noopener ugc nofollow" target="_blank"> redux-toolkit文档</a>。</p><p id="d9f1" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们将初始搜索状态添加到<code class="fe mq mr ms mt b">src/App.tsx</code>中的初始应用状态</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="8c9b" class="my lu jd mt b gy mz na l nb nc">// src/App.tsx<br/>import React from 'react';<br/>import { Provider } from 'react-redux';<br/>import { ApplicationState, configureAppStore } from './store';<br/>import { Navigator } from "./navigator/Navigator";<br/><strong class="mt je">import { searchInitialState } from './containers/Search/reducer';</strong></span><span id="c438" class="my lu jd mt b gy nd na l nb nc">const initialState: ApplicationState = {<br/>  <strong class="mt je">search: searchInitialState</strong><br/>};</span><span id="2bac" class="my lu jd mt b gy nd na l nb nc">const store = configureAppStore(initialState);</span><span id="1f33" class="my lu jd mt b gy nd na l nb nc">function App() {<br/>  return (<br/>    &lt;Provider store={store}&gt;<br/>      &lt;Navigator /&gt;<br/>    &lt;/Provider&gt;<br/>  );<br/>}</span><span id="6bc1" class="my lu jd mt b gy nd na l nb nc">export default App;</span></pre><p id="47c2" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们还需要通过将搜索归约器添加到<code class="fe mq mr ms mt b">src/reducer.ts</code>来将它添加到根归约器中</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="b578" class="my lu jd mt b gy mz na l nb nc">// src/reducer.ts<br/>import { combineReducers } from "@reduxjs/toolkit";<br/><strong class="mt je">import { searchReducer } from './containers/Search/reducer';</strong></span><span id="824e" class="my lu jd mt b gy nd na l nb nc">const reducers = {<br/>  <strong class="mt je">search: searchReducer</strong><br/>};</span><span id="9ac6" class="my lu jd mt b gy nd na l nb nc">function createRootReducer() {<br/>    const rootReducer = combineReducers({<br/>      ...reducers<br/>    });<br/>  <br/>    return rootReducer;<br/>};<br/>  <br/>export { createRootReducer };</span></pre><p id="dc45" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，当您运行应用程序时，您应该能够在Redux状态中看到一个可用的<code class="fe mq mr ms mt b">search</code>状态。</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nt"><img src="../Images/788e750987a0f9c488ee8925f2effed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sFX3JoQnJT4PC9RdptsdfA.png"/></div></div></figure><p id="c942" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">文件夹结构将如下所示:</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/c11b14c688bfe0f5c7b0107c6522511c.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*Vc3f1YH4BDGYgQYvUyZ6yw.png"/></div></figure><p id="8e0f" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们已经完成了redux设置，是时候为<strong class="ku je">搜索</strong>容器设置saga中间件了。让我们首先在<strong class="ku je">搜索</strong>容器中创建一个文件<code class="fe mq mr ms mt b">saga.ts</code>，并定义一个<code class="fe mq mr ms mt b">getSearchResults</code>函数来监听<code class="fe mq mr ms mt b">GET_SEARCH_RESULTS</code>动作类型。为了理解redux-saga如何工作，你可以查看他们的官方文件。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="20fe" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/saga.ts</span><span id="ebfb" class="my lu jd mt b gy nd na l nb nc">import { all, fork, takeLatest } from "redux-saga/effects";<br/>import { getResultsRequest } from "./action";</span><span id="9dae" class="my lu jd mt b gy nd na l nb nc">function* getSearchResults() {<br/>    // get search results API request<br/>}</span><span id="048d" class="my lu jd mt b gy nd na l nb nc">function* watchFetchRequest() {<br/>  yield takeLatest(getResultsRequest.type, getSearchResults);<br/>}</span><span id="f765" class="my lu jd mt b gy nd na l nb nc">export default function* searchSaga() {<br/>  yield all([fork(watchFetchRequest)]);<br/>}</span></pre><p id="e9bc" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们已经定义了一个<strong class="ku je"> searchSaga </strong>，我们将在<code class="fe mq mr ms mt b">store.ts</code>中导入它，这样它就被注册了。<code class="fe mq mr ms mt b">getSearchResults</code>将包含负责发出API请求的代码，并根据响应分派成功或错误操作。</p><p id="a7ac" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在此之前，我们需要首先在<code class="fe mq mr ms mt b">src/services/Api.ts</code>中创建一个用于发出API请求的函数。如上所述，要从Reddit获得搜索结果，我们可以使用下面的端点，我们将从组件传递<code class="fe mq mr ms mt b">query</code> &amp; <code class="fe mq mr ms mt b">limit</code>。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="24c4" class="my lu jd mt b gy mz na l nb nc">&lt;https://www.reddit.com/r/all/search.json?q=&gt;&lt;query&gt;&amp;limit=&lt;limit&gt;</span></pre><p id="c7be" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们已经在环境配置中添加了基本URL(<a class="ae ja" href="https://www.reddit.com" rel="noopener ugc nofollow" target="_blank">https://www.reddit.com</a>)作为<code class="fe mq mr ms mt b">API_ENDPOINT</code>。</p><p id="3c37" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们定义一个函数<strong class="ku je"> fetchSearchResults </strong>，我们将使用<code class="fe mq mr ms mt b">src/utils/api-helper.ts</code>中的<code class="fe mq mr ms mt b">get</code>辅助函数。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="6d79" class="my lu jd mt b gy mz na l nb nc">// src/services/Api.ts<br/>import config from "../config/app";<br/>import * as API from "../utils/api-helper";<br/>import { SearchQuery } from "../containers/Search/types";</span><span id="9587" class="my lu jd mt b gy nd na l nb nc">const { isProd } = config;</span><span id="9c94" class="my lu jd mt b gy nd na l nb nc">const API_ENDPOINT = isProd <br/>	? config.production <br/>	: config.development;</span><span id="8793" class="my lu jd mt b gy nd na l nb nc">export const fetchSearchResults = (params: SearchQuery) =&gt; {<br/>  const { query, limit } = params;<br/>  const url = `${API_ENDPOINT}/r/all/search.json?q=${query}&amp;limit=${limit}`;</span><span id="0c26" class="my lu jd mt b gy nd na l nb nc">  return API.get(url);<br/>};</span></pre><p id="8bb6" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们可以使用<strong class="ku je"> fetchSearchResults </strong>，让我们完成我们的搜索传奇，并进行get search API调用。</p><p id="bab9" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">将动作指定为一个传奇的参数有点棘手，我们必须使用TypeScript的<a class="ae ja" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#user-defined-type-guards" rel="noopener ugc nofollow" target="_blank">类型保护。有趣的是，redux-toolkit的</a><a class="ae ja" href="https://redux-toolkit.js.org/api/createAction#actioncreatormatch" rel="noopener ugc nofollow" target="_blank">文档</a>中也提到了这一点。简而言之，我们必须使用actionCreator的actionCreator.match方法将传递的动作区分为所需的类型。因此，在区分之后，我们接收到匹配动作有效负载的期望静态类型。</p><p id="6795" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">玩了一圈回应，最后有了下面这个<code class="fe mq mr ms mt b">saga.ts</code>。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="bcd0" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/saga.ts<br/>import { Action } from '@reduxjs/toolkit';<br/>import { all, call, fork, put, takeLatest } from "redux-saga/effects";<br/>import { getResultsError, getResultsRequest, getResultsSuccess } from "./action";<br/>import * as Api from "../../services/Api";<br/>import { getCustomError } from '../../utils/api-helper';</span><span id="1ef1" class="my lu jd mt b gy nd na l nb nc">function* getSearchResults(action: Action) {<br/>  try {<br/>    if (getResultsRequest.match(action)) {<br/>      const res = yield call(Api.fetchSearchResults,action.payload);<br/>      const data = res.data;<br/>      if (res.status !== 200) {<br/>        yield put(getResultsError(data.error));<br/>      } else {<br/>        yield put(getResultsSuccess(data));<br/>      }<br/>    }<br/>  } catch (err) {<br/>    yield put(getResultsError(getCustomError(err)))<br/>  }<br/>}</span><span id="6d46" class="my lu jd mt b gy nd na l nb nc">function* watchFetchRequest() {<br/>  yield takeLatest(getResultsRequest.type, getSearchResults);<br/>}</span><span id="d202" class="my lu jd mt b gy nd na l nb nc">export default function* searchSaga() {<br/>  yield all([fork(watchFetchRequest)]);<br/>}</span></pre><p id="4b8e" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">要注册<strong class="ku je"> searchSaga </strong>，只需在<code class="fe mq mr ms mt b">src/saga.ts</code>的root saga中导入即可。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="91fc" class="my lu jd mt b gy mz na l nb nc">// src/saga.ts<br/>import { all, fork } from "redux-saga/effects";<br/>import searchSaga from "./containers/Search/saga";</span><span id="24d3" class="my lu jd mt b gy nd na l nb nc">function* rootSaga() {<br/>    yield all([<br/>        fork(searchSaga)<br/>    ]);<br/>};<br/>  <br/>export { rootSaga };</span></pre><p id="98df" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这就完成了应用程序的数据设置。现在我们可以从UI实现开始。文件夹结构将如下所示</p><figure class="lp lq lr ls gt ip gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/47e360f45b980c249f0411772ae87644.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*QCttbE9dB2iXd-QX6e5Wfg.png"/></div></figure><p id="c38b" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们可以将用户界面分为两个部分</p><ul class=""><li id="f7ba" class="nf ng jd ku b kv kw ky kz lb nh lf ni lj nj ln nk nl nm nn bi translated"><strong class="ku je"> SearchInput </strong>:它将有一个输入字段，将接受来自用户的搜索查询</li><li id="2ff2" class="nf ng jd ku b kv no ky np lb nq lf nr lj ns ln nk nl nm nn bi translated"><strong class="ku je">结果:</strong>基本上这里我们会显示查询的结果</li></ul><p id="ec26" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们在<code class="fe mq mr ms mt b">src/containers/Search/views</code>处创建一个名为<code class="fe mq mr ms mt b">views</code>的文件夹，上面列出的组件将放在这里。容器内的<code class="fe mq mr ms mt b">view</code>文件夹(有时命名为<code class="fe mq mr ms mt b">screens</code>)将包含特定于该容器或访问全局状态(在我们的例子中为redux状态)的组件。</p><p id="92ad" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了简单起见，由于制作输入和加载器等组件超出了本文的范围，我将使用一个组件库<a class="ae ja" href="http://ant.design" rel="noopener ugc nofollow" target="_blank"> ant design </a>。但是如果你想知道，可能在多个地方使用的组件将会被放在<code class="fe mq mr ms mt b">src/components</code>文件夹中。</p><p id="ac18" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">尽管如果你使用钩子，决定一个组件应该放在哪里可能有点困难。在这种情况下，作为一个经验法则，如果一个组件正在访问全局状态，即从redux存储使用<code class="fe mq mr ms mt b">useSelector</code>钩子，那么它应该被列在<code class="fe mq mr ms mt b">src/containers/{feature}/views</code>文件夹下。</p><p id="bfab" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们将ant设计组件添加到项目中</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="1968" class="my lu jd mt b gy mz na l nb nc">yarn add antd @ant-design/icons</span></pre><p id="bd46" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">一旦流程完成，我们需要将ant design的CSS添加到<code class="fe mq mr ms mt b">/src/index.css</code>中。让我们使用黑暗主题，因为谁不喜欢黑暗主题呢？</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="a485" class="my lu jd mt b gy mz na l nb nc">// src/index.css<br/>@import '~antd/dist/antd.dark.css';</span><span id="8b42" class="my lu jd mt b gy nd na l nb nc">body {<br/>  margin: 0;<br/>  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',<br/>    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',<br/>    sans-serif;<br/>  -webkit-font-smoothing: antialiased;<br/>  -moz-osx-font-smoothing: grayscale;<br/>}</span><span id="26da" class="my lu jd mt b gy nd na l nb nc">code {<br/>  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',<br/>    monospace;<br/>}</span></pre><p id="5357" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们在<code class="fe mq mr ms mt b">src/containers/Search/views</code>中创建一个<strong class="ku je"> SearchInput </strong>组件，用户可以在其中搜索主题</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="d3fb" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/views/SearchInput.tsx<br/>import React, { FC, useEffect, useState } from "react";<br/>import { Avatar, Input } from "antd";<br/>import logo from "../../../assets/logo.svg";<br/>import "../styles.css";<br/>import { useDispatch, useSelector } from "react-redux";<br/>import { ApplicationState } from "../../../store";<br/>import { getResultsRequest } from "../action";</span><span id="3cf4" class="my lu jd mt b gy nd na l nb nc">type Props = {};</span><span id="ee78" class="my lu jd mt b gy nd na l nb nc">const { Search } = Input;<br/>const SearchInput: FC&lt;Props&gt; = (props: Props) =&gt; {<br/>  const dispatch = useDispatch();<br/>  const [searchQuery, setSearchQuery] = useState("");<br/>  const [searchQueryLimit, setSearchQueryLimit] = useState(0);</span><span id="81b7" class="my lu jd mt b gy nd na l nb nc">  const isLoading = useSelector&lt;ApplicationState, boolean&gt;(<br/>    (s) =&gt; s.search.isLoading<br/>  );</span><span id="a54d" class="my lu jd mt b gy nd na l nb nc">  const onSearchQueryChangeHandler = (<br/>    e: React.ChangeEvent&lt;HTMLInputElement&gt;<br/>  ) =&gt; {<br/>    const val = e.target.value;<br/>    setSearchQuery(val);<br/>  };</span><span id="6b70" class="my lu jd mt b gy nd na l nb nc">  const onSearchHandler = () =&gt; {<br/>    dispatch(getResultsRequest({<br/>      query: searchQuery,<br/>      limit: searchQueryLimit<br/>    }))<br/>  }</span><span id="8b4a" class="my lu jd mt b gy nd na l nb nc">  useEffect(() =&gt; {<br/>    setSearchQueryLimit(25);<br/>  }, [])</span><span id="b20d" class="my lu jd mt b gy nd na l nb nc">  return (<br/>    &lt;div className="search-input-container"&gt;<br/>      &lt;Avatar src={logo} shape="circle" size={150} /&gt;<br/>      &lt;Search<br/>        className="search-input"<br/>        placeholder="Search for a topic"<br/>        loading={isLoading}<br/>        value={searchQuery}<br/>        onChange={onSearchQueryChangeHandler}<br/>        onSearch={onSearchHandler}<br/>      /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="cce8" class="my lu jd mt b gy nd na l nb nc">export { SearchInput };</span></pre><p id="c1ec" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们从顶部开始，我们已经创建了一个功能组件<strong class="ku je"> SearchInput。</strong>我们使用useSelector和useDispatch钩子来访问redux状态并调度redux动作。我们还使用useState钩子来管理本地搜索查询和搜索查询限制，并使用useEffect在函数组件中执行副作用。</p><p id="b6c2" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">从蚂蚁设计组件库中，我们导入了<strong class="ku je">头像</strong>和<strong class="ku je">输入。搜索</strong>组件。我们还在<code class="fe mq mr ms mt b">src/containers/Search/styles.css</code>中定义了一些样式，还在<code class="fe mq mr ms mt b">src/assets</code>中添加了<a class="ae ja" href="https://raw.githubusercontent.com/anishkargaonkar/react-reddit-client/master/src/assets/logo.svg" rel="noopener ugc nofollow" target="_blank"> Reddit logo SVG </a>。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="728d" class="my lu jd mt b gy mz na l nb nc">/* src/containers/Search/styles.css */<br/>.container {<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>    height: 100vh;<br/>}</span><span id="45d3" class="my lu jd mt b gy nd na l nb nc">.search-input-container {<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>    flex-direction: column;<br/>}</span><span id="9266" class="my lu jd mt b gy nd na l nb nc">.search-input {<br/>    margin: 2rem 0;<br/>    border-radius: 5px;<br/>}</span></pre><p id="f775" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在在<strong class="ku je">搜索</strong>中导入<strong class="ku je">搜索输入</strong>组件</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="70c9" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/Search.tsx</span><span id="f67c" class="my lu jd mt b gy nd na l nb nc">import React, { FC } from "react";<br/>import "./styles.css";<br/>import { SearchInput } from "./views/SearchInput";</span><span id="a78b" class="my lu jd mt b gy nd na l nb nc">type Props = {};</span><span id="bdad" class="my lu jd mt b gy nd na l nb nc">const Search: FC&lt;Props&gt; = (props: Props) =&gt; {<br/>  return (<br/>    &lt;div className="container"&gt;<br/>      &lt;SearchInput /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="25b8" class="my lu jd mt b gy nd na l nb nc">export { Search };</span></pre><p id="da2b" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在点击保存，让它编译，然后导航到<code class="fe mq mr ms mt b"><a class="ae ja" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>你应该能看到这样的东西</p><p id="b0c7" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">到目前为止的文件夹结构</p><p id="82e4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们处理<strong class="ku je">结果</strong>组件，它将显示查询的结果。我们将把这个组件添加到<strong class="ku je">搜索</strong>容器的<code class="fe mq mr ms mt b">views</code>文件夹中。</p><p id="06da" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们创建一个名为<strong class="ku je"> ResultListItem </strong>的定制组件来显示每个结果。此外，让我们添加一个操作类型来重置结果，我们可以用它来返回到开始屏幕。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="2cae" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/types.ts</span><span id="5dcd" class="my lu jd mt b gy nd na l nb nc">// ... SearchResults model</span><span id="5a16" class="my lu jd mt b gy nd na l nb nc">export interface Search {<br/>  kind: string;<br/>  data: SearchResults;<br/>}</span><span id="588f" class="my lu jd mt b gy nd na l nb nc">export interface SearchQuery {<br/>  query: string;<br/>  limit: number;<br/>};</span><span id="a11d" class="my lu jd mt b gy nd na l nb nc">interface Errors {<br/>  results: CustomError | null<br/>}</span><span id="9211" class="my lu jd mt b gy nd na l nb nc">export enum SearchActionTypes {<br/>  GET_RESULTS_REQUEST = "@@search/GET_RESULTS_REQUEST",<br/>  GET_RESULTS_SUCCESS = "@@search/GET_RESULTS_SUCCESS",<br/>  GET_RESULTS_ERROR = "@@search/GET_RESULTS_ERROR",</span><span id="7b61" class="my lu jd mt b gy nd na l nb nc">  **RESET_RESULTS = '@@search/RESET_RESULTS'**<br/>}</span><span id="f93b" class="my lu jd mt b gy nd na l nb nc">export interface SearchState {<br/>  isLoading: boolean,<br/>  results: Search | null,<br/>  errors: Errors<br/>}</span></pre><p id="9901" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里，我们向<code class="fe mq mr ms mt b">src/containers/Search/types.ts</code>添加了一个<code class="fe mq mr ms mt b">RESET_RESULTS</code>动作类型，它将用于在<strong class="ku je">搜索状态</strong>中将<code class="fe mq mr ms mt b">results</code>状态重置为<code class="fe mq mr ms mt b">null</code>。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="38b4" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/action.ts</span><span id="74b7" class="my lu jd mt b gy nd na l nb nc">import { createAction } from "@reduxjs/toolkit";<br/>import { CustomError } from "../../utils/api-helper";<br/>import { Search, SearchActionTypes, SearchQuery } from "./types";</span><span id="f863" class="my lu jd mt b gy nd na l nb nc">export const getResultsRequest = createAction&lt;SearchQuery&gt;(<br/>  SearchActionTypes.GET_RESULTS_REQUEST<br/>);</span><span id="9826" class="my lu jd mt b gy nd na l nb nc">export const getResultsSuccess = createAction&lt;Search&gt;(<br/>  SearchActionTypes.GET_RESULTS_SUCCESS<br/>);</span><span id="d81e" class="my lu jd mt b gy nd na l nb nc">export const getResultsError = createAction&lt;CustomError&gt;(<br/>  SearchActionTypes.GET_RESULTS_ERROR<br/>);</span><span id="f95a" class="my lu jd mt b gy nd na l nb nc">**export const resetResults = createAction(<br/>  SearchActionTypes.RESET_RESULTS<br/>);**</span></pre><p id="21b7" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里我们添加了一个新的动作类型<strong class="ku je"> resetResults </strong>，注意我们没有像对其他动作那样定义返回类型？因为在<code class="fe mq mr ms mt b">resetResultst</code>中没有返回值，所以没有必要定义动作类型。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="f5f4" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/reducer.ts</span><span id="9291" class="my lu jd mt b gy nd na l nb nc">import { createReducer } from "@reduxjs/toolkit";<br/>import {<br/>  getResultsError,<br/>  getResultsRequest,<br/>  getResultsSuccess,<br/>  resetResults,<br/>} from "./action";<br/>import { SearchState } from "./types";</span><span id="2d4b" class="my lu jd mt b gy nd na l nb nc">const initalState: SearchState = {<br/>  isLoading: false,<br/>  results: null,<br/>  errors: {<br/>    results: null,<br/>  },<br/>};</span><span id="d54d" class="my lu jd mt b gy nd na l nb nc">const reducer = createReducer(initalState, (builder) =&gt; {<br/>  return builder<br/>    .addCase(getResultsRequest, (state, action) =&gt; {<br/>      state.isLoading = true;<br/>      state.results = null;<br/>      state.errors.results = null;<br/>    })<br/>    .addCase(getResultsSuccess, (state, action) =&gt; {<br/>      state.isLoading = false;<br/>      state.results = action.payload;<br/>    })<br/>    .addCase(getResultsError, (state, action) =&gt; {<br/>      state.isLoading = false;<br/>      state.errors.results = action.payload;<br/>    })<br/>    **.addCase(resetResults, (state, action) =&gt; {<br/>      state.results = null;<br/>    });**<br/>});</span><span id="803d" class="my lu jd mt b gy nd na l nb nc">export { initalState as searchInitialState, reducer as searchReducer };</span></pre><p id="308a" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在减速器中增加一个<code class="fe mq mr ms mt b">resetResults</code>箱，并将<code class="fe mq mr ms mt b">results</code>设置为<code class="fe mq mr ms mt b">null</code>，即初始状态。</p><p id="f491" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们创建一个<strong class="ku je">结果</strong>组件来显示搜索结果。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="de3e" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/views/Results.tsx<br/>import React, { FC } from "react";<br/>import { useDispatch, useSelector } from "react-redux";<br/>import { ApplicationState } from "../../../store";<br/>import { Search } from "../types";<br/>import { ResultListItem } from "../../../components/ResultListItem/ResultListItem";<br/>import logo from "../../../assets/logo.svg";<br/>import { ArrowLeftOutlined } from "@ant-design/icons";<br/>import { Button } from "antd";<br/>import { resetResults } from "../action";<br/>import "../styles.css";</span><span id="6fea" class="my lu jd mt b gy nd na l nb nc">type Props = {};</span><span id="6eab" class="my lu jd mt b gy nd na l nb nc">const Results: FC&lt;Props&gt; = (props: Props) =&gt; {<br/>  const dispatch = useDispatch();<br/>  const results = useSelector&lt;ApplicationState, Search | null&gt;(<br/>    (s) =&gt; s.search.results<br/>  );</span><span id="982f" class="my lu jd mt b gy nd na l nb nc">  const onResetResultsHandler = () =&gt; {<br/>    dispatch(resetResults());<br/>  };</span><span id="7723" class="my lu jd mt b gy nd na l nb nc">  return (<br/>    &lt;div&gt;<br/>      &lt;div className="result-header"&gt;<br/>        &lt;Button<br/>          icon={&lt;ArrowLeftOutlined /&gt;}<br/>          shape="circle-outline"<br/>          onClick={() =&gt; onResetResultsHandler()}<br/>        /&gt;<br/>        &lt;div&gt;Search Results&lt;/div&gt;<br/>        &lt;div /&gt;<br/>      &lt;/div&gt;<br/>      {!results || results.data.children.length === 0 ? (<br/>        &lt;div className="no-results-container"&gt;No results found&lt;/div&gt;<br/>      ) : (<br/>        &lt;div className="results-container"&gt;<br/>          {results.data.children.map((result, index) =&gt; (<br/>            &lt;ResultListItem<br/>              key={index}<br/>              title={result.data.title}<br/>              imageURL={result.data.thumbnail === "self" ? logo : result.data.thumbnail}<br/>              sourceURL={result.data.permalink}<br/>            /&gt;<br/>          ))}<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="ee02" class="my lu jd mt b gy nd na l nb nc">export { Results };</span><span id="74f7" class="my lu jd mt b gy nd na l nb nc">/* src/containers/Search/styles.css */<br/>.container {<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>    height: 100vh;<br/>}</span><span id="096c" class="my lu jd mt b gy nd na l nb nc">.search-input-container {<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>    flex-direction: column;<br/>}</span><span id="50f3" class="my lu jd mt b gy nd na l nb nc">.search-input {<br/>    margin: 2rem 0;<br/>    border-radius: 5px;<br/>}</span><span id="5342" class="my lu jd mt b gy nd na l nb nc">.result-header {<br/>   font-size: 1.5rem;<br/>   display: flex;<br/>   justify-content: space-between;<br/>   align-items: center;<br/>   padding: 0.5rem;<br/>}</span><span id="acaf" class="my lu jd mt b gy nd na l nb nc">.result-header &gt; i {<br/>    cursor: pointer;<br/>}</span><span id="08bd" class="my lu jd mt b gy nd na l nb nc">.results-container {<br/>    max-width: 100vh;<br/>    max-height: 80vh;<br/>    overflow-y: scroll;<br/>}</span><span id="b1bc" class="my lu jd mt b gy nd na l nb nc">.no-results-container {<br/>    width: 100vh;<br/>    height: 80vh;<br/>    overflow: hidden;<br/>    display: flex;<br/>    justify-content: center;<br/>    align-items: center;<br/>}</span></pre><p id="2b16" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">上面我们定义了一个名为<strong class="ku je">结果</strong>的功能组件，样式在<code class="fe mq mr ms mt b">src/containers/Search/styles.css</code>中定义。我们使用钩子来获取和重置redux状态<code class="fe mq mr ms mt b">results</code>。</p><p id="7848" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们定义<strong class="ku je"> ResultListItem </strong>组件及其在<code class="fe mq mr ms mt b">src/components/ResultListItem</code>中的样式。这里遵循的模式类似于容器的模式。对于一个可以在多个地方使用的组件，我们将其定义在一个名为<strong class="ku je">组件</strong>的文件夹中，并创建一个包含组件逻辑和样式的组件名文件夹。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="29a1" class="my lu jd mt b gy mz na l nb nc">// src/components/ResultListItem/ResultListItem.tsx</span><span id="3214" class="my lu jd mt b gy nd na l nb nc">import React, { FC } from "react";<br/>import "./styles.css";<br/>import logo from "../../assets/logo.svg";</span><span id="987b" class="my lu jd mt b gy nd na l nb nc">type Props = {<br/>  title: string;<br/>  imageURL: string;<br/>  sourceURL: string;<br/>};</span><span id="de38" class="my lu jd mt b gy nd na l nb nc">const ResultListItem: FC&lt;Props&gt; = (props: Props) =&gt; {<br/>  const { title, imageURL, sourceURL } = props;</span><span id="f6be" class="my lu jd mt b gy nd na l nb nc">  const onClickHandler = (url: string) =&gt; {<br/>    window.open(`https://reddit.com/${url}`);<br/>  };</span><span id="5731" class="my lu jd mt b gy nd na l nb nc">  return (<br/>      &lt;div className="item-container" onClick={() =&gt; onClickHandler(sourceURL)}&gt;<br/>          &lt;img className="thumbnail" alt="" src={imageURL} onError={() =&gt; logo} /&gt;<br/>          &lt;div&gt;<br/>              &lt;div className="title"&gt;{title}&lt;/div&gt;<br/>          &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="dce6" class="my lu jd mt b gy nd na l nb nc">export { ResultListItem };</span><span id="9f3a" class="my lu jd mt b gy nd na l nb nc">/* src/components/ResultListItem/styles.css */<br/>.item-container {<br/>    display: flex;<br/>    align-items: center;<br/>    padding: 0.5rem;<br/>    width: 100%;<br/>    height: 6rem;<br/>    border: 1px solid rgb(77, 77, 77);<br/>    margin-bottom: 0.5rem;<br/>    border-radius: 4px;<br/>    cursor: pointer;<br/>}</span><span id="4630" class="my lu jd mt b gy nd na l nb nc">.thumbnail {<br/>    width: 5rem;<br/>    border-radius: 0.2rem;<br/>}</span><span id="0061" class="my lu jd mt b gy nd na l nb nc">.title {<br/>    font-weight: bold;<br/>    padding: 1rem;<br/>}</span></pre><p id="4ffe" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">并对<strong class="ku je">搜索</strong>容器进行以下更改，以显示<strong class="ku je">结果</strong>组件(如果存在搜索结果),否则显示<strong class="ku je">搜索输入</strong>组件。</p><pre class="lp lq lr ls gt mu mt mv mw aw mx bi"><span id="2bb4" class="my lu jd mt b gy mz na l nb nc">// src/containers/Search/Search.tsx<br/>import { message } from "antd";<br/>import React, { FC, useEffect } from "react";<br/>import { useSelector } from "react-redux";<br/>import { ApplicationState } from "../../store";<br/>import { CustomError } from "../../utils/api-helper";<br/>import "./styles.css";<br/>import { Search as SearchModel } from "./types";<br/>import { Results } from "./views/Results";<br/>import { SearchInput } from "./views/SearchInput";</span><span id="9e99" class="my lu jd mt b gy nd na l nb nc">type Props = {};</span><span id="f89b" class="my lu jd mt b gy nd na l nb nc">const Search: FC&lt;Props&gt; = (props: Props) =&gt; {<br/>  const results = useSelector&lt;ApplicationState, SearchModel | null&gt;(<br/>    (s) =&gt; s.search.results<br/>  );<br/>  const searchError = useSelector&lt;ApplicationState, CustomError | null&gt;(<br/>    (s) =&gt; s.search.errors.results<br/>  );</span><span id="f96d" class="my lu jd mt b gy nd na l nb nc">  useEffect(() =&gt; {<br/>    if (searchError) {<br/>      message.error(searchError.message);<br/>    }<br/>  }, [searchError]);</span><span id="73e4" class="my lu jd mt b gy nd na l nb nc">  return (<br/>    &lt;div className="container"&gt;{!results ? &lt;SearchInput /&gt; : &lt;Results /&gt;}&lt;/div&gt;<br/>  );<br/>};</span><span id="fea1" class="my lu jd mt b gy nd na l nb nc">export { Search };</span></pre><p id="ab86" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">最后，你的项目结构应该看起来像上面所有的变化</p><p id="b15b" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">一旦保存了以上所有的更改，项目应该可以编译了，您应该能够搜索一个主题并看到如下所示的结果</p><p id="ba77" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">您可以参考下面的存储库获得最终代码。</p><div class="im in gp gr io nw"><a href="https://github.com/anishkargaonkar/react-reddit-client" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd je gy z fp ob fr fs oc fu fw jc bi translated">anishkargaonkar/react-Reddit-client</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">这个项目是构建react项目规模的一个例子。主办地:https://reddit-client-88d34d.netlify.app/…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok iu nw"/></div></div></a></div><h1 id="dbce" class="lt lu jd bd lv lw lx ly lz ma mb mc md kj me kk mf km mg kn mh kp mi kq mj mk bi translated">结束语</h1><p id="721e" class="pw-post-body-paragraph ks kt jd ku b kv ml ke kx ky mm kh la lb mn ld le lf mo lh li lj mp ll lm ln ig bi translated">在这个由两部分组成的系列文章中，我试图定义一种适合我的结构，在这种结构中，调试bug、添加不断变化范围的新特性在React和React-Native中都是容易和可管理的。尽管没有适用于所有人的完美结构，但这可以是一个很好的起点。</p><p id="6721" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我希望你喜欢读这篇文章，就像我喜欢写它一样。很想听听你的想法。再见！</p></div><div class="ab cl ol om hr on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ig ih ii ij ik"><p id="36df" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="os">更多内容请看</em><a class="ae ja" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku je"><em class="os">plain English . io</em></strong></a><em class="os">。报名参加我们的</em> <a class="ae ja" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku je"> <em class="os">免费周报</em> </strong> </a> <em class="os">。关注我们关于</em><a class="ae ja" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ku je"><em class="os">Twitter</em></strong></a><a class="ae ja" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ku je"><em class="os">LinkedIn</em></strong></a><em class="os"/><a class="ae ja" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ku je"><em class="os">YouTube</em></strong></a><em class="os"/><a class="ae ja" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ku je"><em class="os">不和</em> </strong> </a> <em class="os">。对增长黑客感兴趣？检查</em> <a class="ae ja" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku je"> <em class="os">电路</em> </strong> </a> <em class="os">。</em></p></div></div>    
</body>
</html>