<html>
<head>
<title>A hands-on guide for creating a production-ready React app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建生产就绪型React应用的实践指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-hands-on-guide-for-creating-a-production-ready-react-app-864ad98e7497?source=collection_archive---------0-----------------------#2020-09-15">https://javascript.plainenglish.io/a-hands-on-guide-for-creating-a-production-ready-react-app-864ad98e7497?source=collection_archive---------0-----------------------#2020-09-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2207" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建React应用程序和生产版本</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/52f46c63a4907d698ecd8806fbc98661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RdbRg_SOsgRH0ukFLHoVDw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image credit: Author</figcaption></figure><p id="4ccc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Create React App 是一个集成的工具链，为用户和开发者提供最佳体验。它有许多现成的东西，我们可以直接跳到上面开始编码。</p><p id="449d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">完成开发后，我们需要进行生产构建，并将其部署到服务器上。在本文中，我们将介绍构建和部署过程。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5590" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">在开发模式下运行创建React应用程序</h1><p id="d137" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">安装Create React应用程序，并立即运行它:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="dd36" class="nb ma iq mx b gy nc nd l ne nf">npx create-react-app my-app<br/>cd my-app<br/>npm start</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/bd8778c7cbbf20cb5921444b6b7e542a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0P1GwGYlmxf4vl-blD-1w.png"/></div></div></figure><p id="8bc9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从<code class="fe nh ni nj mx b">Network</code>选项卡中，我们可以看到开发模式中的10个请求:</p><ul class=""><li id="6146" class="nk nl iq kx b ky kz lb lc le nm li nn lm no lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">localhost</code>:根目录的主入口<code class="fe nh ni nj mx b">index.html</code></li><li id="1497" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">bundle.js</code>:web pack捆绑文件</li><li id="892c" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">0.chunk.js</code>和<code class="fe nh ni nj mx b">main.chunk.js</code>:分割后的代码文件</li><li id="0d5d" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">react_devtools_backend.js</code>:<code class="fe nh ni nj mx b"><a class="ae lr" href="https://www.npmjs.com/package/react-devtools" rel="noopener ugc nofollow" target="_blank">react-devtools</a></code>的源代码</li><li id="f99d" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">logo.5d5d9eef.svg</code>:杂凑名称的logo SVG文件</li><li id="9e99" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">sockjs-node</code>:热模块重装的自定义web socket路径</li><li id="1cce" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">manifest.json</code>:JSON格式的app元数据</li><li id="ed11" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">favicon.ico</code>:网站图标</li><li id="f377" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">logo192.png</code>:logo图像文件</li></ul><h1 id="4f45" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">用Serve制作一个静态服务器</h1><p id="88c3" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">完成开发后，我们需要进行生产构建。<a class="ae lr" href="https://create-react-app.dev/docs/deployment" rel="noopener ugc nofollow" target="_blank"> React文档</a>声明最简单的方法是使用<a class="ae lr" href="https://github.com/zeit/serve" rel="noopener ugc nofollow" target="_blank"> serve </a>并让它处理剩下的事情。最好是全球安装serve:<code class="fe nh ni nj mx b">npm i serve -g</code>。</p><p id="8bb5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是执行<code class="fe nh ni nj mx b">npm run build</code>的输出:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="3c1f" class="nb ma iq mx b gy nc nd l ne nf">$ npm run build</span><span id="0dcc" class="nb ma iq mx b gy od nd l ne nf">&gt; react-app1@0.1.0 build /Users/fuje/app/react-app1<br/>&gt; react-scripts build</span><span id="18bc" class="nb ma iq mx b gy od nd l ne nf">Creating an optimized production build...<br/>Compiled successfully.</span><span id="66dd" class="nb ma iq mx b gy od nd l ne nf">File sizes after gzip:</span><span id="5c2f" class="nb ma iq mx b gy od nd l ne nf">39.39 KB  build/static/js/2.b71a4b70.chunk.js<br/>  774 B     build/static/js/runtime-main.f05b4f1f.js<br/>  648 B     build/static/js/main.6c51c068.chunk.js<br/>  547 B     build/static/css/main.5f361e03.chunk.css</span><span id="dc12" class="nb ma iq mx b gy od nd l ne nf">The project was built assuming it is hosted at /.<br/>You can control this with the homepage field in your package.json.</span><span id="6087" class="nb ma iq mx b gy od nd l ne nf">The build folder is ready to be deployed.<br/>You may serve it with a static server:</span><span id="7dd5" class="nb ma iq mx b gy od nd l ne nf">serve -s build</span><span id="7d82" class="nb ma iq mx b gy od nd l ne nf">Find out more about deployment here:</span><span id="3ffb" class="nb ma iq mx b gy od nd l ne nf">bit.ly/CRA-deploy</span></pre><p id="d862" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">build命令生成要部署的<code class="fe nh ni nj mx b">build</code>目录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/a8705bac7e67501fd9792fe6e2f5697b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9H4l1mDQDsIQwcqSCGwKQ.png"/></div></div></figure><p id="fc09" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">执行<code class="fe nh ni nj mx b">serve</code>命令运行生产构建:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="e28e" class="nb ma iq mx b gy nc nd l ne nf">$ serve -s build<br/>   ┌───────────────────────────────────────────────────┐<br/>   │                                                   │<br/>   │   Serving!                                        │<br/>   │                                                   │<br/>   │   - Local:            <a class="ae lr" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a>       │<br/>   │   - On Your Network:  <a class="ae lr" href="http://192.168.1.213:5000" rel="noopener ugc nofollow" target="_blank">http://192.168.1.213:5000</a>   │<br/>   │                                                   │<br/>   │   Copied local address to clipboard!              │<br/>   │                                                   │<br/>   └───────────────────────────────────────────────────┘</span></pre><p id="a5e3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">转到<code class="fe nh ni nj mx b">http://localhost:5000</code>或<code class="fe nh ni nj mx b">http://192.168.1.213:5000</code>并验证Create React App运行正常。</p><p id="9c1c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认情况下，生产版本在端口5000上运行。但是端口号是可配置的:<code class="fe nh ni nj mx b">serve -s build -l &lt;port number&gt;</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/dd4b47f1d9a9ac2241118bff83563470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ARrre7gW0NteOZLC4RWW8w.png"/></div></div></figure><p id="ab2a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe nh ni nj mx b">Network</code>选项卡中，我们看到生产模式中有9个请求。正如我们所预料的，不需要热模块重载的定制web套接字路径<code class="fe nh ni nj mx b">sockjs-node</code>。这些包用不同的散列名称分开，有一个名为<code class="fe nh ni nj mx b">main.5f361e03.chunk.css</code>的文件。</p><p id="8236" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有时我们会看到少于9个请求，因为有些请求使用缓存的数据。<code class="fe nh ni nj mx b">Empty Cache and Hard Reload</code>将总是以9个请求结束。</p><h1 id="3691" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">使用Express部署生产版本</h1><p id="0b9a" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated"><a class="ae lr" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>是一个面向web和移动应用的极简灵活的Node.js web app框架。Express server是部署生产版本的常见选择。</p><p id="3446" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于Express是Create React App的一部分，所以不需要再次安装。</p><p id="b7eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe nh ni nj mx b">server/index.js</code>设置Express服务器的配置文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="2e31" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nh ni nj mx b">app.use()</code>第4行在指定的路径安装指定的中间件功能。该函数的签名为<code class="fe nh ni nj mx b">app.use([path,] callback [, callback…])</code>。由于<code class="fe nh ni nj mx b">path</code>默认为<code class="fe nh ni nj mx b">“/”</code>，没有路径挂载的中间件将会为每个对app的请求执行。</p><p id="51d4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">中间件功能是按顺序执行的，因此中间件包含的顺序很重要。如果中间件已经被执行，剩余的路由将不会被执行。</p><p id="2016" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第4行是一个内置的中间件函数，提供静态文件，如图像、CSS文件和JavaScript文件。该函数有一个签名为<code class="fe nh ni nj mx b">express.static(root, [options])</code>，其中<code class="fe nh ni nj mx b">root</code>参数指定了为静态资产提供服务的根目录。</p><p id="edf2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">设置给<code class="fe nh ni nj mx b">express.static()</code>函数的路径相对于启动<code class="fe nh ni nj mx b">node</code>进程的目录。由于Express可以从任何地方启动，所以使用绝对路径更安全。<code class="fe nh ni nj mx b">__dirname</code>是包含源文件的目录的绝对路径。然后，<code class="fe nh ni nj mx b">path.join(__dirname, "../build")</code>或<code class="fe nh ni nj mx b">path.resolve(__dirname, "../build")</code>将以<code class="fe nh ni nj mx b">build</code>目录的绝对路径结束。</p><p id="5d1c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行<code class="fe nh ni nj mx b">node server</code>并验证Create React App运行正常。</p><p id="ee10" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们打印出第4行的请求，我们可以看到9个请求:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="5f7e" class="nb ma iq mx b gy nc nd l ne nf">Request URL = /static/css/main.5f361e03.chunk.css<br/>Request URL = /static/media/logo.5d5d9eef.svg<br/>Request URL = /static/js/2.bc7ff9af.chunk.js<br/>Request URL = /static/js/main.47e3d1e1.chunk.js<br/>Request URL = /static/css/main.5f361e03.chunk.css.map<br/>Request URL = /static/js/2.bc7ff9af.chunk.js.map<br/>Request URL = /static/js/main.47e3d1e1.chunk.js.map<br/>Request URL = /manifest.json<br/>Request URL = /logo192.png</span></pre><p id="9100" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有时，如果节点进程崩溃或没有正确退出，我们可能会遇到以下错误:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="8f8c" class="nb ma iq mx b gy nc nd l ne nf">Error: listen EADDRINUSE: address already in use :::8080</span></pre><p id="8299" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以使用<code class="fe nh ni nj mx b">lsof</code>(列出打开的文件)命令来报告所有打开的文件和打开它们的进程:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="38c1" class="nb ma iq mx b gy nc nd l ne nf">$ lsof -i tcp:8080<br/>COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME<br/>node 46666 fuje 23u IPv6 0xeecea4b504853bd9 0t0 TCP *:http-alt (LISTEN)</span></pre><p id="db3a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后使用<code class="fe nh ni nj mx b">kill</code>发送信号结束过程:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="047c" class="nb ma iq mx b gy nc nd l ne nf">$ kill -9 46666</span></pre><p id="7c17" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">到目前为止一切顺利。</p><p id="2da6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们安装<code class="fe nh ni nj mx b">npm i react-router-dom</code>，并修改<code class="fe nh ni nj mx b">src/App.js</code>如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="dd9a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该页面定义了3条路由，根路由、<code class="fe nh ni nj mx b">first-page</code>和<code class="fe nh ni nj mx b">second-page</code>。执行<code class="fe nh ni nj mx b">npm run build</code>，重启<code class="fe nh ni nj mx b">node server</code>。转到<code class="fe nh ni nj mx b">http://localhost:8080</code>，我们看到如下页面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7da99e0f45e0aaf1eecdc66cc6cc156d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*25cQw--ZvUchaixhkZSBdw.png"/></div></figure><p id="7fdd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击<code class="fe nh ni nj mx b">First Page</code>链接。页面转到<code class="fe nh ni nj mx b">first-page</code>路径:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/d6674b1dd9efc6203a65d3fdef3e45a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*5cEi6zMKQWV0UB7xAkysWg.png"/></div></figure><p id="a732" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后我们刷新页面，看到以下错误:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/bcd1313659ecc1c902f50a5f471276a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*SgFIykqHVYwZ7agNxoViDw.png"/></div></figure><p id="e7a7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">发生了什么事？</p><p id="8407" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">刷新页面到<code class="fe nh ni nj mx b">http://localhost:8080/first-page</code>，在文件结构<code class="fe nh ni nj mx b">build/first-page</code>下寻找<code class="fe nh ni nj mx b">index.html</code>，找不到。</p><p id="07f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的代码使用了<a class="ae lr" href="https://github.com/ReactTraining/react-router" rel="noopener ugc nofollow" target="_blank"> React路由器</a>，它调用了引擎盖下的HTML5 <a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/API/History_API#Adding_and_modifying_history_entries" rel="noopener ugc nofollow" target="_blank"> pushState历史API </a>。服务器需要配置为通过服务<code class="fe nh ni nj mx b">index.html</code>来响应对<code class="fe nh ni nj mx b">/first-page</code>或任何非根路由的请求。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="1245" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">修复方法是添加<code class="fe nh ni nj mx b">app.get()</code>函数(第6 - 8行)，该函数使用指定的回调函数将HTTP GET请求路由到指定的路径。该函数的签名为<code class="fe nh ni nj mx b">app.get(path, callback [, callback …])</code>，其中path是匹配的路由，回调是中间件函数的列表。</p><p id="5c18" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因为我们对匹配的路由使用通配符，所以任何路由都将以<code class="fe nh ni nj mx b">index.html</code>结尾。</p><p id="8072" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重启<code class="fe nh ni nj mx b">node server</code>并刷新<code class="fe nh ni nj mx b">http://localhost:8080/first-page</code>。现在页面显示正确。</p><p id="f8c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重启<code class="fe nh ni nj mx b">node server</code>会不会太麻烦？</p><p id="690d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以使用<code class="fe nh ni nj mx b">nodemon</code>，当目录中的文件发生变化时，它会自动重启节点应用程序。</p><p id="e7a8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装一次<code class="fe nh ni nj mx b">npm i nodemon -g</code>，运行<code class="fe nh ni nj mx b">nodemon server</code>启动Express。</p><h1 id="bc9e" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">将ES模块用于生产构建</h1><p id="ac77" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们已经使用<a class="ae lr" href="https://betterprogramming.pub/what-are-cjs-amd-umd-esm-system-and-iife-3633a112db62" rel="noopener ugc nofollow" target="_blank"> CommonJS (CJS)格式</a>来为生产构建编写服务器代码。ES模块(ESM)从ES2015年开始成为JavaScript使用的官方标准，广泛应用于JavaScript客户端开发。它还被作为附加类型的超集的TypeScript所采用。下面是ESM版的<code class="fe nh ni nj mx b">server/index.mjs</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="078f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nh ni nj mx b">__dirname</code>是CJS变量，ES模块中没有。它可以通过<code class="fe nh ni nj mx b">import.meta.url</code>复制(第5行)。</p><p id="32fd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">参照<a class="ae lr" href="https://betterprogramming.pub/what-might-be-coming-in-npm-9-6985cf2678a6" rel="noopener ugc nofollow" target="_blank">ES模块</a>的说明，可以用<code class="fe nh ni nj mx b">nodemon server/index.mjs</code>执行。</p><h1 id="e98c" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">利用process.env</h1><p id="e3f6" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们如何通过编程知道它是否是一个生产版本？</p><p id="9536" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nh ni nj mx b">process.env</code>可以方便地判断系统环境的状态。它是一个全局变量，由节点在运行时注入。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="aa02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">增加第33行打印出<code class="fe nh ni nj mx b">process.env.NODE_ENV</code>，不同情况下可以是不同的值:</p><ul class=""><li id="de30" class="nk nl iq kx b ky kz lb lc le nm li nn lm no lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">development</code>:如果执行<code class="fe nh ni nj mx b">npm start</code>。</li><li id="8eab" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">production</code>:如果执行<code class="fe nh ni nj mx b">nodemon server</code>。</li><li id="768d" class="nk nl iq kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated"><code class="fe nh ni nj mx b">test</code>:如果执行测试用例。</li></ul><p id="a01d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通常的做法是根据执行环境编写不同的执行分支，例如，如果<code class="fe nh ni nj mx b">process.env.NODE_ENV === ‘development’</code>则只打印出<code class="fe nh ni nj mx b">console.log</code>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3920" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="9b2c" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">我们已经演示了如何运行生产构建。如果应用程序从后端获取API，重要的是应用服务器和API从同一个地方提供服务(<code class="fe nh ni nj mx b">origin</code>)。否则，我们可能会遇到<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> CORS问题</a>。</p><p id="5fa0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建产品版本是服务器端渲染的垫脚石。</p><p id="e835" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae lr" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener"/>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="9bd1" class="nb ma iq bd mb oi oj dn mf ok ol dp mj le om on ml li oo op mn lm oq or mp os bi translated">进一步阅读</h2><div class="ot ou gp gr ov ow"><a href="https://bit.cloud/blog/theming-react-apps-with-styled-components-and-bit-l7epurug" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">使用风格化组件和位对React应用程序进行主题化</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为UI开发人员，我们经常希望将表示与交互分开，这样我们就可以应用相同的CSS…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">比特云</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk kp ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://bit.cloud/blog/how-to-create-a-composable-react-app-with-bit-l7ejpfhc" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">如何用Bit创建一个可组合的React App</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">在本指南中，您将学习如何使用Bit构建和部署一个成熟的可组合React应用程序。建立一个…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">比特云</p></div></div><div class="pf l"><div class="pl l ph pi pj pf pk kp ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a rel="noopener  ugc nofollow" target="_blank" href="/5-tips-to-scale-up-your-react-apps-8fb68319062e"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">扩展React应用的5个技巧</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">1.将Bit用于可组合设计2。设计令牌3。网络请求的定制钩子4。客户端与服务器状态5。一个…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="pf l"><div class="pm l ph pi pj pf pk kp ow"/></div></div></a></div></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="5b14" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="pn">更多内容请看</em><a class="ae lr" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="pn">plain English . io</em></strong></a><em class="pn">。报名参加我们的</em> <a class="ae lr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="pn">免费周报</em> </strong> </a> <em class="pn">。关注我们关于</em><a class="ae lr" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="pn">Twitter</em></strong></a><a class="ae lr" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="pn">LinkedIn</em></strong></a><em class="pn"/><a class="ae lr" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="pn">YouTube</em></strong></a><em class="pn"/><a class="ae lr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="pn">不和</em> </strong> </a> <em class="pn">。对增长黑客感兴趣？检查</em> <a class="ae lr" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="pn">电路</em> </strong> </a> <em class="pn">。</em></p></div></div>    
</body>
</html>