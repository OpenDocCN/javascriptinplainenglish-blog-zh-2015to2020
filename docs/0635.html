<html>
<head>
<title>React — Modern Testing with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React —用Cypress进行现代测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/reactjs-modern-testing-with-cypress-cb7b27286bad?source=collection_archive---------4-----------------------#2019-11-19">https://javascript.plainenglish.io/reactjs-modern-testing-with-cypress-cb7b27286bad?source=collection_archive---------4-----------------------#2019-11-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="cd56" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">你有一个很棒的应用。你写了很棒的测试。你想给你的客户看，所以你给他一部手机。</h2></div><p id="a86b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">大银行家鲍勃跑过来。</p><p id="7d81" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“你给我准备了什么<em class="ky">、</em>小程序员？有用吗？我赚钱了吗？”</p><p id="7b84" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“当然，鲍勃。我可以通过向您展示我编写的这些令人敬畏的测试来快速证明这一点！”</p><p id="301a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你打开文本编辑器，加载<code class="fe kz la lb lc b">makemoney.test.js</code>，脸上带着灿烂的笑容，向鲍勃展示它的辉煌。</p><p id="7ee1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">他一拳打在你的鼻子上。</p><p id="c09e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你到底在干吗你认为鲍勃会对你糟糕的单元测试毫不在乎吗？不要！他只是想知道，如果他的用户可以申请他们多汁的3000%年利率贷款！</p><p id="f7c5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是…</p><p id="9bf1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你能通过UI展示它的工作，而不必手动运行数百个不同的场景，这不是很好吗？他就不会伤害你了。哦，不。他可能会给你一大笔银行家的钱💰💰💰。</p><p id="c1c3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好吧，也许不是。但是它<em class="ky">会</em>很酷，对吗？</p><p id="43a9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是赛普拉斯的用武之地。</p><p id="b3ba" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> Cy-who？</strong></p><p id="9340" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Cypress是一个工具，它允许你对你的web应用程序执行类似用户的操作，有一个漂亮的UI和干净的API来引导。</p><p id="2226" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">对……所以呢？</strong></p><p id="c00b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您是否发现自己在React组件中测试内部状态字段？</p><p id="3956" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">如果我点击这个按钮，</em> <code class="fe kz la lb lc b"><em class="ky">dropdownOpen</em></code> <em class="ky">是否等于真？</em></p><p id="0f14" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我知道我有。但是这到底说明了什么呢？它告诉你如果:—</p><ul class=""><li id="970c" class="ld le in ke b kf kg ki kj kl lf kp lg kt lh kx li lj lk ll bi translated">下拉菜单实际上在屏幕上</li><li id="a1aa" class="ld le in ke b kf lm ki ln kl lo kp lp kt lq kx li lj lk ll bi translated">在你点击按钮之前它并不存在</li><li id="90b3" class="ld le in ke b kf lm ki ln kl lo kp lp kt lq kx li lj lk ll bi translated">下拉列表的内容</li></ul><p id="f7cd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">没有。事实上，它几乎什么也没告诉你。</p><p id="490a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用户不关心应用程序的内部状态，他们只关心屏幕上发生了什么；他们能看到该死的下拉菜单。</p><p id="3d21" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是赛普拉斯的意义所在。</p><p id="52dd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将用户动作自动化为一系列命令，并让Cypress来执行它们。它会在屏幕上呈现你的应用程序，你可以看到每个任务的执行(这是非常酷的)。它甚至理解加载和异步进程是实际的事情，所以当它不能马上找到一个元素时，它不会抱怨。</p><p id="c0ca" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不再有<code class="fe kz la lb lc b">wait</code>或<code class="fe kz la lb lc b">sleep</code>。不再有<code class="fe kz la lb lc b">simulate</code>。所有真实的动作，就像是由真实的用户执行的一样。只会更快。</p><p id="eb36" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想了解更多，请继续阅读。</p><p id="7192" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">我如何开始？</strong></p><p id="1e81" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">如果你想跟随下一部分，可以从</em> <a class="ae lr" href="https://gitlab.com/sk3pt1cc/react-cypress-intro" rel="noopener ugc nofollow" target="_blank"> <em class="ky">这里</em> </a> <em class="ky">克隆基础app。</em></p><p id="2543" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">下载完成后，运行资源库根目录下的</em> <code class="fe kz la lb lc b"><em class="ky">npm install</em></code> <em class="ky">，然后</em> <code class="fe kz la lb lc b"><em class="ky">npm run start</em></code> <em class="ky">在浏览器中加载app。您应该看到一个简单的表单，有两个输入框和一个登录按钮。</em></p><p id="7a6a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi">— —</p><p id="6f71" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好的，那我该怎么做呢？</p><p id="83c7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在项目根目录下，运行:-</p><p id="1f5c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">npm i cypress --save</code></p><p id="25c5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后:-</p><p id="cb5f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">$(npm bin)/cypress open</code></p><p id="3587" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">会有奇迹发生，然后你就完了。太棒了。</p><p id="fb5c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对了，这些是什么东西？</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ls"><img src="../Images/9061b559e1b421fe8fb257adf90dfe50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGeRd0aLclw62WV8-DCP0g.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Cypress UI</figcaption></figure><p id="ac63" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该会在屏幕上看到类似上面的内容。这是一个很好的小UI，Cypress给你管理不同的测试。你在屏幕上看到的列表包含了Cypress默认为你创建的不同的<code class="fe kz la lb lc b">spec</code>文件。我们不需要他们。</p><p id="48db" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在你的应用程序中，进入新创建的<code class="fe kz la lb lc b">cypress/</code>文件夹，删除<code class="fe kz la lb lc b">integration/</code>中的所有内容。</p><p id="67ef" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你现在回头看你的柏树窗户，什么也没有。</p><p id="2f4f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，是的，我该怎么做测试？！</p><p id="77fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe kz la lb lc b">integration/</code>文件夹中，创建一个名为<code class="fe kz la lb lc b">login.spec.js</code>的文件。Cypress会自动从那里获取文件，并通过用户界面访问它们。如果你现在向后滑动，你会在列表上看到它。</p><p id="5733" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们可以写一个测试。在<code class="fe kz la lb lc b">login.spec.js</code>中:-</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mi"><img src="../Images/04bdd87d05211098aa81e0e128e9ac92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFYzgdVG1ig7NeCoaP-vRg.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Cypress test for error notification</figcaption></figure><p id="4981" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Cypress的一个优点是API非常直观。我可能不需要解释这些线的大部分，但我还是会这样做，因为他妈的规则。</p><p id="efb1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi">— — — — — — — — — — — — — — — — — — — — — — —</p><p id="c1a3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">it()</code> - &gt;包含单一测试。</p><p id="cc6d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.visit()</code> - &gt;告诉Cypress要访问哪个页面。在这里，我们只是去根。</p><p id="4aef" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.server()</code> - &gt;告诉Cypress我们想要为我们的应用程序建立一个模拟后端。</p><p id="73bd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.route()</code> - &gt;告诉Cypress创建一个模拟路由，定义url、方法、响应和状态代码。更多关于这个<a class="ae lr" href="https://docs.cypress.io/api/commands/route.html#Syntax" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="ac5e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.get()</code> - &gt;从页面中检索一个DOM元素。这里我们使用id来获得我们需要的id。更多？<a class="ae lr" href="https://docs.cypress.io/api/commands/get.html#Syntax" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="1995" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.get().type()</code> - &gt;允许您在检索到的元素中键入一些文本。</p><p id="c4bc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.get().click()</code> - &gt;点击一个可点击的元素。</p><p id="bf7f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe kz la lb lc b">cy.get().should()</code> - &gt;一个论断。如果<code class="fe kz la lb lc b">error</code>不存在，测试将失败。<code class="fe kz la lb lc b">should</code>可以带的东西很多。都是<a class="ae lr" href="https://docs.cypress.io/api/commands/should.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="532d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi">— — — — — — — — — — — — — — — — — — — — — — —</p><p id="b338" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那个☝️.就是这样。那就是<em class="ky">字面上的</em>它。我的意思是，<em class="ky">女王</em>可以做<em class="ky">那个</em>，而且她大概… 200岁。</p><p id="cc66" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要查看您的测试运行，返回到Cypress UI，双击<code class="fe kz la lb lc b">login.spec.js</code>，观察它的运行。</p><p id="19a3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">哇哦。比如生孩子。</p><p id="b7c2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">现在怎么办？</em></p><p id="778f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，已经过了3个小时了，你终于看完了你的测试，一遍又一遍，因为这太酷了。接下来呢？嗯，有几件事你可以做。</p><p id="1376" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Cypress的文档非常好，如果你是个书呆子或者什么的，你可以在这里阅读它们。</p><p id="717d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，你可以尝试以下练习</p><ul class=""><li id="7eef" class="ld le in ke b kf kg ki kj kl lf kp lg kt lh kx li lj lk ll bi translated">重复上述测试，但没有成功消息</li><li id="79ba" class="ld le in ke b kf lm ki ln kl lo kp lp kt lq kx li lj lk ll bi translated">当您点击<code class="fe kz la lb lc b">x</code>按钮时，验证成功通知栏是否清空</li><li id="c373" class="ld le in ke b kf lm ki ln kl lo kp lp kt lq kx li lj lk ll bi translated">确认当您点击<code class="fe kz la lb lc b">x</code>按钮时，错误通知栏清除</li></ul><p id="1f92" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io">搞定了？</strong></p><p id="c3ea" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的。你可以点击我的个人资料查看我的其他资料。我写编程，我写小说，我写写作。没错。</p><p id="b1bd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读。</p></div></div>    
</body>
</html>