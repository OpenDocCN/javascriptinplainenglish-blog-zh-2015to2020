<html>
<head>
<title>Creating a Todo Chrome Extension with React, Custom Hooks and Local Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React、自定义挂钩和本地存储创建Todo Chrome扩展</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-todo-chrome-extension-with-react-custom-hooks-and-local-storage-f8f8d8910ee?source=collection_archive---------3-----------------------#2019-12-20">https://javascript.plainenglish.io/creating-a-todo-chrome-extension-with-react-custom-hooks-and-local-storage-f8f8d8910ee?source=collection_archive---------3-----------------------#2019-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="788a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">曾经想给自己发送令人讨厌的入侵式通知吗？或者每天提醒自己，你更可能手淫和吃多力多滋，而不是真正做任何工作？</p><p id="a6f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，别再找了。我掩护你。</p><p id="c8aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Chrome扩展可以做到所有这些，最棒的是，你甚至不能通过重新加载页面来逃避它们。另外，没人知道怎么关掉这些该死的东西。</p><p id="4c5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将创建一个todo应用程序，并将其作为chrome扩展部署在本地。我考虑做一个“你所在地区的性感单身”节目，但意识到我不认识任何性感单身。请给我打电话。</p><p id="40c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将对此使用React。完全没有必要。事实上，这是长期<em class="kl">不必要的</em>。但是我能说什么呢？我绝对讨厌自己。</p><p id="d8da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧。</p><p id="9a5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">先决条件</strong></p><ul class=""><li id="5c72" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">React的一些基础知识</li><li id="a90c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">稍微熟悉一下定制挂钩</li><li id="d1db" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">一大堆你知道你永远不会完成的事情，但你仍然想记录下来，因为永远欺骗自己比面对事实更容易</li></ul><p id="bf8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">克隆回购</strong></p><p id="9ab4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">克隆<code class="fe la lb lc ld b"><a class="ae le" href="https://gitlab.com/sk3pt1cc/react-starter" rel="noopener ugc nofollow" target="_blank">react-starter</a></code>回购。</p><p id="a465" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe la lb lc ld b">npm run start</code>启动它。</p><p id="65fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参观<code class="fe la lb lc ld b">localhost:3000</code>。</p><p id="dff7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建待办事宜应用</strong></p><p id="6fb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这有三个部分:主应用程序组件，一个用于创建新待办事项的组件&amp;一个定制的<code class="fe la lb lc ld b">useTodos</code>钩子。我将逐一介绍。</p><p id="5f7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe la lb lc ld b">&lt;CreateTodoForm /&gt;</code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/613a3b645328bb7fc709c91bb1ed2195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9jS8QlO90hLn0hUFvaaaA.png"/></div></div></figure><p id="516a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单的形式。它有一个创建todo标签的文本框和一个保存标签的按钮。它接收一个<code class="fe la lb lc ld b">createNewTodo</code> prop，这是一个我们很快就会看到的函数。</p><p id="de6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe la lb lc ld b">useTodos</code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lr"><img src="../Images/2aaed4aa8c4a223c846fa5bc17418290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGVD7a9Uz24xABc5j8eFLQ.png"/></div></div></figure><p id="6513" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是app最复杂的部分，我一点一点来处理。</p><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="9505" class="lw lx iq ld b gy ly lz l ma mb">const<em class="kl"> getTodos </em>=<em class="kl"> </em>()<em class="kl"> </em>=&gt;<em class="kl"> </em>{<br/>  const<em class="kl"> todos </em>=<em class="kl"> window.localStorage.getItem</em>('todos');</span><span id="12f5" class="lw lx iq ld b gy mc lz l ma mb">  if<em class="kl"> </em>(!todos)<em class="kl"> </em>{<br/>    <em class="kl">return </em>[];<br/>  }</span><span id="b405" class="lw lx iq ld b gy mc lz l ma mb"><em class="kl">  return JSON.parse</em>(todos);<br/>}</span></pre><p id="290a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一种从本地存储器中检索目标数据的功能。如果它们返回falsy(即它们还不存在)，我们就返回一个空数组。</p><p id="abb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一行将todos转换成javascript对象。这是必要的，因为本地存储将对象保存为字符串。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="7cd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe la lb lc ld b">const<em class="kl"> </em>[<em class="kl">todos</em>,<em class="kl"> setTodos</em>]<em class="kl"> </em>=<em class="kl"> useState</em>(getTodos());</code></p><p id="fe6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这里使用状态，以便每当<code class="fe la lb lc ld b">todos</code>改变时触发重新渲染。通过调用<code class="fe la lb lc ld b">getTodos</code>设置初始值。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="7101" class="lw lx iq ld b gy ly lz l ma mb">const updateTodos = (newTodos) =&gt; {<br/>  const stringifiedTodos = JSON.stringify(newTodos);<br/>  window.localStorage.setItem('todos', stringifiedTodos);<br/>  setTodos(newTodos);<br/>};</span></pre><p id="37ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一种功能，它更新本地存储器中的新目标，然后将它们设置为状态。我们需要在<code class="fe la lb lc ld b">newTodos</code>上调用<code class="fe la lb lc ld b">JSON.stringify</code>，因为本地存储只能保存字符串。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="581b" class="lw lx iq ld b gy ly lz l ma mb">const setTodoCompleted = (id, completed) =&gt; {<br/>  const todoIdx = todos.findIndex(todo =&gt; todo.id === id);<br/>  const newTodos = [...todos];</span><span id="bbc5" class="lw lx iq ld b gy mc lz l ma mb">  newTodos[todoIdx].completed = completed;</span><span id="b229" class="lw lx iq ld b gy mc lz l ma mb">  updateTodos(newTodos);<br/>};</span></pre><p id="6f70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在给定的todo上设置属性<code class="fe la lb lc ld b">completed</code>的函数。首先，我们从state中的<code class="fe la lb lc ld b">todos</code>数组获取todo的索引。然后，我们使用<a class="ae le" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank">数组展开语法</a>将数组复制到一个新的字段中。这是为了让我们不要将<a class="ae le" href="https://alistapart.com/article/why-mutation-can-be-scary/" rel="noopener ugc nofollow" target="_blank"> <em class="kl">突变为</em> </a>的原始值。然后，我们更新<code class="fe la lb lc ld b">completed</code>字段，最后用更新后的数组调用我们的<code class="fe la lb lc ld b">updateTodos</code>函数。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="5084" class="lw lx iq ld b gy ly lz l ma mb">const addTodo = (label) =&gt; {<br/>  const newTodo = { label, completed: false, id: uuid() };<br/>  updateTodos([...todos, newTodo]);<br/>};</span></pre><p id="281b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向列表中添加新任务的函数。我们首先创建新的todo对象，使用从<code class="fe la lb lc ld b">&lt;CreateTodoForm /&gt;</code>传来的标签。我们还默认设置了<code class="fe la lb lc ld b">completed = false</code>&amp;使用npm <code class="fe la lb lc ld b">uuid</code>库为我们的todo生成一个惟一的id。我们在更新中使用这个，如<code class="fe la lb lc ld b">setTodoCompleted</code>所示。最后，我们调用<code class="fe la lb lc ld b">updateTodos</code>并再次使用数组展开语法，只是这次它用于将<code class="fe la lb lc ld b">newTodo</code>追加到我们当前的<code class="fe la lb lc ld b">todos</code>数组中。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="bcb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一部分返回<code class="fe la lb lc ld b">todos</code>数组和对<code class="fe la lb lc ld b">addTodo</code>和<code class="fe la lb lc ld b">setTodoCompleted</code>函数的引用，这是<code class="fe la lb lc ld b">&lt;App /&gt;</code>需要的。</p><p id="6085" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe la lb lc ld b">&lt;App /&gt;</code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mk"><img src="../Images/f462f638555f0aebc69aca22300a0c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Of06x0EwhrV0z39sE_I4A.png"/></div></div></figure><p id="cafe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将一切联系在一起。我们映射<code class="fe la lb lc ld b">todos</code>中的项目，并为每个项目呈现一个标签&amp;复选框。这些有从<code class="fe la lb lc ld b">useTodos</code>钩子调用我们的<code class="fe la lb lc ld b">setTodoCompleted</code>函数的<code class="fe la lb lc ld b">onChange</code>处理程序。</p><p id="f695" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也渲染<code class="fe la lb lc ld b"> &lt;CreateTodoForm /&gt;</code>并将<code class="fe la lb lc ld b">addTodo</code>传递给它。</p><p id="5d1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe la lb lc ld b">App.css</code>包含一些基本的造型。如果你想使用它们，它们看起来像这样:</p><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="eef5" class="lw lx iq ld b gy ly lz l ma mb">.App {<br/>  padding: 32px;<br/>}</span><span id="ada5" class="lw lx iq ld b gy mc lz l ma mb">.todo {<br/>  display: flex;<br/>  padding: 8px;<br/>  margin: 8px;<br/>  background-color: whitesmoke;<br/>}</span><span id="33dd" class="lw lx iq ld b gy mc lz l ma mb">.todo p {<br/>  margin: 0;<br/>  margin-right: 16px;<br/>}</span><span id="1851" class="lw lx iq ld b gy mc lz l ma mb">.create-todo-form {<br/>  text-align: center;<br/>}</span><span id="ef9c" class="lw lx iq ld b gy mc lz l ma mb">.create-todo-form button {<br/>  margin: 5px;<br/>}</span></pre><p id="754d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行应用程序。一切都应该正常。</p><p id="c71d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">部署为Chrome扩展</strong></p><p id="de58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe la lb lc ld b">public/manifest.json</code>并粘贴以下内容:</p><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="cd7f" class="lw lx iq ld b gy ly lz l ma mb">{<br/>  "short_name": "TodoApp",<br/>  "name": "TodoApp",<br/>  "manifest_version": 2,<br/>  "browser_action": {<br/>    "default_popup": "index.html",<br/>    "default_title": "TodoApp"<br/>  },<br/>  "permissions": [<br/>    "storage"<br/>  ],<br/>  "version": "1.0"<br/>}</span></pre><p id="b06e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个文件描述了这个应用程序。属性指向它的主页，在大多数情况下是<code class="fe la lb lc ld b">index.html</code>。</p><p id="1e9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存它，并从应用程序的根目录运行<code class="fe la lb lc ld b">npm run build</code>。</p><p id="9f57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，打开Chrome并导航到地址栏中的<code class="fe la lb lc ld b">chrome://extensions</code>。打开窗口右上角的<code class="fe la lb lc ld b">Developer Mode</code>，然后点击左上角的<code class="fe la lb lc ld b">Load Unpacked</code>。找到你的<code class="fe la lb lc ld b">build/</code>文件夹，点击<code class="fe la lb lc ld b">select</code>。您的扩展应该出现在列表中，在浏览器扩展栏中伴随着一个小图标，可能是一个白色大写字母“T”。你点击这个打开扩展。</p><p id="2903" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">但是现在还不行。</strong></p><p id="ac08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Chrome的安全策略阻止扩展执行内联脚本，这正是我们的应用程序所使用的。为了解决这个问题，您必须在<code class="fe la lb lc ld b">manifest.json</code>中添加另一行代码:</p><pre class="lg lh li lj gt ls ld lt lu aw lv bi"><span id="b3cc" class="lw lx iq ld b gy ly lz l ma mb">"content_security_policy": "script-src 'self' '&lt;your-sha&gt;'; object-src 'self'"</span></pre><p id="951d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能会奇怪，为什么我一开始没有要求您添加这个。嗯，这不仅仅是令人讨厌——尽管令人讨厌<em class="kl">是一个高尚的原因——这是因为你需要从chrome打开你的扩展失败时产生的错误日志中复制一些东西。</em></p><p id="9576" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回<code class="fe la lb lc ld b">chrome://extensions</code>，点击分机上的<code class="fe la lb lc ld b">Errors</code>按钮。在以<code class="fe la lb lc ld b">Refused to execute inline script...</code>开头的文本中，找到以<code class="fe la lb lc ld b">sha-256</code>开头的字符串并复制它。两个撇号之间的所有内容。现在，替换上面文本中的<code class="fe la lb lc ld b">&lt;your-sha&gt;</code>并将整个内容粘贴到<code class="fe la lb lc ld b">manifest.json</code>中。</p><p id="181b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe la lb lc ld b">npm run build</code>重新构建你的扩展，并使用<code class="fe la lb lc ld b">Load unpacked</code>按钮将其加载回chrome。应该就是这样了。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="d52d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了——现在你可以创建浏览器扩展，一切尽在掌握。你无所不能。去大西洋航行。成为总统。搞定英国退出欧盟。</p><p id="a154" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只是不要再做一个他妈的颜色选择器。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="d42f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想知道更多类似的信息，请点击这里或Twitter @ lm _ writing关注我</p></div></div>    
</body>
</html>