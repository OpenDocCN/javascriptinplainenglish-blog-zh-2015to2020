<html>
<head>
<title>Learn Deep &amp; Shallow Copy with Tricky JavaScript Questions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过棘手的JavaScript问题学习深度和浅层复制</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/learn-deep-shallow-copy-with-tricky-javascript-questions-c563cdb5a4dd?source=collection_archive---------8-----------------------#2020-07-02">https://javascript.plainenglish.io/learn-deep-shallow-copy-with-tricky-javascript-questions-c563cdb5a4dd?source=collection_archive---------8-----------------------#2020-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9f87" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">代码示例&amp;插图等待</em></h2></div><h2 id="28b9" class="kg kh iq bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">看看下面的代码片段并比较结果:</strong></h2><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/4a33d81a6a367d69fa4b6d4d3871b786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mudJ1o91V2CVW0qv60zM7w.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Code Example_01</figcaption></figure><p id="5e1d" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">在上面的代码中，当我们将克隆体的名称从“百合”更改为“山茶花”时，原来的花也随之更改。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a5519d0e46dae5ccf58df47baadd9e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*cK2QGf4thvlQbxcf32rTig.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Code Example_02</figcaption></figure><p id="6428" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">现在，让我们看看第二个例子。有趣的是，我们把克隆体的名字改成“山茶花”后，原来的花名还是“百合”。</p><h1 id="a452" class="mm kh iq bd ki mn mo mp kl mq mr ms ko jw mt jx ks jz mu ka kw kc mv kd la mw bi translated">你发现最大的不同了吗？</h1><p id="a157" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">在第一个例子中，flower在一个数组中有一个<strong class="lu ir">嵌套对象</strong>，而第二个例子中没有。这个棘手的问题给我们上了一课:理解深层和浅层拷贝很重要，否则您可能会无意中改变数据。</p><p id="546a" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">第一个例子创建了一个<strong class="lu ir">浅拷贝</strong>，这意味着只有顶层的值被复制，但是嵌套的对象仍然指向内存中的同一个对象。因此，当您更改克隆的名称时，原始的花也会更新。</p><p id="bfae" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">然而，第二个示例创建了一个<strong class="lu ir">深层副本</strong>，这意味着克隆体和花朵引用内存中不同的对象。因此，所有的值都是不相关的。</p><p id="1481" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">让我们用一个类比来想象这里发生了什么。这不是一个完美的类比，但希望它能帮助你更好地理解这个概念。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="6907" class="mm kh iq bd ki mn nj mp kl mq nk ms ko jw nl jx ks jz nm ka kw kc nn kd la mw bi translated">浅层复制类比</h1><p id="612f" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">下面我们有两个工厂:obj1和它的克隆。在这个类比中，叶子代表属性{ color:“green”}。这两个工厂相互连接并共享同一个pot(即指向内存中的同一个对象)。</p><p id="0422" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">当我修改克隆体的叶子颜色时，原来obj1的叶子也会变成{ color:“pink”}。嘣！就像魔法一样。</p><div class="ld le lf lg gt ab cb"><figure class="no lh np nq nr ns nt paragraph-image"><img src="../Images/a3af8f736fcd7579acb9730969925206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*6o9E24rhvU47MTXhbOCvQw.png"/></figure><figure class="no lh np nq nr ns nt paragraph-image"><img src="../Images/76a2103462a0e160a64967e7e3eeba26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UD1BIi0bZ9jAE1cBxsxEOA.png"/><figcaption class="lo lp gj gh gi lq lr bd b be z dk nu di nv nw">Shallow Copy Analogy</figcaption></figure></div><h1 id="76e0" class="mm kh iq bd ki mn mo mp kl mq mr ms ko jw mt jx ks jz mu ka kw kc mv kd la mw bi translated">深层复制类比</h1><p id="c12c" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">这里我们有两个植物:obj1和它的克隆。同样，叶子代表属性{ color:“green”}。然而，在这个类比中，这两个植物是不相连的，并且各自有自己的锅(即指向内存中的不同对象)。</p><p id="8f91" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">当我修改克隆体的叶子颜色时，原始obj1的叶子将<strong class="lu ir">而不是</strong>完全不受影响。</p><div class="ld le lf lg gt ab cb"><figure class="no lh np nq nr ns nt paragraph-image"><img src="../Images/facffb98502cbec28b3f2c74f01718e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7ZVKN8Q6uhG-LmPnnxSlCw.png"/></figure><figure class="no lh np nq nr ns nt paragraph-image"><img src="../Images/c7fe09e21a5f6e2f24724c9c9d78e6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Z66kUfHNb_YCJHxxXxWhpw.png"/></figure></div></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="beda" class="mm kh iq bd ki mn nj mp kl mq nk ms ko jw nl jx ks jz nm ka kw kc nn kd la mw bi translated"><strong class="ak">其他克隆方法怎么样？</strong></h1><p id="2b34" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">除了ES6 spread操作符，我们还可以使用Object.assign()或JSON . parse(JSON . stringify(object))来制作副本。</p><h2 id="e087" class="kg kh iq bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak"> Object.assign() </strong></h2><p id="4f06" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">与spread运算符类似，如果数据是嵌套的，它将进行浅层复制，如果数据不是嵌套的，它将进行深层复制。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nx"><img src="../Images/25fdc395094a277aa31ccae282d8783c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EINiGMnmHyNGmC7R1XotCQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Object.assign() shallow copy</figcaption></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d450c83d9c19e854b1632365ce92e111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*L2fgqw8YGeDAYnTHWu94EQ.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Object.assign() deep copy</figcaption></figure><h2 id="989f" class="kg kh iq bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">JSON . parse(JSON . stringify(object))</strong></h2><p id="468b" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">此方法允许您进行深层复制，而不管是否存在嵌套数据。让我们来看看。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nx"><img src="../Images/b2bfea93b437207d5e763627698645c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yAkgXLXfuGhJ_pKSYa-Zkw.png"/></div></div></figure><p id="dda5" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated">对象是否嵌套并不重要，它进行深度复制！</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nx"><img src="../Images/acc2199b47050576cc967069a5485aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ntzbpv9zR2rmoaWSePWrkA.png"/></div></div></figure><h2 id="2ec9" class="kg kh iq bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">Lodash cloneDeep</h2><p id="f768" class="pw-post-body-paragraph ls lt iq lu b lv mx jr lx ly my ju ma kp mz mc md kt na mf mg kx nb mi mj mk ij bi translated">如果你认为用JavaScript克隆东西很麻烦，你可能想看看<a class="ae nz" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>，这里是关于cloneDeep的<a class="ae nz" href="https://lodash.com/docs/4.17.15#cloneDeep" rel="noopener ugc nofollow" target="_blank">文档</a>！</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h2 id="1eb1" class="kg kh iq bd ki kj kk dn kl km kn dp ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">就是这样！理解起来并不难，对吧？</h2></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="8a23" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma kp mb mc md kt me mf mg kx mh mi mj mk ij bi translated"><strong class="lu ir">如果你有兴趣探索更多关于这个话题的内容，可以看看下面的阅读材料:</strong> <br/> -阅读<a class="ae nz" href="https://www.freecodecamp.org/news/copying-stuff-in-javascript-how-to-differentiate-between-deep-and-shallow-copies-b6d8c1ef09cd/" rel="noopener ugc nofollow" target="_blank">一篇</a> <br/> -阅读<a class="ae nz" href="https://stackoverflow.com/questions/122102/what-is-the-most-efficient-way-to-deep-clone-an-object-in-javascript" rel="noopener ugc nofollow" target="_blank">两篇</a></p></div></div>    
</body>
</html>