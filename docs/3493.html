<html>
<head>
<title>Structuring Your React Application For Scale (Part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建适合扩展的React应用程序(第一部分)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/structuring-react-application-for-scale-part-i-1ce39f69bd42?source=collection_archive---------1-----------------------#2020-10-04">https://javascript.plainenglish.io/structuring-react-application-for-scale-part-i-1ce39f69bd42?source=collection_archive---------1-----------------------#2020-10-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/97a0ba352499530c10b3ac6f707e274a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TJHp1Be8FPIrlJIJ"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@marcello54?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marcello Gennari</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="e1f9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编写可维护代码的一个重要方面是正确设置代码。如果代码组织不当，很可能会导致错误并影响开发效率。</p><h1 id="df94" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">为什么要考虑组织代码？</h1><p id="ee1d" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">来自不同堆栈和语言的开发人员对它的理解可能会非常不同，没有确定的方法，但是让我们尝试定义一下为什么它是好的</p><ul class=""><li id="e574" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">可读性</li><li id="c3ef" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">可预测性</li><li id="06ee" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">一致性</li><li id="0f2f" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">更容易调试</li><li id="cfaf" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">更容易接纳新的开发人员</li></ul><p id="6cc9" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我想分享一种组织react项目的方法，这种方法适用于中/大型应用程序。我们构建的方式是，我们将把应用程序分成更小的块(特性)，每个块将进一步分成</p><ul class=""><li id="0eb8" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated"><strong class="kc je">数据层</strong>:负责管理应用程序的状态</li><li id="5d39" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated"><strong class="kc je">表示层(UI) </strong>:处理数据的表示</li></ul><p id="1f9d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将有助于我们轻松地在原子级别维护整个应用程序。由于我们将数据层和表示层分开，相同的结构也可以用于react本地项目。</p><p id="737e" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个由两部分组成的系列中，我们将从头开始定义结构。您还需要对以下内容有一些基本的了解:</p><ul class=""><li id="dc56" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">反应基础</li><li id="4820" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">反应钩</li><li id="db4a" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">状态管理的Redux</li><li id="559e" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">Redux-管理Redux的工具包</li><li id="6080" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">用于处理副作用的Redux-saga(例如API调用)</li></ul><p id="396a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然这种模式适用于小规模的项目，但可能有些矫枉过正，但是，嘿，一切都是从小处开始的，对吗？本文中定义的结构将构成我们将在本系列的下一篇文章中创建的应用程序的基础。</p><h1 id="4d08" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">初始化项目</h1><p id="c9d3" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">让我们通过在终端中运行以下命令，使用<code class="fe mp mq mr ms b">create-react-app</code>初始化react项目(在typescript中)</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="2d74" class="nb kz jd ms b gy nc nd l ne nf">npx create-react-app my-app --template typescript</span></pre><figure class="mt mu mv mw gt ip gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/1eda78c749c9c23c334ea63275b6803c.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*0l7sZkUQTpapDpbbKFBjvw.png"/></div></figure><p id="352f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">初始化之后，我们将结束上面的结构。所有的业务逻辑都将放在<code class="fe mp mq mr ms b">/src</code>文件夹中。</p><h1 id="865c" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置Redux</h1><p id="121c" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">对于状态管理，我们将使用<code class="fe mp mq mr ms b">redux</code>和<code class="fe mp mq mr ms b">redux-saga</code>。我们还将使用RTK <code class="fe mp mq mr ms b">@reduxjs/toolkit</code> (redux toolkit)，这是官方推荐的编写redux逻辑的方法。为了让redux-saga监听调度的redux动作，我们需要在创建reducer时注入sagas，因为将使用<code class="fe mp mq mr ms b">redux-injectors</code>。</p><p id="ceac" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:我们也可以使用其他状态管理选项，如RxJS、上下文API等。</p><h2 id="8d8c" class="nb kz jd bd la nh ni dn le nj nk dp li kl nl nm lm kp nn no lq kt np nq lu nr bi translated"><code class="fe mp mq mr ms b">yarn add @reduxjs/toolkit react-redux redux-saga @types/react-redux redux-injectors</code></h2><p id="a356" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">让我们通过创建<code class="fe mp mq mr ms b">/src/reducer.ts</code>、<code class="fe mp mq mr ms b">/src/saga.ts</code>和<code class="fe mp mq mr ms b">/src/store.ts</code>来配置Redux存储</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="9b5f" class="nb kz jd ms b gy nc nd l ne nf">// /src/reducer.ts<br/>import { combineReducers } from "@reduxjs/toolkit";</span><span id="4760" class="nb kz jd ms b gy ns nd l ne nf">const reducers = {<br/>  // ...reducers <br/>};</span><span id="76c5" class="nb kz jd ms b gy ns nd l ne nf">function createRootReducer() {<br/>    const rootReducer = combineReducers({<br/>      ...reducers<br/>    });<br/>  <br/>    return rootReducer;<br/>};<br/>  <br/>export { createRootReducer };</span><span id="0949" class="nb kz jd ms b gy ns nd l ne nf">// /src/saga.ts<br/>import { all, fork } from "redux-saga/effects";</span><span id="8cfa" class="nb kz jd ms b gy ns nd l ne nf">function* rootSaga() {<br/>    yield all([<br/>        // fork(saga1), fork(saga2)<br/>    ]);<br/>};<br/>  <br/>export { rootSaga };</span><span id="ac2e" class="nb kz jd ms b gy ns nd l ne nf">// /src/store.ts<br/>import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';<br/>import createSagaMiddleware from 'redux-saga';<br/>import { createInjectorsEnhancer } from 'redux-injectors';<br/>import { createRootReducer } from './reducer';<br/>import { rootSaga } from './saga';</span><span id="ffa6" class="nb kz jd ms b gy ns nd l ne nf">export type ApplicationState = {<br/>  // will hold state for each chunk/feature <br/>};</span><span id="2b52" class="nb kz jd ms b gy ns nd l ne nf">function configureAppStore(initialState: ApplicationState) {<br/>  const reduxSagaMonitorOptions = {};<br/>  const sagaMiddleware = createSagaMiddleware(reduxSagaMonitorOptions);</span><span id="a95e" class="nb kz jd ms b gy ns nd l ne nf">  const { run: runSaga } = sagaMiddleware;</span><span id="d89c" class="nb kz jd ms b gy ns nd l ne nf">  // sagaMiddleware: Makes redux saga works<br/>  const middlewares = [sagaMiddleware];</span><span id="3907" class="nb kz jd ms b gy ns nd l ne nf">  const enhancers = [<br/>    createInjectorsEnhancer({<br/>      createReducer: createRootReducer,<br/>      runSaga<br/>    })<br/>  ];</span><span id="5521" class="nb kz jd ms b gy ns nd l ne nf">  const store = configureStore({<br/>    reducer: createRootReducer(),<br/>    middleware: [...getDefaultMiddleware(), ...middlewares],<br/>    preloadedState: initialState,<br/>    devTools: process.env.NODE_ENV !== 'production',<br/>    enhancers<br/>  });</span><span id="c95e" class="nb kz jd ms b gy ns nd l ne nf">  sagaMiddleware.run(rootSaga);<br/>  return store;<br/>}<br/> <br/>export { configureAppStore };</span></pre><p id="be7c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们使用<code class="fe mp mq mr ms b">/src/App.tsx</code>中的<strong class="kc je"> &lt; Provider / &gt; </strong>组件将redux store添加到应用程序中</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="b8b1" class="nb kz jd ms b gy nc nd l ne nf">// /src/App.tsx<br/>import React from 'react';<br/>import logo from './logo.svg';<br/>import './App.css';<br/>import { Provider } from 'react-redux';<br/>import store from './store';</span><span id="9719" class="nb kz jd ms b gy ns nd l ne nf">function App() {<br/>  return (<br/>    &lt;Provider store={store}&gt;<br/>    &lt;div className="App"&gt;<br/>      &lt;header className="App-header"&gt;<br/>        &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>        &lt;p&gt;<br/>          Edit &lt;code&gt;src/App.tsx&lt;/code&gt; and save to reload.<br/>        &lt;/p&gt;<br/>        &lt;a<br/>          className="App-link"<br/>          href="&lt;https://reactjs.org&gt;"<br/>          target="_blank"<br/>          rel="noopener noreferrer"<br/>        &gt;<br/>          Learn React<br/>        &lt;/a&gt;<br/>      &lt;/header&gt;<br/>      &lt;/div&gt;<br/>    &lt;/Provider&gt;<br/>  );<br/>}</span><span id="e533" class="nb kz jd ms b gy ns nd l ne nf">export default App;</span></pre><p id="a358" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用<code class="fe mp mq mr ms b">npm start</code>保存并运行应用程序，检查是否一切运行正常。要检查redux是否正确集成，可以在浏览器中打开Redux DevTools。</p><figure class="mt mu mv mw gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nt"><img src="../Images/069b57addeda2e63342b433301f8cb95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPrdrYr1_a8yopWkfkNE5Q.png"/></div></div></figure><h1 id="42c7" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">建立基地</h1><p id="f85d" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在开始之前，让我们定义一些关于我们如何构建项目的基本类比</p><ul class=""><li id="3c94" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated"><strong class="kc je">配置:</strong>应用相关配置，如API端点、枚举(常量)等</li><li id="1382" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated"><strong class="kc je">组件:</strong>多处使用的定制组件</li><li id="915a" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated"><strong class="kc je">容器:</strong>由特性或模块组成，其中组件连接到Redux存储</li><li id="a216" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated"><strong class="kc je">导航器:</strong>此处为路由相关逻辑</li><li id="db53" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated"><strong class="kc je">服务:</strong>与外界连接的模块，如所有的API、分析等</li><li id="ef61" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">实用工具:像API助手、日期助手等助手方法</li></ul><p id="d2c1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们清理<code class="fe mp mq mr ms b">src/App.tsx</code>，删除所有的样板代码。</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="c8bc" class="nb kz jd ms b gy nc nd l ne nf">// src/App.tsx<br/>import React from 'react';<br/>import { Provider } from 'react-redux';<br/>import { ApplicationState, configureAppStore } from './store';</span><span id="8d0d" class="nb kz jd ms b gy ns nd l ne nf">const initialState: ApplicationState = {<br/>  // ... initial state of each chunk/feature<br/>};</span><span id="e787" class="nb kz jd ms b gy ns nd l ne nf">const store = configureAppStore(initialState);</span><span id="692e" class="nb kz jd ms b gy ns nd l ne nf">function App() {<br/>  return (<br/>    &lt;Provider store={store}&gt;<br/>      &lt;div&gt;Hello world&lt;/div&gt;<br/>    &lt;/Provider&gt;<br/>  );<br/>}</span><span id="8378" class="nb kz jd ms b gy ns nd l ne nf">export default App;</span></pre><h1 id="b742" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置路由器</h1><p id="c6af" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">为了处理应用程序的路由逻辑，我们将在项目中添加<code class="fe mp mq mr ms b">react-router-dom</code>，并在<code class="fe mp mq mr ms b">/src/navigator/</code>中创建一个名为<strong class="kc je"> Navigator </strong>的组件</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="bf3b" class="nb kz jd ms b gy nc nd l ne nf">yarn add react-router-dom <br/>yarn add --dev @types/react-router-dom</span><span id="466b" class="nb kz jd ms b gy ns nd l ne nf">// src/navigator/Navigator.tsx<br/>import React, { FC } from "react";<br/>import { Switch, Route, BrowserRouter as Router } from "react-router-dom";</span><span id="fcc8" class="nb kz jd ms b gy ns nd l ne nf">type Props = {};</span><span id="efd6" class="nb kz jd ms b gy ns nd l ne nf">const Navigator: FC&lt;Props&gt; = () =&gt; {<br/>  return (<br/>    &lt;Router&gt;<br/>      &lt;Switch&gt;<br/>        &lt;Route<br/>            path="/"<br/>            render={() =&gt; &lt;div&gt;Hello world&lt;/div&gt;} /&gt;<br/>      &lt;/Switch&gt;<br/>    &lt;/Router&gt;<br/>  );<br/>};</span><span id="231e" class="nb kz jd ms b gy ns nd l ne nf">export { Navigator };</span></pre><p id="c288" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并在<code class="fe mp mq mr ms b">/src/App.tsx</code>中导入<strong class="kc je"> &lt;导航器/ &gt; </strong>组件</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="8cfe" class="nb kz jd ms b gy nc nd l ne nf">// /src/App.tsx<br/>import React from "react";<br/>import { Provider } from "react-redux";<br/>import { ApplicationState, configureAppStore } from "./store";<br/>import { Navigator } from "./navigator/Navigator";</span><span id="1b03" class="nb kz jd ms b gy ns nd l ne nf">const initialState: ApplicationState = {<br/>  // ... initial state of each chunk/feature<br/>};</span><span id="60dc" class="nb kz jd ms b gy ns nd l ne nf">const store = configureAppStore(initialState);</span><span id="84e2" class="nb kz jd ms b gy ns nd l ne nf">function App() {<br/>  return (<br/>    &lt;Provider store={store}&gt;<br/>      &lt;Navigator /&gt;<br/>    &lt;/Provider&gt;<br/>  );<br/>}</span><span id="eaa2" class="nb kz jd ms b gy ns nd l ne nf">export default App;</span></pre><p id="7196" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击保存，你应该可以看到<em class="nu"> Hello world </em>文本。</p><h1 id="ea2b" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置配置</h1><p id="224c" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">该文件夹将包含与应用程序相关的所有配置。对于基本设置，我们将添加以下文件</p><ul class=""><li id="fe2d" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated"><code class="fe mp mq mr ms b">/.env</code>:包含应用程序的所有环境变量，如API端点。如果文件夹是使用<code class="fe mp mq mr ms b">create-react-app</code>搭建的，以<code class="fe mp mq mr ms b">REACT_APP</code>为前缀的变量将被webpack配置自动读取，更多信息可以查看<a class="ae ja" href="https://create-react-app.dev/docs/adding-custom-environment-variables/" rel="noopener ugc nofollow" target="_blank">官方指南</a>。如果你有一个定制的webpack配置，你可以从CLI传递这些env变量，或者你可以使用像<a class="ae ja" href="https://www.npmjs.com/package/cross-env" rel="noopener ugc nofollow" target="_blank"> cross-env </a>这样的包。</li></ul><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="722e" class="nb kz jd ms b gy nc nd l ne nf">// .env <br/>// NOTE: This file is added at the root of the project<br/>REACT_APP_PRODUCTION_API_ENDPOINT = "production_url"<br/>REACT_APP_DEVELOPMENT_API_ENDPOINT = "development_url"</span></pre><ul class=""><li id="79de" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated"><code class="fe mp mq mr ms b"><strong class="kc je">src/config/app.ts</strong></code> <strong class="kc je"> : </strong>包含应用程序所需的所有访问密钥和端点。所有这些配置都将从上面定义的环境变量中读取。现在，让我们保持简单，我们将有两个环境，即生产和开发。</li></ul><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="5d29" class="nb kz jd ms b gy nc nd l ne nf">// src/config/app.ts<br/>type Config = {<br/>  isProd: boolean;<br/>  production: {<br/>    api_endpoint: string;<br/>  };<br/>  development: {<br/>    api_endpoint: string;<br/>  };<br/>};</span><span id="13ae" class="nb kz jd ms b gy ns nd l ne nf">const config: Config = {<br/>  isProd: process.env.NODE_ENV === "production",<br/>  production: {<br/>    api_endpoint: process.env.REACT_APP_PRODUCTION_API_ENDPOINT || "",<br/>  },<br/>  development: {<br/>    api_endpoint: process.env.REACT_APP_DEVELOPMENT_API_ENDPOINT || "",<br/>  },<br/>};</span><span id="0325" class="nb kz jd ms b gy ns nd l ne nf">export default config;</span></pre><ul class=""><li id="35dc" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated"><code class="fe mp mq mr ms b"><strong class="kc je">src/config/enums.ts</strong></code>:包含任何全局级枚举(常量)。现在，我们来声明一下。</li></ul><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="40a2" class="nb kz jd ms b gy nc nd l ne nf">// src/config/enums.ts<br/>enum enums { <br/>	// GLOBAL_ENV = 'GLOBAL_ENV'<br/>}</span><span id="f188" class="nb kz jd ms b gy ns nd l ne nf">export default enums;</span></pre><ul class=""><li id="a3e5" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated"><code class="fe mp mq mr ms b"><strong class="kc je">src/config/request.ts</strong></code>:它包含默认的请求配置，我们稍后在进行API调用时会用到它。在这里，我们可以设置一些应用程序级别的API请求配置，如超时、最大内容长度、响应类型等。</li></ul><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="6eb9" class="nb kz jd ms b gy nc nd l ne nf">// src/config/request.ts<br/>type RequestConfig = {<br/>  url: string,<br/>  method: "get" | "GET" | "delete" | "DELETE" | "head" | "HEAD" | "options" | "OPTIONS" | "post" | "POST" | "put" | "PUT" | "patch" | "PATCH" | undefined,<br/>  baseURL: string,<br/>  transformRequest: any[],<br/>  transformResponse: any[],<br/>  headers: any,<br/>  params: any,<br/>  timeout: number,<br/>  withCredentials: boolean,<br/>  responseType: "json" | "arraybuffer" | "blob" | "document" | "text" | "stream" | undefined,<br/>  maxContentLength: number,<br/>  validateStatus: (status: number) =&gt; boolean,<br/>  maxRedirects: number,<br/>}</span><span id="133f" class="nb kz jd ms b gy ns nd l ne nf">const requestConfig: RequestConfig = {<br/>  url: '',<br/>  method: 'get', // default<br/>  baseURL: '',<br/>  transformRequest: [<br/>    function transformRequest(data: any) {<br/>      // Do whatever you want to transform the data<br/>      return data;<br/>    }<br/>  ],<br/>  transformResponse: [<br/>    function transformResponse(data: any) {<br/>      // Do whatever you want to transform the data<br/>      return data;<br/>    }<br/>  ],<br/>  headers: {},<br/>  params: {},<br/>  timeout: 330000,<br/>  withCredentials: false, // default<br/>  responseType: 'json', // default<br/>  maxContentLength: 50000,<br/>  validateStatus(status) {<br/>    return status &gt;= 200 &amp;&amp; status &lt; 300; // default<br/>  },<br/>  maxRedirects: 5, // default<br/>};</span><span id="d64c" class="nb kz jd ms b gy ns nd l ne nf">export default requestConfig</span></pre><p id="febd" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加了以下文件的当前文件夹结构:</p><ul class=""><li id="d6f8" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">/src/config/app.ts</li><li id="2900" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">/src/config/enums.ts</li><li id="9abd" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">/src/config/requests.ts</li><li id="d859" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">/.包封/包围（动词envelop的简写）</li></ul><figure class="mt mu mv mw gt ip gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8c02564051bd1f7a5276c27258227321.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*VVqI2JKB1CLZme-CsH33Ng.png"/></div></figure><h1 id="df6f" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置API服务</h1><p id="6519" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在这一节中，我们将为API调用设置一些辅助方法。为此，我们将使用Axios并为常见的本地存储和API方法<code class="fe mp mq mr ms b">GET</code> <code class="fe mp mq mr ms b">POST</code> <code class="fe mp mq mr ms b">PUT</code> <code class="fe mp mq mr ms b">PATCH</code> <code class="fe mp mq mr ms b">DELETE</code>编写一个包装器。下面的包装器做了一些小的调整，甚至可以与<strong class="kc je"> fetch API </strong>或<strong class="kc je"> XMLHTTPRequest </strong>一起使用，它们不需要任何外部库就可以使用。这一点可以跳过，但是一点点的抽象可以提供更好的一致性和清晰可读的代码。</p><p id="277c" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们首先将Axios包添加到项目中。</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="09b3" class="nb kz jd ms b gy nc nd l ne nf">yarn add axios</span></pre><p id="8671" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们将在<code class="fe mp mq mr ms b">/src/utils</code>中创建一个名为<code class="fe mp mq mr ms b">api-helper.ts</code>的文件，并将以下内容添加到该文件中。</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="0f8e" class="nb kz jd ms b gy nc nd l ne nf">// /src/utils/api-helper.ts<br/>import axios from "axios";<br/>import requestConfig from "../config/request";</span><span id="66e7" class="nb kz jd ms b gy ns nd l ne nf">export type CustomError = {<br/>  code?: number<br/>  message: string<br/>};</span><span id="b150" class="nb kz jd ms b gy ns nd l ne nf">export const getCustomError = (err: any) =&gt; {<br/>  let error: CustomError = {<br/>    message:  "An unknown error occured" <br/>  };</span><span id="c82b" class="nb kz jd ms b gy ns nd l ne nf">  if (err.response<br/>    &amp;&amp; err.response.data<br/>    &amp;&amp; err.response.data.error<br/>    &amp;&amp; err.response.data.message) {<br/>    error.code = err.response.data.error;<br/>    error.message = err.response.data.message;<br/>  } else if (!err.response &amp;&amp; err.message) {<br/>    error.message = err.message;<br/>  }</span><span id="5889" class="nb kz jd ms b gy ns nd l ne nf">  return error;<br/>};</span><span id="a710" class="nb kz jd ms b gy ns nd l ne nf">export const getFromLocalStorage = async (key: string) =&gt; {<br/>  try {<br/>    const serializedState = await localStorage.getItem(key);<br/>    if (serializedState === null) {<br/>      return undefined;<br/>    }<br/>    return JSON.parse(serializedState);<br/>  } catch (err) {<br/>    return undefined;<br/>  }<br/>};</span><span id="e26d" class="nb kz jd ms b gy ns nd l ne nf">export const saveToLocalStorage = async (key: string, value: any) =&gt; {<br/>  try {<br/>    const serializedState = JSON.stringify(value);<br/>    await localStorage.setItem(key, serializedState);<br/>  } catch (err) {<br/>    // Ignoring write error as of now<br/>  }<br/>};</span><span id="9032" class="nb kz jd ms b gy ns nd l ne nf">export const clearFromLocalStorage = async (key: string) =&gt; {<br/>  try {<br/>    await localStorage.removeItem(key);<br/>    return true;<br/>  } catch (err) {<br/>    return false;<br/>  }<br/>};</span><span id="d8d6" class="nb kz jd ms b gy ns nd l ne nf">async function getRequestConfig(apiConfig?: any) {<br/>  let config = Object.assign({}, requestConfig);<br/>  const session = await getFromLocalStorage("user");<br/>  if (apiConfig) {<br/>    config = Object.assign({}, requestConfig, apiConfig);<br/>  }<br/>  if (session) {<br/>    config.headers["Authorization"] = `${JSON.parse(session).token}`;<br/>  }<br/>  return config;<br/>}</span><span id="4a44" class="nb kz jd ms b gy ns nd l ne nf">export const get = async (url: string, params?: string, apiConfig?: any) =&gt; {<br/>  const config = await getRequestConfig(apiConfig);<br/>  config.params = params;<br/>  const request = axios.get(url, config);<br/>  return request;<br/>};</span><span id="8b46" class="nb kz jd ms b gy ns nd l ne nf">export const post = async (url: string, data: any, apiConfig?: any) =&gt; {<br/>  const config = await getRequestConfig(apiConfig);<br/>  let postData = {};<br/>  if (<br/>    apiConfig &amp;&amp;<br/>    apiConfig.headers &amp;&amp;<br/>    apiConfig.headers["Content-Type"] &amp;&amp;<br/>    apiConfig.headers["Content-Type"] !== "application/json"<br/>  ) {<br/>    postData = data;<br/>    axios.defaults.headers.post["Content-Type"] =<br/>      apiConfig.headers["Content-Type"];<br/>  } else {<br/>    postData = JSON.stringify(data);<br/>    axios.defaults.headers.post["Content-Type"] = "application/json";<br/>  }<br/>  const request = axios.post(url, postData, config);<br/>  return request;<br/>};</span><span id="b14a" class="nb kz jd ms b gy ns nd l ne nf">export const put = async (url: string, data: any) =&gt; {<br/>  const config = await getRequestConfig();<br/>  config.headers["Content-Type"] = "application/json";<br/>  const request = axios.put(url, JSON.stringify(data), config);<br/>  return request;<br/>};</span><span id="4c88" class="nb kz jd ms b gy ns nd l ne nf">export const patch = async (url: string, data: any) =&gt; {<br/>  const config = await getRequestConfig();<br/>  config.headers["Content-Type"] = "application/json";<br/>  const request = axios.patch(url, JSON.stringify(data), config);<br/>  return request;<br/>};</span><span id="6537" class="nb kz jd ms b gy ns nd l ne nf">export const deleteResource = async (url: string) =&gt; {<br/>  const config = await getRequestConfig();<br/>  const request = axios.delete(url, config);<br/>  return request;<br/>};</span></pre><p id="9c63" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mp mq mr ms b">getCustomError</code>将错误处理成自定义类型<code class="fe mp mq mr ms b">CustomError</code>并且<code class="fe mp mq mr ms b">getRequestConfig</code>负责在用户被授权的情况下向API请求添加授权。这个实用API助手可以根据后端使用的逻辑进行修改。</p><p id="6056" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们继续设置<code class="fe mp mq mr ms b">/src/services/Api.ts</code>,在这里我们将声明所有的API调用。任何需要与外界交互的东西都将归入<code class="fe mp mq mr ms b">/src/services</code>之下，比如API调用、分析等。</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="d581" class="nb kz jd ms b gy nc nd l ne nf">// /src/services/Api.ts<br/>import config from "../config/app";<br/>import * as API from "../utils/api-helper";</span><span id="9a16" class="nb kz jd ms b gy ns nd l ne nf">const { isProd } = config;</span><span id="7535" class="nb kz jd ms b gy ns nd l ne nf">const API_ENDPOINT = isProd<br/>  ? config.production.api_endpoint<br/>  : config.development.api_endpoint;</span><span id="4ef8" class="nb kz jd ms b gy ns nd l ne nf">// example GET API request<br/>/** <br/>	export const getAPIExample = (params: APIRequestParams) =&gt; {<br/>		const { param1, param2 } = params;<br/>		const url = `${API_ENDPOINT}/get_request?param1=${param1}&amp;param2=${param2}`;</span><span id="642b" class="nb kz jd ms b gy ns nd l ne nf">		return API.get(url);<br/>	}<br/>*/</span></pre><p id="ffad" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">包含以下更改的当前文件夹结构将如下所示:</p><ul class=""><li id="6e90" class="mb mc jd kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">/src/utils/api-helper.ts</li><li id="0025" class="mb mc jd kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">/src/services/Api.ts</li></ul><figure class="mt mu mv mw gt ip gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2de700b4414600f291ff3f72c8de3912.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*rZ2Ea1xfoi5dtbcue1_HQw.png"/></div></figure><h1 id="09d6" class="ky kz jd bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">后续步骤</h1><p id="28ba" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">乡亲们！这是这一部分的主要内容，尽管我们在其中定义了应用程序的所有业务逻辑，即<code class="fe mp mq mr ms b">containers</code> &amp; <code class="fe mp mq mr ms b">components</code>，我们将在下一部分通过创建一个小的Reddit客户端来获取特定主题的结果。</p><p id="21e2" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我也给了这个GitHub知识库的链接，请随意使用它作为参考，如果你喜欢它，请推广这个回购以最大化它的可见性。</p><div class="im in gp gr io nx"><a href="https://github.com/anishkargaonkar/react-reddit-client/tree/setup" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd je gy z fp oc fr fs od fu fw jc bi translated">anishkargaonkar/react-Reddit-client</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol iu nx"/></div></div></a></div><p id="c5ff" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">非常感谢你阅读这篇文章，希望这是一个有趣的阅读！我很想听听你的想法。下一部见<a class="ae ja" href="https://medium.com/@anishkargaonkar/structuring-react-application-for-scale-part-ii-d652ff418da0" rel="noopener">。再见！</a></p><div class="im in gp gr io nx"><a href="https://medium.com/@anishkargaonkar/structuring-react-application-for-scale-part-ii-d652ff418da0" rel="noopener follow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd je gy z fp oc fr fs od fu fw jc bi translated">结构化反应量表的应用(下)</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">在上一个教程中，我们定义了可伸缩react应用程序的基本结构。为了展示这一切是如何发生的…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">medium.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol iu nx"/></div></div></a></div></div></div>    
</body>
</html>