<html>
<head>
<title>Node.js Best Practices — Data and Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js最佳实践—数据和安全性</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-best-practices-data-and-security-3099d0609548?source=collection_archive---------11-----------------------#2020-09-14">https://javascript.plainenglish.io/node-js-best-practices-data-and-security-3099d0609548?source=collection_archive---------11-----------------------#2020-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/84948f1de674ca8df398e94eed8895b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KpGP1q03RJA399dK"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@overture_creations?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Overture Creations</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8ee9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写节点应用程序时应该遵循的一些最佳实践。</p><h1 id="5154" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">启用TLS/SSL</h1><p id="1645" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这是最基本的安全最佳实践。</p><p id="64a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不希望任何人窥探发送和接收的数据。</p><p id="b0a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也很重要，因为它可以确保数据在传输过程中不会被修改。</p><p id="5df9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在任何网络主机上安装SSL证书。</p><p id="987b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Let's Encrypt为我们提供了可以自动更新的免费SSL证书。</p><p id="a36f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，即使我们通过SSL通信，我们的节点应用程序也不应该直接暴露在互联网上。</p><p id="f499" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2b63" class="mn lc iq mj b gy mo mp l mq mr">app.set(‘trust proxy’, ‘1.0.0.0’);</span></pre><p id="dbfb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让流量从我们的代理流向我们的应用。</p><p id="dca7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，除了Nginx这样的反向代理之外，我们还可以使用它来使我们的应用成为反向代理。</p><p id="3085" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代理还应该设置<code class="fe ms mt mu mj b">X-Forwarded-Proto: https</code> HTTP头。</p><h1 id="b4e8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试HTTPS证书传输</h1><p id="30ea" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Qualys SSL Labs、nmap、OpenSSL或sslyze测试HTTPS证书传输。</p><p id="11f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过运行以下命令来运行nmap:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="bfb9" class="mn lc iq mj b gy mo mp l mq mr">nmap --script ss-cert,ssl-enum-ciphers -p 443 example.com</span></pre><p id="a2da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用这些选项测试SSL传输。</p><p id="da63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">example.com</code>是我们的站点。</p><p id="ae9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">443是SSL用来通信的端口。</p><p id="8d25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用sslyze，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="55ff" class="mn lc iq mj b gy mo mp l mq mr">sslyze.py --regular example.com:4444</span></pre><p id="7df0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于OpenSSL客户端，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e154" class="mn lc iq mj b gy mo mp l mq mr">echo ‘q’ | openssl s_client -host example.com -port 443</span></pre><h1 id="09de" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检查已知的安全漏洞</h1><p id="67d9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该及时了解最新的已知安全漏洞。</p><p id="0018" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用一些工具来检查我们的依赖关系。包括Snyk、Node Security Project、Retire.js等网站。</p><h1 id="a629" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">对发送到应用程序的所有不可信数据进行编码</h1><p id="dc17" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了防止不受信任的数据运行任何恶意的东西，我们应该净化它们，使它们不能作为代码运行。</p><p id="d597" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有几种方法来编码它们。</p><p id="cf2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">HTML编码可以用后端的escape-html包来完成。</p><p id="5417" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标签内的任何内容都会被转义。</p><p id="aef8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CSS编码可以用css.escape库来完成。</p><p id="5671" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript编码可以用js-string-escape库来完成，它在浏览器和Node上都可以工作。</p><p id="8aad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要转义URL，我们可以在前端使用<code class="fe ms mt mu mj b">encodeURIComponent</code>函数转义它们。</p><p id="a6c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe ms mt mu mj b">urlencode</code>可以用在后端。</p><h1 id="5a66" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">防止参数污染，以阻止可能的未捕获异常</h1><p id="aa15" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该防止可能产生异常的参数污染。</p><p id="a891" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们对解析的查询字符串使用了意外的数据类型，那么在解析它们的时候我们可能会得到异常，我们试图对它们做一些事情。</p><p id="6a9b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有给定的端点:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1cd5" class="mn lc iq mj b gy mo mp l mq mr">app.get('/foo', function(req, res){<br/>  if(req.query.name){<br/>    res.status(200).send(req.query.name.toUpperCase())<br/>  } else {<br/>    res.status(200).send('Hi');<br/>  }<br/>});</span></pre><p id="028e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，如果我们查询:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2c63" class="mn lc iq mj b gy mo mp l mq mr">http://example.com:8080/foo?name=james&amp;name=mary</span></pre><p id="a85f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe ms mt mu mj b">req.query.name</code>将会是一个数组，因为我们有2个带有键<code class="fe ms mt mu mj b">name</code>的值。</p><p id="8117" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数组没有<code class="fe ms mt mu mj b">toUpperCase</code>方法，所以我们会有一个错误。</p><p id="941b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们应该对此进行检查，这样如果<code class="fe ms mt mu mj b">req.query.name</code>是一个数组，我们就可以阻止调用<code class="fe ms mt mu mj b">toUpperCase</code>方法。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/73b3faa9f27ef7541648aa61c4dd1f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bCsSAIinzvmF6anC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@iam_aspencer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrew Spencer</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a8f2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e243" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该对任何应用启用SSL/TLS。我们可以免费获得SSL证书。</p><p id="7618" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有，我们要检查我们的数据，并对它们进行转义。</p><p id="8fea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该检查安全漏洞。</p><h2 id="a33f" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">简单英语的JavaScript</h2><p id="2201" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>