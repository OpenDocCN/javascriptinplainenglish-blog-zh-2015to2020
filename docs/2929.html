<html>
<head>
<title>Robust JavaScript — Security and Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">强大的JavaScript —安全性和性能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/robust-javascript-security-and-performance-9012875cd5ce?source=collection_archive---------4-----------------------#2020-08-07">https://javascript.plainenglish.io/robust-javascript-security-and-performance-9012875cd5ce?source=collection_archive---------4-----------------------#2020-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0adde48c769d014bb99ff4cb93db20a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OsDB8gjj0ZGZQWnM"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@yvesalarie?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Yves Alarie</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4969" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些在编写JavaScript代码时应该遵循的最佳实践。</p><h1 id="1de7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不要污染窗户物体</h1><p id="2fe5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该给<code class="fe me mf mg mh b">window</code>对象添加我们自己的属性。</p><p id="9152" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就产生了很容易被覆盖的全局变量。</p><p id="a2e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不同属性的名称可能会冲突。</p><p id="02dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了避免添加全局变量，我们应该将变量放在函数内部:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c29e" class="mq lc iq mh b gy mr ms l mt mu">(function () {<br/>  for (let i = 0; i &lt; 9; i++) {<br/>    // ...<br/>  }<br/>  <!-- -->window.result = true;<br/>})();</span></pre><p id="6aa2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是添加必须添加到<code class="fe me mf mg mh b">window</code>中的属性，而将其余的保留在里面。</p><p id="22e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">i</code>停留在函数内部。</p><h1 id="1f20" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安全输出代码</h1><p id="84de" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该用一些方法来保护我们的代码。</p><p id="11df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们设置一个元素的<code class="fe me mf mg mh b">innerHTML</code>属性时，我们不应该让用户设置任何东西。</p><p id="6056" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有这样的东西:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3591" class="mq lc iq mh b gy mr ms l mt mu">const linkElement = document.getElementById('link');<br/>const linkUrl = 'https://example.com/';<br/>const linkContent = 'example site';</span><span id="88b8" class="mq lc iq mh b gy mv ms l mt mu">linkElement.innerHTML = `&lt;div class="container"&gt;&lt;a href="${linkUrl}"&gt;${linkContent}&lt;/a&gt;&lt;/div&gt;`;</span></pre><p id="a381" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">linkElement</code>的<code class="fe me mf mg mh b">innerHTML</code>属性，它有设置URL的链接。</p><p id="ce1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这段代码很危险，因为攻击者可以将脚本传递给这些变量。</p><p id="f446" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">textContent</code>属性来代替设置接受任何内容的<code class="fe me mf mg mh b">innerHTML</code>属性。</p><p id="9fd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e7d1" class="mq lc iq mh b gy mr ms l mt mu">const linkElement = document.getElementById('link');<br/>const linkUrl = 'https://example.com/';<br/>const linkContent = 'example site'</span><span id="e04f" class="mq lc iq mh b gy mv ms l mt mu">linkElement.textContent = linkContent;<br/>linkElement.href  = linkUrl;</span></pre><p id="a4f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们设置<code class="fe me mf mg mh b">textContent</code>来设置显示给用户的文本。</p><p id="4e35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe me mf mg mh b">href</code>设置主播的href属性。</p><h1 id="2fb9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用<code class="fe me mf mg mh b">DOM</code> API来创建和添加元素</h1><p id="3422" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">document.createElement</code>方法添加元素。</p><p id="a3b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="50f4" class="mq lc iq mh b gy mr ms l mt mu">const newDiv = document.createElement("div");<br/>document.body.appendChild(newDiv);</span></pre><p id="3069" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">createElement</code>创建一个div，并调用<code class="fe me mf mg mh b">appendChild</code>将它附加到主体。</p><h1 id="d923" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">表演</h1><p id="5166" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当我们编写JavaScript应用程序来提高它的性能时，我们应该注意一些事情。</p><h1 id="7726" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">仅加载我们需要的库</h1><p id="871e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该只加载我们需要的库，尽可能加载最少的代码。</p><p id="769c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将提高我们代码的加载速度。</p><p id="af3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有未使用的库，我们应该删除它们。</p><p id="a278" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果JavaScript标准库中有替代品，我们应该使用它们。</p><p id="3f43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们应该使用内置的数组实例方法，而不是使用Lodash数组方法。</p><p id="c211" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用Lodash这样的大型库，我们应该只使用；y导入我们需要的函数。</p><p id="f02f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们应该像这样导入它们:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3b48" class="mq lc iq mh b gy mr ms l mt mu">import map from 'lodash/map';<br/>import tail from 'lodash/tail';<br/>import uniq from 'lodash/uniq';</span></pre><h1 id="8c84" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">缓存DOM选择</h1><p id="7ed6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们使用DOM节点，我们应该在变量中缓存从DOM中检索到的节点。</p><p id="80fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fd7f" class="mq lc iq mh b gy mr ms l mt mu">const menu = document.querySelector('#menu');<br/>const hideButton = document.querySelector('.hide-button');<br/><br/>hideButton.addEventListener('click', () =&gt; {<br/>  menu.style.display = 'none';<br/>});</span></pre><p id="93bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">缓存<code class="fe me mf mg mh b">menu</code>变量。</p><p id="0b93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这比写作更好:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="733f" class="mq lc iq mh b gy mr ms l mt mu">const hideButton = document.querySelector('.hide-button');<br/><br/>hideButton.addEventListener('click', () =&gt; {<br/>  <!-- -->const menu = document.querySelector('#menu');<br/>  menu.style.display = 'none';<br/>});</span></pre><p id="4973" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二个例子中，每当我们点击类为<code class="fe me mf mg mh b">hide-button</code>的元素时，我们就获得带有ID菜单的元素。</p><p id="30f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是非常低效的，因为我们每次都从DOM中获取它。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/3e40cbfff8d475fca6c14b9b6203f071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q5dj0OCS1T1GoPnQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lctune?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Artur Wayne</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2bff" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="c8fa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该注意到一些小的变化，这些变化可以极大地提高性能，使它们更加安全。</p><h2 id="6df2" class="mq lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="a1c6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>