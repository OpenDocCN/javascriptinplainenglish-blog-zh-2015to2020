<html>
<head>
<title>Test Driven Development — Node.js API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试驱动开发— Node.js API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-api-test-driven-development-a8955435581e?source=collection_archive---------1-----------------------#2019-02-06">https://javascript.plainenglish.io/node-js-api-test-driven-development-a8955435581e?source=collection_archive---------1-----------------------#2019-02-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><blockquote class="jk jl jm"><p id="631d" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">“测试驱动开发(TDD)是在编程过程中管理恐惧的一种方式”——Kent Beck</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/565f5db45f262ab09fac1d28e4a71870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBcWpbLqcryEJwIzVRmD4w.jpeg"/></div></div></figure><h1 id="afae" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">介绍</h1><p id="a2ea" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">TDD代表测试驱动开发，是构建软件应用程序的一种方式。这种方法增加了流程的复杂性。开发人员必须编写额外的代码——测试用例。TDD确保这段代码在发布前完成了要求的任务。它确保代码可以随着业务需求的变化而容易地改变。这个过程包括三个主要步骤:编写失败的测试、编写满足测试的代码和重构。</p><h2 id="eb8e" class="me kz in bd la mf mg dn le mh mi dp li ly mj mk lm ma ml mm lq mc mn mo lu mp bi translated">开始前</h2><ul class=""><li id="1016" class="mq mr in jq b jr lw jv lx ly ms ma mt mc mu kl mv mw mx my bi translated">应用程序代码应该满足一定的标准，然后才能进行测试。</li><li id="24f9" class="mq mr in jq b jr mz jv na ly nb ma nc mc nd kl mv mw mx my bi translated">该应用程序使用MVC架构。</li><li id="2443" class="mq mr in jq b jr mz jv na ly nb ma nc mc nd kl mv mw mx my bi translated">本教程只关注测试控制器[业务逻辑]。</li></ul><h2 id="994c" class="me kz in bd la mf mg dn le mh mi dp li ly mj mk lm ma ml mm lq mc mn mo lu mp bi translated">设置环境</h2><pre class="kn ko kp kq gt ne nf ng nh aw ni bi"><span id="0f6c" class="me kz in nf b gy nj nk l nl nm">mkdir todo-api<br/>npm init -y</span></pre><h2 id="097e" class="me kz in bd la mf mg dn le mh mi dp li ly mj mk lm ma ml mm lq mc mn mo lu mp bi translated">安装依赖项</h2><p id="79eb" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">依赖关系:</p><pre class="kn ko kp kq gt ne nf ng nh aw ni bi"><span id="cb28" class="me kz in nf b gy nj nk l nl nm">npm i -S express body-parser mysql2 sequelize morgan</span><span id="db07" class="me kz in nf b gy nn nk l nl nm">npm i -D chai mocha nodemon sinon</span></pre><h1 id="d8ee" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">文件结构</h1><p id="a530" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">典型Node.js MVC应用程序的文件结构如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/27797f74783e3122e39faf9be2dc6bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*779hHmQbzwhA2-CMX3LWIQ.png"/></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">Node.js API File Structure</figcaption></figure><p id="c05c" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated"><em class="jp">控制器的测试文件驻留在controllers文件夹中，前缀为</em> <strong class="jq io"> <em class="jp"> .spec.js </em> </strong> <em class="jp">。这只是一个</em> <strong class="jq io"> <em class="jp">个人喜好</em> </strong> <em class="jp">。</em></p><h2 id="89f5" class="me kz in bd la mf mg dn le mh mi dp li ly mj mk lm ma ml mm lq mc mn mo lu mp bi translated">测试命令</h2><p id="15a9" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">测试命令在<strong class="jq io"> package.json </strong>文件中，如下所示:</p><pre class="kn ko kp kq gt ne nf ng nh aw ni bi"><span id="4e2c" class="me kz in nf b gy nj nk l nl nm">“test”: “mocha controllers/*.spec.js”</span></pre><h1 id="8eef" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">写作失败测试</h1><p id="4b9c" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">TDD的第一步是编写失败的测试。需求被收集起来，并为它们编写测试用例。在编写测试用例之前，需求应该是清晰的。</p><h2 id="6d67" class="me kz in bd la mf mg dn le mh mi dp li ly mj mk lm ma ml mm lq mc mn mo lu mp bi translated">需求文件</h2><p id="1bb2" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">Todo是简单的文本，通知一项工作要做。待办事项应用程序允许用户<strong class="jq io">创建待办事项</strong>并<strong class="jq io">列出所有待办事项</strong>。</p><p id="d515" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">根据要求，应该有两个API—<strong class="jq io">创建待办事项</strong>和<strong class="jq io">列表待办事项</strong>。</p><h2 id="96c0" class="me kz in bd la mf mg dn le mh mi dp li ly mj mk lm ma ml mm lq mc mn mo lu mp bi translated">测试案例</h2><p id="a914" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">以下是测试案例列表:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="5ddc" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">现在，如果运行命令<strong class="jq io"> npm test </strong>，mocha会显示以下信息。有五个测试没有通过或失败。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/d061b4c714c8a0ea965319f2ecb9b99b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*2rJ3_5XUU3gqNemYUQ52rg.png"/></div></figure><ul class=""><li id="b8ef" class="mq mr in jq b jr js jv jw ly nw ma nx mc ny kl mv mw mx my bi translated">进口<strong class="jq io">柴、兴农</strong>和<strong class="jq io">至控制器</strong>。</li><li id="71ab" class="mq mr in jq b jr mz jv na ly nb ma nc mc nd kl mv mw mx my bi translated">每次测试后，根据<a class="ae nz" href="https://sinonjs.org/releases/v7.2.3/general-setup/" rel="noopener ugc nofollow" target="_blank">文件</a>恢复<strong class="jq io"> sinon </strong>。</li><li id="1ce3" class="mq mr in jq b jr mz jv na ly nb ma nc mc nd kl mv mw mx my bi translated">每次测试前，使用<strong class="jq io">假</strong>或<strong class="jq io">假</strong>宣布<strong class="jq io">请求</strong>、<strong class="jq io">结果</strong>和<strong class="jq io">下一个</strong>。它们需要作为参数发送给控制器。</li></ul><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="db4d" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">还没有做任何事情。因此，第一种情况下的第一个测试如下所示:“应提供<strong class="jq io">文本</strong>”。该测试检查请求体中是否没有提供文本，它应该产生一个错误并将控制传递给下一个<strong class="jq io">中间件</strong>(更多细节请参见<a class="ae nz" href="https://github.com/bewarusman/tdd-nodejs-api/blob/master/app.js" rel="noopener ugc nofollow" target="_blank"> app.js </a>中处理错误的代码)。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="a7f6" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">传递给测试的回调函数是<strong class="jq io"> async </strong>，因为在<strong class="jq io"> createTodo </strong>内部有调用承诺(异步代码)。现在，让我们运行测试，看看结果:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/2bdac9463a6816460a6174cd28bb8f43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJ2RUhpo3HYQ060a4XYMcw.png"/></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">First failing test</figcaption></figure><h1 id="faa4" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">编写满足测试的代码</h1><p id="e03c" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated"><strong class="jq io"> todo </strong>控制器内的函数<strong class="jq io"> createTodo </strong>应该满足测试。控制器函数检查是否没有提供文本，它将控制传递给下一个中间件，并传递一个错误。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="7bda" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">现在测试通过了:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/11c14419dd414293a5e613529c013774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*xZaj-LhDrYXVsCa5Pj5ijA.png"/></div></figure><h1 id="921d" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">重构</h1><p id="aafd" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">有很多关于重构的讨论和演讲。在这一步中，开发人员重构代码。结对编程也可以使用。</p><h1 id="5350" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">重复</h1><p id="492e" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">对每个测试用例重复这些步骤。</p><h1 id="96ac" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="b147" class="pw-post-body-paragraph jn jo in jq b jr lw jt ju jv lx jx jy ly lz kb kc ma mb kf kg mc md kj kk kl ig bi translated">测试驱动开发使程序员的生活变得更容易，但是需要付出额外的努力。</p><p id="a897" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">感谢您的评论和反馈。</p><p id="2912" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy ly ka kb kc ma ke kf kg mc ki kj kk kl ig bi translated">存储库可以在这里被克隆<a class="ae nz" href="https://github.com/bewarusman/tdd-nodejs-api" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>