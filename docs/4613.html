<html>
<head>
<title>More Gatsby i18n Tips And Tricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更多Gatsby i18n提示和技巧</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/more-gatsby-i18n-tips-and-tricks-4b71fc692136?source=collection_archive---------11-----------------------#2020-12-24">https://javascript.plainenglish.io/more-gatsby-i18n-tips-and-tricks-4b71fc692136?source=collection_archive---------11-----------------------#2020-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="213c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我那篇关于Gatsby网站国际化的文章的后续。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/534708e59d5abd7016612147e53797c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWteHjwMcqePrFNKqgq2ug.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@purejulia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">pure julia</a> on <a class="ae kv" href="https://unsplash.com/s/photos/world-map?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fa97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今年(2020年)早些时候，当我在封锁期间每天发布博客时，我与<a class="ae kv" href="https://www.gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank">盖茨比</a>分享了<a class="ae kv" href="https://medium.com/better-programming/internationalization-with-gatsby-ae3991c39e92" rel="noopener">我的解决方案</a>来国际化网站建设。</p><p id="3eec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">过去几天，我重新构建了DeckDeckGo的网站，目标是从我们的幻灯片编辑器中提取静态内容，并为我们平台的国际化奠定基础。</p><p id="3f03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">起初，我想尝试一种新方法，但没有找到任何对我有效的方法。这就是为什么我又一次用我自己的食谱和盖茨比一起开发了这个新网站。</p><p id="9703" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样做，我学到了一些新的技巧，也改进了，我希望，解决方案。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1783" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">元</h1><p id="7ad3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">本文是我2020年3月博文的后续:<a class="ae kv" href="https://medium.com/better-programming/internationalization-with-gatsby-ae3991c39e92" rel="noopener">与盖茨比一起国际化</a>。</p><p id="ae35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在的帖子是2020年12月用Gatsby v2、<a class="ae kv" href="https://github.com/angeloocana/gatsby-plugin-i18n" rel="noopener ugc nofollow" target="_blank"> gatsby-plugin-i18n </a> v1、<a class="ae kv" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a> v17和<a class="ae kv" href="https://github.com/formatjs/formatjs" rel="noopener ugc nofollow" target="_blank"> react-intl </a> v5写的。</p><p id="0a7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它的代码片段取自我们在GitHub 上的开源网站。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="166c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">JSON翻译文件</h1><p id="cdd4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在上一篇文章中，我依靠JavaScript文件来处理翻译(<code class="fe mw mx my mz b">i18n/en.js</code>)。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="00e0" class="ne ma iq mz b gy nf ng l nh ni">module.exports = {<br/>  hello: "Hello world",<br/>}</span></pre><p id="1ddd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不用说，我从来不喜欢这种方法。这就是为什么在我们的新网站中，我用JSON数据(<code class="fe mw mx my mz b">i18n/en.json</code>)代替了这些。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="786d" class="ne ma iq mz b gy nf ng l nh ni">{<br/>  "hello": "Hello world"<br/>}</span></pre><p id="116b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，这些JSON文件可以导入到它们各自的语言<code class="fe mw mx my mz b">Layout</code>组件中，就像我以前用JS import ( <code class="fe mw mx my mz b">layout/en.js</code>)一样。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="769a" class="ne ma iq mz b gy nf ng l nh ni">import React<strong class="mz ir"><em class="nj"> </em></strong>from 'react';<br/>import Layout from './layout';</span><span id="90fe" class="ne ma iq mz b gy nk ng l nh ni">// Previously with JS<br/>// import messages from '../../../assets/i18n/en';</span><span id="0e3a" class="ne ma iq mz b gy nk ng l nh ni">// New with JSON<br/>import messages from '../../i18n/en.json';<br/><br/>import '@formatjs/intl-pluralrules/locale-data/en';<br/><br/>export default (props) =&gt; (<br/>  &lt;Layout<br/>    {...props}<br/>    messages={messages}<br/>  /&gt;<br/>);</span></pre><p id="e81c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我没有对通用的<code class="fe mw mx my mz b">Layout</code>组件本身做任何修改。它仍然声明布局并将子元素包装在一个<code class="fe mw mx my mz b">IntlProvider</code>中。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="47ee" class="ne ma iq mz b gy nf ng l nh ni">import React<strong class="mz ir"><em class="nj"> </em></strong>from 'react';<br/>import {useStaticQuery, graphql} from 'gatsby';<br/><br/>import {IntlProvider} from 'react-intl';<br/>import '@formatjs/intl-pluralrules/polyfill';<br/><br/>import {getCurrentLangKey} from 'ptz-i18n';<br/><br/>export default ({children, location, messages}) =&gt; {<br/>  const data = useStaticQuery(graphql`<br/>    query SiteTitleQuery {<br/>      site {<br/>        siteMetadata {<br/>          title<br/>          languages {<br/>            defaultLangKey<br/>            langs<br/>          }<br/>        }<br/>      }<br/>    }<br/>  `);<br/><br/>  const {langs, defaultLangKey} = data.site.siteMetadata.languages;<br/>  const langKey = getCurrentLangKey(langs, defaultLangKey, location.pathname);<br/><br/>  return (<br/>    &lt;IntlProvider locale={langKey} messages={messages}&gt;<br/>      {children}<br/>    &lt;/IntlProvider&gt;<br/>  );<br/>};</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ce86" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">多个JSON数据</h1><p id="96e9" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我不知道这个习语在英语中是否存在，但是在法语中，with可以说“不要把所有的鸡蛋放在同一个篮子里”。事实上，我们可能不希望在一个文件中处理所有的翻译，而是将它们分成多个数据。</p><p id="fcde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">多亏了JSON，我能够很容易地解决这个需求。例如，我创建了两个独立的文件<code class="fe mw mx my mz b">i18n/index.json</code>和<code class="fe mw mx my mz b">i18n/common.json</code>。</p><p id="9dcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的是，我在翻译的关键字前添加了关键字，比如<code class="fe mw mx my mz b">index</code>或<code class="fe mw mx my mz b">common</code>，以避免重复的关键字。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="5cba" class="ne ma iq mz b gy nf ng l nh ni">// A new file i18n/index.json</span><span id="e39e" class="ne ma iq mz b gy nk ng l nh ni">{<br/>  "index.hello": "Hello"<br/>}</span><span id="b454" class="ne ma iq mz b gy nk ng l nh ni">// Another file <!-- -->i18n/common.json</span><span id="5dbf" class="ne ma iq mz b gy nk ng l nh ni">{<br/>  "common.hello": "Hello"<br/>}</span></pre><p id="2240" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于使用了析构对象，每个文件最终都可以导入并连接到相关语言布局的翻译列表中(本例中为<code class="fe mw mx my mz b">layout/en.js</code>)。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="d999" class="ne ma iq mz b gy nf ng l nh ni">import React<strong class="mz ir"><em class="nj"> </em></strong>from 'react';<br/>import Layout from './layout';<br/><br/>import index from '../../i18n/index.json';<br/>import common from '../../i18n/common.json';<br/><br/>import '@formatjs/intl-pluralrules/locale-data/en';<br/><br/>export default (props) =&gt; (<br/>  &lt;Layout<br/>    {...props}<br/>    messages={{<br/>      ...index,<br/>      ...common,<br/>    }}<br/>  /&gt;<br/>);</span></pre><p id="0ab8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这种方法，我们可以将我们的翻译分成尽可能多的独立文件，我们“只”需要导入和连接我们创建的每个新文件。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bb13" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">占位符、alt、aria-标签和标题</h1><p id="7ae5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在Daniel Yus chick<a class="ae kv" href="https://twitter.com/Yuschick" rel="noopener ugc nofollow" target="_blank">的一篇</a><a class="ae kv" href="https://medium.com/@Yuschick/translating-placeholder-alt-title-text-with-react-intl-a99d31f4194c" rel="noopener">文章</a>中，我发现react-intl现在公开了一个<code class="fe mw mx my mz b">useIntl</code>钩子，它在翻译占位符、alt、aria-label和标题时非常方便。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="6b90" class="ne ma iq mz b gy nf ng l nh ni">import React<strong class="mz ir"><em class="nj"> </em></strong>from 'react';<br/><br/>import {useIntl} from 'react-intl';<br/><br/>export const Contact = () =&gt; {<br/>  const intl = useIntl();<br/><br/>  return (<br/>    &lt;section&gt;<br/>      &lt;textarea <br/>           placeholder={intl.formatMessage({id: 'hello.world'})}<br/>           name="message"<br/>           rows={4} /&gt;</span><span id="0c13" class="ne ma iq mz b gy nk ng l nh ni">      &lt;img alt={intl.formatMessage({id: 'hello.yolo'})}<br/>           src="./yolo.png"/&gt;<br/>    &lt;/section&gt;<br/>  );<br/>};</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6ff9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">链接</h1><p id="50e3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">翻译有时包含HTML元素，如链接。像<code class="fe mw mx my mz b">The source code on &lt;a href="..."&gt;GitHub&lt;/a&gt; is super.</code>这样的句子要么需要多个翻译条目，要么需要一个方便的react-intl解决方案😉。</p><p id="4565" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个技巧可以通过在翻译中为链接引入一个“占位符”来实现(例如<code class="fe mw mx my mz b">{githubLink}</code>)。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="7e61" class="ne ma iq mz b gy nf ng l nh ni">{<br/>  "source.code": "The source code is available on {githubLink}."<br/>}</span></pre><p id="2bcd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当使用react-intl提供的<code class="fe mw mx my mz b">FormattedMessage</code>组件时，我们可以用有效链接(HTML元素)解析或替换这个“占位符”。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="af40" class="ne ma iq mz b gy nf ng l nh ni">&lt;FormattedMessage<br/>  id="source.code"<br/>  values={{<br/>    githubLink: (<br/>      &lt;a href="https://github.com/deckgo/deckdeckgo"&gt;<br/>        GitHub<br/>      &lt;/a&gt;<br/>    ),<br/>  }}<br/>/&gt;</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5529" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">覆盖主Index.js</h1><p id="6b26" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">尽管如我在上一篇文章中所展示的，我将网站配置为将根路径查询路由到默认语言，但我注意到用<code class="fe mw mx my mz b">index.js</code>文件部署网站是安全的(r)。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="d132" class="ne ma iq mz b gy nf ng l nh ni">// ./gatsby-browser.js<br/><br/>exports.onClientEntry = () =&gt; {<br/>  if (window.location.pathname === '/') {<br/>    window.location.pathname = `/en`;<br/>  }<br/>};</span></pre><p id="1a23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我不想手动维护多个条目文件，所以我创建了一个预构建脚本，它在构建时将<code class="fe mw mx my mz b">index.en.js</code>(我的主索引文件)复制到<code class="fe mw mx my mz b">index.js</code>。</p><p id="42f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，该脚本还在目标文件的开头添加了一个注释，这样我就会记住我不应该手动编辑它😅。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="bcec" class="ne ma iq mz b gy nf ng l nh ni">// copy-index.js<br/><br/>const fs = require('fs');<br/><br/>try {<br/>  fs.copyFileSync('./src/pages/index.en.js', './src/pages/index.js');<br/><br/>  const content = fs.readFileSync('./src/pages/index.js');<br/><br/>  const comment = '/**\n * Do not modify! This file is overwritten by index.en.js at build time.\n */\n';<br/><br/>  fs.writeFileSync('./src/pages/index.js', comment + content);<br/><br/>  console.log(`index.en.js copied to index.js!`);<br/>} catch (err) {<br/>  console.error(`Cannot copy index.en.js`);<br/>}</span></pre><p id="a13c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我通过向我的<code class="fe mw mx my mz b">package.json</code>添加一个<code class="fe mw mx my mz b">prebuild</code>目标来设置这个脚本。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="22e7" class="ne ma iq mz b gy nf ng l nh ni">"scripts": {<br/>  "prebuild": "node ./copy-index.js",<br/>  "develop": "gatsby develop",<br/>  "start": "gatsby develop",<br/>  "build": "gatsby build",<br/>  "serve": "gatsby serve",<br/>  "clean": "gatsby clean"<br/>},</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e3b8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">摘要</h1><p id="a282" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">可能有一些其他更简单的解决方案来翻译Gatsby网站，但是，由于已经使用了我自己的食谱两次，我对结果和开发者体验都很满意。也就是说，下次我可能会再次寻找另一个解决方案，之后，永不停止学习是开发的乐趣所在。</p><p id="0f10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">圣诞快乐🎄。到无限和更远的地方！</p><p id="98cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大卫</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="6e40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在推特上联系我，为什么不试着为你的下一次演讲联系T2。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://deckdeckgo.com"><div class="gh gi nl"><img src="../Images/5dbec9f9a8254785825ab4834158cc35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AyONWRtM0ozmMT0v.png"/></div></a></figure></div></div>    
</body>
</html>