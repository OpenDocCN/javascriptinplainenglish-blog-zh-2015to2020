<html>
<head>
<title>Create Choropleth Map Data Visualization with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript创建Choropleth地图数据可视化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-choropleth-map-data-visualization-with-javascript-8788c98d46e5?source=collection_archive---------12-----------------------#2020-05-06">https://javascript.plainenglish.io/create-choropleth-map-data-visualization-with-javascript-8788c98d46e5?source=collection_archive---------12-----------------------#2020-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/66d957f7783ea31e1d6408507b38c4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SM--4CVwn3p_EbhI23jbwQ.png"/></div></div></figure><blockquote class="jy jz ka"><p id="c1b5" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">查看更方便的代码片段，并嵌入互动图表代替静态图片，</strong> <a class="ae la" href="https://www.anychart.com/blog/2020/05/06/javascript-choropleth-map-tutorial/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">查看原JS choropleth地图文章</strong> </a> <strong class="ke ir">。</strong></p></blockquote><p id="3a95" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如今，你可以在各种网页上看到<a class="ae la" href="https://www.anychart.com/chartopedia/chart-type/choropleth-map/" rel="noopener ugc nofollow" target="_blank"> choropleth地图</a>,并用于各种主题。您是否想知道这样的数据可视化是如何构建的？你有兴趣自己做吗？如果是这样，请继续阅读这篇JS图表教程，我将向您展示如何轻松地从头开始创建一个交互式JavaScript choropleth map。</p><p id="691b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">HTML5和JS的基础知识总是有帮助的，但即使你是这方面的初学者，理解这些<strong class="ke ir">四个简单的步骤</strong>你就能很快得到一个好看的跨平台交互式choropleth地图数据可视化给你的app或网站！</p><p id="0b42" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">到底什么是choropleth地图？当你分解这个单词时，你会看到<em class="kd">choro-</em>(“<em class="kd">choros</em>”)的意思是“<em class="kd">地区</em>”，<em class="kd">pleth-</em>(“<em class="kd">plethos</em>”)的意思是“<em class="kd">众多</em>”确切地说，这些地图用于可视化与多个地理区域相关的统计数据。根据给定数据的值，每个区域都有不同的颜色或阴影，这样就可以很容易地掌握一个地区的测量值是如何变化的。</p><p id="c2a0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在这个JS制图教程中，我将使用开放的<strong class="ke ir">新冠肺炎数据</strong>来显示世界各国确诊病例和死亡病例的分布。我将从一个基本的choropleth图开始，它将以图形方式表示确诊病例。然后我会添加一个图例，自定义工具提示，并添加气泡来可视化死亡人数。</p><p id="5565" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们开始吧！</p><h1 id="6309" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">如何创建JavaScript Choropleth地图</h1><p id="498e" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">通常，构建基于JavaScript的图表或地图需要四个基本要素:</p><ol class=""><li id="ab77" class="mh mi iq ke b kf kg kj kk lb mj lc mk ld ml kz mm mn mo mp bi translated">为您的图表创建HTML页面。</li><li id="dc60" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz mm mn mo mp bi translated">添加必要的JavaScript文件。</li><li id="afa0" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz mm mn mo mp bi translated">准备要可视化的数据。</li><li id="8d2d" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz mm mn mo mp bi translated">为图表编写JS代码。</li></ol><p id="68a7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在，让我们详细看看每一步。这是一张choropleth地图，它将是本教程第一部分的最终输出:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/a7f9b5b161f66c2079f21ca2af957cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FtEGhFwlOZsRtN0d.png"/></div></div></figure><h1 id="9f10" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤1:为地图创建HTML页面</h1><p id="8f0f" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">您需要做的第一件事是创建一个基本的HTML页面。给它一个标题并创建一个HTML块元素(例如，<code class="fe na nb nc nd b">&lt;div&gt;)</code>来放置您的地图图表。为了在后面的代码中识别这个<code class="fe na nb nc nd b">&lt;div&gt;</code>，您还应该给它一个您选择的id属性。这里，我使用了“容器”这个值。</p><p id="ef26" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">所以你的页面看起来像这样:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="a5d6" class="ni lf iq nd b gy nj nk l nl nm">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="2d8e" class="ni lf iq nd b gy nn nk l nl nm">&lt;head&gt;<br/>  &lt;title&gt;Choropleth Map&lt;/title&gt;<br/>  &lt;style&gt;<br/>    html,<br/>    body,<br/>    #container {<br/>      width: 100%;<br/>      height: 100%;<br/>      margin: 0;<br/>      padding: 0;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="1807" class="ni lf iq nd b gy nn nk l nl nm">&lt;body&gt;<br/>  &lt;div id="container"&gt;&lt;/div&gt;<br/>&lt;/body&gt;</span><span id="1f2e" class="ni lf iq nd b gy nn nk l nl nm">&lt;/html&gt;</span></pre><p id="94d3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">注意，可以在<code class="fe na nb nc nd b">&lt;style&gt;</code>块中使用CSS规则来定义如何放置即将到来的JavaScript choropleth映射。在这种情况下，在<code class="fe na nb nc nd b">width</code>和<code class="fe na nb nc nd b">height</code>参数中使用“100%”将使可视化占据整个页面。</p><h1 id="503d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第二步。添加必要的JavaScript文件</h1><p id="d1be" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">其次，您应该转到<code class="fe na nb nc nd b">&lt;head&gt;</code>部分，并参考您将要使用的所有合适的JS脚本。</p><p id="ad32" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">为了根据本教程创建一个choropleth地图，我将使用AnyChart的<a class="ae la" href="https://www.anychart.com/products/anymap/overview/" rel="noopener ugc nofollow" target="_blank"> AnyMap JS库</a>，顾名思义，它是专门为生成地图而设计的。JavaScript图表库现在非常流行；它们提供了开箱即用的常用功能，使开发过程更简单、更快速。这个特定的库是轻量级的、灵活的、易于上手的，特别是由于一个精心编写的<a class="ae la" href="https://docs.anychart.com/Maps/Quick_Start" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae la" href="https://www.anychart.com/products/anymap/gallery/" rel="noopener ugc nofollow" target="_blank">地图库中的大量样本</a>。</p><p id="7cd1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在本教程中，我将使用<a class="ae la" href="https://www.anychart.com/download/cdn/" rel="noopener ugc nofollow" target="_blank"> CDN </a>，但是请记住，如果您愿意，您可以<a class="ae la" href="https://www.anychart.com/download/" rel="noopener ugc nofollow" target="_blank">下载</a>脚本。</p><p id="36f2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">对于我心目中的choropleth地图，我需要以下<a class="ae la" href="https://docs.anychart.com/Quick_Start/Modules" rel="noopener ugc nofollow" target="_blank">模块</a>:</p><ul class=""><li id="5715" class="mh mi iq ke b kf kg kj kk lb mj lc mk ld ml kz no mn mo mp bi translated"><strong class="ke ir">核心</strong>，这是使用任何其他模块所需的基本模块。</li><li id="e6b7" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated"><strong class="ke ir">地理地图</strong>，包含创建地理地图图表的必要信息，以及</li><li id="b93d" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated"><strong class="ke ir">地理数据</strong>，包含关于地理位置的信息。</li></ul><p id="70e2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">此外，我将使用Proj4js，这是一个免费的开源JavaScript库，可以将点坐标转换为地理坐标。</p><p id="e4d5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">以下是这一部分的HTML代码:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="f7db" class="ni lf iq nd b gy nj nk l nl nm">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="1c32" class="ni lf iq nd b gy nn nk l nl nm">&lt;head&gt;<br/>  &lt;title&gt;Choropleth Map&lt;/title&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-core.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-map.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/geodata/custom/world/world.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;style&gt;<br/>    html,<br/>    body,<br/>    #container {<br/>      width: 100%;<br/>      height: 100%;<br/>      margin: 0;<br/>      padding: 0;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="ccd2" class="ni lf iq nd b gy nn nk l nl nm">&lt;body&gt;<br/>  &lt;div id="container"&gt;&lt;/div&gt;<br/>  &lt;script&gt;<br/><strong class="nd ir"><em class="kd">    // The choropleth map code will be written here</em></strong><br/>  &lt;/script&gt;<br/>&lt;/body&gt;</span><span id="ce03" class="ni lf iq nd b gy nn nk l nl nm">&lt;/html&gt;</span></pre><h1 id="918d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤3:准备想要可视化的数据</h1><h2 id="3365" class="ni lf iq bd lg np nq dn lk nr ns dp lo lb nt nu ls lc nv nw lw ld nx ny ma nz bi translated">加载数据</h2><p id="5bfc" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">第三步，添加数据。根据新冠肺炎疫情，我将使用欧洲疾病预防和控制中心(<a class="ae la" href="https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographic-distribution-covid-19-cases-worldwide" rel="noopener ugc nofollow" target="_blank"> ECDC </a>)的数据创建一个JavaScript choropleth地图，该地图将可视化当前世界各地的情况。我已经下载了JSON版本，你可以在这里<a class="ae la" href="https://static.anychart.com/git-storage/word-press/data/choropleth-map-tutorial/data.json" rel="noopener ugc nofollow" target="_blank">找到</a>(数据截至4月14日)。</p><p id="3968" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">使用AnyChart的<a class="ae la" href="https://docs.anychart.com/Working_with_Data/Data_Adapter/Overview" rel="noopener ugc nofollow" target="_blank">数据适配器</a>助手模块可以很容易地从JSON文件加载数据，该模块应该添加到<code class="fe na nb nc nd b">&lt;head&gt;</code>部分:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="0d78" class="ni lf iq nd b gy nj nk l nl nm">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="cdae" class="ni lf iq nd b gy nn nk l nl nm">&lt;head&gt;<br/>  &lt;title&gt;Choropleth Map&lt;/title&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-core.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-map.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/geodata/custom/world/world.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-data-adapter.min.js"&gt;&lt;/script&gt;<br/>  &lt;style&gt;<br/>    html,<br/>    body,<br/>    #container {<br/>      width: 100%;<br/>      height: 100%;<br/>      margin: 0;<br/>      padding: 0;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="684a" class="ni lf iq nd b gy nn nk l nl nm">&lt;body&gt;<br/>  &lt;div id="container"&gt;&lt;/div&gt;<br/>  &lt;script&gt;<br/><strong class="nd ir"><em class="kd">    // The choropleth map code will be written here<br/></em></strong>  &lt;/script&gt;<br/>&lt;/body&gt;</span><span id="80ac" class="ni lf iq nd b gy nn nk l nl nm">&lt;/html&gt;</span></pre><p id="f34e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在您可以使用数据适配器提供的<a class="ae la" href="https://api.anychart.com/anychart.data#loadJsonFile" rel="noopener ugc nofollow" target="_blank"> loadJsonFile </a>方法来加载JSON。</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="0e5b" class="ni lf iq nd b gy nj nk l nl nm">anychart.data.loadJsonFile ("https://static.anychart.com/git-storage/word-press/data/choropleth-map-tutorial/data.json", function (data) {</span><span id="8ecf" class="ni lf iq nd b gy nn nk l nl nm">});</span></pre><h2 id="c168" class="ni lf iq bd lg np nq dn lk nr ns dp lo lb nt nu ls lc nv nw lw ld nx ny ma nz bi translated">结构化数据</h2><p id="d1b0" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">您刚刚加载的JSON数据包含每个国家每天的数据。</p><p id="7e44" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这里你需要做两件事:</p><ul class=""><li id="3ded" class="mh mi iq ke b kf kg kj kk lb mj lc mk ld ml kz no mn mo mp bi translated">计算每个国家所有确诊病例的总和。</li><li id="70fa" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated">以任何图表都能识别的格式组织数据。具体来说，我想创建一个包含区域id和值的数组。</li></ul><p id="a32f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">要实现上述内容，您需要编写一些代码。下面是我将用来计算和组织数据的方法:</p><p id="3208" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我将读取JSON数据并计算每个国家的确诊病例总数。一旦我处理完一个国家，我会将这些信息传递到一个我命名为“data”的数组中，然后继续处理下一个国家。</p><p id="421e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">该阵列将使用:</p><ul class=""><li id="dda5" class="mh mi iq ke b kf kg kj kk lb mj lc mk ld ml kz no mn mo mp bi translated"><code class="fe na nb nc nd b">id</code>:国家的地理标识符</li><li id="d553" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated"><code class="fe na nb nc nd b">value</code>:全国确诊病例总数</li><li id="47be" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated"><code class="fe na nb nc nd b">title</code>:国家的名称</li></ul><p id="6c08" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这一部分的代码如下:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="8e80" class="ni lf iq nd b gy nj nk l nl nm">anychart.data.loadJsonFile ("https://static.anychart.com/git-storage/word-press/data/choropleth-map-tutorial/data.json", function (data) {</span><span id="e0cd" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Variables<br/>  // go into the records section of the data</em></strong><br/>  var geoData = data.records</span><span id="461f" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // sum of all cases per country</em></strong><br/>  var sumCases = 0;</span><span id="03bd" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // convert cases to numbers</em></strong><br/>  var numC;</span><span id="8841" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // create a new array with the resulting data</em></strong><br/>  var data = [];</span><span id="b950" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Go through the initial data</em></strong><br/>  for (var i = 0; i &lt; geoData.length; i++) {<br/><strong class="nd ir"><em class="kd">    // convert strings to numbers and save them to new variables<br/></em></strong>    numC = parseInt(geoData[i].cases);</span><span id="bc89" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // check if we are in the same country by comparing the geoId. </em></strong><br/><strong class="nd ir"><em class="kd">    // if the country is the same add the cases to the appropriate variables<br/></em></strong>    if ((geoData[i + 1]) != null &amp;&amp; (geoData[i].geoId == geoData[i + 1].geoId)) {<br/>    sumCases = sumCases + numC;<br/>  }<br/>    else {<br/>  <strong class="nd ir"><em class="kd">    // add last day cases of the same country</em></strong><br/>      sumCases = sumCases + numC;</span><span id="e630" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">      // insert the resulting data in the array using the AnyChart keywords <br/>  </em></strong>    data.push({ id: geoData[i].geoId, value: sumCases, title: geoData[i].countriesAndTerritories })</span><span id="d3ad" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">      // reset the variables to start over</em></strong><br/>      sumCases = 0;<br/>                        <br/>    }<br/>  };<br/>});</span></pre><h2 id="618c" class="ni lf iq bd lg np nq dn lk nr ns dp lo lb nt nu ls lc nv nw lw ld nx ny ma nz bi translated">映射数据</h2><p id="756f" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">这一步骤的最后一部分是将生成的数据与地理地图连接起来。只需添加下面两行代码，就可以完成了:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="9b2b" class="ni lf iq nd b gy nj nk l nl nm">var chart = anychart.map(data);<br/>chart.geoData(anychart.maps.world);</span></pre><h1 id="833d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤4:为图表编写JS代码</h1><p id="b293" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">最后写一些JavaScript代码来开发JS choropleth地图本身！</p><p id="ee2a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">记住所有的东西都应该放在<code class="fe na nb nc nd b">&lt;script&gt;</code>标签里面。您需要将代码包含在页面准备就绪时执行的<code class="fe na nb nc nd b">anychart.onDocumentReady</code>函数中。</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="cf23" class="ni lf iq nd b gy nj nk l nl nm">&lt;script&gt;<br/>  anychart.onDocumentReady(function () {<br/><strong class="nd ir"><em class="kd">    // The choropleth map code will be written here<br/></em></strong>  });<br/>&lt;/script&gt;</span></pre><p id="2ba2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">数据需要放在这个函数中，所以让我们把第3步的代码放在这里，首先:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="d537" class="ni lf iq nd b gy nj nk l nl nm">&lt;script&gt;<br/>anychart.onDocumentReady(function () {<br/><strong class="nd ir"><em class="kd">  // The choropleth map code will be written here<br/></em></strong>  anychart.data.loadJsonFile ("https://static.anychart.com/git-storage/word-press/data/choropleth-map-tutorial/data.json", function (data) {</span><span id="1216" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Variables<br/>  // go into the records section of the data</em></strong><br/>  var geoData = data.records</span><span id="f336" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // sum of all cases per country</em></strong><br/>  var sumCases = 0;</span><span id="f93f" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // convert cases to numbers</em></strong><br/>  var numC;</span><span id="47e7" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // create a new array with the resulting data</em></strong><br/>  var data = [];</span><span id="a144" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Go through the initial data</em></strong><br/>  for (var i = 0; i &lt; geoData.length; i++) {<br/><strong class="nd ir"><em class="kd">    // convert strings to numbers and save them to new variables</em></strong><br/>    numC = parseInt(geoData[i].cases);</span><span id="0961" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // check if we are in the same country by comparing the geoId.</em></strong><br/><strong class="nd ir"><em class="kd">    // if the country is the same add the cases to the appropriate variables<br/>  </em></strong>  if ((geoData[i + 1]) != null &amp;&amp; (geoData[i].geoId == geoData[i + 1].geoId)) {<br/>      sumCases = sumCases + numC;<br/>    }<br/>    else {</span><span id="607b" class="ni lf iq nd b gy nn nk l nl nm">  <strong class="nd ir"><em class="kd">    // add last day cases of the same country</em></strong><br/>      sumCases = sumCases + numC;</span><span id="40a9" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">      // insert the resulting data in the array using the AnyChart keywords <br/>  </em></strong>    data.push({ id: geoData[i].geoId, value: sumCases, title: geoData[i].countriesAndTerritories })</span><span id="d5aa" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">      // reset the variables to start over</em></strong><br/>      sumCases = 0;</span><span id="0b0f" class="ni lf iq nd b gy nn nk l nl nm">    }<br/>  };</span><span id="de76" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // connect the data with the map</em></strong><br/>  var chart = anychart.map(data);<br/>  chart.geoData(anychart.maps.world);</span><span id="9ba5" class="ni lf iq nd b gy nn nk l nl nm">});<br/>&lt;/script&gt;</span></pre><p id="92d0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">最后，让我们设置其他所有内容，根据确诊病例总数的值给每个国家着色。首先，我将指定图表类型，创建系列，并添加适当的标题。其次，我将创建一个<a class="ae la" href="https://docs.anychart.com/Maps/Scales" rel="noopener ugc nofollow" target="_blank">色标</a>，并将其应用于图表。看:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="9248" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// specify the chart type and set the series <br/></em></strong>var series = chart.choropleth(data);<br/>        <br/><strong class="nd ir"><em class="kd">// set the chart title</em></strong><br/>chart.title("COVID-19 Global Cases");</span><span id="034a" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// color scale ranges<br/></em></strong>ocs = anychart.scales.ordinalColor([<br/>  { less: 99 },<br/>  { from: 100, to: 999 },<br/>  { from: 1000, to: 9999 },<br/>  { from: 10000, to: 29999 },<br/>  { from: 30000, to: 39000 },<br/>  { from: 40000, to: 59000 },<br/>  { from: 60000, to: 99999 },<br/>  { greater: 100000 }<br/>]);<br/>        <br/><strong class="nd ir"><em class="kd">// set scale colors<br/></em></strong>ocs.colors(["rgb(252,245,245)", "rgb(241,219,216)","rgb(229,190,185)", "rgb(211,152,145)", "rgb(192,117,109)", "rgb(178,93,86)", "rgb(152,50,48)", "rgb(150,33,31)"]);</span><span id="081f" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// tell the series what to use as a colorRange (colorScale)<br/></em></strong>series.colorScale(ocs);</span></pre><p id="ff3c" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">然后，命令绘制地图图表:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="0857" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// set the container id<br/></em></strong>chart.container('container');</span><span id="63e2" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// draw the chart</em></strong><br/>chart.draw();</span></pre><p id="014f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">结果如下:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/bcafc3f1c7308f619e1106c54785f813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLtxlZibfDOzq4PMVBTE-Q.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Basic JS choropleth map</figcaption></figure><p id="43f0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">从<a class="ae la" href="https://playground.anychart.com/efdxRDjm/" rel="noopener ugc nofollow" target="_blank"> AnyChart游乐场</a>嵌入的JS choropleth地图，给出了新冠肺炎如何影响每个国家的简明可视化。您可以将鼠标悬停在各个区域上，查看每个国家的确诊病例名称和数量。这样的地理数据可视化，每个人都能轻松读懂。</p><p id="53c1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">下面是使用JavaScript/HTML5构建的choropleth地图的完整代码:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="a68b" class="ni lf iq nd b gy nj nk l nl nm">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="fef2" class="ni lf iq nd b gy nn nk l nl nm">&lt;head&gt;<br/>  &lt;title&gt;Choropleth Map&lt;/title&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-core.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-map.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/geodata/custom/world/world.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-data-adapter.min.js"&gt;&lt;/script&gt;</span><span id="db83" class="ni lf iq nd b gy nn nk l nl nm">&lt;style&gt;&gt;<br/>    html,<br/>    body,<br/>    #container {<br/>      width: 100%;<br/>      height: 100%;<br/>      margin: 0;<br/>      padding: 0;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="9dc9" class="ni lf iq nd b gy nn nk l nl nm">&lt;body&gt;<br/>  &lt;div id="container"&gt;&lt;/div&gt;<br/>  &lt;script&gt;</span><span id="ad19" class="ni lf iq nd b gy nn nk l nl nm">anychart.onDocumentReady(function () {</span><span id="f8e2" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// load the data</em><br/></strong>anychart.data.loadJsonFile("https://static.anychart.com/git-storage/word-press/data/choropleth-map-tutorial/data.json", function (data) {</span><span id="cec9" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Variables</em><br/>  <em class="kd">// go into the records section of the data<br/>  </em></strong>var geoData = data.records</span><span id="e1d5" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // sum of all cases per country</em><br/>  </strong>var sumCases = 0;</span><span id="5b06" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // convert cases to numbers</em><br/>  </strong>var numC;</span><span id="91c7" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // create a new array with the resulting data</em></strong><br/>  var data = [];</span><span id="a756" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Go through the initial data</em></strong><br/>  for (var i = 0; i &lt; geoData.length; i++) {<br/>    <strong class="nd ir"><em class="kd">// convert strings to numbers and save them to new variables<br/>    </em></strong>numC = parseInt(geoData[i].cases);</span><span id="c976" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // check if we are in the same country by comparing the geoId. </em></strong><br/>    <strong class="nd ir"><em class="kd">// if the country is the same add the cases to the appropriate variables<br/>    </em></strong>if ((geoData[i + 1]) != null &amp;&amp; (geoData[i].geoId == geoData[i + 1].geoId)) {<br/>      sumCases = sumCases + numC;<br/>    }<br/>    else {</span><span id="770e" class="ni lf iq nd b gy nn nk l nl nm">      <strong class="nd ir"><em class="kd">// add last day cases of the same country</em></strong><br/>      sumCases = sumCases + numC;</span><span id="fd96" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">      // insert the resulting data in the array using the AnyChart keywords <br/>      </em></strong>data.push({ id: geoData[i].geoId, value: sumCases, title: geoData[i].countriesAndTerritories })</span><span id="b166" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">      // reset the variables to start over</em></strong><br/>      sumCases = 0;</span><span id="9985" class="ni lf iq nd b gy nn nk l nl nm">    }<br/>  };</span><span id="53a7" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // connect the data with the map</em></strong><br/>  var chart = anychart.map(data);<br/>  chart.geoData(anychart.maps.world);</span><span id="b6e1" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // specify the chart type and set the series </em></strong><br/>  var series = chart.choropleth(data);</span><span id="36e2" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the chart title</em></strong><br/>  chart.title("COVID-19 Global Cases");</span><span id="b841" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // color scale ranges</em></strong><br/>  ocs = anychart.scales.ordinalColor([<br/>    { less: 99 },<br/>    { from: 100, to: 999 },<br/>    { from: 1000, to: 9999 },<br/>    { from: 10000, to: 29999 },<br/>    { from: 30000, to: 39000 },<br/>    { from: 40000, to: 59000 },<br/>    { from: 60000, to: 99999 },<br/>    { greater: 100000 }<br/>  ]);</span><span id="b770" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set scale colors</em></strong><br/>  ocs.colors(["rgb(252,245,245)", "rgb(241,219,216)", "rgb(229,190,185)", "rgb(211,152,145)", "rgb(192,117,109)", "rgb(178,93,86)", "rgb(152,50,48)", "rgb(150,33,31)"]);</span><span id="28ec" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // tell the series what to use as a colorRange (colorScale)</em></strong><br/>  series.colorScale(ocs);</span><span id="1846" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the container id</em></strong><br/>  chart.container('container');<br/>        <br/>  <strong class="nd ir"><em class="kd">// draw the chart</em></strong><br/>  chart.draw();<br/>});</span><span id="d2cb" class="ni lf iq nd b gy nn nk l nl nm">});<br/>  &lt;/script&gt;<br/>&lt;/body&gt;</span><span id="1fb6" class="ni lf iq nd b gy nn nk l nl nm">&lt;/html&gt;</span></pre><h1 id="1885" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">JS Choropleth地图定制</h1><p id="0277" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">您已经有了一个出色的、功能齐全的JavaScript choropleth地图。但是如果你想改变一些东西或者增加一些功能呢？</p><p id="5c2e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">AnyChart是一个非常灵活的JS图表库。因此，您可以轻松地根据自己的需求进行修改。</p><p id="a639" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在，我将向您展示如何实施以下更改:</p><ul class=""><li id="6f0d" class="mh mi iq ke b kf kg kj kk lb mj lc mk ld ml kz no mn mo mp bi translated">向图表添加图例</li><li id="e170" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated">为死亡人数的图形表示添加气泡</li><li id="8fbe" class="mh mi iq ke b kf mq kj mr lb ms lc mt ld mu kz no mn mo mp bi translated">配置工具提示</li></ul><p id="f938" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">最终，我会得到下面这张图:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/3eee58af1707f79a0b8fd4fe6cc09303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MDSWN-vh9d3jn1MF.png"/></div></div></figure><h1 id="c28e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">向图表添加图例</h1><p id="324f" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">作为数据可视化的一般规则，每次使用色标时，都应该在页面上的某个地方解释每种颜色代表什么</p><p id="a607" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">使用AnyChart，只需添加<code class="fe na nb nc nd b">chart.legend(true);</code>就可以创建一个图例。</p><p id="9d04" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在这种情况下，因为choropleth图只有一个系列，所以您需要在图例中表示相关的类别。</p><p id="ab9a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">下面是将图例添加到上面创建的JS choropleth地图的代码:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="3d21" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// enable the legend<br/></em></strong>chart.legend(true);</span><span id="0780" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// set the source mode of the legend<br/></em></strong>chart.legend().itemsSourceMode("categories");</span></pre><p id="2b1b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这是功能性的，但出于美观的原因，我希望图例出现在图表的右侧，并垂直对齐。为此，我将添加一些CSS规则:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="e497" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// enable the legend<br/></em></strong>chart.legend(true);</span><span id="4016" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// set the source mode of the legend and add styles<br/></em></strong>chart.legend()<br/>  .itemsSourceMode("categories") <br/>  .position('right')<br/>  .align('top')<br/>  .itemsLayout('vertical')<br/>  .padding(50, 0, 0, 20)<br/>  .paginator(false);</span></pre><p id="e25e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">以下是结果(可在<a class="ae la" href="https://playground.anychart.com/RjPyoq2W/" rel="noopener ugc nofollow" target="_blank"> AnyChart游乐场</a>获得完整代码):</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/12fb5290c36333a577ff56fd2a3a6d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DRKBTh6__cv-575ob2M2w.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">JS choropleth map with legend</figcaption></figure><h1 id="64bc" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">添加代表死亡人数的气泡</h1><p id="23de" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">受约翰·霍普金斯大学系统科学与工程中心(CSSE)创造的可视化技术<a class="ae la" href="https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6" rel="noopener ugc nofollow" target="_blank">的启发，我决定用气泡来描绘死亡人数。</a></p><p id="36bd" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">首先，每个国家的新冠肺炎死亡总数需要与新冠肺炎病例总数一起存储在数据中:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="c203" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// sum of all cases per country<br/></em></strong>var sumCases = 0;</span><span id="d8c7" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// sum of all deaths per country<br/></em></strong>var sumDeaths = 0;</span><span id="1709" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// convert cases and deaths to numbers<br/></em></strong>var numC;<br/>var numD;</span><span id="2668" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// create a new array with the resulting data<br/></em></strong>var data = [];</span><span id="2105" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// Go through the initial data<br/></em></strong>for (var i = 0; i &lt; geoData.length; i++) {<br/><strong class="nd ir"><em class="kd">  // convert strings to numbers and save them to new variables</em></strong><br/>  numC = parseInt(geoData[i].cases);<br/>  numD = parseInt(geoData[i].deaths);</span><span id="5cf8" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // check if we are in the same country by comparing the geoId</em></strong><br/><strong class="nd ir"><em class="kd">  // if the country is the same, add cases and deaths to the appropriate variables<br/></em></strong>  if ((geoData[i + 1]) != null &amp;&amp; (geoData[i].geoId == geoData[i + 1].geoId)) {<br/>    sumCases = sumCases + numC;<br/>    sumDeaths = sumDeaths + numD;<br/>  }<br/>  else {</span><span id="dfe0" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // add last day cases and deaths of the same country</em></strong><br/>    sumCases = sumCases + numC;<br/>    sumDeaths = sumDeaths + numD;</span><span id="0214" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // insert the resulting data in the array using the AnyChart keywords <br/></em></strong>    data.push({ id: geoData[i].geoId, value: sumCases, size: sumDeaths, title: geoData[i].countriesAndTerritories })</span><span id="f05d" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // reset the variables to start over</em></strong><br/>    sumCases = 0;<br/>    sumDeaths = 0;</span><span id="b12c" class="ni lf iq nd b gy nn nk l nl nm">  }<br/>};</span></pre><p id="d170" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">第二，在单独的数组中只存储至少有一人死亡的国家:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="b303" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// variable to store data that will be used for bubbles</em></strong><br/>var bubbleData=[];</span><span id="1048" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// store only the countries that have at least 1 death</em></strong><br/>for (var i=0; i&lt;data.length; i++) {<br/>  if (data[i].size&gt;0){<br/>    bubbleData.push(data[i]);<br/>  }<br/>};</span></pre><p id="dc2f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">然后，添加以下JS代码，在地图上的choropleth系列之上创建bubble系列。</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="d397" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// create a series for bubbles</em></strong><br/>var series_1 = chart.bubble(bubbleData);</span></pre><p id="d3b8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">看看下面的地图或者在<a class="ae la" href="https://playground.anychart.com/t0kTUilD/" rel="noopener ugc nofollow" target="_blank"> AnyChart游乐场</a>上:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/ce3eac9b85a2a904d816eba16d76d380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZ02KVDSMURk59APRInSVw.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">JS choropleth map with bubbles and legend</figcaption></figure><p id="431f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">自定义气泡的大小是一个好主意，这样它们就不会在图上占据太多空间。为此，使用AnyChart的<code class="fe na nb nc nd b">maxBubbleSize()</code>和<code class="fe na nb nc nd b">minBubbleSize()</code>函数。例如，像这样:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="7dcc" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// set the maximum size of the bubble<br/></em></strong>chart.maxBubbleSize(25);</span><span id="315b" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// set the minimum size of the bubble<br/></em></strong>chart.minBubbleSize(3);</span></pre><p id="2f9a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">接下来，您可以修改气泡的颜色和笔画，使它们与图表的其余部分更加一致:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="089b" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir">// set colors and stroke of bubbles<br/></strong>series_1.normal().fill("black", 0.3);<br/>series_1.hovered().fill("black", 0.1);<br/>series_1.selected().fill("black", 0.5);<br/>series_1.normal().stroke("rgb(150,33,31)");<br/>series_1.hovered().stroke("rgb(150,33,31)", 2);<br/>series_1.selected().stroke("rgb(150,33,31)", 4);</span></pre><p id="4a28" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">查看这些修改后的结果，如下图或在<a class="ae la" href="https://playground.anychart.com/JC0ZB65r/" rel="noopener ugc nofollow" target="_blank"> AnyChart游乐场</a>:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/a801dd3d27e865223854f3406c97293b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MC1yVMO6Zia8ItHaraW04Q.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Customized JS choropleth and bubble map in combination, with legend</figcaption></figure><h1 id="4fc1" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">配置choropleth地图工具提示</h1><p id="38cc" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">最后，让我们配置JS choropleth地图的工具提示，如果您将鼠标悬停在某个国家的领土上，它将显示有关总病例数的信息，如果您将鼠标悬停在气泡上，它将显示总死亡数的信息。</p><p id="bf97" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">实现这一点的代码如下所示:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="e730" class="ni lf iq nd b gy nj nk l nl nm"><strong class="nd ir"><em class="kd">// tooltip formatting<br/></em></strong>series.tooltip().format("Total Confirmed Cases: {%value}");<br/>series_1.tooltip().format("Total Deaths: {%size}");</span></pre><p id="f0de" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">看看结果——你也可以在<a class="ae la" href="https://playground.anychart.com/yxvsY5tD/" rel="noopener ugc nofollow" target="_blank"> AnyChart Playground </a>上找到完整的代码:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/7f239e9a1584cb4e5578fb239ab72796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWft-EuWyj1T62mPhovuMQ.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk">Final customized JS choropleth map with bubbles, legend, and improved tooltips</figcaption></figure><p id="7581" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">为以防万一，以下是用JavaScript编写的最终定制choropleth地图的代码，现在可以轻松嵌入到web、移动或独立项目中:</p><pre class="mw mx my mz gt ne nd nf ng aw nh bi"><span id="b313" class="ni lf iq nd b gy nj nk l nl nm">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="9bb7" class="ni lf iq nd b gy nn nk l nl nm">&lt;head&gt;<br/>  &lt;title&gt;Choropleth Map&lt;/title&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-core.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-map.min.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/geodata/custom/world/world.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js" type="text/javascript"&gt;&lt;/script&gt;<br/>  &lt;script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-data-adapter.min.js"&gt;&lt;/script&gt;</span><span id="05da" class="ni lf iq nd b gy nn nk l nl nm">&lt;style&gt;<br/>    html,<br/>    body,<br/>    #container {<br/>      width: 100%;<br/>      height: 100%;<br/>      margin: 0;<br/>      padding: 0;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="3000" class="ni lf iq nd b gy nn nk l nl nm">&lt;body&gt;<br/>  &lt;div id="container"&gt;&lt;/div&gt;<br/>  &lt;script&gt;</span><span id="09a5" class="ni lf iq nd b gy nn nk l nl nm">anychart.onDocumentReady(function () {</span><span id="e1e7" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">// load the data<br/></em></strong>anychart.data.loadJsonFile("https://static.anychart.com/git-storage/word-press/data/choropleth-map-tutorial/data.json", function (data) {</span><span id="c9fb" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Variables<br/>  // go into the records section of the data<br/>  </em></strong>var geoData = data.records</span><span id="f5ae" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // sum of all cases per country<br/>  </em></strong>var sumCases = 0;</span><span id="8062" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // sum of all deaths per country</em></strong><br/>  var sumDeaths = 0;</span><span id="d13d" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // convert cases and deaths to numbers<br/>  </em></strong>var numC;<br/>  var numD;</span><span id="9ef4" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // create a new array with the resulting data</em></strong><br/>  var data = [];</span><span id="5a7c" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // Go through the initial data</em></strong><br/>  for (var i = 0; i &lt; geoData.length; i++) {<br/>    <strong class="nd ir"><em class="kd">// convert strings to numbers and save them to new variables<br/>    </em></strong>numC = parseInt(geoData[i].cases);<br/>    numD = parseInt(geoData[i].deaths);</span><span id="6352" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // check if we are in the same country by comparing the geoId. </em></strong><br/>    <strong class="nd ir"><em class="kd">// if the country is the same add the cases and deaths to the appropriate variables<br/>    </em></strong>if ((geoData[i + 1]) != null &amp;&amp; (geoData[i].geoId == geoData[i + 1].geoId)) {<br/>      sumCases = sumCases + numC;<br/>      sumDeaths = sumDeaths + numD;<br/>    }<br/>    else {<br/>      <strong class="nd ir"><em class="kd">// add last day cases and deaths of the same country<br/>      </em></strong>sumCases = sumCases + numC;<br/>      sumDeaths = sumDeaths + numD;</span><span id="f223" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // insert the resulting data in the array using the AnyChart keywords <br/>    </em></strong>data.push({ id: geoData[i].geoId, value: sumCases, size: sumDeaths, title: geoData[i].countriesAndTerritories })</span><span id="0331" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">    // reset the variables to start over</em></strong><br/>    sumCases = 0;<br/>    sumDeaths = 0;</span><span id="805e" class="ni lf iq nd b gy nn nk l nl nm">    }<br/>  };</span><span id="ac10" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // connect the data with the map<br/>  </em></strong>var chart = anychart.map(data);<br/>  chart.geoData(anychart.maps.world);</span><span id="f0e5" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // specify the chart type and set the series </em></strong><br/>  var series = chart.choropleth(data);</span><span id="d50f" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // variable to store data that will be used for bubbles</em></strong><br/>  var bubbleData = [];</span><span id="7c55" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // store only the countries that have at least 1 death</em></strong><br/>  for (var i = 0; i &lt; data.length; i++) {<br/>    if (data[i].size &gt; 0) {<br/>      bubbleData.push(data[i]);<br/>    }<br/>  };</span><span id="30b5" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // create a series for bubbles</em></strong><br/>  var series_1 = chart.bubble(bubbleData);</span><span id="ea10" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the maximum size of the bubble</em></strong><br/>  chart.maxBubbleSize(25);</span><span id="76f2" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the minimum size of the bubble</em></strong><br/>  chart.minBubbleSize(3);</span><span id="8017" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set colors and stroke of bubbles</em></strong><br/>  series_1.normal().fill("black", 0.3);<br/>  series_1.hovered().fill("black", 0.1);<br/>  series_1.selected().fill("black", 0.5);<br/>  series_1.normal().stroke("rgb(150,33,31)");<br/>  series_1.hovered().stroke("rgb(150,33,31)", 2);<br/>  series_1.selected().stroke("rgb(150,33,31)", 4);</span><span id="7cc3" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the chart title<br/>  </em></strong>chart.title("COVID-19 Global Cases");</span><span id="0821" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // color scale ranges<br/>  </em></strong>ocs = anychart.scales.ordinalColor([<br/>    { less: 99 },<br/>    { from: 100, to: 999 },<br/>    { from: 1000, to: 9999 },<br/>    { from: 10000, to: 29999 },<br/>    { from: 30000, to: 39000 },<br/>    { from: 40000, to: 59000 },<br/>    { from: 60000, to: 99999 },<br/>    { greater: 100000 }<br/>  ]);</span><span id="33df" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set scale colors<br/>  </em></strong>ocs.colors(["rgb(252,245,245)", "rgb(241,219,216)", "rgb(229,190,185)", "rgb(211,152,145)", "rgb(192,117,109)", "rgb(178,93,86)", "rgb(152,50,48)", "rgb(150,33,31)"]);</span><span id="036d" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // tell the series what to use as a colorRange (colorScale)<br/>  </em></strong>series.colorScale(ocs);</span><span id="e7c8" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // enable the legend</em></strong><br/>  chart.legend(true);</span><span id="7fae" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the source mode of the legend and add styles<br/>  </em></strong>chart.legend()<br/>    .itemsSourceMode("categories")<br/>    .position('right')<br/>    .align('top')<br/>    .itemsLayout('vertical')<br/>    .padding(50, 0, 0, 20)<br/>    .paginator(false);</span><span id="cbef" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // tooltip formatting<br/>  </em></strong>series.tooltip().format("Total Confirmed Cases: {%value}");<br/>  series_1.tooltip().format("Total Deaths: {%size}");</span><span id="f6ed" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // set the container id<br/>  </em></strong>chart.container('container');</span><span id="e211" class="ni lf iq nd b gy nn nk l nl nm"><strong class="nd ir"><em class="kd">  // draw the chart<br/>  </em></strong>chart.draw();<br/>});</span><span id="079d" class="ni lf iq nd b gy nn nk l nl nm">});<br/>  &lt;/script&gt;<br/>&lt;/body&gt;</span><span id="ea20" class="ni lf iq nd b gy nn nk l nl nm">&lt;/html&gt;</span></pre><h1 id="2d9e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="285e" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">在本教程中，我向您详细展示了如何创建一个交互式JavaScript choropleth地图图表。这种数据可视化是一种非常有用的工具，可以快速分析统计数据。</p><p id="077e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">请随意使用本教程中构建的JS choropleth地图示例的代码。例如，接下来您是否想添加<a class="ae la" href="https://docs.anychart.com/Common_Settings/UI_Controls/Zoom_Controls" rel="noopener ugc nofollow" target="_blank">缩放UI控件</a>？您也可以访问<a class="ae la" href="https://www.anychart.com/products/anymap/gallery/Maps_Choropleth/" rel="noopener ugc nofollow" target="_blank"> AnyChart gallery </a>查看更多choropleth、bubble和其他JS地图的演示。</p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><p id="bc7a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><em class="kd">原载于2020年5月6日https://www.anychart.com</em><a class="ae la" href="https://www.anychart.com/blog/2020/05/06/javascript-choropleth-map-tutorial/" rel="noopener ugc nofollow" target="_blank"><em class="kd"/></a><em class="kd">。</em></p></div></div>    
</body>
</html>