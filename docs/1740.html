<html>
<head>
<title>Avoiding Import Issues in TypeScript Monorepos</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免TypeScript Monorepos中的导入问题</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/avoiding-import-issues-in-typescript-monorepos-d5a4b21f90ef?source=collection_archive---------3-----------------------#2020-04-18">https://javascript.plainenglish.io/avoiding-import-issues-in-typescript-monorepos-d5a4b21f90ef?source=collection_archive---------3-----------------------#2020-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5035" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你使用TypeScript monorepo时，例如使用awesome <a class="ae kl" href="https://nx.dev/" rel="noopener ugc nofollow" target="_blank"> Nrwl NX </a>(无论是Angular、React、Nest等)，你应该创建许多小的/可重用的库，并使你的应用程序尽可能地轻便，只需根据需要组合这些库。</p><p id="ae75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从类型脚本的角度来看，这些库通常是通过它们的公共API使用的，这些API可以通过<a class="ae kl" href="https://www.typescriptlang.org/docs/handbook/module-resolution.html#path-mapping" rel="noopener ugc nofollow" target="_blank">类型脚本路径映射</a>轻松导入，如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kr ks l"/></div></figure><p id="cd0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这些路径映射，我们可以很容易地从一个容易记住/容易键入的名称中导入内容，而不是使用长的相对路径。</p><p id="74ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，当结合一些林挺规则时，你可以在你的库/应用程序之间强制执行清晰的边界，并确保元素只导入/使用它们应该导入/使用的东西，而不是其他东西。例如，使用Nx，您可以确保库/应用程序只依赖于它们所使用的公共API，并且它们从不直接使用不应该被访问的内部元素。</p><p id="db5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这在一些主流平台和编程语言中是微不足道的，但在现代网络中却不是这样:)</p><p id="0965" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了路径映射，从其中一个库导入就变得简单了:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="418d" class="ky kz iq ku b gy la lb l lc ld">import { whatever } from "<a class="ae kl" href="http://twitter.com/didowi/common-api" rel="noopener ugc nofollow" target="_blank">@didowi/common-api</a>";</span></pre><p id="df84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">顺便说一句，如果你想知道，Didowi是我目前正在开发的产品的名字。希望我很快能写更多关于这个的东西；-)</p><p id="6448" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">路径映射也很棒，因为它们允许轻松地重新组织库内部，同时限制对API客户机的影响。</p><p id="7a9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“导入”方面的另一个优点是，您可以重新组合多个导入，而不是每个导入文件都有一行。干净利落。</p><p id="863a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止一切顺利，路径映射非常棒<em class="le"/>…</p><h1 id="12e0" class="lf kz iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">路径映射和IDE导入的问题</h1><p id="5d0f" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">不幸的是，没有什么是完美的。虽然路径映射非常酷，但是它们也会带来问题。</p><p id="8dcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我在上一篇文章中提到的，库中的元素不应该通过公共API桶、通过库路径映射甚至通过桶(因为桶是邪恶的，好吗？).改天我会写一篇关于为什么我现在认为TS桶文件是邪恶的文章…</p><p id="9c2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">通过库的路径映射/通过桶从同一个库中导入元素肯定会导致问题</strong>，无论是循环依赖(Webpack和其他人会对此大喊大叫)还是偷偷摸摸的问题，比如我在<a class="ae kl" href="https://medium.com/@dSebastien/fixing-the-cant-resolve-all-parameters-exception-with-angular-di-1091af1b080" rel="noopener">我的上一篇文章</a>中提到的问题。</p><p id="2b6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们能做些什么来避免这样的错误呢？</p><p id="e9e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，通过将搜索范围限制在一个库中，并确保在导入中找不到该路径映射的任何用法，您可以很容易地搜索和识别这样的无效导入。这将让您快速修复已经出现的任何问题，但不会阻止问题的出现。</p><h1 id="adda" class="lf kz iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">IntelliJ / WebStorm配置</h1><p id="fe5f" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在写这篇文章的时候，我在Jetbrains的问题跟踪器中偶然发现了这个问题:【https://youtrack.jetbrains.com/issue/WEB-44482<a class="ae kl" href="https://youtrack.jetbrains.com/issue/WEB-44482" rel="noopener ugc nofollow" target="_blank"/></p><p id="c4eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据它，在“<strong class="jp ir">设置|编辑器|代码样式| TypeScript，导入”</strong>到<strong class="jp ir">仅指定路径外的文件”</strong>下设置“<strong class="jp ir">使用来自tsconfig.json </strong>的路径映射”选项应该有帮助。</p><p id="9a02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这指示IntelliJ/WebStorm在导入中只对对应路径之外的文件<em class="le">使用路径映射。这意味着从同一个库中的元素导入一个库中的元素将使用相对导入来完成，这正是我们对于monorepo库所需要的。整洁！</em></p><p id="a8ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据我的测试，这非常有效，但有一点需要注意；似乎只有当当前文件是与之相关联的入口点(桶)文件的一部分时，IJ/网络风暴才认为当前文件在为路径映射指定的路径的“内部”。如果不是(例如，库内部)，那么IJ/网络风暴将使用桶导入。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="cf56" class="lf kz iq bd lg lh mo lj lk ll mp ln lo lp mq lr ls lt mr lv lw lx ms lz ma mb bi translated">结论</h1><p id="990d" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在本文中，我们已经看到了为什么TS路径映射对于monorepos/libraries来说是非常棒的，但是当它们被误用时也会带来问题。</p><p id="43fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ide经常在导入时出错，但我不能责怪他们，因为JS/TS生态系统真的很复杂。令人欣慰的是，我们还发现了隐藏在IntelliJ/WebStorm中的一个很酷的小设置，使IDE更智能地导入monorepo库。我认为使用VSCode也可以做到这一点，但是我还没有深入研究过。</p><p id="7777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止！</p><p id="67bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PS:如果你想了解大量关于TypeScript、Angular、React、Vue和其他很酷的主题的其他很酷的东西，那么不要犹豫<a class="ae kl" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">拿一本我的书</a>并订阅<a class="ae kl" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的时事通讯</a>！</p><h2 id="a2c7" class="ky kz iq bd lg mt mu dn lk mv mw dp lo jy mx my ls kc mz na lw kg nb nc ma nd bi translated"><strong class="ak">来自JavaScript的简单英语注释</strong></h2><p id="13ab" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们推出了三种新的出版物！通过以下方式表达对我们新出版物的热爱:<a class="ae kl" href="https://medium.com/ai-in-plain-english" rel="noopener"> <strong class="jp ir">通俗易懂的AI</strong></a>、<a class="ae kl" href="https://medium.com/ux-in-plain-english" rel="noopener">、<strong class="jp ir">通俗易懂的UX</strong>、</a>、<a class="ae kl" href="https://medium.com/python-in-plain-english" rel="noopener">、<strong class="jp ir">通俗易懂的Python</strong>、</a>、<strong class="jp ir">、</strong>——谢谢您，继续学习！</p><p id="8bb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也一直对帮助推广高质量内容感兴趣。如果您有一篇文章想提交给我们的任何出版物，请用您的Medium用户名在<a class="ae kl" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">submissions @ plain English . io</strong></a><strong class="jp ir"/>发邮件给我们，我们会将您添加为作家。另外，请告诉我们您想添加到哪个出版物中。</p></div></div>    
</body>
</html>