<html>
<head>
<title>JavaScript Unit Test Best Practices — Performance and Smoke Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript单元测试最佳实践—性能和冒烟测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-unit-test-best-practices-performance-and-smoke-tests-721307eb02e4?source=collection_archive---------12-----------------------#2020-08-31">https://javascript.plainenglish.io/javascript-unit-test-best-practices-performance-and-smoke-tests-721307eb02e4?source=collection_archive---------12-----------------------#2020-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/848fed273fd018a2a72db4988912c953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jqti2KEAdQ5d8Cf-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@srook?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tomasz Sroka</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6d72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试对于检查我们的应用程序如何工作非常有用。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看在编写JavaScript单元测试时应该遵循的一些最佳实践。</p><h1 id="d7d3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">观察内容是如何通过网络提供的</h1><p id="56f4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们想知道我们的内容通过网络提供给用户的速度有多快。</p><p id="6244" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了衡量这一点，我们可以使用类似pingdom或Lighthouse这样的工具。</p><p id="de1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们作为程序提供，我们可以将其添加到CI渠道中，以确保持续监控。</p><p id="6b77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们向我们展示了各种格式的测试结果。</p><h1 id="ad84" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">存根片状和缓慢的资源，如后端API</h1><p id="2981" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们运行前端测试，那么像后端API这样的慢速资源应该被剔除。</p><p id="a61c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以尽可能快地运行我们的前端测试。</p><p id="b196" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用不同的库来存根它们。</p><p id="6b33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我们可以模拟各种API行为，以便为我们的前端提供所需的数据。</p><p id="5234" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有存根数据，测试将会缓慢而可靠。</p><p id="e339" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以编写这样一个测试:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e847" class="mn lc iq mj b gy mo mp l mq mr">test("show message when product doesn't exist", () =&gt; {<br/>  nock("api")<br/>    .get(`/products`)<br/>    .reply(404);</span><span id="7d15" class="mn lc iq mj b gy ms mp l mq mr">  const { getByTestId } = render(&lt;ProductsList /&gt;);<br/>  expect(getByTestId("no-products-message")).toBeTruthy();<br/>});</span></pre><p id="af68" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">nock</code>存根API调用，这样我们就不必进行实际的API调用。</p><h1 id="c24f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">进行一些跨整个系统的端到端测试</h1><p id="b132" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该只有几个横跨整个系统的端到端测试。</p><p id="8966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们很慢，所以应该保留下来用于测试我们系统中最关键的部分。</p><p id="0100" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">他们模拟真实的用户交互，所以我们知道他们在用户交互中的行为是正确的。</p><p id="ea23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们也很脆，所以很难运行。</p><p id="f243" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，他们应该在类似生产的环境中运行，这样他们就可以测试一些真实的东西。</p><h1 id="86c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通过重用登录凭证加速E2E测试</h1><p id="6016" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该登录一次，然后做所有的测试。</p><p id="4de8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">登录需要额外的时间，所以我们应该把它留到开始。</p><p id="6dcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以将登录代码放入一个before all钩子中，以便它在所有测试运行之前运行。</p><p id="f0c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何与用户相关的记录都应该与测试一起生成。</p><p id="ebb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用Cypress保存auth令牌，例如:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c728" class="mn lc iq mj b gy mo mp l mq mr">let authenticationToken;</span><span id="d816" class="mn lc iq mj b gy ms mp l mq mr">before(() =&gt; {<br/>  cy.request('POST', 'http://localhost:8888/login', {<br/>    username: Cypress.env('username'),<br/>    password: Cypress.env('password'),<br/>  })<br/>  .its('body')<br/>  .then((res) =&gt; {<br/>    authenticationToken = res.token;<br/>  })<br/>})</span><span id="13f3" class="mn lc iq mj b gy ms mp l mq mr">beforeEach(setUser =&gt; () {<br/>  cy.visit('/profile', {<br/>    onBeforeLoad (win) {<br/>      win.localStorage.setItem('token', JSON.stringify(authenticationToken))<br/>    },<br/>  })<br/>})</span></pre><p id="fbd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从环境变量中获取用户名和密码。</p><p id="b773" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们使用它登录，并通过使用API而不是GUI来获取令牌。</p><p id="b590" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到令牌并在每次测试前使用它。</p><h1 id="4ddd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">E2E烟尘测试，刚刚通过网站地图</h1><p id="1dd3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">端到端的测试只是在整个站点上运行，确保我们站点的所有部分都工作正常。</p><p id="4d47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它易于维护，可以发现任何功能、网络或部署问题。</p><p id="ce19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其他种类的烟雾测试并不可靠或详尽。</p><p id="a4c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了柏树，我们可以写下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1780" class="mn lc iq mj b gy mo mp l mq mr">it("can go to different pages", () =&gt; {<br/>  cy.visit("https://example.com/home");<br/>  cy.contains("Home");<br/>  cy.contains("https://example.com/profile");<br/>  cy.contains("Profile");<br/>  cy.contains("https://example.com/about");<br/>  cy.contains("About");<br/>});</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/3faa6a156b76050e3e398b0995166c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q9IR8WVoRw4PkN4N"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@marcojodoin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marc-Olivier Jodoin</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6774" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ebd1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以添加各种测试来测试性能和冒烟测试。</p><h2 id="9cb6" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">简明英语JavaScript</strong></h2><p id="4f4f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到一切的链接plainenglish.io </strong> </a>！</p></div></div>    
</body>
</html>