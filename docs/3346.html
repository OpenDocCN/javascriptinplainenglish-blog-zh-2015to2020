<html>
<head>
<title>Testing in React, Part 5: End-to-End Testing with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的测试，第5部分:使用Cypress的端到端测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/testing-in-react-part-5-end-to-end-testing-with-cypress-bd2bf8d3385f?source=collection_archive---------8-----------------------#2020-09-21">https://javascript.plainenglish.io/testing-in-react-part-5-end-to-end-testing-with-cypress-bd2bf8d3385f?source=collection_archive---------8-----------------------#2020-09-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f6b36e51786450d19d1b1d811b0a4c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9qLVmBfondJ2A3fNQNkSBA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@rocinante_11?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mick Haupt</a> on <a class="ae jd" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><blockquote class="kk kl km"><p id="7519" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">本文是React中测试系列的一部分:</p><p id="0e47" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-1-types-tools-244107abf0c6" rel="noopener">React中的测试，第1部分:类型&amp;工具</a></p><p id="90ab" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-2-react-testing-library-f32432b93c6c" rel="noopener">React中的测试，第2部分:React测试库</a></p><p id="1683" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-3-jest-jest-dom-7a8a03ae60b" rel="noopener">React中的测试，第3部分:Jest &amp; Jest-Dom </a></p><p id="9369" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-4-enzyme-9b030ad616ae" rel="noopener">React中的测试，第4部分:酶</a></p><p id="5c1e" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="kq jh">React中的测试，第5部分:使用Cypress的端到端测试</strong></p><p id="4864" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-6-real-world-testing-with-react-testing-library-jest-enzyme-and-cypress-9c73436d95d8" rel="noopener">React中的测试，第6部分:React测试库、Jest、Enzyme和Cypress的真实测试</a></p></blockquote></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="5399" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">与测试渲染组件(如React测试库、Enzyme和Jest)不同，端到端测试从头到尾测试web应用程序的整个工作流。这就是赛普拉斯的用武之地。如果您需要快速回顾一下这些测试类型之间的区别，我建议您快速回顾一下本系列的第1部分。</p><p id="d077" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">Cypress是用JavaScript编写的，可以测试任何在浏览器中运行的东西。它可以用来编写端到端测试、集成测试和单元测试。此外，Cypress可以用于设置、编写、运行和调试这些测试，这是一个不小的成就。在Cypress之前，端到端测试是通过许多工具的实现来处理的，其中的核心是Selenium。</p><p id="6046" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">Cypress有两个主要组成部分——一个免费的测试运行程序，和一个付费的仪表板服务(有一个免费层)。出于这个博客的目的，我们将关注使用免费测试运行器的实现。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="28cb" class="lp lq jg bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">安装Cypress</h1><p id="e70b" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">我们没有介绍前面工具的安装，因为它们是简单的CLI命令。柏树有点不同。Cypress是一个桌面应用程序，这个应用程序将运行您的测试。我强烈建议你在继续之前看一下<a class="ae jd" href="https://docs.cypress.io/guides/getting-started/installing-cypress.html#Opening-Cypress" rel="noopener ugc nofollow" target="_blank">安装指南</a>，因为有多个选项可以从命令行安装和打开桌面应用程序。</p><p id="6fe3" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">在您的应用程序中安装Cypress将会为您创建一个<code class="fe ms mt mu mv b">cypress/integration</code>文件夹——这是您编写测试的地方。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="50b2" class="lp lq jg bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">测试不同的浏览器</h1><p id="dede" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">Cypress桌面应用程序将尝试找到您计算机上所有可用的兼容浏览器，并允许您在它们之间切换以运行测试。鉴于Chrome和Safari这两个最流行的浏览器之间(以及所有浏览器之间)可能出现的明显差异，这真是太棒了。</p><figure class="mx my mz na gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/91bb1d45610964946da1f1555ba4cbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gN4741OrYIS90Cp0WFjrzA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Credit: <a class="ae jd" href="https://docs.cypress.io/guides/getting-started/installing-cypress.html#Switching-browsers" rel="noopener ugc nofollow" target="_blank">Cypress Documentation</a></figcaption></figure><p id="db89" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">当您运行Cypress测试时，Cypress会自动启动一个浏览器。你可以在这里找到兼容浏览器的完整列表。</p><p id="3ce4" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">在这个列表中，有一个明显的缺席浏览器——Safari。不可否认，这很麻烦，因为Safari的市场份额及其众所周知的怪癖使得在开发阶段进行彻底测试变得更加必要。这对你和Cypress来说可能是一个障碍，尤其是如果你没有像<a class="ae jd" href="https://www.browserstack.com/" rel="noopener ugc nofollow" target="_blank"> BrowserStack </a>或<a class="ae jd" href="https://saucelabs.com/" rel="noopener ugc nofollow" target="_blank"> Sauce Labs </a>这样的UI测试工具。如果是这种情况，我建议您看看Selenium作为替代。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="4f68" class="lp lq jg bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">编写端到端测试</h1><p id="c31f" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated"><em class="kp">测试应该写在安装时为您创建的</em> <code class="fe ms mt mu mv b"><em class="kp">cypress/integration</em></code> <em class="kp">文件夹中。</em></p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="c924" class="nb lq jg bd lr nc nd dn lv ne nf dp lz lm ng nh md ln ni nj mh lo nk nl ml nm bi translated">访问应用程序</h2><p id="9a66" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">关于编写端到端测试，首先要知道的是，Cypress测试实际上是访问网站，而不是呈现组件和测试节点。</p><pre class="mx my mz na gt nn mv no np aw nq bi"><span id="4112" class="nb lq jg mv b gy nr ns l nt nu">describe('example.com', () =&gt; {   <br/>   it('Visits Example.com', () =&gt; {         <br/>      cy.visit('https://example.com')   <br/>   }) <br/>})</span></pre><p id="c9e4" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">您可以看到，我们不是在导入或安装组件，而是在访问一个URL。在编写测试之后，可以使用Cypress桌面应用程序与测试进行交互并对测试进行评估。它的命令日志将显示所采取的行动(在本例中，<code class="fe ms mt mu mv b">visit</code>)。该应用程序(example.com)将被加载到Cypress的应用程序预览窗口中，测试要么通过，要么失败。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="3441" class="nb lq jg bd lr nc nd dn lv ne nf dp lz lm ng nh md ln ni nj mh lo nk nl ml nm bi translated">查询被访问的应用程序</h2><p id="f3b2" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">该过程的其余部分看起来与我们之前介绍的测试工具没有太大的不同。Cypress中的查询与使用RTL和酶的查询非常相似。出于这个原因，我们不打算逐一查看各个查询命令。你可以在这里找到完整的列表<a class="ae jd" href="https://example.cypress.io/commands/querying" rel="noopener ugc nofollow" target="_blank"/>。使用查询命令将如下所示:</p><pre class="mx my mz na gt nn mv no np aw nq bi"><span id="2760" class="nb lq jg mv b gy nr ns l nt nu">describe('example.com', () =&gt; {   <br/>   it('Visits Example.com', () =&gt; {         <br/>      cy.visit('https://example.com');<br/>      cy.get('#query-btn');<br/>   });<br/>});</span></pre><p id="d709" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">在上面的例子中，我们查询ID为<code class="fe ms mt mu mv b">query-btn</code>的节点，如果找到它，就会返回。在这一点上，这种模式应该看起来很熟悉，我们采取的步骤也是如此:加载要测试的内容→在加载的内容中找到节点→在节点上创建动作/事件→测试节点的断言。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="7c6b" class="nb lq jg bd lr nc nd dn lv ne nf dp lz lm ng nh md ln ni nj mh lo nk nl ml nm bi translated">在被查询的节点上触发事件</h2><p id="d1a1" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">在给定节点上激发(RTL)或模拟(酶)一个事件实际上在Cypress中更容易，但看起来类似于在RTL激发一个事件。您可以在这里找到最常用操作的列表<a class="ae jd" href="https://example.cypress.io/commands/actions" rel="noopener ugc nofollow" target="_blank">，在这里</a>找到完整的列表<a class="ae jd" href="https://docs.cypress.io/api/events/catalog-of-events.html#Cypress-Events" rel="noopener ugc nofollow" target="_blank">。单击我们在上面查询的按钮非常简单:</a></p><pre class="mx my mz na gt nn mv no np aw nq bi"><span id="8980" class="nb lq jg mv b gy nr ns l nt nu">describe('example.com', () =&gt; {   <br/>   it('Visits Example.com', () =&gt; {         <br/>      cy.visit('https://example.com');<br/>      cy.get('#query-btn').click();<br/>   });<br/>});</span></pre></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="4357" class="nb lq jg bd lr nc nd dn lv ne nf dp lz lm ng nh md ln ni nj mh lo nk nl ml nm bi translated">做出断言</h2><p id="20ab" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">最后，我们将断言一些关于节点的东西，以便获得所需的有意义的评估。Cypress提供的最流行的断言列表可以在<a class="ae jd" href="https://example.cypress.io/commands/assertions" rel="noopener ugc nofollow" target="_blank">这里</a>找到，完整列表在<a class="ae jd" href="https://docs.cypress.io/guides/references/assertions.html#Chai" rel="noopener ugc nofollow" target="_blank">这里</a>。同样，Cypress中的断言看起来与我们之前看到的非常相似:</p><pre class="mx my mz na gt nn mv no np aw nq bi"><span id="1936" class="nb lq jg mv b gy nr ns l nt nu">describe('example.com', () =&gt; {   <br/>   it('Visits Example.com', () =&gt; {         <br/>      cy.visit('https://example.com');</span><span id="6fad" class="nb lq jg mv b gy nv ns l nt nu">      cy.get('#query-btn').click();</span><span id="069e" class="nb lq jg mv b gy nv ns l nt nu">      cy.url().should('include', '/example-url/clicked')<br/>   });<br/>});</span></pre></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="8f67" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">我们在这里不讨论语法和细节，因为正如我所说的，这个模式现在应该看起来非常熟悉。您通过<code class="fe ms mt mu mv b">mount</code>、<code class="fe ms mt mu mv b">render</code>或<code class="fe ms mt mu mv b">visit</code>获得您想要测试的东西，您使用类似<code class="fe ms mt mu mv b">get</code>、<code class="fe ms mt mu mv b">find</code>或<code class="fe ms mt mu mv b">children</code>的调用来查询其中的节点，您触发类似<code class="fe ms mt mu mv b">click</code>、<code class="fe ms mt mu mv b">type</code>或<code class="fe ms mt mu mv b">setState</code>的事件，然后您做出一个断言来测试行为是否具有预期的结果。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="c066" class="lp lq jg bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">核心</h1><p id="e502" class="pw-post-body-paragraph kn ko jg kq b kr mn kt ku kv mo kx ky lm mp lb lc ln mq lf lg lo mr lj lk ll ij bi translated">尽管我们介绍的每个工具都遵循相同的模式，但是在不同的情况下，细微的差别是最佳的。Cypress的核心是测试一个<em class="kp">流</em>,而不是单一的功能或组件。Cypress测试将最接近地模拟实际的用户体验，并且应该牢记这一点。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="f27b" class="pw-post-body-paragraph kn ko jg kq b kr ks kt ku kv kw kx ky lm la lb lc ln le lf lg lo li lj lk ll ij bi translated">最后，我们有这个系列的大结局。我们将通过一个实际的应用程序，我已经建立和集成Jest，反应测试库，酶，和Cypress。我们将讨论真实世界实现的测试覆盖和最佳实践。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><blockquote class="kk kl km"><p id="1884" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="kq jh">之前的</strong>:<a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-4-enzyme-9b030ad616ae" rel="noopener">React中的测试，第4部分:酶</a></p><p id="f743" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="kq jh">接下来</strong>:<a class="ae jd" href="https://medium.com/javascript-in-plain-english/testing-in-react-part-6-real-world-testing-with-react-testing-library-jest-enzyme-and-cypress-9c73436d95d8" rel="noopener">React中的测试，第6部分:React测试库、Jest、Enzyme和Cypress的真实测试</a></p></blockquote></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="9370" class="nb lq jg bd lr nc nd dn lv ne nf dp lz lm ng nh md ln ni nj mh lo nk nl ml nm bi translated">资源</h2><ul class=""><li id="2e2c" class="nw nx jg kq b kr mn kv mo lm ny ln nz lo oa ll ob oc od oe bi translated"><a class="ae jd" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank">柏树官方文档</a></li><li id="d335" class="nw nx jg kq b kr of kv og lm oh ln oi lo oj ll ob oc od oe bi translated"><a class="ae jd" href="https://www.youtube.com/watch?v=7N63cMKosIE" rel="noopener ugc nofollow" target="_blank"> Cypress端到端测试</a></li></ul></div></div>    
</body>
</html>