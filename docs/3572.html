<html>
<head>
<title>Automating Event Management with Google Apps Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google Apps脚本自动化事件管理</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/automating-event-management-with-google-apps-script-383a6704a455?source=collection_archive---------0-----------------------#2020-10-10">https://javascript.plainenglish.io/automating-event-management-with-google-apps-script-383a6704a455?source=collection_archive---------0-----------------------#2020-10-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9eced2281c34a808c19d4d181b72f72f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4-HOuDL4CFl2Qc_1wTlrw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Image by the author. Font used: Futura. Color styling: Google</figcaption></figure><p id="189c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">用代码提高您的生产力！了解如何通过Apps脚本将工作表连接到日历，以自动化您的日程安排。</p><h1 id="ef77" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h1><p id="4b61" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">Google Apps Script是一个脚本工具，允许你用JavaScript代码从一个地方链接所有的Google Apps。开发环境(可在<a class="ae ma" href="https://script.google.com/home" rel="noopener ugc nofollow" target="_blank">script.googgle.com</a>访问)提供了几个高级应用程序编程接口(API)，允许你与你最喜欢的谷歌应用程序交互(创建、修改文档、读写表格、创建日历事件等)。</p><p id="2635" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">今天，我将展示如何编写一个简单的脚本，允许您将组织成电子表格的事件链接起来，并将其链接到您的个人或共享日历。</p><h1 id="e048" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">动机</h1><p id="f5d5" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">在工作中，我不经常使用谷歌电子表格，但我发现它对管理我的个人活动非常有用，如费用、旅行或学习计划。今天，我联系了一个老朋友，我们决定恢复每周五看电影的老习惯，尽管因为当前的疫情有点遥远。我很快创建了一个Google Sheet电子表格，这样我们就可以列出每周要看的电影。</p><p id="f9c1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一旦我的标签被创建，我有了要看的电影列表和一组日期，我想，<strong class="kb io">如果能把这个电子表格同步到我的日历上该多好啊？快速的谷歌浏览把我带到了<a class="ae ma" href="https://cloud.google.com/blog/products/g-suite/g-suite-pro-tip-how-to-automatically-add-a-schedule-from-google-sheets-into-calendar" rel="noopener ugc nofollow" target="_blank">的一篇博客</a>，作者是G Suite开发者倡导者 <a class="mc md ep" href="https://medium.com/u/2918c49416d6?source=post_page-----383a6704a455--------------------------------" rel="noopener" target="_blank">乔安娜·史密斯</a>。这个简短的帖子和与之配套的YouTube视频展示了如何使用Google Apps脚本来完成这个任务。令YouTube视频<a class="ae ma" href="https://www.youtube.com/watch?v=MOggwSls7xQ&amp;feature=emb_logo" rel="noopener ugc nofollow" target="_blank">中的许多评论者失望的是，该任务的代码片段并不能在任何地方快速复制、粘贴和运行。</a></strong></p><p id="17d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">幸运的是，</strong>代码相当琐碎，我们将展示如何通过几行额外的代码轻松地使它变得更好。</p></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="4e3a" class="kx ky in bd kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu bi translated">该过程</h1><h2 id="6e59" class="mq ky in bd kz mr ms dn ld mt mu dp lh kk mv mw ll ko mx my lp ks mz na lt nb bi translated">电子表格</h2><p id="3b54" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">我假设你知道如何使用谷歌工作表创建电子表格，当然，如果你想复制这项工作，你需要一个谷歌帐户。我的电子表格看起来像这样:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/77f852e364e44e320d9554820e071db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*54SeYU8CD_2EoMh6f9wg8g.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">My movies spreadsheet</figcaption></figure><p id="d27d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">正如你所看到的，一些条目丢失了，因为我们还没有决定到时候看什么电影。此外，请注意，日期列采用的是<em class="mb">日期时间</em>格式，这是首选格式，因为这将使以后的代码更简单(在编程中处理日期有点麻烦)。要更改单元格的格式，选择日期单元格并点击<strong class="kb io">格式&gt;数字&gt;日期时间。</strong></p><h2 id="18eb" class="mq ky in bd kz mr ms dn ld mt mu dp lh kk mv mw ll ko mx my lp ks mz na lt nb bi translated">日历</h2><p id="ece7" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">为了这个活动，我在<a class="ae ma" href="https://calendar.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Calendar </a>中创建了一个新日历，并通过以下简单的步骤检索了它的日历ID:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/79f2345c0f0db50baa595683a6f1dbd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJpHI5LxmBznSwKfbzruqg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Image by the author. Workflow to create a new calendar and retrieving the calendar ID</figcaption></figure><p id="e498" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们稍后在编写脚本时将需要日历ID，以便代码知道要修改什么日历。复制日历ID后，将其粘贴到电子表格中的空白单元格中，这样我们就可以从电子表格中自动检索日历。或者，您可以简单地将日历ID存储在JavaScript代码的变量中。</p><h2 id="3a03" class="mq ky in bd kz mr ms dn ld mt mu dp lh kk mv mw ll ko mx my lp ks mz na lt nb bi translated">代码—一步一步</h2><p id="8860" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">本教程假设您对编程有所了解，最好是对面向对象编程有所了解，尽管代码几乎可以像普通英语一样阅读。此外，代码被完全注释。</p><p id="b3ee" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在一切都准备好了，回到电子表格，点击<strong class="kb io">工具&gt;脚本编辑器。</strong>现在我们已经准备好编码了，但是我们面前是一个名为<code class="fe ni nj nk nl b">Code.gs</code>的空白画布，其中包含一个名为<code class="fe ni nj nk nl b">myFunction()</code>的函数的空模板。鉴于代码没有在<a class="ae ma" href="https://cloud.google.com/blog/products/g-suite/g-suite-pro-tip-how-to-automatically-add-a-schedule-from-google-sheets-into-calendar" rel="noopener ugc nofollow" target="_blank"> G Suite教程</a>中深入解释，我们将在这里对其进行分解(不要担心，完整的代码将在本文末尾提供)。</p><p id="cf51" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">首先，我们设置电子表格和日历:</p><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4865" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我调用了我的函数<code class="fe ni nj nk nl b">sheet2calendar</code>。上面块中的第4行将<code class="fe ni nj nk nl b">spreadsheet</code>变量设置为我们的日程表所在的电子表格，在本例中，我的工作表名为CALENDARIO。第5行从单元格H1中检索日历ID，最后，我内联6加载了<code class="fe ni nj nk nl b">calendar</code>对象。</p><p id="a85a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，我们用这一行加载我们的电影:</p><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2997" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这只是简单地说将条目从单元格A4加载到单元格B15，有效地检索一个12x2的表格。第一列对应于日期，第二列对应于电影名称。</p><p id="c39a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将遍历这个表中的每个条目(FOR循环！)并为指定日期创建一个日历事件。每个事件将有3个小时的长度，事件名称将是电影的标题。此外，我们将实现G Suite博客中没有讨论的几个特性:</p><ul class=""><li id="fbbf" class="no np in kb b kc kd kg kh kk nq ko nr ks ns kw nt nu nv nw bi translated">如果没有电影标题，我们将跳过该条目，不创建任何事件。</li><li id="6280" class="no np in kb b kc nx kg ny kk nz ko oa ks ob kw nt nu nv nw bi translated">如果在那个时间段有一个条目(在我们的新日历中，它独立于我们的其他日历工作)，删除那个事件并创建一个新的事件-你们中的许多人可能不同意这种处理冲突的方式，尽管这只是一个概念证明！</li><li id="612f" class="no np in kb b kc nx kg ny kk nz ko oa ks ob kw nt nu nv nw bi translated">通过指定客人的电子邮件，添加与客人共享活动的功能。</li><li id="c4be" class="no np in kb b kc nx kg ny kk nz ko oa ks ob kw nt nu nv nw bi translated">包装代码以在独立函数中创建和共享事件。</li></ul><p id="4b79" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们的基本for循环如下所示:</p><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="221e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">不错！我们已经得到了我们需要的大部分东西，现在让我们添加我们的新功能。首先，如果<code class="fe ni nj nk nl b">movie</code>变量为空(即等于<code class="fe ni nj nk nl b">''</code>，我们将跳过当前迭代。接下来，我们需要我们的冲突处理代码。为此，我们将检索电影开始和结束时间之间的现有事件，并删除当前名称与新名称不同的事件。</p><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2bf1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">冲突处理的逻辑很简单:如果<code class="fe ni nj nk nl b">conflicts</code>对象的长度是0，就没有冲突，我们可以和平地创建一个新事件。如果<code class="fe ni nj nk nl b">conflicts</code>对象的长度大于0，我们将遍历<code class="fe ni nj nk nl b">conflicts</code>中的事件(以防不止一个)。接下来，我们对照<code class="fe ni nj nk nl b">movie</code>名称检查冲突事件的名称，如果它们都相等，我们跳过当前迭代(不需要删除一个事件并创建一个同名的事件)。但是，如果名称不同，我们将删除冲突事件并创建一个新事件。</p><p id="dd12" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在前面的代码块中，我们调用了函数<code class="fe ni nj nk nl b">createAndShare()</code>两次(在第13行和第31行)。我将这个函数放在了<code class="fe ni nj nk nl b">sheet2calendar()</code>函数的外部，以避免重写代码和保持整洁。下面是它的实现:</p><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="7b71" class="mq ky in bd kz mr ms dn ld mt mu dp lh kk mv mw ll ko mx my lp ks mz na lt nb bi translated">点睛之笔——来自乔安娜的帖子</h2><p id="52a2" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">最后，为了避免每次我们希望将日历与电子表格同步时都必须访问脚本编辑器，我们可以在工作表工具栏中添加一个按钮，如<a class="mc md ep" href="https://medium.com/u/2918c49416d6?source=post_page-----383a6704a455--------------------------------" rel="noopener" target="_blank"> Joanna Smith </a>在2018 发表的<a class="ae ma" href="https://medium.com/@dontmesswithjo/custom-menus-94d8e4325b0d" rel="noopener">帖子所示。您只需要将这个函数添加到您的<code class="fe ni nj nk nl b">.gs</code>文件中:</a></p><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4bd1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">之后，您应该能够在电子表格工具栏中看到这样的图标:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/6b530897c314a5d93d4a2b84d6c26519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkkdmyvxc97c9akoAbjxWg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Press <strong class="bd od">Sync Now</strong> to run the code we just wrote!</figcaption></figure><p id="c4b2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这么简单。</p><h1 id="27ec" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">结果</strong></h1><p id="eebf" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">当我们按下<strong class="kb io">现在同步</strong>或者从脚本编辑器中运行代码时，我们成功地显示了我们的事件，客人应该会收到电子邮件邀请。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/f5bc27e97f5d2c22a97834abbbad071e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOl6S14-vpyQ1-CVL02IwA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Our calendar is successfully synced to our spreadsheet</figcaption></figure></div><div class="ab cl me mf hr mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ig ih ii ij ik"><h1 id="5309" class="kx ky in bd kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq mp ls lt lu bi translated">最终代码</h1><figure class="nd ne nf ng gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="9e21" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">你能做的更多</h1><p id="c027" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">对于最佳实践，如果你在一个严肃的项目中使用它，我推荐使用App Scripts <code class="fe ni nj nk nl b">Logger.log()</code>函数来记录你的代码运行的所有操作。通过这种方式，您可以随时返回日志，查看进行了哪些更改以及执行了哪些代码/操作。在官方文档中阅读更多关于<code class="fe ni nj nk nl b">Logger</code>类的内容。</p><p id="dba9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">此外，您可能认为我的代码对于手头的任务来说过于复杂，我本可以避免实现某些功能。我的观点是，即使是在玩具项目中，也要尝试编写遵循最佳实践的代码。</p><h1 id="6461" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="4eae" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">我希望你觉得这篇文章值得一读。我个人觉得这个工具超级好用，而且它的可能性似乎是无限的。</p><h1 id="24a2" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">资源</h1><ul class=""><li id="529e" class="no np in kb b kc lv kg lw kk of ko og ks oh kw nt nu nv nw bi translated"><a class="ae ma" href="https://developers.google.com/apps-script/overview" rel="noopener ugc nofollow" target="_blank">谷歌企业应用套件脚本概述</a></li><li id="a634" class="no np in kb b kc nx kg ny kk nz ko oa ks ob kw nt nu nv nw bi translated">将Google Sheets中的日程表添加到Calendar <a class="ae ma" href="https://cloud.google.com/blog/products/g-suite/g-suite-pro-tip-how-to-automatically-add-a-schedule-from-google-sheets-into-calendar" rel="noopener ugc nofollow" target="_blank"> G Suite(现为Google Workspace)博客文章</a></li><li id="bf62" class="no np in kb b kc nx kg ny kk nz ko oa ks ob kw nt nu nv nw bi translated"><a class="ae ma" href="https://medium.com/@dontmesswithjo/custom-menus-94d8e4325b0d" rel="noopener">点击按钮运行Google Sheets应用程序脚本</a>由<a class="mc md ep" href="https://medium.com/u/2918c49416d6?source=post_page-----383a6704a455--------------------------------" rel="noopener" target="_blank">乔安娜·史密斯</a></li></ul></div></div>    
</body>
</html>