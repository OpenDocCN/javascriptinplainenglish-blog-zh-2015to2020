<html>
<head>
<title>Creating a generic text-input component with React.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React创建通用文本输入组件。</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-generic-text-input-component-with-react-886e0cf90016?source=collection_archive---------0-----------------------#2020-03-01">https://javascript.plainenglish.io/creating-a-generic-text-input-component-with-react-886e0cf90016?source=collection_archive---------0-----------------------#2020-03-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="4ea7" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">使用React进行表单、输入和状态管理的权威指南。</h2><div class=""/><div class=""><h2 id="3ca6" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">在React状态下优雅地管理表单和输入值(第二部分)</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8f4e632d4ff414f65c91f1dba0822b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ueD1p2QEIkOufrfT"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@aligns?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jordan Harrison</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="75e7" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这篇文章是我上一篇文章的第二部分:<a class="ae lb" href="https://medium.com/javascript-in-plain-english/a-better-way-to-handle-forms-and-input-with-react-e01500ac73c" rel="noopener">如何用React </a>处理表单和输入。这篇文章是关于如何使文本输入与我们在上一篇文章中制作的<code class="fe ly lz ma mb b">Form</code>兼容的指南。如果你错过了这篇文章，这里有一些亮点:</p><ul class=""><li id="3461" class="mc md in le b lf lg li lj ll me lp mf lt mg lx mh mi mj mk bi translated">创建一个<code class="fe ly lz ma mb b">class</code>组件:<code class="fe ly lz ma mb b">Form</code>，保存所有输入字段的数据。</li><li id="48e8" class="mc md in le b lf ml li mm ll mn lp mo lt mp lx mh mi mj mk bi translated">通过<code class="fe ly lz ma mb b">context</code> API共享现场数据。</li><li id="d6a9" class="mc md in le b lf ml li mm ll mn lp mo lt mp lx mh mi mj mk bi translated">在<code class="fe ly lz ma mb b">Form</code>组件中添加方法进行更新(<code class="fe ly lz ma mb b">setField</code>)并添加新字段(<code class="fe ly lz ma mb b">addField</code>)。</li><li id="1cb8" class="mc md in le b lf ml li mm ll mn lp mo lt mp lx mh mi mj mk bi translated">添加一个方法来验证字段，并提供一些预定义的验证规则。</li></ul></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><p id="56a4" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在，我们将创建一个文本输入字段:<code class="fe ly lz ma mb b">TextInput</code>。这一部分将:</p><ul class=""><li id="32dc" class="mc md in le b lf lg li lj ll me lp mf lt mg lx mh mi mj mk bi translated"><strong class="le ix">接受来自开发者的初始值和配置，并将自身注册到</strong> <code class="fe ly lz ma mb b"><strong class="le ix">Form</strong></code> <strong class="le ix">。</strong></li><li id="1694" class="mc md in le b lf ml li mm ll mn lp mo lt mp lx mh mi mj mk bi translated"><strong class="le ix">根据道具值渲染为文本输入或</strong> <code class="fe ly lz ma mb b"><strong class="le ix">textarea</strong></code> <strong class="le ix">。</strong></li><li id="8e80" class="mc md in le b lf ml li mm ll mn lp mo lt mp lx mh mi mj mk bi translated"><strong class="le ix">调用自定义</strong> <code class="fe ly lz ma mb b"><strong class="le ix">onChange</strong></code> <strong class="le ix">函数后将其值保存到</strong> <code class="fe ly lz ma mb b"><strong class="le ix">Form</strong></code> <strong class="le ix">(可选)。</strong></li><li id="4978" class="mc md in le b lf ml li mm ll mn lp mo lt mp lx mh mi mj mk bi translated"><strong class="le ix">在字段值改变时验证自身(可选)。</strong></li></ul><p id="c63d" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">让我们从基础开始。让我们创建呈现文本输入字段的基本输入组件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Basic Text Input</figcaption></figure><p id="d7b4" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">上面的组件是<code class="fe ly lz ma mb b">TextInput</code>字段最简单的例子。它呈现一个输入字段，并按照props中传递的方式设置它的值。现在，让我们一个接一个地完成所有步骤，让这个领域更加实用:</p><ul class=""><li id="479e" class="mc md in le b lf lg li lj ll me lp mf lt mg lx mh mi mj mk bi translated"><strong class="le ix">接受来自开发者的初始值和配置，并将自身注册到</strong> <code class="fe ly lz ma mb b"><strong class="le ix">Form</strong></code> <strong class="le ix"> : </strong></li></ul><p id="2a77" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在这一步中，我们将传递“TextInput”字段的默认配置。默认配置可以是字段ID、默认值、占位符、字段样式、错误样式、验证规则等。然后，可能是一些像onChange，onError这样的函数回调。我们将在上下文中使用“表单”提供的函数“添加字段”。让我们将代码添加到组件中:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Make the TextInput dynamic by using props values.</figcaption></figure><p id="302d" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">虽然我们渲染<code class="fe ly lz ma mb b">props</code>是为了让组件动态，但是如果我们仔细观察，你会发现我们并没有在TextInput中使用<code class="fe ly lz ma mb b">Form</code>提供的字段数据。这意味着我们忽略了“单一事实来源”规则——所有数据都应该存储在一个地方，所有组件都应该引用该数据来呈现应用程序的动态部分。让我们解决这个问题，并从“表单”组件获取所有数据:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">TextInput component using data from the Form.</figcaption></figure><p id="6d88" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我在组件中做了两个重要的改变:a)现在组件利用保存在<code class="fe ly lz ma mb b">Form</code>的数据来呈现输入及其属性，b)组件接受一个属性:<code class="fe ly lz ma mb b">events</code>，而不是单独传递每个事件。这样你就可以传递所有的本地输入事件，并且所有的事件都将通过传播<code class="fe ly lz ma mb b">events</code>对象按原样传递给输入字段。<code class="fe ly lz ma mb b">onChange</code>事件也有一点变化。我创建了一个不同的函数:<code class="fe ly lz ma mb b">handleChange</code>，它调用<code class="fe ly lz ma mb b">setFields</code>来更新处于<code class="fe ly lz ma mb b">Form</code>状态的字段值，然后我们调用用户定义的<code class="fe ly lz ma mb b">events.onChange</code>函数。</p><ul class=""><li id="cef9" class="mc md in le b lf lg li lj ll me lp mf lt mg lx mh mi mj mk bi translated"><strong class="le ix">根据props值将组件渲染为文本输入或文本区域:</strong></li></ul><p id="a9c2" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">因为原生文本区和文本输入，两者的作用是一样的。我认为最好把它们都放在一个单独的组件中，然后根据用户的输入来渲染它们中的任何一个。让我们在组件中引入另一个道具— <code class="fe ly lz ma mb b">type</code>来选择要渲染的内容:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Input component that renders text-input or textarea on the basis of props</figcaption></figure><p id="0f6f" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在上面的组件中，我为组件添加了一个条件，以基于属性<code class="fe ly lz ma mb b">type</code>呈现文本输入或文本区域。我还添加了一些特定组件的道具。比如，如果<code class="fe ly lz ma mb b">type</code>的值是textarea，我们就增加一个新道具:<code class="fe ly lz ma mb b">row</code>。它将在textarea字段中指定默认的行数。当我们渲染文本区域时，我也将<code class="fe ly lz ma mb b">value</code>道具名称改为<code class="fe ly lz ma mb b">defaultValue</code>。你也可以为textarea创建一个单独的组件，但是我更喜欢这样。通过这种方式，我可以向您展示如何根据您的需求在您的自定义库中变通规则。</p><ul class=""><li id="c6d4" class="mc md in le b lf lg li lj ll me lp mf lt mg lx mh mi mj mk bi translated"><strong class="le ix">调用自定义</strong> <code class="fe ly lz ma mb b"><strong class="le ix">onChange</strong></code> <strong class="le ix">函数后将其值保存到表单:</strong></li></ul><p id="51df" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">虽然我们已经在文章的前面部分介绍了自定义onChange部分。这里，我们将首先将字段数据保存到表单状态，如果过程中没有错误，那么我们将调用自定义onChange函数。在这一部分中，我们还将了解如何添加和使用自定义事件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Custom input onChange function with other custom events.</figcaption></figure><p id="a253" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在，让我们看看如何在表单组件中使用TextInput组件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">TextInput used in the form component.</figcaption></figure><p id="14a8" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">观察上面的组件，所有的事件都在prop: <code class="fe ly lz ma mb b">events</code>中传递。请注意，事件名称应该与本地输入事件名称相同。我们没有通过上面例子中的<code class="fe ly lz ma mb b">type</code>道具。该组件默认呈现为文本输入，但是，如果我们添加值为“textarea”的<code class="fe ly lz ma mb b">type</code>属性。它将被呈现为textarea。</p><ul class=""><li id="1963" class="mc md in le b lf lg li lj ll me lp mf lt mg lx mh mi mj mk bi translated"><strong class="le ix">在字段值改变时验证自身:</strong></li></ul><p id="2647" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">尽管我们已经在<a class="ae lb" href="https://medium.com/javascript-in-plain-english/a-better-way-to-handle-forms-and-input-with-react-e01500ac73c" rel="noopener">之前的文章</a>中讨论了验证部分，现在我们将看看如何在输入中使用它。我们可以随时验证输入。但是，为了方便发布，让我们在字段值改变时验证它。我们需要做的就是从表单上下文中调用<code class="fe ly lz ma mb b">validateField</code>函数来验证字段:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">validate Text Input on change.</figcaption></figure><p id="3728" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我们使用<code class="fe ly lz ma mb b">useEffect</code>钩子来检测字段值的变化。如果数值改变，我们将触发<code class="fe ly lz ma mb b">validateField</code>功能。我们现在还显示了字段错误。注意，错误的占位符呈现了一个包含字段错误的变量。</p><p id="87ab" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">因此，这就完成了如何创建一个非常类似于本地文本输入字段的文本输入(或文本区域)字段。当然，你还是可以给这个组件添加很多东西的。如果你想要生产就绪的东西，请随时查看我的<a class="ae lb" href="https://github.com/iiison/react-form" rel="noopener ugc nofollow" target="_blank">“反应形式”回购</a>。这可以处理所有的极端情况，并具有一些额外的功能，您可能会发现这些功能在现实生活中很有用。你可以在NPM上找到它，名字是<code class="fe ly lz ma mb b"><a class="ae lb" href="https://www.npmjs.com/package/react-state-form" rel="noopener ugc nofollow" target="_blank">react-state-form</a></code>。你可以在<a class="ae lb" href="https://codesandbox.io/s/polished-river-ywyhx" rel="noopener ugc nofollow" target="_blank">这个沙箱</a>上看到这个例子的完整代码。</p></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><p id="ca25" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在下一篇文章中，我们将介绍如何使用相同的TextInput组件制作一个“自动建议”输入框。</p><h2 id="e828" class="mz na in bd nb nc nd dn ne nf ng dp nh ll ni nj nk lp nl nm nn lt no np nq it bi translated">关于作者:</h2><p id="c256" class="pw-post-body-paragraph lc ld in le b lf nr jx lh li ns ka lk ll nt ln lo lp nu lr ls lt nv lv lw lx ig bi translated">Bharat自2011年以来一直是前端开发人员。他对“前端开发经验”情有独钟。他喜欢学习和教授技术。他和最可爱的女人和两个宝贝双胞胎一起享受生活。</p><p id="31b0" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">总的来说是个好人。在<a class="ae lb" href="https://twitter.com/iiisoni" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lb" href="https://github.com/iiison" rel="noopener ugc nofollow" target="_blank"> Github </a>、<a class="ae lb" href="https://www.linkedin.com/in/iiison/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上找到他。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nw my l"/></div></figure></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><h2 id="ecfd" class="mz na in bd nb nc nd dn ne nf ng dp nh ll ni nj nk lp nl nm nn lt no np nq it bi translated">进一步阅读</h2><div class="nx ny gp gr nz oa"><a href="https://bit.cloud/blog/composable-link-component-that-works-in-any-react-meta-framework-l7i3qgmw" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ix gy z fp of fr fs og fu fw iw bi translated">可在任何React元框架中工作的可组合链接组件</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Bit的链接组件是一个与运行环境无关的组件。您可以将此链接用于…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">比特云</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kv oa"/></div></div></a></div></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><p id="e520" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><em class="op">更多内容看</em> <a class="ae lb" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="le ix"> <em class="op">说白了就是io </em> </strong> </a> <em class="op">。报名参加我们的</em> <a class="ae lb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="le ix"> <em class="op">免费周报</em> </strong> </a> <em class="op">。关注我们关于</em> <a class="ae lb" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="le ix"> <em class="op">推特</em> </strong> </a>，<a class="ae lb" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="le ix"> <em class="op">领英</em> </strong> </a> <em class="op">，</em><a class="ae lb" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="le ix"><em class="op">YouTube</em></strong></a><em class="op"/><a class="ae lb" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="le ix"><em class="op">不和</em> </strong> </a> <em class="op">。对增长黑客感兴趣？检查</em> <a class="ae lb" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="le ix"> <em class="op">电路</em> </strong> </a> <em class="op">。</em></p></div></div>    
</body>
</html>