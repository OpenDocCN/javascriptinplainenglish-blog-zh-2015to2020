<html>
<head>
<title>How to send emails with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js发邮件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-send-emails-with-node-js-1bb282f334fe?source=collection_archive---------0-----------------------#2020-07-04">https://javascript.plainenglish.io/how-to-send-emails-with-node-js-1bb282f334fe?source=collection_archive---------0-----------------------#2020-07-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/2e83558bc2c2248d1d6e903e58f68115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tTp1hfKrf474q_B-"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@lucasgwendt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lucas George Wendt</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="fe63" class="pw-subtitle-paragraph ka jc jd bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">如何使用node.js发送电子邮件，并动态生成HTML来发送电子邮件给我们的用户</h2></div><p id="6f8a" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在本文中，我们将学习如何使用Node.js发送电子邮件。</p><p id="61c4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里，我们将使用一个名为nodemailer的包来发送电子邮件。我们还将使用动态HTML生成器，这将有助于我们发送漂亮的电子邮件。</p><p id="4d29" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了学习如何发送电子邮件，我们将编写一些代码来向新注册的用户发送电子邮件。我们还将编写代码，使用nodemailer向我们的用户发送账单。这将帮助您开始使用nodemailer。</p><p id="041c" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们开始编码吧！</p><p id="4db8" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在工作目录中打开您的终端，并编写以下命令:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="220b" class="lx ly jd lt b gy lz ma l mb mc">npm init -y</span></pre><p id="93fb" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里的<code class="fe md me mf lt b">-y</code>标志帮助我们将这些值设置为默认值。</p><p id="f656" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，让我们安装我们需要的包。为此，编写以下代码行:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="36a5" class="lx ly jd lt b gy lz ma l mb mc">npm i nodemailer mailgen express</span></pre><p id="1a12" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">Nodemailer是一个节点包，它将帮助我们发送电子邮件，而mailgen则帮助我们生成好看的电子邮件。</p></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><p id="1f78" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们已经安装了包，让我们在主项目目录中创建一个名为<strong class="ku je"> index.js </strong>的文件。现在，我们的文件夹结构应该是这样的:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/3443d407b2df13394f6b5642066d37dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*FMwZvGRjGaxQpS5GqZOxEA.png"/></div></figure><p id="31dd" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，让我们在我们的<strong class="ku je"> index.js </strong>文件中写几行代码。</p><figure class="lo lp lq lr gt ip"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="b14e" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">代码非常简单。我们已经导入了express，初始化了我们的应用程序，使用了<code class="fe md me mf lt b">express.json()</code>中间件，创建了<code class="fe md me mf lt b">/api</code>的路由，并启动了服务器。</p><p id="e833" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们在主项目目录中创建一个名为<code class="fe md me mf lt b">routes</code>的文件夹。然后创建一个名为<strong class="ku je"> appRoute.js </strong>的文件。我们的文件夹结构应该是这样的:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/2b02a9b9ae8341d286319807fa4b46c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*RoR5imSUTL2V8mZKiUAVng.png"/></div></figure><p id="42ce" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们打开文件<strong class="ku je"> appRoute.js </strong>并编写以下代码行:</p><figure class="lo lp lq lr gt ip"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="70e5" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在上面的文件中，我们已经导入了express和<code class="fe md me mf lt b">appController</code>(我们很快就会创建这个文件)。然后我们添加了两个端点，即<code class="fe md me mf lt b">/api/user/signup</code>和<code class="fe md me mf lt b">/api/product/get-the-bill</code>。请注意，我没有添加任何验证，因为这个项目只是为了学习。但是您应该在创建真实世界的应用程序时添加验证。</p><p id="31a4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们创建一个名为controller的文件夹。在该目录中，创建一个名为<strong class="ku je"> appController.js </strong>的文件。现在，我们的文件夹结构应该是这样的:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/c1335570b44e10bcc67afd8cd9be2fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*tZWDq07QxzwzknV3gopmuA.png"/></div></figure><p id="502a" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在对我们的<strong class="ku je"> appController.js </strong>文件做任何事情之前，我们需要在我们的主项目目录中创建一个名为<code class="fe md me mf lt b">config</code>的文件夹。在该文件夹中，创建三个不同的文件，分别名为<strong class="ku je"> index.js </strong>、<strong class="ku je"> prod.js </strong>和<strong class="ku je"> dev.js </strong>。这应该使我们的文件夹结构看起来像这样:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c5c9479c881e1ce7d1172cb37ec8a941.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*iimPxAKH-Zh3JRSKhCyDxQ.png"/></div></figure><p id="5650" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，让我们打开<code class="fe md me mf lt b">config</code>目录中的<strong class="ku je"> index.js </strong>文件，并编写以下代码行:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="78e9" class="lx ly jd lt b gy lz ma l mb mc">if (process.env.NODE_ENV === "production") {</span><span id="a965" class="lx ly jd lt b gy mt ma l mb mc">  module.exports = require("./prod");</span><span id="a761" class="lx ly jd lt b gy mt ma l mb mc">} else {</span><span id="e64c" class="lx ly jd lt b gy mt ma l mb mc">  module.exports = require("./dev");</span><span id="502c" class="lx ly jd lt b gy mt ma l mb mc">}</span></pre><p id="a954" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这些代码行将根据<code class="fe md me mf lt b">NODE_ENV</code>的值从<strong class="ku je"> prod.js </strong>文件或<strong class="ku je"> dev.js </strong>文件中导出模块。如果<code class="fe md me mf lt b">NODE_ENV</code>是<code class="fe md me mf lt b">"production"</code>，它将从<strong class="ku je"> prod.js </strong>中导出模块，否则它将从<strong class="ku je"> dev.js </strong>中导出文件。</p><p id="496e" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，打开文件<strong class="ku je"> prod.js </strong>，并编写以下代码行:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="96a8" class="lx ly jd lt b gy lz ma l mb mc">module.exports = {</span><span id="92f7" class="lx ly jd lt b gy mt ma l mb mc">  PASSWORD: process.env.PASSWORD,</span><span id="6fe4" class="lx ly jd lt b gy mt ma l mb mc">  EMAIL: process.env.EMAIL,</span><span id="603e" class="lx ly jd lt b gy mt ma l mb mc">  MAIN_URL: process.env.MAIN_URL,</span><span id="8ab1" class="lx ly jd lt b gy mt ma l mb mc">};</span></pre><p id="7b3b" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在这个文件中，我们将导出<code class="fe md me mf lt b">PASSWORD</code>、<code class="fe md me mf lt b">EMAIL</code>、<code class="fe md me mf lt b">MAIN_URL</code>。所有这些值都是从环境变量接收的。我希望你了解环境变量。这些模块只有在<code class="fe md me mf lt b">NODE_ENV</code>为<code class="fe md me mf lt b">"production"</code>时才会被导出。这应该会使我们的生产过程更容易。</p><p id="ab7d" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在来说说<code class="fe md me mf lt b">PASSWORD</code>、<code class="fe md me mf lt b">EMAIL</code>、<code class="fe md me mf lt b">MAIN_URL</code>。这些是我们发送邮件时需要的变量。要发送电子邮件，我们需要一个邮件服务提供商。在我们的案例中，我们将使用雅虎邮箱。如果你想使用其他服务提供商，你将有能力做到这一点，由这篇文章结束。</p><p id="3c1c" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们来谈谈那些变量应该存储的值。<code class="fe md me mf lt b">EMAIL</code>应该是你的雅虎邮箱地址，而<code class="fe md me mf lt b">MAIN_URL</code>只是你的应用程序的网址。<code class="fe md me mf lt b">password</code>是电子邮件地址的密码。但是密码在这里可能不起作用。因此，你必须要求雅虎生成一组随机字符串作为你的应用程序的密码。为此你需要打开你的雅虎邮箱。然后点击你的个人资料图片。然后，弹出一个窗口，点击账户信息。</p><p id="2252" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，点击账户安全。如果您无法按照这组说明进行操作，只需点击这个<a class="ae ja" href="https://login.yahoo.com/account/security" rel="noopener ugc nofollow" target="_blank">链接</a>(在撰写本文时这个链接正在运行)。现在，滚动到页面底部。你看到一个名为“管理应用程序密码”的选项了吗？点击那个！</p><p id="8ced" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在点击下拉选项并选择“其他桌面”之后，你必须写下应用程序的名称。它应该是这样的:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/7a256e3be2fb01c872d4b70a48c8dbb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*GluUa5a7QPBsqM0VuwSIpg.png"/></div></figure><p id="c868" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在我的例子中，我将这个应用程序命名为Nodemailer。名字在这里并不重要。写完名字后，点击生成。之后，您将收到一个随机生成的应用程序密码。把它安全地存放在某个地方。</p><p id="cb28" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，让我们打开文件<strong class="ku je"> dev.js </strong>并编写以下代码行:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="3fc0" class="lx ly jd lt b gy lz ma l mb mc">module.exports = {</span><span id="2b60" class="lx ly jd lt b gy mt ma l mb mc">  EMAIL: "",  <em class="mv">// your yahoo email address goes here</em></span><span id="5ffb" class="lx ly jd lt b gy mt ma l mb mc">  PASSWORD: "",  <em class="mv">// recently generated password goes here</em></span><span id="09ea" class="lx ly jd lt b gy mt ma l mb mc">  MAIN_URL: "http://localhost:3000/", </span><span id="845d" class="lx ly jd lt b gy mt ma l mb mc">};</span></pre><p id="3ca7" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我认为上面几行代码非常清楚。您只需要输入上面代码的注释中提到的值。</p><p id="d8e7" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们转到我们的文件<strong class="ku je"> appController.js </strong>，并编写以下代码行:</p><figure class="lo lp lq lr gt ip"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="4bb6" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">代码太多了！这里到底发生了什么？我们慢慢来。好吗？</p><p id="1890" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如您所见，前几行只是导入。然后我们有<code class="fe md me mf lt b">transporter</code>。那部分看起来像这样:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="5363" class="lx ly jd lt b gy lz ma l mb mc">let transporter = nodemailer.createTransport({</span><span id="f440" class="lx ly jd lt b gy mt ma l mb mc">  service: "Yahoo",<br/>  secure: true,<br/>  auth: {<br/>    user: EMAIL,<br/>    pass: PASSWORD<br/>  },</span><span id="4375" class="lx ly jd lt b gy mt ma l mb mc">});</span></pre><p id="59ac" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><code class="fe md me mf lt b">transporter</code>的作用是发送邮件。每次我们需要发送电子邮件时，我们都必须通过传输器发送。</p><p id="a2e3" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在这里，<code class="fe md me mf lt b">nodemailer.createTransport</code>帮助我们创建了一个传输器，我们将这个传输器存储在<code class="fe md me mf lt b">transporter</code>变量中。<code class="fe md me mf lt b">createTransport</code>收<code class="fe md me mf lt b">service</code>。这个<code class="fe md me mf lt b">service</code>包括电子邮件服务提供商。在我们的例子中，它是“雅虎”。你也可以看到在<code class="fe md me mf lt b">createTransport</code>里面有一个<code class="fe md me mf lt b">secure</code>的选项。如果设置为<code class="fe md me mf lt b">true</code>，此<code class="fe md me mf lt b">secure</code>选项帮助我们实现TLS。</p><p id="a978" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">之后我们有<code class="fe md me mf lt b">auth</code>，它接收<code class="fe md me mf lt b">user</code>和<code class="fe md me mf lt b">pass</code>。<code class="fe md me mf lt b">user</code>键输入电子邮件地址，而<code class="fe md me mf lt b">pass</code>键输入密码。</p><p id="c9c3" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，我们来看看<code class="fe md me mf lt b">MailGenerator</code>。在上面的代码中，它看起来像这样:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="3884" class="lx ly jd lt b gy lz ma l mb mc">let MailGenerator = new Mailgen({</span><span id="a50b" class="lx ly jd lt b gy mt ma l mb mc">  theme: "default",</span><span id="8d2f" class="lx ly jd lt b gy mt ma l mb mc">  product: {</span><span id="c556" class="lx ly jd lt b gy mt ma l mb mc">    name: "Nodemailer",</span><span id="bf06" class="lx ly jd lt b gy mt ma l mb mc">    link: MAIN_URL,</span><span id="70c5" class="lx ly jd lt b gy mt ma l mb mc">  },</span><span id="13cc" class="lx ly jd lt b gy mt ma l mb mc">});</span></pre><p id="fba9" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">您可以看到我们已经创建了一个新的<code class="fe md me mf lt b">Mailgen</code>实例。它接收<code class="fe md me mf lt b">theme</code>。mailgen提供了多种主题供您选择。在我们的例子中，我们使用默认主题。您可以尝试mailgen提供的其他主题。为此，您需要访问这个<a class="ae ja" href="https://github.com/eladnava/mailgen#readme" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="3e7c" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后我们可以看到<code class="fe md me mf lt b">product</code>，它包含了<code class="fe md me mf lt b">name</code>和<code class="fe md me mf lt b">link</code>。<code class="fe md me mf lt b">name</code>只是我们应用的名字。该名称将出现在将要发送的电子邮件中。同样的方法<code class="fe md me mf lt b">link</code>是链接到我们的应用程序的网址。这个链接也将包含在我们发送给用户的电子邮件中。很简单，对吧？</p><p id="f91f" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们来看看<code class="fe md me mf lt b">signup</code>功能。</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="5b0f" class="lx ly jd lt b gy lz ma l mb mc">const signup = (<em class="mv">req</em>, <em class="mv">res</em>) =&gt; {<strong class="lt je"><br/></strong></span><span id="a591" class="lx ly jd lt b gy mt ma l mb mc">  const { userEmail, name } = req.body;</span><span id="3331" class="lx ly jd lt b gy mt ma l mb mc"><em class="mv">  // sign up the user .....</em></span><span id="efda" class="lx ly jd lt b gy mt ma l mb mc">  let response = {</span><span id="6d4a" class="lx ly jd lt b gy mt ma l mb mc">    body: {</span><span id="591c" class="lx ly jd lt b gy mt ma l mb mc">    name,</span><span id="1195" class="lx ly jd lt b gy mt ma l mb mc">    intro: "Welcome to Nodemailer! We're very excited to have you on     board.",</span><span id="d0ec" class="lx ly jd lt b gy mt ma l mb mc">    },</span><span id="19bb" class="lx ly jd lt b gy mt ma l mb mc">  };</span><span id="1880" class="lx ly jd lt b gy mt ma l mb mc">  let mail = MailGenerator.generate(response);</span><span id="ce45" class="lx ly jd lt b gy mt ma l mb mc">  let message = {</span><span id="4eaa" class="lx ly jd lt b gy mt ma l mb mc">    from: EMAIL,</span><span id="4911" class="lx ly jd lt b gy mt ma l mb mc">    to: userEmail,</span><span id="5e9b" class="lx ly jd lt b gy mt ma l mb mc">    subject: "signup successful",</span><span id="fe3c" class="lx ly jd lt b gy mt ma l mb mc">    html: mail,</span><span id="9aa9" class="lx ly jd lt b gy mt ma l mb mc">  };</span><span id="121a" class="lx ly jd lt b gy mt ma l mb mc">  transporter</span><span id="a740" class="lx ly jd lt b gy mt ma l mb mc">  .sendMail(message)</span><span id="dc23" class="lx ly jd lt b gy mt ma l mb mc">  .then(() =&gt; {</span><span id="a5b7" class="lx ly jd lt b gy mt ma l mb mc">  return res.status(200)<br/>   .json({ msg: "you should receive an email from us" });</span><span id="b199" class="lx ly jd lt b gy mt ma l mb mc">  })</span><span id="a541" class="lx ly jd lt b gy mt ma l mb mc">  .catch((<em class="mv">error</em>) =&gt; console.error(error));</span><span id="b8a5" class="lx ly jd lt b gy mt ma l mb mc">};</span></pre><p id="d4cc" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们这里有一个函数叫做<code class="fe md me mf lt b">signup</code>。这个函数在用户向URL <code class="fe md me mf lt b">/api/user/signup</code>发出POST请求时运行。你显然知道那件事。</p><p id="75c8" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后你可以看到用户注册的伪代码。这是因为这篇文章的重点是发送电子邮件。我们不要在这里花时间创建认证系统。好吗？</p><p id="9d36" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们来看看<code class="fe md me mf lt b">response</code>。它是一个对象，接受<code class="fe md me mf lt b">body</code>。<code class="fe md me mf lt b">body</code>有按键<code class="fe md me mf lt b">name</code>和<code class="fe md me mf lt b">intro</code>。<code class="fe md me mf lt b">name</code>应该是我们用户的名字。请注意，我们已经通过POST请求收到了来自用户的<code class="fe md me mf lt b">name </code>。</p><p id="d6b2" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们来看看<code class="fe md me mf lt b">intro</code>。<code class="fe md me mf lt b">intro</code>是将要生成的电子邮件的第一部分。车身也有一个<code class="fe md me mf lt b">outro</code>选项；我们将很快了解它。</p><p id="273e" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后你可以看到我们有一个名为<code class="fe md me mf lt b">mail</code>的变量。<code class="fe md me mf lt b">MailGenerator.generate</code>接收<code class="fe md me mf lt b">response</code>并返回给我们html格式的邮件。然后，我们将HTML存储在名为<code class="fe md me mf lt b">mail</code>的变量中。</p><p id="7819" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们来看看名为<code class="fe md me mf lt b">message</code>的变量。在这个变量中，我们创建了一个包含<code class="fe md me mf lt b">from</code>、<code class="fe md me mf lt b">to</code>、<code class="fe md me mf lt b">html</code>和<code class="fe md me mf lt b">subject</code>的对象。我希望你能理解它，因为它的名字本身就很清楚。这里我想提到的另一件事是，你可以通过在<code class="fe md me mf lt b">message</code>对象中使用<code class="fe md me mf lt b">text</code>而不是<code class="fe md me mf lt b">html</code>来使用简单的文本格式而不是html格式。</p><p id="3764" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">你可以看到<code class="fe md me mf lt b">transporter.sendMail</code>接收消息对象。</p><p id="ecc2" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">之后，我们编写代码来检查消息是否发送给了我们的用户。如果消息发送给用户，我们将向用户发送状态200和成功消息的响应，否则我们将记录错误。</p><p id="94e2" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们来看看<code class="fe md me mf lt b">getBill</code>函数。看起来是这样的:</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="711a" class="lx ly jd lt b gy lz ma l mb mc">const getBill = (<em class="mv">req</em>, <em class="mv">res</em>) =&gt; {</span><span id="88eb" class="lx ly jd lt b gy mt ma l mb mc">  const { name, userEmail } = req.body;</span><span id="8f1b" class="lx ly jd lt b gy mt ma l mb mc">  let response = {</span><span id="9cea" class="lx ly jd lt b gy mt ma l mb mc">    body: {</span><span id="d980" class="lx ly jd lt b gy mt ma l mb mc">      name,</span><span id="2828" class="lx ly jd lt b gy mt ma l mb mc">      intro: "Your bill has arrived!",</span><span id="7130" class="lx ly jd lt b gy mt ma l mb mc">      table: {</span><span id="5db4" class="lx ly jd lt b gy mt ma l mb mc">        data: [{</span><span id="d6cb" class="lx ly jd lt b gy mt ma l mb mc">          item: "MERN stack book",</span><span id="7605" class="lx ly jd lt b gy mt ma l mb mc">          description: "A mern stack book",</span><span id="5646" class="lx ly jd lt b gy mt ma l mb mc">          price: "$10.99",</span><span id="8720" class="lx ly jd lt b gy mt ma l mb mc">        }],</span><span id="8c1c" class="lx ly jd lt b gy mt ma l mb mc">    },</span><span id="2053" class="lx ly jd lt b gy mt ma l mb mc">    outro: "Looking forward to do more business with you",</span><span id="74e4" class="lx ly jd lt b gy mt ma l mb mc">   }</span><span id="d80c" class="lx ly jd lt b gy mt ma l mb mc">};</span><span id="72ff" class="lx ly jd lt b gy mt ma l mb mc">let mail = MailGenerator.generate(response);<br/></span><span id="8872" class="lx ly jd lt b gy mt ma l mb mc">let message = {</span><span id="5368" class="lx ly jd lt b gy mt ma l mb mc">  from: EMAIL,</span><span id="455f" class="lx ly jd lt b gy mt ma l mb mc">  to: userEmail,</span><span id="c9a6" class="lx ly jd lt b gy mt ma l mb mc">  subject: "transaction",</span><span id="db85" class="lx ly jd lt b gy mt ma l mb mc">  html: mail,</span><span id="ca9d" class="lx ly jd lt b gy mt ma l mb mc">};</span><span id="a770" class="lx ly jd lt b gy mt ma l mb mc"><br/>transporter</span><span id="38cb" class="lx ly jd lt b gy mt ma l mb mc">  .sendMail(message)</span><span id="9460" class="lx ly jd lt b gy mt ma l mb mc">  .then(() =&gt; {</span><span id="9778" class="lx ly jd lt b gy mt ma l mb mc">  return res.status(200)</span><span id="9e17" class="lx ly jd lt b gy mt ma l mb mc">  .json({ msg: "you should receive an email from us" });</span><span id="ade1" class="lx ly jd lt b gy mt ma l mb mc">  })</span><span id="83f9" class="lx ly jd lt b gy mt ma l mb mc">  .catch((<em class="mv">error</em>) =&gt; console.error(error));</span><span id="ce29" class="lx ly jd lt b gy mt ma l mb mc">};</span></pre><p id="f92f" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里的大多数事情都是相似的，都是在<code class="fe md me mf lt b">signup</code>函数中实现的。我只解释一下新的东西。好吗？</p><p id="facc" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里有一点是新的，那就是在<code class="fe md me mf lt b">response</code>对象内部的<code class="fe md me mf lt b">table</code>对象。<code class="fe md me mf lt b">table</code>对象包含<code class="fe md me mf lt b">data</code>，这是一个对象数组。那个对象有三个属性<code class="fe md me mf lt b">item</code>、<code class="fe md me mf lt b">description</code>、<code class="fe md me mf lt b">price</code>。从名字本身就很清楚了，对吧？注意，我们的账单数据在这里是硬编码的。我们通常不硬编码账单，但是现在我们将硬编码它。好吗？</p><p id="573e" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这里的另一个新东西是<code class="fe md me mf lt b">response</code>对象内部的<code class="fe md me mf lt b">outro</code>。<code class="fe md me mf lt b">outro</code>是我们邮件的结尾部分。除此之外没什么新的了。</p><p id="95c3" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们来试试这个。为此，让我们打开邮差。现在让我们用postman向URL <code class="fe md me mf lt b"><a class="ae ja" href="http://localhost:3000/api/user/signup" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/api/user/signup</a> </code>发出一个POST请求。</p><p id="f7e4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">请注意，您必须添加两个字段<code class="fe md me mf lt b">name</code>和<code class="fe md me mf lt b">userEmail</code>，其中<code class="fe md me mf lt b">name</code>必须是用户名，<code class="fe md me mf lt b">userEmail</code>必须是用户的电子邮件地址。不要忘记在postman中添加标题<code class="fe md me mf lt b">Conent-Type</code>为<code class="fe md me mf lt b">application/json</code>。现在向URL发出POST请求。您应该会收到一封类似这样的电子邮件:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/694660d88e8e8aac506e4256933beaeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*HeqlEA-mmnfGNDt28RsRSg.png"/></div></figure><p id="faba" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">和普通的文本邮件相比，它看起来不错，不是吗？</p><p id="39e9" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在让我们为我们的<code class="fe md me mf lt b"><a class="ae ja" href="http://localhost:3000/api/product/get-the-bill" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/api/product/get-the-bill</a></code>做同样的事情。这也应该是一个POST请求，具有与之前相同的标题和相同的字段，即<code class="fe md me mf lt b">name</code>和<code class="fe md me mf lt b">userEmail</code>。用户将收到的电子邮件如下所示:</p><figure class="lo lp lq lr gt ip gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/92bb3ac58381fb5f26475686df96c5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*gryMogEiZMub5o_w9ozG5Q.png"/></div></figure><p id="7d93" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这意味着我们已经学会了如何在node.js中发送电子邮件。</p></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><p id="48d0" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果您想实现其他电子邮件服务提供商，这里有一个<a class="ae ja" href="https://nodemailer.com/smtp/well-known/" rel="noopener ugc nofollow" target="_blank">链接</a>，显示了一些受支持的电子邮件服务提供商。如果您想更深入地了解nodemailer，您可以点击<a class="ae ja" href="https://nodemailer.com/usage/" rel="noopener ugc nofollow" target="_blank">链接</a>，该链接将带您进入其文档。如果您想了解更多关于mailgen的信息，您可以通过<a class="ae ja" href="https://github.com/eladnava/mailgen#readme" rel="noopener ugc nofollow" target="_blank">链接</a>查看mailgen的文档。</p></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><h2 id="312a" class="lx ly jd bd my mz na dn nb nc nd dp ne lb nf ng nh lf ni nj nk lj nl nm nn no bi translated"><strong class="ak">简单明了的JavaScript</strong></h2><p id="6485" class="pw-post-body-paragraph ks kt jd ku b kv np ke kx ky nq kh la lb nr ld le lf ns lh li lj nt ll lm ln ig bi translated">你知道我们有四个出版物和一个YouTube频道吗？请在<a class="ae ja" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku je">找到他们，点击</strong> </a>和<a class="ae ja" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ku je">订阅我们的YouTube频道</strong> </a> <strong class="ku je">！</strong></p></div></div>    
</body>
</html>