<html>
<head>
<title>How to Use dotenv in Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Express中使用dotenv</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-dotenv-in-express-3aa933758ead?source=collection_archive---------2-----------------------#2020-12-16">https://javascript.plainenglish.io/how-to-use-dotenv-in-express-3aa933758ead?source=collection_archive---------2-----------------------#2020-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="af4f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用dotenv in Express轻松保护您应用程序的敏感信息。</h2></div><h2 id="569c" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">现代应用程序使用各种数据。</h2><p id="6ec7" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">有时，数据被用于认证第三方服务、连接到数据库或任何其他无数选项。在数据库连接的例子中，必要的数据是开发人员的<strong class="ld ir">用户名</strong>和<strong class="ld ir">密码</strong>，以及许多其他必需的参数。</p><p id="6c53" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">为此，应用程序必须能够访问这些数据。这意味着数据必须存储在应用程序可以访问的地方。</p><p id="b9da" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">存储数据最容易的地方就是源代码。然而，这为开发者的数据引入了安全问题，因为数据是私有的，并且不应该对那些可以看到源代码的人可用。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/bcbfe4bda44fbfc094bfa1f088420567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i-SQLk2h1spPQCqV"/></div></div></figure><p id="be3e" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">本文将采用以问题为中心的方法来解释<strong class="ld ir">为什么</strong>开发者使用<code class="fe ml mm mn mo b">dotenv</code>来解决这个问题，然后快速演示如何使用这个软件包。</p><h1 id="918e" class="mp kg iq bd kh mq mr ms kk mt mu mv kn jw mw jx kr jz mx ka kv kc my kd kz mz bi translated">问题是</h1><p id="08b9" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">在源代码中存储数据是开发人员每天都要做的事情。然而，当存储敏感数据时，这就成了一个问题。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi na"><img src="../Images/0390432c831a3c3aee9a27a63f3bbcf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*XJ82MwUPbATURzLa6ine4Q.png"/></div></figure><p id="efa8" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">敏感数据可能是以下任何一种:</p><ul class=""><li id="5b10" class="nb nc iq ld b le lu lh lv ko nd ks ne kw nf lt ng nh ni nj bi translated">AWS凭证；</li><li id="cb13" class="nb nc iq ld b le nk lh nl ko nm ks nn kw no lt ng nh ni nj bi translated">数据库凭据；</li><li id="b9c9" class="nb nc iq ld b le nk lh nl ko nm ks nn kw no lt ng nh ni nj bi translated">Auth0凭据；</li></ul><p id="5932" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">问题出现在项目源代码的协作和公共可见性上。</p><p id="460a" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">大多数开发人员使用<strong class="ld ir">版本控制系统</strong> ( <strong class="ld ir"> VCS </strong>)来管理项目。一个流行的例子是GitHub。当开发者将他们的源代码发布到VCS上时，该代码由第三方(VCS)和任何其他有权访问开发者的库的开发者(合作者)托管并可见。不仅如此，VCS通常还会存储项目所有状态的历史记录，这意味着删除后，被移除的数据仍然可见。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi np"><img src="../Images/30d3d356d08faa997fe0502fe6c1310b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*dg8mwi7eALh6CECub_Qafg.png"/></div></figure><p id="c7dd" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">因为源代码对任何有权访问的人都是可见的，所以存储在应用程序源代码中的所有数据都是可见的。因此，敏感数据受到危害。开发人员不能确切地确定谁有权访问他们的敏感信息，因为数据可能会在一场疯狂失控的电话游戏中传播。</p><p id="aafe" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">数据泄露的问题非常严重。不过，有一个解决方案。</p><h1 id="b774" class="mp kg iq bd kh mq mr ms kk mt mu mv kn jw mw jx kr jz mx ka kv kc my kd kz mz bi translated">dotenv作为解决方案</h1><p id="6c29" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><code class="fe ml mm mn mo b">dotenv</code>是一个NPM包，用于存储<strong class="ld ir">环境变量</strong>中的敏感数据。</p><p id="ebb1" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">环境变量是应用程序的外部变量。开发人员可以将它们视为存储在机器的操作系统或应用程序的运行容器中的配置数据。这些变量是在运行时动态配置的，可以根据应用程序运行的环境而改变。</p><p id="8f03" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">环境变量是保护敏感数据的一个很好的解决方案。</p><p id="e5ed" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">应用程序可以引用环境变量来查找必要的数据，而不是指定特定开发人员用来在他们的机器上运行应用程序的确切数据。因此，开发人员不会将敏感数据推送到自己的VCS，而是会将引用环境变量的源代码推送到本地的开发人员源代码<strong class="ld ir">中。</strong></p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nq"><img src="../Images/99bcd510d8482d8d41129655e54e507f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9GPZ8hLpHJUnBzc2u-6EQ.png"/></div></div></figure><p id="6fc1" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">为了避免将本地<code class="fe ml mm mn mo b">dotenv</code>文件推送到VCS，它被VCS指定的<strong class="ld ir">忽略文件</strong>忽略。</p><h1 id="7172" class="mp kg iq bd kh mq mr ms kk mt mu mv kn jw mw jx kr jz mx ka kv kc my kd kz mz bi translated">设置演示应用程序</h1><p id="9a19" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我们将使用命令<code class="fe ml mm mn mo b">express --view=pug dotenv-demo</code>来设置我们的<code class="fe ml mm mn mo b">dotenv</code>演示。</p><p id="1cd4" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">运行命令后，<code class="fe ml mm mn mo b">cd dotenv-demo</code>。</p><p id="3cc8" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">我们只需要为这个项目安装一个依赖项，这是显而易见的:<code class="fe ml mm mn mo b">dotenv</code>。运行命令<code class="fe ml mm mn mo b">npm i dotenv</code>将其安装在<code class="fe ml mm mn mo b">package.json</code>中。</p><p id="857c" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">最后，用<code class="fe ml mm mn mo b">npm i</code>安装模块。</p><h2 id="509f" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">创建必要的文件</h2><p id="7659" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">在项目的根目录下创建两个文件:<code class="fe ml mm mn mo b">.gitignore</code>和<code class="fe ml mm mn mo b">.env</code>。</p><p id="2fd1" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><code class="fe ml mm mn mo b">.env</code>将用于存储我们的本地环境变量，<code class="fe ml mm mn mo b">.gitignore</code>将用于确保<code class="fe ml mm mn mo b">.env</code>不会被推送到GitHub。</p><p id="7dd5" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">打开<code class="fe ml mm mn mo b">.gitignore</code>并添加以下代码:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="66a0" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">简单吧？现在，<code class="fe ml mm mn mo b">.env</code>不会被推送到GitHub(只要我们在编写<code class="fe ml mm mn mo b">gitignore</code>之前没有提交)。我们的环境变量对于我们的机器来说是局部的。</p><h2 id="219e" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">行动中的dotenv</h2><p id="ea42" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我们需要一些数据来测试<code class="fe ml mm mn mo b">dotenv</code>是否真的在工作。首先，我们需要指定我们的应用程序应该使用<code class="fe ml mm mn mo b">dotenv</code>从<code class="fe ml mm mn mo b">.env</code>加载环境变量。</p><p id="b4d9" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">打开<code class="fe ml mm mn mo b">app.js</code>,使它看起来像下面的代码片段:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9aed" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">第一行是唯一重要的一行。这一行需要<code class="fe ml mm mn mo b">dotenv</code>，并使来自<code class="fe ml mm mn mo b">.env</code>的环境变量可以被NodeJS中的<code class="fe ml mm mn mo b">process.env</code>对象访问。</p><p id="6c59" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">接下来，让我们给<code class="fe ml mm mn mo b">.env</code>添加一些数据，这些数据将显示在<code class="fe ml mm mn mo b">/</code>路径上:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="335f" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><code class="fe ml mm mn mo b">SAMPLE_DATA</code>是环境变量的名称，<code class="fe ml mm mn mo b">dotenv is working!</code>是它的值。</p><p id="faad" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">打开文件<code class="fe ml mm mn mo b">./routes/index.js</code>并修改代码以匹配以下代码:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="3a86" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">环境变量存储在<code class="fe ml mm mn mo b">process.env</code>对象上。<code class="fe ml mm mn mo b">SAMPLE_DATA</code>是我们在上一步中编写的变量的名称。</p><p id="f938" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">现在，用<code class="fe ml mm mn mo b">npm start</code>测试应用程序。转到<code class="fe ml mm mn mo b">/</code>路径，查看环境变量是否已经提取并显示在页面上。输出应该类似于:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nt"><img src="../Images/92fa90440fb0fafa7f2f24f4e9047eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3x-F6EgfWV1DVvLyh7M6Pg.png"/></div></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk">Woo!</figcaption></figure><p id="60e6" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">太好了——它起作用了。现在我们的<code class="fe ml mm mn mo b">SAMPLE_DATA</code>值是安全的，任何其他协作开发人员都可以使用<code class="fe ml mm mn mo b">.env</code>文件替换他们自己的变量值，而不需要依赖其他人的数据。</p><p id="59cf" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">感谢阅读这篇文章，祝编码快乐！</p></div></div>    
</body>
</html>