<html>
<head>
<title>3 Ways to Improve Type Safety in Jest Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jestæµ‹è¯•ä¸­æé«˜ç±»å‹å®‰å…¨æ€§çš„3ç§æ–¹æ³•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/3-ways-to-improve-type-safety-in-jest-tests-42957a362668?source=collection_archive---------7-----------------------#2020-05-18">https://javascript.plainenglish.io/3-ways-to-improve-type-safety-in-jest-tests-42957a362668?source=collection_archive---------7-----------------------#2020-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4be8e59a3a76e91ef2c4d307e5fcadf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tHO89ZHB_gcb2PA5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@mmayyer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">marcos mayer</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6ad8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨å•å…ƒæµ‹è¯•ä¸­å¿½ç•¥ç±»å‹å®‰å…¨å’Œä½¿ç”¨ç±»å‹æ–­è¨€æˆ–ts-ignoreæ³¨é‡Šé€šå¸¸æ›´å®¹æ˜“ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è¿‡æ—¶çš„æµ‹è¯•ï¼Œå¹¶é™ä½ä»–ä»¬åœ¨ç”Ÿäº§ä¸­æ•æ‰bugçš„èƒ½åŠ›ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨Jestä½œä¸ºæµ‹è¯•æ¡†æ¶æ¥å¼•å…¥æ›´å¥½çš„ç±»å‹å®‰å…¨çš„æ–¹æ³•ã€‚</p><h1 id="2b9a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.åœ¨å¼ºåˆ¶è½¬æ¢ä¹‹å‰å°†å¯¹è±¡åˆ†é…ç»™åˆ†éƒ¨ç±»å‹</h1><p id="c728" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œå®ƒæœ‰å¾ˆå¤šå±æ€§ï¼Œæ¯”å¦‚å¤æ‚çš„Reactç»„ä»¶çš„é…ç½®é€‰é¡¹æˆ–å±æ€§ã€‚</p><p id="a779" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¿½ç•¥è¿™ä¸€ç‚¹çš„ç®€å•æ–¹æ³•æ˜¯å°†æµ‹è¯•å€¼è½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="125b" class="mn lc iq mj b gy mo mp l mq mr">type Properties = {a: <em class="ms">string</em>, b: <em class="ms">number, //...</em>}</span><span id="a0cb" class="mn lc iq mj b gy mt mp l mq mr">const identity = (properties: Properties) =&gt; properties</span><span id="cba2" class="mn lc iq mj b gy mt mp l mq mr"><em class="ms">// Error: Argument of type '{}' is not assignable to parameter of type 'Properties'.<br/></em>identity({});</span><span id="b2f7" class="mn lc iq mj b gy mt mp l mq mr">// No errors with type assertion<br/>expect(identity({} as Properties)).toEqual({})<br/>expect(identity({a: 123} as Properties).toEqual({a: 123})</span></pre><p id="61cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ˜¯å°†æµ‹è¯•å¯¹è±¡åˆ†é…ç»™<code class="fe mu mv mw mj b">Partial</code>ç‰ˆæœ¬ï¼Œè¿™æ ·å¯¹äºæˆ‘ä»¬é€‰æ‹©æä¾›çš„å±æ€§ï¼Œå€¼ä»ç„¶è¢«ç±»å‹æ£€æŸ¥ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="08ea" class="mn lc iq mj b gy mo mp l mq mr"><em class="ms">// Error: Type 'number' is not assignable to type 'string | undefined'.ts(2322)<br/></em><strong class="mj ir">const testProperties: Partial&lt;Properties&gt; = {a: 123};</strong></span><span id="75e6" class="mn lc iq mj b gy mt mp l mq mr">expect(identity(testProperties as Properties))<br/>  .toEqual(testProperties);</span></pre><h1 id="bfaa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.å‘<strong class="ak"> jestæä¾›ä¸€ä¸ªç±»å‹å‚æ•°ã€‚ç±»çš„æ¨¡æ‹Ÿæ³›å‹</strong></h1><p id="184e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">ç»™å®šä¸€ä¸ªæ¥å—ç±»å‹<code class="fe mu mv mw mj b">User</code>å¹¶è¿”å›ç”¨æˆ·åçš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š<code class="fe mu mv mw mj b">jest.fn()</code>æ¥æ›¿æ¢æ¨¡æ‹Ÿç±»ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0e63" class="mn lc iq mj b gy mo mp l mq mr">class User {<br/>   public name: <em class="ms">string</em>;<br/>}</span><span id="99e8" class="mn lc iq mj b gy mt mp l mq mr">const getName = (user: User) =&gt; user.name<br/>const randomObject = {<br/>   name: 12345,<br/>   doesNotExist: ''<br/>}</span><span id="0c35" class="mn lc iq mj b gy mt mp l mq mr">const userMock = jest.fn().mockReturnValue(randomObject)</span><span id="0ae0" class="mn lc iq mj b gy mt mp l mq mr">// No errors despite the wrong types<br/>expect(getName(userMock)).toEqual('kaylie')</span></pre><p id="0b84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æœ€åä¸€è¡Œä¼¼ä¹ä¼šå¯¼è‡´ç±»å‹é”™è¯¯ï¼Œå› ä¸ºç”¨<code class="fe mu mv mw mj b">randomObject</code>ç›´æ¥è°ƒç”¨getNameä¼šå¯¼è‡´ç±»å‹é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºJest mockç±»å‹é»˜è®¤ä¸º<em class="ms"> any </em>ï¼Œä¸æä¾›ç›¸åŒçš„ç±»å‹å®‰å…¨ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89aa" class="mn lc iq mj b gy mo mp l mq mr">// node_modules/@types/jest/index.d.ts</span><span id="07ca" class="mn lc iq mj b gy mt mp l mq mr">interface Mock&lt;<strong class="mj ir">T = <em class="ms">any</em>, Y extends <em class="ms">any</em>[] = <em class="ms">any</em></strong>&gt; extends Function, MockInstance&lt;T, Y&gt; <br/>{<br/>     new (...args: Y): T;<br/>     (...args: Y): T;<br/>}</span></pre><p id="fb7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä½†æ˜¯å½“æˆ‘ä»¬å°†<code class="fe mu mv mw mj b">User</code>ä¼ é€’ç»™æ³›å‹ç±»å‹å‚æ•°æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡é¢å¤–çš„å±æ€§æ£€æŸ¥è·å¾—äº†æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9825" class="mn lc iq mj b gy mo mp l mq mr">const typedUserMock: jest.Mock&lt;User&gt; = jest.fn()</span><span id="3973" class="mn lc iq mj b gy mt mp l mq mr">// Argument of type '{ name: number; doesNotExist: string; }' is not // assignable to parameter of type 'User'. Types of property 'name' // are incompatible.<br/>typedUserMock.mockReturnValue(randomObject)</span><span id="d29f" class="mn lc iq mj b gy mt mp l mq mr"><strong class="mj ir">typedUserMock.mockReturnValue({<br/>   name: 'kaylie'<br/>})</strong></span><span id="b71b" class="mn lc iq mj b gy mt mp l mq mr">// Type safe, and passes!<br/>expect(getName(typedUserMock)).toEqual('kaylie')</span></pre><h1 id="0bf6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.å°†ReturnTypeä¸jestç»“åˆä½¿ç”¨ã€‚æ¨¡æ‹Ÿå‡½æ•°</h1><p id="ab7e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªåä¸º<code class="fe mu mv mw mj b">filter</code>çš„å‡½æ•°å°†å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c04d" class="mn lc iq mj b gy mo mp l mq mr">type Predicate = () =&gt; <em class="ms">boolean</em></span><span id="c68f" class="mn lc iq mj b gy mt mp l mq mr">const filter = (predicate: Predicate) =&gt; {</span><span id="31eb" class="mn lc iq mj b gy mt mp l mq mr">     predicate()</span><span id="b8d6" class="mn lc iq mj b gy mt mp l mq mr">}</span></pre><p id="9e22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨æˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œå½“filterè¢«è°ƒç”¨æ—¶æ–­è¨€è°“è¯è¢«è°ƒç”¨ã€‚æˆ‘ä»¬å¸Œæœ›ç¡®ä¿<code class="fe mu mv mw mj b">mockPredicate</code>ä¸åŸå§‹ç±»å‹å®šä¹‰å…·æœ‰ç›¸åŒçš„ç­¾åã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="45e4" class="mn lc iq mj b gy mo mp l mq mr">const mockPredicate = jest.fn()</span><span id="09e5" class="mn lc iq mj b gy mt mp l mq mr">// Error: <em class="ms">Type 'number' is not assignable to type 'boolean'.ts(2322)</em><br/>filter(() =&gt; 1)</span><span id="0bb5" class="mn lc iq mj b gy mt mp l mq mr">// No errors<br/>filter(mockPredicate.mockReturnValue(1)<strong class="mj ir">)</strong></span></pre><p id="8847" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸å‰é¢çš„ä¾‹å­ç±»ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦å‘æ³›å‹<code class="fe mu mv mw mj b">jest.Mock</code>å‚æ•°ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿™æ¬¡ä½¿ç”¨æ­£ç¡®çš„è¿”å›ç±»å‹ã€‚</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="50d0" class="mn lc iq mj b gy mo mp l mq mr">type Predicate = () =&gt; <em class="ms">boolean</em></span><span id="9dea" class="mn lc iq mj b gy mt mp l mq mr"><strong class="mj ir">const typedMockPredicate: jest.Mock&lt;ReturnType&lt;Predicate&gt;&gt; = <br/>jest.fn();</strong></span><span id="3f8d" class="mn lc iq mj b gy mt mp l mq mr">// Error: Argument of type '1' is not assignable to parameter of type 'boolean'.ts(2345)<br/>filter(typedMockPredicate.mockReturnValue(1))</span><span id="ade0" class="mn lc iq mj b gy mt mp l mq mr">// OK!<br/>filter(typedMockPredicate.mockReturnValue(true))</span><span id="66b6" class="mn lc iq mj b gy mt mp l mq mr">expect(typedMockPredicate).toHaveBeenCalled()</span></pre></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="72d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å°½ç®¡ç¤ºä¾‹ä½¿ç”¨äº†ç®€å•çš„Jestæ¨¡æ‹Ÿï¼Œä½†æ˜¯æ‚¨ä¹Ÿåº”è¯¥èƒ½å¤Ÿå°†å®ƒåº”ç”¨äºJesté—´è°å’Œæ¨¡å—æ¨¡æ‹Ÿã€‚å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ç§åŠŸèƒ½æ›´å…¨é¢çš„æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹<a class="ae kc" href="https://typescript-tdd.github.io/ts-auto-mock/" rel="noopener ugc nofollow" target="_blank"> ts-auto-mock </a>ã€‚æ„Ÿè°¢é˜…è¯»ï¼</p><h2 id="4f26" class="mn lc iq bd ld ne nf dn lh ng nh dp ll ko ni nj lp ks nk nl lt kw nm nn lx no bi translated"><strong class="ak">ç®€æ˜è‹±è¯­ç¬”è®°</strong></h2><p id="b978" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">ä½ çŸ¥é“æˆ‘ä»¬æ¨å‡ºäº†ä¸€ä¸ªYouTubeé¢‘é“å—ï¼Ÿæˆ‘ä»¬åˆ¶ä½œçš„æ¯ä¸ªè§†é¢‘éƒ½æ—¨åœ¨æ•™ç»™ä½ ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚ç‚¹å‡»æ­¤å¤„ æŸ¥çœ‹æˆ‘ä»¬ï¼Œå¹¶ç¡®ä¿è®¢é˜…è¯¥é¢‘é“ğŸ˜</p></div></div>    
</body>
</html>