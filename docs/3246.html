<html>
<head>
<title>Create MongoDB database models in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中创建MongoDB数据库模型</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-models-and-database-3836f0c7f2da?source=collection_archive---------6-----------------------#2020-09-13">https://javascript.plainenglish.io/node-js-models-and-database-3836f0c7f2da?source=collection_archive---------6-----------------------#2020-09-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/77bad58f543ac1bcb6fb71b4c1504289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQAZ2YrXqmmrsKMFM4-oMw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Cover Image</figcaption></figure><p id="9e88" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">MongoDB是一个开源的、跨平台的文档存储NoSQL数据库，它帮助我们以类似于JSON的文档的形式存储和检索数据。NoSQL是我们关系数据库的替代品。当我们处理大量数据时，NoSQL数据库非常有用。MongoDB是NoSQL的数据库之一。</p><p id="f95a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">像其他NoSQL数据库一样，MongoDB也需要预定义的模式。MongoDB可以存储任何类型的数据，并且可以灵活地在文档中创建任意数量的字段。他们使用嵌入式文档。这减少了对数据库连接的需求，从而降低了成本。</p></div><div class="ab cl kx ky hr kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ig ih ii ij ik"><h2 id="70ae" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated"><strong class="ak">目录</strong></h2><ol class=""><li id="6a59" class="lx ly in kb b kc lz kg ma kk mb ko mc ks md kw me mf mg mh bi translated"><a class="ae mi" href="#d943" rel="noopener ugc nofollow">创建节点Js项目</a></li><li id="7c01" class="lx ly in kb b kc mj kg mk kk ml ko mm ks mn kw me mf mg mh bi translated"><a class="ae mi" href="#865e" rel="noopener ugc nofollow">连接到MongoDB数据库</a></li><li id="02e2" class="lx ly in kb b kc mj kg mk kk ml ko mm ks mn kw me mf mg mh bi translated"><a class="ae mi" href="#7cdf" rel="noopener ugc nofollow">创建模型</a></li></ol></div><div class="ab cl kx ky hr kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ig ih ii ij ik"><h2 id="d943" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated"><strong class="ak"> 1。创建Node.js项目</strong></h2><p id="575f" class="pw-post-body-paragraph jz ka in kb b kc lz ke kf kg ma ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">用命令<code class="fe mr ms mt mu b">npm init</code>创建一个新目录并初始化节点。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="5007" class="le lf in mu b gy nd ne l nf ng">mkdir helloworld<br/>cd helloworld/<br/>npm init -y</span></pre><p id="bb4b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为了运行node js服务器，每当我修改代码时，我们都需要在终端中键入<code class="fe mr ms mt mu b">node index.js</code>。我觉得很难。所以我开始用nodemon。这是一个简单的工具，当代码发生变化时，它会自动重启服务器。下面的命令将nodemon安装到我们的项目中。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="ae5f" class="le lf in mu b gy nd ne l nf ng">npm install -g nodemon</span></pre><p id="70b7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">设置nodemon非常简单。把<code class="fe mr ms mt mu b">node</code>换成<code class="fe mr ms mt mu b">nodemon</code>就行了。现在，当你在终端输入<code class="fe mr ms mt mu b">nodemon index.js</code>时，服务器将会运行，当你修改代码时，它会自动重启服务器。</p><p id="5f42" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，为了让我的服务器输入<code class="fe mr ms mt mu b">npm start,</code>，我在启动脚本部分添加了<code class="fe mr ms mt mu b">nodemon index.js</code>。</p><p id="76fe" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mr ms mt mu b">package.json</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="6f7a" class="le lf in mu b gy nd ne l nf ng">"scripts": {<br/>   <strong class="mu io">"start": "nodemon index.js",</strong><br/>   "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>},</span></pre><p id="f2e1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们创建我们的服务器。在这里，我们使用<code class="fe mr ms mt mu b">Express.js</code>创建我们的服务器。Express JS是node JS的开源web框架。以下命令将express安装到我们的项目中。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="9cbc" class="le lf in mu b gy nd ne l nf ng">npm install express --save</span></pre><div class="nh ni gp gr nj nk"><a href="https://expressjs.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">Express - Node.js web应用程序框架</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">Express是一个最小且灵活的Node.js web应用程序框架，它为web和…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">expressjs.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny jt nk"/></div></div></a></div><p id="455a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">安装后，只需创建一个名为<code class="fe mr ms mt mu b">index.js</code>的新文件，这将是我们的服务器文件。</p><p id="bdf7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mr ms mt mu b">index.js</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="bcef" class="le lf in mu b gy nd ne l nf ng"><strong class="mu io">var express = require('express');<br/>var app = express();</strong></span><span id="0ca9" class="le lf in mu b gy nz ne l nf ng">app.get('/', function (req, res) {<br/>  res.send('Hello World!');<br/>});</span><span id="bc78" class="le lf in mu b gy nz ne l nf ng"><strong class="mu io">app.listen(8000, function () {<br/>  console.log('Listening to Port 8000');<br/>});</strong></span></pre><p id="6a62" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在启动服务器，您应该看到浏览器中显示hello world。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="e76d" class="le lf in mu b gy nd ne l nf ng">npm start</span></pre><h2 id="865e" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated">2.<strong class="ak">连接到MongoDB数据库</strong></h2><p id="8716" class="pw-post-body-paragraph jz ka in kb b kc lz ke kf kg ma ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">要将MongoDB连接到Node JS项目，您应该在我们的本地机器上安装MongoDB。从MongoDB官网安装。</p><div class="nh ni gp gr nj nk"><a href="https://docs.mongodb.com/manual/installation/" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">安装MongoDB - MongoDB手册</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">MongoDB Atlas是一个托管在云中的MongoDB服务选项，不需要安装开销和…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">docs.mongodb.com</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny jt nk"/></div></div></a></div><p id="f7ae" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">另外，安装MongoDB的任何一个GUI工具。我正在使用其中一个叫做<a class="ae mi" href="https://nosqlbooster.com/" rel="noopener ugc nofollow" target="_blank"> NoSqlBooster </a>的。</p><p id="f9b5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">安装好MongoDB后，安装<code class="fe mr ms mt mu b">mongoose</code>，这是MongoDB和Node js的对象数据建模库。它管理数据之间的关系，并提供模式验证。该命令安装mongoose。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="9f26" class="le lf in mu b gy nd ne l nf ng">npm i mongoose</span></pre><p id="c7ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们在mongoose的帮助下将MongoDB连接到Nodejs。只需将MongoDB连接字符串传递给mongoose就可以实现连接。</p><p id="64aa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mr ms mt mu b">index.js</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="a889" class="le lf in mu b gy nd ne l nf ng">var express = require('express');<br/>var app = express();<br/>const mongoose = require('mongoose');</span><span id="c405" class="le lf in mu b gy nz ne l nf ng">//Routes<br/>app.get('/', function (req, res) {<br/>    res.send('Hello World!');<br/>});</span><span id="6abb" class="le lf in mu b gy nz ne l nf ng"><strong class="mu io">//Database<br/>mongoose.connect('mongodb://localhost/test', {useNewUrlParser: true});</strong></span><span id="7d89" class="le lf in mu b gy nz ne l nf ng"><strong class="mu io">mongoose.connection.once('open',function(){<br/>    console.log('Database connected Successfully');<br/>}).on('error',function(err){<br/>    console.log('Error', err);<br/>})</strong></span><span id="839e" class="le lf in mu b gy nz ne l nf ng">app.listen(8000, function () {<br/>    console.log('Listening to Port 8000');<br/>});</span></pre><p id="73e9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，如果MongoDB服务器工作正常，服务器将向您发送一条成功的消息。如果不是，它将抛出错误。</p><h2 id="7cdf" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated">3.<strong class="ak">创建模型</strong></h2><p id="f6f6" class="pw-post-body-paragraph jz ka in kb b kc lz ke kf kg ma ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">在成功地将node与MongoDB连接起来之后，创建一个名为<code class="fe mr ms mt mu b">Models</code>的文件夹，所有的模式都将保存在这个文件夹中。在<code class="fe mr ms mt mu b">Models</code>文件夹中，创建一个名为<code class="fe mr ms mt mu b">emp.js</code>的文件。在这个文件中，创建一个名为<code class="fe mr ms mt mu b">empSchema</code>的模式，并声明所有需要的字段。最后，导出模式。</p><p id="7594" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mr ms mt mu b">Models/emp.js</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="bfc3" class="le lf in mu b gy nd ne l nf ng">const mongoose = require('mongoose');</span><span id="3c87" class="le lf in mu b gy nz ne l nf ng"><strong class="mu io">const empSchema = new mongoose.Schema({<br/>  empName: {<br/>    type: String,<br/>    required: true,<br/>  },</strong></span><span id="bd13" class="le lf in mu b gy nz ne l nf ng"><strong class="mu io">  empEmail: {<br/>    type: String,<br/>    required: true,<br/>  },<br/>})</strong></span><span id="a24a" class="le lf in mu b gy nz ne l nf ng">module.exports = mongoose.model('Emp',empSchema)</span></pre><p id="ae4d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">为了演示，我们从客户端发送JSON格式的数据。为此，我们需要一个名为<strong class="kb io"> Body-Parser的快速中间件。</strong>用下面的命令安装。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="2ca5" class="le lf in mu b gy nd ne l nf ng">npm install body-parser</span></pre><p id="e9a6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在我们的服务器文件中，我创建了一个将雇员数据插入数据库的路径<code class="fe mr ms mt mu b">/add</code>。</p><p id="f361" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在路线内部，只需创建一个对象<code class="fe mr ms mt mu b">emp</code>。然后输入<code class="fe mr ms mt mu b">emp.save()</code>，将我们的数据插入数据库。</p><p id="2011" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe mr ms mt mu b">index.js</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="6521" class="le lf in mu b gy nd ne l nf ng">var express = require('express');<br/>var app = express();<br/>const mongoose = require('mongoose');<br/><strong class="mu io">const bodyParser  = require('body-parser');</strong></span><span id="616c" class="le lf in mu b gy nz ne l nf ng">//Routes<br/><strong class="mu io">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: false }));<br/></strong>app.get('/', function (req, res) {<br/>    res.send('Hello World!');<br/>});</span><span id="2921" class="le lf in mu b gy nz ne l nf ng">app.post('/add', function(req,res) {<br/><strong class="mu io">  const emp = new Emp({<br/>    empName: req.body.empName,<br/>    empEmail: req.body.empEmail,<br/>  });</strong><br/><strong class="mu io">  emp.save()</strong>.then(val =&gt; {<br/>    res.json({ msg: "Employee Added Successfully", val: val })<br/>  })<br/>})</span><span id="8840" class="le lf in mu b gy nz ne l nf ng">//Database<br/>mongoose.connect('mongodb://localhost/test', {useNewUrlParser: true});</span><span id="804d" class="le lf in mu b gy nz ne l nf ng">mongoose.connection.once('open',function(){<br/>    console.log('Database connected Successfully');<br/>}).on('error',function(err){<br/>    console.log('Error', err);<br/>})</span><span id="ef87" class="le lf in mu b gy nz ne l nf ng">app.listen(8000, function () {<br/>    console.log('Listening to Port 8000');<br/>});</span></pre><p id="b49a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">用<code class="fe mr ms mt mu b">empName</code>和<code class="fe mr ms mt mu b">empEmail</code>向<a class="ae mi" href="http://localhost:8000/add" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/add</a>发出post请求。如果请求有效，mongoose会将值插入empSchema。如果没有，mongoose会向我们抛出错误。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/7dcd8feecefe291ee02e1f3e76df66a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJuR1PMQxgvdgZKxmZ97Ug.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Post request to Emp Model</figcaption></figure><p id="2686" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是我的MongoDB数据库在插入值后的样子。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/5a546ba9ae1082d7bf25700580bf0b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Lxp6oCs7fzhDxJhf--uNw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">The schema looks like this in NoSQL booster</figcaption></figure><p id="2673" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae mi" href="https://medium.com/@sjlouji10/node-js-router-and-routes-a4a3cfced5c4" rel="noopener">一定要看看我之前的博客，在那里我解释了关于Nodejs路由的问题。</a></p><p id="2c3c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如有任何疑问，请随时联系我。电子邮件:sjlouji10@gmail.com。领英:<a class="ae mi" href="https://www.linkedin.com/in/sjlouji/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/sjlouji/</a></p><p id="4bba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我的GitHub上的完整代码:</p><div class="nh ni gp gr nj nk"><a href="https://github.com/sjlouji/Node-JS-Basics---Medium" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">sjlouji/Node-JS-basic-Medium</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">快速路由节点。在GitHub上创建一个帐户，为sjlouji/Node-JS-Basics - Medium开发做贡献。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="od l nv nw nx nt ny jt nk"/></div></div></a></div><p id="eb05" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">编码快乐！</p></div></div>    
</body>
</html>