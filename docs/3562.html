<html>
<head>
<title>Better JavaScript — Function Declarations in Blocks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更好的JavaScript——块中的函数声明</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/better-javascript-function-declarations-in-blocks-3cb289c9a1d?source=collection_archive---------12-----------------------#2020-10-08">https://javascript.plainenglish.io/better-javascript-function-declarations-in-blocks-3cb289c9a1d?source=collection_archive---------12-----------------------#2020-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3696981609d010c77461ed41f9100c23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aRIiuyaLh9fjeTJr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@nicolasreymond?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">nicolas reymond</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b79e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，JavaScript应用程序也必须写得很好。</p><p id="9a1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们以后会遇到各种各样的问题。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究改进JavaScript代码的方法。</p><h1 id="e09c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">块函数声明的不可移植范围</h1><p id="07f3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该在一个块中有函数声明。</p><p id="e86c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不是有效的JavaScript，但它仍然被大多数JavaScript引擎所允许。</p><p id="7f21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为我们对它产生的结果有疑问。</p><p id="5afb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6ebb" class="mn lc iq mj b gy mo mp l mq mr">function foo(x) {<br/>  function f() {<br/>    return "bar";<br/>  }<br/>  var result = [];<br/>  if (x) {<br/>    result.push(f());<br/>  }</span><span id="ddc7" class="mn lc iq mj b gy ms mp l mq mr">  result.push(f());<br/>  return result;<br/>}<br/>console.log(foo(true));<br/>console.log(foo(false));</span></pre><p id="b56b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="657d" class="mn lc iq mj b gy mo mp l mq mr">["bar", "bar"]<br/>["bar"]</span></pre><p id="13ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就像我们期望的那样，因为我们将<code class="fe mt mu mv mj b">f</code>的返回结果推送到<code class="fe mt mu mv mj b">result</code>数组。</p><p id="9b75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是当我们有这样的事情:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="995c" class="mn lc iq mj b gy mo mp l mq mr">function f() {<br/>  return "global";<br/>}</span><span id="e002" class="mn lc iq mj b gy ms mp l mq mr">function foo(x) {<br/>  var result = [];<br/>  if (x) {<br/>    function f() {<br/>      return "bar";<br/>    }<br/>    result.push(f());<br/>  }<br/>  result.push(f());<br/>  return result;<br/>}<br/>console.log(foo(true));<br/>console.log(foo(false));</span></pre><p id="0d2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么第二个<code class="fe mt mu mv mj b">foo</code>调用将不会运行，因为<code class="fe mt mu mv mj b">f</code>被认为是内部调用。</p><p id="bbed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一件会让很多人犯错的事情。</p><p id="a472" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript引擎仍然允许code函数，但是我们会得到这样奇怪的结果。</p><p id="9059" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">函数声明不应该在另一个块或函数中，所以我们应该避免这种情况。</p><p id="9edd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该做的是要么把内部函数放在外部，要么把它赋给一个局部变量。</p><p id="3933" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="42b3" class="mn lc iq mj b gy mo mp l mq mr">function f() {<br/>  return "global";<br/>}</span><span id="10f3" class="mn lc iq mj b gy ms mp l mq mr">function test(x) {<br/>  var result = [];<br/>  if (x) {<br/>    const g = f;<br/>    result.push(g());<br/>  }<br/>  result.push(f());<br/>  return result;<br/>}</span></pre><p id="d582" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么范围就不会有任何问题。</p><h1 id="f274" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不要用eval创建局部变量</h1><p id="5aec" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mt mu mv mj b">eval</code>由于其安全性和性能问题，绝对不应该使用。</p><p id="23ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个不好的地方是用它创建局部变量。</p><p id="18f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c211" class="mn lc iq mj b gy mo mp l mq mr">function foo(x) {<br/>  eval("var y = x;");<br/>  return y;<br/>}</span><span id="f77a" class="mn lc iq mj b gy ms mp l mq mr">console.log(foo("bar"));</span></pre><p id="3077" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们看到<code class="fe mt mu mv mj b">'bar'</code>被记录。</p><p id="9211" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过在传递给<code class="fe mt mu mv mj b">eval</code>的字符串中给变量<code class="fe mt mu mv mj b">x</code>赋值来创建变量<code class="fe mt mu mv mj b">y</code>。</p><p id="97c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们让<code class="fe mt mu mv mj b">eval</code>调用有条件，问题就出现了。</p><p id="5d99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0947" class="mn lc iq mj b gy mo mp l mq mr">var y = "global";</span><span id="c4ac" class="mn lc iq mj b gy ms mp l mq mr">function foo(x) {<br/>  if (x) {<br/>    eval("var y = 'local';");<br/>  }<br/>  return y;<br/>}<br/>console.log(foo(true)); <br/>console.log(foo(false));</span></pre><p id="ef0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后根据我们在<code class="fe mt mu mv mj b">foo</code>中的条件进行范围界定。</p><p id="2d38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这肯定是一个问题，因为我们必须检查代码，而代码是一个字符串。</p><p id="8bd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个不好的方面是我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f8d4" class="mn lc iq mj b gy mo mp l mq mr">var y = "global";</span><span id="6c01" class="mn lc iq mj b gy ms mp l mq mr">function bar(src) {<br/>  eval(src);<br/>  return y;<br/>}<br/>console.log(bar("var y = 'bar';")); <br/>console.log(bar("var z = 'bar';"));</span></pre><p id="be09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个字符串被传入<code class="fe mt mu mv mj b">bar</code>函数，我们用它运行<code class="fe mt mu mv mj b">eval</code>。</p><p id="c571" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这用外部定义的额外变量污染了<code class="fe mt mu mv mj b">bar</code>函数的范围。</p><p id="0a6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就更混乱了。</p><p id="004d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是我们不应该出于任何目的使用<code class="fe mt mu mv mj b">eval</code>的更多原因。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/03b50ca782c9cdece85b9f892edb72eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c3RAZbex9bs7F5Tb"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@meric?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Meriç Dağlı</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="804a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f13e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们不应该在另一个块中有函数声明。</p><p id="a175" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不是有效的JavaScript，但仍然是允许的。</p><p id="9e9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们不应该在任何情况下使用<code class="fe mt mu mv mj b">eval</code>。</p><p id="2da7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果是这样，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅解码获得更多类似内容，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>