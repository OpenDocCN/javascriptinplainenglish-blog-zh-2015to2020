<html>
<head>
<title>Creating Axios mock requests in Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Jest中创建Axios模拟请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/axios-mock-jest-13a19651ab0c?source=collection_archive---------0-----------------------#2019-06-16">https://javascript.plainenglish.io/axios-mock-jest-13a19651ab0c?source=collection_archive---------0-----------------------#2019-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="98d9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何为Jest创建自己的可重用axios模拟请求函数？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6641fa8aa07f5108d75a916422bc27a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rb4FGtrP4okA0A8MEBLLfA.png"/></div></div></figure><h1 id="e0a9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">假设我有一个名为<strong class="ak"> loadData </strong>的方法，它负责从REST get端点加载数据。</h1><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="528f" class="lo ks iq lk b gy lp lq l lr ls">loadData = () =&gt; {<br/>    Axios.get(“https://jsonplaceholder.typicode.com/users")<br/>}</span></pre><p id="f3d6" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">现在我们想在上面写测试。</p><p id="d4fc" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">让我们写一些关于这个方法的测试。</p><h2 id="1a7d" class="lo ks iq bd kt mp mq dn kx mr ms dp lb mc mt mu ld mg mv mw lf mk mx my lh mz bi translated"><strong class="ak">测试1 </strong>:方法已实施</h2><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="6462" class="lo ks iq lk b gy lp lq l lr ls">expect(instance.loadData).toBeDefined()//Instance is your class or component shallow instance</span></pre><h2 id="c794" class="lo ks iq bd kt mp mq dn kx mr ms dp lb mc mt mu ld mg mv mw lf mk mx my lh mz bi translated">测试2:现在让我们创建一个模拟axios响应，看看这个方法返回了什么。</h2><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="7a64" class="lo ks iq lk b gy lp lq l lr ls">import axios from "axios";<br/>jest.mock("axios") //Add this on top of your test file.</span></pre><p id="033b" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">现在让我们将<strong class="lv ir">的loadData </strong>设为<strong class="lv ir">异步</strong></p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="de61" class="lo ks iq lk b gy lp lq l lr ls">loadData = async ()=&gt;{<br/>    Axios.get(“https://jsonplaceholder.typicode.com/users")<br/>}</span></pre><p id="cdaa" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">让我们考虑我们的mockAxios返回一些数据，如</p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="be90" class="lo ks iq lk b gy lp lq l lr ls"> {data:”some data”}</span></pre><p id="e349" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">因此，我们的方法<strong class="lv ir"> loadData </strong>将返回与响应相同的数据。</p><p id="7b85" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">我们的测试应该是这样的:</p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="849e" class="lo ks iq lk b gy lp lq l lr ls">axios.get.mockResolvedValue({data:"some data"});<br/>const result = await instance.loadData()<br/>expect(result).toEqual({data:”some data”})</span></pre><h2 id="4cbf" class="lo ks iq bd kt mp mq dn kx mr ms dp lb mc mt mu ld mg mv mw lf mk mx my lh mz bi translated">测试3:这个测试覆盖了带有<strong class="ak">mockreptedvalue的axios的catch情况。</strong></h2><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="688b" class="lo ks iq lk b gy lp lq l lr ls">axios.get.mockRejectedValue({error:"some error"});<br/>  await instance.loadData().catch(err =&gt; {<br/>  expect(err).toEqual({error:”some error”});<br/>})</span></pre><p id="f129" class="pw-post-body-paragraph lt lu iq lv b lw lx jr ly lz ma ju mb mc md me mf mg mh mi mj mk ml mm mn mo ij bi translated">现在完成了！</p></div></div>    
</body>
</html>