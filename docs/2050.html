<html>
<head>
<title>Cheerio Script for Turning HTML Pages Into JSON Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将HTML页面转换成JSON文件的Cheerio脚本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/cheerio-script-for-turning-html-pages-into-json-files-8e9363106904?source=collection_archive---------1-----------------------#2020-05-16">https://javascript.plainenglish.io/cheerio-script-for-turning-html-pages-into-json-files-8e9363106904?source=collection_archive---------1-----------------------#2020-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bb57" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Cheerio和Node.js的Web scraper</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b1d3033393fddf1a2491fcddd7cd75e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*haMEQHfMceoIpoEs30wzuA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@grakozy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Greg Rakozy</a> on <a class="ae kv" href="https://unsplash.com/s/photos/html?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5689" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您需要将内容从一个博客迁移到另一个博客时，您会怎么做？</p><p id="2661" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理想情况下，<a class="ae kv" href="https://medium.com/frontend-digest/beginners-guide-to-apis-protocols-and-data-formats-f80cf7f30425" rel="noopener">你使用一个API </a>。但是如果origin blog没有提供，您可能需要构建自己的脚本来抓取页面并以所需的格式获取所有内容。</p><p id="7c79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您正在抓取具有相似结构的纯HTML页面，您可以使用Cheerio和Node.js来获取内容并将其作为JSON输出。</p><p id="c208" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这并不是唯一的选择，但是如果您已经了解一些JavaScript，并且没有处理动态内容，这可能是最简单的。对于抓取包含JS的更复杂的页面，您可能希望使用像Puppeteer这样的工具。</p><p id="7eff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为先决条件，您应该已经知道您希望JSON文件是什么样子，所以您应该在示例文件中有一个清晰的结构。没有这个，您将能够获得数据，但是当您需要重构时，事情会变得混乱。</p><h1 id="5eb4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是Cheerio，它有什么作用？</h1><p id="6943" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><a class="ae kv" href="https://cheerio.js.org/" rel="noopener ugc nofollow" target="_blank"> Cheerio </a>解析HTML标记，并提供一个API来操作和遍历结果数据结构。由于它使用核心jQuery的子集，Cheerio有一个熟悉的语法，因此对于初学者来说更容易使用。</p><p id="b56b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该工具可以解析任何普通的HTML页面，因为它使用简单一致的DOM模型。操作快速高效，所以如果你只需要抓取内容，不需要应用CSS或者执行JavaScript代码，Cheerio是一个非常好的选择。</p><h1 id="623d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Web scraper解析HTML并输出JSON</h1><p id="7987" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对于这个演示，我将使用Cheerio构建一个简单的web scraper，它从一个页面获取所有内容，并在同一个文件夹中输出一个JSON文件。</p><p id="94e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着，我们实际上将创建一个新文件来保存这些数据，而不是仅仅在控制台中记录JSON数据，以便以后可以轻松地重用这些数据。</p><p id="df79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将抓取的数据将来自<a class="ae kv" href="https://www.16personalities.com/intj-personality" rel="noopener ugc nofollow" target="_blank">这一页</a>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/f4ec1cdba2364f9a028108afd14c949f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nipWFj3qfS9FeAhJRDYflw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image via <a class="ae kv" href="https://www.16personalities.com/intj-personality" rel="noopener ugc nofollow" target="_blank">16personalities.com</a></figcaption></figure><p id="93aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注</strong>:搜集数据不是最道德的事情，所以我不鼓励你为了学习以外的目的去做这件事。当然，如果您正在创建一个用于迁移您自己的内容的脚本，这是一种不同的情况。</p><p id="3293" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到教程。我希望我的最终JSON文件具有以下结构:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="d09c" class="mv lt iq mr b gy mw mx l my mz">const contentJSON = {<br/>  title: '',<br/>  description: '',<br/>  heroBanner: {<br/>    src: '',<br/>    altText: '',<br/>  },<br/>  introText: '',<br/>  artBody: {<br/>    sections: '' // This will include all the body content<br/>  },<br/>};</span></pre><h2 id="d70e" class="mv lt iq bd lu na nb dn ly nc nd dp mc lf ne nf me lj ng nh mg ln ni nj mi nk bi translated">安装依赖项</h2><p id="8959" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了构建scraper，我将不仅使用Cheerio，还将使用<code class="fe nl nm nn mr b">axios</code>作为依赖项，并且我将使用<a class="ae kv" href="https://nodejs.dev/the-nodejs-fs-module" rel="noopener ugc nofollow" target="_blank"> Node.js文件系统模块</a>。</p><p id="bda3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，创建一个新文件夹，用于存储本教程的所有文件。然后，打开VSCode，在终端中运行下面的命令来初始化<code class="fe nl nm nn mr b">npm.</code></p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="9b9d" class="mv lt iq mr b gy mw mx l my mz">npm init </span><span id="ac8a" class="mv lt iq mr b gy no mx l my mz">// Press enter at every step to accept the default setup </span><span id="a279" class="mv lt iq mr b gy no mx l my mz">npm install </span></pre><p id="891a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到创建了一个名为node_modules的新文件夹，以及两个文件:package.json和package-lock.json。</p><p id="616b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们通过运行以下命令来安装依赖项:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="ae36" class="mv lt iq mr b gy mw mx l my mz">npm install cheerio axios</span></pre><p id="b36c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn mr b">Axios</code>是一个让<a class="ae kv" href="https://medium.com/@andreea.macoveiciuc/beginners-guide-to-apis-protocols-and-data-formats-f80cf7f30425" rel="noopener"> HTTP请求</a>的包。至于Node.js文件系统模块，如果您安装了Node，就可以使用它了。我们将需要这个模块能够创建新的文件，将存储抓取的内容。</p><h1 id="9460" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">建造Cheerio铲运机</h1><p id="a985" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在项目文件夹中，创建一个名为<code class="fe nl nm nn mr b">scraper.js</code>的新文件。在内部，添加以下代码:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="7c57" class="mv lt iq mr b gy mw mx l my mz">const axios = require('axios');<br/>const cheerio = require('cheerio');</span><span id="77eb" class="mv lt iq mr b gy no mx l my mz">const url = '<a class="ae kv" href="https://www.16personalities.com/intj-personality" rel="noopener ugc nofollow" target="_blank">https://www.16personalities.com/intj-personality</a>';</span></pre><p id="a4d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将启动Axios调用，从目标URL获取信息:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="1718" class="mv lt iq mr b gy mw mx l my mz">axios.get(url).then( res =&gt; { console.log(res.data) })</span></pre><p id="93c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Axios将进行HTTP调用，然后当它得到响应时，它将执行在<code class="fe nl nm nn mr b">res</code>之后的代码。现在，我们只是访问<code class="fe nl nm nn mr b">res</code>或响应对象，并检索服务器发回的数据。</p><p id="21bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们保存了文件，我们就可以运行这个脚本来查看我们是否得到了任何数据。为此，请在终端中键入以下命令:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5513" class="mv lt iq mr b gy mw mx l my mz">node scraper.js</span></pre><p id="930c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你现在应该看到控制台中记录了很多代码，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/7fc5259b16423f2b679b004ec4f6d582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cebTWxkmqNo9STKTJKt8oQ.png"/></div></div></figure><p id="83ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这实际上没有什么帮助，因为我们想要更多的结构化内容，然后我们可以用一种易于处理的格式输出。</p><p id="f57c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们调整我们的代码。首先，我们需要将数据加载到一个变量中，这样我们就可以轻松地使用Cheerio方法来遍历和操作它。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="0f0b" class="mv lt iq mr b gy mw mx l my mz">axios.get(url).then((res) =&gt; {<br/>  const $ = cheerio.load(res.data);<br/>});</span></pre><p id="b2d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看原始页面，看看我们如何能够挂钩到我们想要拉的元素。</p><p id="973d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">挂钩DOM和检索数据的最简单的方法是查找id或类，但是您也可以使用简单的选择器，如用于标题的<code class="fe nl nm nn mr b">&lt;h1&gt;</code>等等。让我们检查一下这个页面，看看我们能使用什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/3a353d9896193d464e4c05b89f24f9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nIsEvKjG00ClGplqLN_Ew.png"/></div></div></figure><p id="af8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于页面标题，我可以拉出位于<code class="fe nl nm nn mr b">div class="type-info"</code>元素内部的<code class="fe nl nm nn mr b">h1</code>标签。</p><p id="d7c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将把我想要的JSON数据与抓取的页面中的元素进行映射，这样可以更容易地编写脚本，而不必每次都检查每个元素。</p><ul class=""><li id="5338" class="nr ns iq ky b kz la lc ld lf nt lj nu ln nv lr nw nx ny nz bi translated">标题:将在<code class="fe nl nm nn mr b">&lt;div class=”type-info”&gt;</code>中使用<code class="fe nl nm nn mr b">h1</code></li><li id="56f1" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated">描述:将在<code class="fe nl nm nn mr b">&lt;div class=”definition”&gt;</code>中使用第二个<code class="fe nl nm nn mr b">p</code>标签</li><li id="9008" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated">heroBanner:将在<code class="fe nl nm nn mr b">&lt;header class=”type-header”&gt;</code>中使用第一个<code class="fe nl nm nn mr b">img</code>标签</li><li id="72fe" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated">introText:将使用与描述相同的文本，因为描述内容将仅在迁移期间用作元描述</li><li id="a8ba" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated">sections:将对页面上的每个部分使用第一个<code class="fe nl nm nn mr b">p</code>和第一个<code class="fe nl nm nn mr b">h2 </code>。这些部分都以<code class="fe nl nm nn mr b"> h2</code>开始，后面跟着一个<code class="fe nl nm nn mr b">p</code>标签，除了第一段，它是在<code class="fe nl nm nn mr b">&lt;blockquote&gt;</code>标签下面的第一个<code class="fe nl nm nn mr b"> p</code></li></ul><p id="589c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们准备好创建我们的脚本了！这是我们到目前为止所拥有的:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5601" class="mv lt iq mr b gy mw mx l my mz">const axios = require("axios");<br/>const cheerio = require("cheerio");</span><span id="48c7" class="mv lt iq mr b gy no mx l my mz">const url = "<a class="ae kv" href="https://www.16personalities.com/intj-personality" rel="noopener ugc nofollow" target="_blank">https://www.16personalities.com/intj-personality</a>";</span><span id="d4a9" class="mv lt iq mr b gy no mx l my mz">axios.get(url).then((res) =&gt; {<br/>  const $ = cheerio.load(res.data);<br/>});</span></pre><p id="7ac8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的<code class="fe nl nm nn mr b">html</code>主体被加载到<code class="fe nl nm nn mr b"> $ variable</code>中，因此为了在其上使用任何方法，我们将调用这个变量。Cheerio使用jQuery语法，所以我们可以使用任何已知的方法。</p><p id="7359" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们首先抓取标题并将其记录在控制台中，看看它是否工作正常。在<code class="fe nl nm nn mr b">const $</code>行的正下方添加代码。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5aef" class="mv lt iq mr b gy mw mx l my mz">console.log($(".type-info").find("h1"));</span></pre><p id="fd1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们现在使用命令<code class="fe nl nm nn mr b">node script.js</code>运行脚本，我们又会得到一些不太有用的数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/573a73f0b6659c7e99e295f6744ab1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*LKxjHeyPEemc0-lWebPVWg.png"/></div></figure><p id="727f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了提取实际的标题内容，我们需要调整上面的行，如下所示:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="081c" class="mv lt iq mr b gy mw mx l my mz">axios.get(url).then((res) =&gt; {<br/>  const $ = cheerio.load(res.data);</span><span id="f443" class="mv lt iq mr b gy no mx l my mz">console.log($(".type-info").find("h1").text());<br/>});</span></pre><p id="0b0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们应该看到控制台中记录的标题:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/bef3e5f2da4dcb5bc65eb675443b88f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*fk842tVq96WrMR3Kbr7YPg.png"/></div></div></figure><p id="347e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了，现在我们知道脚本正在运行，所以我们将构建其余的scraper，然后再次记录它。在我们得到所有想要的内容后，我们将使用文件系统创建一个新文件，并在那里输出JSON数据。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="04b9" class="mv lt iq mr b gy mw mx l my mz">axios.get(url).then((res) =&gt; {<br/>  const $ = cheerio.load(res.data);</span><span id="c6b6" class="mv lt iq mr b gy no mx l my mz">const artTitle = $(".type-info").find("h1").text();<br/>  const artDescription = $(".definition").find("p").next();<br/>  const heroBanner = $("header[class='type-header']").find(<br/>    "img"<br/>  );<br/>  const artIntro = artDescription;</span><span id="97ce" class="mv lt iq mr b gy no mx l my mz">// Our JSON output</span><span id="e9c6" class="mv lt iq mr b gy no mx l my mz">const contentJSON = {<br/>    title: artTitle.trim(),<br/>    description: artDescription.text().trim(),<br/>    heroBanner: {<br/>      url: heroBanner.attr("src"),<br/>      altText: heroBanner.attr("alt"),<br/>    },<br/>    introText: artIntro.text().trim(),<br/>    // artBody: {<br/>    //   sections: getSections(),<br/>    // },<br/>  };</span><span id="f696" class="mv lt iq mr b gy no mx l my mz">console.log(contentJSON);<br/>});</span></pre><p id="6cd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们运行这段代码，我们会在控制台中得到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/8458577c9ec8321698e23b05fbac5a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*83ZffWe7_m9cRuGo3kv_KQ.png"/></div></div></figure><p id="023b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完美，现在我来快速解释一下上面的代码。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="8aa1" class="mv lt iq mr b gy mw mx l my mz">const artTitle = $(".type-info").find("h1").text();</span><span id="23c3" class="mv lt iq mr b gy no mx l my mz">// This searches inside the html body an element with the class type-info, then inside it, the first h1, and pulls only the text, not the full html code.</span><span id="16de" class="mv lt iq mr b gy no mx l my mz">const artDescription = $(".definition").find("p").next();</span><span id="faf9" class="mv lt iq mr b gy no mx l my mz">// This looks at the element with the class definition, finds the first p, then pulls the next one. So basically it gets the second paragraph. </span><span id="c285" class="mv lt iq mr b gy no mx l my mz">const heroBanner = $("header[class='type-header']").find("img");</span><span id="0740" class="mv lt iq mr b gy no mx l my mz">// This searches for the header tag which has the class type-header, and inside it, finds the img element.</span><span id="6dc8" class="mv lt iq mr b gy no mx l my mz">const artIntro = artDescription;</span><span id="01ab" class="mv lt iq mr b gy no mx l my mz">// This reuses the artDescription variable that we defined above.</span></pre><p id="e7f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在contentJSON对象中，我们有以下内容:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="8b01" class="mv lt iq mr b gy mw mx l my mz">title: artTitle.trim(),<br/>    description: artDescription.text().trim(),<br/>    heroBanner: {<br/>      url: heroBanner.attr("src"),<br/>      altText: heroBanner.attr("alt"),<br/>    },<br/>    introText: artIntro.text().trim(),</span></pre><p id="d598" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn mr b">trim()</code>方法删除文本周围的任何空白，只返回文本本身。</p><p id="57ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn mr b">.attr(‘src’)</code>和<code class="fe nl nm nn mr b">.attr(‘alt’)</code>方法搜索heroBanner变量存储的<code class="fe nl nm nn mr b">img</code>标签中的属性。</p><p id="3705" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在更具挑战性的部分来了。如果可能的话，我们希望以更自动化的方式检索其余的内容，这样我们就不必重复编写相同的代码五次。</p><p id="243d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们试着创建一个循环遍历body元素的函数，每当它发现一个<code class="fe nl nm nn mr b">h2 </code>标记时，它就在JSON对象中创建一个带有关键字‘heading’的条目。</p><p id="3439" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将对所有段落做同样的事情:我们将遍历正文，对于找到的每个段落，我们将在JSON对象中推入一个“text”键，以及它各自的值。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="e8bc" class="mv lt iq mr b gy mw mx l my mz">const getSections = function () {<br/> const sectionTexts = [];</span><span id="8ab1" class="mv lt iq mr b gy no mx l my mz"> const artBody = $("article").children();</span><span id="ef82" class="mv lt iq mr b gy no mx l my mz"> artBody.each((i, element) =&gt; {<br/>    const heading = $(element).filter("h2").text().trim();<br/>    const text = $(element).filter("p").text().trim();<br/>    const img = $(element).filter("img");<br/>    const quote = $(element).find(".description - pullout").first();</span><span id="791a" class="mv lt iq mr b gy no mx l my mz"> if (text) {<br/>      sectionTexts[i] = {<br/>        text: text,<br/>      };<br/>    } else if (heading) {<br/>      sectionTexts[i] = {<br/>        heading: heading,<br/>      };<br/>    } else if (img) {<br/>      sectionTexts[i] = {<br/>        image: img.attr("src"),<br/>        altText: img.attr("alt"),<br/>      };<br/>    } else if (quote) {<br/>      sectionTexts[i] = {<br/>        quote: quote,<br/>      };<br/>    }<br/>  });</span><span id="49fd" class="mv lt iq mr b gy no mx l my mz">return sectionTexts;<br/>};</span></pre><p id="4b31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们需要在最终的contentJSON对象中输出所有这些内容:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="7c89" class="mv lt iq mr b gy mw mx l my mz">const contentJSON = {<br/>  title: artTitle.trim(),<br/>  description: artDescription.text().trim(),<br/>  heroBanner: {<br/>    url: heroBanner.attr("src"),<br/>    altText: heroBanner.attr("alt"),<br/>  },<br/>  introText: artIntro.text().trim(),<br/>  artBody: getSections(),<br/>};</span></pre><p id="7648" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，让我们添加创建新文件的代码，在该文件中添加我们收集的数据:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="71d9" class="mv lt iq mr b gy mw mx l my mz">const artFinal = JSON.stringify(contentJSON);<br/>const filename = artTitle.slice(0, 9).trim() + ".json";<br/>fs.writeFileSync(filename, artFinal);</span></pre><p id="7793" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现这一点，我们还需要在开头添加这一行:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="6f62" class="mv lt iq mr b gy mw mx l my mz">const fs = require('fs');</span></pre><p id="e27d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的最终代码如下所示:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5d60" class="mv lt iq mr b gy mw mx l my mz">const axios = require("axios");<br/>const cheerio = require("cheerio");<br/>const fs = require("fs");</span><span id="b9c8" class="mv lt iq mr b gy no mx l my mz">const url = "<a class="ae kv" href="https://www.16personalities.com/intj-personality" rel="noopener ugc nofollow" target="_blank">https://www.16personalities.com/intj-personality</a>";</span><span id="681b" class="mv lt iq mr b gy no mx l my mz">axios.get(url).then((res) =&gt; {<br/>  const $ = cheerio.load(res.data);</span><span id="ac62" class="mv lt iq mr b gy no mx l my mz">const artTitle = $(".type-info").find("h1").text();<br/>  const artDescription = $(".definition").find("p").next();<br/>  const heroBanner = $("header[class='type-header']").find("img");<br/>  const artIntro = artDescription;</span><span id="b7df" class="mv lt iq mr b gy no mx l my mz">const getSections = function () {<br/>    const sectionTexts = [];</span><span id="5a55" class="mv lt iq mr b gy no mx l my mz">const artBody = $("article").children();</span><span id="4120" class="mv lt iq mr b gy no mx l my mz">artBody.each((i, element) =&gt; {<br/>      const heading = $(element).filter("h2").text().trim();<br/>      const text = $(element).filter("p").text().trim();<br/>      const img = $(element).filter("img");<br/>      const quote = $(element).find(".description - pullout").first();</span><span id="7d28" class="mv lt iq mr b gy no mx l my mz">if (text) {<br/>        sectionTexts[i] = {<br/>          text: text,<br/>        };<br/>      } else if (heading) {<br/>        sectionTexts[i] = {<br/>          heading: heading,<br/>        };<br/>      } else if (img) {<br/>        sectionTexts[i] = {<br/>          image: img.attr("src"),<br/>          altText: img.attr("alt"),<br/>        };<br/>      } else if (quote) {<br/>        sectionTexts[i] = {<br/>          quote: quote,<br/>        };<br/>      }<br/>    });</span><span id="cef9" class="mv lt iq mr b gy no mx l my mz">return sectionTexts;<br/>  };</span><span id="59d0" class="mv lt iq mr b gy no mx l my mz">// Our JSON output</span><span id="127e" class="mv lt iq mr b gy no mx l my mz">const contentJSON = {<br/>    title: artTitle.trim(),<br/>    description: artDescription.text().trim(),<br/>    heroBanner: {<br/>      url: heroBanner.attr("src"),<br/>      altText: heroBanner.attr("alt"),<br/>    },<br/>    introText: artIntro.text().trim(),<br/>    artBody: getSections(),<br/>  };</span><span id="3b0c" class="mv lt iq mr b gy no mx l my mz">const artFinal = JSON.stringify(contentJSON);<br/>  const filename = artTitle.slice(0, 9).trim() + ".json";<br/>  fs.writeFileSync(filename, artFinal);<br/>});</span></pre><p id="0186" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您现在在终端中运行命令<code class="fe nl nm nn mr b">node scraper.js</code>，您应该看到在您的项目文件夹中创建了一个名为<code class="fe nl nm nn mr b"> Architect.json</code>的新文件。打开文件，您应该会找到您的JSON数据。</p><p id="0b6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你喜欢这个，并祝你好运创造自己的刮刀！</p><h2 id="99bf" class="mv lt iq bd lu na nb dn ly nc nd dp mc lf ne nf me lj ng nh mg ln ni nj mi nk bi translated"><strong class="ak">简明英语团队的笔记</strong></h2><p id="db32" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">你知道我们有四种出版物吗？给他们一个关注来表达爱意:<a class="ae kv" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="ky ir">JavaScript in Plain English</strong></a><a class="ae kv" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ky ir">AI in Plain English</strong></a><a class="ae kv" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ky ir">UX in Plain English</strong></a><a class="ae kv" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ky ir">Python in Plain English</strong></a><strong class="ky ir"/>——谢谢，继续学习！</p><p id="5370" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还推出了一个YouTube，希望你能通过<a class="ae kv" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">订阅我们的英语频道</strong> </a>来支持我们</p><p id="8049" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一如既往,“简明英语”希望帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kv" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">submissions @ plain English . io</strong></a><strong class="ky ir"/>，并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>