<html>
<head>
<title>React Hooks with Async-Await</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Async-Await反应钩子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-hooks-with-async-await-3e9db1d93e05?source=collection_archive---------7-----------------------#2019-11-10">https://javascript.plainenglish.io/react-hooks-with-async-await-3e9db1d93e05?source=collection_archive---------7-----------------------#2019-11-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8fc399b6b86a896f4bd7a6c7e733ad7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7FBxP2nuNk-gcrxDvyF0Zw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Hooks With Async-Await</figcaption></figure><p id="2c61" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">想象一下，你有一个文本框，它可以根据你在上面输入的内容给出谷歌商店的图书列表。如果在特定搜索查询中没有书，则显示“没有找到书”。默认情况下，它将始终显示“搜索书籍”。</p><p id="aa8e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> <em class="kx">场景笔下:</em> </strong> <br/> 1)无搜索:“搜书”。<br/> 2)没有结果:“没有找到书”。<br/> 3)找到的书籍:“显示书籍列表”。</p><p id="26c9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在上面的场景中，我们希望在Google<strong class="kb io"><em class="kx"/></strong><a class="ae ky" href="https://www.googleapis.com/books/v1" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="kx">API的</em> </strong> </a>上搜索主题后，我们的结果会更新。这清楚地表明，我们需要使用承诺或“异步等待”来实现结果。但是这里我们想创建一个自定义的钩子，当我们点击搜索按钮并显示结果时，它会搜索书籍。</p><p id="8fa0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在的问题是为什么我们在这种情况下需要钩子。答案很简单，因为我们想让我们的代码在最终使用时更加简洁。必须不是多余的即<strong class="kb io"> <em class="kx">干(不要重复自己)。</em> </strong></p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="25b5" class="li lj in le b gy lk ll l lm ln">function App() {<br/>  const [search, setSearch] = React.useState("");<br/>  const [query, setQuery] = React.useState("");<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;h1&gt;Search for Books on any Topic&lt;/h1&gt;<br/>      &lt;form<br/>        onSubmit={e =&gt; {<br/>          e.preventDefault();<br/>          setQuery(search);<br/>        }}<br/>      &gt;<br/>        &lt;label&gt;Search : &lt;/label&gt;<br/>        &lt;input type="text" onChange={e =&gt; setSearch(e.target.value)} /&gt;<br/>        &lt;input type="submit" value="search" /&gt;<br/>      &lt;/form&gt;<br/><br/>      &lt;h1&gt;List Result on {query}&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  );</span></pre><p id="0ea9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">到目前为止，这是我们在“查询”状态下获取最终搜索值的简单代码。现在我们定制一个异步钩子来搜索google Api。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="64a6" class="li lj in le b gy lk ll l lm ln">function useAsyncHook(searchBook) {<br/>  const [result, setResult] = React.useState([]);<br/>  const [loading, setLoading] = React.useState("false");<br/><br/>  React.useEffect(() =&gt; {<br/>    async function fetchBookList() {<br/>      try {<br/>        setLoading("true");<br/>        const response = await fetch(<br/>          `https://www.googleapis.com/books/v1/volumes?q=${searchBook}`<br/>        );<br/><br/>        const json = await response.json();<br/>        // console.log(json);<br/>        setResult(<br/>          json.items.map(item =&gt; {<br/>            console.log(item.volumeInfo.title);<br/>            return item.volumeInfo.title;<br/>          })<br/>        );<br/>      } catch (error) {<br/>        setLoading("null");<br/>      }<br/>    }<br/><br/>    if (searchBook !== "") {<br/>      fetchBookList();<br/>    }<br/>  }, [searchBook]);<br/><br/>  return [result, loading];<br/>}</span></pre><blockquote class="lo lp lq"><p id="0bb1" class="jz ka kx kb b kc kd ke kf kg kh ki kj lr kl km kn ls kp kq kr lt kt ku kv kw ig bi translated">我们不能将“async”关键字与“useEffect”回调方法一起使用。这将导致竞态条件。</p></blockquote><p id="f0af" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们从google api获取书籍，然后用书名更新我们的“setResult”状态。React.useEffect方法将仅在我们的“searchBook”发生变化时运行。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2805" class="li lj in le b gy lk ll l lm ln">//Updated App Component<br/>function App() {<br/>  const [search, setSearch] = React.useState("");<br/>  const [query, setQuery] = React.useState("");<br/>  const [result, loading] = useAsyncHook(query);<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;h1&gt;Search for Books on any Topic&lt;/h1&gt;<br/>      &lt;form<br/>        onSubmit={e =&gt; {<br/>          e.preventDefault();<br/>          setQuery(search);<br/>        }}<br/>      &gt;<br/>        &lt;label&gt;Search : &lt;/label&gt;<br/>        &lt;input type="text" onChange={e =&gt; setSearch(e.target.value)} /&gt;<br/>        &lt;input type="submit" value="search" /&gt;<br/>      &lt;/form&gt;<br/><br/>      {loading === "false" ? (<br/>        &lt;h1&gt;Search for Books&lt;/h1&gt;<br/>      ) : loading === "null" ? (<br/>        &lt;h1&gt;No Book Found&lt;/h1&gt;<br/>      ) : (<br/>        result.map(item =&gt; {<br/>          return &lt;p&gt;Book Title : {item}&lt;/p&gt;;<br/>        })<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="9274" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae ky" href="http://becauseitsonelife.com/" rel="noopener ugc nofollow" target="_blank">因其一命</a></p></div></div>    
</body>
</html>