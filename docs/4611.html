<html>
<head>
<title>Next.js — Environment Variables and Routing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js环境变量和路由</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/next-js-environment-variables-and-routing-161f405e837f?source=collection_archive---------9-----------------------#2020-12-24">https://javascript.plainenglish.io/next-js-environment-variables-and-routing-161f405e837f?source=collection_archive---------9-----------------------#2020-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/111c109c8f75b170bde561c9723c9e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vcnxKSM_OMJ7Pu_G"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@foxxmd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Matt Duncan</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2af9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以轻松地创建服务器端呈现的React应用程序和静态站点。</p><p id="b37f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何向浏览器和路由公开环境变量。</p><h1 id="0daf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">向浏览器公开环境变量</h1><p id="53c9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们给变量加上前缀<code class="fe me mf mg mh b">NEXT_PUBLIC_</code>,就可以向浏览器公开我们的环境变量。</p><p id="e8be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="20ea" class="mq lc iq mh b gy mr ms l mt mu">NEXT_PUBLIC_API_KEY=...</span></pre><p id="416c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过写来使用它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9685" class="mq lc iq mh b gy mr ms l mt mu">function Photos({ data }) {<br/>  return &lt;p&gt;{JSON.stringify(data)}&lt;/p&gt;<br/>}</span><span id="40a1" class="mq lc iq mh b gy mv ms l mt mu">export async function getServerSideProps() {<br/>  const headers = new Headers();<br/>  headers.append('Authorization', process.env.NEXT_PUBLIC_API_KEY);<br/>  const res = await fetch(`https://api.pexels.com/v1/search?query=people`, {<br/>    method: 'GET',<br/>    headers,<br/>    mode: 'cors',<br/>    cache: 'default',<br/>  })<br/>  const data = await res.json()<br/>  return { props: { data } }<br/>}</span><span id="bd21" class="mq lc iq mh b gy mv ms l mt mu">export default Photos</span></pre><p id="1878" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe me mf mg mh b">process.env</code>属性中访问环境变量。</p><h1 id="ab3f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">默认环境变量</h1><p id="5160" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在<code class="fe me mf mg mh b">.env</code>、<code class="fe me mf mg mh b">.env.development</code>和<code class="fe me mf mg mh b">.env.production</code>文件中添加默认的环境变量。</p><p id="a134" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">.env.local</code>文件将覆盖这些文件中的值。</p><p id="e2a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe me mf mg mh b">.env*.local</code>文件应该被添加到<code class="fe me mf mg mh b">.gitignore</code>中，因为这是我们应该存储秘密的地方。</p><h1 id="3f48" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Vercel上的环境变量</h1><p id="d588" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以在<a class="ae kc" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>的环境变量部分存储环境变量。</p><p id="aa91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还是用<code class="fe me mf mg mh b">.env</code>、<code class="fe me mf mg mh b">.env.development</code>和<code class="fe me mf mg mh b">.env.production</code>来存储默认值。</p><p id="9d6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些值可以通过运行以下命令拉入<code class="fe me mf mg mh b">.env.local</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f9bf" class="mq lc iq mh b gy mr ms l mt mu">vercel env pull .env.local</span></pre><h1 id="96ed" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试环境变量</h1><p id="9bd0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">同样，我们可以使用<code class="fe me mf mg mh b">test</code>环境来存储任何测试环境的环境变量。</p><p id="10b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这对于设置运行自动化测试的环境很有用。</p><p id="0ae9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe me mf mg mh b">NODE_ENV</code>设置为<code class="fe me mf mg mh b">test</code>，将使用测试值。</p><p id="caa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当应用程序在<code class="fe me mf mg mh b">test</code>环境中运行时，不会加载<code class="fe me mf mg mh b">.env.local</code>。</p><h1 id="5109" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">支持的浏览器和功能</h1><p id="2102" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Next.js支持IE11和所有现代浏览器，如Chrome、Firefox和Edge。</p><p id="bc1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Next.js为IE11兼容性注入polyfills。</p><p id="7b14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，我们不用担心IE11上的功能缺失。</p><p id="a65d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">服务器端聚合填充也被注入。</p><p id="f348" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以在服务器端环境中使用<code class="fe me mf mg mh b">fetch</code>,而无需添加我们自己的polyfills。</p><p id="e233" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Next.js确保了现代JavaScript特性，如:</p><ul class=""><li id="5235" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">异步/等待(ES2017)</li><li id="86cb" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">对象静止/扩散属性(ES2018)</li><li id="97e7" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">动态导入()(ES2020)</li><li id="04f7" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">可选链接(ES2020)</li><li id="d523" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">无效合并(ES2020)</li><li id="4d9e" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">类字段和静态属性</li></ul><p id="c539" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一切都是现成的。</p><h1 id="0202" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">按指定路线发送</h1><p id="7e8f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">使用Next.js自动完成路由</p><p id="f863" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">pages</code>文件夹的文件夹结构决定了所定义的路线。</p><p id="8397" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们将<code class="fe me mf mg mh b">page/index.js</code>映射到<code class="fe me mf mg mh b">/</code>。</p><p id="4690" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe me mf mg mh b">pages/posts/index.js</code>被映射到<code class="fe me mf mg mh b">/posts</code>。</p><p id="48ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以嵌套我们的文件，它们将被映射到带有文件路径的URL。</p><h1 id="8537" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">动态路段</h1><p id="fcb3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们用括号将文件名括起来，使它们具有动态性。</p><p id="e745" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有<code class="fe me mf mg mh b">pages/blog/[slug].js</code>，那么它被映射到<code class="fe me mf mg mh b">/blog/:slug</code> URL。</p><p id="ec40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们有<code class="fe me mf mg mh b">pages/post/[…all].js</code>，那么在<code class="fe me mf mg mh b">/post</code>之后我们可以有任意数量的URL参数。</p><p id="6223" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">比如会搭配<code class="fe me mf mg mh b">/post/2020/id/title</code>。</p><h1 id="84c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">页面之间的链接</h1><p id="aa24" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">Link</code>组件在页面之间添加链接。</p><p id="ec33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="3471" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">pages/links.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6b49" class="mq lc iq mh b gy mr ms l mt mu">import Link from 'next/link'</span><span id="c8fa" class="mq lc iq mh b gy mv ms l mt mu">function Links() {<br/>  return (<br/>    &lt;ul&gt;<br/>      &lt;li&gt;<br/>        &lt;Link href="/foo"&gt;<br/>          &lt;a&gt;foo&lt;/a&gt;<br/>        &lt;/Link&gt;<br/>      &lt;/li&gt;<br/>      &lt;li&gt;<br/>        &lt;Link href="/bar"&gt;<br/>          &lt;a&gt;bar&lt;/a&gt;<br/>        &lt;/Link&gt;<br/>      &lt;/li&gt;<br/>    &lt;/ul&gt;<br/>  )<br/>}</span><span id="0b8a" class="mq lc iq mh b gy mv ms l mt mu">export default Links</span></pre><p id="626c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">pages/foo.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b742" class="mq lc iq mh b gy mr ms l mt mu">import Links from './links';</span><span id="5cbd" class="mq lc iq mh b gy mv ms l mt mu">function Foo() {<br/>  return &lt;div&gt;<br/>    &lt;Links /&gt;<br/>    &lt;p&gt;foo&lt;/p&gt;<br/>  &lt;/div&gt;<br/>}</span><span id="59d3" class="mq lc iq mh b gy mv ms l mt mu">export default Foo</span></pre><p id="8030" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">pages/bar.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4efc" class="mq lc iq mh b gy mr ms l mt mu">import Links from './links';</span><span id="a0b3" class="mq lc iq mh b gy mv ms l mt mu">function Bar() {<br/>  return &lt;div&gt;<br/>    &lt;Links /&gt;<br/>    &lt;p&gt;bar&lt;/p&gt;<br/>  &lt;/div&gt;<br/>}<br/>export default Bar</span></pre><p id="c931" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe me mf mg mh b">Link</code>组件添加<code class="fe me mf mg mh b">Links</code>组件，以将链接添加到页面。</p><p id="a4a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">Foo</code>和<code class="fe me mf mg mh b">Bar</code>组件中的<code class="fe me mf mg mh b">Links</code>来添加路线。</p><p id="d27c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以点击它们在路线之间跳转。</p><h1 id="cad0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="1838" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过Next.js在浏览器环境中使用环境变量。</p><p id="ddff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用<code class="fe me mf mg mh b">Link</code>组件向页面添加链接。</p><p id="22d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">路由是按照一些惯例完成的。</p><p id="731c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>