<html>
<head>
<title>MongoDB Realm + GraphQL (Update One and Delete One)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB Realm + GraphQL(更新一个删除一个)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/mongodb-realm-graphql-update-one-and-delete-one-aacf71cd2d7c?source=collection_archive---------8-----------------------#2020-11-05">https://javascript.plainenglish.io/mongodb-realm-graphql-update-one-and-delete-one-aacf71cd2d7c?source=collection_archive---------8-----------------------#2020-11-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/04d35a01423a9546b071d6ba7d605475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qLmwaVbNKtIlBSi5Ck-OlA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@pabloheimplatz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Pablo Heimplatz</a> on <a class="ae jz" href="https://unsplash.com/s/photos/rock?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b7c2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是“MongoDB Realm+graph QL+Apollo Client(on React)”使用系列的第二部分。你可以在这里找到该系列的第一篇文章<a class="ae jz" href="https://mathiou.medium.com/how-to-use-mongodb-atlas-graphql-from-a-react-web-app-insert-one-and-search-360cc15cb6fa" rel="noopener">。</a></p><p id="577b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这篇文章将描述我们如何<em class="ky">在我们的数据库中更新或删除一个特定的文档</em>。</p><p id="d1e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确切地说，正如<a class="ae jz" href="https://mathiou.medium.com/how-to-use-mongodb-atlas-graphql-from-a-react-web-app-insert-one-and-search-360cc15cb6fa" rel="noopener">在之前的文章</a>中所说，这两种场景的步骤如下:</p><ol class=""><li id="0d39" class="kz la in kc b kd ke kh ki kl lb kp lc kt ld kx le lf lg lh bi translated">我们在MongoDB Explorer中解决了我们的查询。</li><li id="d633" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">我们将查询复制到我们的<em class="ky"> operations.graphql </em>文件中，并执行<em class="ky"> $ npm run generate命令。</em></li><li id="adc7" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated">我们将逻辑移动到组件中，就像我们在创建场景中所做的那样。</li></ol><h2 id="87bc" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">更新一个文档</h2><p id="db28" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">为了更新一个文档，我们将做一个<strong class="kc io">突变</strong>，其中我们需要两件事情:</p><ol class=""><li id="b836" class="kz la in kc b kd ke kh ki kl lb kp lc kt ld kx le lf lg lh bi translated">一个<strong class="kc io">查询</strong>，通过它我们可以找到特定的文档</li><li id="34b1" class="kz la in kc b kd li kh lj kl lk kp ll kt lm kx le lf lg lh bi translated"><strong class="kc io">我们想要用来更新文档的新数据</strong>。</li></ol><p id="f9e7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于查询，我们可以使用模式中的任何属性。对于我们的场景，我们将使用一个典型的案例，使用我们文档的惟一id。</p><p id="5d38" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是您通常定位特定文档的方式，因为这是更高效的方式，因为“_id”是数据库中文档的主要索引。</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/72df5dbccc180f9392150d23a789670e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-i-4z8-v13PBXGBXg9aJQ.png"/></div></div></figure><p id="90d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将突变添加到我们的<strong class="kc io"><em class="ky">operations . graph QL</em></strong>文件中，</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="9d9a" class="ln lo in mr b gy mv mw l mx my">mutation updatePerformance($id: ObjectId!, $perfData: PerformanceUpdateInput!) {<br/>  updateOnePerformance(query: {_id: $id}, set: $perfData) {<br/>    _id<br/>    // The rest props you want inside the response<br/>  }<br/>}</span></pre><p id="569b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在控制台中执行以下命令。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="6e61" class="ln lo in mr b gy mv mw l mx my"><strong class="mr io"><em class="ky">$ </em></strong><em class="ky">npm run generate</em></span></pre><p id="aa5b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="ky">(详情:</em> </strong> <a class="ae jz" href="https://graphql-code-generator.com/docs/getting-started/installation" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">安装| GraphQL代码生成器</em></strong><strong class="kc io"><em class="ky">)</em></strong></a></p><p id="71ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的命令将自动创建我们突变和查询所需的适当类型(在<em class="ky"> types.ts </em>中)和钩子(在<em class="ky"> graphql-operations.ts </em>中)。</p><p id="8b03" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经准备好了钩子，我们可以在我们的组件中调用它们。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="084d" class="ln lo in bd lp lq lr dn ls lt lu dp lv kl lw lx ly kp lz ma mb kt mc md me mf bi translated">删除一个文档</h2><p id="0356" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl mi kn ko kp mj kr ks kt mk kv kw kx ig bi translated">为了删除一个特定的文档，我们将做一个<strong class="kc io">变异</strong>，其中我们只需要一个<strong class="kc io">查询</strong>，用它我们可以找到特定的文档。</p><p id="07f4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，对于我们的查询，我们可以使用模式中的任何属性。对于我们的场景，我们将使用文档的惟一id。如前所述，这是您通常定位特定文档的方式，因为这是更高效的方式，因为“_id”是数据库中文档的主要索引。</p><figure class="mm mn mo mp gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/7655c3b9e5d715b91ba97ba635558092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frTHCPWji4K5dqxIxEdB4Q.png"/></div></div></figure><p id="408a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意<em class="ky">当操作失败时，响应将包含值为空的数据</em>，</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="1eac" class="ln lo in mr b gy mv mw l mx my">{<br/>  "data": {<br/>    "deleteOnePerformance": null<br/>  }<br/>}</span></pre><p id="41fe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并且<em class="ky">成功时，响应包含被删除记录</em>的“_id”。因此，请注意这种行为，因为它可能会令人困惑。</p><p id="8b94" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将我们的突变添加到我们的<strong class="kc io"><em class="ky">operations . graph QL</em></strong>文件中，</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="46b8" class="ln lo in mr b gy mv mw l mx my">mutation deleteOnePerformance($id: ObjectId!) {<br/>  deleteOnePerformance ( query: {_id: $id} ) {<br/>    _id<br/>  }<br/>}</span></pre><p id="de23" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在控制台中执行“<em class="ky"> npm run generate”。</em></p><p id="e4af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经准备好了钩子，我们可以在我们的组件中调用它们。</p><figure class="mm mn mo mp gt jo"><div class="bz fp l di"><div class="mz na l"/></div></figure></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="d195" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就是这样！</p><p id="2817" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在下一篇文章中，我们将描述如何在MongoDB领域中插入许多文档并使用自定义函数来处理有许多重复的奇怪情况。</p></div></div>    
</body>
</html>