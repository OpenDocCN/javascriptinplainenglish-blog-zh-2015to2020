<html>
<head>
<title>JavaScript Tips — Wait for All Promises, Heights, Dates, and More</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript提示——等待所有承诺、高度、日期等等</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-tips-wait-for-all-promises-heights-dates-and-more-ad53d4028004?source=collection_archive---------17-----------------------#2020-07-05">https://javascript.plainenglish.io/javascript-tips-wait-for-all-promises-heights-dates-and-more-ad53d4028004?source=collection_archive---------17-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f5b1b955c96580cf5ef84aa30d24e4f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KHVkpspYfA8XlpM9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@ignaciobrosa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ignacio Brosa</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b318" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像任何类型的应用程序一样，当我们编写JavaScript应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些常见JavaScript问题的解决方案。</p><h1 id="26e7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">跳过中的元素。地图()</h1><p id="70dc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以跳过<code class="fe me mf mg mh b">map</code>中的一个元素，先用<code class="fe me mf mg mh b">filter</code>过滤掉我们不想要的条目。</p><p id="e3d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ea8a" class="mq lc iq mh b gy mr ms l mt mu">const sources = images.filter((img) =&gt; {<br/>  return img.src.split('.').pop() !== "json"<br/>})<br/>.map(img =&gt; img.src);</span></pre><p id="4872" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们只绘制不以<code class="fe me mf mg mh b">'json'</code>结尾的项目。</p><h1 id="1221" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用JavaScript在字符串中插入变量</h1><p id="6bb2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用模板字符串在字符串中插入变量。</p><p id="e1f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3e28" class="mq lc iq mh b gy mr ms l mt mu">const a = 5;<br/>const b = 1;<br/>console.log(`sum is ${a + b}.`);</span></pre><p id="2554" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">a + b</code>的结果插入到最后一行的字符串中。</p><h1 id="9336" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">JavaScript中比较字符串的最佳方式？</h1><p id="a2a8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要比较JavaScript中的两个字符串，我们可以使用<code class="fe me mf mg mh b">localeCompare</code>方法。</p><p id="f4c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f3aa" class="mq lc iq mh b gy mr ms l mt mu">strA.localeCompare(strB)</span></pre><p id="2139" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这使我们能够以一种区域敏感的方式比较字符串。</p><h1 id="ffab" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">等到所有的承诺完成，即使有些被拒绝</h1><p id="433f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了等待承诺完成，我们可以使用<code class="fe me mf mg mh b">Promise.allSettled</code>方法。</p><p id="5fb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使有些可能被拒绝，它也会完成。</p><p id="1fc5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5fb9" class="mq lc iq mh b gy mr ms l mt mu">Promise.allSettled([promise1, promise2])<br/>.then(([result1, result2]) =&gt; {<br/>  // ...<br/>});</span></pre><p id="3379" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传递了一系列承诺。</p><p id="df9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">then</code>并在一个数组中得到所有的结果。</p><p id="787c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个结果对象都有<code class="fe me mf mg mh b">status</code>和<code class="fe me mf mg mh b">reason</code>或<code class="fe me mf mg mh b">value</code>属性。</p><p id="9d75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">status</code>是诺言的状态。如果实现了，<code class="fe me mf mg mh b">status</code>就会变成<code class="fe me mf mg mh b">'fulfilled'</code>。不然就<code class="fe me mf mg mh b">'rejected'</code>了。</p><p id="07b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">value</code>为解析值。</p><p id="02cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">reason</code>是拒绝的错误。</p><h1 id="ce22" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">HTMLCollection元素的For循环</h1><p id="9b4a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要循环遍历一个<code class="fe me mf mg mh b">HTMLCollection</code>对象，我们可以使用for-of循环来完成。</p><p id="62f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9618" class="mq lc iq mh b gy mr ms l mt mu">const els = document.getElementsByClassName("foo");<br/>for (const item of els) {<br/>  console.log(item.id);<br/>}</span></pre><p id="29db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到所有具有类名<code class="fe me mf mg mh b">foo</code>的项目。</p><p id="fb14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们使用for-of循环遍历它们。</p><p id="d590" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要将其转换为数组，我们可以使用<code class="fe me mf mg mh b">Array.from</code>或spread运算符:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7415" class="mq lc iq mh b gy mr ms l mt mu">const arr = Array.from(document.getElementsByClassName("foo"));</span></pre><p id="4a25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ed29" class="mq lc iq mh b gy mr ms l mt mu">const arr = [...document.getElementsByClassName("foo")];</span></pre><p id="2c2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以对它使用数组方法。</p><h1 id="ee69" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取两个日期字符串之间的天数</h1><p id="6abe" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过解析日期得到两天之间的天数，然后得到它们的差值。</p><p id="1414" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们的日期是MM/DD/YYYY格式，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8505" class="mq lc iq mh b gy mr ms l mt mu">const parseDate = (str) =&gt; {<br/>  const [month, day, year] = str.split('/');<br/>  return new Date(year, month-1, day);<br/>}<br/><br/>const dateDiff = (first, second) =&gt; {<br/>  return Math.round((second - first)/(1000 * 60 * 60 * 24));<br/>}</span></pre><p id="3d86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们拆分<code class="fe me mf mg mh b">str</code>日期字符串。</p><p id="4d0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将拆分后的条目作为参数传递给<code class="fe me mf mg mh b">Date</code>构造函数。</p><p id="aa7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">year</code>是年份，<code class="fe me mf mg mh b">month</code>是月份，但是我们必须减去1，因为JavaScript构造函数假设0是一月，1是二月，等等。</p><p id="0a2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">day</code>是一个月中的某一天。</p><p id="4688" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">dateDiff</code>中，我们用<code class="fe me mf mg mh b">first</code>减去<code class="fe me mf mg mh b">second</code>得到差值。</p><p id="b5db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们都是<code class="fe me mf mg mh b">Date</code>实例。</p><p id="0119" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们除以一天中的毫秒数。</p><p id="0d09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c43d" class="mq lc iq mh b gy mr ms l mt mu">const diff = dateDiff(parseDate('2/1/2000'), parseDate('3/2/2000'));</span></pre><p id="2325" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">去使用它。</p><h1 id="8988" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在JavaScript对象文本中使用变量作为键</h1><p id="41fc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在JavaScript对象文本中使用变量作为键。</p><p id="e4ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="dc27" class="mq lc iq mh b gy mr ms l mt mu">const prop = "foo",<br/>const obj = { [prop]: 10 };</span></pre><p id="ae2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只需将<code class="fe me mf mg mh b">prop</code>传入括号中，然后键就是<code class="fe me mf mg mh b">foo</code>。</p><h1 id="a777" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取元素的渲染高度</h1><p id="6a6f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">clientHeight</code>、<code class="fe me mf mg mh b">offsetHeight</code>和<code class="fe me mf mg mh b">scrollHeight</code>来获取元素的渲染高度。</p><p id="daad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1be9" class="mq lc iq mh b gy mr ms l mt mu">const height = document.querySelector('div').clientHeight;</span></pre><p id="d5d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fe66" class="mq lc iq mh b gy mr ms l mt mu">const height = document.querySelector('div').offsetHeight;</span></pre><p id="09a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="bac4" class="mq lc iq mh b gy mr ms l mt mu">const height = document.querySelector('div').scrollHeight;</span></pre><p id="b0d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">clientHeight</code>包括高度和垂直填充。</p><p id="49fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">offsetHeight</code>包括高度、垂直填充和垂直边框。</p><p id="416c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">scrollHeight</code>包括所包含文档的高度、垂直填充和垂直边框。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/1c4c2c826d71250f7139afaaaf2287f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZajjoVNJeVfQii-z"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@georgepotter?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">George Potter</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="4ab2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="69c5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">filter</code>和<code class="fe me mf mg mh b">map</code>来映射数组的选定条目。</p><p id="abc7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有几种方法可以得到元素的高度。</p><p id="d133" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过创建日期对象，然后减去两个日期，再除以一天中的毫秒数，得到两个日期之间的天数。</p><p id="3831" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们等待所有的承诺完成，不管它们的状态如何。</p><h2 id="073b" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">简单英语的JavaScript</h2><p id="84c9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你知道我们有四份出版物和一个YouTube频道吗？在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>和<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">找到它们订阅解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>