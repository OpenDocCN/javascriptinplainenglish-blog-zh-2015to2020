<html>
<head>
<title>Use Discord to Login to Your Chrome Extension</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Discord登录到您的Chrome扩展</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-discord-to-login-to-your-chrome-extension-6c50039e3534?source=collection_archive---------3-----------------------#2020-08-22">https://javascript.plainenglish.io/use-discord-to-login-to-your-chrome-extension-6c50039e3534?source=collection_archive---------3-----------------------#2020-08-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="aef3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">允许你的用户使用他们的不和谐凭证登录到你的Chrome扩展</p><p id="2613" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">本教程使用了一个简单的谷歌Chrome扩展设置。如果你想知道如何进行设置，请点击这里查看我的文章:</p><div class="kj kk gp gr kl km"><a href="https://medium.com/@an_object_is_a/how-does-a-chrome-extension-work-web-development-6e85bd2bccc1" rel="noopener follow" target="_blank"><div class="kn ab fo"><div class="ko ab kp cl cj kq"><h2 class="bd io gy z fp kr fr fs ks fu fw im bi translated">Chrome扩展是如何工作的？(网络开发)</h2><div class="kt l"><h3 class="bd b gy z fp kr fr fs ks fu fw dk translated">Chrome扩展有5个部分:</h3></div><div class="ku l"><p class="bd b dl z fp kr fr fs ks fu fw dk translated">medium.com</p></div></div><div class="kv l"><div class="kw l kx ky kz kv la lb km"/></div></div></a></div></div><div class="ab cl lc ld hr le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ig ih ii ij ik"><h1 id="d2e3" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">我们开始吧</h1><p id="b45e" class="pw-post-body-paragraph jk jl in jm b jn mh jp jq jr mi jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">在我们接触一行代码之前，我们需要设置我们的开发工作区，以便我们能够使用<strong class="jm io"> Discord的OAuth2端点</strong>。</p><p id="2ccd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导航至https://discord.com/developers/applications/的“<a class="ae mm" href="https://discord.com/developers/applications/'" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">”</strong>“</a>”并登录。<br/>点击右上角的<strong class="jm io">新应用</strong>。<br/>随便你怎么命名。<br/>保持此窗口打开，稍后我们将需要“<strong class="jm io">客户端ID </strong>”。</p><p id="61bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导航到"<strong class="jm io"> chrome://extensions </strong>"并确保你的chrome扩展已经加载。</p><p id="abc7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">复制您的扩展的'<strong class="jm io"> ID </strong>'并返回到<strong class="jm io"> Discord开发者门户</strong>。</p><p id="5dc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击左边工具条上的“<strong class="jm io"> OAuth2 </strong>”链接。</p><p id="ef92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">点击'<strong class="jm io">添加重定向</strong>'并添加网址，“<strong class="jm io">https://&lt;chrome ext id&gt;. chrome app . org/</strong>”其中'<strong class="jm io"> &lt; chrome ext id &gt; </strong>'是你之前复制的扩展id。</p><p id="f98d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">制作人务必点击“<strong class="jm io">保存更改</strong>”。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/457a373c53931b600d993a44c943d4d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bDcObDohs1R7UlJEo--vw.png"/></div></div></figure></div><div class="ab cl lc ld hr le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ig ih ii ij ik"><h2 id="7d73" class="my lk in bd ll mz na dn lp nb nc dp lt jv nd ne lx jz nf ng mb kd nh ni mf nj bi translated">在开始实际的Chrome扩展工作之前，让我们先做一些网络开发工作</h2><p id="6aef" class="pw-post-body-paragraph jk jl in jm b jn mh jp jq jr mi jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">我们将创建两个页面:一个“登录”页面和一个“注销”页面。没什么特别的。</p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="0e4e" class="my lk in nl b gy np nq l nr ns">/* popup-sign-in.html */<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;</span><span id="87b5" class="my lk in nl b gy nt nq l nr ns">&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;title&gt;Document&lt;/title&gt;<br/>    &lt;style&gt;<br/>        body {<br/>            width: 300px;<br/>            height: 600px;<br/>            margin: 0;<br/>            padding: 0;<br/>            overflow: hidden;<br/>        }</span><span id="a498" class="my lk in nl b gy nt nq l nr ns">        div {<br/>            align-items: center;<br/>            display: flex;<br/>            width: 100%;<br/>            height: 100%;<br/>            justify-content: center;<br/>            text-align: center;<br/>            margin: auto;<br/>            box-sizing: border-box;<br/>            background-color: #fcee54;<br/>        }</span><span id="5100" class="my lk in nl b gy nt nq l nr ns">        button {<br/>            font-size: 200%;<br/>            background-color: #f5c2e0;<br/>            border-radius: 5px;<br/>            border: none;<br/>            text-align: center;<br/>            color: black;<br/>            font-family: monospace;<br/>            font-weight: bold;<br/>            transition-duration: 0.3s;<br/>            padding: 10px;<br/>        }<br/>    &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="bd99" class="my lk in nl b gy nt nq l nr ns">&lt;body&gt;<br/>    &lt;div&gt;<br/>        &lt;button type="submit"&gt;Sign In&lt;/button&gt;<br/>    &lt;/div&gt;<br/>    &lt;script src="./popup-sign-in-script.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span><span id="c12c" class="my lk in nl b gy nt nq l nr ns">&lt;/html&gt;</span><span id="0e29" class="my lk in nl b gy nt nq l nr ns">/* popup-sign-out.html */<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;</span><span id="db2c" class="my lk in nl b gy nt nq l nr ns">&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;title&gt;Document&lt;/title&gt;<br/>    &lt;style&gt;<br/>        body {<br/>            width: 300px;<br/>            height: 600px;<br/>            margin: 0;<br/>            padding: 0;<br/>            overflow: hidden;<br/>        }</span><span id="ae8c" class="my lk in nl b gy nt nq l nr ns">        div {<br/>            align-items: center;<br/>            display: flex;<br/>            width: 100%;<br/>            height: 100%;<br/>            justify-content: center;<br/>            text-align: center;<br/>            background-color: #00ffa7;<br/>            transition-duration: 0.5s;<br/>        }</span><span id="dbc8" class="my lk in nl b gy nt nq l nr ns">        button {<br/>            font-size: 200%;<br/>            background-color: #f5c2e0;<br/>            border-radius: 5px;<br/>            border: none;<br/>            text-align: center;<br/>            color: black;<br/>            font-family: monospace;<br/>            font-weight: bold;<br/>            transition-duration: 0.3s;<br/>            padding: 10px;<br/>        }<br/>    &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="0aef" class="my lk in nl b gy nt nq l nr ns">&lt;body&gt;<br/>    &lt;div&gt;<br/>        &lt;button type="submit"&gt;Sign Out&lt;/button&gt;<br/>    &lt;/div&gt;<br/>    &lt;script src="./popup-sign-out-script.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span><span id="3c10" class="my lk in nl b gy nt nq l nr ns">&lt;/html&gt;</span></pre><p id="0afa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">注意:</strong> <br/>确保包含“body”CSS属性。<br/>其他你并不真正需要的CSS。只是用来让页面好看而已。</p><p id="41db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，我们在每个HTML页面上都附加了脚本…</p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="dc81" class="my lk in nl b gy np nq l nr ns">/* popup-sign-in-script.js */<br/>const button = document.querySelector('button');</span><span id="cbef" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseover', () =&gt; {<br/>    button.style.backgroundColor = 'black';<br/>    button.style.color = 'white';<br/>    button.style.transform = 'scale(1.3)';<br/>});</span><span id="4bf2" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseleave', () =&gt; {<br/>    button.style.backgroundColor = '#f5c2e0';<br/>    button.style.color = 'black';<br/>    button.style.transform = 'scale(1)';<br/>});</span><span id="37a7" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('click', () =&gt; {</span><span id="b689" class="my lk in nl b gy nt nq l nr ns">});</span><span id="7442" class="my lk in nl b gy nt nq l nr ns">/* popup-sign-out-script.js */<br/>const button = document.querySelector('button');</span><span id="77f2" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseover', () =&gt; {<br/>    button.style.backgroundColor = 'black';<br/>    button.style.color = 'white';<br/>    button.style.transform = 'scale(1.3)';</span><span id="b0ce" class="my lk in nl b gy nt nq l nr ns">document.querySelector('div').style.backgroundColor = '#ee2f64';<br/>});</span><span id="5071" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseleave', () =&gt; {<br/>    button.style.backgroundColor = '#f5c2e0';<br/>    button.style.color = 'black';<br/>    button.style.transform = 'scale(1)';</span><span id="9586" class="my lk in nl b gy nt nq l nr ns">document.querySelector('div').style.backgroundColor = '#fcee54';<br/>});</span><span id="c66a" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('click', () =&gt; {<br/><br/>});</span></pre><p id="8568" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">注:</strong> <br/>这段代码很多完全没有必要。它只是用来使页面看起来漂亮和生动。脚本中唯一重要的代码是按钮的“点击”监听器。</p></div><div class="ab cl lc ld hr le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ig ih ii ij ik"><h2 id="7bf3" class="my lk in bd ll mz na dn lp nb nc dp lt jv nd ne lx jz nf ng mb kd nh ni mf nj bi translated">现在我们已经讨论了Web开发部分，让我们看看我们的“manifest.json”。</h2><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="71bf" class="my lk in nl b gy np nq l nr ns">{<br/>    "name": "obj ext",<br/>    "description": "my ext",<br/>    "version": "0.1.0",<br/>    "manifest_version": 2,<br/>    "icons": {<br/>        "16": "./obj-16x16.png",<br/>        "32": "./obj-32x32.png",<br/>        "48": "./obj-48x48.png",<br/>        "128": "./obj-128x128.png"<br/>    },<br/>    "background": {<br/>        "scripts": ["./background.js"]<br/>    },<br/>    "options_page": "./options.html",<br/>    "browser_action": {<br/>        "default_popup": "./popup-sign-in.html"<br/>    },<br/>    "permissions": [<br/>        "identity"<br/>    ] <br/>}</span></pre><p id="d4db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">注:<br/> </strong> 1。<strong class="jm io"/><strong class="jm io">browser _ action</strong>的<strong class="jm io"> default_popup </strong>属性设置为页面中的<br/><strong class="jm io">标志。<br/> 2。为了使用Chrome的'<strong class="jm io"> launchWebAuthFlow() </strong>'方法，我们需要'<strong class="jm io"> identity </strong>'权限。</strong></p></div><div class="ab cl lc ld hr le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ig ih ii ij ik"><h2 id="861b" class="my lk in bd ll mz na dn lp nb nc dp lt jv nd ne lx jz nf ng mb kd nh ni mf nj bi translated">让我们做一些实际的Chrome扩展编程。</h2><p id="24a9" class="pw-post-body-paragraph jk jl in jm b jn mh jp jq jr mi jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">我们将从编写应用程序的基本框架逻辑流开始。</p><p id="2168" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在'<strong class="jm io"> popup-sign-in-script.js </strong>中，当用户点击按钮时，我们会向'<strong class="jm io">后台</strong>脚本发送消息，要求“<strong class="jm io">登录</strong>”。<br/>如果我们从“<strong class="jm io">背景</strong>”中获得一个“<strong class="jm io">成功</strong>”，我们将把页面更改为“<strong class="jm io">注销</strong>”页面。</p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="7609" class="my lk in nl b gy np nq l nr ns">// popup-sign-in-script.js</span><span id="7c99" class="my lk in nl b gy nt nq l nr ns">const button = document.querySelector('button');</span><span id="4cc7" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseover', () =&gt; {<br/>    button.style.backgroundColor = 'black';<br/>    button.style.color = 'white';<br/>    button.style.transform = 'scale(1.3)';<br/>});</span><span id="3eab" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseleave', () =&gt; {<br/>    button.style.backgroundColor = '#f5c2e0';<br/>    button.style.color = 'black';<br/>    button.style.transform = 'scale(1)';<br/>});</span><span id="6d5d" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('click', () =&gt; {<br/>    chrome.runtime.sendMessage({ message: 'login' }, function (response) {<br/>        if (response === 'success') window.location.replace("./popup-sign-out.html");<br/>    });<br/>});</span></pre><p id="a5d4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">'<strong class="jm io"> popup.js </strong>'就是这样。您可以关闭文件。<br/>‘<strong class="jm io">popup-sign-out-script . js</strong>’几乎一模一样。</p><p id="1478" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在'<strong class="jm io">popup-sign-out-script . js</strong>'中，当用户点击按钮时，我们会向'<strong class="jm io">后台</strong>脚本发送消息，要求“<strong class="jm io">注销</strong>”。<br/>如果我们从“<strong class="jm io">背景</strong>中得到一个“<strong class="jm io">成功</strong>”，我们将把该页面更改为页面中的<br/><strong class="jm io">标志。</strong></p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="7a2b" class="my lk in nl b gy np nq l nr ns">// popup-sign-out-script.js</span><span id="803d" class="my lk in nl b gy nt nq l nr ns">const button = document.querySelector('button');</span><span id="ee08" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseover', () =&gt; {<br/>    button.style.backgroundColor = 'black';<br/>    button.style.color = 'white';<br/>    button.style.transform = 'scale(1.3)';</span><span id="0033" class="my lk in nl b gy nt nq l nr ns">document.querySelector('div').style.backgroundColor = '#ee2f64';<br/>});</span><span id="c36c" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('mouseleave', () =&gt; {<br/>    button.style.backgroundColor = '#f5c2e0';<br/>    button.style.color = 'black';<br/>    button.style.transform = 'scale(1)';</span><span id="3605" class="my lk in nl b gy nt nq l nr ns">document.querySelector('div').style.backgroundColor = '#fcee54';<br/>});</span><span id="dc66" class="my lk in nl b gy nt nq l nr ns">button.addEventListener('click', () =&gt; {<br/>    chrome.runtime.sendMessage({ message: 'logout' }, function (response) {<br/>        if (response === 'success') window.location.replace("./popup-sign-in.html");<br/>    });<br/>});</span></pre><p id="eb6f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个文件完成了。你可以关闭它。</p><p id="a6bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">转到'<strong class="jm io"> background.js </strong>'脚本，我们将创建<br/><strong class="jm io">Discord oauth 2</strong><strong class="jm io">Endpoint</strong>，这将用于第三方登录凭证。</p><p id="ce1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要<strong class="jm io"> 6个常量</strong>和<strong class="jm io"> 1个变量</strong>。<br/>当我们这样做时，一个变量跟踪用户的登录状态<br/>，我们将创建一个函数将所有这些信息汇集在一起。</p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="f2cf" class="my lk in nl b gy np nq l nr ns">// background.js</span><span id="e29a" class="my lk in nl b gy nt nq l nr ns">const DISCORD_URI_ENDPOINT = '<a class="ae mm" href="https://discord.com/api/oauth2/authorize'" rel="noopener ugc nofollow" target="_blank">https://discord.com/api/oauth2/authorize'</a>;<br/>const CLIENT_ID = encodeURIComponent('');<br/>const RESPONSE_TYPE = encodeURIComponent('token');<br/>const REDIRECT_URI = encodeURIComponent('<a class="ae mm" href="https://pcojhoejgkedcoikfdehlpfefhagppnf.chromiumapp.org/'" rel="noopener ugc nofollow" target="_blank">'</a>);<br/>const SCOPE = encodeURIComponent('identify email');<br/>const STATE = encodeURIComponent('meet' + Math.random().toString(36).substring(2, 15));</span><span id="6625" class="my lk in nl b gy nt nq l nr ns">let user_signed_in = false;</span><span id="b8b1" class="my lk in nl b gy nt nq l nr ns">function create_auth_endpoint() {<br/>    let nonce = <br/>        encodeURIComponent(Math.random().toString(36).substring(2,  <br/>        15) + Math.random().toString(36).substring(2, 15));</span><span id="2a3d" class="my lk in nl b gy nt nq l nr ns">     let endpoint_url =<br/>        `${DISCORD_URI_ENDPOINT}<br/>?client_id=${CLIENT_ID}<br/>&amp;redirect_uri=${REDIRECT_URI}<br/>&amp;response_type=${RESPONSE_TYPE}<br/>&amp;scope=${SCOPE}<br/>&amp;nonce=${nonce}`;</span><span id="b068" class="my lk in nl b gy nt nq l nr ns">  return endpoint_url;<br/>}</span></pre><p id="997a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">注:</strong> <br/> 1。DISCORD _ URI _端点—我们如何到达DISCORD的OAuth2端点<br/> 2。CLIENT_ID —告诉Discord我们被允许使用他们的OAuth2端点<br/> 3。RESPONSE_TYPE —向Discord询问特定类别的信息<br/> 4。REDIRECT_URI —在给我们令牌<br/> 5后将用户重定向到哪里。SCOPE —向Discord询问具体数据<br/> 6。陈述—帮助个性化我们的请求</p><p id="0642" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们在函数中创建了最后一个变量，<strong class="jm io"> nonce </strong>。<br/> ' <strong class="jm io"> nonce </strong>'只是一个字符串，每当我们需要使用Discord OAuth2端点时，它就会随机生成。<br/>每次都需要不同。这就是为什么它不是一个<strong class="jm io">常数</strong>的原因。</p></div><div class="ab cl lc ld hr le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ig ih ii ij ik"><h1 id="3d8c" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">让我们一起努力。</h1><p id="5747" class="pw-post-body-paragraph jk jl in jm b jn mh jp jq jr mi jt ju jv mj jx jy jz mk kb kc kd ml kf kg kh ig bi translated">当我们的'<strong class="jm io"> background.js </strong>'脚本得到消息“登录”时，我们将调用'<strong class="jm io">chrome . identity . launchwebauthflow()</strong>'函数。</p><p id="9bb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这需要两个参数。</p><p id="1d4e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第一个</strong>是一个对象，具有我们构造的OAuth2端点和为真的“<strong class="jm io"> interactive </strong>”标志(这允许用户看到不一致的凭证提示)。</p><p id="6fbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">第二个</strong>是一个回调函数，从<strong class="jm io"> Discord的</strong>服务器给我们一个“<strong class="jm io">重定向uri </strong>”。我们可以使用提供给我们的“令牌”来访问登录用户的Discord数据。</p><p id="1005" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">在本视频中，我们不会这样做；我们只是使用这个端点来"</em> <strong class="jm io"> <em class="ki">认证</em> </strong> <em class="ki">"用户，而不是"</em> <strong class="jm io"> <em class="ki">授权</em> </strong> <em class="ki">"用户。</em></p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="02cf" class="my lk in nl b gy np nq l nr ns">// background.js</span><span id="f178" class="my lk in nl b gy nt nq l nr ns">chrome.runtime.onMessage.addListener((request, sender, sendResponse) =&gt; {<br/>    if (request.message === 'login') {<br/>        chrome.identity.launchWebAuthFlow({<br/>            url: create_auth_endpoint(),<br/>            interactive: true<br/>        }, function (redirect_uri) {<br/>            if (chrome.runtime.lastError || <br/>                redirect_uri.includes('access_denied')) {<br/>                  console.log("Could not authenticate.");<br/>                  sendResponse('fail');<br/>            } else {<br/>                user_signed_in = true;<br/>                sendResponse('success');<br/>            }<br/>        });<br/>        return true;<br/>    } </span></pre><p id="572a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ki">注意:</em> </strong> <em class="ki">除了检查chrome.runtime错误，我们还检查用户是否成功登录。如果没有，一个"</em><strong class="jm io"><em class="ki">error = access _ denied</em></strong><em class="ki">"字符串将在'</em><strong class="jm io"><em class="ki">redirect _ uri</em></strong><em class="ki">'中找到。</em></p><p id="6f9a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">“注销”分支非常简单。</p><p id="5493" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">只需将'<strong class="jm io"> user_signed_in </strong>'标志翻转为false，并发送“成功”响应。</p><pre class="mo mp mq mr gt nk nl nm nn aw no bi"><span id="0bba" class="my lk in nl b gy np nq l nr ns">// background.js</span><span id="8a22" class="my lk in nl b gy nt nq l nr ns">...<br/>    } else if (request.message === 'logout') {<br/>        user_signed_in = false;<br/>        sendResponse('success');<br/>    }</span></pre><p id="05f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们完了。当用户点击按钮中的<strong class="jm io">标志时，他们将进入Discord的登录系统。</strong></p><p id="efea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果他们成功登录，他们将看到我们的“<strong class="jm io">注销</strong>”页面。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nu"><img src="../Images/d671465039c42d97b4fe2c42b07f3b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3TXWlaUs8K158tDAbtVD8Q.png"/></div></div></figure><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/a2ba15a3d6e0e7eacaf727ee5d3c0870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkPmX1tGhVNK0Lt3S29B4Q.png"/></div></div></figure><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/a85296bfce3053dc145b2be6b4f43f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ea44MjUSm5TntwMFHA9C_g.png"/></div></div></figure><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/de348c7fb8890805e2254cb2c25ccfac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrRZNFuEPeN9Mvdb9r3VGg.png"/></div></div></figure></div><div class="ab cl lc ld hr le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ig ih ii ij ik"><p id="73e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以在 这里找到源文件<a class="ae mm" href="https://github.com/an-object-is-a/chrome-ext-discord-oauth2" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">。</strong></a></p><p id="d9d6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一定要在<a class="ae mm" href="https://www.instagram.com/an_object_is_a/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Instagram </strong> </a>和<a class="ae mm" href="https://twitter.com/anobjectisa1" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Twitter </strong> </a>上关注我们，跟上我们最新的<strong class="jm io"> Web开发教程</strong>。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="nv nw l"/></div></figure></div></div>    
</body>
</html>