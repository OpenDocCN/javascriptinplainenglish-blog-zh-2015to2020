<html>
<head>
<title>A Simple “Suggest-as-you-type” Search Widget in VanillaJS.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">VanillaJS中的一个简单的“键入即建议”搜索小部件。</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/simple-suggest-as-you-type-es6-3b6c0fb6489a?source=collection_archive---------1-----------------------#2019-03-30">https://javascript.plainenglish.io/simple-suggest-as-you-type-es6-3b6c0fb6489a?source=collection_archive---------1-----------------------#2019-03-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d479" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个有效的搜索小部件，在您输入时显示建议，使用普通的旧JavaScript，使用Fetch API获取内容。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ee3c91415f358a373bb1ebfb12182d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDobloB92s2_WAGqU3xakQ.png"/></div></div></figure><p id="6329" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在开发<a class="ae ln" href="http://www.influense.me" rel="noopener ugc nofollow" target="_blank">influence $ e</a>的时候，我想让搜索功能成为人们搜索某个影响者的Instagram的强大工具。</p><p id="8146" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为发现是<a class="ae ln" href="http://www.influense.me" rel="noopener ugc nofollow" target="_blank">influence $ e</a>的一个关键区别特征，所以我还想构建一个简单的推荐功能，根据影响者的内容与其核心品牌价值的相关性来定位客户。</p><p id="85a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我将分享代码并带您了解该函数是如何工作的。</p><blockquote class="lo lp lq"><p id="60fa" class="kr ks lr kt b ku kv jr kw kx ky ju kz ls lb lc ld lt lf lg lh lu lj lk ll lm ij bi translated">如果你知道你在做什么，你可以跳到GitHub上的代码。</p></blockquote><h2 id="7919" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated"><strong class="ak">HTML</strong></h2><p id="a982" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我的CSS框架使用UIKit 3，所以这部分很简单。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="4356" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">使用Fetch API获取数据</h2><p id="2382" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我们需要做的第一件事是获得一个对象数组来填充建议，对吗？因此，我们需要向API端点或无头函数或其他什么发出请求。</p><p id="70bd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用Fetch API，因为我们需要的只是一个JSON对象，但是如果你想要更细粒度的控制，你也可以使用XHR。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="559c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">获取非常简单:</p><ul class=""><li id="b07a" class="mv mw iq kt b ku kv kx ky la mx le my li mz lm na nb nc nd bi translated">向API端点<code class="fe ne nf ng nh b">(://&lt;server&gt;/api/)</code>发送一个<code class="fe ne nf ng nh b">GET</code>请求。</li><li id="d87d" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm na nb nc nd bi translated"><code class="fe ne nf ng nh b">.then(res =&gt; res.json())</code>将响应呈现为JSON。</li><li id="17c7" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm na nb nc nd bi translated"><code class="fe ne nf ng nh b">.then(json =&gt; {})</code>是我们可以使用JSON地方。</li><li id="0136" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm na nb nc nd bi translated"><code class="fe ne nf ng nh b">.catch(error =&gt;...);</code>捕捉我们请求中的任何错误。</li></ul><blockquote class="nn"><p id="d5ae" class="no np iq bd nq nr ns nt nu nv nw lm dk translated">Fetch不做任何错误检查！只有当对服务器的实际请求出错时，它才返回失败，比如404或500。因此，您需要编写自己的错误捕获代码。</p></blockquote><p id="8a12" class="pw-post-body-paragraph kr ks iq kt b ku nx jr kw kx ny ju kz la nz lc ld le oa lg lh li ob lk ll lm ij bi translated">如果你运行这段代码，你会得到一个对象数组。在我的例子中，它是一堆社交媒体影响者对象:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/18dbcebfc389f20d7d9d26ace6ab3ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZzbftsEHk3rHrgqDlDmHQ.png"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk">JSON response as seen in Dev tools</figcaption></figure><h2 id="5668" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">编写UI代码</h2><p id="7d15" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">现在我们需要把这个数组变成一个漂亮的下拉列表。我们要生成两种类型的列表。</p><ol class=""><li id="c903" class="mv mw iq kt b ku kv kx ky la mx le my li mz lm oh nb nc nd bi translated">当用户点按搜索栏时，有针对性的推荐的自动列表。</li><li id="2d2c" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm oh nb nc nd bi translated">另一个是我们的“随你输入建议”列表。</li></ol><p id="02c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将把数组传递给一个名为<code class="fe ne nf ng nh b">loadLists()</code>的新函数。让我们更新对调用<code class="fe ne nf ng nh b">loadLists(json):</code>的获取响应</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="bf85" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将我们的成员对象数组传递给一个名为<code class="fe ne nf ng nh b">loadLists()</code>的新函数，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7c62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里发生了几件事。</p><ul class=""><li id="4714" class="mv mw iq kt b ku kv kx ky la mx le my li mz lm na nb nc nd bi translated">首先，我们使用一个扩展操作符<code class="fe ne nf ng nh b">[...json.members]</code>来访问数组中的对象。</li><li id="ceeb" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm na nb nc nd bi translated">接下来，我们创建一个名为<code class="fe ne nf ng nh b">searchSuggest</code>的数组，并在其中调用<code class="fe ne nf ng nh b">filterList()</code>函数。</li><li id="dce6" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm na nb nc nd bi translated">然后，我们在HTML表单的输入字段中添加一个事件监听器。</li><li id="7987" class="mv mw iq kt b ku ni kx nj la nk le nl li nm lm na nb nc nd bi translated">最后，我们将前三名推荐的影响者加载到<code class="fe ne nf ng nh b">presetMembers</code>下拉菜单中(我很快会讲到)。</li></ul><p id="1651" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们创建<code class="fe ne nf ng nh b">searchSuggest</code>数组的原因是因为我们想要将事件和函数调用传递给我们的事件监听器。这只是更清晰地划分我们的职能。</p><p id="dcc7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好了，让我们来看看<code class="fe ne nf ng nh b">filterList();</code>功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="45cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">哇，这是迄今为止最大的一段代码。让我们走一遍。</p><p id="163c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们有几个论点<code class="fe ne nf ng nh b">key</code>和<code class="fe ne nf ng nh b">members</code>。</p><p id="4a4a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，参数<code class="fe ne nf ng nh b">members</code>显然是我们从Fetch API调用中获得的成员数组。</p><h2 id="22be" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">但什么是“<code class="fe ne nf ng nh b">key”</code>？</h2><p id="320e" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">还记得我们创建的那个名为<code class="fe ne nf ng nh b">searchSuggest</code>的数组吗？提醒一下，我们添加的活动是</p><pre class="kg kh ki kj gt oi nh oj ok aw ol bi"><span id="0a0f" class="lv lw iq nh b gy om on l oo op">searchSuggest = [<strong class="nh ir">'input'</strong>, function(e) {...</span></pre><p id="439a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们为<code class="fe ne nf ng nh b"><strong class="kt ir">input</strong></code>添加了一个事件监听器，基本上就是说用户在表单域中输入的每个字符都会触发<code class="fe ne nf ng nh b">input</code>事件。明白了吗？<code class="fe ne nf ng nh b">input</code>事件是击键，这是我们的<code class="fe ne nf ng nh b">key</code>参数。</p><p id="2216" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">换句话说，每当用户在我们的搜索栏中键入一个字符，就触发<code class="fe ne nf ng nh b">filterList()</code>函数。</p><p id="8bca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们从HTML中获取<code class="fe ne nf ng nh b">MemberList</code>元素。这是我们生成成员列表的地方。</p><p id="7789" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好了，来看看我们的<code class="fe ne nf ng nh b">for loop</code>。</p><p id="9a6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这一行中，我们将所有文本转换为小写，因此我们的搜索将不区分大小写:</p><pre class="kg kh ki kj gt oi nh oj ok aw ol bi"><span id="55cb" class="lv lw iq nh b gy om on l oo op">if ((members[i].ig_handle.toLowerCase()).indexOf(key.toLowerCase()) &gt; -1)</span></pre><p id="fbbc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，对于输入的每个字符，我们遍历成员列表并创建一个新的列表项节点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8b80" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ne nf ng nh b">${members[i].ig_handle}</code>这是我们识别会员的方式。就我而言，我是通过他们的Instagram用户名== <code class="fe ne nf ng nh b"><strong class="kt ir">ig_handle</strong></code>来查找的。你应该使用任何适合你需要的东西。</p><p id="518d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们得到最多五个成员，并使用<code class="fe ne nf ng nh b">insertAdjacentHTML</code>将他们添加到我们的列表中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8541" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，如果用户输入少于两个字符——或者退格到少于两个字符——重新加载我们的<code class="fe ne nf ng nh b">presetMembers</code>,隐藏我们的建议:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="414b" class="lv lw iq bd lx ly lz dn ma mb mc dp md la me mf mg le mh mi mj li mk ml mm mn bi translated">将它们缝合在一起</h2><p id="7834" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">让我们用<code class="fe ne nf ng nh b">getElementById:</code>得到我们的元素</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="e7d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们使用模板文字来生成我们的<code class="fe ne nf ng nh b">&lt;ul&gt;</code>标记，我们将把它插入到<code class="fe ne nf ng nh b">presetmember</code> div中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="4901" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就在那里。保存文件,(希望)它应该都工作得很好！</p><p id="e67f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望这对你有帮助。随意评论问题，揭露，侮辱等。</p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="ad84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">获取GitHub上的所有代码:</p><div class="ox oy gp gr oz pa"><a href="https://github.com/MichaelLisboa/suggest-search-vanillaJS" rel="noopener  ugc nofollow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd ir gy z fp pf fr fs pg fu fw ip bi translated">MichaelLisboa/suggest-search-vanillaJS</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">在JavaScript和ui kit 3-MichaelLisboa/suggest-search-vanillaJS中键入搜索时提供建议</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">github.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po kp pa"/></div></div></a></div><p id="0e22" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在www.hypermix.com的<a class="ae ln" href="http://www.hypermix.com" rel="noopener ugc nofollow" target="_blank">查看我的作品集</a></p></div></div>    
</body>
</html>