<html>
<head>
<title>Vue.js Mixins — Global Mixins and Custom Merge Strategies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue.js混合-全局混合和自定义合并策略</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/vue-js-mixins-global-mixins-and-custom-merge-strategies-187f7dac6a8f?source=collection_archive---------5-----------------------#2020-04-06">https://javascript.plainenglish.io/vue-js-mixins-global-mixins-and-custom-merge-strategies-187f7dac6a8f?source=collection_archive---------5-----------------------#2020-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d13fa26f25c2395783a1dcaf90400527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FT2CUZ4zQH9pUz7l"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@kymellis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kym Ellis</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b98a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue.js是一个易于使用的web应用框架，我们可以用它来开发交互式前端应用。</p><p id="1559" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究全局混合和将混合合并到组件中的定制合并策略。</p><h1 id="6f69" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">全球混合</h1><p id="9510" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以创造一种适用于全球的混合。这些混合将影响随后创建的每个Vue实例。因此，我们在使用它们时应该小心。</p><p id="b2e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它来注入适用于所有组件的定制处理逻辑。</p><p id="7287" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下定义全局混合:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b001" class="mn lc iq mj b gy mo mp l mq mr">Vue.mixin({<br/>  created() {<br/>    const foo = this.$options.foo;<br/>    console.log(foo);<br/>  }<br/>});</span><span id="e478" class="mn lc iq mj b gy ms mp l mq mr">new Vue({<br/>  el: "#app",<br/>  foo: "foo"<br/>});</span></pre><p id="20c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们会看到<code class="fe mt mu mv mj b">foo</code>被记录，因为<code class="fe mt mu mv mj b">foo</code>选项是从<code class="fe mt mu mv mj b">created</code>钩子中的<code class="fe mt mu mv mj b">this.$options.foo</code>中检索的。</p><p id="a0c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当<code class="fe mt mu mv mj b">created</code>钩子被调用时，我们会看到<code class="fe mt mu mv mj b">console.log</code>的输出，因为它被调用了。</p><p id="0e56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的例子说明了应该如何使用它。应该很少使用全局混合，因为我们想最小化由全局混合的冲突产生的错误的机会。</p><h1 id="0d77" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自定义选项合并策略</h1><p id="2718" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以调整将mixin代码合并到组件中的策略。</p><p id="653c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们给<code class="fe mt mu mv mj b">Vue.config.optionMergeStrategies</code>分配一个函数。</p><p id="f1c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以这样写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="87fd" class="mn lc iq mj b gy mo mp l mq mr">Vue.config.optionMergeStrategies.myOption = (toVal, fromVal) =&gt; {<br/>  return {<br/>    ...toVal,<br/>    ...fromVal<br/>  };<br/>};</span><span id="60ac" class="mn lc iq mj b gy ms mp l mq mr">Vue.mixin({<br/>  myOption: { foo: 1 }<br/>});</span><span id="cd0b" class="mn lc iq mj b gy ms mp l mq mr">const vm = Vue.extend({<br/>  myOption: { foo: 2 }<br/>});</span><span id="2315" class="mn lc iq mj b gy ms mp l mq mr">console.dir(vm.options.myOption);</span></pre><p id="1333" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到<code class="fe mt mu mv mj b">toVal</code>是来自mixin的<code class="fe mt mu mv mj b">{ foo: 1 }</code>，而<code class="fe mt mu mv mj b">fromVal</code>是来自我们用<code class="fe mt mu mv mj b">Vue.extend</code>创建的组件的<code class="fe mt mu mv mj b">{ foo: 2 }</code>。</p><p id="f971" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们通过让组件的<code class="fe mt mu mv mj b">myOption</code>优先，将mixin中的<code class="fe mt mu mv mj b">myOption</code>合并到组件中。</p><p id="4664" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着<code class="fe mt mu mv mj b">vm.options.myOption</code>具有值<code class="fe mt mu mv mj b">{ foo: 2 }</code>。</p><p id="94c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe mt mu mv mj b">new Vue</code>写同样的东西如下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2f2b" class="mn lc iq mj b gy mo mp l mq mr">Vue.config.optionMergeStrategies.myOption = (toVal, fromVal) =&gt; {<br/>  return {<br/>    ...toVal,<br/>    ...fromVal<br/>  };<br/>};</span><span id="9e4d" class="mn lc iq mj b gy ms mp l mq mr">const mixin = {<br/>  myOption: { foo: 1 }<br/>};</span><span id="b588" class="mn lc iq mj b gy ms mp l mq mr">const vm = new Vue({<br/>  el: "#app",<br/>  myOption: { foo: 2 },<br/>  mixins: [mixin]<br/>});</span><span id="0f1c" class="mn lc iq mj b gy ms mp l mq mr">console.dir(vm.$options.myOption);</span></pre><p id="b762" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到<code class="fe mt mu mv mj b">vm.options.myOption</code>再次具有值<code class="fe mt mu mv mj b">{ foo: 2 }</code>。</p><p id="64fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以将它们翻转过来，这意味着如果它们有相同的名称，mixin的选项优先于组件的选项:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="21a6" class="mn lc iq mj b gy mo mp l mq mr">Vue.config.optionMergeStrategies.myOption = (toVal, fromVal) =&gt; {<br/>  return {<br/>    ...fromVal,<br/>    ...toVal<br/>  };<br/>};</span><span id="1fde" class="mn lc iq mj b gy ms mp l mq mr">const mixin = {<br/>  myOption: { foo: 1 }<br/>};</span><span id="b006" class="mn lc iq mj b gy ms mp l mq mr">const vm = new Vue({<br/>  el: "#app",<br/>  myOption: { foo: 2 },<br/>  mixins: [mixin]<br/>});</span><span id="2169" class="mn lc iq mj b gy ms mp l mq mr">console.dir(vm.$options.myOption);</span></pre><p id="9c6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们从<code class="fe mt mu mv mj b">console.log</code>得到<code class="fe mt mu mv mj b">{ foo: 1 }</code>，这意味着<code class="fe mt mu mv mj b">mixin</code>的<code class="fe mt mu mv mj b">myOption </code>优先于组件的<code class="fe mt mu mv mj b">myOption</code>。</p><p id="53c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过使用<code class="fe mt mu mv mj b">Vue.config.optionMergeStrategies</code>得到各种合并选项的策略。</p><p id="3734" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">常见的选项项目有一些策略，如生命周期挂钩方法、<code class="fe mt mu mv mj b">watch</code>、<code class="fe mt mu mv mj b">computed</code>、<code class="fe mt mu mv mj b">methods</code>、<code class="fe mt mu mv mj b">directives</code>等。</p><p id="2fca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几乎所有我们可以放入Vue的选项，不是我们自己的自定义选项，都在<code class="fe mt mu mv mj b">Vue.config.optionMergeStrategies</code>对象中。</p><p id="4c48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用这些预设的策略来为自己的选项设置合并策略。</p><p id="4ec6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们想要合并<code class="fe mt mu mv mj b">myOption</code>的<code class="fe mt mu mv mj b">methods</code>策略，我们可以写如下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6f43" class="mn lc iq mj b gy mo mp l mq mr">const strategies = Vue.config.optionMergeStrategies;<br/>strategies.myOption = strategies.methods;</span></pre><p id="08e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么合并<code class="fe mt mu mv mj b">myOption</code>的合并策略将与我们用于方法的策略相同，也就是说，如果组件的方法与mixin的方法同名，那么它们将优先于mixin的方法。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/75b7c10bb2999910a7e05efc2405abe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PcKqaSM7O7BgTjgp"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@mattisrad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Matt Heaton</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6565" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="6c21" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以定义全局mixin来将选项从mixin合并到所有组件。</p><p id="330c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不应该经常使用，因为它会产生难以跟踪的冲突。</p><p id="dd13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它应该只用于我们自己自定义的选项。</p><p id="ee3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以创建自己的mixin合并策略，方法是给<code class="fe mt mu mv mj b">Vue.config.optionMergeStrategies.optionName</code>添加一个属性，并设置一个函数，分别从mixin和component获取选项对象，然后返回合并后的对象。</p><p id="b40b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以通过使用<code class="fe mt mu mv mj b">Vue.config.optionMergeStrategies</code>对象来访问完整的策略列表。</p><p id="6f6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【JavaScript用简单英语写的一句话:我们总是对帮助推广优质内容感兴趣。如果你有一篇文章想用简单的英语提交给JavaScript，用你的Medium用户名给我们发邮件到<a class="ae kc" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>，我们会把你添加为作者。</p></div></div>    
</body>
</html>