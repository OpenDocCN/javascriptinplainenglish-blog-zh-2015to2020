<html>
<head>
<title>How To Create Custom Pull To Refresh Animations In React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native中创建自定义拉动以刷新动画</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-how-to-create-custom-pull-to-refresh-animations-aa0d14329dc0?source=collection_archive---------1-----------------------#2020-04-28">https://javascript.plainenglish.io/react-native-how-to-create-custom-pull-to-refresh-animations-aa0d14329dc0?source=collection_archive---------1-----------------------#2020-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a1b5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">…通过使用洛蒂动画</h2></div><h1 id="e096" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">什么是拉刷新？</h1><p id="6991" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我一直着迷于不同的UI交互，以及如此独特和不同的东西是如何变得如此熟悉和易于使用的。今天广泛使用的一个很好的例子是<strong class="kz ir">拉至刷新</strong>。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/8d29749d8630729a375ced75894a93fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/1*_Qs41Q-w7ycJanI94lioBg.gif"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Pull to refresh on iOS</figcaption></figure><p id="65cd" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">这种互动几乎可以在每个移动应用程序中找到，但我向你保证，99.99%的人从未听说过<a class="ae mo" href="https://en.wikipedia.org/wiki/Loren_Brichter" rel="noopener ugc nofollow" target="_blank"> Loren Brichter </a>，即使我们每天都在使用他的作品。点击这里您可以了解更多关于拉至刷新如何诞生的信息<a class="ae mo" href="https://en.wikipedia.org/wiki/Pull-to-refresh" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b4a1" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">从那时起，许多人想出了不同种类的自定义拉刷新动画。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mp"><img src="../Images/b90f0c7b3fb03b02eaefb75550bb5a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*27ZKvWeVYwZjUbmUzuuBTA.gif"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Credits: <a class="ae mo" href="https://dribbble.com/shots/3026988-Pull-To-Refresh-Airbnb" rel="noopener ugc nofollow" target="_blank">https://dribbble.com/shots/3026988-Pull-To-Refresh-Airbnb</a></figcaption></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mp"><img src="../Images/e3cb5923abdd62ebe4db6d3478169634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GA_UPaFN6krQMhRb3lGiqw.gif"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Credits: <a class="ae mo" href="https://dribbble.com/shots/2242263--1-Pull-to-refresh-Freebie-Weather-Concept" rel="noopener ugc nofollow" target="_blank">https://dribbble.com/shots/2242263--1-Pull-to-refresh-Freebie-Weather-Concept</a></figcaption></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4e41eb7021afc5c56b3e429de32fbab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*V9Lvz_tBEIKOaRFdb6yQFQ.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">This one’s my favorite. Stacking burgers! Credits: <a class="ae mo" href="https://dribbble.com/shots/10733383-Pull-to-refresh" rel="noopener ugc nofollow" target="_blank">https://dribbble.com/shots/10733383-Pull-to-refresh</a></figcaption></figure><p id="92eb" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">在四处挖掘之后，我意识到没有任何简单的方法来用React Native创建这些很酷的动画，所以我决定提出自己的解决方案。</p><h1 id="3462" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">我们开始吧</h1><p id="c2a0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我想创造一些对开发者更友好的东西，因为很多解决方案只适用于特定的动画。介绍<a class="ae mo" href="https://lottiefiles.com/" rel="noopener ugc nofollow" target="_blank">洛蒂</a></p><blockquote class="mr ms mt"><p id="2c9b" class="kx ky mu kz b la mj jr lc ld mk ju lf mv ml li lj mw mm lm ln mx mn lq lr ls ij bi translated">一个<strong class="kz ir"> Lottie </strong>是一个基于JSON的动画文件格式，它使设计者能够在任何平台上发布动画，就像发布静态资产一样容易。它们是可以在任何设备上工作的小文件，可以在没有像素化的情况下放大或缩小。</p></blockquote><p id="952e" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">使用Lottie可以让我们快速地将一个动画放入到我们的刷新组件中，并且自动运行。</p><p id="cfb3" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">这是我们今天要建造的东西:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/668e002ec6c199316d30bf9a98c45e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*5SFQyEgUC0u2PelAJolB8A.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Custom pull to refresh animation using Lottie</figcaption></figure></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="7c91" class="kf kg iq bd kh ki nf kk kl km ng ko kp jw nh jx kr jz ni ka kt kc nj kd kv kw bi translated">步骤1:添加洛蒂动画</h1><p id="5c39" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了简单起见，我假设你们已经知道如何使用<code class="fe nk nl nm nn b">FlatList</code>。对于那些想继续学习的人，我为这个教程创建了一个入门模板。你可以在这里<a class="ae mo" href="https://github.com/Groftware/pulltorefreshtutorial" rel="noopener ugc nofollow" target="_blank">下载</a>。下载后不要忘记运行项目中的<code class="fe nk nl nm nn b">yarn install</code>或<code class="fe nk nl nm nn b">npm install</code>，以确保安装了所有的依赖项。</p><p id="48d8" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">你想做的第一件事是得到一个洛蒂动画。浏览<a class="ae mo" href="https://lottiefiles.com/" rel="noopener ugc nofollow" target="_blank"> Lottie文件</a>，挑选一个你喜欢的动画，然后下载成<strong class="kz ir"> Lottie JSON格式</strong>。在本教程中，我将使用这个:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9e6211b0d974f975493714217023b1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*UxmlG86mzNv3rWt_ymJAnQ.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Credits to Alex Martov: <a class="ae mo" href="https://lottiefiles.com/9258-bouncing-fruits" rel="noopener ugc nofollow" target="_blank">https://lottiefiles.com/9258-bouncing-fruits</a></figcaption></figure><p id="adda" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">下载你想要的Lottie动画后，打开项目文件夹，将动画文件移动到<code class="fe nk nl nm nn b">assets/</code>文件夹。同样，确保动画是一个<code class="fe nk nl nm nn b">.json</code>文件！如果没有，回到Lottiefiles，下载JSON版本。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi np"><img src="../Images/1550f2909ab573c12d38cfa84f49a2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*i_oV9Ba-x-oH9SNxwWdLcw.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">I’ve renamed my animation to “bouncing-fruits.json”</figcaption></figure><p id="a175" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">现在您已经获得了动画文件，接下来要做的就是加载它并显示动画。为了做到这一点，我们需要使用<a class="ae mo" href="https://www.npmjs.com/package/lottie-react-native" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">洛蒂</strong></a><strong class="kz ir">-</strong><a class="ae mo" href="https://www.npmjs.com/package/lottie-react-native" rel="noopener ugc nofollow" target="_blank"><strong class="kz ir">react-native</strong></a>。通过运行<code class="fe nk nl nm nn b">yarn add lottie-react-native</code>(或使用<code class="fe nk nl nm nn b">npm install lottie-react-native</code>)进行安装</p><p id="988c" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">导航到<code class="fe nk nl nm nn b">FruitList.jsx</code>，在导入语句的正下方，添加以下内容:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9f4b" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">现在在<code class="fe nk nl nm nn b">styles</code>里面，让我们创建另一种风格，叫做<code class="fe nk nl nm nn b">lottieView</code></p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6525" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">最后，激动人心的部分，让我们将现有的<code class="fe nk nl nm nn b">FlatList</code>和<code class="fe nk nl nm nn b">LottieView</code>包装成一个新的<code class="fe nk nl nm nn b">View</code>。下面是<code class="fe nk nl nm nn b">FruitList.jsx</code>的完整代码。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="adca" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">现在让我们运行应用程序，您可能会看到类似这样的内容</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/35845dc8b1f182aaff4e2176393fbe6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Jp9UxQBvOBDQGzWWZV9n8Q.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Bouncing fruits animation</figcaption></figure><p id="55a2" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">厉害！只不过，当我们打开应用程序时，动画会立即运行。这并不完全是我们所寻求的…让我们弄清楚如何真正将它转化为一种更新的推动力。</p><h1 id="19c2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">步骤2:在平面列表后面“隐藏”动画</h1><p id="d45a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><em class="mu">实现拉动刷新效果的想法很简单</em></p><ol class=""><li id="efb8" class="ns nt iq kz b la mj ld mk lg nu lk nv lo nw ls nx ny nz oa bi translated">将动画隐藏在<code class="fe nk nl nm nn b">FlatList</code>后面。</li><li id="3f4b" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">随着<code class="fe nk nl nm nn b">FlatList</code>向下滚动，跟踪y偏移的变化(他们向下滚动了多少)，并且<em class="mu">适当地使</em>动画化。</li><li id="d7d4" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">当用户释放滚动视图(<code class="fe nk nl nm nn b">onResponderRelease</code>)时，检查偏移是否足以触发刷新。</li><li id="1b61" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">动画在整个刷新过程中保持可见。</li><li id="f15b" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">当刷新结束时，停止动画，然后<code class="fe nk nl nm nn b">FlatList</code>向上滚动隐藏动画。</li></ol><p id="191c" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">为了隐藏<code class="fe nk nl nm nn b">Flatlist</code>后面的动画，我们所要做的就是回到<code class="fe nk nl nm nn b">FruitList.jsx</code>并更新<code class="fe nk nl nm nn b">LottieView</code>的样式。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><blockquote class="mr ms mt"><p id="ee1d" class="kx ky mu kz b la mj jr lc ld mk ju lf mv ml li lj mw mm lm ln mx mn lq lr ls ij bi translated">对于那些没有使用starter项目的人来说,<code class="fe nk nl nm nn b">FlatList</code>必须有一个透明的背景色(或者没有背景色),每行都应该有一个背景色。只有这样做，我们才能让<code class="fe nk nl nm nn b">FlatList</code>向下滚动时动画可见。</p></blockquote><h1 id="ae84" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">第三步:跟踪滚动偏移</h1><p id="3d0b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了跟踪滚动偏移，我们将使用<code class="fe nk nl nm nn b">onScroll</code>道具，然后将其存储到名为<code class="fe nk nl nm nn b">offsetY</code>的状态中。</p><p id="da28" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">在<code class="fe nk nl nm nn b">FruitList.jsx</code>的最顶部，修改导入语句以包括<code class="fe nk nl nm nn b">useState</code>，然后创建一个名为<code class="fe nk nl nm nn b">offsetY</code>的新状态。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="cf28" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">创建一个接收滚动事件的功能<code class="fe nk nl nm nn b">onScroll</code>，然后将y偏移量设置为状态。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2a24" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">然后记住将<code class="fe nk nl nm nn b">onScroll</code>功能分配给oncroll<code class="fe nk nl nm nn b">FlatList</code>道具。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="96a9" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">瞧！我们现在能够跟踪<code class="fe nk nl nm nn b">Flatlist</code>的y偏移。现在让我们利用偏移y，然后<em class="mu">根据偏移制作动画</em>。对我们来说幸运的是，<code class="fe nk nl nm nn b">LottieView</code>给了我们支柱<code class="fe nk nl nm nn b">progress</code>。以下是文档必须说明的内容:</p><blockquote class="mr ms mt"><p id="838f" class="kx ky mu kz b la mj jr lc ld mk ju lf mv ml li lj mw mm lm ln mx mn lq lr ls ij bi translated"><strong class="kz ir">进程:</strong>0-1之间的数字，或0-1之间的<code class="fe nk nl nm nn b">Animated</code>数字。这个数字表示动画的标准化进度。如果您更新这个道具，动画将相应地更新到该进度值的帧。如果您使用的是命令式API，则不需要该属性。</p></blockquote><p id="afa2" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">嗯……有趣。所以<code class="fe nk nl nm nn b">progress</code>是决定动画帧的百分比。目前，我们有<code class="fe nk nl nm nn b">yOffset</code>，如果您做<code class="fe nk nl nm nn b">console.log(yOffset)</code>并向下滚动，您会看到如下内容:</p><blockquote class="og"><p id="48b2" class="oh oi iq bd oj ok ol om on oo op ls dk translated">-0.5<br/>-15.5<br/>-75.5<br/>-101.5<br/>…</p></blockquote><p id="0f3b" class="pw-post-body-paragraph kx ky iq kz b la oq jr lc ld or ju lf lg os li lj lk ot lm ln lo ou lq lr ls ij bi translated">要将其转换为百分比(0到1之间的值)，我们还需要刷新发生的高度。</p><p id="4453" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">方便的是，我们已经有了。看看<code class="fe nk nl nm nn b">lottieView</code>款式，你会注意到<code class="fe nk nl nm nn b">height</code>被设为<code class="fe nk nl nm nn b">100</code>，这就是我们的身高。让我们通过在样式之上创建一个名为<code class="fe nk nl nm nn b">refreshingHeight</code>的新变量来重构它。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6846" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">现在要取得进展，我们所要做的就是<code class="fe nk nl nm nn b">-offsetY / refreshingHeight</code></p><p id="3d3b" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">在<code class="fe nk nl nm nn b">onScroll</code>函数之后，我们将创建<code class="fe nk nl nm nn b">progress</code>变量，并将其赋给<code class="fe nk nl nm nn b">LottieView</code>道具。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0cb1" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">如果你现在运行应用程序，你应该能够向下滚动，看到动画跟随你的滚动！</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/d60064a307c027c788a72ace130af0ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*_-7ZP89LOIfizU4jLMvJtQ.gif"/></div></figure><h1 id="492f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">步骤4:刷新时</h1><p id="0bac" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">还记得<strong class="kz ir">第二步</strong>中详述的计划吗？这是我们到目前为止所做的。</p><ol class=""><li id="d2d4" class="ns nt iq kz b la mj ld mk lg nu lk nv lo nw ls nx ny nz oa bi translated">h̶i̶d̶e̶̶t̶h̶e̶̶a̶n̶i̶m̶a̶t̶i̶o̶n̶̶b̶e̶h̶i̶n̶d̶̶t̶h̶e̶̶<code class="fe nk nl nm nn b">F̶l̶a̶t̶L̶i̶s̶t̶</code>.̶</li><li id="cd81" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">a̶s̶̶t̶h̶e̶̶<code class="fe nk nl nm nn b">F̶l̶a̶t̶L̶i̶s̶t̶</code>̶s̶c̶r̶o̶l̶l̶s̶̶d̶o̶w̶n̶,̶̶t̶r̶a̶c̶k̶̶t̶h̶e̶̶c̶h̶a̶n̶g̶e̶s̶̶i̶n̶̶y̶-̶o̶f̶f̶s̶e̶t̶̶(̶h̶o̶w̶̶m̶u̶c̶h̶̶d̶i̶d̶̶t̶h̶e̶y̶̶s̶c̶r̶o̶l̶l̶̶d̶o̶w̶n̶)̶,̶̶a̶n̶d̶̶a̶n̶i̶m̶a̶t̶e̶̶t̶h̶e̶̶a̶n̶i̶m̶a̶t̶i̶o̶n̶̶a̶p̶p̶r̶o̶p̶r̶i̶a̶t̶e̶l̶y̶.̶</li><li id="b80b" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">当用户释放滚动视图(<code class="fe nk nl nm nn b">onResponderRelease</code>)时，检查偏移量是否足以触发刷新。</li><li id="7219" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">动画在整个刷新过程中保持可见。</li><li id="e027" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls nx ny nz oa bi translated">当刷新结束时，停止动画，然后<code class="fe nk nl nm nn b">FlatList</code>向上滚动隐藏动画。</li></ol><p id="d6e7" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">让我们从创建另一个新状态<code class="fe nk nl nm nn b">isRefreshing</code>开始。这将用于跟踪列表是否正在刷新。在<code class="fe nk nl nm nn b">offsetY</code>状态下添加以下内容。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="f212" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">然后在<code class="fe nk nl nm nn b">onScroll</code>函数之后创建函数<code class="fe nk nl nm nn b">onRelease</code>。然后将其分配给FlatList prop <code class="fe nk nl nm nn b">onResponderRelease</code>。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="7ce6" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">步骤5:刷新时动画保持可见</h1><p id="1bdf" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了确保动画可见，我们将向现有的<code class="fe nk nl nm nn b">FlatList</code>添加一个空的<code class="fe nk nl nm nn b">ListHeaderComponent</code>，其中的<code class="fe nk nl nm nn b">paddingTop</code>相当于<code class="fe nk nl nm nn b">refreshingHeight</code>。</p><p id="9ee0" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">在<code class="fe nk nl nm nn b">isRefreshing</code>下面，创建一个新的状态<code class="fe nk nl nm nn b">extraPaddingTop</code>。这将为我们的不可见的<code class="fe nk nl nm nn b">ListHeaderComponent</code>保存填充值。然后在<code class="fe nk nl nm nn b">onRelease</code>函数中，刷新时将<code class="fe nk nl nm nn b">extraPaddingTop</code>置为<code class="fe nk nl nm nn b">refreshingHeight</code>，刷新完毕置为0。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6b77" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">我们快到了！现在运行该应用程序将显示如下内容</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/9d19e0c31d4f84b4b5b6da2c7492ddcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*SVjkiYKnx54r7YlGRyXKRw.gif"/></div></figure><p id="c095" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">有几件事似乎不太对劲。动画在刷新时不动，当刷新完成时，<code class="fe nk nl nm nn b">FlatList</code>突然跳回原位。但是别担心，我们接下来会解决这些问题。</p><h1 id="62b8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">步骤6:刷新时显示动画，刷新结束时隐藏</h1><p id="84fa" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将从刷新结束时优雅地折叠<code class="fe nk nl nm nn b">FlatList</code>开始。但在此之前，让我们稍微重构一下我们的代码。每当<code class="fe nk nl nm nn b">isRefreshing</code>被更新时，让我们使用<code class="fe nk nl nm nn b">useEffect</code>来更新其他状态。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5c90" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">现在我们在<code class="fe nk nl nm nn b">onRelease</code>中要做的就是<code class="fe nk nl nm nn b">setIsRefreshing</code>，我们的<code class="fe nk nl nm nn b">useEffect</code>钩子会自动为我们设置填充。</p><p id="f2a4" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">现在，让我们用动画来解决这个问题。创建一个新的<code class="fe nk nl nm nn b">ref</code>，并将其附加到<code class="fe nk nl nm nn b">LottieView</code>，这样我们就可以在刷新时触发<code class="fe nk nl nm nn b">play</code>功能。参考下面的代码。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d374" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">最后，让我们在动画结束时让平面列表优雅地折叠。为此，我们将利用React Native的<a class="ae mo" href="https://reactnative.dev/docs/animated" rel="noopener ugc nofollow" target="_blank">动画</a> API，并将<code class="fe nk nl nm nn b">extraPaddingTop</code>从固定值更新为动画值。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="9aea" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">我们完事了。</h1><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/0e593f463a52b96395ee480d88349e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*g5J7vM7pcBOFjfdM06dEKg.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Your newly completed pull to refresh animation</figcaption></figure><p id="8823" class="pw-post-body-paragraph kx ky iq kz b la mj jr lc ld mk ju lf lg ml li lj lk mm lm ln lo mn lq lr ls ij bi translated">你可以在这里找到已完成的项目<a class="ae mo" href="https://github.com/Groftware/pulltorefreshtutorial/tree/completed" rel="noopener ugc nofollow" target="_blank">。或者在starter项目中，可以检出到分支<code class="fe nk nl nm nn b">completed</code>来查看完成的版本。</a></p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><blockquote class="mr ms mt"><p id="eef1" class="kx ky mu kz b la mj jr lc ld mk ju lf mv ml li lj mw mm lm ln mx mn lq lr ls ij bi translated">编辑:对于那些对使用作为组件感兴趣的人，我也把它作为一个npm包提供了。在这里查看<a class="ae mo" href="https://www.npmjs.com/package/@groftware/lottie-flatlist" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><div class="ov ow gp gr ox oy"><a href="http://eepurl.com/gZEdtb" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd ir gy z fp pd fr fs pe fu fw ip bi translated">软件开发</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">你准备好进入下一关了吗？🚀立即注册我们的时事通讯，接收新鲜出炉的软件开发…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">eepurl.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm md oy"/></div></div></a></div><h1 id="7711" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">链接</h1><ul class=""><li id="7e48" class="ns nt iq kz b la lb ld le lg pn lk po lo pp ls pq ny nz oa bi translated">洛伦·布里切特</li><li id="ab33" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls pq ny nz oa bi translated"><a class="ae mo" href="https://en.wikipedia.org/wiki/Pull-to-refresh" rel="noopener ugc nofollow" target="_blank">拉至刷新</a></li><li id="d405" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls pq ny nz oa bi translated"><a class="ae mo" href="https://lottiefiles.com/" rel="noopener ugc nofollow" target="_blank">洛蒂档案</a></li><li id="9a6e" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls pq ny nz oa bi translated"><a class="ae mo" href="https://www.npmjs.com/package/lottie-react-native" rel="noopener ugc nofollow" target="_blank">洛蒂-反应-原生</a></li><li id="7337" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls pq ny nz oa bi translated"><a class="ae mo" href="https://reactnative.dev/docs/animated" rel="noopener ugc nofollow" target="_blank"> React原生动画API </a></li><li id="2325" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls pq ny nz oa bi translated"><a class="ae mo" href="https://github.com/Groftware/pulltorefreshtutorial" rel="noopener ugc nofollow" target="_blank">首发项目</a></li><li id="cd29" class="ns nt iq kz b la ob ld oc lg od lk oe lo of ls pq ny nz oa bi translated"><a class="ae mo" href="https://github.com/Groftware/pulltorefreshtutorial/tree/completed" rel="noopener ugc nofollow" target="_blank">已完成项目</a></li></ul></div></div>    
</body>
</html>