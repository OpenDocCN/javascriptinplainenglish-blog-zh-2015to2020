<html>
<head>
<title>Dockerizing a basic Node.js/Nest.js application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将基本的Node.js/Nest.js应用程序归档</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/dockerizing-a-nestjs-nodejs-app-d440762d98a4?source=collection_archive---------4-----------------------#2020-10-03">https://javascript.plainenglish.io/dockerizing-a-nestjs-nodejs-app-d440762d98a4?source=collection_archive---------4-----------------------#2020-10-03</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj jo"><img src="../Images/d17abc1e5af287be96cc22ce78c266fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cRP9RNcKE-kgdbzG0nT50A.jpeg"/></div></div></figure><p id="daf0" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">今天我们将Dockerize一个Node.js应用程序。今天我们将使用Nest.js。但是对于任何构建了其他框架(如Express.js)的Node.js应用程序，命令和过程都是完全相同的。</p><h1 id="8b33" class="kx ky ir bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"><em class="lv">nest . js是什么，我们为什么要用它？</em>T3】</strong></h1><p id="ffc2" class="pw-post-body-paragraph jz ka ir kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ik bi translated"><strong class="kb is"> Nest.js </strong>是一个渐进式Node.js框架。构造Nodejs项目有很多方法，尤其是当我们使用express或其他类似的框架时。但是当多人在同一个项目上工作时，这可能会是一个问题。在这些情况下，Nest.js可以提供帮助。它遵循创建项目的特定模式，并有助于保持我们的应用程序的不同模块相互分离，这很棒！</p><h2 id="4046" class="mb ky ir bd kz mc md dn ld me mf dp lh kk mg mh ll ko mi mj lp ks mk ml lt mm bi translated"><strong class="ak"><em class="lv">nest . js入门</em> </strong></h2><p id="5367" class="pw-post-body-paragraph jz ka ir kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ik bi translated">首先，我们需要安装Nest.js cli。在您的终端上运行以下命令。</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="41b0" class="mb ky ir ms b gz mw mx l my mz">npm i -g @nestjs/cli</span></pre><p id="6e4c" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">安装完成后，我们可以像这样非常容易地搭建一个新的Nest.js应用程序。</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="18e8" class="mb ky ir ms b gz mw mx l my mz">nest new example-app</span></pre><p id="25da" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">初始化后，我们可以进入项目目录并立即开始项目！</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="8f83" class="mb ky ir ms b gz mw mx l my mz">cd example-app</span><span id="43e7" class="mb ky ir ms b gz na mx l my mz">yarn start:dev</span></pre><p id="8cab" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">您的项目将在本地主机的端口3000上运行。打开你的浏览器，进入<strong class="kb is"> http://localhost:3000/ </strong>，你会得到一个‘Hello World’的响应！</p><figure class="mn mo mp mq gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj nb"><img src="../Images/5e9827a821cb0b7e0c1ed45f87a88609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W6n9mhEEIezlgR90NScaDw.png"/></div></div><figcaption class="nc nd gk gi gj ne nf bd b be z dk">The first response from NestJS app!</figcaption></figure><h1 id="86c3" class="kx ky ir bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"><em class="lv">Docker是什么，我们为什么要使用它？</em>T15】</strong></h1><p id="1e50" class="pw-post-body-paragraph jz ka ir kb b kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ma ku kv kw ik bi translated">Docker是一种容器化应用程序的方式，这样你就不必担心不同的运行时、依赖关系或版本。如果docker映像在您的本地机器上运行，它将在任何机器上运行。这对于轻松部署我们的应用程序或与其他人共享非常有用。现在，我们将一步一步地对我们的应用程序进行分类。</p><p id="0850" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><strong class="kb is">第一步:安装Docker </strong></p><p id="4905" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">要安装码头工人，请点击此处<a class="ae ng" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/get-docker/</a></p><p id="e26f" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">第二步:将Docker添加到你的项目中</p><p id="be19" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">在根目录中添加一个名为Dockerfile的新文件</p><figure class="mn mo mp mq gu js gi gj paragraph-image"><div class="gi gj nh"><img src="../Images/725efeb0c988ab8be922bc451cb6c180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*bf8-jSkiNnL7tBWwdAbMoQ.png"/></div></figure><p id="d1bd" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><strong class="kb is">第三步:添加Docker命令</strong></p><p id="52c3" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">将以下代码添加到docker文件中。</p><figure class="mn mo mp mq gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj ni"><img src="../Images/04a6f31d5d2b17b1f58a821e8a6ad62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QddHHS0uk157_M4tmhyH2A.png"/></div></div></figure><p id="a31f" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">让我们一行一行地分析代码</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="0cf3" class="mb ky ir ms b gz mw mx l my mz"><em class="nj">FROM </em>node:12</span></pre><p id="7a53" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">在这里，我们设置我们的应用程序将运行的基础图像。这里我们选择节点:12，它是可以在docker hub中找到的节点的官方映像。</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="e71e" class="mb ky ir ms b gz mw mx l my mz"><em class="nj">WORKDIR /</em>app</span></pre><p id="28a2" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们将工作目录设置为app。</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="02a3" class="mb ky ir ms b gz mw mx l my mz"><em class="nj">ADD </em>package.json <em class="nj">/</em>app<em class="nj">/</em>package.json</span></pre><p id="f43d" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们将package.json文件移到我们的工作目录中。</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="ca1b" class="mb ky ir ms b gz mw mx l my mz"><em class="nj">RUN </em>npm install</span></pre><p id="7cfa" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们在根目录中运行通常的npm安装</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="9fe9" class="mb ky ir ms b gz mw mx l my mz"><em class="nj">ADD </em>. <em class="nj">/</em>app</span></pre><p id="2323" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们将内容移动到应用程序目录中</p><p id="07f0" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们将3000端口暴露在容器中，以便它可以与容器外部通信。这将取决于您的应用程序运行在哪个端口上。鸟巢通常是3000</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="ee3f" class="mb ky ir ms b gz mw mx l my mz"><em class="nj">CMD </em>["npm", "run", "start"]</span></pre><p id="5aee" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">最后，我们运行命令来启动应用程序。任何docker文件中只能有一个CMD命令。</p><p id="a10e" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><strong class="kb is">第四步:建立你的Docker形象</strong></p><p id="25ef" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">运行以下命令来构建docker映像。从项目的同一个根目录中运行这个程序</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="312e" class="mb ky ir ms b gz mw mx l my mz">docker build . -t example-app</span></pre><p id="8141" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">这里我们用-t来命名我们的图像。我们可以给我们的图像起任何名字。为了保持一致，我们在这里使用项目名称。构建映像需要一段时间。</p><p id="46a4" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><strong class="kb is">第五步:运行docker映像</strong></p><p id="003d" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们可以通过跑步来观看图像。</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="e6c2" class="mb ky ir ms b gz mw mx l my mz">docker images</span></pre><p id="a7d2" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">它将列出我们机器中的所有图像</p><figure class="mn mo mp mq gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj nk"><img src="../Images/7668be8e9b25ac7f0fe34daabed075ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*woJFAiTiOI9up3mnn0qWdw.png"/></div></div><figcaption class="nc nd gk gi gj ne nf bd b be z dk">images in our machine</figcaption></figure><p id="2daa" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">我们可以看到，我们的图像有“最新”作为标签。它是默认给定的。如果我们愿意，我们可以重新标记我们的图像。现在要运行我们的映像，我们首先需要通过<strong class="kb is"> <em class="nj"> Ctrl+ C </em> </strong>停止项目的运行实例，然后运行下面的命令…</p><pre class="mn mo mp mq gu mr ms mt mu aw mv bi"><span id="0b0c" class="mb ky ir ms b gz mw mx l my mz">docker run --rm -it -p 3000:3000/tcp example-app:latest</span></pre><p id="6e52" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">该命令有几个部分，但最重要的部分是查看3000:3000/tcp  这里的第一个3000表示我们希望映射到运行docker映像的本地主机的端口。第二个3000是我们之前设置的docker容器内部的公开端口。</p><p id="c448" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">如果我们想知道这是否可行，我们可以像以前一样打开浏览器，进入。<a class="ae ng" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>看看是否按预期工作。</p><p id="2325" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><strong class="kb is">第六步:玩它</strong></p><p id="d6db" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">现在，您可以更改您的代码并重新构建映像，然后再次运行以查看是否在docker映像中发现了更改。</p><p id="8d4f" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated">你可以在这里找到这个项目的代码。</p><div class="nl nm gq gs nn no"><a href="https://github.com/Mohammad-Faisal/example-nestjs-app" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd is gz z fq nt fs ft nu fv fx iq bi translated">GitHub-Mohammad-fais al/example-nestjs-app</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">一个渐进式Node.js框架，用于构建高效且可伸缩的服务器端应用程序，其灵感主要来自…</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jx no"/></div></div></a></div><p id="05e4" class="pw-post-body-paragraph jz ka ir kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ik bi translated"><strong class="kb is">通过</strong><a class="ae ng" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="kb is">LinkedIn</strong></a><strong class="kb is">或我的</strong> <a class="ae ng" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb is">个人网站</strong> </a> <strong class="kb is">与我取得联系。</strong></p></div></div>    
</body>
</html>