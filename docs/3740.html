<html>
<head>
<title>SEO for Next.js: Generating a Dynamic Sitemap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js的SEO:生成动态站点地图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/search-engine-optimisation-seo-for-next-js-generating-a-dynamic-sitemap-6a7698ea8c1a?source=collection_archive---------7-----------------------#2020-10-21">https://javascript.plainenglish.io/search-engine-optimisation-seo-for-next-js-generating-a-dynamic-sitemap-6a7698ea8c1a?source=collection_archive---------7-----------------------#2020-10-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bbe5b65e6e76c145406a7410011f6e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ihjhRdaAJEiLA0jcrNKCNA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@merakist?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Merakist</a> on <a class="ae jz" href="https://unsplash.com/s/photos/seo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="fbcd" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">什么是网站地图，为什么它对SEO有益？</h1><p id="b3a1" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">Next.js因其搜索引擎优化友好性和易于设置而在网络社区中广受欢迎。虽然Next.js提供了很多有益的特性，但是你可以为你的网站生成站点地图，并提交给各种搜索引擎。等等，什么是我们的网站地图？</p><p id="0729" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">网站地图是一个文件，它包含了你的网站中的页面、视频和其他资产文件的详细信息，以及它们之间的对应关系。网站地图有助于搜索引擎，如谷歌和雅虎，更好地理解你的网页之间的关系，从而使它们能够被更恰当地索引。</p><p id="3ea2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这是一个三页的网站示例文件的样子:</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="cb4b" class="mn kb in me b gy mo mp l mq mr">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/><strong class="me io">&lt;urlset</strong> <strong class="me io">&gt;<br/>  &lt;url&gt;</strong><br/>    <strong class="me io">&lt;loc&gt;</strong>http://www.example.net/<strong class="me io">&lt;/loc&gt;</strong><br/>    <strong class="me io">&lt;lastmod&gt;</strong>2009-09-22<strong class="me io">&lt;/lastmod&gt;</strong><br/>  <strong class="me io">&lt;/url&gt;<br/></strong>  <strong class="me io">&lt;url&gt;</strong><br/>    <strong class="me io">&lt;loc&gt;</strong>http://www.example.net/about<strong class="me io">&lt;/loc&gt;</strong><br/>    <strong class="me io">&lt;lastmod&gt;</strong>2009-09-22<strong class="me io">&lt;/lastmod&gt;</strong><br/>  <strong class="me io">&lt;/url&gt;</strong><br/>  <strong class="me io">&lt;url&gt;</strong><br/>    <strong class="me io">&lt;loc&gt;</strong>http://www.example.net/blog<strong class="me io">&lt;/loc&gt;</strong><br/>    <strong class="me io">&lt;lastmod&gt;</strong>2009-09-22<strong class="me io">&lt;/lastmod&gt;</strong><br/>  <strong class="me io">&lt;/url&gt;</strong><br/><strong class="me io">&lt;/urlset&gt;</strong></span></pre><p id="6afe" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">如果你有一个小网站，或者你的应用程序中的页面链接良好，你可能不需要网站地图。如果您的网页不经常更改，您甚至可以编写自己的静态xml文件。谷歌有一个<a class="ae jz" href="https://support.google.com/webmasters/answer/156184?hl=en#:~:text=A%20sitemap%20is%20a%20file,more%20intelligently%20crawl%20your%20site.&amp;text=A%20sitemap%20image%20entry%20can,matter%2C%20type%2C%20and%20license." rel="noopener ugc nofollow" target="_blank">综合指南</a>，详细说明了你个人用例的最佳前进方式。</p><p id="3a84" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">如果你决定生成一个网站地图，并且你的网站是基于Next.js的，那么请继续阅读！</p></div><div class="ab cl ms mt hr mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ig ih ii ij ik"><h2 id="f174" class="mn kb in bd kc mz na dn kg nb nc dp kk lj nd ne ko ln nf ng ks lr nh ni kw nj bi translated">步骤1:设置和项目结构</h2><p id="5bf2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">如果您还没有Next.js项目设置，您可以按照官方Next.js <a class="ae jz" href="https://nextjs.org/learn/basics/create-nextjs-app" rel="noopener ugc nofollow" target="_blank">教程</a>上的说明设置一个启动器。</p><p id="3d4b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">大多数Next.js网站在<code class="fe mb mc md me b">pages</code>目录中有静态和动态生成的页面。为了读取这些页面名，我们将安装<code class="fe mb mc md me b">globby</code>——一个可以遍历文件系统并返回路径名的NPM包。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="6eb0" class="mn kb in me b gy mo mp l mq mr">yarn add --dev globby</span></pre><p id="08d7" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这是我们的站点地图生成脚本唯一需要的外部依赖。</p><p id="4de6" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">创建站点地图有两个部分。让我们来看一个标准的Next.js项目结构。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="876d" class="mn kb in me b gy mo mp l mq mr">|- pages/<br/>    |- about.js                 # about page<br/>    |- blog/                    # blog folder<br/>        |- index.js             # default blog <br/>        |- [id].js.             # dynamically generated blog posts</span><span id="a6e7" class="mn kb in me b gy nk mp l mq mr">|- components/<br/>        |- MainComponent.jsx    # Main component<br/>        |- OtherComponents.jsx  # Other component</span></pre><p id="151d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">首先，我们的脚本需要遍历文件系统并找到静态文件的名称(在本例中，是about.js和两个index.js文件)。其次，我们需要添加所有的动态页面([id])。js)到我们的网站地图。在这种情况下，遍历文件系统是行不通的，因为我们必须知道页面的所有URL。我们将在步骤3中解决这个问题。首先，我们为所有静态页面生成一个站点地图。</p><h2 id="a24f" class="mn kb in bd kc mz na dn kg nb nc dp kk lj nd ne ko ln nf ng ks lr nh ni kw nj bi translated">步骤2:编写生成站点地图的脚本</h2><p id="198c" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">一旦我们有了基本的设置，我们现在可以写一个小脚本来生成一个站点地图。我已经把我的写在<code class="fe mb mc md me b">utils/sitemap.js</code>里了，但是你可以随意选择一个文件夹！下面的脚本将把我们所有的静态文件转换成路径名，然后把它们转储到一个xml文件中，这个文件可以在我们的公共目录中被访问。</p><p id="d95e" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我在要点上添加了一些评论，进一步解释了正在发生的事情。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="dc05" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">简而言之，我们使用<code class="fe mb mc md me b">globby</code>从我们的目录中获取路径名(忽略我们的api路由和其他我们不想包含在站点地图中的页面)。然后，我们对这些进行映射，并为其中的每一个生成一个<code class="fe mb mc md me b">&lt;url&gt;&lt;loc&gt;&lt;/url&gt;</code>形式的条目。简单！</p><h2 id="9247" class="mn kb in bd kc mz na dn kg nb nc dp kk lj nd ne ko ln nf ng ks lr nh ni kw nj bi translated">步骤3:更新next.config.js以在构建时运行脚本</h2><p id="a0d7" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">既然我们已经编写了初始脚本，我们需要更新next.config.js文件中的webpack配置，以便在构建时生成站点地图。确保根据您的项目结构更新您的文件路径！现在当你运行<code class="fe mb mc md me b">yarn dev</code>或<code class="fe mb mc md me b">npm run dev</code>时，你应该会在你的<code class="fe mb mc md me b">public/</code>文件夹中得到一个<code class="fe mb mc md me b">sitemap.xml</code>文件。</p><pre class="mf mg mh mi gt mj me mk ml aw mm bi"><span id="0bc2" class="mn kb in me b gy mo mp l mq mr">module.exports = {<br/>  webpack: (config, { isServer }) =&gt; {<br/>  if (isServer) {<br/>    require('./src/utils/sitemap.js')<br/>  }<br/>  return config<br/>  }<br/>};</span></pre><p id="6b4d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated"><strong class="la io">步骤4:处理动态页面(或通过外部api生成的页面)</strong></p><p id="92d5" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">Next.js的关键特性之一是能够生成动态页面。我们在原始脚本中没有考虑这些动态页面，但是添加这些页面非常简单。根据用于生成动态页面URL的slugs的来源，实现会有所不同。如果您的页面是从外部api或CMS(例如，Contentful)中获取的，那么您必须先获取这些页面的[id]参数，然后才能为它们生成站点地图。</p><p id="bebc" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">您可以将它们存储在数据库中，直接从CMS获取它们，或者在json文件中有一个页面名称列表——但是想法是一样的，查询这个列表并映射名称以在sitemap文件中形成一个<code class="fe mb mc md me b">&lt;loc&gt;</code>实例。轻松点。</p><p id="479d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">对于这个例子，我们将使用一个外部api。在https://jsonplaceholder.typicode.com/有一个很好的模拟数据api。我们将查询假帖子，并使用这些帖子中的id来生成我们的页面。</p><p id="56df" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">最终的代码应该看起来像这样，并附有解释。</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="5b03" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">简而言之，我们从外部来源获取了一个样本帖子列表，并映射它们以生成它们各自的URL路径。现在，如果你运行<code class="fe mb mc md me b">npm run dev</code>或<code class="fe mb mc md me b">yarn dev</code>，你应该得到一个新的文件<code class="fe mb mc md me b">public/sitemap.xml</code>，它将保存你的站点地图的内容。</p><p id="6872" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">一旦您部署了您的网站，您的站点地图将在<code class="fe mb mc md me b">https://YOUR_URL/sitemap.xml</code>变得可访问，并且您可以使用您的唯一链接将您的站点地图提交给各种搜索引擎(例如，在Google的搜索控制台中)。</p><p id="7950" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这就是所有的人！我们已经为静态编写和动态生成的页面创建了一个站点地图！现在，无论您何时添加新页面，无论是静态编写的还是动态生成的，并且触发了新的构建，您的站点地图都会自动更新，搜索引擎将能够有效地抓取它们。编码快乐！</p></div></div>    
</body>
</html>