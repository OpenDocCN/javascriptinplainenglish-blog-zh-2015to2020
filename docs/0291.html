<html>
<head>
<title>Unraveling the power of Headless browser with Puppeteer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用木偶师揭开无头浏览器的威力</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unraveling-the-power-of-headless-browser-with-puppeteer-eb585a2ee393?source=collection_archive---------3-----------------------#2019-09-12">https://javascript.plainenglish.io/unraveling-the-power-of-headless-browser-with-puppeteer-eb585a2ee393?source=collection_archive---------3-----------------------#2019-09-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="6814" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">作为一名web开发人员，我每天有一半的时间花在浏览器上。</h1><p id="18c0" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对我来说，浏览器总是我看到的东西，包括所有的布局、表单、开发者工具等等。当我了解了无头浏览器之后，我开始深入研究它。原来这是这么强大的一件事，这些年来我一直没有意识到。它让我如此着迷，以至于我来到这里做一些记录。但是在继续之前，让我们知道什么是无头浏览器；</p><p id="e334" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj">无头浏览器是没有图形用户界面的网络浏览器。它在类似于流行的web浏览器的环境中提供了对网页的自动控制，但是是通过命令行界面执行的。</em></p><p id="c131" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">简单地说，这意味着没有图形用户界面(GUI)。但是没有GUI的浏览器有什么意义呢？开始了。</p><p id="3648" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们可以用许多不同的工具来揭示无头浏览器的威力，但我现在和<a class="ae lp" href="https://developers.google.com/web/tools/puppeteer/" rel="noopener ugc nofollow" target="_blank">木偶师</a>在一起。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/c97b8eb16f93c4d2eac6026a0b56d2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WHo7bG8yHKyt_nzn.png"/></div></div></figure><p id="1360" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">使用Puppeteer，我们将拍摄网络浏览器的<strong class="kn ir">屏幕截图</strong>，生成网页的<strong class="kn ir">PDF</strong>和<strong class="kn ir">自动提交表单</strong>而无需抬头。但是木偶师到底是什么？</p><blockquote class="mc md me"><p id="5e98" class="kl km lj kn b ko lk kq kr ks ll ku kv mf lm ky kz mg ln lc ld mh lo lg lh li ij bi translated"><em class="iq"> Puppeteer是一个节点库，它提供了一个高级API来控制Chrome或DevTools协议上的Chrome。默认情况下，Puppeteer是无头运行的，但是可以配置为运行完整的(非无头)Chrome或Chrome。</em></p></blockquote><p id="0ef3" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir">TLDR；假设已经在您的设备中设置了节点环境，让我们从设置无头chrome和木偶师开始。</strong></p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="33d6" class="mn jo iq mj b gy mo mp l mq mr">mkdir puppeteer-project<br/>cd puppeteer-project<br/>yarn<br/>yarn add puppeteer</span></pre><p id="0342" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">好了，现在我们都设置和配置好了，让我们从抓取网站截图开始吧！用下面的代码在<code class="fe ms mt mu mj b">puppeteer-project</code>目录中创建一个index.js文件</p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="9da7" class="mn jo iq mj b gy mo mp l mq mr">const puppeteer = require('puppeteer');</span><span id="ec6f" class="mn jo iq mj b gy mv mp l mq mr">(async () =&gt; {<br/>  const browser = await puppeteer.launch();<br/>  const page = await browser.newPage();<br/>  await page.goto('https://facebook.com');<br/>  await page.screenshot({path: 'facebook.png'});<br/>  console.log('Screenshot saved!');</span><span id="2cee" class="mn jo iq mj b gy mv mp l mq mr">await browser.close();<br/>})();</span></pre><p id="9db8" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">然后，我们将使用node运行这个文件，并检查保存截图<code class="fe ms mt mu mj b">facebook.png</code>的文件夹<code class="fe ms mt mu mj b">puppeteer-project</code>。</p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="570d" class="mn jo iq mj b gy mo mp l mq mr">node index.js</span></pre><p id="7ab2" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">太好了！你已经截屏了浏览器窗口，但是你可能认为它被裁剪掉了？我敢打赌你做到了。您可以按如下方式在puppeteer中设置视点:</p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="877f" class="mn jo iq mj b gy mo mp l mq mr">page.setViewport({width: 2000, height: 2000});</span></pre><p id="27ec" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">为同一个页面生成一个pdf怎么样，没什么大不了的。我们将使用浏览器的<code class="fe ms mt mu mj b">pdf</code>方法来执行它。所以，现在在<code class="fe ms mt mu mj b">index.js</code>中，我们将使用<code class="fe ms mt mu mj b">pdf</code>方法代替<code class="fe ms mt mu mj b">screenshot</code>方法，如下所示:</p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="0907" class="mn jo iq mj b gy mo mp l mq mr">const puppeteer = require('puppeteer');</span><span id="017a" class="mn jo iq mj b gy mv mp l mq mr">(async () =&gt; {<br/>  const browser = await puppeteer.launch();<br/>  const page = await browser.newPage();<br/>  await page.goto('https://facebook.com', {waitUntil: 'networkidle2'});<br/>  await page.pdf({path: 'facebook.pdf', format: 'A4'});</span><span id="c070" class="mn jo iq mj b gy mv mp l mq mr">await browser.close();<br/>})();</span></pre><p id="60a3" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">再次运行该文件，以查看我们的文件夹中的facebook.pdf。我在搜索软件包或工具时发现了<code class="fe ms mt mu mj b">puppeteer</code>，以便从网上下载pdf格式的内容，用于我们为黑客马拉松制作的应用程序(<a class="ae lp" href="https://meroresume.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">梅罗简历</a>)。</p><p id="edfe" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">最后，自动化表单提交。因为我们正在与facebook.com合作，让我们尝试无标题登录facebook。</p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="af16" class="mn jo iq mj b gy mo mp l mq mr"><em class="lj">const</em> puppeteer = require('puppeteer');</span><span id="814e" class="mn jo iq mj b gy mv mp l mq mr">(<em class="lj">async</em> () <em class="lj">=&gt;</em> {</span><span id="a470" class="mn jo iq mj b gy mv mp l mq mr">const browser = await puppeteer.launch();<br/><em class="lj">const</em> page = await browser.newPage();<br/><em class="lj">const</em> email = 'youremail@pastehere.com'</span><span id="fd55" class="mn jo iq mj b gy mv mp l mq mr">await page.setViewport({ width: 2000, height: 2000});<br/>await page.goto('https://www.facebook.com', { waitUntil: 'networkidle2' });</span><span id="6f35" class="mn jo iq mj b gy mv mp l mq mr">await page.type('#email', email)<br/>await page.type('#pass', '*********') // enter your password here<br/>await page.click('input[type="submit"]');<br/>await page.waitForNavigation({ waitUntil: 'domcontentloaded' });<br/>page.screenshot({ path: 'loggedIn.png' });</span><span id="5d47" class="mn jo iq mj b gy mv mp l mq mr">})();</span></pre><p id="98d2" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">检查<code class="fe ms mt mu mj b">loggedIn.png</code>以查看您登录的主页。这样，我们可以自动提交任何表单。当我为了测试需要经常注册一个新用户时，我通常会使用这个。你可以用任何其他形式来尝试，如果你想看看幕后发生了什么，你可以在如下的浏览器窗口中启动木偶师:</p><pre class="lr ls lt lu gt mi mj mk ml aw mm bi"><span id="6999" class="mn jo iq mj b gy mo mp l mq mr"><em class="lj">const</em> browser = await puppeteer.launch(({ headless: false }));</span></pre><p id="0eb1" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这些是我们可以用Puppeteer做的一些事情，你可以发现更多很酷的东西，不要忘记还有许多其他工具和框架可以自动化浏览器，如Selenium，它支持Chrome以外的浏览器。如果你还没有尝试过，一定要尝试一下。:)</p></div></div>    
</body>
</html>