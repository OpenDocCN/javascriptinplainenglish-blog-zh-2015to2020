<html>
<head>
<title>Implementing Floating video player (Picture-in-Picture) in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript实现浮动视频播放器(画中画)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/implementing-floating-video-player-picture-in-picture-in-javascript-f4b7c540723b?source=collection_archive---------3-----------------------#2020-04-22">https://javascript.plainenglish.io/implementing-floating-video-player-picture-in-picture-in-javascript-f4b7c540723b?source=collection_archive---------3-----------------------#2020-04-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="83f9" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">了解如何使用画中画视频体验来实现</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/10be886491a931ef2f7c26a016812d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03olAF2oVmcWZ76Dnh2r1Q.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@veeterzy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">veeterzy</a> on <a class="ae ks" href="https://unsplash.com/s/photos/video?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ab4d" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">您将学习的主题</h1><p id="f6e0" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">✅什么是画中画？</p><p id="b764" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">✅检查画中画是否支持？</p><p id="7450" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">✅实现画中画视频体验</p><p id="c657" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">画中画中的✅事件</p><p id="7823" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">✅获取画中画播放器的宽度和高度。</p><p id="4e4f" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">✅迷你项目。</p><h1 id="1984" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">🔷画中画</h1><p id="2df7" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><code class="fe mm mn mo mp b"><strong class="ln io">Picture-in-Picture (PiP)</strong></code>允许用户在浮动窗口(总是在其他窗口之上)观看视频，这样他们就可以在与其他网站或应用程序交互时关注他们正在观看的内容。</p><p id="5f55" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">换句话说，即使我们切换了播放视频的标签，视频元素仍然是可见的。你可以把它拖到屏幕的任何地方。</p><h1 id="67b9" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">🔷检查画中画是否支持？</h1><p id="e2f6" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我们可以使用<code class="fe mm mn mo mp b">document.pictureInPictureEnabled</code>布尔值来确定<code class="fe mm mn mo mp b">PiP</code>是否启用。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="cdb5" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">🔷实现画中画视频体验</h1><p id="3859" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">假设我们有视频元素和一个按钮。当用户点击按钮时，我们需要启用浮动视频。</p><pre class="kd ke kf kg gt ms mp mt mu aw mv bi"><span id="a35c" class="mw ku in mp b gy mx my l mz na"><strong class="mp io">&lt;video id="videoElement" controls="true" src="video_url"&gt; &lt;/video&gt;</strong></span><span id="8671" class="mw ku in mp b gy nb my l mz na"><strong class="mp io">&lt;button id="PiP"&gt; Enable Floating Video &lt;/button&gt;</strong></span></pre><p id="2a51" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">为了启用<code class="fe mm mn mo mp b"><strong class="ln io">PiP</strong></code> <strong class="ln io">，</strong>我们需要在video element上调用<code class="fe mm mn mo mp b">requestPictureInPicture()</code>，它将返回一个<code class="fe mm mn mo mp b">promise</code>。</p><p id="2ca8" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">一旦<code class="fe mm mn mo mp b">promise</code>被解决，那么视频元素就会被尖叫到右角，我们可以把它移动到任何地方。</p><p id="0321" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们可以通过使用<code class="fe mm mn mo mp b">document.pictureInPictureElement</code>来检查是否已经有任何<code class="fe mm mn mo mp b">PiP</code>视频在播放，其中有<code class="fe mm mn mo mp b">video</code>元素在<code class="fe mm mn mo mp b">PiP</code>模式下播放。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="d67d" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">上面的代码将创建一个基本的<code class="fe mm mn mo mp b">PiP</code>视频播放器。</p><h1 id="8006" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">🔷画中画事件</h1><p id="0440" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">关于<code class="fe mm mn mo mp b">PiP</code>视频的状态有两个事件</p><p id="2796" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><code class="fe mm mn mo mp b"><strong class="ln io"><em class="nc">enterpictureinpicture</em></strong></code> →启用<code class="fe mm mn mo mp b">PiP</code>模式后触发。</p><p id="79bd" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><strong class="ln io"><em class="nc">leavepictureinpicture</em>T25】</strong></p><p id="25b9" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">当<code class="fe mm mn mo mp b">PiP</code>模式退出时触发。这可能是由于</p><ul class=""><li id="eff7" class="nd ne in ln b lo mh lr mi lu nf ly ng mc nh mg ni nj nk nl bi translated">视频左画中画。</li><li id="eff8" class="nd ne in ln b lo nm lr nn lu no ly np mc nq mg ni nj nk nl bi translated">用户可能已经从不同页面播放了画中画视频。</li></ul><pre class="kd ke kf kg gt ms mp mt mu aw mv bi"><span id="8076" class="mw ku in mp b gy mx my l mz na">video.addEventListener('<strong class="mp io">enterpictureinpicture</strong>', (event)=&gt; {<br/>    toggleBtn.textContent = "Exit Pip Mode";<br/>});<br/><br/>video.addEventListener('<strong class="mp io">leavepictureinpicture</strong>', (event) =&gt; {<br/>     toggleBtn.textContent = " Enter PiP Mode";<br/>});</span></pre><h1 id="cb5f" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">🔷获取画中画播放器的宽度和高度</h1><p id="876e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">一旦用户进入<code class="fe mm mn mo mp b">PiP</code>模式，我们就可以得到<code class="fe mm mn mo mp b">PiP</code>付款人的宽度和高度。</p><p id="4a8e" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">宽度和高度存储在<code class="fe mm mn mo mp b">enterpictureinpicture</code>事件对象的<code class="fe mm mn mo mp b">pictureInPictureWindow</code>属性中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="8b07" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">🔷迷你项目。</h1><p id="52b3" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">让我们用<code class="fe mm mn mo mp b">PiP</code>实现一些有趣的🧐事物</p><p id="8403" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">1️⃣ <strong class="ln io">在画中画窗口显示用户的网络摄像头</strong></p><p id="39c4" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这里我们将使用<code class="fe mm mn mo mp b">navigator</code>对象的<code class="fe mm mn mo mp b">mediaDevices</code>属性中的<code class="fe mm mn mo mp b">getUserMedia</code>方法访问用户网络摄像头。</p><pre class="kd ke kf kg gt ms mp mt mu aw mv bi"><span id="c0c9" class="mw ku in mp b gy mx my l mz na">const video = document.createElement('video');</span><span id="cb1b" class="mw ku in mp b gy nb my l mz na">video.muted = true;</span><span id="4b56" class="mw ku in mp b gy nb my l mz na"><strong class="mp io">video.srcObject = await navigator.mediaDevices.getUserMedia({ video: true });</strong></span><span id="5821" class="mw ku in mp b gy nb my l mz na">video.play()<br/><br/>video.requestPictureInPicture();</span></pre><p id="f0b5" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><strong class="ln io"> 2️⃣在画中画窗口显示用户显示屏</strong></p><p id="06e4" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">这里我们将使用<code class="fe mm mn mo mp b">navigator</code>对象的<code class="fe mm mn mo mp b">mediaDevices</code>属性中的<code class="fe mm mn mo mp b">getDisplay</code>方法来访问用户显示。</p><pre class="kd ke kf kg gt ms mp mt mu aw mv bi"><span id="5693" class="mw ku in mp b gy mx my l mz na">const video = document.createElement('video');</span><span id="668a" class="mw ku in mp b gy nb my l mz na">video.muted = true;</span><span id="8e62" class="mw ku in mp b gy nb my l mz na"><strong class="mp io">video.srcObject = await navigator.mediaDevices.getDisplayMedia({ video: true });</strong></span><span id="441c" class="mw ku in mp b gy nb my l mz na">video.play();<br/><br/><strong class="mp io">video.requestPictureInPicture();</strong></span></pre><p id="b590" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">请在这里捐款<a class="ae ks" href="https://paypal.me/jagathishSaravanan?locale.x=en_GB" rel="noopener ugc nofollow" target="_blank">。这对我意义重大。</a></p><p id="941f" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">如果您发现任何错误，请在评论中报告。</p><p id="bed0" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">跟随<a class="nr ns ep" href="https://medium.com/u/f9ffc26e7e69?source=post_page-----f4b7c540723b--------------------------------" rel="noopener" target="_blank"> Javascript吉普🚙💨</a>更多有趣的教程</p><p id="ac2f" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><strong class="ln io">用简单英语写的JavaScript笔记</strong></p><p id="78e8" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae ks" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ln io">AI in Plain English</strong></a>，<a class="ae ks" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ln io">UX in Plain English</strong></a>，<a class="ae ks" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ln io">Python in Plain English</strong></a><strong class="ln io"/>—谢谢，继续学习！</p><p id="dadd" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae ks" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ln io">submissions @ plain English . io</strong></a><strong class="ln io"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p><p id="22f6" class="pw-post-body-paragraph ll lm in ln b lo mh jo lq lr mi jr lt lu mj lw lx ly mk ma mb mc ml me mf mg ig bi translated"><strong class="ln io">参考:</strong></p><div class="nt nu gp gr nv nw"><a href="https://googlechrome.github.io/samples/picture-in-picture/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">画中画样本</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">说明画中画使用的示例。</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">谷歌浏览器. github.io</p></div></div></div></a></div></div><div class="ab cl of og hr oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ig ih ii ij ik"><div class="kd ke kf kg gt nw"><a href="https://www.buymeacoffee.com/Jagathish" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">Jagathish Saravanan</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">你好👋。我是Jagathish。爱写关于JavaScript的文章。你的支持就像夏天吃冰淇淋一样。我…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="om l"><div class="on l oo op oq om or km nw"/></div></div></a></div><blockquote class="os"><p id="34d0" class="ot ou in bd ov ow ox oy oz pa pb mg dk translated"><a class="ae ks" href="http://javascriptjeep.com" rel="noopener ugc nofollow" target="_blank">参观JavascriptJeep.com</a></p></blockquote></div></div>    
</body>
</html>