<html>
<head>
<title>How To Upload Files With Angular and PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Angular和PHP上传文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/upload-file-using-angular-and-php-7ee12c67a28b?source=collection_archive---------2-----------------------#2020-11-01">https://javascript.plainenglish.io/upload-file-using-angular-and-php-7ee12c67a28b?source=collection_archive---------2-----------------------#2020-11-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b4f898c89d9eb807d369404fc68b939d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t52cZZydDhU9ASRDf23SNg.png"/></div></div></figure><p id="8d07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如何上传文件？。任何编程开发人员的初学者都会想到这个问题。为什么？因为向服务器发送数据(意味着键值对或表单数据)不同于发送blob(图像、文件)对象。</p><p id="5c64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看看<strong class="ka ir">如何简单的用<strong class="ka ir"> PHP </strong>用<strong class="ka ir"> Angular </strong>上传</strong>一个<strong class="ka ir">文件</strong>。这没有你想象的那么难。但是当我是初学者时，我觉得上传文件太难了。每当我得到一个文件上传任务，我觉得为什么它不适合我。我有时会感到沮丧。但是现在我能够轻松地完成文件上传任务。</p><p id="6d87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你从上面看，文件上传过程有三个阶段<strong class="ka ir"/>。它们是非常容易的阶段。</p><ol class=""><li id="6088" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">创建一个文件类型为普通HTML的<strong class="ka ir">输入字段</strong>。</li><li id="5378" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">用JavaScript创建一个<strong class="ka ir"> FormData </strong>对象并附加所选文件。然后使用<strong class="ka ir"> HTTP </strong>客户端传递表单数据。</li><li id="810c" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用<strong class="ka ir"> PHP </strong>代码捕获文件(通常的PHP文件捕获代码)。</li></ol><p id="10ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们在一个循序渐进的例子中看看如何使用Angular和PHP上传文件。</p><h1 id="f776" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak"> 1。创建角度项目</strong></h1><p id="7d64" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">使用下面的命令创建一个角度项目。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="85d0" class="mw ll iq ms b gy mx my l mz na">ng new erp</span></pre><p id="2ac0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将需要的模块添加到<strong class="ka ir"> app.module.ts </strong>文件中。</p><p id="839d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于文件输入类型，我们需要以下模块。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="be84" class="mw ll iq ms b gy mx my l mz na">FormsModule<br/>ReactiveFormsModule</span></pre><p id="f26f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了向服务器发送数据，我们需要下面的模块。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="a04e" class="mw ll iq ms b gy mx my l mz na">HttpClientModule</span></pre><p id="4b06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在您的<strong class="ka ir"> app.module.ts </strong>文件中添加以下代码。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="3d05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我用的是Angular Material UI框架。这是一个可选步骤。</strong></p><p id="cb28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在终端/命令提示符下使用下面的命令添加角度材质。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="e0fd" class="mw ll iq ms b gy mx my l mz na">ng add <a class="ae nd" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a></span></pre><p id="1efe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在您的<strong class="ka ir"> app.module.ts </strong>文件中添加以下代码。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h1 id="7679" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak"> 2。创建文件输入</strong></h1><p id="ee36" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">打开<strong class="ka ir">app.component.html</strong>文件，创建如下所示的文件输入类型。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="11d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我创建了一个<strong class="ka ir"> formControl </strong>元素来引用文件输入。</p><p id="ae99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> fileChange() </strong>函数用于检测文件大小和扩展名。如果需要，您可以在选择文件时添加限制。</p><p id="307e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个按钮来上传选定的文件。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f49f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> uploadFile() </strong>函数用于将文件附加到formData对象，并使用HTTP请求发送。</p><h1 id="da1c" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak"> 3。在类型脚本中创建表单数据</strong></h1><p id="785e" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">首先，在<strong class="ka ir"> app.component.ts </strong>文件中为输入字段创建一个formControl元素。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="cecc" class="mw ll iq ms b gy mx my l mz na">file=new FormControl('')</span></pre><p id="a32e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后创建一个变量来保存选定的文件信息。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="f28f" class="mw ll iq ms b gy mx my l mz na">file_data:any=''</span></pre><p id="5377" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在创建一个fileChange()函数，如下所示。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="cdea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中</p><ol class=""><li id="03b7" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">使用<strong class="ka ir"> fileList.length </strong>检查文件是否被选中</li><li id="7311" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">然后我们可以使用<strong class="ka ir">文件名、文件大小、文件类型</strong>来获取文件信息</li><li id="d78f" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">我们可以检查文件大小。这里我使用这段代码将文件大小限制为4 MB。【file.size/1048576】<strong class="ka ir">&lt;= 4</strong>。您可以根据需要对此进行修改。</li><li id="8d24" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">然后创建一个formData对象，并使用<strong class="ka ir"> append() </strong>函数进行附加。</li><li id="540c" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">还可以使用append()函数以键-值对格式传递附加信息。</li></ol><h1 id="7c57" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak"> 4。使用HTTP </strong>发送文件</h1><p id="93e6" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">要将文件发送到服务器，首先，我们需要在<strong class="ka ir"> app.component.ts </strong>文件中使用构造函数创建一个HTTP的引用。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0c19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后用服务器的IP地址<strong class="ka ir">创建一个变量。</strong></p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ef7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在调用HTTP请求的<strong class="ka ir"> post() </strong>方法，并像下面这样传递formData对象。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h1 id="2e64" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak"> 5。使用PHP </strong>捕捉文件</h1><p id="d093" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">客户端代码结束了。现在我们需要使用PHP服务器捕捉上传的文件。为此，您需要在您的机器或云服务器上安装PHP。</p><p id="1b90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在服务器上创建一个文件夹来保存上传的文件。在这里，我创建了<strong class="ka ir"> docs </strong>文件夹来存储文件。</p><p id="162f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我有一个冗长的代码捕捉和存储文件。我用结构来避免许多问题。你可以在代码中找到解释。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="979b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你喜欢这个教程。</p><p id="7484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使复制粘贴以上所有代码，也能正常工作。</p><p id="f88e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">样本输出:</strong></p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/87442779a3b354cbccc09760f4cbac74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rgPuNepVWdBkYJmHJ2Ccgg.png"/></div></div></figure><p id="c24b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">完整源代码链接:</strong><a class="ae nd" href="https://github.com/bharathirajatut/angular-examples/tree/master/file-upload-example" rel="noopener ugc nofollow" target="_blank">https://github . com/bharathirajatut/angular-examples/tree/master/file-upload-example</a></p><h2 id="2db6" class="mw ll iq bd lm nf ng dn lq nh ni dp lu kj nj nk ly kn nl nm mc kr nn no mg np bi translated"><strong class="ak">常见错误</strong></h2><p id="12a1" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">在上传一个文件时，你将会面临下面的错误<strong class="ka ir">，即使你的代码中没有错误。</strong></p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="722a" class="mw ll iq ms b gy mx my l mz na"><strong class="ms ir">Warning</strong>: move_uploaded_file(docs/245f99482bb6035-377112-avpng.png): failed to open stream: Permission denied in</span></pre><p id="e0a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为什么因为它与文件夹<strong class="ka ir">权限</strong>和<strong class="ka ir"> OS </strong>有关。通常这个错误只会在Mac和Linux上出现<strong class="ka ir">。不在windows中。</strong></p><h2 id="fd0e" class="mw ll iq bd lm nf ng dn lq nh ni dp lu kj nj nk ly kn nl nm mc kr nn no mg np bi translated"><strong class="ak">解决方案</strong></h2><p id="61be" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">在<strong class="ka ir"> Ubuntu Linux </strong>上，使用以下命令允许文件上传。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="ba7d" class="mw ll iq ms b gy mx my l mz na">sudo chown www-data folder_name<br/>sudo chmod 0755 -R folder_name</span></pre><p id="8f6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在Mac上</strong>，右击文件夹- &gt;获取信息- &gt;选择阅读&amp;写给所有人。</p></div></div>    
</body>
</html>