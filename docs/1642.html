<html>
<head>
<title>How to create a custom Slack command using Google Cloud Functions and NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Google Cloud函数和NodeJS创建自定义Slack命令</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-custom-slack-command-using-google-cloud-functions-and-nodejs-72a2f653d4e6?source=collection_archive---------9-----------------------#2020-04-09">https://javascript.plainenglish.io/how-to-create-a-custom-slack-command-using-google-cloud-functions-and-nodejs-72a2f653d4e6?source=collection_archive---------9-----------------------#2020-04-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9cd61e8a6bb5df00b9e8fab70c9df5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GbjaaUhPWUtnHSuK273O2Q.jpeg"/></div></div></figure><p id="d867" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们都已经习惯了远程工作，使用聊天、视频会议和屏幕共享，我们被鼓励分享想法，因此需要创建自定义工作流。</p><p id="3cad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将探讨三种流行的技术，Slack、Google Cloud Functions和NodeJS。结合这些技术将改善我们在Slack中的工作流程。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="e53d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们将讨论如何创建谷歌云功能。如果你不熟悉谷歌云，我建议你免费试用一下。</p><div class="la lb gp gr lc ld"><a href="https://cloud.google.com/free" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd io gy z fp li fr fs lj fu fw im bi translated">GCP免费等级免费扩展试用和永远免费|谷歌云</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">GCP自由层以两种方式扩展我们的免费计划。12个月免费试用300美元，永远免费。了解更多。</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">cloud.google.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr jt ld"/></div></div></a></div><p id="7be0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要创建Google Cloud功能，请转到功能页面:</p><div class="la lb gp gr lc ld"><a href="https://console.cloud.google.com/functions" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd io gy z fp li fr fs lj fu fw im bi translated">谷歌云平台</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">Google云平台让您可以在同一基础设施上构建、部署和扩展应用程序、网站和服务…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">console.cloud.google.com</p></div></div><div class="lm l"><div class="ls l lo lp lq lm lr jt ld"/></div></div></a></div><ul class=""><li id="0c7e" class="lt lu in jx b jy jz kc kd kg lv kk lw ko lx ks ly lz ma mb bi translated">单击创建函数。</li><li id="2044" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">给它起个名字，比如<code class="fe mh mi mj mk b">alert-cpu</code>。</li><li id="53c5" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">如果你想让任何人运行这个函数，正如我们想让Slack调用这个函数，那么点击复选标记“允许未认证调用”。</li><li id="fa76" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">这将使任何人都可以调用这个函数，但是我们只允许Slack调用。因此，我们将要求它在查询字符串中检查一个令牌。</li><li id="36e4" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">检查触发器是否为HTTP。</li><li id="5bc2" class="lt lu in jx b jy mc kc md kg me kk mf ko mg ks ly lz ma mb bi translated">您可以选择运行时为节点8，也可以选择不同的节点版本。</li></ul><p id="76a4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">云函数源代码:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5411" class="mt mu in mk b gy mv mw l mx my">/**<br/> * Responds to any HTTP request.<br/> *<br/> * @param {!express:Request} req HTTP request context.<br/> * @param {!express:Response} res HTTP response context.<br/> */<br/>exports.alertCpu = (req, res) =&gt; {<br/>  // Check if it is a valid Slack request<br/>  if (req.query.token !== process.env.SLACK_TOKEN) {<br/>    return res.status(403).send('No Access');<br/>  }<br/>  <br/>  // This is just for an example<br/>  const stats = await stats.check('CPU');<br/>  <br/>  res.status(200).json({<br/>    response_type: 'in_channel',<br/>    attachments: [<br/>      {<br/>        fallback: `CPU Stats`,<br/>        color: '#2eb886',<br/>        pretext: `This is checking the CPU of our servers`,<br/>        author_name: req.query.user_name,<br/>        title: 'Company Name App - CPU Check',<br/>        title_link: 'https://your.company.com/status',<br/>        text: `The CPU is at ${stats.CPU}%`,<br/>        fields: [<br/>          {<br/>            title: 'Priority',<br/>            value: 'High',<br/>            short: false,<br/>          },<br/>        ],<br/>        footer: 'Company Name',<br/>        footer_icon: 'https://your.company.com/logo.png',<br/>      },<br/>    ],<br/>  });<br/>};</span></pre><p id="da64" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要完成这个函数的创建，请确保编辑名为“Function to Execute”的字段，并将其命名为您要导出的函数。在我们的代码中，我们使用如下名称导出函数:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8c08" class="mt mu in mk b gy mv mw l mx my">exports.alertCpu</span></pre><p id="5fe1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我们要执行的函数是<code class="fe mh mi mj mk b">alertCpu</code></p><p id="18d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Google Cloud的底层架构中，Functions for Node只是一个简单的<code class="fe mh mi mj mk b">Express</code>服务器。</p><blockquote class="mz na nb"><p id="fa60" class="jv jw nc jx b jy jz ka kb kc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ks ig bi translated">注意:您可以像在任何<code class="fe mh mi mj mk b">Express</code>服务器中一样使用相同的<code class="fe mh mi mj mk b">req</code>和<code class="fe mh mi mj mk b">res</code>变量。</p></blockquote><p id="4198" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您对<code class="fe mh mi mj mk b">Express</code>不熟悉，可以到这里阅读文档:</p><div class="la lb gp gr lc ld"><a href="https://expressjs.com/" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd io gy z fp li fr fs lj fu fw im bi translated">Express - Node.js web应用程序框架</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">Express是一个最小且灵活的Node.js web应用程序框架，它为web和…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">expressjs.com</p></div></div><div class="lm l"><div class="ng l lo lp lq lm lr jt ld"/></div></div></a></div></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="f74f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以现在让我们讨论一下我们可以发送回slack的响应。</p><p id="1980" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们需要发回一个JSON有效载荷。在这个有效载荷中，我们可以配置很多东西，但是在这篇文章中，我们将讨论几个。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5f6c" class="mt mu in mk b gy mv mw l mx my">response_type: 'in_channel'</span></pre><p id="df3e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这意味着当您键入Slack命令时，它将响应该频道中的每个人，而不仅仅是您自己。如果你只是想让你的用户看到，那就不要写了。</p><p id="6da5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还可以将附件作为我们响应的一部分发送，当Slack在通道中显示消息时，它会为我们格式化这些附件。</p><p id="51e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过设置<code class="fe mh mi mj mk b">author_name</code>,我们可以显示谁发送了命令。</p><p id="9860" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以发送图像、链接和文本。这个回答最重要的部分是这样的:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0748" class="mt mu in mk b gy mv mw l mx my">text: `The CPU is at ${stats.CPU}%`</span></pre><p id="b5fd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们想提醒我们的服务器的CPU %的渠道。您可以使用任何想要的指标或统计数据来完成这项工作。系统上有多少用户。当服务器超过一定的CPU百分比时，向开发团队发送一封电子邮件。当然，你可能想在Google Cloud中设置某种监控系统来处理这个问题，但是这只是一个例子，你可以在Slack中发送消息，让你的团队与你的系统保持同步。</p><p id="1633" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以在这里阅读JSON有效负载中可以返回的所有响应字段的文档:</p><div class="la lb gp gr lc ld"><a href="https://api.slack.com/messaging/composing/layouts" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd io gy z fp li fr fs lj fu fw im bi translated">创建丰富的邮件布局</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">在消息中以易于阅读和理解的方式组织复杂的数据。我们已经向您介绍了…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">api.slack.com</p></div></div><div class="lm l"><div class="nh l lo lp lq lm lr jt ld"/></div></div></a></div><div class="la lb gp gr lc ld"><a href="https://api.slack.com/interactivity/slash-commands" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd io gy z fp li fr fs lj fu fw im bi translated">启用斜线命令的交互性</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">斜线命令允许用户通过在消息编辑器框中键入字符串来调用您的应用程序。提交的斜线…</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">api.slack.com</p></div></div><div class="lm l"><div class="ni l lo lp lq lm lr jt ld"/></div></div></a></div><p id="ef85" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在完成之前，记得将Slack令牌添加到环境变量列表中。创建完函数后，它会显示一个URL，您必须调用这个URL才能让Slack命令工作。</p><p id="9426" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要获得Slack令牌，我们必须首先创建一个Slack命令。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="45ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们转到“松弛时间组自定义集成”页面，这样您就可以开始创建自己的松弛时间命令了:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2eeb" class="mt mu in mk b gy mv mw l mx my"><a class="ae nj" href="https://solodev-group.slack.com/apps/manage/custom-integrations" rel="noopener ugc nofollow" target="_blank">https://[YOUR-GROUP-NAME].slack.com/apps/manage/custom-integrations</a></span></pre><p id="c10c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击斜线命令。</p><p id="226c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单击添加到时差。</p><p id="d3e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下一页，它将显示一个屏幕，让您输入您希望Slack命令调用的内容。</p><figure class="ml mm mn mo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/997c39891515a80808bc4fafed62abef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ec-4xMj9QvuhC3rP8ko_pw.png"/></div></div></figure><p id="e704" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单击添加斜杠命令集成。</p><p id="d444" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下一页上，您可以配置希望调用该命令的URL。在我们的例子中，我们将输入从Google Cloud函数接收到的URL。</p><p id="24de" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将把方法从POST改为GET。</p><p id="7669" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还可以看到我们需要添加到云函数中的环境变量中的Slack令牌。这将使得有可能知道呼叫来自Slack。</p><p id="cb81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您还可以通过给命令添加描述、徽标等等来自定义该命令。</p><p id="3498" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，从这篇文章和其他文档中，您可以看到很容易设置一个Slack命令，让它为您收集信息，然后提醒团队、渠道或业务，而不会留下Slack。您可以保持联系并自定义您的工作流程。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="5e2c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们可以输入Slack命令来测试:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4718" class="mt mu in mk b gy mv mw l mx my">/alert-cpu</span></pre><p id="1a94" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当然这只是一个例子，但是你可以看到保持工作流松弛的好处。</p><h2 id="c7cf" class="mt mu in bd nl nm nn dn no np nq dp nr kg ns nt nu kk nv nw nx ko ny nz oa ob bi translated">JavaScript用简单的英语写的一个注释:</h2><p id="11cf" class="pw-post-body-paragraph jv jw in jx b jy oc ka kb kc od ke kf kg oe ki kj kk of km kn ko og kq kr ks ig bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae nj" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jx io">AI in Plain English</strong></a><a class="ae nj" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jx io">UX in Plain English</strong></a><a class="ae nj" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jx io">Python in Plain English</strong></a><strong class="jx io"/>——谢谢，继续学习！</p></div></div>    
</body>
</html>