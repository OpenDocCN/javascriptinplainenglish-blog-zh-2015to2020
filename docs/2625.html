<html>
<head>
<title>How to Test a Non-Export Function in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中测试非导出函数</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-test-a-non-export-function-in-javascript-a1d0bc339ac?source=collection_archive---------4-----------------------#2020-07-10">https://javascript.plainenglish.io/how-to-test-a-non-export-function-in-javascript-a1d0bc339ac?source=collection_archive---------4-----------------------#2020-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5bea81626738baf3c130b6727cb6bbf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6YWmMdv6JN9-JFwc"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lazycreekimages?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Michael Dziedzic</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9563" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章解释了如何用<a class="ae kc" href="https://github.com/jhnns/rewire" rel="noopener ugc nofollow" target="_blank"> Rewire </a>测试JavaScript中的非导出函数，以及为什么不应该使用House隐喻导出每个函数。</p><h1 id="8796" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">问题背景</h1><p id="b6e8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在讨论我遇到的问题之前，什么是非导出函数？</p><p id="9b2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非导出函数是只能在该<code class="fe me mf mg mh b">.js</code>文件/模块中访问的内部函数。请参考下面的代码示例。</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="38c1" class="mq lc iq mh b gy mr ms l mt mu">// payment.js<br/>const calculateConversionRate = (amount, rate) =&gt; {<br/>    return amount * rate;<br/>};</span><span id="d79f" class="mq lc iq mh b gy mv ms l mt mu">​const makePayment = () =&gt; {<br/>    // Business logic ......<br/>    const amountToPaid = calculateConversionRate(amount, rate);<br/>    // Continue business logic .....<br/>};</span><span id="cd91" class="mq lc iq mh b gy mv ms l mt mu">​module.exports = {<br/>    makePayment,<br/>}</span></pre><p id="68bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能熟悉这样的代码。<code class="fe me mf mg mh b">calculateConversionRate</code>是我们只在内部使用的函数。因此，为<code class="fe me mf mg mh b">calculateConversionRate()</code>编写单元测试很困难，因为我们无法访问它。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="d4ad" class="lb lc iq bd ld le nd lg lh li ne lk ll lm nf lo lp lq ng ls lt lu nh lw lx ly bi translated">房子的比喻</h1><p id="c780" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">然而，也有一个快速的方法来解决这个问题，我们可以导出<code class="fe me mf mg mh b">calculateConversionRate</code>，现在我们可以访问这个函数并为它编写单元测试。</p><p id="e77b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我过去也采用这种方法。虽然这是一个快捷的方式，但它是一个欠考虑的行为。在<code class="fe me mf mg mh b">payment.js</code>中，我们希望揭露的是<code class="fe me mf mg mh b">makePayment</code>功能。相反，出于单元测试的目的，我们选择公开所有功能。</p><p id="ee4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们用房子的比喻来解释这一点。如果你有一所房子，你建造了大门/入口，这就是你希望人们选择进入你的房子。你希望人们通过屋顶、窗户、后院等进入你的房子吗？</p><blockquote class="ni"><p id="9576" class="nj nk iq bd nl nm nn no np nq nr la dk translated"><em class="ns">导出不打算对外使用的功能就像在窗户和屋顶上贴“欢迎”标签一样。</em></p></blockquote><p id="cc10" class="pw-post-body-paragraph kd ke iq kf b kg nt ki kj kk nu km kn ko nv kq kr ks nw ku kv kw nx ky kz la ij bi translated">这在计算机科学中也被称为封装。您正在包装内部函数，并防止它被任何其他模块访问。</p><p id="af1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您大概了解了为什么不推荐这样做，让我们探索其他的可能性。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="2ebc" class="lb lc iq bd ld le nd lg lh li ne lk ll lm nf lo lp lq ng ls lt lu nh lw lx ly bi translated">推荐的解决方案</h1><p id="5cfd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">虽然Rewire是作为单元测试库的简单猴子补丁引入的。然而，这个库也很适合用来测试非导出函数。</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ad7b" class="mq lc iq mh b gy mr ms l mt mu">// payment.test.js<br/>const rewire = require('rewire');</span><span id="12e3" class="mq lc iq mh b gy mv ms l mt mu">const payment = rewire('../src/payment.js');<br/>const calculateConversionRate = payment.__get__('calculateConversionRate');</span><span id="3448" class="mq lc iq mh b gy mv ms l mt mu">test('Calculate Conversion Rate return correct rate', () =&gt; {<br/>  const amount = 100;<br/>  const rate = 4.1;<br/>  const expectedResult = amount * rate;<br/>  expect(calculateConversionRate(amount, rate)).toBe(expectedResult);<br/>});</span></pre><p id="a273" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用rewire库，我们可以为我们的非导出函数编写单元测试，而不会违反计算机科学中的封装模式。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="517b" class="lb lc iq bd ld le nd lg lh li ne lk ll lm nf lo lp lq ng ls lt lu nh lw lx ly bi translated">结论</h1><p id="d83e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">以下是这篇文章的要点。</p><ul class=""><li id="f426" class="ny nz iq kf b kg kh kk kl ko oa ks ob kw oc la od oe of og bi translated">导出所有函数不是一个好主意。这就像你在你的屋顶、窗户、后院等地方贴欢迎标签。</li><li id="5878" class="ny nz iq kf b kg oh kk oi ko oj ks ok kw ol la od oe of og bi translated">讨论了如何利用Rewire库轻松测试非导出函数。</li></ul><p id="8383" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读。下一篇文章再见。</p><p id="3141" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章最初发表在我的博客上。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="a154" class="lb lc iq bd ld le nd lg lh li ne lk ll lm nf lo lp lq ng ls lt lu nh lw lx ly bi translated">参考</h1><ul class=""><li id="8484" class="ny nz iq kf b kg lz kk ma ko om ks on kw oo la od oe of og bi translated"><a class="ae kc" href="https://stackoverflow.com/questions/14874208/how-to-access-and-test-an-internal-non-exports-function-in-a-node-js-module" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a></li></ul></div></div>    
</body>
</html>