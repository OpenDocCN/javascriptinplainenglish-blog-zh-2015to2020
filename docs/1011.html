<html>
<head>
<title>The Digital Harmonograph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数字谐波记录仪</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-digital-harmonograph-b932fd3e6c2e?source=collection_archive---------2-----------------------#2020-01-14">https://javascript.plainenglish.io/the-digital-harmonograph-b932fd3e6c2e?source=collection_archive---------2-----------------------#2020-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8a58" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个有趣的JavaScript动画，灵感来自维多利亚时代的精巧装置</h2></div><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="kk kl l"/></div></figure><p id="0cec" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">最近，我了解了一种叫做<a class="ae li" href="https://en.wikipedia.org/wiki/Harmonograph" rel="noopener ugc nofollow" target="_blank">和声图</a>的装置，这是一种19世纪的装置，它利用一个钟摆系统在纸上画出复杂的图案。这是一个优雅的想法，有很多种。一种常见的谐波计包括三个钟摆:一个在椭圆中移动一张纸，另外两个在纸上移动一支笔。这里有一个卡尔·西姆斯的例子，他是一位数字媒体艺术家，为建造它提供了<a class="ae li" href="https://makezine.com/projects/build-swinging-art-table-uniquely-hypnotic-drawings/" rel="noopener ugc nofollow" target="_blank">精彩的指导</a>:</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/4cba3b53a186662e0ee32d540dffc9e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbqmMmuFE2nXCWxYjxsDCQ.jpeg"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk"><a class="ae li" href="https://makezine.com/projects/build-swinging-art-table-uniquely-hypnotic-drawings/" rel="noopener ugc nofollow" target="_blank">Three-pendulum rotary harmonograph by Karl Sims</a> (used with permission).</figcaption></figure><p id="9fc4" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我觉得用电脑模拟这种和声会很有趣。在这里，我展示了在web浏览器中运行的JavaScript代码，它根据三个相互作用的钟摆的行为来绘制图像。除了数学和物理，我们还将介绍一些关于浏览器环境中动画的有用技巧。</p><h2 id="7cb0" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">单摆的行为</h2><p id="52ce" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">在讨论多个摆的相互作用之前，理解单摆的行为是很重要的。这里介绍的算法使用简单的公式模拟单摆。这个模型很好地模拟了真实钟摆的行为。该模型有两个基本思想:</p><ul class=""><li id="7add" class="ms mt iq ko b kp kq ks kt kv mu kz mv ld mw lh mx my mz na bi translated">如果没有摩擦力，钟摆沿着重复的椭圆轨迹运动。</li><li id="504e" class="ms mt iq ko b kp nb ks nc kv nd kz ne ld nf lh mx my mz na bi translated">当有摩擦时，路径的半径<em class="ng">随时间衰减</em>(变小)。经过足够长的时间后，钟摆的运动变得微不足道。</li></ul><h2 id="3f26" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">无摩擦的钟摆</h2><p id="0f7b" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">下图显示了我们如何对第一个想法建模，即点<strong class="ko ir"> P </strong>沿完美椭圆移动:</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nh"><img src="../Images/5fd21bccb4ba388dcc9070204feb4a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j32HTnMRk1pJF4NXiunPHw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">A frictionless pendulum moves along an elliptical path.</figcaption></figure><p id="9403" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">位置向量<strong class="ko ir"> P </strong>代表摆锤在给定时刻的位置。在这个无摩擦模型中，<strong class="ko ir"> P </strong>无限期地绕着同一个椭圆路径运行。椭圆的形状由常数<em class="ng"> a </em>(半长轴)和<em class="ng"> b </em>(半短轴)定义。在时间<em class="ng"> t </em>时，<strong class="ko ir"> P </strong>的位置由以下一对坐标表示:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="ni kl l"/></div></figure><p id="17c3" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这里，<em class="ng"> F </em>是以弧度/秒为单位的旋转频率，<em class="ng"> K </em>是以弧度为单位的起始角度(或<em class="ng">相位</em>)。要明确的是，这些角度是概念性的。它们不能在所描绘的平面上进行测量，因为一般的椭圆不是正圆。重要的想法是，每次值(<em class="ng"> Ft </em> + <em class="ng"> K </em>)增加2π，点<strong class="ko ir"> P </strong>绕椭圆又转了一周。</p><h2 id="d9e2" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">给模型增加摩擦力</h2><p id="d8f1" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">我们在公式中做了一个小小的改变，来模拟摩擦力是如何逐渐减慢钟摆的速度，并使其停止的。我们乘以一个指数衰减因子，以随时间逐渐降低<em class="ng"> x </em>和<em class="ng"> y </em>的幅度:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="ni kl l"/></div></figure><p id="de78" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这里，<em class="ng"> R </em>是一个非负实数，称为<em class="ng">衰减常数</em>。如果<em class="ng"> R </em> =0，就没有摩擦力，因为<em class="ng"> e </em> ⁰=1.如果<em class="ng">R</em>T62】0，那么随着时间<em class="ng"> t </em>的增加，指数因子渐近地减小到零。小正值的<em class="ng"> R </em>模拟少量摩擦，导致曲线缓慢螺旋上升。<em class="ng"> R </em>的值越大，摩擦越大，因此向内螺旋发生得越快。</p><p id="5ff1" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">现在我们有了单摆的数学模型。我们有五个可调参数，<em class="ng"> a </em>，<em class="ng"> b </em>，<em class="ng"> F </em>，<em class="ng"> K </em>和<em class="ng"> R </em>，可以做出各种螺旋形状。</p><h2 id="f4bc" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">组合多个摆锤</h2><p id="7129" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">我们已经讨论过单摆的模型。但是谐波模拟包括三个钟摆。我们如何修改公式来处理三个相互作用的摆的行为？我采用的方法相当简单。每个摆都有自己的一套五个参数<em class="ng"> a </em>、<em class="ng"> b </em>、<em class="ng"> F </em>、<em class="ng"> K </em>、<em class="ng"> R </em>。这五个参数对于三个摆锤中的每一个都是独立的，总共有15个可调参数。</p><p id="926a" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">为了描绘谐波图的形状，我们计算三个摆的三个(<em class="ng"> x </em>、<em class="ng"> y </em>)向量，然后将它们加在一起。也就是说，将三个摆锤的三个<em class="ng"> x </em>坐标相加产生一个净<em class="ng"> x </em>坐标，对三个摆锤各自的<em class="ng"> y </em>坐标做同样的事情。由此产生的(<em class="ng"> x </em>，<em class="ng"> y </em>)对表示在<em class="ng"> t </em>时假想笔在假想纸上的位置。</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nj"><img src="../Images/b8a22ec80ac00d5b0633f6296ad496a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auB2A3r-t8ZSQtk-6Kz6ZA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">A sample frame from the harmonograph animation.</figcaption></figure><h2 id="babf" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">动画算法</h2><p id="2eb7" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">我想要一些有趣的东西来观看和互动，所以单一的静态和声图形是不够好的。正如你所看到的，上面的演示随着时间的推移而变化，并且有一些滑块可以让你交互式地调整最终的模式。(我将在下面解释滑块。)</p><p id="5138" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">对于每个动画帧，我按照上面概述的方法迭代一系列时间值<em class="ng"> t </em>。因此，在动画的每一帧中，代码都绘制了一个完整的和声涂鸦，从<em class="ng"> t </em> =0开始，将<em class="ng"> t </em>增加一个小的量，并将连续的点与HTML画布上的线段连接起来。当指数衰减使得图形螺旋小于任意阈值时，绘图停止。</p><p id="a66f" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在随后的每个动画帧中，我以不同的线性速率改变三个相位角(常数<em class="ng"> K </em>),这样三个钟摆以不同的相互相位开始。这导致谐波图形状随着时间逐渐变形。参见下面代码清单中的函数<code class="fe nk nl nm nn b">MakeHarmonograph</code>。</p><p id="40a4" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">动画下方的滑块允许您调整钟摆的三个频率(<em class="ng"> F </em>常量)。您会注意到，当频率比接近整数时，形状看起来更“平滑”，当频率比偏离整数时，形状看起来更“疯狂”。</p><p id="6c5b" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">真实的物理谐波图也有这种整数比趋势。它们的摆频是通过在吊杆上上下移动重物来调整的，它们需要调整才能做出令人愉悦的图案。</p><h2 id="8756" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">模拟器代码摘要</h2><p id="11f5" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">该代码不需要外部JavaScript包或框架，并且可以在任何相当现代的浏览器中运行。我在Chrome、Safari和Edge上进行了测试。</p><p id="5f1f" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">动画通过使用<a class="ae li" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank"> requestAnimationFrame </a>函数在每次浏览器准备渲染另一帧动画时重复调度回调来进行。我的回调是函数<code class="fe nk nl nm nn b">timerTick</code>，通过函数<code class="fe nk nl nm nn b">Render</code>绘制一帧，然后调度自己在下一个动画帧再次被调用。</p><p id="c433" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在每个动画帧中，代码创建一个<code class="fe nk nl nm nn b">Harmonograph</code>对象，其构造函数接受一个任意的<code class="fe nk nl nm nn b">Pendulum</code>对象列表。代码是灵活的。你可以改变它来使用任意数量的摆，而不仅仅是三个。它继续为<em class="ng"> t </em>的增量值计算一系列笔位置，直到摩擦力使笔减速到某个小半径。</p><p id="b6bb" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">为了让颜色更有趣，我使用从红色逐渐过渡到蓝色的<a class="ae li" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/createRadialGradient" rel="noopener ugc nofollow" target="_blank">径向渐变</a>渲染螺旋形状。我试着用它自己计算的颜色画每一条线段，但是这极大地损害了性能。渐变要快得多，因为它们允许我只需调用一次<code class="fe nk nl nm nn b">context.stroke()</code>就能画出整个形状。</p><h2 id="4c6d" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">代码列表</h2><p id="960a" class="pw-post-body-paragraph km kn iq ko b kp mn jr kr ks mo ju ku kv mp kx ky kz mq lb lc ld mr lf lg lh ij bi translated">代码的HTML部分非常简单。它由一个画布和三个滑块组成:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="no kl l"/></div></figure><p id="513f" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">样式表对于使画布适合浏览器的客户区很重要。它还可以防止用户在触摸屏设备上点击画布时令人讨厌的闪烁。这是:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="no kl l"/></div></figure><p id="9d8d" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">大多数有趣的东西都在JavaScript文件<code class="fe nk nl nm nn b">harmonograph.js</code>中:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="no kl l"/></div></figure><p id="5dac" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这就是了。我希望你喜欢玩harmonograph模拟器，同时，我希望你能从自己有趣的项目中学习并改编代码。大家可以随意提问，我会尽力回答。</p><h2 id="3597" class="lu lv iq bd lw lx ly dn lz ma mb dp mc kv md me mf kz mg mh mi ld mj mk ml mm bi translated">参考</h2><ul class=""><li id="a22d" class="ms mt iq ko b kp mn ks mo kv np kz nq ld nr lh mx my mz na bi translated">GitHub 上模拟完成的<a class="ae li" href="https://github.com/cosinekitty/harmonograph" rel="noopener ugc nofollow" target="_blank">源代码。</a></li><li id="6de5" class="ms mt iq ko b kp nb ks nc kv nd kz ne ld nf lh mx my mz na bi translated">在自己的网页上运行的<a class="ae li" href="https://doncross.net/harmonograph/" rel="noopener ugc nofollow" target="_blank">谐波模拟</a>。</li><li id="06b4" class="ms mt iq ko b kp nb ks nc kv nd kz ne ld nf lh mx my mz na bi translated">卡尔·西姆斯关于如何<a class="ae li" href="http://www.karlsims.com/harmonograph/" rel="noopener ugc nofollow" target="_blank">打造自己的物理和谐图</a>的指导。</li></ul></div></div>    
</body>
</html>