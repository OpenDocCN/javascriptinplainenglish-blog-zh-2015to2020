<html>
<head>
<title>Best of Modern JavaScript — Promise API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代JavaScript的精华— Promise API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/best-of-modern-javascript-promise-api-d4d4a925f888?source=collection_archive---------1-----------------------#2020-11-08">https://javascript.plainenglish.io/best-of-modern-javascript-promise-api-d4d4a925f888?source=collection_archive---------1-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c36eb5067126232037b92ce4b4da395c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EWQdD0uAku5VFY6Q"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@thenewmalcolm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Obi Onyeador</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="475a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究一些JavaScript promise方法。</p><h1 id="909b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">finally</code></h1><p id="ac06" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lz ma mb mc b">finally</code>方法让我们在承诺链中运行代码，而不管承诺链的结果如何。</p><p id="9291" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="23e0" class="mq lc iq mc b gy mr ms l mt mu">asyncFn()<br/>  .then(function(value1) {<br/>    //...<br/>  })<br/>  .then(function(value2) {<br/>    //...<br/>  })<br/>  .finally(function() {<br/>    // ...<br/>  });</span></pre><p id="6258" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe lz ma mb mc b">finally</code>,这样我们就可以运行一个回调函数，不管结果如何。</p><p id="b8c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这对于运行清理代码之类的事情很有用。</p><h1 id="3030" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ES6承诺库</h1><p id="c9f3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用许多有前途库。</p><p id="d226" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中许多都符合ES6 API。</p><p id="7720" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们包括:</p><ul class=""><li id="c00a" class="mv mw iq kf b kg kh kk kl ko mx ks my kw mz la na nb nc nd bi translated"><a class="ae kc" href="https://github.com/jakearchibald/es6-promise" rel="noopener ugc nofollow" target="_blank"> ES6-Promises </a> —小ES6 promise polyfill</li><li id="057e" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">"<a class="ae kc" href="https://github.com/getify/native-promise-only" rel="noopener ugc nofollow" target="_blank">仅限原生承诺(NPO) </a> —小型ES6承诺多填充</li><li id="5c48" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><a class="ae kc" href="https://github.com/calvinmetcalf/lie" rel="noopener ugc nofollow" target="_blank">谎言</a>——小ES6无极聚划算</li><li id="23db" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">"<a class="ae kc" href="https://github.com/tildeio/rsvp.js/" rel="noopener ugc nofollow" target="_blank"> RSVP.js </a> " —更大的承诺库</li><li id="a8ce" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">"<a class="ae kc" href="https://github.com/petkaantonov/bluebird" rel="noopener ugc nofollow" target="_blank">蓝鸟</a> " —更大的无极库</li><li id="af1e" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><a class="ae kc" href="https://github.com/kriskowal/q#using-qpromise" rel="noopener ugc nofollow" target="_blank"> Q.Promise </a> —更大的Promise库</li><li id="8816" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">"<a class="ae kc" href="https://github.com/paulmillr/es6-shim" rel="noopener ugc nofollow" target="_blank"> ES6垫片</a> " —标准聚合填料</li><li id="0d56" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">"<a class="ae kc" href="https://github.com/zloirock/core-js" rel="noopener ugc nofollow" target="_blank"> core-js </a> " —标准聚合填料</li></ul><h1 id="54a3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">ES6承诺API</h1><p id="8474" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">ES6 promise API有不同的部分。</p><p id="14d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最基础的部分是<code class="fe lz ma mb mc b">Promise</code>构造函数。</p><p id="d32c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它接受一个回调，该回调将<code class="fe lz ma mb mc b">resolve</code>和<code class="fe lz ma mb mc b">reject</code>函数作为参数。</p><p id="944e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">resolve</code>用传入的值解析承诺。</p><p id="e64a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe lz ma mb mc b">then</code>被调用，它将被转发给<code class="fe lz ma mb mc b">then</code>回调函数。</p><p id="601f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">reject</code>用给定值拒绝承诺。</p><p id="68de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">reject</code>的参数通常是一个<code class="fe lz ma mb mc b">Error</code>实例。</p><p id="ad0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过书写来使用它:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="d7c8" class="mq lc iq mc b gy mr ms l mt mu">const p = new Promise(function(resolve, reject) {<br/>  //...<br/>});</span></pre><h1 id="6fd2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">静态<code class="fe lz ma mb mc b">Promise</code>方法</h1><p id="9400" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">API中有几个静态承诺方法。</p><p id="5a17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们包括<code class="fe lz ma mb mc b">Promise.resolve</code>和<code class="fe lz ma mb mc b">Promise.reject</code>方法。</p><p id="a12d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">Promise.resolve</code>将任意值转换为承诺。</p><p id="d502" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们向它传递一个参数，以返回一个带有解析值的值。</p><p id="81dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用以下方式调用<code class="fe lz ma mb mc b">Promise.resolve</code>:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="7ca8" class="mq lc iq mc b gy mr ms l mt mu">Promise.resolve(1)</span></pre><p id="31f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">Promise.reject</code>让我们创建一个被拒绝的新承诺。</p><p id="c04f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用:<code class="fe lz ma mb mc b">Promise.reject</code>来称呼:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="991d" class="mq lc iq mc b gy mr ms l mt mu">Promise.reject(1)</span></pre><p id="64b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">写承诺有几种方法。</p><p id="ea17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">Promise.all</code>和<code class="fe lz ma mb mc b">Promise.race</code>让我们以不同的方式兑现多个承诺。</p><p id="fc46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">Promise.all</code>接受一个iterable，如果承诺数组中的所有元素都被满足，则iterable被满足。</p><p id="3a0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果iterable中的任何承诺被拒绝，则拒绝值是承诺中的第一个拒绝值。</p><p id="ad10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">Promise.race</code>也接受一个iterable，它处理返回的承诺。</p><p id="4380" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将返回一个承诺，该承诺解析为第一个解析的值。</p><h1 id="2483" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">Promise Instance M</code>方法</h1><p id="68e8" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">Promise实例有多种方法。</p><p id="3d7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">Prototype.prototype.then(onFulfilled, onRejected)</code>方法接受一个<code class="fe lz ma mb mc b">onFulfilled</code>和<code class="fe lz ma mb mc b">onRejected</code>回调。</p><p id="db4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">onFulfilled</code>在解决承诺时立即调用。</p><p id="9d93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">onRejected</code>当承诺被拒绝时调用。</p><p id="5592" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">then</code>返回一个新的承诺，该承诺解析为承诺中返回的值。</p><p id="1f46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe lz ma mb mc b">then</code>回调抛出异常，那么返回的承诺被拒绝。</p><p id="e112" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe lz ma mb mc b">onFulfilled</code>被省略，则完成的结果被转发到下一个<code class="fe lz ma mb mc b">then</code>。</p><p id="4e32" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe lz ma mb mc b">onRejected</code>被省略，则拒绝被转发到下一个<code class="fe lz ma mb mc b">then</code>。</p><p id="544b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们抓住第一个被拒绝的承诺的错误。</p><p id="9731" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和<code class="fe lz ma mb mc b">p.then(null, onRejected)</code>一样。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/b4c4fb05ec3b500e6b76afa439a16f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lOZ1Av1fuxC9sr5j"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@aniket940518?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aniket Bhattacharya</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a314" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="df6e" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">Promise API是一个标准API，它让我们可以轻松地编写异步代码。</p><p id="8062" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们可以被链接起来，我们可以用它们来捕捉错误。</p><p id="0c4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>