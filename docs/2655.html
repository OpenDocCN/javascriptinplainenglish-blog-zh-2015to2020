<html>
<head>
<title>Client-Side Storage in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的客户端存储</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/client-side-storage-in-javascript-c1e65bf0626a?source=collection_archive---------7-----------------------#2020-07-12">https://javascript.plainenglish.io/client-side-storage-in-javascript-c1e65bf0626a?source=collection_archive---------7-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/88145244065e3419bd1ba1e401f7bcb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A30cyA8nob7WuRHHsZD3yQ.png"/></div></div></figure><h1 id="4fb3" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">什么是客户端存储？</h1><p id="a687" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">顾名思义，客户端存储允许用户<strong class="ky ir">在客户端</strong>(即用户的浏览器)存储数据。相反，服务器端存储将数据存储在服务器上(即外部数据库)。</p><blockquote class="lu lv lw"><p id="1eb7" class="kw kx lx ky b kz ly lb lc ld lz lf lg ma mb lj lk mc md ln lo me mf lr ls lt ij bi translated"><em class="iq">要了解更多关于“客户端”和“服务器”之间区别的信息，请查看我的文章</em> <a class="ae mg" href="https://lo-victoria.com/a-beginners-intro-to-back-end-programming-ckanyrk7d02b2bbs1g9fv127k" rel="noopener ugc nofollow" target="_blank"> <em class="iq">后端编程介绍</em> </a> <em class="iq">。</em></p></blockquote><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/92ac614908b41c94a872d253d3d51d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qybt9LDZiASjKbeT"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk"><em class="mq">Source: </em><a class="ae mg" href="https://upload.wikimedia.org/wikipedia/commons/a/a4/AppLSAC-0_LocalStorage_remote_data_fetch.svg" rel="noopener ugc nofollow" target="_blank"><em class="mq">upload.wikimedia.org/wikipedia/commons/a/a4..</em></a></figcaption></figure><p id="6817" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">在当今的许多现代浏览器中，页面是动态加载的。这意味着它们使用服务器端存储来检索数据并在浏览器上呈现数据。然而，仍然存在客户端存储有用的情况。</p><h1 id="97e2" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">什么时候有用？</h1><p id="098d" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">客户端存储有利于以下使用情形:</p><ul class=""><li id="6ef3" class="mr ms iq ky b kz ly ld lz lh mt ll mu lp mv lt mw mx my mz bi translated"><strong class="ky ir">快速且独立于网络的</strong>数据访问</li><li id="95a0" class="mr ms iq ky b kz na ld nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="ky ir">存储用户偏好</strong>(即自定义小工具、字体大小、颜色等。)</li><li id="cad9" class="mr ms iq ky b kz na ld nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="ky ir">存储之前活动的会话</strong>(即登录账户、购物车等。)</li><li id="428c" class="mr ms iq ky b kz na ld nb lh nc ll nd lp ne lt mw mx my mz bi translated"><strong class="ky ir">本地保存数据供离线使用</strong></li></ul><h1 id="e57d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">客户端存储的类型</h1><h2 id="d279" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">1.Cookies(不推荐)</h2><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/82507436b38f9f158c44ae94bd5f0267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*YV1kz5TrSLB7Y3fE"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk"><em class="mq">Source: </em><a class="ae mg" href="https://www.webideasole.com/wp-content/uploads/2019/02/javascript-cookies-01-splessons.png" rel="noopener ugc nofollow" target="_blank"><em class="mq">webideasole.com/wp-content/uploads/2019/02/..</em></a></figcaption></figure><p id="e3b4" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">你可能听说过饼干。它们是最经典的客户端存储类型，从web早期开始就被网站使用。</p><p id="45eb" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">Cookies从服务器发送到客户端<strong class="ky ir">，然后<strong class="ky ir">存储在客户端</strong>上。然后，每当客户端再次向服务器发出请求时，就可以检索存储的cookie并将其发送回服务器。通常，cookies用于管理帐户会话、存储用户信息和跟踪用户数据。</strong></p><p id="706e" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">然而，由于cookies是最古老的客户端存储形式，它们有一些安全问题和存储限制，这使它们不适合存储客户端数据。</p><blockquote class="lu lv lw"><p id="afa2" class="kw kx lx ky b kz ly lb lc ld lz lf lg ma mb lj lk mc md ln lo me mf lr ls lt ij bi translated"><em class="iq">如需了解更多关于cookies安全问题的信息，请在此处阅读</em><a class="ae mg" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie#Security" rel="noopener ugc nofollow" target="_blank"><em class="iq"/></a><em class="iq">。</em></p></blockquote><h2 id="1a35" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">CRUD示例</h2><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="bcdf" class="nf jz iq nt b gy nx ny l nz oa">//Create<br/>document.cookie = "name=victoria";<br/><br/>//Read<br/>console.log( document.cookie );<br/><br/>//Update<br/>document.cookie = "name=victoria lo";<br/><br/>//Delete - Just set an expiry date that has passed<br/>document.cookie = "name=victoria lo ; expires = Thu, 01 Jan 2010 00:00:00 GMT"</span></pre><h1 id="ff13" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.Web存储API</h1><p id="e0df" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Web存储API是一个在客户端存储数据的<strong class="ky ir">键值对</strong>的API。这种简单直观的语法允许轻松存储和检索<strong class="ky ir">字符串或字符串化的JSON数据</strong>。</p><p id="e11c" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">该API中有两种类型的web存储:<strong class="ky ir">本地存储</strong>和<strong class="ky ir">会话存储</strong>。</p><h2 id="ae30" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">本地存储与会话存储</h2><p id="6efd" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这两种类型的web存储之间有一些明显的区别需要注意。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/3049fdde620a38a474c3c159cc9fa2b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_yhIrv7d4tpRscv2"/></div></div></figure><h2 id="edf0" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">本地存储的CRUD示例</h2><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="a51f" class="nf jz iq nt b gy nx ny l nz oa">// Create<br/>const user = { first: 'Victoria', last: 'AAA' }<br/>//store as a stringified JSON<br/>localStorage.setItem('user', JSON.stringify(user));<br/><br/>// Read<br/>console.log(JSON.parse(localStorage.getItem('user')))<br/>//output will be a JSON: {first: "Victoria", last: "lo"}<br/><br/>// Update<br/>const update = { first: 'Victoria', last: 'Lo'  }<br/>localStorage.setItem('user', JSON.stringify(update));<br/><br/>// Delete<br/>localStorage.removeItem('user');</span></pre><h2 id="73c2" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">会话存储的CRUD示例</h2><p id="0992" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">语法与本地存储相同，但将<code class="fe ob oc od nt b">localStorage</code>替换为<code class="fe ob oc od nt b">sessionStorage</code>。</p><h1 id="9618" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.IndexedDB API</h1><p id="2fcc" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">一个完整的数据库系统，适合存储比客户端本地存储更复杂的数据。与Web存储API不同，它允许组织和存储更多的结构化数据，如客户记录、详细的待办事项列表等。</p><p id="a74c" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">它使用<strong class="ky ir">对象存储</strong>，本质上是类似表的结构，来包含键值对。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/ac520b8f0f66726d56592266067d390d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VZ_TlROdn_E7lytN"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk"><em class="mq">Source: </em><a class="ae mg" href="https://javascript.info/article/indexeddb/indexeddb-structure.svg" rel="noopener ugc nofollow" target="_blank"><em class="mq">javascript.info/article/indexeddb/indexeddb..</em></a></figcaption></figure><h2 id="5f01" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">CRUD示例</h2><p id="325c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">首先，我们必须请求打开数据库:</p><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="6978" class="nf jz iq nt b gy nx ny l nz oa">let openRequest = indexedDB.open('database', 1);<br/>// users is the database name and 1 is the version</span></pre><p id="3518" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">然后，我们可以在下面添加一些方法来执行操作:</p><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="bd50" class="nf jz iq nt b gy nx ny l nz oa">openRequest.onupgradeneeded = function() {<br/>  // triggers if the client had no database<br/>  // ...perform initialization...<br/>};</span><span id="ce23" class="nf jz iq nt b gy oe ny l nz oa">openRequest.onerror = function() {<br/>  console.error("Error", openRequest.error);<br/>};</span><span id="c68d" class="nf jz iq nt b gy oe ny l nz oa">openRequest.onsuccess = function() {<br/>  let db = openRequest.result;<br/>  // continue to work with database using db object<br/>};</span></pre><p id="b77a" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated"><em class="lx">(代码来自</em><a class="ae mg" href="https://javascript.info/indexeddb" rel="noopener ugc nofollow" target="_blank"><em class="lx"/></a><em class="lx">)</em></p><p id="9de8" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">现在，让我们在<code class="fe ob oc od nt b">onupgradeneeded</code>方法中创建一个对象存储:</p><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="bbe1" class="nf jz iq nt b gy nx ny l nz oa">let db = openRequest.result;<br/> // if there's no "users" store initialized, we create one<br/>if (!db.objectStoreNames.contains('users')) {<br/>       let objectStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement:true });<br/>}</span></pre><p id="1c52" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">为了将数据添加到对象存储中，IndexedDB API使用<strong class="ky ir">事务</strong>。我们可以启动一个事务，通过以下方式将数据添加到“用户”对象存储中:</p><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="b00d" class="nf jz iq nt b gy nx ny l nz oa">// open a read/write transaction<br/>let transaction = db.transaction("users", "readwrite"); </span><span id="fd64" class="nf jz iq nt b gy oe ny l nz oa">// get the object store we want to operate on<br/>let userStore = transaction.objectStore("users");</span><span id="bc54" class="nf jz iq nt b gy oe ny l nz oa">// add the data into the store<br/>userStore.add({<br/>        first: 'Victoria',<br/>        last: 'Lo'<br/>    });</span><span id="253f" class="nf jz iq nt b gy oe ny l nz oa">// finish the transaction<br/>transaction.oncomplete = function() {<br/>  console.log("Transaction is complete");<br/>};</span></pre><p id="847a" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">要读取或删除数据，只需遵循前面显示的相同事务步骤，但这一次，我们使用的不是add，而是:</p><pre class="mi mj mk ml gt ns nt nu nv aw nw bi"><span id="ab4a" class="nf jz iq nt b gy nx ny l nz oa">// Read<br/>userStore.get('Victoria');</span><span id="ff28" class="nf jz iq nt b gy oe ny l nz oa">// Delete<br/>userStore.delete('Victoria');</span></pre><h1 id="0b51" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">这就是要点！</h1><p id="6dd3" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">感谢您阅读这篇JavaScript客户端存储的基本介绍。这些示例只是作为这些不同类型的存储如何工作的快速概述。我鼓励您阅读更多详细信息，网址为:</p><ul class=""><li id="a35b" class="mr ms iq ky b kz ly ld lz lh mt ll mu lp mv lt mw mx my mz bi translated"><a class="ae mg" href="https://javascript.info/indexeddb" rel="noopener ugc nofollow" target="_blank">javascript.info/indexeddb</a></li><li id="0c4f" class="mr ms iq ky b kz na ld nb lh nc ll nd lp ne lt mw mx my mz bi translated"><a class="ae mg" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Client-side_web_APIs/Client-side_storage" rel="noopener ugc nofollow" target="_blank">developer.mozilla.org/en-US/docs/Learn/Java..</a></li></ul><p id="e7c5" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">尽管如此，最好的学习方法是实践，所以我也鼓励你<strong class="ky ir">尝试做一个使用客户端存储的迷你项目</strong>。希望这篇文章有所帮助。干杯！</p><p id="1f37" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">【https://lo-victoria.com】原载于<a class="ae mg" href="https://lo-victoria.com/client-side-storage-in-javascript-ckcj01tb400fsxas1cezt540r" rel="noopener ugc nofollow" target="_blank"><em class="lx"/></a><em class="lx">。</em></p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><h2 id="5c01" class="nf jz iq bd ka ng nh dn ke ni nj dp ki lh nk nl km ll nm nn kq lp no np ku nq bi translated">简单英语的JavaScript</h2><p id="2f91" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae mg" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">订阅解码获得更多类似内容，我们的YouTube频道</strong> </a> <strong class="ky ir">！</strong></p></div></div>    
</body>
</html>