<html>
<head>
<title>Add Authentication to your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将身份验证添加到您的反应应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-a-simple-authentication-to-your-react-app-de8add1e3278?source=collection_archive---------3-----------------------#2019-11-28">https://javascript.plainenglish.io/add-a-simple-authentication-to-your-react-app-de8add1e3278?source=collection_archive---------3-----------------------#2019-11-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2b06" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用Okta向您的Action应用程序添加身份验证</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/0d1da6381cd346fd3bc86af516be829c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FamqtVlugMzPKH2iVCl1FQ.jpeg"/></div></div></figure><p id="c492" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">今天，我将向您展示如何向您的React应用程序添加一个简单的身份验证，该应用程序使用来自Okta的身份验证，Okta是一个用户管理系统，可以在基于多种语言或框架的多个应用程序中使用。</p><p id="69f0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">它类似于身份验证0。您可以在多个应用程序中使用它，甚至可以与构建在不同语言和平台上的应用程序一起使用。</p><p id="94aa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">目前，Okta支持以下语言:</p><ul class=""><li id="30c0" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated">机器人</li><li id="4731" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">有角的</li><li id="59f8" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">ios</li><li id="0427" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">Java 语言(一种计算机语言，尤用于创建网站)</li><li id="021b" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">。网</li><li id="0ecc" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">Node.js</li><li id="042e" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">服务器端编程语言（Professional Hypertext Preprocessor的缩写）</li><li id="62d9" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">反应</li></ul><h1 id="03af" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">签约</h1><p id="2b69" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">在您将Okta集成到您的反应应用程序之前，您将需要一个Okta开发人员帐户。所以现在就去创建你的免费账户吧。</p><p id="8055" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae mv" href="https://developer.okta.com/signup/" rel="noopener ugc nofollow" target="_blank">免费Okta开发商账户</a></p><h1 id="1fec" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">Okta仪表板</h1><p id="6ec4" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">创建免费帐户后，您将被重定向到仪表板。您注意到仪表盘上的<strong class="kq io">组织网址</strong>了吗？您的申请需要这个。仪表板还有显示所有活动的用户指标和系统日志。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mw"><img src="../Images/a8b037291c9b73bd01cea8d8b699b981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kYCXeZt-iZxo2buAGy_aiQ.png"/></div></div></figure><h1 id="7c78" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">注册您的反应申请</h1><p id="cdc7" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">该注册您的反应申请了。点击仪表盘上的<strong class="kq io">应用</strong>链接。</p><ul class=""><li id="5aba" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated">点击添加应用程序</li><li id="698d" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">选择单页应用程序</li><li id="839d" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">在“名称”字段中为您的应用程序添加名称</li></ul><p id="c98e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，您必须编辑URIs基地字段。我将假设您正在本地服务器上使用create-react-app。</p><p id="da02" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b"><a class="ae mv" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code></p><p id="c615" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">与登录重定向URIs相同&amp; <strong class="kq io">单击完成</strong></p><p id="82d6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b"><a class="ae mv" href="http://localhost:3000/implicit/callback" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/implicit/callback</a></code></p><p id="e0d3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在您的申请已经登记，您将获得一个<strong class="kq io">客户ID </strong></p><h1 id="9969" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">启动您的代码编辑器</h1><ul class=""><li id="ad57" class="lk ll in kq b kr mq ku mr kx nb lb nc lf nd lj lp lq lr ls bi translated">导航到您的项目文件夹</li><li id="3422" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">添加必要的包</li></ul><p id="de89" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b">yarn add react-router-dom @okta/okta-react @okta/signin-widget</code></p><p id="d0bc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了这个例子，让我们假设您的react应用程序有三个位于私有路由中的页面，并且只有授权用户可以访问这些路由。</p><p id="d446" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">/主页/用户/订单</p><h1 id="83d1" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">创建登录组件</h1><p id="c3b9" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">在您的组件文件夹中创建一个名为<em class="ne"> auth </em>的新文件夹，并使用以下代码创建一个名为Login.js的新文件。</p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="c5ab" class="nj lz in na b gy nk nl l nm nn">import React, { Component } from 'react';<br/>import { Redirect } from 'react-router-dom';<br/>import OktaSignInWidget from './SigninWidget';<br/>import { withAuth } from '@okta/okta-react';<br/><br/>export default withAuth(class Login extends Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      authenticated: null<br/>    };<br/>    this.checkAuthentication();<br/>  }<br/><br/>  async checkAuthentication() {<br/>    const authenticated = await this.props.auth.isAuthenticated();<br/>    if (authenticated !== this.state.authenticated) {<br/>      this.setState({ authenticated });<br/>      this.props.history.push('/home')<br/><br/>    }<br/>  }<br/><br/>  componentDidUpdate() {<br/>    this.checkAuthentication();<br/>  }<br/><br/>  onSuccess = (res) =&gt; {<br/>    if (res.status === 'SUCCESS') {<br/>      return this.props.auth.redirect({<br/>        sessionToken: res.session.token<br/>      });<br/>   } else {<br/>    // The user can be in another authentication state that requires further action.<br/>    // For more information about these states, see:<br/>    //   https://github.com/okta/okta-signin-widget#rendereloptions-success-error<br/>    }<br/>  }<br/><br/>  onError = (err) =&gt; {<br/>    console.log('error logging in', err);<br/>  }<br/><br/>  render() {<br/>    if (this.state.authenticated === null) return null;<br/>    return this.state.authenticated ?<br/>      &lt;Redirect to={{ pathname: '/' }}/&gt; :<br/>      &lt;OktaSignInWidget<br/>        baseUrl={this.props.baseUrl}<br/>        onSuccess={this.onSuccess}<br/>        onError={this.onError}/&gt;;<br/>  }<br/>});</span></pre><p id="0899" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，您需要在同一个<em class="ne"> auth </em>目录下创建一个名为<em class="ne">signingidget</em>的新文件，代码如下。</p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="6404" class="nj lz in na b gy nk nl l nm nn">*SigninWidget.js*<br/><br/>import React, { Component } from 'react';<br/>import ReactDOM from 'react-dom';<br/>import OktaSignIn from '@okta/okta-signin-widget';<br/>import '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css';<br/><br/> class SigninWidget extends Component {<br/>  componentDidMount() {<br/>    const el = ReactDOM.findDOMNode(this);<br/>    this.widget = new OktaSignIn({<br/>      baseUrl: this.props.baseUrl,<br/>      authParams: {<br/>        pkce: true<br/>      },<br/>    });<br/>    this.widget.renderEl({el}, this.props.onSuccess, this.props.onError);<br/>  }<br/><br/>  componentWillUnmount() {<br/>    this.widget.remove();<br/>  }<br/><br/>  render() {<br/>    return &lt;div /&gt;;<br/>  }<br/>};<br/><br/>export default SigninWidget</span></pre><p id="bdd5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下一步是更新您的路由文件。下面是我的Okta实现中的一个例子。将私有路由包装在<strong class="kq io"> SecureRoute </strong>组件中，并用Okta开发人员控制台中您自己的凭证替换<strong class="kq io">客户端ID </strong>和<strong class="kq io">发行方</strong>。</p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="2757" class="nj lz in na b gy nk nl l nm nn">import React from "react";<br/>import { BrowserRouter as Router, Route } from "react-router-dom";<br/>import Order from "./pages/Order.js";<br/>import Home from "./pages/Home.js";<br/>import Users from "./pages/Users.js";<br/>import Login from "./components/auth/Login";<br/>import { Security, SecureRoute, ImplicitCallback } from "@okta/okta-react";<br/><br/>function onAuthRequired({ history }) {<br/>  history.push("/login");<br/>}<br/><br/>const AppRoute = () =&gt; (<br/>  &lt;Router&gt;<br/>    &lt;Security<br/>      issuer="https://dev-944example.okta.com/oauth2/default" //Replace with your ORG URI.<br/>      clientId="0oa1ws12avokObj45C357example" //Replace with your own client id<br/>      redirectUri={window.location.origin + "/implicit/callback"}<br/>      onAuthRequired={onAuthRequired}<br/>    &gt;<br/>      &lt;SecureRoute exact path="/orders" component={Order} /&gt;<br/>      &lt;SecureRoute exact path="/users" component={Users} /&gt;<br/>      &lt;Route exact path="/" component={Home} /&gt;<br/>      &lt;Route<br/>        path="/login"<br/>        render={() =&gt; &lt;Login baseUrl="https://dev-968924.okta.com" /&gt;}<br/>      /&gt;<br/>      &lt;Route path="/implicit/callback" component={ImplicitCallback} /&gt;<br/>    &lt;/Security&gt;<br/>  &lt;/Router&gt;<br/>);<br/><br/>export default AppRoute;</span></pre><h1 id="cf4b" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">创建注销功能</h1><p id="e9b6" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">这是最后一步。您将希望在home.js文件或根文件中创建一个注销按钮，在用户登录后呈现给用户，并且不要忘记将您的函数包装在带有Auth 的<strong class="kq io">中，以使用<strong class="kq io"> auth </strong>属性。</strong></p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="5f4a" class="nj lz in na b gy nk nl l nm nn">import { withAuth } from "@okta/okta-react";<br/>import Breadcrumb from './breadcrumb.js'<br/>class Home extends Component {<br/>  logout = async () =&gt; {<br/>    this.props.auth.logout("/");<br/>  };<br/><br/>  render() {<br/>    return (<br/>      &lt;&gt;<br/>        &lt;Breadcrumb home="Logout" click={this.logout} /&gt;<br/>      &lt;/&gt;<br/>    );<br/>  }<br/>}<br/><br/>export default withAuth(Home);</span></pre><h1 id="564e" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">恭喜你！🎉</h1><p id="1d5b" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">如果您设法做到了这一步，那么我希望您已经成功地将Okta身份验证集成到react应用程序中。如果你遇到任何麻烦，请在下面发表评论。我会帮你解决的。</p><p id="c2a5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是我在这里的第一个帖子。我很快会带着新的回来。</p><p id="57d8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">谢谢大家！</p></div></div>    
</body>
</html>