<html>
<head>
<title>Add Authentication to your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å°†èº«ä»½éªŒè¯æ·»åŠ åˆ°æ‚¨çš„ååº”åº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/add-a-simple-authentication-to-your-react-app-de8add1e3278?source=collection_archive---------3-----------------------#2019-11-28">https://javascript.plainenglish.io/add-a-simple-authentication-to-your-react-app-de8add1e3278?source=collection_archive---------3-----------------------#2019-11-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2b06" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">å¦‚ä½•ä½¿ç”¨Oktaå‘æ‚¨çš„Actionåº”ç”¨ç¨‹åºæ·»åŠ èº«ä»½éªŒè¯</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/0d1da6381cd346fd3bc86af516be829c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FamqtVlugMzPKH2iVCl1FQ.jpeg"/></div></div></figure><p id="c492" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ä»Šå¤©ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å‘æ‚¨çš„Reactåº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªç®€å•çš„èº«ä»½éªŒè¯ï¼Œè¯¥åº”ç”¨ç¨‹åºä½¿ç”¨æ¥è‡ªOktaçš„èº«ä»½éªŒè¯ï¼ŒOktaæ˜¯ä¸€ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥åœ¨åŸºäºå¤šç§è¯­è¨€æˆ–æ¡†æ¶çš„å¤šä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚</p><p id="69f0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å®ƒç±»ä¼¼äºèº«ä»½éªŒè¯0ã€‚æ‚¨å¯ä»¥åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒï¼Œç”šè‡³å¯ä»¥ä¸æ„å»ºåœ¨ä¸åŒè¯­è¨€å’Œå¹³å°ä¸Šçš„åº”ç”¨ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚</p><p id="94aa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ç›®å‰ï¼ŒOktaæ”¯æŒä»¥ä¸‹è¯­è¨€:</p><ul class=""><li id="30c0" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated">æœºå™¨äºº</li><li id="4731" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">æœ‰è§’çš„</li><li id="59f8" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">ios</li><li id="0427" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">Java è¯­è¨€(ä¸€ç§è®¡ç®—æœºè¯­è¨€ï¼Œå°¤ç”¨äºåˆ›å»ºç½‘ç«™)</li><li id="021b" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">ã€‚ç½‘</li><li id="0ecc" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">Node.js</li><li id="042e" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">æœåŠ¡å™¨ç«¯ç¼–ç¨‹è¯­è¨€ï¼ˆProfessional Hypertext Preprocessorçš„ç¼©å†™ï¼‰</li><li id="62d9" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">ååº”</li></ul><h1 id="03af" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">ç­¾çº¦</h1><p id="2b69" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">åœ¨æ‚¨å°†Oktaé›†æˆåˆ°æ‚¨çš„ååº”åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªOktaå¼€å‘äººå‘˜å¸æˆ·ã€‚æ‰€ä»¥ç°åœ¨å°±å»åˆ›å»ºä½ çš„å…è´¹è´¦æˆ·å§ã€‚</p><p id="8055" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae mv" href="https://developer.okta.com/signup/" rel="noopener ugc nofollow" target="_blank">å…è´¹Oktaå¼€å‘å•†è´¦æˆ·</a></p><h1 id="1fec" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">Oktaä»ªè¡¨æ¿</h1><p id="6ec4" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">åˆ›å»ºå…è´¹å¸æˆ·åï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°ä»ªè¡¨æ¿ã€‚æ‚¨æ³¨æ„åˆ°ä»ªè¡¨ç›˜ä¸Šçš„<strong class="kq io">ç»„ç»‡ç½‘å€</strong>äº†å—ï¼Ÿæ‚¨çš„ç”³è¯·éœ€è¦è¿™ä¸ªã€‚ä»ªè¡¨æ¿è¿˜æœ‰æ˜¾ç¤ºæ‰€æœ‰æ´»åŠ¨çš„ç”¨æˆ·æŒ‡æ ‡å’Œç³»ç»Ÿæ—¥å¿—ã€‚</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mw"><img src="../Images/a8b037291c9b73bd01cea8d8b699b981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kYCXeZt-iZxo2buAGy_aiQ.png"/></div></div></figure><h1 id="7c78" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">æ³¨å†Œæ‚¨çš„ååº”ç”³è¯·</h1><p id="cdc7" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">è¯¥æ³¨å†Œæ‚¨çš„ååº”ç”³è¯·äº†ã€‚ç‚¹å‡»ä»ªè¡¨ç›˜ä¸Šçš„<strong class="kq io">åº”ç”¨</strong>é“¾æ¥ã€‚</p><ul class=""><li id="5aba" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated">ç‚¹å‡»æ·»åŠ åº”ç”¨ç¨‹åº</li><li id="698d" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">é€‰æ‹©å•é¡µåº”ç”¨ç¨‹åº</li><li id="839d" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">åœ¨â€œåç§°â€å­—æ®µä¸­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ åç§°</li></ul><p id="c98e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ç°åœ¨ï¼Œæ‚¨å¿…é¡»ç¼–è¾‘URIsåŸºåœ°å­—æ®µã€‚æˆ‘å°†å‡è®¾æ‚¨æ­£åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šä½¿ç”¨create-react-appã€‚</p><p id="da02" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b"><a class="ae mv" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code></p><p id="c615" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ä¸ç™»å½•é‡å®šå‘URIsç›¸åŒ&amp; <strong class="kq io">å•å‡»å®Œæˆ</strong></p><p id="82d6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b"><a class="ae mv" href="http://localhost:3000/implicit/callback" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/implicit/callback</a></code></p><p id="e0d3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ç°åœ¨æ‚¨çš„ç”³è¯·å·²ç»ç™»è®°ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ª<strong class="kq io">å®¢æˆ·ID </strong></p><h1 id="9969" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">å¯åŠ¨æ‚¨çš„ä»£ç ç¼–è¾‘å™¨</h1><ul class=""><li id="ad57" class="lk ll in kq b kr mq ku mr kx nb lb nc lf nd lj lp lq lr ls bi translated">å¯¼èˆªåˆ°æ‚¨çš„é¡¹ç›®æ–‡ä»¶å¤¹</li><li id="3422" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">æ·»åŠ å¿…è¦çš„åŒ…</li></ul><p id="de89" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mx my mz na b">yarn add react-router-dom @okta/okta-react @okta/signin-widget</code></p><p id="d0bc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ä¸ºäº†è¿™ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬å‡è®¾æ‚¨çš„reactåº”ç”¨ç¨‹åºæœ‰ä¸‰ä¸ªä½äºç§æœ‰è·¯ç”±ä¸­çš„é¡µé¢ï¼Œå¹¶ä¸”åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®è¿™äº›è·¯ç”±ã€‚</p><p id="d446" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">/ä¸»é¡µ/ç”¨æˆ·/è®¢å•</p><h1 id="83d1" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">åˆ›å»ºç™»å½•ç»„ä»¶</h1><p id="c3b9" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">åœ¨æ‚¨çš„ç»„ä»¶æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<em class="ne"> auth </em>çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªåä¸ºLogin.jsçš„æ–°æ–‡ä»¶ã€‚</p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="c5ab" class="nj lz in na b gy nk nl l nm nn">import React, { Component } from 'react';<br/>import { Redirect } from 'react-router-dom';<br/>import OktaSignInWidget from './SigninWidget';<br/>import { withAuth } from '@okta/okta-react';<br/><br/>export default withAuth(class Login extends Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      authenticated: null<br/>    };<br/>    this.checkAuthentication();<br/>  }<br/><br/>  async checkAuthentication() {<br/>    const authenticated = await this.props.auth.isAuthenticated();<br/>    if (authenticated !== this.state.authenticated) {<br/>      this.setState({ authenticated });<br/>      this.props.history.push('/home')<br/><br/>    }<br/>  }<br/><br/>  componentDidUpdate() {<br/>    this.checkAuthentication();<br/>  }<br/><br/>  onSuccess = (res) =&gt; {<br/>    if (res.status === 'SUCCESS') {<br/>      return this.props.auth.redirect({<br/>        sessionToken: res.session.token<br/>      });<br/>   } else {<br/>    // The user can be in another authentication state that requires further action.<br/>    // For more information about these states, see:<br/>    //   https://github.com/okta/okta-signin-widget#rendereloptions-success-error<br/>    }<br/>  }<br/><br/>  onError = (err) =&gt; {<br/>    console.log('error logging in', err);<br/>  }<br/><br/>  render() {<br/>    if (this.state.authenticated === null) return null;<br/>    return this.state.authenticated ?<br/>      &lt;Redirect to={{ pathname: '/' }}/&gt; :<br/>      &lt;OktaSignInWidget<br/>        baseUrl={this.props.baseUrl}<br/>        onSuccess={this.onSuccess}<br/>        onError={this.onError}/&gt;;<br/>  }<br/>});</span></pre><p id="0899" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åœ¨åŒä¸€ä¸ª<em class="ne"> auth </em>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<em class="ne">signingidget</em>çš„æ–°æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="6404" class="nj lz in na b gy nk nl l nm nn">*SigninWidget.js*<br/><br/>import React, { Component } from 'react';<br/>import ReactDOM from 'react-dom';<br/>import OktaSignIn from '@okta/okta-signin-widget';<br/>import '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css';<br/><br/> class SigninWidget extends Component {<br/>  componentDidMount() {<br/>    const el = ReactDOM.findDOMNode(this);<br/>    this.widget = new OktaSignIn({<br/>      baseUrl: this.props.baseUrl,<br/>      authParams: {<br/>        pkce: true<br/>      },<br/>    });<br/>    this.widget.renderEl({el}, this.props.onSuccess, this.props.onError);<br/>  }<br/><br/>  componentWillUnmount() {<br/>    this.widget.remove();<br/>  }<br/><br/>  render() {<br/>    return &lt;div /&gt;;<br/>  }<br/>};<br/><br/>export default SigninWidget</span></pre><p id="bdd5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ä¸‹ä¸€æ­¥æ˜¯æ›´æ–°æ‚¨çš„è·¯ç”±æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯æˆ‘çš„Oktaå®ç°ä¸­çš„ä¸€ä¸ªä¾‹å­ã€‚å°†ç§æœ‰è·¯ç”±åŒ…è£…åœ¨<strong class="kq io"> SecureRoute </strong>ç»„ä»¶ä¸­ï¼Œå¹¶ç”¨Oktaå¼€å‘äººå‘˜æ§åˆ¶å°ä¸­æ‚¨è‡ªå·±çš„å‡­è¯æ›¿æ¢<strong class="kq io">å®¢æˆ·ç«¯ID </strong>å’Œ<strong class="kq io">å‘è¡Œæ–¹</strong>ã€‚</p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="2757" class="nj lz in na b gy nk nl l nm nn">import React from "react";<br/>import { BrowserRouter as Router, Route } from "react-router-dom";<br/>import Order from "./pages/Order.js";<br/>import Home from "./pages/Home.js";<br/>import Users from "./pages/Users.js";<br/>import Login from "./components/auth/Login";<br/>import { Security, SecureRoute, ImplicitCallback } from "@okta/okta-react";<br/><br/>function onAuthRequired({ history }) {<br/>  history.push("/login");<br/>}<br/><br/>const AppRoute = () =&gt; (<br/>  &lt;Router&gt;<br/>    &lt;Security<br/>      issuer="https://dev-944example.okta.com/oauth2/default" //Replace with your ORG URI.<br/>      clientId="0oa1ws12avokObj45C357example" //Replace with your own client id<br/>      redirectUri={window.location.origin + "/implicit/callback"}<br/>      onAuthRequired={onAuthRequired}<br/>    &gt;<br/>      &lt;SecureRoute exact path="/orders" component={Order} /&gt;<br/>      &lt;SecureRoute exact path="/users" component={Users} /&gt;<br/>      &lt;Route exact path="/" component={Home} /&gt;<br/>      &lt;Route<br/>        path="/login"<br/>        render={() =&gt; &lt;Login baseUrl="https://dev-968924.okta.com" /&gt;}<br/>      /&gt;<br/>      &lt;Route path="/implicit/callback" component={ImplicitCallback} /&gt;<br/>    &lt;/Security&gt;<br/>  &lt;/Router&gt;<br/>);<br/><br/>export default AppRoute;</span></pre><h1 id="cf4b" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">åˆ›å»ºæ³¨é”€åŠŸèƒ½</h1><p id="e9b6" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">è¿™æ˜¯æœ€åä¸€æ­¥ã€‚æ‚¨å°†å¸Œæœ›åœ¨home.jsæ–‡ä»¶æˆ–æ ¹æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæ³¨é”€æŒ‰é’®ï¼Œåœ¨ç”¨æˆ·ç™»å½•åå‘ˆç°ç»™ç”¨æˆ·ï¼Œå¹¶ä¸”ä¸è¦å¿˜è®°å°†æ‚¨çš„å‡½æ•°åŒ…è£…åœ¨å¸¦æœ‰Auth çš„<strong class="kq io">ä¸­ï¼Œä»¥ä½¿ç”¨<strong class="kq io"> auth </strong>å±æ€§ã€‚</strong></p><pre class="kd ke kf kg gt nf na ng nh aw ni bi"><span id="5f4a" class="nj lz in na b gy nk nl l nm nn">import { withAuth } from "@okta/okta-react";<br/>import Breadcrumb from './breadcrumb.js'<br/>class Home extends Component {<br/>  logout = async () =&gt; {<br/>    this.props.auth.logout("/");<br/>  };<br/><br/>  render() {<br/>    return (<br/>      &lt;&gt;<br/>        &lt;Breadcrumb home="Logout" click={this.logout} /&gt;<br/>      &lt;/&gt;<br/>    );<br/>  }<br/>}<br/><br/>export default withAuth(Home);</span></pre><h1 id="564e" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">æ­å–œä½ ï¼ğŸ‰</h1><p id="1d5b" class="pw-post-body-paragraph ko kp in kq b kr mq jo kt ku mr jr kw kx ms kz la lb mt ld le lf mu lh li lj ig bi translated">å¦‚æœæ‚¨è®¾æ³•åšåˆ°äº†è¿™ä¸€æ­¥ï¼Œé‚£ä¹ˆæˆ‘å¸Œæœ›æ‚¨å·²ç»æˆåŠŸåœ°å°†Oktaèº«ä»½éªŒè¯é›†æˆåˆ°reactåº”ç”¨ç¨‹åºä¸­ã€‚å¦‚æœä½ é‡åˆ°ä»»ä½•éº»çƒ¦ï¼Œè¯·åœ¨ä¸‹é¢å‘è¡¨è¯„è®ºã€‚æˆ‘ä¼šå¸®ä½ è§£å†³çš„ã€‚</p><p id="c2a5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">è¿™æ˜¯æˆ‘åœ¨è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå¸–å­ã€‚æˆ‘å¾ˆå¿«ä¼šå¸¦ç€æ–°çš„å›æ¥ã€‚</p><p id="57d8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">è°¢è°¢å¤§å®¶ï¼</p></div></div>    
</body>
</html>