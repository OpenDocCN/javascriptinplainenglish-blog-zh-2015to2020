<html>
<head>
<title>Create Self-Destructing Tweets with Node.js and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js和TypeScript创建自毁推文</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/self-destructing-tweets-cce39e59cca2?source=collection_archive---------19-----------------------#2020-10-05">https://javascript.plainenglish.io/self-destructing-tweets-cce39e59cca2?source=collection_archive---------19-----------------------#2020-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8ff3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让Twitter按照你的方式工作</h2></div><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="ab gu cl kk"><img src="../Images/a9ca8c78fce8df07ee77fdf197cdf4e2.png" data-original-src="https://miro.medium.com/v2/0*ZIRlwliqfTxOZxI6"/></div></figure><p id="bbe7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我会第一个承认:<strong class="kp ir"> <em class="lj">我不喜欢社交媒体</em> </strong>。</p><p id="a505" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这并不是说我不喜欢与我爱的人保持联系，并有办法跟上他们的生活。事实上，我们的梦想是利用社交媒体来实现这一点。</p><p id="b033" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我不喜欢社交媒体的原因是<strong class="kp ir">社交媒体对我的控制超过了我对它的控制</strong>。好了，我承认了。开心吗？</p><p id="c7da" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你可以说我过于乐观，但是我仍然相信我仍然可以让它工作。然而，让它为我工作需要一些微调。</p><p id="2ebd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对脸书和Instagram的微调意味着删除它。我六个月前做过这个。我确信，出于商业和广告的原因，脸书账户会有一个用例，但是应用奥卡姆剃刀理论来解释我为什么在<em class="lj">时刻同时使用这两个应用程序并不是出于商业目的</em>，因此我轻轻一弹。</p><p id="8962" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">至于Twitter，它可能是一个真正的负面南希，然而，我确实从那里收到了一些非常重要的通知。我想在Twitter上做的是尽量减少负面影响，尽可能地从应用程序中删除我的历史记录。</p><p id="b426" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了开始这个过程，我构建了一个简单的Twitter bot，它运行在cron作业上，将从我的个人资料中删除任何超过7天的推文。</p><p id="075a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本教程中，我将演示删除推文的第一部分。</p><h2 id="8869" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">先决条件</h2><ol class=""><li id="2e0d" class="md me iq kp b kq mf kt mg kw mh la mi le mj li mk ml mm mn bi translated">基本的节点理解。</li><li id="10f6" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated">基本的Typescript理解。</li><li id="70db" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated">阅读我关于用JavaScript构建你的第一个Twitter机器人的帖子。我不会重复这些内容。</li><li id="f6c4" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated">阅读我在<a class="ae mt" href="https://blog.dennisokeeffe.com/blog/2020-06-22-cdk-lambda-to-send-slack-message/" rel="noopener ugc nofollow" target="_blank">上的帖子，使用AWS CDK在cron作业</a>期间调用Lambda函数。在本教程中，我今天不讨论cron作业部分。</li><li id="2a5c" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated">您参加<a class="ae mt" href="https://github.com/ttezel/twit" rel="noopener ugc nofollow" target="_blank"> Twit </a>所需的证件。</li></ol><h2 id="67b9" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">入门指南</h2><p id="aa0c" class="pw-post-body-paragraph kn ko iq kp b kq mf jr ks kt mg ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">在您选择的新文件夹中，运行以下命令:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8c8a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本教程中，我想尝试一下我上周在网上看到的<a class="ae mt" href="https://github.com/a7ul/esbuild-node-tsc" rel="noopener ugc nofollow" target="_blank"> esbuild-node-tsc </a>和<a class="ae mt" href="https://github.com/iamkun/dayjs" rel="noopener ugc nofollow" target="_blank"> DayJS </a>，因为我还没有机会尝试那一个！</p><h2 id="d9ed" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">设置Dotenv</h2><p id="cd70" class="pw-post-body-paragraph kn ko iq kp b kq mf jr ks kt mg ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">如果您遵循了先决条件，您将拥有您的帐户密钥。</p><p id="b189" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">将正确变量的密钥添加到<code class="fe mz na nb nc b">.env</code>中:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><h2 id="18ab" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">设置TypeScript、nodemon.json和package.json</h2><p id="424b" class="pw-post-body-paragraph kn ko iq kp b kq mf jr ks kt mg ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">在<code class="fe mz na nb nc b">tsconfig.json</code>中，我们将告诉它目标节点的需求。我们添加了<code class="fe mz na nb nc b">ES2020.Promise</code>库，这样我们就可以使用<code class="fe mz na nb nc b">Promise.allSettled</code>，但是如果你想用<code class="fe mz na nb nc b">Promise.all</code>代替，你可以省略它(不是说任何拒绝都会导致所有拒绝，如果没有<code class="fe mz na nb nc b">allSettled</code>)。</p><p id="152b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">将以下内容添加到文件中:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8b3f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在<code class="fe mz na nb nc b">nodemon.json</code>中，我们基本上会告诉它在扩展名为<code class="fe mz na nb nc b">ts</code>的文件改变时运行<code class="fe mz na nb nc b">etsc</code>。</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1808" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对于<code class="fe mz na nb nc b">package.json</code>，将以下内容添加到脚本键中(为简洁起见，其余部分省略):</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><h2 id="07bb" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">创建我们的Twitter助手文件</h2><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="ab4a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在<code class="fe mz na nb nc b">src/twitter/index.ts</code>内，添加以下内容:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1ffb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这篇文章期望你能够理解上面的内容，但是最重要的是我们使用<code class="fe mz na nb nc b">dotenv</code>从<code class="fe mz na nb nc b">.env</code>文件中获取局部变量。</p><p id="d2f8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后我们有两个主要的函数<code class="fe mz na nb nc b">getUserTimeline</code>和<code class="fe mz na nb nc b">destroyMany</code>，它们将从你的账户获取<code class="fe mz na nb nc b">n</code>条推文，然后分别销毁所有这些推文。</p><p id="c9bd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在是时候编写将利用这些函数的主脚本了。</p><h2 id="3e9e" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">编写主脚本</h2><p id="06db" class="pw-post-body-paragraph kn ko iq kp b kq mf jr ks kt mg ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">在<code class="fe mz na nb nc b">src/index.ts</code>中，添加以下内容:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="b0bb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这里，我们等待通过我们的<code class="fe mz na nb nc b">getUserTimeline</code>调用获得最大tweet计数(200 ),然后遍历响应数据，以确定创建日期是否超过一周。如果是，我们将它推送到一个<code class="fe mz na nb nc b">tweetsToDelete</code>数组，然后最终将该数组传递给<code class="fe mz na nb nc b">destroyMany</code>。</p><p id="f244" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们注销<code class="fe mz na nb nc b">manyDestroyed</code>变量，查看哪些请求被满足，哪些推文被删除。</p><h2 id="01f3" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">运行脚本</h2><p id="230f" class="pw-post-body-paragraph kn ko iq kp b kq mf jr ks kt mg ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">要运行脚本模式，运行<code class="fe mz na nb nc b">npm start</code>(在观察模式下与<code class="fe mz na nb nc b">nodemon</code>一起运行)。这将启动Nodemon，如果成功，你将看到你的推文超过7天开始删除！</p><p id="4ef5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你已经发了200多条推文，你可能需要重新运行这个脚本几次，直到它没有更多要删除的了！</p><h2 id="18d7" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">结论</h2><p id="ee10" class="pw-post-body-paragraph kn ko iq kp b kq mf jr ks kt mg ju kv kw mu ky kz la mv lc ld le mw lg lh li ij bi translated">这是一个快速的帖子，但它概述了我如何编写一个脚本来开始删除我超过一周的推文！</p><p id="4ace" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从这里开始，我设置了一个cron作业，每天午夜运行，以重新检查和删除任何其他推文。</p><p id="eeda" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我真的希望这能激励<em class="lj"/>(我不严格地使用这个术语)停止在Twitter上发帖，用它来消费。我对Twitter的下一步举措将是使用ML/AI在我的feed中添加一些过滤推文的东西。</p><h2 id="b8d0" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">资源和进一步阅读</h2><ol class=""><li id="8cb1" class="md me iq kp b kq mf kt mg kw mh la mi le mj li mk ml mm mn bi translated"><a class="ae mt" href="https://blog.dennisokeeffe.com/blog/2020-07-11-twitter-bot/" rel="noopener ugc nofollow" target="_blank">用JavaScript构建你的第一个Twitter机器人</a></li><li id="ed37" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated"><a class="ae mt" href="https://blog.dennisokeeffe.com/blog/2020-06-22-cdk-lambda-to-send-slack-message/" rel="noopener ugc nofollow" target="_blank">在cron作业期间使用AWS CDK调用Lambda函数</a></li><li id="cc35" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated"><a class="ae mt" href="https://github.com/ttezel/twit" rel="noopener ugc nofollow" target="_blank"> Twit — GitHub </a></li><li id="dd7c" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated"><a class="ae mt" href="https://github.com/a7ul/esbuild-node-tsc" rel="noopener ugc nofollow" target="_blank"> esbuild-node-tsc — GitHub </a></li><li id="be0b" class="md me iq kp b kq mo kt mp kw mq la mr le ms li mk ml mm mn bi translated"><a class="ae mt" href="https://github.com/iamkun/dayjs" rel="noopener ugc nofollow" target="_blank"> DayJS — GitHub </a></li></ol><p id="631e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">图片来源:</em> <a class="ae mt" href="https://unsplash.com/@stay_in_touch" rel="noopener ugc nofollow" target="_blank"> <em class="lj">帕特里克·帕金斯</em> </a></p><p id="1fdd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">原贴于我的</em> <a class="ae mt" href="https://blog.dennisokeeffe.com/blog/2020-10-05-self-destructing-tweets/" rel="noopener ugc nofollow" target="_blank"> <em class="lj">博客</em> </a> <em class="lj">。</em></p></div></div>    
</body>
</html>