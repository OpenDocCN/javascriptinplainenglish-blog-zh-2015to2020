<html>
<head>
<title>Serverless NestJS: Document your API with Swagger and AWS API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器NestJS:用Swagger和AWS API Gateway记录您的API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/serverless-nestjs-document-your-api-with-swagger-and-aws-api-gateway-64a53962e8a2?source=collection_archive---------0-----------------------#2020-07-14">https://javascript.plainenglish.io/serverless-nestjs-document-your-api-with-swagger-and-aws-api-gateway-64a53962e8a2?source=collection_archive---------0-----------------------#2020-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bc448b98f505b9da621efef170dea9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2aYB1HuLUSssn7jJv6rjFQ.png"/></div></div></figure><p id="56a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将文档添加到你的API中对于与你的团队或者你的客户分享它是非常重要的，有时候创建这个文档的过程需要花费很多时间，我们通常把它留到项目结束。</p><p id="3b33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我强烈建议在创建端点时编写API文档。</p><p id="f781" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">怎么会？昂首阔步。</p><h1 id="1eab" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">什么是霸气？</strong></h1><blockquote class="lu lv lw"><p id="9304" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">借助Swagger开源和专业工具集，为用户、团队和企业简化API开发。了解Swagger如何帮助您大规模设计和记录您的API。</p></blockquote><p id="a518" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mb" href="https://swagger.io" rel="noopener ugc nofollow" target="_blank"> https://swagger.io </a></p><p id="0d00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以Swagger使得编写API文档的过程更加容易。我们将与Swagger合作，在AWS的API网关中生成文档。</p><p id="3c08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我强烈建议您阅读我以前的文章，创建您的AWS帐户并部署您的无服务器应用程序以保持工作。</p><div class="mc md gp gr me mf"><a href="https://medium.com/javascript-in-plain-english/nestjs-serverless-app-with-mongodb-atlas-e8dec9ae7405" rel="noopener follow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">使用MongoDB Atlas的NestJS无服务器应用程序</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">无服务器是创建和部署应用程序的一种经济有效的方式</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">medium.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt jw mf"/></div></div></a></div><p id="a4f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将在NestJS中使用Swagger，所以这里是创建文档的文档。有如此多的装饰器可以用来记录我们的无服务器应用程序。</p><p id="5bce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一点很重要，因为当您创建一个NestJS无服务器应用程序时，与纯Javascript无服务器应用程序不同，sls deploy命令只创建1个端点/dev/{proxy+}，所以这是促使我创建这篇文章的原因，我们需要记录与我们的NestJS无服务器应用程序相关的所有端点。</p><div class="mc md gp gr me mf"><a href="https://docs.nestjs.com/openapi/introduction" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">文档| NestJS——一个渐进的Node.js框架</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">OpenAPI规范是一种语言无关的定义格式，用于描述RESTful APIs。Nest提供了一个…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">docs.nestjs.com</p></div></div><div class="mo l"><div class="mu l mq mr ms mo mt jw mf"/></div></div></a></div><h1 id="fc39" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">我们开始吧！</h1><p id="211c" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">首先，我们需要将swagger添加到我们的应用程序中，命令如下:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="11f0" class="nj kx iq nf b gy nk nl l nm nn">npm install @nestjs/swagger</span></pre><p id="8832" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以一旦你安装了swagger(你可以在你的package.json中检查它),我们需要记录我们的“/hello”端点:</p><p id="3b1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要进行一些进口，这里有一个例子:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/aa99fd72de40e2f9b366385bbef52b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*zft2JiniDRPtVVyoNtMIcw.png"/></div></figure><p id="b865" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在这里使用了一个装饰器“@ApiResponse()”，这个装饰器指示了我们的端点将使用GET给我们的不同响应。</p><p id="62ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还需要在main.ts文件中进行一些更改，以生成我们的api端点。(我们已经在上一篇文章中生成了这个文件)。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/93b91bf3305b0616d474e89c6c12d6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*-xIKmfgdpbqfyyXyA1_-sA.png"/></div></figure><p id="e2e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">神奇的是，我们需要添加这个“setupSwagger()”函数，这个函数为我们的API创建实例并完成所有工作。那么我们也需要修改我们的处理程序。基本上，我们将swagger-ui重定向到/api。这将完成查看我们的api的所有工作。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/fc28b1a21abb0067ff8c82d0bf85be20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*3tPs2VEZ-OXPfQ2GutD-5Q.png"/></div></figure><h1 id="6865" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">无服务器. yml</h1><p id="2faf" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">显然，我们还需要修改我们的serverles.yml文件，我们需要向我们的文件添加一个名为“custom”的新部分，通常这个部分用于添加一些环境变量名和运行我们的应用程序可能需要的其他配置。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="b2cd" class="nj kx iq nf b gy nk nl l nm nn">custom:</span><span id="3fc7" class="nj kx iq nf b gy nr nl l nm nn">    optimize:</span><span id="9201" class="nj kx iq nf b gy nr nl l nm nn">        external: ['swagger-ui-dist']</span></pre><p id="9fd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">小心点，缩进很重要，如果你在用Visual Studio编码，我强烈建议你使用更漂亮的插件。</p><p id="2afd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的文件应该如下所示:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/61f5cd190b735711610f92631b4b8646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*QIXuHkLP_0j7f7M7Ur4ELQ.png"/></div></figure><h1 id="ced2" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">让我们部署并测试</h1><p id="ead3" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">现在是重新部署应用程序和启动api的时候了。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="a46f" class="nj kx iq nf b gy nk nl l nm nn">sls deploy</span></pre><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/730b42b28c26550b9f31b90fc7916903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vQvKwNwF1-8cDKIb2IW6Ug.png"/></div></div></figure><p id="5acd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切如预期进行，您应该会看到您的应用程序端点。复制端点并用/api替换/{proxy+}。</p><p id="1f83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mb" href="https://YOUR-API.execute-api.us-east-1.amazonaws.com/dev/api" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">https://YOUR-API . execute-API . us-east-1 . amazona ws . com/dev/API</strong></a></p><p id="7e9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">干得好！这是您的NestJS无服务器API页面，您可以单击端点，查看响应，甚至尝试端点。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/5124c40841ee40f60da2442e900bad34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32ni0mqrNv1Z8iqEIi5_fA.png"/></div></div></figure><p id="ac63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">重要:如果你点击试用是行不通的，这很重要，因为我们正在dev上部署我们的api，所以端点应该是dev/hello。如果您想在dev上试用，您需要修改main.ts. </strong>中的event.path</p><h1 id="2851" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">在AWS API网关中生成API文档</h1><p id="18e8" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">我们终于到了！现在是时候在AWS API Gateway中生成我们的文档并与我们的队友或客户共享了。</p><p id="fa1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的技巧是，如果你去你的API端点，并在它的末尾添加“-json”，你将会收到你所有的在json中的API Swagger文档。</p><p id="0e8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">https://YOUR-API . execute-API . us-east-1 . amazonaws . com/dev/API-JSON</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/06bdc1fc9c9e03b40d37c0537f30f1ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zwXC50_G6tsScAC4Iz4j_A.png"/></div></div></figure><p id="1110" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，如果你复制了JSON，然后转到斯瓦格编辑器</p><div class="mc md gp gr me mf"><a href="https://editor.swagger.io" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">斯瓦格编辑</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">编辑描述</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">editor . swag . io</p></div></div></div></a></div><p id="f4a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">粘贴您的JSON您将从您的端点看到完全相同的页面，在这里您可以直接修改您的文档，但是我强烈建议在您的代码上这样做。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/8dde36cad0a3d8b0480e1eee4cb4d006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7uTKaAjx9gScYlCTpCbsA.png"/></div></div></figure><p id="9872" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里下载。”。yml "文件与您所有的应用编程接口文档。单击文件并下载。</p><h1 id="5602" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">AWS控制台</h1><p id="7398" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">最后，转到您的AWS控制台并在服务中搜索Amazon API Gateway，在这里您将看到您所有的API信息、端点，您可以更改配置、启用CORS策略，甚至为您的API启用一些授权者。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/32f3c3d2e0ab07b7c8f550344a633309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LWtCgPSKlI4idLfYtXxnlA.png"/></div></div></figure><p id="daa4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击文档。在这里，您可以为您的应用程序手动创建所有端点及其响应和所有细节。</p><p id="1935" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以这里的窍门是，点击导入文档，选择。您从斯瓦格编辑器下载的yml文件，然后导入它。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/eb133dfc016a6ff52e47b5b043e05c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6_TBLvZb3MzLv4Xw0IG4Fg.png"/></div></div></figure><p id="8d75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在发布文档，您准备好共享您的API文档了，您可以为您的API创建不同的阶段。您可以与您的客户或队友分享它作为斯瓦格，API网关，甚至邮差。</p><p id="af7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">甚至可以选择用您的文档生成SDK，所以这个AWS工具太棒了！</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/a47f422334374379d401fe78b62fc541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3JSb2wSte30zMt2Iy3HVww.png"/></div></div></figure><p id="d44a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以事情是这样的，你可以用NestJS和swag自动生成你的API文档，并使用你的JSON文件按照你的意愿编辑它，然后用API网关文档替换它，一旦你完成了，你可以简单地在你的main.ts文件中注释你的swag代码，并重新部署你的应用程序，或者如果你想在生产中部署你的swag-ui。</p><h1 id="0ea5" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="49c3" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">API文档对于您的客户和团队成员来说非常重要，您可以测试它，甚至可以随着应用程序的增长拥有不同版本的文档。</p><p id="e6fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">始终花时间阅读Swagger文档和建议来记录您的应用程序。</p><p id="1afc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这篇文章能帮助你以一种简单的方式用AWS记录你的API。</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="5863" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请随时联系我。</p><div class="mc md gp gr me mf"><a href="https://www.linkedin.com/in/carlos-villarroel-navarro/" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">Carlos feli PE Villarroel Navarro-IT经理- Rindegastos | LinkedIn</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">查看Carlos Felipe Villarroel Navarro在世界上最大的职业社区LinkedIn上的个人资料。卡洛斯·费利佩…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">www.linkedin.com</p></div></div><div class="mo l"><div class="og l mq mr ms mo mt jw mf"/></div></div></a></div></div></div>    
</body>
</html>