<html>
<head>
<title>Deploying a Node JS App to Azure App Service using Azure Dev-ops (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure Dev-ops将节点JS应用部署到Azure应用服务(第2部分)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deploying-node-js-app-using-azure-devops-part2-4567e4cf783b?source=collection_archive---------1-----------------------#2019-05-27">https://javascript.plainenglish.io/deploying-node-js-app-using-azure-devops-part2-4567e4cf783b?source=collection_archive---------1-----------------------#2019-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1410" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在azure DevOps发布管道中为节点JS应用程序创建和配置发布管道</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ea3f67ab052a21a40e4701cd4d45475e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-mtol_fDBXc8El5gd9x0A.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="kr ks l"/></div></figure><blockquote class="kt ku kv"><p id="6cfa" class="kw kx ky kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是两部分教程的第二篇，如果你还没有阅读第一部分，你可以在这里找到<a class="ae lt" href="https://medium.com/@ispeakcode/deploying-node-js-app-using-azure-devops-part1-74cb13a6bd02" rel="noopener"><em class="iq"/></a><em class="iq">。</em></p></blockquote><p id="f809" class="pw-post-body-paragraph kw kx iq kz b la lb jr lc ld le ju lf lu lh li lj lv ll lm ln lw lp lq lr ls ij bi translated">Azure Dev-Ops pipeline中的<strong class="kz ir">发布管道</strong>帮助您的团队<strong class="kz ir">以更快的速度和更低的风险向您的客户持续交付</strong>软件。您可以集成自动化测试场景和交付模块。如果您有不同的构建，如dev、staging和prod，并且您想要将它们发布到三个不同的env，那么您可以为多个构建管道拥有多个releaspipelines。在这个例子中，我们将不会经历测试场景，而仅仅是一个简单的发布管道，用于在构建完成后部署您的最新代码。</p><h2 id="3e08" class="lx ly iq bd lz ma mb dn mc md me dp mf lu mg mh mi lv mj mk ml lw mm mn mo mp bi translated">步骤5:创建发布管道</h2><p id="dbb1" class="pw-post-body-paragraph kw kx iq kz b la mq jr lc ld mr ju lf lu ms li lj lv mt lm ln lw mu lq lr ls ij bi translated">创建发布管道的第一步是打开“发布”选项卡，然后单击“新建管道”选项，这时系统会提示您发布类型的模板选择菜单。选择<code class="fe mv mw mx my b">Deploy a Node.js app to Azure App Service.</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/1425806c2b33efab9585130e11cc26eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StclFuyPquWl9fVGpGMIAQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Creating a release pipeline.</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/57ff6394b10df03269ec382f6e1e994a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hACSw54UdbdlVHg6bVLCGA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Adding a new stage.</figcaption></figure><h2 id="e4a0" class="lx ly iq bd lz ma mb dn mc md me dp mf lu mg mh mi lv mj mk ml lw mm mn mo mp bi translated">步骤6:添加工件</h2><p id="7ceb" class="pw-post-body-paragraph kw kx iq kz b la mq jr lc ld mr ju lf lu ms li lj lv mt lm ln lw mu lq lr ls ij bi translated">点击add an artifact并选择默认的源类型(build)。将自动选择您当前的项目。为此管道选择源版本(管道)。在这里，您将看到您之前创建的所有构建管道。一旦您选择了构建，就添加工件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/b6d870855aee6bae99f4695703cd864a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SWqyJizKg7gLkPId_GiXg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Adding an artifact.</figcaption></figure><h2 id="1e6b" class="lx ly iq bd lz ma mb dn mc md me dp mf lu mg mh mi lv mj mk ml lw mm mn mo mp bi translated">步骤5:启用CD</h2><p id="c758" class="pw-post-body-paragraph kw kx iq kz b la mq jr lc ld mr ju lf lu ms li lj lv mt lm ln lw mu lq lr ls ij bi translated">添加神器后，点击卡片上的闪电图标，启动持续部署触发。这将在每次新版本完成时创建一个新版本。您还可以为构建分支设置过滤器，但是如果您不需要它，就让它保持原样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/b8a799e73d29f2a39687d31ba5766f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1ENgXaPmVNmO7nzarZV8w.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Adding an artifact and set up continuous deployment</figcaption></figure><h2 id="b54a" class="lx ly iq bd lz ma mb dn mc md me dp mf lu mg mh mi lv mj mk ml lw mm mn mo mp bi translated">步骤7:发布任务</h2><p id="2e8e" class="pw-post-body-paragraph kw kx iq kz b la mq jr lc ld mr ju lf lu ms li lj lv mt lm ln lw mu lq lr ls ij bi translated">现在点击tasks标签来编辑你的发布任务。在此选择您的azure订阅(如果尚未选择)。现在选择您在Azure portal(第1部分)中创建的相同应用类型，您的应用服务名称将自动填充到最后一个下拉列表中。确保您选择了要部署您的版本的同一应用程序服务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/e747ea07ad8b3a459092fdbd86b7d9b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HFwIhdJaB49eTxTJCRUs9A.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Selecting the app service resource.</figcaption></figure><h2 id="b2a8" class="lx ly iq bd lz ma mb dn mc md me dp mf lu mg mh mi lv mj mk ml lw mm mn mo mp bi translated">步骤8:发布设置</h2><p id="57da" class="pw-post-body-paragraph kw kx iq kz b la mq jr lc ld mr ju lf lu ms li lj lv mt lm ln lw mu lq lr ls ij bi translated">在此步骤中，您必须提及发布文件夹的路径，该文件夹必须被推送到您的应用服务、节点版本和节点命令，以便在服务器部署后启动服务器。<br/>首先点击代理下的部署azure app服务任务，编辑<strong class="kz ir"> <em class="ky">包或文件夹字段</em> </strong>。默认路径是<code class="fe mv mw mx my b">$(System.DefaultWorkingDirectory)/&lt;<em class="ky">build pipiline name</em>&gt;/drop/&lt;<em class="ky">zip folder name</em>&gt;.</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/05815a9e98e718003082ecacef6cf098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTZaLqw3J-72jXZYe_8aVw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Release tasks</figcaption></figure><blockquote class="kt ku kv"><p id="08e5" class="kw kx ky kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当您打开“生成管道”部分时，生成管道名称将是您在左侧看到的管道名称，前面带有下划线。</p><p id="b134" class="kw kx ky kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">zip文件夹名称将与您在存档任务中输入的存档文件名相同。<strong class="kz ir">参考第1部分</strong>中的截图2.6。</p></blockquote><p id="ae79" class="pw-post-body-paragraph kw kx iq kz b la lb jr lc ld le ju lf lu lh li lj lv ll lm ln lw lp lq lr ls ij bi translated">现在在<strong class="kz ir"> <em class="ky">文件转换&amp;变量替换选项</em> </strong>字段中你必须确保启动你的节点JS服务器的命令是正确的。由于我们的应用服务类型是<strong class="kz ir"> windows，在本例中是</strong><strong class="kz ir">，</strong>，我们将使用IIS命令<code class="fe mv mw mx my b">-Handler iisnode -NodeStartFile index.js -appType node.</code></p><blockquote class="kt ku kv"><p id="cc34" class="kw kx ky kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这里index.js是您的Node JS应用程序的入口点，如果不同，请用您的入口点文件名替换它。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/95fbc3f5d2a2ce7d6fed93e6616b6784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FiroJUZhMOSyagzFNUZ7QQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk">Editing server start commands and application settings,</figcaption></figure><p id="dd14" class="pw-post-body-paragraph kw kx iq kz b la lb jr lc ld le ju lf lu lh li lj lv ll lm ln lw lp lq lr ls ij bi translated">最后一步是确保默认节点版本与您在创建azure app服务时指定的节点版本相匹配。这可以在<strong class="kz ir"> <em class="ky">应用和配置设置</em> </strong>下查看。</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="91da" class="pw-post-body-paragraph kw kx iq kz b la lb jr lc ld le ju lf lu lh li lj lv ll lm ln lw lp lq lr ls ij bi translated">就是这样，测试您的CI-CD流程，只需将一些内容推送到您的git repo中，然后等待一分钟，直到您的更改部署完毕。</p></div></div>    
</body>
</html>