<html>
<head>
<title>Use Angular Route-Guards to Secure Angular Pages — By allow, deny or redirect to other page-view.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular Route-guard保护Angular页面-通过允许、拒绝或重定向到其他页面视图。</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-angular-route-guards-to-secure-angular-pages-by-allow-deny-or-redirect-to-other-page-view-f2537583e9a?source=collection_archive---------0-----------------------#2019-12-28">https://javascript.plainenglish.io/use-angular-route-guards-to-secure-angular-pages-by-allow-deny-or-redirect-to-other-page-view-f2537583e9a?source=collection_archive---------0-----------------------#2019-12-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b8e6" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated"><strong class="ak">使用route-guard保护角页非常简单。</strong></h2></div><div class="kc kd gp gr ke kf"><a href="https://medium.com/codechintan/ionic-hide-header-on-scroll-b8828a7a7f86" rel="noopener follow" target="_blank"><div class="kg ab fo"><div class="kh ab ki cl cj kj"><h2 class="bd io gy z fp kk fr fs kl fu fw im bi translated">Ionic4隐藏滚动标题。</h2><div class="km l"><h3 class="bd b gy z fp kk fr fs kl fu fw dk translated">如何在Ionic框架中隐藏内容滚动的标题？</h3></div><div class="kn l"><p class="bd b dl z fp kk fr fs kl fu fw dk translated">medium.com</p></div></div><div class="ko l"><div class="kp l kq kr ks ko kt ku kf"/></div></div></a></div><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/9a9ca0eede80891dbe6aed5a64873d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S19TTgFzdUsOTm054y_PZQ.png"/></div></div></figure><p id="0551" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">路由防护是Angular路由器的一个重要功能，它基于某种逻辑，基于用户是否登录，允许或拒绝用户访问路由页面。</p><ul class=""><li id="20b1" class="mc md in li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated">ROUTE-guard在有登录/注销场景的web应用程序中非常重要。</li><li id="e0b4" class="mc md in li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated">它通常用于检查用户是否登录以及是否有权访问页面。</li><li id="4c09" class="mc md in li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated">我们可以很容易地管理哪些页面允许登录用户，哪些页面允许未登录用户。</li></ul><h2 id="42cb" class="mq mr in bd ms mt mu dn mv mw mx dp my lp mz na nb lt nc nd ne lx nf ng nh ni bi translated">实施路线守卫</h2><p id="3e2b" class="pw-post-body-paragraph lg lh in li b lj nj jo ll lm nk jr lo lp nl lr ls lt nm lv lw lx nn lz ma mb ig bi translated">我们可以通过实现<code class="fe no np nq nr b">@angular/router</code>包中可用的<code class="fe no np nq nr b"><a class="ae ns" href="https://angular.io/api/router/CanActivate" rel="noopener ugc nofollow" target="_blank">CanActivate</a></code>接口来添加一个路由守卫，并扩展保存允许或拒绝访问路由的逻辑的<code class="fe no np nq nr b">canActivate()</code>方法。</p><p id="3348" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">例如，下列警卫将检查<code class="fe no np nq nr b">userLoggedIn</code>的值，并相应地允许进入一条路线<strong class="li io"> : </strong> <br/> ( <code class="fe no np nq nr b">Don't worry about the code - we'll understand everything in detail.</code>)</p><pre class="kw kx ky kz gt nt nr nu nv aw nw bi"><span id="5069" class="mq mr in nr b gy nx ny l nz oa">class AuthGuardService implements <strong class="nr io">CanActivate</strong> {<br/>  userLoggedIn = false;</span><span id="5cda" class="mq mr in nr b gy ob ny l nz oa"><strong class="nr io">canActivate</strong>() {<br/>    if (this.userLoggedIn) {<br/>     return true;<br/>    } else {<br/>     return false;<br/>    }<br/>  }<br/>}</span></pre><p id="19e4" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们现在可以使用<code class="fe no np nq nr b">canActivate</code>属性保护一条路线:</p><pre class="kw kx ky kz gt nt nr nu nv aw nw bi"><span id="1653" class="mq mr in nr b gy nx ny l nz oa">const routes: Routes = [<br/>  {<br/>    path: 'user/:id', <br/>    component: UserDetailComponent,<br/>    <strong class="nr io">canActivate</strong>:[AuthGuardService] <br/>  }<br/>];</span></pre><p id="ff68" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">上面的代码是关于“<a class="ae ns" href="https://medium.com/@AnkitMaheshwariIn/routing-of-an-angular-component-angular-routing-2b7e53046542" rel="noopener">一个角度组件</a>的走线”。<br/> <a class="ae ns" href="https://medium.com/@AnkitMaheshwariIn/routing-of-an-angular-component-angular-routing-2b7e53046542" rel="noopener">点击此处👆</a>了解更多关于角度路由的信息。</p><p id="526f" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们可以<strong class="li io">将</strong>’<strong class="li io">Route Guards’应用到</strong> <strong class="li io">我们web应用程序的认证区域</strong>，或者需要特殊权限才能访问的管理部分。在下面的代码示例中，我们将看到一个非常简单的路由防护实现。</p><h1 id="0360" class="oc mr in bd ms od oe of mv og oh oi my jt oj ju nb jw ok jx ne jz ol ka nh om bi translated">创造守卫</h1><p id="106f" class="pw-post-body-paragraph lg lh in li b lj nj jo ll lm nk jr lo lp nl lr ls lt nm lv lw lx nn lz ma mb ig bi translated">我们将首先创建一个服务，但是要创建一个守卫，我们必须实现<code class="fe no np nq nr b">canActivate</code>。让我们创建一个<code class="fe no np nq nr b">AuthGuardService</code>,在您的终端/命令提示符下运行这个命令:</p><pre class="kw kx ky kz gt nt nr nu nv aw nw bi"><span id="44b5" class="mq mr in nr b gy nx ny l nz oa">ng g s service/AuthGuard</span></pre><p id="d4c5" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">这个命令将生成两个类型脚本文件——请看下面👇</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi on"><img src="../Images/4d5517ddf3e1b24b5936ebfa434aadf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yL2SC6cjZ2lFm69V.png"/></div></div></figure><h1 id="3e72" class="oc mr in bd ms od oe of mv og oh oi my jt oj ju nb jw ok jx ne jz ol ka nh om bi translated">#1创建AuthGuardService</h1><p id="6e44" class="pw-post-body-paragraph lg lh in li b lj nj jo ll lm nk jr lo lp nl lr ls lt nm lv lw lx nn lz ma mb ig bi translated">接下来，打开<code class="fe no np nq nr b">src/app/service/auth-guard.service.ts</code>文件，更新如下<strong class="li io"> : </strong>(我在这段代码中导入并使用了<code class="fe no np nq nr b">AuthService</code>👇👇要了解更多关于<code class="fe no np nq nr b">AuthService</code>的信息，请点击这里👆)</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="oo op l"/></div></figure><h1 id="d884" class="oc mr in bd ms od oe of mv og oh oi my jt oj ju nb jw ok jx ne jz ol ka nh om bi translated">#2注册AuthGuardService</h1><p id="ff73" class="pw-post-body-paragraph lg lh in li b lj nj jo ll lm nk jr lo lp nl lr ls lt nm lv lw lx nn lz ma mb ig bi translated">我们现在可以在角度路线定义中注册这个<code class="fe no np nq nr b">AuthGuardService</code>。打开<code class="fe no np nq nr b">src/app/app-routing.module.ts</code>文件，更新如下<strong class="li io"> : </strong>👇👇<br/>(相应地随意更改“路径”和“组件”的值)</p><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="oo op l"/></div></figure><blockquote class="oq"><p id="4dbd" class="or os in bd ot ou ov ow ox oy oz mb dk translated"><strong class="ak">注意:</strong>安全性在客户端没有意义。相反，我们使用路线警卫(或任何其他机制)都是UX的特点，因为我们防止用户进入一个他不被允许进入的区域。但是，最终的安全检查应该总是在服务器端完成。</p></blockquote><h1 id="be3f" class="oc mr in bd ms od oe of mv og oh oi my jt pa ju nb jw pb jx ne jz pc ka nh om bi translated">封锁是不够的</h1><p id="562f" class="pw-post-body-paragraph lg lh in li b lj nj jo ll lm nk jr lo lp nl lr ls lt nm lv lw lx nn lz ma mb ig bi translated">仅仅返回<code class="fe no np nq nr b">true</code>或者<code class="fe no np nq nr b">false</code>其实是不够的。我们需要告诉用户发生了什么，为什么他们不允许进入页面。或者通过显示一些通知，或者最常见的是通过<strong class="li io">重定向到一些其他页面视图</strong>。</p><p id="cade" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们可以通过<strong class="li io">将路由器注入</strong> <code class="fe no np nq nr b"><strong class="li io">AuthGuard</strong></code>并重定向到其他页面视图来实现。看这个:👇👇</p><h1 id="0b25" class="oc mr in bd ms od oe of mv og oh oi my jt oj ju nb jw ok jx ne jz ol ka nh om bi translated">#3修改AuthGuardService</h1><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="1b2b" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">(了解有关“可观察类型”和“管理Angular订阅”的更多信息，请点击此处👆)</p><ul class=""><li id="ada2" class="mc md in li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated">一旦我们将这个保护附加到一个路由上，<code class="fe no np nq nr b">canActivate()</code>方法将在路由被激活之前触发，这意味着在它打开实际的<code class="fe no np nq nr b">path</code>之前或者在它加载实际的<code class="fe no np nq nr b">component</code>之前。</li></ul><pre class="kw kx ky kz gt nt nr nu nv aw nw bi"><span id="ffb0" class="mq mr in nr b gy nx ny l nz oa">const routes: Routes = [<br/>  {<br/>    path: 'user/:id', <br/>    component: UserDetailComponent,<br/>    <strong class="nr io">canActivate</strong>:[AuthGuardService] <br/>  }<br/>];</span></pre><ul class=""><li id="9868" class="mc md in li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated">该逻辑将首先检查用户是否有效，如果无效，它将导航到登录路径。</li><li id="c49a" class="mc md in li b lj ml lm mm lp mn lt mo lx mp mb mh mi mj mk bi translated">注意，它还获取当前URL并将is设置为一个查询参数，因此它类似于<code class="fe no np nq nr b">/login?return=%2Fusers%2Fabc123</code>(URL被编码)。当我们试图像这样访问用户时就是这种情况:<code class="fe no np nq nr b">/users/abc123</code>和<code class="fe no np nq nr b">canActivate</code>检测到它是未授权用户。</li></ul></div><div class="ab cl pd pe hr pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ig ih ii ij ik"><h1 id="ed07" class="oc mr in bd ms od pk of mv og pl oi my jt pm ju nb jw pn jx ne jz po ka nh om bi translated">结论</h1><p id="3084" class="pw-post-body-paragraph lg lh in li b lj nj jo ll lm nk jr lo lp nl lr ls lt nm lv lw lx nn lz ma mb ig bi translated">#1)创建AuthGuardService <br/> #2)注册AuthGuardService <br/> #3)修改AuthGuardService</p></div><div class="ab cl pd pe hr pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ig ih ii ij ik"><blockquote class="oq"><p id="5af3" class="or os in bd ot ou pp pq pr ps pt mb dk translated">搞定了。🤩使用route-guard保护页面就是这么简单。再见👋👋</p><p id="c284" class="or os in bd ot ou pp pq pr ps pt mb dk translated">请在评论框中随意评论…如果我错过了什么，或者什么是不正确的，或者什么对你不起作用:)</p><p id="0cb9" class="or os in bd ot ou pp pq pr ps pt mb dk translated">更多文章敬请关注:<br/><a class="ae ns" href="https://medium.com/@AnkitMaheshwariIn" rel="noopener">https://medium.com/@AnkitMaheshwariIn</a></p></blockquote></div><div class="ab cl pd pe hr pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ig ih ii ij ik"><p id="1598" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi pu translated">如果你不介意给它一些掌声👏 👏既然有帮助，我会非常感谢:)帮助别人找到这篇文章，所以它可以帮助他们！</p><p id="1985" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">永远鼓掌…</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/2f4712882de180d90c9dcdb0cb91ae69.png" data-original-src="https://miro.medium.com/v2/resize:fit:156/1*ZyakciENSuUWo7tqu84tXQ.gif"/></div></figure></div><div class="ab cl pd pe hr pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ig ih ii ij ik"><p id="c33b" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated"><em class="qe">原载于2019年12月28日</em><a class="ae ns" href="https://www.codewithchintan.com/angular-route-guards/" rel="noopener ugc nofollow" target="_blank"><em class="qe">https://www.codewithchintan.com</em></a><em class="qe">。</em></p><h1 id="3f9d" class="oc mr in bd ms od oe of mv og oh oi my jt oj ju nb jw ok jx ne jz ol ka nh om bi translated">了解更多信息</h1><figure class="kw kx ky kz gt la"><div class="bz fp l di"><div class="qf op l"/></div></figure></div></div>    
</body>
</html>