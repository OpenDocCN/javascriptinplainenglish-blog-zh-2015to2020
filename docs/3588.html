<html>
<head>
<title>How To Call Data From The Strava API In Your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React应用程序中从Strava API调用数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/strava-api-react-app-326e63527e2c?source=collection_archive---------0-----------------------#2020-10-11">https://javascript.plainenglish.io/strava-api-react-app-326e63527e2c?source=collection_archive---------0-----------------------#2020-10-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/68978bb7db4725e87e1680a8295f734c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3Z3MlomquDlQJ4D-MPjhQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by<a class="ae jz" href="https://unsplash.com/photos/CVvFVQ_-oUg" rel="noopener ugc nofollow" target="_blank"> Jeremy Lapak</a></figcaption></figure><p id="7b16" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每年九月或十月的某个时候，人们抖掉跑鞋上的灰尘，开始为第二年早春的马拉松比赛进行训练。</p><p id="6d79" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">训练需要几个月的时间，所以一个好的计划是必要的。跑得太快会有受伤的风险，跑得太慢会让你没有足够的里程在比赛当天跑完26.2英里。</p><p id="0427" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让你保持在正确轨道上的最好工具之一是一个好的跑步应用程序。我使用<a class="ae jz" href="https://www.strava.com/" rel="noopener ugc nofollow" target="_blank"> Strava </a>，因为它可以跟踪数据，包括距离、速度、心率、个人最佳时间等等。它也是一个社交应用程序，所以支持你的朋友，分享活动和公共挑战是核心功能。</p><p id="8713" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我正在开发一个project/React应用程序，以替换和升级我目前在谷歌文档中创建的培训系统。在新版本中，我想导入我的锻炼信息，这样我就可以在一个地方看到我的进展和见解。幸运的是，<strong class="kc io"> Strava有一个开放的、受支持的API。</strong></p><p id="1063" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本指南将带您了解如何将您的个人锻炼数据从Strava访问到您的JavaScript项目中。</p><p id="40f5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">在这里</em>  <em class="ky">找到Strava API文档</em> <a class="ae jz" href="https://developers.strava.com/docs/reference/" rel="noopener ugc nofollow" target="_blank"> <em class="ky">。本文根据Strava的</em> </a><a class="ae jz" href="https://developers.strava.com/docs/getting-started/" rel="noopener ugc nofollow" target="_blank"> <em class="ky">入门指南</em> </a> <em class="ky">以及Franchyze923的这个</em> <a class="ae jz" href="https://www.youtube.com/watch?v=sgscChKfGyg" rel="noopener ugc nofollow" target="_blank"> <em class="ky">视频系列</em> </a> <em class="ky">。</em></p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h1 id="3da7" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">概观</h1><ul class=""><li id="9c53" class="me mf in kc b kd mg kh mh kl mi kp mj kt mk kx ml mm mn mo bi translated"><strong class="kc io">创建或登录您的Strava账户</strong></li><li id="b6f2" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">在你的Strava账户中设置一个新应用</strong></li><li id="2459" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">关于范围</strong></li><li id="7806" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">使用Swagger测试您的端点</strong></li><li id="0c84" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">创建授权令牌</strong></li><li id="6b1c" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">获取您的访问令牌和刷新令牌</strong></li><li id="b068" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated">从React应用程序中调用Strava API。</li></ul></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="4035" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated">创建或登录您的Strava帐户</h2><p id="5ed6" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">点击<a class="ae jz" href="https://www.strava.com" rel="noopener ugc nofollow" target="_blank">此处</a>登录或创建Strava账户。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="9f9a" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated">在您的Strava帐户中设置一个新应用程序</h2><p id="4af0" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">登录后，导航至<a class="ae jz" href="https://www.strava.com/settings/api" rel="noopener ugc nofollow" target="_blank">https://www.strava.com/settings/api</a>。你必须第一次在浏览器中手动输入地址，但之后，你可以通过点击<code class="fe nj nk nl nm b">settings</code>通过Stava网站导航到那里。</p><p id="0179" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最好将此页面<strong class="kc io">设为书签</strong>或在标签中保持打开状态。在本教程中，您将经常访问它。</p><p id="8444" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">填写以下信息:</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/67b398b69e4685a19234ae06b022c46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5FS4UQQa2QRhWtpzbEuaQ.png"/></div></div></figure><ul class=""><li id="d56a" class="me mf in kc b kd ke kh ki kl ns kp nt kt nu kx ml mm mn mo bi translated"><strong class="kc io">应用名称:</strong>您可以随意命名。</li><li id="e270" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">类别:</strong>我正在制定一个马拉松的计划日程，所以我选择了“训练”。</li><li id="46a6" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">俱乐部:</strong>如果您是俱乐部的成员，您可以选择俱乐部，否则本字段为空。</li><li id="677d" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">网站:</strong>您正在创建的网站的网址。如果没有，只需放<code class="fe nj nk nl nm b"><a class="ae jz" href="https://www.strava.sampleapp.com." rel="noopener ugc nofollow" target="_blank">https://www.strava.sampleapp.com</a></code> <a class="ae jz" href="https://www.strava.sampleapp.com." rel="noopener ugc nofollow" target="_blank">。</a></li><li id="8f68" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">应用描述:</strong>描述应用操作的可选字段。</li><li id="2f7d" class="me mf in kc b kd mp kh mq kl mr kp ms kt mt kx ml mm mn mo bi translated"><strong class="kc io">授权回拨域:</strong>现在进入<code class="fe nj nk nl nm b">localhost</code>。这允许在开发模式下访问API。在<a class="ae jz" href="https://developers.strava.com/playground/" rel="noopener ugc nofollow" target="_blank">swage</a>中测试端点时，将此字段更新为<code class="fe nj nk nl nm b">developers.strava.com</code>(稍后会有更多相关内容)，并在应用部署后将其更新为您所在域的<strong class="kc io">。</strong></li></ul><p id="69fb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">填写完字段后，选中表示您已阅读并同意Strava的API协议的复选框。</p><p id="91e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击<code class="fe nj nk nl nm b">Create</code>。</p><p id="ae9c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">系统将提示您添加应用程序图标。您可以随时更改，现在请随意使用占位符。上传并保存。</p><p id="3785" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该看到类似以下内容:</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/bfa4e44dbc29959334ebc4df6faa356b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ClhIlYuqjo_P9iakUfT3sw.png"/></div></div></figure><p id="f473" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">向上滚动。</strong>您现已掌握以下信息:</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/4b540f8918b22752633e095a907ef352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4ysSFvSYd09C0JUD77Wmw.png"/></div></div></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="b0ce" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated"><strong class="ak">关于范围</strong></h2><p id="9175" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated"><strong class="kc io">Strava API中的</strong>作用域代表了您读取或更改用户数据所需的不同访问级别。</p><p id="cc5b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为一个第三方应用程序的开发者，我们决定我们将要求Strava为特定用户授予什么权限。问自己需要什么是一种好的做法；不多不少。</p><p id="a925" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Strava通过身份验证过程告诉用户第三方应用程序请求什么权限，并允许用户授予或拒绝该访问权限。</p><p id="d740" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这种情况下，我们既是开发人员又是用户，所以这应该是一项容易的任务。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/68fd8f7014e4e6351233fe980671c260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/1*SbIUi5gXRyQnSzWRB2WMhw.gif"/></div></figure><p id="ad52" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当您在Strava设置中设置新的应用程序时，上面列出的<code class="fe nj nk nl nm b">Access Token</code>和<code class="fe nj nk nl nm b">Refresh Token</code>将适用于一种类型的范围<code class="fe nj nk nl nm b">read</code>。</p><p id="73dd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据您想要的信息，这可能不够访问。查看下图，了解每个<strong class="kc io">范围</strong>选项允许多少访问权限。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/41cbdbad07476a586bab03f4230d9996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a9-TPYnnTxD1rU9Mw6tfSQ.png"/></div></div></figure><p id="cd52" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想访问我的所有活动，包括那些设置为private的活动，所以我将使用<code class="fe nj nk nl nm b">activity:read_all</code>范围。这将给予我的<code class="fe nj nk nl nm b">Refresh Token</code>和<code class="fe nj nk nl nm b">Access Token</code>正确的访问权限。</p><p id="a29a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在下一步中，我们将预览数据返回时的样子，并确认访问该数据需要什么范围。</p><p id="1321" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">您可以随意使用任何您想要的端点，但是如果您这样做的话，请记住在本指南的其余部分中交换它和它的作用域。</em></p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="74b3" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated">大摇大摆地测试您的端点</h2><p id="9de7" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">Swagger 是Strava提供的一个工具，可以让你熟悉他们的API。它显示了基于您调用的端点以及访问这些端点所需的范围的响应。</p><p id="e953" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了让Swagger工具工作，请返回到您的<a class="ae jz" href="https://www.strava.com/settings/api" rel="noopener ugc nofollow" target="_blank"> Strava帐户</a>的设置部分。在<code class="fe nj nk nl nm b">Authorization Callback Domain</code>栏中，将<code class="fe nj nk nl nm b">localhost</code>替换为<code class="fe nj nk nl nm b">developers.strava.com</code>。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/cd1426b053f8dbf3c32beb3a4058384f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_id7HnnTSRWiH_Up3zFMA.png"/></div></div></figure><p id="04cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击<code class="fe nj nk nl nm b">Update</code>。</p><p id="350c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请记住保持此页面打开，您将在接下来的步骤中大量使用<code class="fe nj nk nl nm b">Client ID</code>和<code class="fe nj nk nl nm b">Client Secret</code>。(点击<code class="fe nj nk nl nm b">Client Secret</code>旁边的<code class="fe nj nk nl nm b">show</code>显示信息)。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="7e44" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">导航至<code class="fe nj nk nl nm b"><a class="ae jz" href="https://developers.strava.com/playground" rel="noopener ugc nofollow" target="_blank">Swagger</a></code>。向下滚动页面时，您将看到所有可用的端点。单击一个端点将显示访问数据所需的范围，以及每条路由的参数。</p><p id="98d2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为Swagger将向我们返回真实的信息，所以我们需要授权它调用API。</p><p id="efef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将使用<code class="fe nj nk nl nm b">get</code>路线，<code class="fe nj nk nl nm b">/athlete/activities</code>终点。单击该行。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/97dcf6de6798a3636b522b8bd7794412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyHDTZ12WfAjgQq62yvxbA.png"/></div></div></figure><p id="bd02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第一行将描述您需要在什么范围内访问这些信息。该端点要求<code class="fe nj nk nl nm b">activity:read</code>仅返回公共信息，或者<code class="fe nj nk nl nm b">activity:read_all</code>返回所有信息。</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="dcb6" class="mu lh in nm b gy of og l oh oi">Returns the activities of an athlete for a specific identifier. Requires activity:read. Only Me activities will be filtered out unless requested by a token with activity:read_all.</span></pre><p id="995d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如我之前提到的，我希望包括活动在内的所有数据都设置为private，所以我将选择<code class="fe nj nk nl nm b">activity:read_all</code>。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="a86e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，滚动回页面顶部，点击绿色按钮<code class="fe nj nk nl nm b">Authorize</code>。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oj"><img src="../Images/1b364885bea4750295d5b5c0c609485f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPbQySq6H0laRqLnXphgCQ.png"/></div></div></figure><p id="dd88" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在相应字段中输入您的<a class="ae jz" href="https://www.strava.com/settings/api" rel="noopener ugc nofollow" target="_blank"> Strava账户</a>的<code class="fe nj nk nl nm b">Client ID</code>和<code class="fe nj nk nl nm b">Client Secret</code>。</p><p id="a5df" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">选择您计划使用的终点中所列的<em class="ky"> </em>范围。这个项目我选择了<code class="fe nj nk nl nm b">activity:read_all</code>。</p><p id="7eca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">注意，这个工具中有一个已知的错误，它只允许你一次测试一个范围。</strong></p><figure class="no np nq nr gt jo gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/362128cf8eb3bad992f4ca1db2aafcb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*W8gsrUkbX2e74bd-CjnHnQ.png"/></div></figure><p id="092b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">向下滚动，点击<code class="fe nj nk nl nm b">Authorize</code>。</p><p id="a466" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您会被重定向到OAuth2页面，在那里您会再次点击<code class="fe nj nk nl nm b">Authorize</code>。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ol"><img src="../Images/bcd99428b7c6d5f72c30d1701002d34d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71Wq84mERuV6ogr-J2HX_Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">The app information you entered in Stava including the picture shows up here.</figcaption></figure><p id="1a8b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">授权后，您将被重定向回斯瓦格。点击弹出屏幕上的<code class="fe nj nk nl nm b">close</code>。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/d4e6564556ab8850ee3f917f36b0811b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQyLD9lXPSnTcGYAreE9fw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">You did it! Now click “Close”</figcaption></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="e20b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，向下滚动到<code class="fe nj nk nl nm b">/athlete/activites</code>并展开。点击<code class="fe nj nk nl nm b">Try it out</code>。</p><p id="efa0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击大<code class="fe nj nk nl nm b">Execute</code>按钮。</p><p id="fd9c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">向下滚动，查看回复！这就是数据返回给您时的样子。</p><figure class="no np nq nr gt jo"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">This is ONE activity returned… look at all that info!!</figcaption></figure><p id="432d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以随意更改参数或检查其他端点，以决定您希望返回的确切数据。请记住，如果您查看需要不同范围的端点，您将需要使用swag重新授权，并且一次只能查看一个范围。</p><ul class=""><li id="7cb5" class="me mf in kc b kd ke kh ki kl ns kp nt kt nu kx ml mm mn mo bi translated"><em class="ky"> **如果您看到返回了一个空白数组，则表示您在所选时间范围内没有记录任何活动。对通话正常感到放心，但请记录一项活动(或更改参数以捕获记录的活动)，以便您可以查看数据！*** </em></li></ul></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="d2e1" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated">中断</h2><p id="dcb3" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">我不知道你怎么样，但是我需要休息一下。也许某个凯特·勒·邦是合适的:</p><figure class="no np nq nr gt jo"><div class="bz fp l di"><div class="op oo l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Open only if avant-grade in a welch accent sounds good to you.</figcaption></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="2918" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated">创建授权令牌</h2><p id="af85" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">我们需要一个<code class="fe nj nk nl nm b">Authorization Token</code>来请求一个<code class="fe nj nk nl nm b">Access Token</code>和<code class="fe nj nk nl nm b">Refresh Token</code>。</p><p id="d5be" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将您的信息粘贴到以下URL中(注意:为了清楚起见，添加了换行符):</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="df50" class="mu lh in nm b gy of og l oh oi"><a class="ae jz" href="http://www.strava.com/oauth/authorize?" rel="noopener ugc nofollow" target="_blank">http://www.strava.com/oauth/authorize</a>?</span><span id="fb27" class="mu lh in nm b gy oq og l oh oi">client_id=[CLIENT_ID]</span><span id="cd4f" class="mu lh in nm b gy oq og l oh oi">&amp;response_type=code</span><span id="4f21" class="mu lh in nm b gy oq og l oh oi">&amp;redirect_uri=http://localhost/exchange_token&amp;approval_prompt=force</span><span id="0178" class="mu lh in nm b gy oq og l oh oi">&amp;scope=[YOUR_SELECTED_SCOPE]</span></pre><p id="e08b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是添加“我的信息”并删除换行符后的情况:</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="07ee" class="mu lh in nm b gy of og l oh oi">http://www.strava.com/oauth/authorize?client_id=54753&amp;response_type=code&amp;redirect_uri=http://localhost/exchange_token&amp;approval_prompt=force&amp;scope=activity:read_all</span></pre><p id="f990" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">导航到您刚刚创建的网址。点击<code class="fe nj nk nl nm b">Authorize</code>。</p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi or"><img src="../Images/a1a57e15bf452a5970fdf97711860839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHYUpurjdzUU6U0-mZOqKA.png"/></div></div></figure><p id="936a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将被重定向到无法打开的页面。<strong class="kc io">果然如此！！</strong></p><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi os"><img src="../Images/3ff4ea31ad861a039a05791808276ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKe2rAn8rvKA4e7pKQmsAw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Don’t fret, we expected this.</figcaption></figure><p id="1fc6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">复制页面的网址。它看起来像这样:</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="d686" class="mu lh in nm b gy of og l oh oi"><a class="ae jz" href="http://localhost/exchange_token?state=&amp;code=b29e1998446705436f2a2952b21eeb8f76c070c9&amp;scope=read,activity:read_all" rel="noopener ugc nofollow" target="_blank">http://localhost/exchange_token?state=&amp;code=b29e1998446705436f2a2952b21eeb8f76c070c9&amp;scope=read,activity:read_all</a></span></pre><p id="ec6e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为清晰起见，增加了换行符:</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="fb90" class="mu lh in nm b gy of og l oh oi"><a class="ae jz" href="http://localhost/exchange_token?state=&amp;code=c0cd3f07f70d3dcfe20c86a69bf3b5b42b80d8e4&amp;scope=read,activity:read_all" rel="noopener ugc nofollow" target="_blank">http://localhost/exchange_token?state=</a></span><span id="15da" class="mu lh in nm b gy oq og l oh oi"><a class="ae jz" href="http://localhost/exchange_token?state=&amp;code=c0cd3f07f70d3dcfe20c86a69bf3b5b42b80d8e4&amp;scope=read,activity:read_all" rel="noopener ugc nofollow" target="_blank">&amp;code=</a><a class="ae jz" href="http://localhost/exchange_token?state=&amp;code=b29e1998446705436f2a2952b21eeb8f76c070c9&amp;scope=read,activity:read_all" rel="noopener ugc nofollow" target="_blank">b29e1998446705436f2a2952b21eeb8f76c070c9</a></span><span id="557a" class="mu lh in nm b gy oq og l oh oi"><a class="ae jz" href="http://localhost/exchange_token?state=&amp;code=c0cd3f07f70d3dcfe20c86a69bf3b5b42b80d8e4&amp;scope=read,activity:read_all" rel="noopener ugc nofollow" target="_blank">&amp;scope=read,activity:read_all</a></span></pre><p id="b9ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第二行是您的<code class="fe nj nk nl nm b">authorization code</code>。复制<code class="fe nj nk nl nm b">&amp;code=</code>之后的所有内容，此时为<code class="fe nj nk nl nm b">b29e1998446705436f2a2952b21eeb8f76c070c9</code>。</p><p id="83d6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将使用这个<code class="fe nj nk nl nm b">authorization code</code>来请求我们的<code class="fe nj nk nl nm b">Refresh Token</code>和<code class="fe nj nk nl nm b">Access Token</code>。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="9f00" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated"><strong class="ak">获取您的访问令牌和刷新令牌</strong></h2><p id="0583" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">将您的信息输入以下URL(为清晰起见，添加了分隔符):</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="a993" class="mu lh in nm b gy of og l oh oi"><a class="ae jz" href="https://www.strava.com/oauth/token?" rel="noopener ugc nofollow" target="_blank">https://www.strava.com/oauth/token?</a><br/>client_id=[YOUR_CLIENT_ID]<br/>&amp;client_secret=[YOUR_CLIENT_SECRET]<br/>&amp;code=[AUTHORIZATION_CODE]<br/>&amp;grant_type=authorization_code</span></pre><p id="1677" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我输入的信息和删除的中断:</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="140e" class="mu lh in nm b gy of og l oh oi"><a class="ae jz" href="https://www.strava.com/oauth/token?" rel="noopener ugc nofollow" target="_blank">https://www.strava.com/oauth/token</a>?client_id=<!-- -->54753<!-- -->&amp;client_secret=<!-- -->6308cc42367f364b3e1c29ede9434d1b92e9b06c<!-- -->&amp;code=<a class="ae jz" href="http://localhost/exchange_token?state=&amp;code=b29e1998446705436f2a2952b21eeb8f76c070c9&amp;scope=read,activity:read_all" rel="noopener ugc nofollow" target="_blank">b29e1998446705436f2a2952b21eeb8f76c070c9</a>&amp;grant_type=authorization_code</span></pre><p id="58b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开您的终端，用您刚才创建的URL代替<code class="fe nj nk nl nm b">[URL]</code>，键入以下cURL POST请求:</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="292f" class="mu lh in nm b gy of og l oh oi">curl -X POST [URL]</span></pre><p id="e8fe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我的看起来像这样:</p><pre class="no np nq nr gt ob nm oc od aw oe bi"><span id="8c0a" class="mu lh in nm b gy of og l oh oi">curl -X POST https://www.strava.com/oauth/token\?client_id\=54753\&amp;client_secret\=6308cc42367f364b3e1c29ede9434d1b92e9b06c\&amp;code\=b29e1998446705436f2a2952b21eeb8f76c070c9\&amp;grant_type\=authorization_code</span></pre><p id="0fd9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了清楚起见，下面是带有换行符的返回结果:</p><figure class="no np nq nr gt jo"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="fcec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">复制<code class="fe nj nk nl nm b">Refresh Token</code>，我们将在React应用中使用它。</p><p id="6316" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">一个</em> <code class="fe nj nk nl nm b"><em class="ky">Access Token</em></code> <em class="ky">有效期只有6小时。我们使用</em> <code class="fe nj nk nl nm b"><em class="ky">Refresh Token</em></code> <em class="ky">请求一个新的。据我所知，</em> <code class="fe nj nk nl nm b"><em class="ky">Refresh Token</em></code> <em class="ky">并没有过期。</em></p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="21f7" class="mu lh in bd li mv mw dn lm mx my dp lq kl mz na lu kp nb nc ly kt nd ne mc nf bi translated"><strong class="ak">从React调用Strava API</strong></h2><p id="f90f" class="pw-post-body-paragraph ka kb in kc b kd mg kf kg kh mh kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx ig bi translated">我们在最后冲刺阶段！</p><p id="b68e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，回到您的Strava设置，将<code class="fe nj nk nl nm b">Authorization Callback Domain</code>字段改回<code class="fe nj nk nl nm b">localhost</code>。</p><p id="e07e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开react应用程序，导航到呈现DOM的组件。对于这个例子，我将使用App.js。</p><figure class="no np nq nr gt jo"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">I’ve added some styling not shown here for the demonstration</figcaption></figure><p id="401d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第1行:用钩子<code class="fe nj nk nl nm b">useState</code>和<code class="fe nj nk nl nm b">useEffect</code>导入React。</p><p id="5e67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第4–5行:为一个<code class="fe nj nk nl nm b">loading</code>布尔值设置状态，并保存我们收到的所有数据。</p><p id="5aa8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">12–13:设置一个变量来保存我们的<code class="fe nj nk nl nm b">Refresh Token</code>和发送当前<code class="fe nj nk nl nm b">Access Token</code>请求的URL。</p><p id="fc5a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">16:为请求活动的URL设置变量。</p><p id="82c8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">19–25:当页面加载时，<code class="fe nj nk nl nm b">useEffect</code>将请求当前的<code class="fe nj nk nl nm b">Access Token</code>。一旦令牌被检索到，它就把它传递给一个名为<code class="fe nj nk nl nm b">getActivities</code>的函数。</p><p id="dace" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">28–34:<code class="fe nj nk nl nm b">getActivites</code>使用从<code class="fe nj nk nl nm b">useEffect</code>传递的当前访问代码获取活动。它将结果设置为状态，将我们的布尔加载从<code class="fe nj nk nl nm b">true</code>切换到<code class="fe nj nk nl nm b">false</code>，或者显示任何出现的错误。</p><p id="fbbf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">36–42:创建功能<code class="fe nj nk nl nm b">showActivities</code>。如果我们的加载布尔值是<code class="fe nj nk nl nm b">true</code>，它将返回<code class="fe nj nk nl nm b">LOADING</code>。如果为false，它会将我们的活动状态打印到控制台，并将活动总数显示到DOM。</p><p id="737c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">44–49:返回一个调用我们的<code class="fe nj nk nl nm b">showActivities</code>函数的<code class="fe nj nk nl nm b">&lt;div&gt;</code>,这个函数将决定在DOM上显示什么。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><figure class="no np nq nr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ot"><img src="../Images/218191925e496d2d8cb2a7bc94cbce9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-JvHMnQtNYRyicoAFbmxSQ.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">You did it!</figcaption></figure><p id="b231" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">恭喜你。！您已经成功地从React应用程序调用了Strava API。</p><p id="428b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在你部署好你的应用程序后，不要忘记返回到你的Strava设置中，将<code class="fe nj nk nl nm b">Authorization Callback Domain</code>字段更改为<strong class="kc io">你的域名</strong>。</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="5bea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">感谢Franchyze923，他有我能找到的唯一一个关于这个主题的视频教程</em>  <em class="ky">。</em></p><p id="5b7b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">看看我的其他一些故事；</em> <a class="ae jz" href="https://medium.com/javascript-in-plain-english/email-from-your-react-project-w-emailjs-d6af68fa5c17" rel="noopener"> <em class="ky">用EmailJS </em> </a> <em class="ky">，</em> <a class="ae jz" href="https://medium.com/swlh/css-reset-2b4831d4664e" rel="noopener"> <em class="ky"> CSS重置</em> </a> <em class="ky">，或者</em> <a class="ae jz" href="https://medium.com/javascript-in-plain-english/recoil-js-simple-global-state-d84100b3d535?source=your_stories_page-------------------------------------" rel="noopener"> <em class="ky">反冲. js &amp;简单全局状态</em> </a> <em class="ky">。</em></p><p id="133f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">疑问？评论？顾虑？在joshuagauthreaux@gmail.com或通过</em><a class="ae jz" href="https://www.joshgotro.com/" rel="noopener ugc nofollow" target="_blank"><em class="ky">joshgotro.com</em></a><em class="ky">与我联系。</em></p><p id="1a87" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">感谢您的阅读，祝您身体健康！</strong></p></div></div>    
</body>
</html>