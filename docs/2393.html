<html>
<head>
<title>Still saving timestamps with MongoDB?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">还在用MongoDB保存时间戳？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/still-saving-timestamps-with-mongodb-df4f70b4556f?source=collection_archive---------4-----------------------#2020-06-20">https://javascript.plainenglish.io/still-saving-timestamps-with-mongodb-df4f70b4556f?source=collection_archive---------4-----------------------#2020-06-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4193" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">解密MongoDB的id</h2></div><p id="8b81" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我经常看到与后端应用程序开发人员一起工作的一件事是他们对保存时间戳的痴迷。我知道保存时间戳、标记创建和更新在几种情况下是不可避免的，从调试和日志记录，到根据对象或实体第一次创建的时间对其进行排序。然而，如果您使用的是MongoDB，您并不需要显式地节省创建时间。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/c143d0c9a08bb7d97fcd94ff1d30d7cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*QddvsTuaQbiOYqhPlPlrYA.gif"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">source: giphy</figcaption></figure><h1 id="4b29" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">放弃“createdAt”</h1><p id="7d49" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">大多数JavaScript开发人员都熟悉MongoDB。当您与JavaScript/NodeJS开发人员一起工作时，它通常是goto数据库。众所周知，MongoDB的<code class="fe mh mi mj mk b">_id</code>属性可以用来惟一地标识我们的文档。但是,<code class="fe mh mi mj mk b">_id</code>属性也可以用来获取文档的创建时间。</p><p id="83d8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">看起来像随机字符集合的<code class="fe mh mi mj mk b">_id</code>并不完全随机。<code class="fe mh mi mj mk b">_id</code>存储为12字节长的值，其中4字节代表对象创建的时间戳，5字节为随机字符，其余3字节用作从随机值开始自动递增的计数器。</p><p id="34db" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">时间戳是这篇文章的主题。它以纪元的形式表示。有一个方便的API允许我们访问这个时间戳。我们一会儿就会看到这一点。</p><p id="15a6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将字节分成时间戳、随机字符和自动递增计数器，这使得MongoDB成为寻求开发分布式系统的人们的普遍选择。这种分离消除了数据库id冲突的风险。当一个id代表多个行/文档时，会发生数据库id冲突。打个比方，这就像两个人有相同的社会安全号码或联系号码。</p><h1 id="3899" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">从_id获取时间</h1><p id="68aa" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">要从<code class="fe mh mi mj mk b">_id</code>属性中提取时间戳，第一步是安装节点。节点安装程序可以在<a class="ae ml" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><p id="4fde" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设您已经启动并运行了Node，您将需要下载一个名为<code class="fe mh mi mj mk b">mongodb</code>的依赖项</p><p id="4c44" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mh mi mj mk b">mongodb</code>包是官方的MongoDB驱动程序，允许您的JavaScript代码与MongoDB数据库通信。但是，出于本演练的目的，您不需要安装MongoDB。mongodb驱动程序足以涵盖本文的范围。该软件包可以在<a class="ae ml" href="https://www.npmjs.com/package/mongodb" rel="noopener ugc nofollow" target="_blank">这里</a>找到，并且可以使用</p><pre class="kz la lb lc gt mm mk mn mo aw mp bi"><span id="06c1" class="mq ll in mk b gy mr ms l mt mu">npm install mongodb</span></pre><p id="adb5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">安装包后，创建一个JavaScript文件。从导入mongodb开始。</p><pre class="kz la lb lc gt mm mk mn mo aw mp bi"><span id="cca1" class="mq ll in mk b gy mr ms l mt mu">const mongodb = require('mongodb');</span></pre><p id="334c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们从导入的mongodb中拉出<code class="fe mh mi mj mk b">ObjectID</code>。请注意ObjectID中的大写“O”和“ID”。</p><pre class="kz la lb lc gt mm mk mn mo aw mp bi"><span id="57bd" class="mq ll in mk b gy mr ms l mt mu">const myObject = mongodb.ObjectID;</span></pre><p id="6f00" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">myObject现在可以使用new关键字创建对象id的实例。</p><pre class="kz la lb lc gt mm mk mn mo aw mp bi"><span id="6cb8" class="mq ll in mk b gy mr ms l mt mu">const object = new myObject();</span></pre><p id="5049" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，您需要在创建的实例上调用函数<code class="fe mh mi mj mk b">getTimestamp</code>。</p><pre class="kz la lb lc gt mm mk mn mo aw mp bi"><span id="eee1" class="mq ll in mk b gy mr ms l mt mu">const timestamp = object.getTimestamp()</span></pre><p id="7e85" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以根据需要进一步格式化时间戳。例如，以小时和分钟的形式显示时间，</p><pre class="kz la lb lc gt mm mk mn mo aw mp bi"><span id="81fb" class="mq ll in mk b gy mr ms l mt mu">let hours = timestamp.getHours()<br/>let minutes = timestamp.getMinutes();<br/>console.log("Object created at - "+hours+":"+minutes);</span></pre><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3c87597121e96165990b8fe9d017d134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*3xC5KWvcvRKt9vpdaDriYg.png"/></div></figure><p id="54fa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">带有对象分解的完整代码可以在下面找到。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk">Getting timestamp from MongoDB’s GUID</figcaption></figure><p id="64eb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这篇文章的相关文档和基础可以在<a class="ae ml" href="https://docs.mongodb.com/manual/reference/method/ObjectId/" rel="noopener ugc nofollow" target="_blank">这里</a>获得。尽管这消除了存储创建日期和时间的需要，但您可能仍然需要存储更新时间戳。</p><h2 id="996b" class="mq ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="c1ec" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae ml" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io">订阅我们的YouTube频道</strong> </a> <strong class="ke io">获取更多类似内容！</strong></p></div></div>    
</body>
</html>