<html>
<head>
<title>Removing Moment.js locales from your Angular app JS bundles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Angular app JS软件包中移除Moment.js语言环境</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/removing-moment-js-locales-from-your-angular-app-js-bundles-2abfec434109?source=collection_archive---------0-----------------------#2020-07-12">https://javascript.plainenglish.io/removing-moment-js-locales-from-your-angular-app-js-bundles-2abfec434109?source=collection_archive---------0-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="57ff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">您的捆绑包大小超出了分配的预算或接近预算？<a class="ae kf" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> Moment.js </a>可能是罪魁祸首之一。让我们看看如何解决这个问题。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/20576d5322c4fb97f14f3e98eb7cc338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0myUBBTqIBOgMT4yPjsueQ.jpeg"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Picture courtesy of <a class="ae kf" href="https://unsplash.com/@clever_visuals" rel="noopener ugc nofollow" target="_blank">Clever Visuals</a></figcaption></figure><p id="31a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将介绍从应用程序的JavaScript包中移除未使用的Moment.js语言环境并使其变得轻如鸿毛所需的步骤。</p><h1 id="e820" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">MomentJS怎么了？</h1><p id="7248" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Moment.js是一个非常流行和强大的库。它支持日期/时间的格式化和本地化，允许方便地为世界各地的用户适当地显示日期/时间。</p><p id="80b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，它没有跟上现代图书馆利用es模块(ESM)来提供更好的模块化的趋势。一旦您在代码中从“moment”导入一些内容，您的JS包就会自动包含Moment.js支持的所有语言环境。在大多数情况下，这是没有用的，因为应用程序通常只支持少数语言环境。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/cb6694025552f0ba11e7f5efd59489cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibHzCGTMFK1xrl3JNXxBPA.png"/></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk">Catastrophic impact on bundle size</figcaption></figure><p id="a3e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个Moment.js语言环境文件“仅仅”重几KB，但是如果你把它们加在一起，那么它就开始变得非常糟糕；尤其是对于中小型应用。</p><p id="90c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，上面的可视化是由<a class="ae kf" href="https://medium.com/swlh/analyzing-your-angular-app-js-bundles-8f5def43cd53" rel="noopener"> webpack-bundle-analyzer </a>生成的，这是一个非常有用的工具，我在我的<a class="ae kf" href="https://medium.com/swlh/analyzing-your-angular-app-js-bundles-8f5def43cd53" rel="noopener">上一篇文章</a> : <a class="ae kf" href="https://medium.com/swlh/analyzing-your-angular-app-js-bundles-8f5def43cd53" rel="noopener">“分析你的Angular应用JS bundles”</a>中介绍过。</p><p id="0f27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，诸如RxJS、Lodash等库只在需要时才支持导入特定的函数/操作，这大大减小了包的大小；把它限制在绝对必要的范围内。</p><p id="67b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是Moment.js的一个已知问题，但是<a class="ae kf" href="https://github.com/moment/moment/issues/5492" rel="noopener ugc nofollow" target="_blank">还有希望</a>；从某种意义上来说，这可能会得到改善。不过现在，我们必须实施一个解决方案，因为这对用户体验、性能…和地球都非常不利；-)</p><h1 id="c6dd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">新项目最简单的解决方案</h1><p id="bb97" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">新项目可能更适合使用像<a class="ae kf" href="https://date-fns.org/" rel="noopener ugc nofollow" target="_blank"> date-fns </a>这样的库。</p><p id="0d42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">date-fns支持单独导入特定的函数，这意味着它不会不必要地增加JavaScript包的重量。这可能是因为date-fns是一个函数库，而不是像Moment.js那样面向对象的函数库。</p><p id="d822" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">date-fns也很强大。我不能和Moment.js详细比较，但我相信两者大致相当。如果你正在寻找两者的对比，那么你可以看看下面的文章中的<a class="ae kf" href="https://medium.com/@k2u4yt/momentjs-vs-date-fns-6bddc7bfa21e" rel="noopener">。</a></p><p id="83ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顺便说一句，如果你正在寻找角度支持，那么知道有一个相当于<a class="ae kf" href="https://www.npmjs.com/package/ngx-moment" rel="noopener ugc nofollow" target="_blank"> ngx-moment </a>的日期-fns，称为<a class="ae kf" href="https://github.com/joanllenas/ngx-date-fns" rel="noopener ugc nofollow" target="_blank"> ngx-date-fns </a>。</p><h1 id="ac97" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">定制Webpack配置拯救世界</h1><p id="3e46" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在最近的一篇文章中，我解释了如何轻松地<a class="ae kf" href="https://medium.com/javascript-in-plain-english/customizing-your-angular-apps-webpack-configuration-4099144949fc" rel="noopener">定制Angular应用程序的Webpack配置</a>。</p><p id="c63a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好消息是，我们可以通过定制Webpack配置来快速修复Moment.js捆绑问题。您需要做的是默认排除所有Moment.js语言环境，并手动导入您需要的语言环境。</p><p id="47b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是排除Moment.js区域设置的方法:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="e90d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个解决方案使用Webpack 的<a class="ae kf" href="https://webpack.js.org/plugins/ignore-plugin/" rel="noopener ugc nofollow" target="_blank"> Ignore插件(一个核心插件)来忽略Moment.js区域设置文件。</a></p><p id="e44c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦将它添加到您的项目中，就不会将Moment.js区域设置添加到您的js包中。但是你当然希望<em class="ms">至少包含一个</em>！</p><p id="aba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要包含一个区域设置，现在必须在应用程序代码中显式导入它。例如，您可以在“main.ts”文件中执行此操作:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="b9ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这些，JS包将只包含您真正需要的东西。</p><h1 id="a935" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="c22c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本文中，我已经向您展示了，默认情况下，Webpack将在您的JavaScript包中包含Moment.js支持的所有语言环境。</p><p id="e2c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑到它给JS包增加了多少重量，意识到这个问题很重要，更重要的是确保避免它。幸运的是，正如我上面所展示的，一旦你知道如何<a class="ae kf" href="https://medium.com/javascript-in-plain-english/customizing-your-angular-apps-webpack-configuration-4099144949fc" rel="noopener">定制你的Angular应用程序的Webpack构建</a>，这个修复就很容易实现。</p><p id="9d53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这将帮助您改进您的应用程序，并使它为最终用户快速加载。</p><p id="8521" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天到此为止！</p><h1 id="7eee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">喜欢这篇文章吗？</h1><p id="69d3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你想了解关于软件/Web开发、TypeScript、Angular、React、Vue、Kotlin、Java、Docker/Kubernetes和其他很酷的主题的大量其他很酷的东西，那么不要犹豫<a class="ae kf" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">拿一本我的书</a>并订阅<a class="ae kf" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的简讯</a>！</p></div></div>    
</body>
</html>