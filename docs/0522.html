<html>
<head>
<title>How does React Context work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React上下文是如何工作的？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-talk-context-b188ffe59b20?source=collection_archive---------3-----------------------#2019-11-02">https://javascript.plainenglish.io/lets-talk-context-b188ffe59b20?source=collection_archive---------3-----------------------#2019-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="292e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于React上下文API的简单教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/07231cff5a3861aba1bac5dd954f336f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fkbRDeElt0f-79MmzuYpng.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">image of code from unsplash</figcaption></figure><p id="0c95" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">众所周知，Reactjs是一个库，它简化了原本复杂的UI的创建，具有声明式API，并且它利用了常规JavaScript的大部分实现，这使得react非常容易使用；你所要做的就是学习React背后的一些哲学，一些语法和工具，然后嘣！你很快就会写出反应。</p><p id="0d04" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">现在，我们来看一下手头的主题，上下文API。</strong></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><blockquote class="ly lz ma"><p id="c6f5" class="kv kw mb kx b ky kz jr la lb lc ju ld mc lf lg lh md lj lk ll me ln lo lp lq ij bi translated">“要完全理解某样东西是什么，你必须首先知道两件事，那东西的目的是什么，它能解决什么问题”——<strong class="kx ir">泰勒·麦金尼斯</strong></p></blockquote><p id="0b03" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从这句话的后一句开始。在React中，有时我们需要在组件之间共享状态。我们通过props将状态数据传递给组件来实现这一点。然而，当我们需要深入嵌套在应用程序组件树中的组件的状态数据时，这是如何工作的呢？实际上非常简单，只需将状态数据移动到最近的父组件，并通过props传递下去。</p><p id="be8b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这听起来很棒，几乎是直觉，对吗？🙂。不幸的是，这很快就会变得很麻烦，尤其是当你的应用程序越来越大，越来越难以管理的时候😓。让我举一个用例，假设您创建了一个应用程序，但不是有一个组件需要一条状态数据，而是有多个组件在不同的位置和深度需要该状态数据。类似这样的东西👇</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/080b59d3e0fe72c3c2b53f0a0cbbe68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*Kr1uUzdq5wm-m6qWwCBNoA.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">I created this; designers, please be gentle🙂</figcaption></figure><p id="1ecd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种结构中，我们可靠的“父组件解决方案”成为了一个问题，因为我们不必要地需要通过中间组件传递所需的状态数据才能到达目的地。正如我之前所说，这不是最佳选择，而且在较大的应用程序中很难跟踪数据流。</p><p id="1c83" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">值得庆幸的是，可靠的React团队已经为这个问题添加了一个解决方案:<strong class="kx ir"> Context。</strong></p><blockquote class="mg"><p id="8f48" class="mh mi iq bd mj mk ml mm mn mo mp lq dk translated">“上下文提供了一种通过组件树传递数据的方式，而不必在每一层手动传递属性。”——React Docs</p></blockquote><p id="8b66" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">简而言之，这意味着使用context API，我们可以将某些数据暴露给组件树中的任何组件，不管它的嵌套有多深。您可能已经猜到了，它解决了某些组件无法访问某些数据的问题。您可以为想要公开的任何新的唯一数据创建一个新的上下文。这可以这样做👇</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="5493" class="na nb iq mw b gy nc nd l ne nf">let myContext = React.createContext()</span></pre><p id="4429" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">嗯，看起来很简单；然而，这还不是全部。有了这段代码，变量<code class="fe ng nh ni mw b">myContext</code>将有两个我们关心的属性:<code class="fe ng nh ni mw b">Provider</code>和<code class="fe ng nh ni mw b">Consumer</code>。</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="20e1" class="na nb iq mw b gy nc nd l ne nf">const {Provider, Consumer} = myContext</span></pre><p id="6a0d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这两个属性只是组件。你可以把<code class="fe ng nh ni mw b">Provider</code> <em class="mb"> </em>想象成一家银行，因为就像银行一样，它保存着你可能想用来消费的所有钱(数据)。类似地，<code class="fe ng nh ni mw b">Consumer</code>——与我们的银行业类似——就像一张信用卡/借记卡，可以用来在世界任何地方获取你的可用资金(数据)。</p><p id="dbd6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们用更专业的术语来重新表述。<code class="fe ng nh ni mw b">Provider</code>组件保存我们希望在整个组件树中可用的数据，而<code class="fe ng nh ni mw b">Consumer</code>允许我们在组件树中的任何组件中使用“<strong class="kx ir">公开的</strong>数据。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="3d77" class="nj nb iq bd nk nl nm nn no np nq nr ns jw nt jx nu jz nv ka nw kc nx kd ny nz bi translated">语法</h1><p id="d67a" class="pw-post-body-paragraph kv kw iq kx b ky oa jr la lb ob ju ld le oc lg lh li od lk ll lm oe lo lp lq ij bi translated">既然我们已经对上下文API的用途以及它所解决的问题有了一些了解，那么现在是时候转到本文中我最喜欢的部分了:代码🔥🔥。</p><p id="6f07" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注意:我将在这个例子中使用一些钩子，所以如果你不熟悉它们，我建议你浏览一下</strong> <a class="ae of" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> React钩子文档</strong> </a></p><p id="b716" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用上下文的方式相当简单。让我们尝试一个简单的主题化例子</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="be5a" class="na nb iq mw b gy nc nd l ne nf">const ThemeContext = React.createContext()<br/>const ThemeProvider = ThemeContext.Provider<br/>const ThemeConsumer = ThemeContext.Consumer</span></pre><p id="18ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经声明了变量，让我们继续我们的虚拟应用程序结构。让我们假设我们已经有了一个<code class="fe ng nh ni mw b">NavBar</code>和<code class="fe ng nh ni mw b">Home</code>组件。</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="dab9" class="na nb iq mw b gy nc nd l ne nf">function App() {</span><span id="f3e4" class="na nb iq mw b gy og nd l ne nf">  const [theme, setTheme] = React.useState('light');</span><span id="780d" class="na nb iq mw b gy og nd l ne nf">  const toggleTheme = () =&gt; setTheme((<em class="mb">theme</em>) =&gt; (theme === 'light' ?      'dark' : 'light'));</span><span id="7fd0" class="na nb iq mw b gy og nd l ne nf">  return (</span><span id="823c" class="na nb iq mw b gy og nd l ne nf">     &lt;ThemeProvider <em class="mb">value</em>={theme}&gt;</span><span id="99fe" class="na nb iq mw b gy og nd l ne nf">        &lt;div <em class="mb">className</em>={theme}&gt;</span><span id="54ef" class="na nb iq mw b gy og nd l ne nf">         &lt;div <em class="mb">className</em>='container'&gt;</span><span id="1b48" class="na nb iq mw b gy og nd l ne nf">             &lt;NavBar <em class="mb">toggleTheme</em>={toggleTheme} /&gt;<br/>        <br/>             &lt;Home /&gt;</span><span id="bdbf" class="na nb iq mw b gy og nd l ne nf">         &lt;/div&gt;</span><span id="533f" class="na nb iq mw b gy og nd l ne nf">      &lt;/div&gt;</span><span id="a73a" class="na nb iq mw b gy og nd l ne nf">    &lt;/ThemeProvider&gt;</span><span id="13b6" class="na nb iq mw b gy og nd l ne nf">  );</span><span id="8c46" class="na nb iq mw b gy og nd l ne nf">}</span><span id="85e2" class="na nb iq mw b gy og nd l ne nf">ReactDOM.render(&lt;App /&gt;, document.getElementById('app'));</span></pre><p id="d12f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如您所看到的，我们希望所有组件都可以使用的数据被作为一个价值道具传递给了<code class="fe ng nh ni mw b">ThemeProvider</code>。此外——你们有些人可能已经猜到了——我们需要用<code class="fe ng nh ni mw b">ThemeProvider</code>包装整个应用程序，这样我们的数据(在本例中是<code class="fe ng nh ni mw b">theme</code>)就可以在整个应用程序中使用。</p><p id="bad5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，让我们的<code class="fe ng nh ni mw b">Home</code>组件知道我们应用程序的主题状态。</p><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="c132" class="na nb iq mw b gy nc nd l ne nf">function Home() {</span><span id="b694" class="na nb iq mw b gy og nd l ne nf">  return (<br/>   &lt;ThemeConsumer&gt;</span><span id="d5f0" class="na nb iq mw b gy og nd l ne nf">    {(theme) =&gt; (</span><span id="2d5a" class="na nb iq mw b gy og nd l ne nf">      &lt;div className={theme}&gt;</span><span id="bfc6" class="na nb iq mw b gy og nd l ne nf">        &lt;h1&gt;Hello  world &lt;/h1&gt;</span><span id="4f56" class="na nb iq mw b gy og nd l ne nf">      &lt;/div&gt;</span><span id="e21d" class="na nb iq mw b gy og nd l ne nf">    )}</span><span id="3eee" class="na nb iq mw b gy og nd l ne nf">   &lt;/ThemeConsumer&gt;</span><span id="186d" class="na nb iq mw b gy og nd l ne nf">  )<br/>}</span></pre><p id="b3fe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过用<code class="fe ng nh ni mw b">ThemeConsumer</code>包装我们的<code class="fe ng nh ni mw b">Home</code>组件，我们可以通过<a class="ae of" href="https://reactjs.org/docs/render-props.html" rel="noopener ugc nofollow" target="_blank">渲染道具</a>访问我们的状态数据。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="7679" class="nj nb iq bd nk nl nm nn no np nq nr ns jw nt jx nu jz nv ka nw kc nx kd ny nz bi translated">结论</h1><p id="9ded" class="pw-post-body-paragraph kv kw iq kx b ky oa jr la lb ob ju ld le oc lg lh li od lk ll lm oe lo lp lq ij bi translated">React的上下文API是该库的一大亮点；但是，不应该过分依赖它，只应该在必要的时候使用。</p><blockquote class="ly lz ma"><p id="54ae" class="kv kw mb kx b ky kz jr la lb lc ju ld mc lf lg lh md lj lk ll me ln lo lp lq ij bi translated"><strong class="kx ir"> Context主要用于当不同嵌套层次的<em class="iq">多个</em>组件需要访问某些数据时。请谨慎使用它，因为它使组件重用更加困难。如果只是想避免一些道具通过很多关卡，</strong> <a class="ae of" href="https://reactjs.org/docs/composition-vs-inheritance.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">组件构成</strong> </a> <strong class="kx ir">往往是比上下文更简单的解决方案。</strong></p><p id="2865" class="kv kw mb kx b ky kz jr la lb lc ju ld mc lf lg lh md lj lk ll me ln lo lp lq ij bi translated">— <strong class="kx ir">反应文件</strong></p></blockquote><p id="d7f5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了简洁，并尽可能使文章易于理解，还有一些其他的技术、问题和用例我没有在本文中涉及。尽管如此，如果你想了解更多，你可以访问<a class="ae of" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React文档</a>，那里有关于这个API的详细介绍。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="3484" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无论是React pro还是初学者，希望这篇文章对你有所帮助。</p><p id="db53" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">快乐编码🔥🚀。</p></div></div>    
</body>
</html>