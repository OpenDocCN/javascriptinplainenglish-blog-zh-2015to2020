<html>
<head>
<title>Five Steps to Write an Excellent “parseUrl” Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写优秀的“parseUrl”函数的五个步骤</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/five-steps-to-write-an-excellent-parseurl-function-799f3a57f45b?source=collection_archive---------4-----------------------#2020-04-25">https://javascript.plainenglish.io/five-steps-to-write-an-excellent-parseurl-function-799f3a57f45b?source=collection_archive---------4-----------------------#2020-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d597" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">掌握这个经典的面试问题，让你在面试中脱颖而出。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5cd5ce7c9bac7dc795ba5a781727d38f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SjhMD8BdSq2ayu9j"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@konkarampelas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kon Karampelas</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="eaf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们知道查询字符串是URL的重要组成部分，出现在<code class="fe ls lt lu lv b">?</code>之后，通常是<code class="fe ls lt lu lv b">key1=value1&amp;key2=value2</code>的格式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lw"><img src="../Images/1268df6f51261ada478169c3814dd42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8wghYnYC1g7aLPiZ893wg.png"/></div></div></figure><p id="48ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上图中，<code class="fe ls lt lu lv b">q=hello+world&amp;oq=hello+world&amp;aqs=chrome..69i57j0l7.7105j0j7&amp;sourceid=chrome&amp;ie=UTF-8</code>就是我们所说的查询字符串。</p><p id="4941" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查询字符串往往包含很多信息，但这种字符串不方便直接使用。为了方便使用，我们需要将字符串转换为对象格式。</p><pre class="kg kh ki kj gt lx lv ly lz aw ma bi"><span id="b0d9" class="mb mc iq lv b gy md me l mf mg">let str = 'key1=value1&amp;key2=value2'; // not good</span><span id="8102" class="mb mc iq lv b gy mh me l mf mg">let obj = {key1: 'value1', key2: 'value2'}; // good</span></pre><p id="a387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么如何编写一个优秀的‘parse URL’函数将查询字符串转换成对象格式呢？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/3a5b079fd2bb7a98ddda8e79b676814c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FSvl6CAPIcpaPa42n6-XiA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">We need to implement this function</figcaption></figure><h2 id="f5c4" class="mb mc iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">基本实现</h2><p id="57bd" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">显然，我们可以通过使用<code class="fe ls lt lu lv b">&amp;</code>来拆分字符串，然后使用<code class="fe ls lt lu lv b">=</code>来拆分子串，从而获得每个键和值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="c58e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/2eeb322170ee214cb8425d3f40675820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dHI-_qfan-M8Mn4z4IDyQQ.png"/></div></div></figure><h2 id="3881" class="mb mc iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">修复一个错误</h2><p id="9041" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">但有时，查询字符串并不严格遵循<code class="fe ls lt lu lv b">key=value</code>的格式。我们必须考虑这种情况。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/5f6444ddc23de4df595a422ded9cc99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uz_AqTHx6jLFBLCeE4cDnw.png"/></div></div></figure><p id="11f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以在代码中增加一个额外的判断语句:如果一个字段不符合<code class="fe ls lt lu lv b">key=value</code>的格式，或者只有key没有value，那么我们将忽略这个字段。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="cfae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/39d96cecb4dc64752c77695a601dad40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7zn7SJf8m-JeUGST4-fKg.png"/></div></div></figure><h2 id="518f" class="mb mc iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">考虑对象类型</h2><p id="ce2d" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">在上面的例子中，我们只考虑简单的查询字符串格式。其实查询字符串也可以这样写:<code class="fe ls lt lu lv b">name[firstname]=Rock&amp;name[lastname]=Lee&amp;sex=man</code>。</p><p id="4d3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们使用前面的pareUrl函数，我们只会得到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/06506f8228005c30a39871b97c1b081a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4pHWiLCj6_ncUjMN_GMmsw.png"/></div></div></figure><p id="f56d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但事实上，我们希望得到这样的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/ecd8bfc83926997b0292f8ae36a0121d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sn5tNzTkIzyFbIcHI7rysg.png"/></div></div></figure><p id="1ba6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么我们该如何改进我们的“parseUrl”函数呢？</p><p id="e791" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实现并不复杂。我们可以用正则表达式匹配<code class="fe ls lt lu lv b">[</code>和<code class="fe ls lt lu lv b">]</code>，然后把字符串解析成对象格式。应该注意，这种对象格式的字符串可能有多个嵌套层次，我们需要在代码中考虑这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="77f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/7ef6e7ab40eb265e808f5ac9ef7abee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9e7LKCEn8YIHHzEaq1cKA.png"/></div></div></figure><h2 id="443e" class="mb mc iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">考虑数组</h2><p id="c929" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">查询字符串不仅可以是对象格式，也可以是数组格式:<code class="fe ls lt lu lv b">firend[0]=Tom&amp;firend[1]=Jerry</code>。</p><p id="6942" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本例中的代码与上一步中的代码很相似:如果键是一个数字，我们就把它当作一个数组。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="1ac5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/be174a30972d847ce32290d16c1f6935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WWLeRN1XH_aSpLtY6UfNqA.png"/></div></div></figure><h2 id="ef5f" class="mb mc iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated">考虑编码</h2><p id="bdf2" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">最后，我们知道像<code class="fe ls lt lu lv b">+</code> <code class="fe ls lt lu lv b">%</code>这样的特殊字符被编码在URL中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/a978ea11f9964b0cab7b1c480b1d88d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d69oaFLW8eI8eNAxbTSt_A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/0bcf6ec33a1ccb691659879e3cee6c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NruSM0kQIjeNDzGUAyiG7A.png"/></div></div></figure><p id="c23d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以在代码中，我们还需要解码输入的查询字符串。</p><pre class="kg kh ki kj gt lx lv ly lz aw ma bi"><span id="6b04" class="mb mc iq lv b gy md me l mf mg">function parseUrl(str) {<br/>   //...<br/>}<br/>function deepObj(obj, keys, value) {<br/>    //...<br/>    obj[keys[i]] = decodeURIComponent(value);<br/>}</span></pre><h2 id="b100" class="mb mc iq bd mj mk ml dn mm mn mo dp mp lf mq mr ms lj mt mu mv ln mw mx my mz bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="26d9" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae kv" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="ky ir">AI in Plain English</strong></a><a class="ae kv" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="ky ir">UX in Plain English</strong></a><a class="ae kv" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="ky ir">Python in Plain English</strong></a><strong class="ky ir"/>——谢谢，继续学习！</p><p id="d625" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kv" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">submissions @ plain English . io</strong></a><strong class="ky ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>