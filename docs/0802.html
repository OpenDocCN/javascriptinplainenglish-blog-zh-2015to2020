<html>
<head>
<title>Enterprise React in 2020</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">企业在2020年做出反应</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/enterprise-react-in-2020-78155bc99259?source=collection_archive---------2-----------------------#2019-12-13">https://javascript.plainenglish.io/enterprise-react-in-2020-78155bc99259?source=collection_archive---------2-----------------------#2019-12-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0e3724685e2d7ee6da05b04865464a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDC8V8hAvYT2PEudgTAtaA.png"/></div></div></figure><p id="77cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我大约一年前发表的前一篇文章中，我展示了React技术栈，我称之为Enterprise React。它是一组自以为是的库和技术方法，用于在React中快速构建可伸缩的企业级应用程序。它还附带了一个小的演示应用程序，可以用作一个引导工具包。它包括了所有提到的库，所以你可以看到它们是如何一起工作的。</p><p id="0eec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自那时以来，React生态系统已经发展了很多，今天我将展示更新的企业React 2020，它还带有更新的演示应用程序。我将主要关注自去年以来发生的变化。如果你是新手，先阅读一下<a class="ae kw" href="https://medium.com/@viacheslavlushchinskiy/enterprise-react-in-2018-2019-ae6c80c03f1" rel="noopener">以前的文章</a>是有意义的。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="5f21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">TL；博士</strong></p><p id="a89c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在深入讨论细节之前，让我们快速浏览一下当前的堆栈。</p><p id="fe83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们仍然使用<strong class="ka ir"/><a class="ae kw" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Create React App</strong></a>(CRA)来引导一个新项目。<a class="ae kw" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>是服务器端渲染(SSR)应用的替代品，但脸书承诺有一天会在CRA中包含SSR，所以除非你今天需要SSR，否则我会等待。</p><p id="438a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@scbarrus/the-ducks-file-structure-for-redux-d63c41b7035c" rel="noopener"> <strong class="ka ir"> Duck应用程序结构</strong> </a> <strong class="ka ir"> </strong>仍然是最受欢迎的一个，并且很可能在未来几年都是如此。</p><p id="977d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">库列表如下所示:</p><p id="e48f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">主要模块</strong></p><p id="ecb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a> —状态管理</p><p id="8c62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://jaredpalmer.com/formik" rel="noopener ugc nofollow" target="_blank"> Formik </a> —处理表单(取代<a class="ae kw" href="https://redux-form.com/" rel="noopener ugc nofollow" target="_blank">还原表单</a>)</p><p id="106a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://redux-saga.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux-Saga </a> — REST和WebSocket API</p><p id="baa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://reacttraining.com/react-router/" rel="noopener ugc nofollow" target="_blank">反应路由器</a> —客户端路由</p><p id="e1ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://react.i18next.com/" rel="noopener ugc nofollow" target="_blank">i18下一个</a> —翻译</p><p id="3bbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://material-ui.com/" rel="noopener ugc nofollow" target="_blank">Material-UI</a>——样式化和使用CSS(除非你想建立自己的设计系统)</p><p id="8e9b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">实用程序</strong></p><p id="eaff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="http://extension.remotedev.io/" rel="noopener ugc nofollow" target="_blank"> Redux devtools </a> —状态和动作监控</p><p id="edb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a> —数据处理工具包</p><p id="046f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/sindresorhus/query-string" rel="noopener ugc nofollow" target="_blank">查询字符串</a> —查询字符串解析器</p><p id="867d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://date-fns.org/" rel="noopener ugc nofollow" target="_blank">日期-fns </a> —日期和时间管理</p><p id="2307" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试— <a class="ae kw" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a> + <a class="ae kw" href="https://airbnb.io/enzyme/" rel="noopener ugc nofollow" target="_blank">酶</a></p><p id="7070" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经移除了<a class="ae kw" href="https://github.com/acdlite/recompose" rel="noopener ugc nofollow" target="_blank">重新组合</a>，现在你可以使用redux库中的‘组合’功能了。此外，去年提到的<a class="ae kw" href="https://github.com/reduxjs/reselect" rel="noopener ugc nofollow" target="_blank">重新选择</a>在很多情况下并不必要。</p><p id="79d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">演示</em>——<a class="ae kw" href="https://slava-lu.github.io/enterprise-react-2020/" rel="noopener ugc nofollow" target="_blank">https://slava-lu.github.io/enterprise-react-2020/</a></p><p id="ea1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">回购【https://github.com/slava-lu/enterprise-react-2020】——<a class="ae kw" href="https://github.com/slava-lu/enterprise-react-2020" rel="noopener ugc nofollow" target="_blank">回购</a></em></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="3758" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们更深入地了解一下新的技术体系。</p><p id="0adf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">CRA本身已经得到了改进，现在在建造后会产生更小的包。主要是因为移除了对旧浏览器的支持。</p><p id="ce86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">React生态系统的主要变化是React库本身的变化，引入了<strong class="ka ir">钩子</strong>。钩子是你如何处理本地状态、主要生命周期方法和其他一些东西的全新方式。在我以前的文章中，我推荐使用类来获得更好的可伸缩性。现在，我已经用功能组件和钩子重构了我的演示应用程序。它们更方便，并且在转换后产生更少的JavaScript代码。</p><p id="15eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Redux仍然是主要的状态管理解决方案。它太方便了，我不认为它会很快消失，尽管有人试图让它变得多余。</p><p id="a7dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与去年的Enterprise React stack相比，最大的变化之一是用<strong class="ka ir"> Formik </strong>替换了Redux表单库。长期以来，人们一直认为Redux格式有点笨重，解决方案过于复杂。甚至这个库的作者也创造了一个新的叫做<a class="ae kw" href="https://final-form.org/react" rel="noopener ugc nofollow" target="_blank">的最终形式</a>来作为替代。但是他在“可观察”模式上的赌注没有成功，另一个Redux表单替换库Formik成为表单管理库的领导者。</p><p id="8de3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Redux-Saga </strong>仍然是管理REST API最通用的库。该库的一个有用的特性是用名为<em class="le"> takeLatest </em>的辅助函数(effect)轻松取消正在运行的函数(sagas)。如果您使用这种效果，并且用户多次单击该按钮，则只有最后一次单击才会实现。直到最近它还不是很有用，因为取消API功能不会导致网络呼叫本身的取消，但是使用新的<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">abort controller API</strong></a>您现在可以非常容易地取消网络呼叫。实现细节见演示app。</p><p id="acbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在演示应用程序中查看取消获取的操作，请更改chrome dev工具以模拟缓慢的3G网络，单击几次“获取天气”按钮并查看网络选项卡。您将看到取消的网络请求，如下所示:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/991d32322cd173f09e2dabccf6cb0d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0X7kLIn2IH8BKWi_cPxfyQ.png"/></div></div></figure><p id="b692" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了进一步改善用户体验，我还为fetch调用添加了一个超时，这样在REST API调用挂起的情况下就不会有旋转的spinners。如果超时，fetch网络调用也被取消，就像上面的例子一样。您可以通过在<em class="le"> src/config/consts.js </em>中将FETCH_TIMEOUT参数设置为几毫秒来测试它</p><p id="f535" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是添加超时获取的代码片段:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="2e39" class="lp lq iq ll b gy lr ls l lt lu"><strong class="ll ir">const </strong>timeoutPromise = timeout =&gt;<br/>  <strong class="ll ir">new <em class="le">Promise</em></strong>((resolve, reject) =&gt; <em class="le">setTimeout</em>(() =&gt;<br/>  reject(<strong class="ll ir">new <em class="le">Error</em></strong>(<strong class="ll ir">'Network timeout'</strong>)), 1000))</span><span id="b515" class="lp lq iq ll b gy lv ls l lt lu"><strong class="ll ir">const </strong>fetchResult = <strong class="ll ir">await <em class="le">Promise</em></strong>.race([<br/>  <em class="le">fetch</em>(url, options),<br/>  timeoutPromise(<strong class="ll ir"><em class="le">FETCH_TIMEOUT</em></strong>)<br/>])</span></pre><p id="e42a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> React路由器</strong>多年来一直是添加客户端路由的标准解决方案。现在，您不仅可以使用它来模拟标准的服务器端路由体验，还可以有效地将代码分割成块。您不再需要第三方库来完成这项工作，因为它现在是React中的内置特性。如果你想在SSR中实现代码拆分，你仍然需要第三方库。代码分割现在是任何企业应用程序的“必备”功能，因为你的应用程序的性能和响应能力在SEO评分和谷歌对你的应用程序的排名中起着更大的作用。</p><p id="0ea5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">翻译库<strong class="ka ir"> I18next </strong>从去年开始彻底改变了API。我仍然推荐使用这个库，因为它正在开发中，并且非常容易实现。</p><p id="b0ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你自己的设计会让你的网站脱颖而出，但是创造独特的设计并不便宜。Material-UI 框架帮助你迈出创建自己身份的第一步。它可以很好地平衡自创和无聊的模板。即使你决定推出自己的设计，一些来自Material-UI的想法和方法肯定是有帮助的，值得学习。如果你想尝试一些其他的UI框架，那么<a class="ae kw" href="https://designsystemsrepo.com/design-systems/ " rel="noopener ugc nofollow" target="_blank">可以看看这里的</a>不同的选项。</p><p id="d63c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">至于文章开头提到的实用程序库，它们是不言自明的。我想提的唯一一件事是，从create-react-app 3.3.0开始，你可能不再需要lodash的<em class="le"> get </em>助手，因为现在支持名为“可选链接”的新功能。为了清晰起见，我个人更喜欢lodash语法，但是你可以开始使用<a class="ae kw" href="https://github.com/tc39/proposal-optional-chaining" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">可选链接</strong> </a> <em class="le"> : </em></p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="63a1" class="lp lq iq ll b gy lr ls l lt lu"><strong class="ll ir">const </strong>lastUpdated = weather.<strong class="ll ir">currentWeather</strong>?.<strong class="ll ir">dt</strong> ?? <strong class="ll ir">' '</strong></span><span id="927f" class="lp lq iq ll b gy lv ls l lt lu">instead of</span><span id="ab2e" class="lp lq iq ll b gy lv ls l lt lu"><strong class="ll ir">const </strong>lastUpdated = <em class="le">get</em>(weather, [<strong class="ll ir">'currentWeather'</strong>, <strong class="ll ir">'dt'</strong>], <strong class="ll ir">' '</strong></span></pre><p id="9ba3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今年，我在新的演示应用程序中引入了两个全新的东西。它们是测试和错误管理。</p><p id="4d98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我上次省略它们的原因是，有数百万种不同的方法可以实现它们，所以没有一种解决方案可以被称为主流解决方案。但是由于这两件事是任何生产应用程序的“必备”，所以我包括了我最喜欢的方法，这样你至少可以有一些开始。</p><p id="9840" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">测试</strong>。你可以测试很多东西，但是在我看来，测试经常被滥用来达到100%的代码覆盖率，而不是提高应用程序的质量。因此，在我的演示应用中，我只展示了非常重要的测试示例:</p><ul class=""><li id="0391" class="lw lx iq ka b kb kc kf kg kj ly kn lz kr ma kv mb mc md me bi translated">测试表单提交将导致正确的操作创建者调用。类似的事情是测试点击按钮是否会导致预期的动作创建者调用。</li><li id="839d" class="lw lx iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">测试Redux-Saga。测试redux-saga的通常方法是模拟redux存储和分派功能，然后看看运行saga时是否调用了预期的动作创建器。redux-saga文档中也推荐这种方法。我个人更喜欢使用真实的商店并检查，如果saga电话导致商店的新的预期状态。这是一个更加综合和有用的测试。毕竟，你并不关心行动创建者，而是关心商店是否有正确的信息。</li><li id="6d10" class="lw lx iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">另一个流行的选项是快照测试，您可以测试您的组件自上次测试以来没有被更改过。没有多少人觉得快照测试非常有用，但它仍然很受欢迎，所以我包括了一个快照测试。</li></ul><p id="a879" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">错误管理</strong>。错误管理可以用不同的方式来完成。您需要决定是显示一般的错误信息，还是显示从失败的函数中收到的错误信息。使用最后一个选项，如果您同时收到一个以上的错误，这可能会很棘手。如果您有一些集中的日志记录，例如使用<a class="ae kw" href="https://sentry.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">哨兵</strong> </a> <strong class="ka ir"> </strong>库，那么一般错误消息可能是一个首选选项，这样您仍然可以检查客户端的真正错误是什么。</p><p id="6874" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我还没有在我的演示应用程序中实现Sentry，所以我显示了最后一个真正的错误消息。要查看它的运行情况，您可以在<em class="le"> src/config/consts.js </em>中将<em class="le"> FETCH_TIMEOUT </em>参数更改为20，然后单击按钮。您应该会看到“<em class="le">网络超时</em>”错误消息。</p><p id="a5f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我也从AirBnb林挺的<a class="ae kw" href="https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb" rel="noopener ugc nofollow" target="_blank">规则切换到了林挺的<strong class="ka ir">规则，因为AirBnb的规则对我来说太过严格和固执己见，我不得不添加许多例外。</strong></a></p><p id="6db1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经创建了一个干净的<a class="ae kw" href="https://slava-lu.github.io/enterprise-react-2020/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">演示应用</strong> </a>，它有最少的代码，但使用了所有上述的库和工具。这里可以看到<a class="ae kw" href="https://github.com/slava-lu/enterprise-react-2020" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">源代码</strong> </a>。欢迎在评论中提问。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="ff27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来的一年也将会非常精彩。我们将会看到脸书如何将SSR引入CRA。目前处于测试阶段的<strong class="ka ir">并发模式</strong>应该会显著改善大型应用程序的用户体验，但我们需要等到脸书和其他库作者发布支持它的版本。</p><p id="eb70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不想错过它的发生，请继续关注。</p></div></div>    
</body>
</html>