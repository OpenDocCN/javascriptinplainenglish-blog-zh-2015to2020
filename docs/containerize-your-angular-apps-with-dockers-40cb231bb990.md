# ç”¨ Dockers å®¹å™¨åŒ–ä½ çš„ Angular åº”ç”¨

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/containerize-your-angular-apps-with-dockers-40cb231bb990?source=collection_archive---------10----------------------->

## *äº†è§£å¦‚ä½•ä¸º Angular* â›´æ„å»ºè½»é‡çº§å’Œå¯ç§»æ¤çš„è½¯ä»¶å®¹å™¨

![](img/874bc38fd7025d81181d13707fdfe1cb.png)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç¤ºä¾‹é¡¹ç›®ï¼Œå¹¶ä¸€æ­¥ä¸€æ­¥åœ°äº†è§£å¦‚ä½•å°† Angular åº”ç”¨ç¨‹åºä¸ä½œä¸ºæœåŠ¡å™¨çš„ node js å°è£…åœ¨ä¸€èµ·ã€‚

*   ***ä»€ä¹ˆæ˜¯ç å¤´å·¥äººï¼Ÿ***
*   ***å®¹å™¨åŒ–ä½ çš„æ£±è§’ App***
*   ***åœ¨ Docker ä¸Šè¿è¡Œåº”ç”¨***
*   ***å¤šçº§ Docker æ„å»º***
*   ***ç»“è®º***

# ä»€ä¹ˆæ˜¯ç å¤´å·¥äººï¼Ÿâš“ğŸš¤ â›´

> Docker æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæ—¨åœ¨é€šè¿‡ä½¿ç”¨å®¹å™¨æ¥ç®€åŒ–åº”ç”¨ç¨‹åºçš„åˆ›å»ºã€éƒ¨ç½²å’Œè¿è¡Œã€‚å®¹å™¨å…è®¸å¼€å‘äººå‘˜å°†åº”ç”¨ç¨‹åºä¸å®ƒéœ€è¦çš„æ‰€æœ‰éƒ¨åˆ†æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚åº“å’Œå…¶ä»–ä¾èµ–é¡¹ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªåŒ…è¿›è¡Œéƒ¨ç½²ã€‚

ç®€è€Œè¨€ä¹‹ï¼ŒDocker ä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®Œå…¨å¯ç§»æ¤ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œã€‚æœ‰äº† dockers çš„å¸®åŠ©ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸ç”¨æ‹…å¿ƒåºå¤§çš„åŒ…æˆ–åº“ä¾èµ–äº†ã€‚å³æ’å³ç”¨ã€‚Docker æ˜¯ç”¨ [Go](https://golang.org/) ç¼–å†™çš„ï¼Œå®ƒåˆ©ç”¨äº† Linux å†…æ ¸çš„å‡ ä¸ªç‰¹æ€§æ¥æä¾›å®ƒçš„åŠŸèƒ½ã€‚

# å®¹å™¨åŒ–è§’åº¦åº”ç”¨

é—²èŠå¤Ÿäº†ï¼è®©æˆ‘ä»¬å¼€å§‹åˆ›å»º docker å®¹å™¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæˆ‘å¾ˆä¹…ä»¥å‰æ„å»ºçš„ç®€å•çš„è§’åº¦åº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œå¹¶æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œè¿™äº›æ­¥éª¤ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä»æˆ‘çš„å­˜å‚¨åº“ä¸­å…‹éš†é¡¹ç›®:

```
[https://github.com/ahmedkhan1/ng-content-projection.git](https://github.com/ahmedkhan1/ng-content-projection.git)
```

ç°åœ¨æ‚¨å·²ç»åœ¨æœ¬åœ°ç›®å½•ä¸­è·å¾—äº†é¡¹ç›®ï¼Œç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†æ‰€æœ‰å¿…éœ€çš„ä¾èµ–é¡¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒçš„è§’å’ŒèŠ‚ç‚¹ jsã€‚

å¦‚æœå®‰è£…äº†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œè¯·æ‰“å¼€ç»ˆç«¯å¹¶åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤ã€‚

```
ng build --prod
```

è¯¥å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º **dist** çš„æ–°æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­å°†åŒ…å«é¡¹ç›®ä¸­æ‰€æœ‰å·²ç¼–è¯‘çš„æ–‡ä»¶ã€‚

ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ª **docker æ–‡ä»¶**ã€‚

## Docker æ–‡ä»¶

**dockerfile** æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼ŒåŒ…å«ç”¨æˆ·å¯ä»¥ç”¨æ¥ä» **Docker Hub** è·å– Docker å›¾åƒçš„æ‰€æœ‰å‘½ä»¤/æ­¥éª¤ã€‚

## Docker å›¾åƒ

Docker å›¾åƒåªæ˜¯åŒ…å«åˆ›å»º Docker å®¹å™¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯çš„æ¨¡æ¿ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„ docker å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–äººåˆ›å»ºå¹¶å‘å¸ƒåœ¨ Docker Hub ä¸Šçš„å›¾ç‰‡ï¼ŒDocker Hub æ˜¯ Docker å›¾ç‰‡çš„å…¬å…±æ³¨å†Œä¸­å¿ƒã€‚

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºåä¸º`Dockerfile`çš„ docker æ–‡ä»¶ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‡ è¡Œ:

```
**FROM** nginx:1.17.1-alpine
**COPY** /dist/ng-content /usr/share/nginx/html
```

è¿™äº›å‘½ä»¤æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

*   ä¸­çš„ ***å°†æŒ‡ç¤º docker å‰å¾€ Docker Hub å¹¶è·å–ç‰¹å®šçš„ Nginx docker æ˜ åƒ***
*   ***Copy*** åé¢è·Ÿä¸€ä¸ªè·¯å¾„ä¼šç®€å•çš„æŠŠé‚£ä¸ªå›¾åƒå¤åˆ¶ç²˜è´´åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚

å›åˆ°ç»ˆç«¯ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤

```
docker image ls
```

è¯¥å‘½ä»¤å°†æ˜¾ç¤ºå½“å‰æœ¬åœ°ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„å›¾åƒã€‚ç›®å‰ï¼Œå®ƒä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ã€‚

æ¥ä¸‹æ¥ï¼Œé”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºå®¹å™¨ã€‚

```
docker build -t docker-app-image
```

è¿™é‡Œ:

*   **-t** æ ‡å¿—ç”¨äºæŒ‡ç¤º docker ä½¿ç”¨æ ‡ç­¾
*   åœ¨ **-t** æ ‡å¿—æ—è¾¹ï¼Œæˆ‘ä»¬å°†é”®å…¥å®¹å™¨çš„åç§°ã€‚

è¾“å…¥ä¸Šé¢çš„å‘½ä»¤åï¼Œæ£€æŸ¥æœ¬åœ°å¯ç”¨çš„ docker å›¾åƒã€‚

```
docker image ls**REPOSITORY**        **TAG**            **IMAGE ID **     
docker-app-image  latest         a160a7494a19      
nginx             1.17.1-alpine  ea1193fd3dde
```

å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸè·å–äº† docker æ˜ åƒã€‚

è¿™é‡Œ:

*   å­˜å‚¨åº“åç§°æ˜¯å›¾åƒåç§°
*   æ ‡ç­¾åªæ˜¯ç”¨æ¥åŒºåˆ†å®ƒ
*   å›¾åƒ id æ˜¯æ¯ä¸ª docker å›¾åƒæ‹¥æœ‰çš„ IDã€‚å®ƒå¯ä»¥ç”¨æ¥åˆ é™¤è¿™ä¸ªå›¾åƒ

ç°åœ¨è¦è¿è¡Œæ˜ åƒï¼Œåªéœ€è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
docker run --name docker-app-container -d -p 8080:80 docker-app-image
```

è¿™é‡Œ:

*   `run`ç”¨äºå¼•ç”¨å®¹å™¨çš„å¼€å§‹ã€‚
*   `- -name`ç”¨äºä¸ºå®¹å™¨å‘½åï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º **docker-app-container**
*   `-d`æ ‡å¿—å°†ä¿æŒå®¹å™¨åœ¨åå°è¿è¡Œã€‚
*   `-p 8080:80`ç”¨äºä½ æ˜ å°„å®¹å™¨ç«¯å£åˆ°ä½ çš„æœ¬åœ°ï¼Œ80 æ˜¯ Nginx æœåŠ¡å™¨ã€‚
*   æœ€åï¼Œåœ¨æœ€åï¼Œæ‚¨å°†æä¾›å¯ä¾›ä½¿ç”¨çš„å›¾åƒçš„åç§°ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ£€æŸ¥å¯ç”¨çš„å®¹å™¨ã€‚

```
docker container ls**CONTAINER ID**  **IMAGE  **           **STATUS         NAMES**
2523d9f77cf6  docker-app-image  Up 10 minutes  docker-app-container
```

`docker ps -a`æ˜¾ç¤ºè¿è¡Œå’Œåœæ­¢çš„å®¹å™¨ã€‚

`docker stats --all`æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨çš„åˆ—è¡¨ï¼Œé»˜è®¤æ˜¾ç¤ºåˆšè¿è¡Œçš„ã€‚

æˆ‘ä»¬å·²ç»æˆåŠŸåœ°åˆ›å»ºäº† docker çš„å®¹å™¨ï¼Œå¹¶è®©å®ƒè¿è¡Œèµ·æ¥ã€‚è¿™ä¸æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°å°†`build - -prod`å‘½ä»¤ä¼ é€’åˆ° docker æ„å»ºä¸­æ¥æé«˜æ•ˆç‡ã€‚è¿™å°†ä½¿è¿‡ç¨‹æ›´åŠ è‡ªåŠ¨åŒ–å’Œå¹²å‡€ã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨æ‰€è°“çš„ [**å¤šçº§ Docker æ„å»º**](https://docs.docker.com/develop/develop-images/multistage-build/) **ã€‚**

# å¤šçº§ç å¤´å»ºé€ 

é€šè¿‡å¤šé˜¶æ®µæ„å»ºï¼Œæ‚¨ç°åœ¨å¯ä»¥åœ¨ docker æ–‡ä»¶ä¸­ä½¿ç”¨å¤šä¸ª`FROM`è¯­å¥ã€‚æ¯æ¡`FROM`æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŸºç¡€ï¼Œå¹¶ä¸”å®ƒä»¬ä¸­çš„æ¯ä¸€æ¡éƒ½å¼€å§‹äº†æ„å»ºçš„æ–°é˜¶æ®µã€‚å› æ­¤ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬å°† docker æ–‡ä»¶åˆ†æˆå‡ ä¸ªé˜¶æ®µï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªé˜¶æ®µçš„ç»“æœç”¨äºå¦ä¸€ä¸ªé˜¶æ®µã€‚

## ç¬¬ä¸€æ­¥:

åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„ Angular åº”ç”¨ç¨‹åºä»£ç ç¼–è¯‘æˆä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ä»£ç ã€‚

## ç¬¬äºŒæ­¥:

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ docker æ˜ åƒä¸­è¿è¡Œå®ƒã€‚

ä¸ºäº†ç¼–è¯‘ Angular æºä»£ç ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ…å« [Node.js](https://hub.docker.com/_/node/) çš„ Docker imageã€‚

```
**FROM** node:12.7-alpine **AS** build
**WORKDIR** /usr/src/app
**COPY** package.json ./
**RUN** npm install
**COPY** . .
**RUN** npm run build
```

è¿™é‡Œ:

*   `FROM`æ­£åœ¨ä» Docker Hub ä¸­è·å–*èŠ‚ç‚¹*çš„ Docker æ˜ åƒï¼Œå¹¶ä¸”ä¹Ÿæ˜¯åœ¨å¤šé˜¶æ®µ Docker æ„å»ºä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨å…³é”®å­—`AS`æ¥å‘½åæ¯ä¸ªé˜¶æ®µï¼Œåœ¨æœ¬ä¾‹ä¸­è¯¥é˜¶æ®µè¢«å‘½åä¸º`build`ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹ä¸€é˜¶æ®µå‚è€ƒå®ƒã€‚
*   `WORKDIR`è®¾ç½®é»˜è®¤å·¥ä½œç›®å½•ã€‚
*   `COPY`æ­£åœ¨ä»æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•å¤åˆ¶`package.json`æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚
*   `RUN`å®‰è£…åº“ã€‚
*   `COPY`ç”¨æºä»£ç å¤åˆ¶æ‰€æœ‰å‰©ä½™çš„æ–‡ä»¶ã€‚
*   `RUN`å°†è¿è¡Œæ„å»ºå‘½ä»¤æ¥ç¼–è¯‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`.dockerignore`çš„æ–‡ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¸Œæœ› Docker å¿½ç•¥çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚

```
dist
node_modules
```

ç°åœ¨ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ docker æ–‡ä»¶å°†å¦‚ä¸‹æ‰€ç¤º:

```
*### STAGE No 1: Build ###*
**FROM** node:12.7-alpine **AS** build
**WORKDIR** /usr/src/app
**COPY** package.json ./
**RUN** npm install
**COPY** . .
**RUN** npm run build*### STAGE No 2: Run ###*
**FROM** nginx:1.17.1-alpine
**COPY** --from=build /usr/src/app/dist/ng-content /usr/share/nginx/html
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°åœ¨é˜¶æ®µ 2 ä¸­ï¼Œæˆ‘ä»¬å¼•ç”¨äº†åœ¨æ­¥éª¤ 1 ä¸­ä½¿ç”¨`As`åˆ†é…çš„åç§° build çš„é˜¶æ®µ 1ã€‚è¿™å°†å‘Šè¯‰ Docker ä»é˜¶æ®µ`build`å¤åˆ¶æ‰€æœ‰æ–‡ä»¶ã€‚

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæ–°çš„å›¾åƒ:

```
docker build -t docker-app-multistage-image
```

æœ€åï¼Œåœ¨ä¸åŒçš„ç«¯å£ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚

```
docker run --name docker-app-multistage-container -d -p 8888:80 docker-app-multistage-image
```

ç°åœ¨è¿›å…¥æµè§ˆå™¨ï¼Œè¾“å…¥ [http://localhost:8888/](http://localhost:8080/) ä½ ä¼šçœ‹åˆ°å®ƒæ­£åœ¨è¿è¡Œï¼

# ç»“è®ºğŸ‰

> æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæ‚¨æœ‰ï¼Œ ***è¯·å…³æ³¨æˆ‘çš„*** [***ä¸­å‹***](https://medium.com/@mrahmedkhan019) ***å’Œ***[***Twitter***](https://twitter.com/50shadeofkhan)***ä»¥è·å–æ›´å¤šå…³äºè½¯ä»¶å¼€å‘æ–‡ç« çš„é€šçŸ¥ï¼Œä¸è¦å¿˜è®°ç‚¹å‡»*** ã€‚ç»ˆäºï¼æ„Ÿè°¢é˜…è¯»ï¼Œå¿«ä¹å­¦ä¹ ï¼

[](https://medium.com/javascript-in-plain-english/angular-regime-series-tree-shaking-technique-3dc07f5e85a1) [## æ ‘æœ¨å€¾æ–œåœ°æ‘‡æ™ƒç€

### ç”¨æ¸©æŸ”çš„æ–¹å¼ï¼Œä½ å¯ä»¥æ’¼åŠ¨ä¸–ç•Œï¼

medium.com](https://medium.com/javascript-in-plain-english/angular-regime-series-tree-shaking-technique-3dc07f5e85a1) [](https://medium.com/javascript-in-plain-english/a-deep-dive-into-web-components-3f7d6713da9e) [## å¯¹ Web ç»„ä»¶çš„æ·±å…¥ç ”ç©¶

### åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶ Web ç»„ä»¶ï¼Œå¹¶äº†è§£ä¸ºä»€ä¹ˆå‰ç«¯å¼€å‘äººå‘˜è¿«åˆ‡éœ€è¦â€¦

medium.com](https://medium.com/javascript-in-plain-english/a-deep-dive-into-web-components-3f7d6713da9e) [](https://medium.com/@mrahmedkhan019/angular-regime-series-a-guide-to-change-detection-strategy-2a8a4da46c5c) [## è§’åº¦èŒƒå›´ç³»åˆ—:å˜åŒ–æ£€æµ‹ç­–ç•¥æŒ‡å—

### å¼€å‘å¯æŒç»­å˜åŒ–çš„åº”ç”¨ç¨‹åºï¼

medium.com](https://medium.com/@mrahmedkhan019/angular-regime-series-a-guide-to-change-detection-strategy-2a8a4da46c5c) 

# **ç®€æ˜è‹±è¯­ç¬”è®°**

ä½ çŸ¥é“æˆ‘ä»¬æ¨å‡ºäº†ä¸€ä¸ª YouTube é¢‘é“å—ï¼Ÿæˆ‘ä»¬åˆ¶ä½œçš„æ¯ä¸ªè§†é¢‘éƒ½æ—¨åœ¨æ•™ç»™ä½ ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚ç‚¹å‡» ç‚¹å‡» [**æŸ¥çœ‹æˆ‘ä»¬ï¼Œå¹¶ç¡®ä¿è®¢é˜…è¯¥é¢‘é“ğŸ˜**](https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw)