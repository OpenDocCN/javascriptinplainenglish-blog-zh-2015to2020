<html>
<head>
<title>Create Feature Flags For Your React App with Firebase Remote Config</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase远程配置为您的React应用程序创建功能标志</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-feature-flags-for-your-react-app-with-firebase-remote-config-92d17c5e518d?source=collection_archive---------1-----------------------#2020-10-03">https://javascript.plainenglish.io/create-feature-flags-for-your-react-app-with-firebase-remote-config-92d17c5e518d?source=collection_archive---------1-----------------------#2020-10-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ac07ed81c42fb3af323b59db2e304e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_wW6Nk1v_yStVq34szAXQ.png"/></div></div></figure><p id="c48f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">特性标志</strong>(切换/开关)，顾名思义，用于打开和关闭应用程序中的某些特性。您可以添加功能标志，通过为某些用户打开beta功能来执行A/B测试。如果生产中出现问题，您可以将它们用作自动防故障开关。或者，您可以使用它们来隐藏正在进行的功能。</p><p id="391f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我将向您展示如何使用React实现Firebase远程配置的功能标志。</p><h1 id="c5f7" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">1.初始化Firebase🔥</h1><p id="2f86" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我们需要为这个演示安装2个包。如果你已经在你的项目中安装了Firebase，只需安装<code class="fe lw lx ly lz b">semver</code>，我稍后会解释它的用途。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="5f48" class="mi ku in lz b gy mj mk l ml mm">yarn add firebase semver</span></pre><p id="bf98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，创建一个文件<code class="fe lw lx ly lz b">firebase.js</code>来初始化Firebase实例以及您需要的其他Firebase服务，在我们的例子中是<code class="fe lw lx ly lz b">remote-config</code>。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="8cfb" class="mi ku in lz b gy mj mk l ml mm">// firebase.js<br/>import Firebase from 'firebase/app';<br/>import 'firebase/remote-config';</span><span id="2d16" class="mi ku in lz b gy mn mk l ml mm">const firebaseConfig = {};</span><span id="0e81" class="mi ku in lz b gy mn mk l ml mm">export const firebase = Firebase.initializeApp(firebaseConfig);</span></pre><p id="d780" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">前往你的<a class="ae mo" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>并创建一个新项目，如果你没有的话。然后转到项目设置页面获取Firebase SDK配置，并将其粘贴到<code class="fe lw lx ly lz b">firebase.js</code>中。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4cfc" class="mi ku in lz b gy mj mk l ml mm">// Example<br/>const firebaseConfig = {<br/>  apiKey: "Your Api Key",<br/>  authDomain: "yourapp.firebaseapp.com",<br/>  databaseURL: "https://yourapp.firebaseio.com",<br/>  projectId: "yourapp",<br/>  storageBucket: "yourapp.appspot.com",<br/>  messagingSenderId: "Some ID",<br/>  appId: "Some ID",<br/>  measurementId: "Some ID"<br/>};</span></pre><p id="f3cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">随着<code class="fe lw lx ly lz b">firebase</code>实例的初始化，我们可以传递它并调用所有可用的服务。</p><h1 id="2ebe" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">2.在Firebase中创建远程标志🚩</h1><p id="f443" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在Firebase控制台中，转到远程配置部分。你可以在左侧菜单的种植部分找到它。</p><p id="31e8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果这是您的第一次安装，您应该会看到以下内容。输入一个参数键，该参数键将是我们的特征标志名，其默认值将是一个语义版本字符串<code class="fe lw lx ly lz b">^1.0.0</code>。该字符串将与我们在开始时安装的<code class="fe lw lx ly lz b">semver</code>包相关。我将在下一节解释它。</p><figure class="ma mb mc md gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/c0252151cc7d643f5ffaa245d620c40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkBcKY54HMWm86jLdw7wIQ.png"/></div></div></figure><p id="74a8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">添加参数</strong>应该会到达该页面。</p><figure class="ma mb mc md gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/82323519385e87ee0fe9a4a441f8c8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vOzMvtc4abFyvnJN5doJSQ.png"/></div></div></figure><p id="2125" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击<strong class="jx io">发布更改</strong>，您将拥有第一个可以使用的特征标志！</p><h1 id="82ce" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">3.创建FlagsProvider组件</h1><p id="963d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">为了在您的应用程序中共享您的功能标志，我们需要创建一个FlagsProvider来获取我们在上面创建的所有远程标志，并通过上下文API共享它们。</p><p id="e653" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，创建一个<code class="fe lw lx ly lz b">FlagsContext</code>并获得<code class="fe lw lx ly lz b">remoteConfig</code>实例。由于所有提取的远程配置都将缓存在您浏览器的IndexDB中，我们可以在开发中调整缓存的最大年龄，即<code class="fe lw lx ly lz b">minimumFetchIntervalMillis</code>。显然，您也可以自己手动删除缓存。</p><p id="78c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们的provider组件应该接受一个<code class="fe lw lx ly lz b">defaults</code> prop来设置特性标志的默认值。我们将它们保存在一个<code class="fe lw lx ly lz b">flags</code>状态中，并将其传递给下面的提供者，这样当我们设置新的标志时就可以触发重新渲染。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d438" class="mi ku in lz b gy mj mk l ml mm">// FlagsProvider.js<br/>import React from 'react';<br/>import { firebase } from './firebase';</span><span id="e19f" class="mi ku in lz b gy mn mk l ml mm">const FlagsContext = React.createContext({});<br/>const remoteConfig = firebase.remoteConfig();</span><span id="76b4" class="mi ku in lz b gy mn mk l ml mm">// Only for development<br/>remoteConfig.settings = {<br/>  minimumFetchIntervalMillis: 3600000,<br/>};</span><span id="2a42" class="mi ku in lz b gy mn mk l ml mm">const FlagsProvider = ({ defaults, children }) =&gt; {<br/>  const [flags, setFlags] = React.useState(defaults);</span><span id="2704" class="mi ku in lz b gy mn mk l ml mm">  // Next part...</span><span id="1959" class="mi ku in lz b gy mn mk l ml mm">  return (<br/>    &lt;FlagsContext.Provider value={flags}&gt;<br/>      {children}<br/>    &lt;/FlagsContext.Provider&gt;<br/>  );<br/>};</span></pre></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><p id="4995" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将添加一个useEffect挂钩。我们需要将我们的<code class="fe lw lx ly lz b">defaults</code>道具指定为默认配置。然后我们获取并激活所有的远程标志。然后，我们将遍历远程标志并设置我们的<code class="fe lw lx ly lz b">flags</code>状态。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="3d6e" class="mi ku in lz b gy mj mk l ml mm">const FlagsProvider = ({ defaults, children }) =&gt; {<br/>  ...</span><span id="0c5e" class="mi ku in lz b gy mn mk l ml mm">  React.useEffect(() =&gt; {<br/>    remoteConfig.defaultConfig = defaults;</span><span id="1e1e" class="mi ku in lz b gy mn mk l ml mm">    remoteConfig<br/>     .fetchAndActivate()<br/>     .then(activated =&gt; {<br/>        if (!activated) console.log('not activated');<br/>        return remoteConfig.getAll();<br/>     })<br/>     .then(remoteFlags =&gt; {<br/>       const newFlags = {<br/>         ...flags,<br/>       };</span><span id="bd46" class="mi ku in lz b gy mn mk l ml mm">       for (const [key, config] of Object.entries(remoteFlags)) {<br/>         const appVer = process.env.REACT_APP_VERSION;<br/>         newFlags[key] = <br/>            semverSatisfies(appVer, config.asString());<br/>       }</span><span id="c48d" class="mi ku in lz b gy mn mk l ml mm">       setFlags(newFlags);<br/>    })<br/>    .catch(error =&gt; console.error(error));<br/>  }, []);</span><span id="eb52" class="mi ku in lz b gy mn mk l ml mm">  ...<br/>};</span></pre><p id="7f08" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里是<code class="fe lw lx ly lz b">semver</code>帮助我们确定一个标志的布尔状态的地方。<code class="fe lw lx ly lz b">semverSatisfies</code>函数检查给定的版本号是否满足版本范围。</p><p id="5545" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">为了说明它是如何工作的，</strong></p><ul class=""><li id="e773" class="my mz in jx b jy jz kc kd kg na kk nb ko nc ks nd ne nf ng bi translated">我们从环境变量中检索我们的应用程序版本。</li></ul><p id="336d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nh">在本例中，将</em> <code class="fe lw lx ly lz b"><em class="nh">REACT_APP_VERSION=$npm_package_version</em></code> <em class="nh">添加到您的</em> <code class="fe lw lx ly lz b"><em class="nh">.env</em></code> <em class="nh">文件中，这将从您的</em> <code class="fe lw lx ly lz b"><em class="nh">package.json</em></code> <em class="nh">中检索版本号。</em></p><ul class=""><li id="ce06" class="my mz in jx b jy jz kc kd kg na kk nb ko nc ks nd ne nf ng bi translated">我们有1个远程标志，即<code class="fe lw lx ly lz b">['someAwesomeFeatureEnabled', '^1.0.0']</code>。</li><li id="5c29" class="my mz in jx b jy ni kc nj kg nk kk nl ko nm ks nd ne nf ng bi translated">假设我们的应用程序版本是<code class="fe lw lx ly lz b">1.0.1</code>，<code class="fe lw lx ly lz b">semverSatisfies('1.0.1', '^1.0.0')</code>将返回<code class="fe lw lx ly lz b">true</code>。</li><li id="c6a0" class="my mz in jx b jy ni kc nj kg nk kk nl ko nm ks nd ne nf ng bi translated">最后我们称之为<code class="fe lw lx ly lz b">setFlags({ someAwesomeFeatureEnabled: true })</code>。</li></ul><p id="867f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最终版本应该是这样的:</p><figure class="ma mb mc md gt jo"><div class="bz fp l di"><div class="nn no l"/></div></figure><h1 id="0a07" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">4.用FlagsProvider包装你的应用</h1><p id="e702" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">最后，将FlagsProvider包装到根应用程序中，并指定<code class="fe lw lx ly lz b">defaults</code>属性。旗帜名称<strong class="jx io">必须与你在Firebase控制台中设置的名称</strong>相匹配。否则它将无法获取相应的标志。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="c9ae" class="mi ku in lz b gy mj mk l ml mm">import React from 'react';<br/>import FlagsProvider from '...';</span><span id="524c" class="mi ku in lz b gy mn mk l ml mm">const App = () =&gt; {<br/>  return (<br/>    &lt;FlagsProvider<br/>      defaults={{<br/>        someAwesomeFeatureEnabled: false,<br/>      }}<br/>    &gt;<br/>      &lt;YourApp /&gt;<br/>    &lt;/FlagsProvider&gt;<br/>  )<br/>}</span></pre><h1 id="12c7" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">如何访问您的标志</h1><p id="3f5d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">为了让您的生活更轻松，您可以创建一个自定义挂钩来从您的<code class="fe lw lx ly lz b">FlagsContext</code>中检索您的旗帜。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="5bcc" class="mi ku in lz b gy mj mk l ml mm">export const useFlags = () =&gt; {<br/>  const context = React.useContext(FlagsContext);<br/>  return context;<br/>}</span></pre><p id="20bd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你现在可以像这样切换你的牛逼功能👏,</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="dc2c" class="mi ku in lz b gy mj mk l ml mm">const Component = () =&gt; {<br/>  const { someAwesomeFeatureEnabled } = useFlags();  <br/>  return (<br/>    &lt;div&gt;<br/>     {someAwesomeFeatureEnabled &amp;&amp; &lt;SomeAwesomeFeature /&gt;}<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><h1 id="e4d6" class="kt ku in bd kv kw np ky kz la nq lc ld le nr lg lh li ns lk ll lm nt lo lp lq bi translated">全部完成！🎊</h1><p id="6323" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">对我来说，这是一次改变发展的经历。我可以继续开发新功能，一旦它们准备好了，我可以简单地打开标志，而不是重新部署应用程序。</p><p id="f0b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想添加更多的旗帜，只需将它们添加到Firebase和<code class="fe lw lx ly lz b">defaults</code>道具中。每次部署新版本时，请记得更新您的应用版本！</p><p id="1a27" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">远程配置也可以在React Native中完成。API会略有不同，但概念是相同的。</p><div class="nu nv gp gr nw nx"><a href="https://rnfirebase.io/" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">反应天然燃料|反应天然燃料</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">欢迎反应原生火焰基！要开始，您必须首先设置一个Firebase项目并安装“app”模块…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">rnfirebase.io</p></div></div><div class="og l"><div class="oh l oi oj ok og ol jt nx"/></div></div></a></div><p id="6701" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，你在指定版本范围方面有很大的灵活性，查看下面的文档。</p><div class="nu nv gp gr nw nx"><a href="https://github.com/npm/node-semver#ranges" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">NPM/节点-服务器</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">作为一个节点模块:你也可以只加载你关心的函数的模块，如果你想最小化…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol jt nx"/></div></div></a></div><p id="eba9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下次再见，希望这个演示对你有用。😄</p></div></div>    
</body>
</html>