<html>
<head>
<title>How to establish two-way communication using MessageChannel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用MessageChannel建立双向通信</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/message-channels-f94de3488b1a?source=collection_archive---------1-----------------------#2020-04-11">https://javascript.plainenglish.io/message-channels-f94de3488b1a?source=collection_archive---------1-----------------------#2020-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b7b6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">释放JavaScript应用程序中未被充分利用的MessageChannel WebAPI的力量</h2></div><p id="aeee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">消息通道是双方之间的通信媒介，双方通过它发送和接收消息。</p><p id="a5d4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们深入探讨如何在我们的JavaScript应用程序中使用MessageChannel之前，让我们看看它实际上做了什么，以及我们如何简单地使用它们(没有任何框架相关的代码)。当然，有很多例子，但我发现他们都使用旧的iframe示例，这不是MessageChannel唯一有用的地方。</p><blockquote class="lb"><p id="3910" class="lc ld iq bd le lf lg lh li lj lk la dk translated"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API" rel="noopener ugc nofollow" target="_blank">通道消息API </a>的<code class="fe ll lm ln lo b"><strong class="ak">MessageChannel</strong></code>接口允许我们创建一个新的消息通道，并通过它的两个<code class="fe ll lm ln lo b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" rel="noopener ugc nofollow" target="_blank">MessagePort</a></code>属性发送数据。</p><p id="ee01" class="lc ld iq bd le lf lg lh li lj lk la dk translated">— Mozilla</p></blockquote><p id="ad36" class="pw-post-body-paragraph kf kg iq kh b ki lq jr kk kl lr ju kn ko ls kq kr ks lt ku kv kw lu ky kz la ij bi translated">因此，MessageChannel是WebAPI，它使我们能够在任意两个消费者之间建立消息传递通道。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/d484cd23725986cba58c4173ef958104.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*V-NJhs2XadtHgR4Gip-TDA.jpeg"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk">A typical representation of a message channel used in apps</figcaption></figure><p id="462f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们建立第一个信息渠道。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/898f01b1cebc17f7b804dfe7b31dbe2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qevm8h7WlTmM6Vxvy_67og.png"/></div></div></figure><p id="685e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">消息通道意味着在两个消费者之间建立双向通信，我们可以看到<em class="mm"> messageChannel </em>实例有两个端口，一些方法似乎有助于建立这种通信。我们在这里试图实现的是，我们是否可以在端口之间来回触发事件或数据。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mn"><img src="../Images/91ccfdc5699cfdcaa3710ae1b48b1b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJFZLlzKyub4kXiMGJ8ZdA.png"/></div></div></figure><p id="05d2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们做到了，我们刚刚成功地建造了(好吧，用一个已经建造好的🙄)双向通信信道。</p><p id="a7fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯，在开始使用<em class="mm"> postMessage </em>之前，我认为有几点是必须知道的。一个是不要像循环JSON那样传递不可序列化的数据。<br/>其次，<em class="mm"> MessageChannel </em>有一个内置的缓冲区，这意味着如果接收者监听的时间晚于事件调度时间，消息也不会丢失。这可能很难理解，但下面的代码片段会有所帮助。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mo"><img src="../Images/828d03322f98b4a16b831850b7e28057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DgkvWX70ds4Iw8-1XEmpuA.png"/></div></div></figure><p id="0ea4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太酷了，不是吗？不是吗？好问题“在我们的JavaScript应用程序中，我们可以在架构的什么地方使用它？”</p><p id="8450" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据下面给出的图表，考虑一个场景，其中您希望单向或双向传递消息，但没有适当的钻探地狱。一个简洁的方法是:</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mp"><img src="../Images/4ff1fb05f6f2a6dd32b411194fc32d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JWTu9sJ2Xe2vRzE-cAcLg.png"/></div></div></figure><p id="d49c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">隔离消息通道容器或文件，并在您想要使用的组件中使用您的消息通道，例如，在此图中，组件A-2.1和组件C-2.2之间建立了一个通信通道。<br/> <strong class="kh ir">注意:在通道实例的一个端口上，只能注册一个<em class="mm"> onmessage </em>监听器方法。</strong></p><p id="6919" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很好，但是如果我们想将一个事件发送到端口本身，而不是将一个消息发送到其他端口，该怎么办呢？我们甚至可以这样做，因为<em class="mm"> MessageChannel </em>是基于<a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/Event/target" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir">event target API</strong></a><strong class="kh ir">。</strong></p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mq"><img src="../Images/e7c0e813b6d4accc1a3beb2a800fb0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHysX5mYav-XfO4m-nmzmQ.png"/></div></div></figure><p id="b966" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上，我们知道了解这个API可以在很多方面帮助我们(不仅仅是IFrames或Worker类型)。<br/>如果你关心<em class="mm"> postMessage </em>频道的表现，我发现<a class="ae lp" href="https://surma.dev/things/is-postmessage-slow/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">这个博客</strong> </a>确实不错。我希望你今天学到了一些东西。<strong class="kh ir">干杯🍻</strong></p><h2 id="9143" class="mr ms iq bd mt mu mv dn mw mx my dp mz ko na nb nc ks nd ne nf kw ng nh ni nj bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="55a4" class="pw-post-body-paragraph kf kg iq kh b ki nk jr kk kl nl ju kn ko nm kq kr ks nn ku kv kw no ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae lp" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kh ir">AI in Plain English</strong></a><a class="ae lp" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kh ir">UX in Plain English</strong></a><a class="ae lp" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kh ir">Python in Plain English</strong></a><strong class="kh ir"/>——谢谢，继续学习！</p><p id="0fd3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae lp" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir">submissions @ plain English . io</strong></a><strong class="kh ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>