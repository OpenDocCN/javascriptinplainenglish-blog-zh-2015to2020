<html>
<head>
<title>Improve Your App First Load by Making the Flash of Unstyled Text Less Annoying</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过减少无样式文本的闪烁来改善你的应用首次加载</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/improve-your-app-first-load-by-making-the-flash-of-unstyled-text-less-annoying-e94500efa3f4?source=collection_archive---------4-----------------------#2020-06-04">https://javascript.plainenglish.io/improve-your-app-first-load-by-making-the-flash-of-unstyled-text-less-annoying-e94500efa3f4?source=collection_archive---------4-----------------------#2020-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="1274" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">图书馆发现</h2><div class=""/><div class=""><h2 id="f3f4" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用自定义字体有一些你可以考虑的含义，尤其是在开发速度慢/不稳定的连接时。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/089245ec56b85db941546e1c8701d3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAbW49Qsw8CJRvDWZehsDg.png"/></div></div></figure><p id="00e9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果您正在开发web应用程序，您可能会遇到以下情况，页面加载后几毫秒内文本发生变化。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/7225d92c54bc3d0f8f11d9dde06341b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/1*XzIcjIScOL8MsRhBUDopIA.gif"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">This is a FLOUT</figcaption></figure><p id="45d8" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果你是一个“年轻”的开发者，你可能不会有太多的体验，因为<strong class="lc ja">现在我们几乎每个人都有巨大的互联网带宽</strong>。但是几年前，这种情况还是很常见的。</p><p id="c390" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">考虑到这一点，你现在可能会说</p><blockquote class="mb mc md"><p id="fe49" class="la lb me lc b ld le ka lf lg lh kd li mf lk ll lm mg lo lp lq mh ls lt lu lv ij bi translated">好吧，安德烈亚斯，但这不再是2020年的问题了。我为什么要担心？</p></blockquote><p id="dd0f" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">是，也不是…事实上，即使在像巴黎“拉德芳斯”区这样的市中心，您可能会体验到良好的4G数据使用，但仍然有一些地方的互联网速度很慢，甚至是在4G工作的同一个地方，原因有多种:</p><ul class=""><li id="c1f2" class="mi mj iq lc b ld le lg lh lj mk ln ml lr mm lv mn mo mp mq bi translated">同一个地方有太多的人</li><li id="f5cf" class="mi mj iq lc b ld mr lg ms lj mt ln mu lr mv lv mn mo mp mq bi translated">电子干扰，使连接不稳定</li><li id="eebb" class="mi mj iq lc b ld mr lg ms lj mt ln mu lr mv lv mn mo mp mq bi translated">没有光纤也没有无线电中继(非洲，或一些退休的地方)</li></ul><p id="bb21" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果您想了解更多，请随意查看我的关于应用程序离线注意事项的文章。</p><div class="mw mx gp gr my mz"><a href="https://medium.com/javascript-in-plain-english/general-considerations-for-offline-resilient-react-based-apps-8dcb7181e495" rel="noopener follow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ja gy z fp ne fr fs nf fu fw iz bi translated">基于离线弹性反应的应用程序的一般注意事项</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">你应该总是首先把你的应用程序设计成离线的，并且把网络看作是一个增强和…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">medium.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn ky mz"/></div></div></a></div><p id="eb58" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ja">那么优化字体加载是个好主意吗？</strong></p><p id="808a" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当然是的，这可能是个好主意。考虑到实施我们将在下面看到的内容所需的时间，你将为这些人提高你的UX，并让他们开心。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="fd6b" class="nv nw iq bd nx ny nz oa ob oc od oe of kf og kg oh ki oi kj oj kl ok km ol om bi translated">为什么页面加载时字体会闪烁？</h1><p id="b89b" class="pw-post-body-paragraph la lb iq lc b ld on ka lf lg oo kd li lj op ll lm ln oq lp lq lr or lt lu lv ij bi translated">当你加载网页时，浏览器会寻找你在CSS表单中定义的字体，比如这里的<code class="fe os ot ou ov b">Output Sans</code>字体。</p><pre class="kp kq kr ks gt ow ov ox oy aw oz bi"><span id="d2e5" class="pa nw iq ov b gy pb pc l pd pe"><strong class="ov ja">@font-face</strong> {<br/>  font-family: Output Sans;<br/>  src: url(output-sans.woff2) format('woff2'),<br/>       url(output-sans.woff) format('woff');<br/>}</span></pre><p id="a241" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ja">加载带有该字体的页面时，浏览器上会出现什么情况？</strong></p><p id="284c" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">简而言之，事情是这样的:</p><ol class=""><li id="f0e9" class="mi mj iq lc b ld le lg lh lj mk ln ml lr mm lv pf mo mp mq bi translated">浏览器下载HTML文档。</li><li id="3fa9" class="mi mj iq lc b ld mr lg ms lj mt ln mu lr mv lv pf mo mp mq bi translated">它解析它并下载相关资源，如CSS表和JS(如果没有内联)。</li><li id="4a02" class="mi mj iq lc b ld mr lg ms lj mt ln mu lr mv lv pf mo mp mq bi translated">然后，它解析这些资产，并解析它们自己的依赖关系(如果它们有一些依赖关系的话)，在我们的例子中是我们的字体。</li><li id="bce9" class="mi mj iq lc b ld mr lg ms lj mt ln mu lr mv lv pf mo mp mq bi translated">加载后，它会用正确的字体重新绘制用户界面，触发用户界面的变化，你可能会看到一个“闪光”</li></ol><p id="6abd" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ja">这些操作会导致大量的往返。</strong></p><p id="1831" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">您遇到的小闪烁是由于浏览器显示文本时使用了您可以指定的备用字体:<code class="fe os ot ou ov b">font-family: "Output Sans", Times, serif;</code>或者它将依赖于系统默认字体。</p><p id="a961" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">然后，当主字体加载后，它会用新字体替换整个文档字体。</p><p id="a959" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果两者在大小上有太多的差异，这看起来可能不那么奇怪，但是如果你选择了一个非常不同的字体，你可能会看到一些闪光。</p><p id="17a5" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ja">如果你在页面上使用不同的字体，情况会更糟。</strong></p><h1 id="76fb" class="nv nw iq bd nx ny pg oa ob oc ph oe of kf pi kg oh ki pj kj oj kl pk km ol om bi translated">我可以做些什么来防止页面加载时出现字体闪烁效果？</h1><p id="329f" class="pw-post-body-paragraph la lb iq lc b ld on ka lf lg oo kd li lj op ll lm ln oq lp lq lr or lt lu lv ij bi translated">好吧，虽然没有魔术，你能做的就是让默认字体最接近你想要的字体。</p><p id="f20c" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><strong class="lc ja">你可以调整你的风格，让FOUT不那么刺耳</strong>；例如通过确保闪现的字体和加载的web字体看起来大小相同。</p><p id="5a08" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">或者，也许隐藏您的文本，直到字体完全加载。您甚至可以在字体加载时显示页面加载器或动画占位符。</p><p id="c062" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这样，您可以确保在呈现任何文本之前，字体已完全加载。</p><p id="5aa2" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">为了实现这一目标，有各种基于定制类或基于React等web框架的技术。</p><p id="b655" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">请注意，随着使用诸如<strong class="lc ja"> NextJS </strong>或<strong class="lc ja"> NuxtJS </strong>等框架的服务器渲染的“回归”，HTML的第一次渲染是在JS框架在前端初始化时完成的，因此基于CSS的技术是相关的。</p><p id="1f7e" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当然，我不是第一个想到这一点的人，有专门为此目的设计的库，我想在那篇文章中介绍它。</p><h1 id="fe99" class="nv nw iq bd nx ny pg oa ob oc ph oe of kf pi kg oh ki pj kj oj kl pk km ol om bi translated">介绍FontFace Observer:一个在浏览器中加载字体的小库</h1><p id="396e" class="pw-post-body-paragraph la lb iq lc b ld on ka lf lg oo kd li lj op ll lm ln oq lp lq lr or lt lu lv ij bi translated">就库而言，主要有两个可用于此目的，两者都有相似的方法，但优化方式不同，或多或少有些固执己见</p><h2 id="f7a3" class="pa nw iq bd nx pl pm dn ob pn po dp of lj pp pq oh ln pr ps oj lr pt pu ol iw bi translated">网络字体加载器</h2><div class="mw mx gp gr my mz"><a href="https://github.com/typekit/webfontloader" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ja gy z fp ne fr fs nf fu fw iz bi translated">typekit/webfontloader</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">当通过@font-face使用链接字体时，Web字体加载器为您提供额外的控制。- typekit/webfontloader</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">github.com</p></div></div><div class="ni l"><div class="pv l nk nl nm ni nn ky mz"/></div></div></a></div><p id="98a4" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这是一个有点固执己见，给了一点开销，所以我不会在这里开发它，随意看看它。</p><h2 id="c83e" class="pa nw iq bd nx pl pm dn ob pn po dp of lj pp pq oh ln pr ps oj lr pt pu ol iw bi translated">正面观察者</h2><div class="mw mx gp gr my mz"><a href="https://github.com/bramstein/fontfaceobserver" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ja gy z fp ne fr fs nf fu fw iz bi translated">布拉姆斯坦/fontfaceobserver</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">Font Face Observer是一个小型的@font-face加载器和监视器(3.5KB缩小版和1.3KB gzipped版)，兼容任何…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">github.com</p></div></div><div class="ni l"><div class="pw l nk nl nm ni nn ky mz"/></div></div></a></div><p id="e6c6" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">字体外观观察器使用滚动事件以最小的开销有效地检测字体加载。</p><p id="be11" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">文档设计得真的很好，因为它不是真的固执己见，你可以依赖任何你想要的策略。</p><p id="f19f" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">首先用<code class="fe os ot ou ov b">npm install fontfaceobserver</code>或<code class="fe os ot ou ov b">yarn add fontfaceobserver</code>开始安装。</p><p id="70dc" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">然后在CSS表单中注册你的字体</p><pre class="kp kq kr ks gt ow ov ox oy aw oz bi"><span id="8102" class="pa nw iq ov b gy pb pc l pd pe"><strong class="ov ja">@font-face</strong> {<br/>  font-family: Output Sans;<br/>  src: url(output-sans.woff2) format('woff2'),<br/>       url(output-sans.woff) format('woff');<br/>}</span><span id="c3a1" class="pa nw iq ov b gy px pc l pd pe">html.fonts-ready {<br/>  font-family: 'Output Sans', cursive;<br/>  font-size: 18px;<br/>}</span><span id="4a89" class="pa nw iq ov b gy px pc l pd pe">html.fonts-loading {<br/>  font-family: serif;<br/>  font-size: 18px;<br/>}</span></pre><p id="7ab8" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">使用下面的一些片段</p><pre class="kp kq kr ks gt ow ov ox oy aw oz bi"><span id="1b64" class="pa nw iq ov b gy pb pc l pd pe"><strong class="ov ja">const</strong> font = new FontFaceObserver("Output Sans");<br/><br/>font.load().then(() =&gt; {<br/>  console.log('Output Sans has loaded.');</span><span id="8b17" class="pa nw iq ov b gy px pc l pd pe">  // Add and remove custom classes<br/>  document.documentElement.classList.add("fonts-ready");<br/>  document.documentElement.classList.<!-- -->remove<!-- -->("fonts-loading");<br/>});</span></pre><p id="a4d3" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在React中，你可以使用某种<code class="fe os ot ou ov b">useLayoutEffect</code>钩子来达到同样的目的，同时显示其他东西。</p><p id="568e" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">请记住，在大多数情况下，当React及其挂钩被触发时，字体应该已经加载完毕。因此，在安装React应用程序之前，在其他地方这样做可能更有意义</p><h1 id="188b" class="nv nw iq bd nx ny pg oa ob oc ph oe of kf pi kg oh ki pj kj oj kl pk km ol om bi translated">更进一步</h1><p id="c223" class="pw-post-body-paragraph la lb iq lc b ld on ka lf lg oo kd li lj op ll lm ln oq lp lq lr or lt lu lv ij bi translated">您可以在Adobe阅读这篇小文章:</p><div class="mw mx gp gr my mz"><a href="https://helpx.adobe.com/fonts/using/font-events.html" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ja gy z fp ne fr fs nf fu fw iz bi translated">字体事件</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">字体事件可用于控制页面在字体仍在加载或无法加载时的显示方式</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">helpx.adobe.com</p></div></div></div></a></div><p id="38f9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">或者浏览以下网站提供的众多资源:</p><div class="mw mx gp gr my mz"><a href="https://fontfaceobserver.com/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ja gy z fp ne fr fs nf fu fw iz bi translated">字体观察者</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">字体外观观察员给你控制网页字体加载使用一个简单的承诺为基础的界面。没关系…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">fontfaceobserver.com</p></div></div></div></a></div></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="0a9b" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">一如既往随时订阅更多:-)</p><p id="07a2" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><a class="ae py" href="https://codingspark.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja"> 🇫🇷STOP！你是法国人吗🥖？</strong>您也可以访问ici网站，接收法国的私人通讯🙂</a></p><h2 id="ebcc" class="pa nw iq bd nx pl pm dn ob pn po dp of lj pp pq oh ln pr ps oj lr pt pu ol iw bi translated"><strong class="ak">一封来自简明英语的短信</strong></h2><p id="0369" class="pw-post-body-paragraph la lb iq lc b ld on ka lf lg oo kd li lj op ll lm ln oq lp lq lr or lt lu lv ij bi translated">你知道我们推出了一个YouTube频道吗？我们制作的每个视频都旨在教给你一些新的东西。点击此处 查看我们，并确保订阅该频道😎</p></div></div>    
</body>
</html>