<html>
<head>
<title>Developing Office add-ins using Angular 10+ and Nrwl Nx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular 10+和Nrwl Nx开发Office加载项</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/developing-office-plugins-using-angular-and-nx-5aaf4461e967?source=collection_archive---------2-----------------------#2020-11-19">https://javascript.plainenglish.io/developing-office-plugins-using-angular-and-nx-5aaf4461e967?source=collection_archive---------2-----------------------#2020-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2389" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Office插件(桌面和OWA)可以使用标准的网络技术开发，但是微软的模板已经“过时”了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/00644279f16b50dcbf091675f6441f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOmE-EF42zRjgX3wNAXJDQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Picture courtesy of <a class="ae lb" href="https://unsplash.com/@pedro_ag_santos" rel="noopener ugc nofollow" target="_blank">Pedro Santos</a></figcaption></figure><p id="e9a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Web平台开发Microsoft office插件非常酷。不幸的是，至少在这个时候，微软提供的用于生成基于Angular的项目的模板非常“老派”，与现代Angular/Web/TypeScript开发不一致。</p><p id="da16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将向您展示我们可以做得更好，使用标准的Angular项目并集成所需的内容，使其作为Office插件工作。</p><p id="6aec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们开始吧！</p><h1 id="d6ca" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">TLDR；</h1><ul class=""><li id="a5e9" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated">暂时忘掉官方的约曼发电机(yo no-thanks-office)</li><li id="0fa8" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">克隆以下存储库:<a class="ae lb" href="https://github.com/dsebastien/office-plugins-nx-workspace-template" rel="noopener ugc nofollow" target="_blank">https://github . com/dsebastien/office-plugins-NX-workspace-template</a></li><li id="ac07" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">使用<code class="fe mq mr ms mt b">npm install</code>安装依赖项</li><li id="5028" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">使用<code class="fe mq mr ms mt b">npm start</code>启动Word插件</li><li id="ae5b" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">按照README.md的指导方针从侧面加载插件</li><li id="69e2" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">享受</li></ul><h1 id="1e68" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">官方方法及其问题</h1><p id="102e" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">使用Angular开发Office插件的官方方法是使用微软提供的Yeoman生成器，正如这里的<a class="ae lb" href="https://docs.microsoft.com/en-us/office/dev/add-ins/quickstarts/sso-quickstart" rel="noopener ugc nofollow" target="_blank">所解释的</a>。</p><p id="a43a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你遵循指南时，你最终会得到一个类似于<a class="ae lb" href="https://github.com/OfficeDev/Office-Addin-TaskPane-Angular" rel="noopener ugc nofollow" target="_blank">这个</a>的项目。</p><p id="b2e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">生成的项目包括一个非常基本的(尽管已经过时)Webpack构建，它:</p><ul class=""><li id="c0be" class="ma mb iq jp b jq jr ju jv jy mx kc my kg mz kk mh mi mj mk bi translated">将TS传输到JS</li><li id="acb3" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">复制一些资产</li><li id="079a" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">允许使用自定义自签名证书运行带有TLS的开发服务器</li><li id="9da0" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">允许处理HTML模板</li></ul><p id="e06b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就其本身而言，这并不坏，但不如Angular CLI所能提供的那样强大。</p><p id="da22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了Webpack构建之外，该项目还包括许多npm脚本:</p><ul class=""><li id="7472" class="ma mb iq jp b jq jr ju jv jy mx kc my kg mz kk mh mi mj mk bi translated">用于创建生产版本的<code class="fe mq mr ms mt b">build</code>脚本(可部署)</li><li id="cd54" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">创建开发构建的<code class="fe mq mr ms mt b">build:dev</code>脚本(也是可部署的)</li><li id="bb25" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">一个在当地开发的<code class="fe mq mr ms mt b">start</code>剧本</li></ul><p id="6645" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mq mr ms mt b">start</code>脚本的优势在于它可以构建/服务Office插件，还可以启动Word/Excel/etc并根据项目中的manifest.xml描述符直接加载插件。</p><p id="66ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，这一部分实际上非常好，因为它使入门和在Office应用程序(桌面或web)中查看应用程序的运行变得轻而易举。</p><p id="b0ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在来看看不太光彩的部分…</p><p id="2e6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">生成的项目不包含angular.json文件；可能是因为他们构建/附带加载项目的方式。不幸的是，这意味着您几乎可以忘记Angular CLI。这是不幸的，因为这使得过去使用Angular的开发人员更加困难。</p><p id="7225" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另外，Angular的版本已经相当过时了(5.x)，相当糟糕。</p><p id="b398" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我确实找到了解决Angular版本问题的方法，并发布了带有解决方案的<a class="ae lb" href="https://github.com/dsebastien/word-plugin-angular-template" rel="noopener ugc nofollow" target="_blank">首个Github repo，但由于TypeScript和Angular的问题，我对它一点也不满意。</a></p><p id="f772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，安装Angular material不像平常那么容易，因为项目中没有angular.json文件；所以我不得不编了一个并修改文件。此外，我需要修改Webpack的构建，以便能够加载Angular material样式表(meh)。</p><p id="11c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，Angular/TypeScript代码受到Webpack构建不成熟这一事实的影响。</p><p id="a8c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，由于Webpack用于打包/构建所有内容的方式，资产需要直接导入到组件中:</p><pre class="km kn ko kp gt na mt nb nc aw nd bi"><span id="ff2d" class="ne ld iq mt b gy nf ng l nh ni">import { Component } from "@angular/core";<br/>import "../../../assets/icon-16.png";<br/>...<br/>const template = require("./app.component.html");<br/>@Component({  selector: "app-home",  template})<br/>export default class AppComponent {</span></pre><p id="a6ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，组件的模板也是如此。还是那句话，不坏，但是相当讨厌。</p><p id="3bb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，整个项目只有一个CSS文件，这很糟糕；不可能进行样式封装。</p><p id="4b4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一切都归结于没有使用标准的Angular CLI构建这一事实。</p><p id="047b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我认为有可能解决这些问题，但我不想在这条路上走得更远。</p><p id="6a4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，我找到了一个更干净的替代品。</p><h1 id="f7df" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">我的方法</h1><p id="6de6" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">在Github上发布我的代码后不久，我再次阅读了拉加文·拉詹的文章<a class="ae lb" href="https://medium.com/@ragavanrajan/building-office-add-in-using-angular-8-209624ba61ed" rel="noopener">。他走的方向与我相反，他使用NG CLI创建了一个标准的Angular应用程序，并添加了必要的office库/引导代码。</a></p><p id="010c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法比官方的约曼发电机要好得多。</p><p id="57d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他的方法的主要区别是在Office中侧加载插件的方式，这有点烦人，但这是一个<em class="nj">一次性</em>操作。</p><p id="6cbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，它是这样的:</p><ul class=""><li id="ef6f" class="ma mb iq jp b jq jr ju jv jy mx kc my kg mz kk mh mi mj mk bi translated">在本地主机上构建/提供应用程序(http://localhost:4200)</li><li id="2b20" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">创建一个包含manifest.xml文件(也就是外接程序的描述符)的Windows共享(所以是的，只在Windows上工作，meh)</li><li id="31f2" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">通过大量的点击菜单将共享文件夹的UNC添加到受信任的位置</li><li id="8aab" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">加载外接程序</li><li id="e17c" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">享受你剩下的一天</li></ul><p id="c005" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经在这里为Word 详细描述了这个过程，但是对于其他办公产品也是一样。</p><p id="6925" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那我做了什么？</p><ul class=""><li id="16e6" class="ma mb iq jp b jq jr ju jv jy mx kc my kg mz kk mh mi mj mk bi translated">我已经创建了一个Nrwl NX工作区(为什么不呢)来托管项目；这很好，因为你可以根据自己的需要用1-n个office插件实现monorepo</li><li id="c9bf" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我用Nx CLI给它添加了一个Angular 10应用程序</li><li id="68dd" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我已经添加了<a class="ae lb" href="https://github.com/dsebastien/office-plugins-nx-workspace-template/blob/main/package.json" rel="noopener ugc nofollow" target="_blank">必要的办公图书馆</a></li><li id="a5dc" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我已经添加了<a class="ae lb" href="https://github.com/dsebastien/office-plugins-nx-workspace-template/blob/main/apps/word/src/main.ts" rel="noopener ugc nofollow" target="_blank">必要的引导代码</a></li><li id="c85e" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我摆弄了一下<a class="ae lb" href="https://github.com/dsebastien/office-plugins-nx-workspace-template/blob/main/angular.json" rel="noopener ugc nofollow" target="_blank"> angular.json </a>将office.js脚本复制到assets文件夹。我这样做是因为我想创建的应用程序不使用CDN版本。然后，index.html装载它。如果你想要CDN版本，那么只需修改index.html文件</li><li id="932e" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我已经<a class="ae lb" href="https://github.com/dsebastien/office-plugins-nx-workspace-template/blob/main/tsconfig.base.json" rel="noopener ugc nofollow" target="_blank">配置了TypeScript </a>来使用严格模式，以及角度严格模板</li><li id="7ace" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我添加了一个示例manifest.xml文件</li><li id="f5e5" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我添加了几个实用程序脚本来一次性编译整个monorepo</li><li id="1f39" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我测试过它，也用有棱角的材料测试过，只是为了好玩；一切都好！</li></ul><h1 id="8255" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">利益</h1><p id="a6e3" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">好处是显而易见的:一个标准/普通的Angular开发工作流程，更清晰的代码，更好的自动重载开发体验，支持在Angular应用程序中使用模板、CSS、模块等的普通方式。</p><p id="2f24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">唯一的缺点是增加了侧面加载插件的难度，尽管Yeoman generator的方式并没有好到哪里去，因为它经常崩溃；无法启动Web服务器。</p><p id="aac7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，有了这个，也可以利用Angular和NX CLI，这对任何愿意用Angular开发Office插件的人来说都是一个很大的改进。</p><p id="8b10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，任何习惯使用Angular的人也可以轻松地创建Angular 10+的Office加载项，而不会退回到石器时代；-)</p><h1 id="9c9d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="a0db" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">在本文中，我解释了使用Angular开发Office插件的官方方法的问题。</p><p id="fc55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经介绍了我的替代(FOSS)解决方案及其好处。</p><p id="7cf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果想开始用Angular(或者React btw)开发office插件；那么试试这个，你以后会感谢我的..；-)</p><p id="b017" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止！</p></div></div>    
</body>
</html>