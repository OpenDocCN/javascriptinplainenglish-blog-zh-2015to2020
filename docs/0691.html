<html>
<head>
<title>Handling multiple GraphQL server endpoints in a single React Apollo app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在单个React Apollo应用中处理多个GraphQL服务器端点</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/handling-multiple-graphql-server-endpoints-in-a-single-react-apollo-app-badda8ccb1e5?source=collection_archive---------7-----------------------#2019-11-26">https://javascript.plainenglish.io/handling-multiple-graphql-server-endpoints-in-a-single-react-apollo-app-badda8ccb1e5?source=collection_archive---------7-----------------------#2019-11-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f1ae35fabcfa5d4554c42b4aa0ff4671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B9hXpwxOsL5XJwPw.png"/></div></div></figure><p id="bb8a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">事实往往并非如此，假设95%的情况下，您的前端应用程序只有一个解析数据的GraphQL端点。但是我最近遇到了一个项目，我们的前端应用程序需要与两个不同的GraphQL服务器对话。所以我们想出了一个适合我们情况的解决方案。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="b97c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这实际上相当简单，我们需要做的是用我们自己的提供者围绕ApolloProvider创建一个抽象，并控制在该上下文中使用的实际客户端。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="d1fc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们创建一个文件<strong class="jx io"><em class="la">apollocontext . tsx</em></strong></p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2a6c" class="lk ll in lg b gy lm ln l lo lp"><em class="la">import </em>React, { createContext, useContext, <em class="la">ComponentProps</em>, <em class="la">FC</em>, useState } <em class="la">from </em>'react';<br/><em class="la">import </em>ApolloClient <em class="la">from </em>'apollo-boost';<br/><em class="la">import </em>{ ApolloProvider } <em class="la">from </em>'@apollo/react-hooks';</span><span id="d772" class="lk ll in lg b gy lq ln l lo lp"><em class="la">import </em>{ INTERNAL_GRAPHQL, EXTERNAL_GRAPHQL } <em class="la">from </em>'.../config';<br/><em class="la">import </em>{ ServiceType } <em class="la">from </em>'.../constants';<br/><br/><em class="la">interface ApoloContext </em>{<br/>  setCurrentClient: (<em class="la">type</em>: ServiceType) =&gt; <em class="la">void<br/></em>}<br/><br/><em class="la">const </em>ApoloContextProvider = createContext({} <em class="la">as ApoloContext</em>);<br/><br/><em class="la">export const </em>useApoloContext = (): <em class="la">ApoloContext </em>=&gt;<br/>  useContext(ApoloContextProvider);</span><span id="1ef6" class="lk ll in lg b gy lq ln l lo lp"><em class="la">export const </em>ApoloContext: <em class="la">FC </em>=<br/>  ({ <em class="la">children </em>}: <em class="la">ComponentProps</em>&lt;<em class="la">FC</em>&gt;): JSX.<em class="la">Element </em>=&gt; {<br/>  <br/>  <em class="la">const </em>[client, setClient] =<br/>    useState(<em class="la">new </em>ApolloClient({ uri: INTERNAL_GRAPHQL }))<br/><br/>  <em class="la">const </em>setCurrentClient = (<em class="la">type</em>: ServiceType): <em class="la">void </em>=&gt; {<br/>    <em class="la">let </em>url = '';<br/><br/>    <em class="la">switch </em>(<em class="la">type</em>) {<br/>      <em class="la">case </em>ServiceType.<em class="la">External</em>:<br/>        url = EXTERNAL_GRAPHQL;<br/>        <em class="la">break</em>;<br/>      <em class="la">default</em>:<br/>        url = INTERNAL_GRAPHQL<br/>    }<br/><br/>    setClient(<em class="la">new </em>ApolloClient({ uri: url }))<br/>  }<br/><br/>  <em class="la">return </em>(<br/>    &lt;ApoloContextProvider.Provider <em class="la">value</em>={{setCurrentClient}} &gt;<br/>      &lt;ApolloProvider <em class="la">client</em>={client}&gt;<br/>        {<em class="la">children</em>}<br/>      &lt;/ApolloProvider&gt;<br/>    &lt;/ApoloContextProvider.Provider&gt;<br/>  )<br/>};</span></pre></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="29fc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这让你可以在应用需要的时候改变客户端。例如，在下一个组件中，我们将切换到一个外部端点，在这个组件内部使用它，当然，在组件卸载时进行清理。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="dfa7" class="lk ll in lg b gy lm ln l lo lp">...</span><span id="121b" class="lk ll in lg b gy lq ln l lo lp">import { useApoloContext } from '...'<br/><em class="la">import </em>{ ServiceType } <em class="la">from </em>'.../constants';</span><span id="2e00" class="lk ll in lg b gy lq ln l lo lp">...</span><span id="9ce4" class="lk ll in lg b gy lq ln l lo lp">export const ComponentWithExternalGraphQl = () =&gt; {</span><span id="7a37" class="lk ll in lg b gy lq ln l lo lp">   ...</span><span id="891c" class="lk ll in lg b gy lq ln l lo lp">   const { setCurrentClient } = useApoloContext();</span><span id="bfdc" class="lk ll in lg b gy lq ln l lo lp">   useEffect(() =&gt; {<br/>     setCurrentClient(ServiceType.<em class="la">External</em>);<br/>     <br/>     return () =&gt; setCurrentClient(ServiceType.<em class="la">Internal</em>);<br/>   }, [])</span><span id="f4bf" class="lk ll in lg b gy lq ln l lo lp">   ...</span><span id="b33a" class="lk ll in lg b gy lq ln l lo lp">}</span></pre></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="aab8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就像我在开始所说的，如果你遇到需要两个端点的情况，你需要重新思考你的项目结构，这只是一个快速的解决方案来绕过这个障碍。</p><p id="93a7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="la">更多内容看</em> <a class="ae lr" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="la">说白了就是</em> </strong> </a> <em class="la">。报名参加我们的</em> <a class="ae lr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="la">免费周报</em> </strong> </a> <em class="la">。关注我们关于</em> <a class="ae lr" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="la">推特</em> </strong> </a>，<a class="ae lr" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="la">LinkedIn</em></strong></a><em class="la">，</em><a class="ae lr" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="la">YouTube</em></strong></a><em class="la">，以及</em> <a class="ae lr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="la">不和</em> </strong> </a> <strong class="jx io"> <em class="la">。</em>T53】</strong></p><p id="c7f9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="la">对缩放您的软件启动感兴趣</em> </strong> <em class="la">？检查出</em> <a class="ae lr" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="la">电路</em> </strong> </a> <em class="la">。</em></p></div></div>    
</body>
</html>