<html>
<head>
<title>How to define TypeScript types for process.env to have auto-completion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为process.env定义TypeScript类型以实现自动完成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-get-typescript-type-completion-by-defining-process-env-types-6a5869174f57?source=collection_archive---------1-----------------------#2019-10-07">https://javascript.plainenglish.io/how-to-get-typescript-type-completion-by-defining-process-env-types-6a5869174f57?source=collection_archive---------1-----------------------#2019-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e9a7fcca6c9140080b6b006abe1db064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adevMm0quLgTDe3RWygSfw.jpeg"/></div></div></figure><blockquote class="jy"><p id="4d24" class="jz ka iq bd kb kc kd ke kf kg kh ki dk translated">在NodeJS程序中使用<code class="fe kj kk kl km b">process.env</code>函数来消耗环境变量是非常频繁的，这是<a class="ae kn" href="https://12factor.net/config" rel="noopener ugc nofollow" target="_blank">十二因子应用</a>的一个良好实践，这是设计自动扩展应用的一个清单。</p></blockquote><p id="0315" class="pw-post-body-paragraph ko kp iq kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ki ij bi translated">默认情况下，当您在Javascript项目中安装NodeJS TS环境类型(<code class="fe kj kk kl km b">@types/node</code>)时，<code class="fe kj kk kl km b">process.env</code>类型定义如下:</p><pre class="ll lm ln lo gt lp km lq lr aw ls bi"><span id="a4d2" class="lt lu iq km b gy lv lw l lx ly">interface Process extends EventEmitter {<br/>  emitWarning(warning: string | Error, name?: string, ctor?: Function): void;<br/>  env: ProcessEnv;<br/>  exit(code?: number): never;<br/>}<br/><br/>interface ProcessEnv {<br/>  [key: string]: string | undefined;<br/>}</span></pre><p id="fbd7" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated">我们看到流程对象有一个<code class="fe kj kk kl km b">ProcessEnv</code>(一个接口)类型的<code class="fe kj kk kl km b">env</code>属性。该接口由一个带有字符串键和字符串或未定义值的对象组成。</p><p id="b1d3" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated"><strong class="kq ir">太好了！</strong>键入<code class="fe kj kk kl km b">process.env.HOST</code>typescript编译器不会尖叫，另一方面强制检查注入的环境变量，知道哪些变量可用，不太爽……</p><p id="2725" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated"><strong class="kq ir">你会同意:我们可以获得更好的开发体验。</strong></p><p id="0bea" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated">Typescript允许通过使用一个叫做<a class="ae kn" href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces" rel="noopener ugc nofollow" target="_blank">接口合并</a>的概念非常简单地覆盖另一个模块的环境定义，由于这个概念，我们将能够在上游定义<code class="fe kj kk kl km b">process.env</code>中可用的值的表示。</p><h1 id="50de" class="me lu iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">覆盖NodeJS中的流程定义以实现自动完成</h1><p id="6461" class="pw-post-body-paragraph ko kp iq kq b kr nb kt ku kv nc kx ky kz nd lb lc ld ne lf lg lh nf lj lk ki ij bi translated">在我选择的一个名为<code class="fe kj kk kl km b">modules.d.ts</code>的文件中定义了你的项目根文件夹，我们将定义下面的东西。</p><pre class="ll lm ln lo gt lp km lq lr aw ls bi"><span id="b116" class="lt lu iq km b gy lv lw l lx ly">declare namespace NodeJS {<br/>  export interface ProcessEnv {<br/>    HOST: string;<br/>    DB_URL: string;<br/>    DB_NAME?: string;<br/>  }<br/>}</span></pre><p id="f340" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated"><strong class="kq ir">警告:</strong>这个模块必须在使用<code class="fe kj kk kl km b">include</code>属性的<code class="fe kj kk kl km b">tsconfig.json</code>中定义的项目范围内，这样编译器才能找到并考虑到它。</p><p id="4b75" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated">根据typescript doc的定义，默认情况下所有的<code class="fe kj kk kl km b">.d.ts</code>都包括在内。</p><blockquote class="ng nh ni"><p id="8b87" class="ko kp nj kq b kr lz kt ku kv ma kx ky nk mb lb lc nl mc lf lg nm md lj lk ki ij bi translated">如果<code class="fe kj kk kl km b">"files"</code>和<code class="fe kj kk kl km b">"include"</code>都没有指定，编译器默认包含包含目录和子目录中的所有TypeScript ( <code class="fe kj kk kl km b">.ts</code>、<code class="fe kj kk kl km b">.d.ts</code>和<code class="fe kj kk kl km b">.tsx</code>)文件，使用<code class="fe kj kk kl km b">"exclude"</code>属性排除的除外。</p></blockquote><p id="1dad" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated">或者您可以使用<code class="fe kj kk kl km b">types</code>属性手动指定它们，但是您失去了从类型中自动查找的好处，默认情况下查找所有的<code class="fe kj kk kl km b">@types</code>文件夹。<strong class="kq ir">这就是为什么我建议不要使用</strong> <code class="fe kj kk kl km b"><strong class="kq ir">types</strong></code> <strong class="kq ir">键。</strong></p><pre class="ll lm ln lo gt lp km lq lr aw ls bi"><span id="e53f" class="lt lu iq km b gy lv lw l lx ly">// Avoid that if possible<br/>{<br/>  // …<br/>  "types": ["@types/node", "modules.d.ts"]<br/>}</span></pre><p id="11aa" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated"><strong class="kq ir">警告2: </strong>由于env变量的性质，所有值都是字符串，您应该在代码中处理转换。</p><p id="40fa" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated">到目前为止，您的编译器和IDE应该为您提供了自动补全和良好的验证。</p><p id="2fb8" class="pw-post-body-paragraph ko kp iq kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ki ij bi translated"><a class="ae kn" href="https://codingspark.io" rel="noopener ugc nofollow" target="_blank"> <strong class="kq ir"> 🇫🇷STOP！你是法国人吗🥖？</strong>您也可以访问ici网站，接收法国的私人简讯🙂</a></p></div></div>    
</body>
</html>