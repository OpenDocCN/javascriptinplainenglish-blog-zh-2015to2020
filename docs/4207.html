<html>
<head>
<title>Let’s Build a React app with React Hooks and Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们用React钩子和Redux构建一个React应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-create-react-app-with-react-hooks-and-redux-ea1d09057fa2?source=collection_archive---------2-----------------------#2020-11-24">https://javascript.plainenglish.io/lets-create-react-app-with-react-hooks-and-redux-ea1d09057fa2?source=collection_archive---------2-----------------------#2020-11-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9281e5c109b83d3b6593cb7064bfdad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jlPisTpM6ED8_zcIe9O4qg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Image by <a class="ae kc" href="https://unsplash.com/@martinshreder" rel="noopener ugc nofollow" target="_blank">Martin Shreder</a></figcaption></figure><p id="6159" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">网上散布着各种说法，声称Redux非常难设置，会给你留下一大堆难以管理的意大利面代码。我不敢苟同！使用React和Redux实际上非常容易，可维护，并且不会使事情变得复杂。它将事情保持在系统中。</p><p id="8f96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将创建一个非常简单的应用程序来列出姓名和年龄。你可以查看所有列表，添加列表和删除列表。我们不会使用任何数据库。相反，我们将模拟一个包含一组对象的数据库。</p><p id="207c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于Redux的设置非常简单和快速，所以每当我设置一个新的React应用程序时，我都会设置它——我知道它不仅仅是一个小玩具。</p><p id="f2df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我总是将顾虑分成3个步骤:</p><h2 id="033e" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">UI /视图/反应组件</h2><p id="7e5e" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我尝试尽可能少地使用与获取和更新React组件中的数据有关的逻辑。相反，我调用/分派将完成繁重工作的函数。</p><h2 id="5594" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">还原剂</h2><p id="0747" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我设置了我的减速器，以便它们处理所有的状态。它们将数据传递给视图，并处理状态中存储的数据的任何变化。</p><h2 id="8e0d" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">服务</h2><p id="0c83" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">这些服务将处理与后端的通信，无论是向后端服务器、Firebase传递数据还是从后端服务器、Firebase接收数据，或者在本例中是一组模拟数据。</p><p id="befa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在https://github.com/Devalo/react-redux-blog找到源代码</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="661d" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">设置项目</h1><p id="b074" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">对于这个项目，我们将使用create-react-app、redux、redux-thunk和react-redux。Redux-thunk，因为它允许我们编写可爱的redux-action函数。React-redux，因为它包含了一些必备的React挂钩。(会让我们用redux的生活超级轻松！)</p><p id="6df9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将从创建新应用开始:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="c873" class="lb lc iq nc b gy ng nh l ni nj">$ npx create-react-app listings</span></pre><p id="19aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建完成后，我们将其放入cd并安装其他npm软件包:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="ef0e" class="lb lc iq nc b gy ng nh l ni nj">$ cd listings<br/>$ npm install redux redux-thunk react-redux</span></pre><p id="061a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的配置已经完成了一半！我们将创建几个文件夹来存放我们的代码。就像我之前说的，我喜欢尽可能把东西分开。我们将在src/文件夹中创建一个“service”和一个“redux”文件夹:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="8852" class="lb lc iq nc b gy ng nh l ni nj">$ cd src<br/>$ mkdir redux services</span></pre><p id="8fc3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在redux文件夹中创建两个文件。一个reducer文件和redux存储文件。Redux商店是我们州生活的地方。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="167c" class="lb lc iq nc b gy ng nh l ni nj">$ cd redux<br/>$ touch store.js listingsReducer.js</span></pre><p id="65da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还应该创建我们的服务文件:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="05c5" class="lb lc iq nc b gy ng nh l ni nj">$ cd ..<br/>$ cd services<br/>$ touch listingsService.js</span></pre><p id="a079" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是我们的档案。我们将把我们的减速器连接到商店。store.js文件应该如下所示:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="a9a7" class="lb lc iq nc b gy ng nh l ni nj">// redux/store.js</span><span id="d529" class="lb lc iq nc b gy nk nh l ni nj">import { createStore, combineReducers, applyMiddleware } from 'redux';<br/>import thunk from 'redux-thunk';</span><span id="924c" class="lb lc iq nc b gy nk nh l ni nj">import listingsReducer from './listingsReducer';</span><span id="b9bc" class="lb lc iq nc b gy nk nh l ni nj">const reducer = combineReducers({<br/>    listings: listingsReducer,<br/>});</span><span id="4f4d" class="lb lc iq nc b gy nk nh l ni nj">const store = createStore(<br/>  reducer, applyMiddleware(thunk)<br/>)</span><span id="42e6" class="lb lc iq nc b gy nk nh l ni nj">export default store;</span></pre><p id="f96c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这根本不算什么代码。我们将listingsReducer添加到combineReducer函数中。在我们真正开始给这个怪物编码之前，我们还有一件事要做。我们需要使存储对整个应用程序可用。这是因为我们希望能够在应用程序中的任何地方获取状态。在index.js文件中:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="6d5d" class="lb lc iq nc b gy ng nh l ni nj">// index.js</span><span id="4e16" class="lb lc iq nc b gy nk nh l ni nj">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import './index.css';<br/>import App from './App';</span><span id="db1e" class="lb lc iq nc b gy nk nh l ni nj">import { Provider } from 'react-redux';<br/>import store from './redux/store';</span><span id="b7d4" class="lb lc iq nc b gy nk nh l ni nj">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Provider&gt;, <br/>document.getElementById('root')<br/>);</span></pre><p id="fe90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样。在我们将应用程序包装到商店中之后，所有的redux状态都将是全局的，并且很容易为我们所用。是时候开始黑了！</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="b5d1" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">查看所有列表/初始化</h1><p id="d72e" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我撒了点谎。我们还没有真正完成设置或样板文件。但是我们已经准备好了令人兴奋的，很酷的样板文件！我们将从编辑App.js文件开始，我们的应用程序将驻留在该文件中。</p><p id="f89a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">App组件将分派一个从服务中获取数据的动作。数据将被传递给reducer，后者将处理状态，并将其返回给存储。我们的React组件将能够从存储中获取状态。</p><p id="5959" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还没有，这将是一个开始您的应用程序的好时机。我们将把App.js更改为:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="94df" class="lb lc iq nc b gy ng nh l ni nj">// App.js</span><span id="ac52" class="lb lc iq nc b gy nk nh l ni nj">import { useEffect } from 'react';<br/>import { useDispatch, useSelector } from 'react-redux';<br/>import './App.css';</span><span id="b9e5" class="lb lc iq nc b gy nk nh l ni nj">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      Hello There!<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="5c52" class="lb lc iq nc b gy nk nh l ni nj">export default App;</span></pre><p id="9dc3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，我已经导入了三个钩子。使用react中的Effect，使用redux的React包中的Dispatch和useSelector。</p><p id="6dbb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">useSelector将允许我们访问redux存储。useDispatch将让我们调度/启动redux操作函数。我们将在useEffect钩子内部进行初始化，它将在每次渲染时触发。接下来让我们添加:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="a425" class="lb lc iq nc b gy ng nh l ni nj">// App.js</span><span id="65ee" class="lb lc iq nc b gy nk nh l ni nj">... </span><span id="ac44" class="lb lc iq nc b gy nk nh l ni nj">import { initListings } from './redux/listingsReducer';</span><span id="98f2" class="lb lc iq nc b gy nk nh l ni nj">function App() {<br/>  const dispatch = useDispatch();<br/>  <br/>  useEffect(() =&gt; {<br/>    dispatch(initListings());<br/>  }, [dispatch]);<br/>  <br/>  return (</span><span id="636c" class="lb lc iq nc b gy nk nh l ni nj">...</span></pre><p id="faf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在useEffect内部，我们从listingsReducer调度一个导入的函数。我们还没有写这个，所以我们的应用程序会崩溃。接下来让我们来看看我们的减速器。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="3b3d" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">该减速器</h1><p id="3fe3" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">前面，我们创建了一个名为listingsReducer的空文件。reducer将由一个reducer函数和多个action函数组成，前者将是一个switch语句，后者将从服务中获取数据，并将其传递给reducer。我们最初的listingsReducer将如下所示:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="5ca4" class="lb lc iq nc b gy ng nh l ni nj">// redux/listingsReducer</span><span id="50e4" class="lb lc iq nc b gy nk nh l ni nj">import listingsService from '../services/listingsService';</span><span id="2248" class="lb lc iq nc b gy nk nh l ni nj">const listingsReducer = (state = [], action) =&gt; {<br/>    switch (action.type) {<br/>        case 'INIT_LISTINGS':<br/>            return action.data;<br/>        default:<br/>            return state;<br/>    }<br/>};</span><span id="726e" class="lb lc iq nc b gy nk nh l ni nj">export const initListings = () =&gt; {<br/>    return async dispatch =&gt; {<br/>       const listings = await listingsService.getAll(); <br/>       dispatch({<br/>           type: 'INIT_LISTINGS',<br/>           data: listings,<br/>       });<br/>    };<br/>};</span><span id="c179" class="lb lc iq nc b gy nk nh l ni nj">export default listingsReducer;</span></pre><p id="f8ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的操作“initListings”函数将对listingsService进行异步调用。返回的数据将被传递给我们的listingsReducer。请注意，我们用类型来标记传递的对象。在本例中为“INIT_LISTINGS”。</p><p id="a3c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们的reducer将接受两个参数。默认为空数组的状态，以及从动作函数发送的动作对象。</p><p id="7b12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在switch语句中，我们能够对数据的去向进行排序。在这种情况下，我们将直接把数据从服务传递到商店。</p><p id="1957" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在非常接近了。我们需要做的最后一件事是，把我们的初始数据放到我们的视图中，写下我们的服务。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="60c3" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">列表服务</h1><p id="1398" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如前所述，服务文件将负责处理与后端的所有直接通信。在我们的例子中，后端将是一个数组。在实际应用中使用的方法是相同的，只是您要用axios、fetch或类似的东西来切换阵列:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="7740" class="lb lc iq nc b gy ng nh l ni nj">// services/listingsService</span><span id="8291" class="lb lc iq nc b gy nk nh l ni nj">const mockData = [<br/>    {<br/>        name: "Barry Johnson",<br/>        age: 43,<br/>    },<br/>    {<br/>        name: "Chris Evan",<br/>        age: 25,<br/>    },<br/>    {<br/>        name: "Teresa Middleton",<br/>        age: 29,<br/>    },<br/>];</span><span id="2c67" class="lb lc iq nc b gy nk nh l ni nj">const getAll = () =&gt; {<br/>    return mockData;<br/>};</span><span id="f071" class="lb lc iq nc b gy nk nh l ni nj">export default {<br/>    getAll,<br/>};</span></pre><p id="4f2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了一个包含三个对象的数组。这个数组将模拟一个数据库。“getAll”函数返回数据，就像使用axios从数据库中获取数据一样。请注意！如果您刷新应用程序，它会再次恢复。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="835f" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">在视图中显示数据</h1><p id="3b53" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">回到我们的App.js，我们应该能够从我们的商店获得数据。</p><p id="457e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用react钩子“useSelector”来选择我们想要的状态。在这种情况下，它是列表状态:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="fc8b" class="lb lc iq nc b gy ng nh l ni nj">const listings = useSelector((state) =&gt; state.listings);</span></pre><p id="94c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在应该可以显示数据了。我们将编辑我们的JSX代码:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="03cd" class="lb lc iq nc b gy ng nh l ni nj">// App.js</span><span id="0743" class="lb lc iq nc b gy nk nh l ni nj">function App() {<br/>  const dispatch = useDispatch();<br/>  const listings = useSelector((state) =&gt; state.listings)<br/>  <br/>  useEffect(() =&gt; {<br/>    dispatch(initListings());<br/>  }, [dispatch]);<br/>  <br/>  return (<br/>    &lt;div className="App"&gt;<br/>      {listings.map((listing) =&gt; (<br/>        &lt;p&gt;{listing.name}, {listing.age}&lt;/p&gt;<br/>      ))}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="8448" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们循环从州收集的数据，并显示它。</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/6d806d739bf4ddf674f23cc85ca8fa3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*4N_q_t-QEq08i1Nps7QJhg.png"/></div></figure><p id="517a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常酷。让我们讨论一下如何添加新的列表。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="623e" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">将列表添加到redux商店</h1><p id="0d16" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">要添加清单，我们将按照React的方式来做，并创建一个新的组件。由于我们的代码库很小，我们将只在App.js文件中创建组件:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="6d8e" class="lb lc iq nc b gy ng nh l ni nj">// App.js</span><span id="72d8" class="lb lc iq nc b gy nk nh l ni nj"><br/>import { useEffect, useState } from 'react';<br/>...<br/>import { initListings, addListing } from './redux/listingsReducer';</span><span id="8ec9" class="lb lc iq nc b gy nk nh l ni nj">const SubmitListing = () =&gt; {<br/>  const [name, setName] = useState();<br/>  const [age, setAge] = useState();<br/>  const dispatch = useDispatch();<br/>  <br/>  const handleSubmit = (e) =&gt; {<br/>    e.preventDefault();<br/>    <br/>    dispatch(addListing(name, age));<br/>  };<br/>  <br/>  return (<br/>    &lt;form onSubmit={handleSubmit}&gt;<br/>      &lt;input<br/>        type="text"<br/>        placeholder="Name"<br/>        onChange={({ target}) =&gt; setName(target.value)}<br/>      /&gt;<br/>      &lt;input<br/>        type="text"<br/>        placeholder="Age"<br/>        onChange={({ target}) =&gt; setAge(target.value)}<br/>      /&gt;<br/>      &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>    &lt;/form&gt;<br/>  );<br/>};</span><span id="c469" class="lb lc iq nc b gy nk nh l ni nj">...</span><span id="4cea" class="lb lc iq nc b gy nk nh l ni nj">function App() {</span><span id="c889" class="lb lc iq nc b gy nk nh l ni nj">...</span><span id="af14" class="lb lc iq nc b gy nk nh l ni nj">  return (<br/>    &lt;div className="App"&gt;<br/>      ...<br/>      &lt;SubmitListing /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><p id="b408" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们写了一个简单的表格，有两个字段。一个字段用于名称，另一个字段用于年龄。注意，我们在这里使用了另一个钩子，useState钩子。useState钩子将在我们的组件中存储一个本地状态。它非常适合存储我们的字段值。接下来，我们将分派一个尚未编写的新动作addListings动作函数。</p><p id="b912" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还要注意，我们已经将表单组件添加到了主组件中。</p><p id="23d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将跳回我们的reducer并编写我们的addListing动作:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="b50b" class="lb lc iq nc b gy ng nh l ni nj">// redux/listingsReducer.js</span><span id="5c5f" class="lb lc iq nc b gy nk nh l ni nj">...</span><span id="e263" class="lb lc iq nc b gy nk nh l ni nj">export const addListing = (name, age) =&gt; {<br/>    return async dispatch =&gt; {<br/>        const listing = await listingsService.addListing(name, age);<br/>        dispatch({<br/>            type: 'ADD_LISTING',<br/>            data: listing,<br/>        });<br/>    };<br/>};</span><span id="c2f7" class="lb lc iq nc b gy nk nh l ni nj">...</span></pre><p id="7dfd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该操作将把姓名和年龄传递给我们的服务，就像我们在实际应用程序中所做的那样。一旦服务成功地处理了条目，我们就把它传递给缩减器。让我们首先编写我们的服务:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="f24a" class="lb lc iq nc b gy ng nh l ni nj">// services/listingsService.js</span><span id="e051" class="lb lc iq nc b gy nk nh l ni nj">...</span><span id="690b" class="lb lc iq nc b gy nk nh l ni nj">const addListing = (name, age) =&gt; {<br/>    const listing = {<br/>        name,<br/>        age,<br/>    };<br/>    return listing;<br/>};</span><span id="b0c0" class="lb lc iq nc b gy nk nh l ni nj">export default {<br/>    getAll,<br/>    addListing,<br/>};</span></pre><p id="7a7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们没有数据库，我们将把数据打包到一个好的对象中，然后返回。</p><p id="e2a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们跳回到我们的减速器，我们就准备写下一个开关案例:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="0d08" class="lb lc iq nc b gy ng nh l ni nj">// redux/listingsReducer.js</span><span id="e579" class="lb lc iq nc b gy nk nh l ni nj">... <br/>case 'ADD_LISTING': <br/>    return [...state, action.data];</span></pre><p id="bf44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">状态直接来自商店。我们新添加的数据存储在“action.data”中。我们创建一个新的数组，并将旧的状态和新的数据一起放入其中。这是我们修改redux状态的方式。从不通过改变状态，而是返回新的状态对象。新状态将是旧状态+新条目。如果我们打开应用程序:</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/850f91629ced6e4c4815c34f9e73d6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*tmGwvoSCI8Rt7E_BxeMopQ.png"/></div></figure><p id="b022" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到了一种不可思议的形式。如果我们填写表格并提交:</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8cab4a9d9bc53601fb6743607ec3913d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*fUpja8fo5mY4w_DPuLozuw.png"/></div></figure><p id="688f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新数据被添加。<br/>从我们的表单功能- &gt; addListings动作- &gt;服务- &gt; addListings动作- &gt; reducer - &gt; store - &gt;返回视图。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="a032" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">删除列表</h1><p id="7202" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果我们也能找到删除列表的方法，那就太好了。使用redux for state时，从数据库中删除和从存储中删除是两回事。您可以将删除请求传递给服务器，但是状态不会自动更新。我们需要做的是从我们的状态中手动删除条目。让我们看看我们能做些什么。</p><p id="2ff4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的JSX:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="592a" class="lb lc iq nc b gy ng nh l ni nj">{listings.map((listing) =&gt; (<br/>  &lt;p&gt;{listing.name}, {listing.age} <br/>    | &lt;span onClick={() =&gt; removeListing(listing.name)}&gt;(X)&lt;/span&gt; <br/>  &lt;/p&gt;<br/>))}</span></pre><p id="5bb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在每个列表后创建一个小的(X)。当它被点击时，它调用一个函数“removeListing”并将列表名传递给它。</p><p id="ae8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的应用程序组件中，我们添加了一个新功能:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="5247" class="lb lc iq nc b gy ng nh l ni nj">// App.js<br/>import { initListings, addListing, deleteListing } from './redux/listingsReducer';</span><span id="309d" class="lb lc iq nc b gy nk nh l ni nj">...</span><span id="5561" class="lb lc iq nc b gy nk nh l ni nj">const removeListing = (listingName) =&gt; {<br/>    dispatch(deleteListing(listingName));<br/>};</span><span id="61fe" class="lb lc iq nc b gy nk nh l ni nj">...</span></pre><p id="610e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个函数将触发deleteListing操作函数，我们还没有编写这个函数。请注意，我们也在导入它。接下来就写这个吧。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="ba76" class="lb lc iq nc b gy ng nh l ni nj">// redux/listingsReducer.js</span><span id="83f5" class="lb lc iq nc b gy nk nh l ni nj">... </span><span id="5679" class="lb lc iq nc b gy nk nh l ni nj">export const deleteListing = (listingName) =&gt; {<br/>    return async dispatch =&gt; {<br/>        // Here is where you would call the service<br/>        // to delete from the database<br/>        dispatch({<br/>            type: 'DELETE_LISTING',<br/>            data: listingName,<br/>        });<br/>    };<br/>};</span><span id="2f6b" class="lb lc iq nc b gy nk nh l ni nj">...</span></pre><p id="e850" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，我们在这里删除了服务。这是多余的，因为我们没有后端服务。我们只是将列表的名称直接传递给reducer。</p><p id="f01a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要为我们的减速器添加一个新的开关盒:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="4fa6" class="lb lc iq nc b gy ng nh l ni nj">case 'DELETE_LISTING':<br/>    return state.filter(listing =&gt; listing.name !== action.data);</span></pre><p id="9804" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，action.data将是listingName。我们用filter()方法从状态中删除名字，并返回一个新的状态，这个新的状态没有我们删除的条目。</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/3010ebf3ee705fa55da11822b1950d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*HUr1GU3jdw9Ov32Z1A4f0g.png"/></div></figure><p id="39bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们返回应用程序并刷新，我们可以通过单击x来删除条目。</p><p id="cad6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在现实世界的项目中，您不会传递清单名称，并根据名称进行匹配。您应该使用列表ID。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="6ece" class="mg lc iq bd ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt mu mv ls mw bi translated">结束语</h1><p id="48ec" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如您所见，如果您喜欢分离和组织您的代码，使用Redux设置React并不会比没有它时产生更多的样板文件。你应该这么做。</p><p id="61bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以创造出更多的减速器。一个给用户，一个给文章，一个给你需要的任何东西。只需将它们导入redux store，将它们添加到combineReducers()函数中，无论您在应用程序中的什么位置，都可以访问该存储。</p><p id="0c6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您是Redux的新手，请注意我没有改变任何状态。所有的状态处理都是通过向存储返回新的状态对象来完成的。将变异状态返回到存储区会导致难以修复的错误。</p><p id="f209" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在https://github.com/Devalo/react-redux-blog找到源代码</p><p id="6784" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望你喜欢这个。</p><p id="c240" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下次再见<br/>斯蒂芬·巴克伦德·瓦卢瓦</p></div></div>    
</body>
</html>