# å¦‚ä½•é¿å… JavaScript ä¸­çš„ try/catch è¯­å¥åµŒå¥—/é“¾æ¥ï¼Ÿ

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/how-to-avoid-try-catch-statements-nesting-chaining-in-javascript-a79028b325c5?source=collection_archive---------0----------------------->

## ä»¥åŠå¦‚ä½•è®©ä½ çš„ä»£ç æ›´æ•´æ´ï¼Œçœ‹èµ·æ¥æ›´æœ‰åºï¼ç”¨ä¸€ç§ç®€å•ã€å®¹æ˜“ã€é«˜æ•ˆçš„é”™è¯¯å¤„ç†æ–¹æ³•ã€‚

![](img/519472cdb7e5c8025ed5ac83505ac4b7.png)

**ğŸ’¡æ³¨æ„:** *ç»è¿‡è¯»è€…çš„ä¸€äº›åé¦ˆï¼Œæˆ‘æƒ³æ¾„æ¸…ä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆï¼Œä¸‹é¢çš„æ¨¡å¼* ***å¹¶ä¸æ˜¯ç»å…¸çš„å°è¯•/æ•æ‰é”™è¯¯å¤„ç†ç­–ç•¥*** *çš„æ›¿ä»£ã€‚äº‹å®ä¸Šï¼Œåœ¨æŸäº›ç”¨ä¾‹ä¸­ï¼Œå®ƒç”šè‡³å¯ä»¥æ˜¯ä¸€ä¸ªåæ¨¡å¼ã€‚æœ¬æ–‡å±•ç¤ºè¿™ç§æ¨¡å¼çš„æ–¹å¼æ˜¯ä½œä¸º* ***å¤„ç†é”™è¯¯çš„ä¸€ç§è¡¥å……æ–¹å¼*** *å½“æ‚¨æƒ³è¦é‡‡å–ç›´æ¥è¡ŒåŠ¨æ¥å“åº”é”™è¯¯æ—¶ã€‚æœ€åï¼Œ* ***ä½ å°†åœ¨è¿™é‡Œè¯»åˆ°çš„ä¸€åˆ‡éƒ½å–å†³äºæ¯ä¸ªäººçš„ç¼–ç¨‹é£æ ¼*** *è¿˜æœ‰è®¸å¤šå…¶ä»–å¯ç”¨çš„æ¨¡å¼ã€‚è°¢è°¢ä½ çš„å¥½æ„ğŸ™ğŸ»ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­æ–‡ç« *

å¼€å‘äººå‘˜æ¯å¤©éƒ½åœ¨ç¼–å†™ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å®ƒä»¬æ¥æ£€æŸ¥æ½œåœ¨çš„é”™è¯¯ã€‚

â€œTry / Catchâ€è¯­å¥æ— å¤„ä¸åœ¨â€¦æœ‰æ—¶å®ƒä»¬ç”šè‡³æ˜¯åµŒå¥—çš„æˆ–é“¾å¼çš„ã€‚è¿™å¯¼è‡´äº†è¿™æ ·çš„ä¾‹å­:

```
async function anyFunction() {
  try {
    const result = await fetch("http://test.com");
  } catch (e) {
    // Some thing
  }try {
    const anotherresult = await someOtherAsync();
  } catch (error) {
    // some other error
  }
}
```

æ‚¨åˆ°å¤„éƒ½åœ¨ç¼–å†™ try/catch å—ï¼Œä»¥é˜²æ­¢å¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒçš„é”™è¯¯ã€‚æœ‰æ—¶è¿‡åº¦æ˜¯å› ä¸º:

*   ä½ æƒ³æ ‡å‡†åŒ–ä½ çš„é”™è¯¯ç®¡ç†ã€‚
*   å¹¶ä¸”ä½ ä¸æƒ³ä¾èµ–å¤–éƒ¨åº“çš„é”™è¯¯æ ¼å¼(æˆ–è€…å®šåˆ¶å®ƒ)ã€‚

ä½ ä¼šæ‰¿è®¤:è¿™çœŸçš„å¾ˆæ— èŠã€å¤šä½™è€Œä¸”éº»çƒ¦ã€‚

ä½†æ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹é¢çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å°‘é‡ä»£ç åšä¸€äº›æ›´è–„ä¸”éå¸¸å¼ºå¤§çš„ä¸œè¥¿ã€‚

# ğŸ™ğŸ»ä»¥å†·é™çš„æ–¹å¼å¤„ç† JavaScript é”™è¯¯

åœ¨æ¯ç§è¯­è¨€ä¸­ï¼Œå¤„ç†å¼‚å¸¸éƒ½å¾ˆå¸¸è§ã€‚

ä¸€äº›è¯­è¨€â€”â€”æ¯”å¦‚ PHPâ€”â€”èƒ½å¤Ÿåœ¨ catch æŒ‡ä»¤ä¸­æä¾›é”™è¯¯ç±»å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨å¤šä¸ª catch å—ã€‚æœ‰äº›æ²¡æœ‰ï¼Œè€Œä¸”å¤„ç†é”™è¯¯çš„æ–¹å¼æœ‰ç‚¹ç³Ÿç³•ï¼Œæ¯”å¦‚ JavaScriptã€‚

æ‚¨å¯èƒ½ä¼šå¾ˆå¿«é™·å…¥è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå³æ‚¨æ­£åœ¨ç¼–å†™å¤§é‡å¸¦æœ‰åµŒå¥—æˆ–é“¾æ¥çš„ä»£ç ï¼Œè¿™å¯èƒ½ä¼šå˜å¾—éå¸¸å†—é•¿ä¸”ä¸æ˜“äºç»´æŠ¤ã€‚

```
async function anyFunction() {
  try {
    const result = await fetch("http://test.com"); try {
      const another = await fetch("http://blabla.com");
    } catch(anotherError) {
      console.log(anotherError);
    } 
  } catch (e) {
    // Some other error handling
  } try {
    const anotherResult = await someOtherAsync();
  } catch (errorFromAnotherResult) {
    // Some other error
  }
}
```

## **ğŸ’¡ä¸€äº›è¯­è¨€å·²ç»æœ‰å¾ˆå¥½çš„å·¥å…·æ¥å¤„ç†é”™è¯¯**

åƒ GOlang è¿™æ ·çš„è¯­è¨€å¯ä»¥ä»å‡½æ•°çš„è¿”å›è¯­å¥ä¸­è¿”å›å¤šä¸ªå€¼ã€‚è¿™å…è®¸æˆ‘ä»¬è¿”å›ä¸€ä¸ª error(æˆ– null)åŠ ä¸Šä¸€ä¸ªå¸¦æœ‰æ¥è‡ª Promise çš„æœŸæœ›å€¼çš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„éƒ½åœ¨åŒä¸€ä¸ªè¯­å¥ä¸­ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ˜¯ç½‘ç»œè®¢æˆ·çš„ GO ç¤ºä¾‹ã€‚

```
func Listen(host string, port uint16) (net.Listener, error) {
  addr, addrErr := net.ResolveTCPAddr("tcp", fmt.Sprintf("%s:%d", host, port))
  if addrErr != nil {
    return nil, fmt.Errorf("Listen: %s", addrErr)
  }

  listener, listenError := net.ListenTCP("tcp", addr)
  if listenError != nil {
    return nil, fmt.Errorf("Listen: %s", listenError)
  }

  return listener, nil
}
```

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ NodeJS å›è°ƒå…·æœ‰â€œå‡ ä¹â€ç›¸åŒçš„æ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é”™è¯¯(äº‹å®ä¸Š NodeJS å›è°ƒä»¥ç›¸åçš„é¡ºåºä½¿ç”¨è¿™äº›å‚æ•°â€¦ä½†æ˜¯æ‚¨å¾—åˆ°äº†é€»è¾‘)ã€‚

## âœ…æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼å¤„ç† JavaScript é”™è¯¯

è™½ç„¶ JS æ²¡æœ‰å¤šä¸ª return è¯­å¥ï¼Œä½†æ˜¯æœ‰å¦ä¸€ç§æ–¹æ³•æ¥å®ç°æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„æ¨¡å¼ã€‚

æ‚¨å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ•°æ®çš„æ•°ç»„æ¥æ¨¡ä»¿è¿™ç§è¡Œä¸ºï¼Œè¿™ä¹Ÿé€‚ç”¨äºä»»ä½•æ”¯æŒæ•°ç»„çš„è¯­è¨€ã€‚

> â“:å¥½çš„ï¼Œä½ ç°åœ¨èƒ½ç»™æˆ‘çœ‹çœ‹ä»£ç å—ï¼Ÿ

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªå°çš„å®ç”¨å‡½æ•°æ¥åŒ…è£…æˆ‘ä»¬çš„å¼‚æ­¥ä»£ç ã€‚è¿™ä¸ªå‡½æ•°å°†è§£æå’Œæ‹’ç»å‚æ•°æ ¼å¼åŒ–ä¸ºä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚è¿™ä¸ªåŒ…è£…å‡½æ•°åœ¨è¿™é‡Œå°†è¢«ç§°ä¸º`to`ï¼Œä½†æ˜¯ä½ å¯ä»¥éšæ„ç»™å®ƒå–ä»»ä½•åå­—ã€‚

```
/**
 * @param { Promise } promise
 * @param { Object } improved - If you need to enhance the error.
 * @return { Promise }
 */
export function to(promise, improved){
  return promise
    .then((data) => [null, data])
    .catch((err) => {
      if (improved) {
        Object.assign(err, improved);
      }

      return [err]; // which is same as [err, undefined];
    });
}
```

è¿™ä¸ªå‡½æ•°è¿”å›ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„:

*   **åœ¨éšåçš„å›è°ƒ**(å¦‚æœæ‰¿è¯ºå·²è§£å†³):å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¿”å›`null`å’Œ`data`ã€‚
*   **åœ¨ catch å›è°ƒ**(å¦‚æœæ‰¿è¯ºè¢«æ‹’ç»):ç”±äºæ²¡æœ‰æ•°æ®ï¼Œè¿”å›å¯æ‰©å±•çš„`err`å’Œä½œä¸ºç¬¬äºŒä¸ªå…ƒç´ çš„`undefined`ã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨åŸå§‹çš„ try/catch å—ï¼Œå¹¶ä»¥è¿™ç§æ–¹å¼æ›´æ–°å®ƒã€‚è¿™é‡Œæ‰€åšçš„åªæ˜¯ç”¨æˆ‘ä»¬çš„`to`å‡½æ•°åŒ…è£…`someAsyncData`æ‰¿è¯ºã€‚

```
const [error, result] = await to(someAsyncData());if(error){
  // log something and return ?
}const [error2, result2] = await to(someAsyncData2());if(error2){
  // do something else
} else {
  // Here we are sure that result2 is defined and a valid value
}
```

çœ‹èµ·æ¥å¾ˆé…·ï¼Œä¸æ˜¯å—ï¼Ÿå°±è¿™ä¹ˆç®€å•ã€‚å¦‚æœ promise è§£æï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªåŒ…å« null å’Œæ•°æ®çš„æ•°ç»„ï¼Œå¦åˆ™æˆ‘ä»¬è¿”å›é”™è¯¯å’Œ undefinedã€‚

ç°åœ¨ï¼Œé™¤äº†ä¼ ç»Ÿçš„ try/catch å—ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨é¡ºåº like è¯­æ³•æ¥å¤„ç†é”™è¯¯ã€‚

ä½ çŸ¥é“è¿™ç§æ¨¡å¼å—ï¼Ÿä½ å·²ç»åœ¨ç”¨äº†å—ï¼Ÿè¯·åœ¨è¿™é‡Œåˆ†äº«ä½ çš„æ„Ÿå—ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ”¹å˜äº†æ¸¸æˆè§„åˆ™ï¼Œå°½ç®¡å®ƒå¾ˆç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆæ–°æ„ğŸ˜…ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯ä¼ ç»Ÿå¤„ç†é”™è¯¯æ–¹å¼çš„æ›¿ä»£ï¼Œåªæ˜¯å°è¯•ä¸€ä¸‹å¹¶å»ºç«‹è‡ªå·±çš„è§‚ç‚¹ã€‚

è¿™é‡Œæä¾›äº†ä¸€äº›å®ç°è¿™ç§æ¨¡å¼çš„åº“:

*   [https://www.npmjs.com/package/await-to-js](https://www.npmjs.com/package/await-to-js)

[**ğŸ‡«ğŸ‡·STOPï¼ä½ æ˜¯æ³•å›½äººå—ğŸ¥–ï¼Ÿ**æ‚¨ä¹Ÿå¯ä»¥è®¿é—® ici ä»¥æ¥æ”¶æ³•å›½çš„ç§äººç®€è®¯ğŸ™‚](https://codingspark.io)