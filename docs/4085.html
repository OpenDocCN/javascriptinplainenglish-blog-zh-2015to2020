<html>
<head>
<title>Create Elastic Input Using Angular Directive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用角度方向创建弹性输入</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-an-elastic-input-angular-directive-b58d3e61185e?source=collection_archive---------7-----------------------#2020-11-15">https://javascript.plainenglish.io/create-an-elastic-input-angular-directive-b58d3e61185e?source=collection_archive---------7-----------------------#2020-11-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f8d6" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">因为指令很有趣！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d70021477471ba199f71c1158b6aeb83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ctYsBJDobULDFtOinCv-A.jpeg"/></div></div></figure><blockquote class="ko"><p id="e3bb" class="kp kq in bd kr ks kt ku kv kw kx ky dk translated"><em class="kz">“代码就像幽默。当你不得不解释它时，它是坏的”——科里豪斯</em></p></blockquote><p id="cef9" class="pw-post-body-paragraph la lb in lc b ld le jo lf lg lh jr li lj lk ll lm ln lo lp lq lr ls lt lu ky ig bi translated">使用Angular时，指令是强大的模式。深刻理解指令可以帮助您更好地保持开发人员体验，并有助于编写更有意义的代码。</p><p id="2cd1" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated"><strong class="lc io">弹性输入</strong>只是我们给一个根据内容改变宽度的输入字段起的一个好听的名字。</p><h2 id="328b" class="ma mb in bd mc md me dn mf mg mh dp mi lj mj mk ml ln mm mn mo lr mp mq mr ms bi translated">这个计划</h2><p id="331d" class="pw-post-body-paragraph la lb in lc b ld mt jo lf lg mu jr li lj mv ll lm ln mw lp lq lr mx lt lu ky ig bi translated">为此，我们将采取以下步骤。</p><ol class=""><li id="48ec" class="my mz in lc b ld lv lg lw lj na ln nb lr nc ky nd ne nf ng bi translated">创建一个指令，姑且称之为<code class="fe nh ni nj nk b">elasticInput</code>。</li><li id="03e2" class="my mz in lc b ld nl lg nm lj nn ln no lr np ky nd ne nf ng bi translated">创建一个伪DOM元素(<code class="fe nh ni nj nk b">&lt;div&gt;</code>)，并在初始化指令时附加到文档中。</li><li id="7233" class="my mz in lc b ld nl lg nm lj nn ln no lr np ky nd ne nf ng bi translated">将输入字段的值作为<code class="fe nh ni nj nk b">innerText</code>分配给<code class="fe nh ni nj nk b">&lt;div&gt;</code>元素。</li><li id="bbe7" class="my mz in lc b ld nl lg nm lj nn ln no lr np ky nd ne nf ng bi translated">获取<code class="fe nh ni nj nk b">&lt;div&gt;</code>元素的宽度，并显式地将输入宽度设置为等于<code class="fe nh ni nj nk b">&lt;div&gt;</code>的宽度，并带有一个delta值。</li><li id="e1c7" class="my mz in lc b ld nl lg nm lj nn ln no lr np ky nd ne nf ng bi translated">每次输入值改变时，重新计算并更新宽度。</li></ol><p id="1343" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">为了能够应用 <code class="fe nh ni nj nk b"><em class="nq">width</em></code> <em class="nq">属性，您必须将inline input元素转换为block。</em></p><h2 id="3797" class="ma mb in bd mc md me dn mf mg mh dp mi lj mj mk ml ln mm mn mo lr mp mq mr ms bi translated">履行</h2><p id="28e2" class="pw-post-body-paragraph la lb in lc b ld mt jo lf lg mu jr li lj mv ll lm ln mw lp lq lr mx lt lu ky ig bi translated">首先创建指令，</p><pre class="kd ke kf kg gt nr nk ns nt aw nu bi"><span id="bb75" class="ma mb in nk b gy nv nw l nx ny">ng g directive <!-- -->elasticInput<!-- --> </span></pre><p id="9143" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">然后我们将修改指令来实现<code class="fe nh ni nj nk b">OnInit</code>挂钩和注入<code class="fe nh ni nj nk b">DOCUMENT</code>和<code class="fe nh ni nj nk b">ElementRef</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="b401" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">我们需要<code class="fe nh ni nj nk b">DOCUMENT</code>注入器来创建、附加DOM元素和<code class="fe nh ni nj nk b">ElementRef</code>来修改主机元素(输入)的宽度。</p><p id="818a" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">现在让我们更新我们的<code class="fe nh ni nj nk b">ngOnInit()</code>钩子。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="d259" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">每当指令初始化时，我们创建一个虚拟DOM元素，更新样式使它对用户不可见，并使用<code class="fe nh ni nj nk b">appendChild</code>方法附加到DOM。</p><p id="2b6a" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">我们还需要在初始化时更新输入元素的宽度。让我们实现<code class="fe nh ni nj nk b">update()</code>方法来做到这一点。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="aea7" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">这里发生了两件事。</p><ol class=""><li id="7f08" class="my mz in lc b ld lv lg lw lj na ln nb lr nc ky nd ne nf ng bi translated">将虚拟元素的<code class="fe nh ni nj nk b">innerText</code>更新为输入的值(如果存在)或占位符值。</li><li id="5067" class="my mz in lc b ld nl lg nm lj nn ln no lr np ky nd ne nf ng bi translated">更新输入的宽度，使其等于虚拟元件的宽度+一个<code class="fe nh ni nj nk b">20px</code>的增量值。</li></ol><p id="0066" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">为了确保虚拟元素和输入的宽度随着输入值的变化而更新，我们需要在变化检测周期完成后调用<code class="fe nh ni nj nk b">update()</code>方法。为此我们可以使用<code class="fe nh ni nj nk b">ngAfterViewChecked</code>挂钩。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="145d" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">然后，我们将把这个指令附加到应用程序中的任何输入字段，就像这样，</p><blockquote class="ob oc od"><p id="7deb" class="la lb nq lc b ld lv jo lf lg lw jr li oe lx ll lm of ly lp lq og lz lt lu ky ig bi translated">确保您移除了<code class="fe nh ni nj nk b">ngOnDestroy()</code>上的元素，以免不需要的DOM元素被挂起。</p></blockquote><pre class="kd ke kf kg gt nr nk ns nt aw nu bi"><span id="2c63" class="ma mb in nk b gy nv nw l nx ny">&lt;input placeholder="Enter Text" elasticInput/&gt;</span></pre><p id="e849" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">耶！</p><blockquote class="ob oc od"><p id="1fa1" class="la lb nq lc b ld lv jo lf lg lw jr li oe lx ll lm of ly lp lq og lz lt lu ky ig bi translated"><strong class="lc io">注意:</strong>为了从这种方法中获得100%的收益，你需要确保对虚拟元素和输入元素使用相同的<code class="fe nh ni nj nk b">font-family</code>和<code class="fe nh ni nj nk b">font-size</code>，因为这些属性会影响<code class="fe nh ni nj nk b">width</code>。</p></blockquote><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/1c10e8b8d4e6e5ffb9e0eef48405655b.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/1*jh3G1mNDf9QUJJnVRnFqkA.gif"/></div><figcaption class="oi oj gj gh gi ok ol bd b be z dk">Elastic input — preview</figcaption></figure><p id="5fb4" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">完整的源代码可以在<a class="ae om" href="https://gist.github.com/BharathRavi27/0c7019d5963fa5fc071e58755a38160d" rel="noopener ugc nofollow" target="_blank">这里</a>找到。玩StackBlitz演示<a class="ae om" href="https://stackblitz.com/edit/angular-ivy-ckebkq?file=src%2Fapp%2Felastic-input.directive.ts" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="60b1" class="pw-post-body-paragraph la lb in lc b ld lv jo lf lg lw jr li lj lx ll lm ln ly lp lq lr lz lt lu ky ig bi translated">在Twitter上找到我<a class="ae om" href="https://twitter.com/_bharath_ravi" rel="noopener ugc nofollow" target="_blank">这里</a>。黑客快乐！</p></div></div>    
</body>
</html>