<html>
<head>
<title>Maintainable JavaScript — Global Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可维护的JavaScript —全局变量</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/maintainable-javascript-global-variables-9cd02c5d2fce?source=collection_archive---------6-----------------------#2020-09-20">https://javascript.plainenglish.io/maintainable-javascript-global-variables-9cd02c5d2fce?source=collection_archive---------6-----------------------#2020-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8474cec48907ceb1c2e9e5ad0b0ad71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gu6Ns5ZRtyCq36yQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@kylejglenn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kyle Glenn</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b4d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果想继续使用代码，创建可维护的JavaScript代码很重要。</p><p id="9221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过避免全局变量来了解创建可维护JavaScript代码的基础。</p><h1 id="906b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">避免全局</h1><p id="e68e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript的执行环境是独一无二的，因为我们过去常常使用大量的全局变量和函数。</p><p id="891b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript的默认执行环境是处处使用全局变量。</p><p id="8e47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们拥有的一切都被定义为全局对象的属性。</p><p id="cf19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它是一个表示脚本最外层上下文的对象。</p><p id="762e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">window</code>是浏览器中的全局对象。</p><p id="95cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，在全局范围内声明的任何变量或函数都成为了<code class="fe me mf mg mh b">window</code>对象的属性。</p><p id="673d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2818" class="mq lc iq mh b gy mr ms l mt mu">var color = "red"</span></pre><p id="9d66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2025" class="mq lc iq mh b gy mr ms l mt mu">function getColor() {<br/>  console.log(color);<br/>}</span></pre><p id="c58d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过使用以下公式获得这些值:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e86c" class="mq lc iq mh b gy mr ms l mt mu">console.log(window.color)</span></pre><p id="55dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="090d" class="mq lc iq mh b gy mr ms l mt mu">window.getColor();</span></pre><p id="089c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，到处创建全局变量是一种不好的做法，因为它们有很多问题。</p><p id="ef90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它的一个问题是命名冲突。</p><p id="29ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为所有东西都在同一个范围内，所以很可能我们在全局范围内有命名冲突。</p><p id="46bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可能已经在别的地方定义了<code class="fe me mf mg mh b">color</code>全局变量。</p><p id="d8ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将覆盖先前定义的值。</p><p id="f5a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">getColor</code>变量取决于<code class="fe me mf mg mh b">color</code>，所以很难追踪到<code class="fe me mf mg mh b">color</code>的实际值。</p><p id="f21b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不知道<code class="fe me mf mg mh b">color</code>从何而来。</p><p id="6a7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们还面临着这样的风险:这个全局变量以后可能会变成内置的浏览器全局变量。</p><h1 id="9a63" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">代码脆弱性</h1><p id="f7d2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">拥有全局变量使得代码与环境紧密耦合。</p><p id="255b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果环境改变了，那么这个功能就有可能中断。</p><p id="4b01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe me mf mg mh b">color</code>变量不再存在，则<code class="fe me mf mg mh b">getColor</code>方法记录<code class="fe me mf mg mh b">undefined</code>。</p><p id="6e37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着对全局环境的任何更改都可能导致整个代码出错。</p><p id="faa6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何函数都可以随时更改全局变量。</p><p id="8d6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着全局变量的可靠性也值得怀疑。</p><p id="e8e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使我们的代码更健壮，我们应该避免全局变量。</p><p id="91a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们不直接在我们的<code class="fe me mf mg mh b">getColor</code>函数中记录<code class="fe me mf mg mh b">color</code>，而是从一个参数中记录<code class="fe me mf mg mh b">color</code>。</p><p id="c590" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="290c" class="mq lc iq mh b gy mr ms l mt mu">function getColor(color) {<br/>  console.log(color);<br/>}</span></pre><p id="b974" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">改为从参数中获取<code class="fe me mf mg mh b">color</code>。</p><p id="6ce8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就知道它从哪里来了。</p><h1 id="cf12" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试难度</h1><p id="da07" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">拥有全局变量也使得我们的代码难以测试。</p><p id="cba9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果测试依赖于全局变量，那么创建测试是非常困难的，因为它们可以被任何东西改变。</p><p id="cdba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由全局变量引起的代码不同部分之间的紧密耦合会导致不可预知的结果。</p><p id="a139" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们必须通过消除对全局变量的依赖来解决这个问题。</p><p id="5b4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不应该创建自己的全局变量。</p><p id="aabf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们可以依赖JavaScript自带的全局变量，比如<code class="fe me mf mg mh b">Array</code>或<code class="fe me mf mg mh b">Date</code>。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/11bf53f19991746e1de4a49a9b5ebe50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dp7XBasPnyAwqaVN"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@dascal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Adrian Dascal</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="3800" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="cea9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该尽可能避免全局变量。</p><p id="4f72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们使得我们的代码难以测试。</p><p id="c20b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建的代码是脆弱的，因为全局变量可以在任何地方被任何东西改变。</p><h2 id="7f04" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="7ad9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>