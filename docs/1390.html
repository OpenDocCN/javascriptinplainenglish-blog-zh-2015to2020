<html>
<head>
<title>Adding Firebase Auth to your Nuxt.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Firebase Auth添加到Nuxt.js应用程序中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-firebase-authentication-to-a-nuxt-js-spa-application-92beb4a44509?source=collection_archive---------0-----------------------#2020-03-10">https://javascript.plainenglish.io/adding-firebase-authentication-to-a-nuxt-js-spa-application-92beb4a44509?source=collection_archive---------0-----------------------#2020-03-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e1f3105bdf941f6c43f85ef5c7185624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wq8AI5cCm2CPJDiaKhxN7Q@2x.png"/></div></div></figure><p id="d924" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在为我的最新项目Lynk( <a class="ae kt" href="https://lynk.sh" rel="noopener ugc nofollow" target="_blank"> https://lynk.sh </a>)设置主页时，我意识到我需要一种简单而安全的方式来认证和接纳新用户。</p><p id="fea5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">问题是，Lynk的主页是用Nuxt.js编写的单页应用程序(SPA)——虽然有<em class="ku">关于将Firebase添加到服务器端渲染应用程序(SSR)的</em>教程，但没有太多关于如何使用SPA的文档。</p><p id="601c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那我为什么决定去做水疗呢？因为托管真的很容易，也很便宜。对于SSR应用程序(以及一般的Node.js应用程序),您通常需要一个服务器或容器来运行您的代码。然而，使用Nuxt.js，我可以轻松地生成静态HTML、CSS和Javascript，并将其托管在任何地方——无论是Github页面，还是Firebase托管，甚至是Netlify。</p><p id="d963" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，如何将Firebase身份认证添加到SPA中呢？</p><p id="f94a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有三个基本步骤:</p><ol class=""><li id="66fb" class="kv kw in jx b jy jz kc kd kg kx kk ky ko kz ks la lb lc ld bi translated">向Nuxt.js添加Firebase</li><li id="83a8" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">配置Vuex以登录/注册用户</li><li id="4065" class="kv kw in jx b jy le kc lf kg lg kk lh ko li ks la lb lc ld bi translated">向Vuex添加持久性，以便用户保持登录状态</li></ol></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h2 id="3f3a" class="lq lr in bd ls lt lu dn lv lw lx dp ly kg lz ma mb kk mc md me ko mf mg mh mi bi translated">步骤1:向Nuxt.js添加Firebase</h2><p id="4de0" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">这看起来很简单，但是要让它正确地与Nuxt.js一起工作，还有一些注意事项。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/5169ce062226197f4d0e539e54625020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lXHOtvS7uuiMaq3vyVDYvw.png"/></div></div></figure><p id="bc12" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完成此操作后，您可能会遇到一个错误，webpack将无法再生成您的SPA。要解决这个问题，只需修改您的<code class="fe mt mu mv mw b">nuxt.config.js</code>文件，如下所示:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/bbb923aabeb4aacb68151d14e7b46450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z-Q0HKod2ohcKVTGEOmxjw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Source: <a class="ae kt" href="https://gist.github.com/ShivanshVij/c1e9898737ed92e8e030fb3807cc50f4" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ShivanshVij/c1e9898737ed92e8e030fb3807cc50f4</a></figcaption></figure><p id="89cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你会注意到我还添加了两个插件。我们将在以后创建它们。</p><p id="6c19" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，在与您的<code class="fe mt mu mv mw b">nuxt.config.js</code>相同的位置创建一个<code class="fe mt mu mv mw b">babel.config.js</code>文件，并用以下内容填充它:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/e042d3acb68861a6ec3bf9e8fe8d8f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8AFLRIOiOB0Ino48AQjcg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Source: <a class="ae kt" href="https://gist.github.com/ShivanshVij/ddfa1095f0d0fb4d42ed4b7852006ee6" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ShivanshVij/ddfa1095f0d0fb4d42ed4b7852006ee6</a></figcaption></figure><p id="6be2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们需要安装babel依赖项:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/084486180b452762b15e6a29a239d4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*abRoAXSGC9AeqQNtThBanQ.png"/></div></div></figure><p id="e383" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在Firebase可以实际使用了，让我们把它变成一个插件来使用:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/2fe9343a306d97432d8681b8608fff82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wi77GMAuMEd37RUxY6UCYw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Source: <a class="ae kt" href="https://gist.github.com/ShivanshVij/daef4b98b52d78a08a0a30ec7f2f03e8" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ShivanshVij/daef4b98b52d78a08a0a30ec7f2f03e8</a></figcaption></figure><p id="4925" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">确保填写您自己的Firebase配置。上面我还导出了一个Github Auth provider来展示我们如何使用自己的定制OAuth域，而不是提供的Firebase】。</p><p id="39bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们已经在我们的<code class="fe mt mu mv mw b">nuxt.config.js</code>文件中注册了这个插件，所以我们可以继续下一步。</p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h2 id="7c89" class="lq lr in bd ls lt lu dn lv lw lx dp ly kg lz ma mb kk mc md me ko mf mg mh mi bi translated">第2部分:配置Vuex</h2><p id="c1ce" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">我们的Vuex存储需要三样东西:用户状态、设置用户状态的mutator以及登录/注册和注销动作。在Nuxt.js提供的<code class="fe mt mu mv mw b">~/store</code>文件夹中创建一个<code class="fe mt mu mv mw b">index.js</code>文件:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/5e97e0729423b48c33c0e04bce24f38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PENr0N-uxcXUgmPmAn50UA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Source: <a class="ae kt" href="https://gist.github.com/ShivanshVij/9799930e94a33f3136b18e6fee8a305b" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ShivanshVij/9799930e94a33f3136b18e6fee8a305b</a></figcaption></figure><p id="adfd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们开始从我们的<code class="fe mt mu mv mw b">~/plugins/firebase.js</code>导入<code class="fe mt mu mv mw b">auth</code>和<code class="fe mt mu mv mw b">github</code>对象，然后我们设置我们的<code class="fe mt mu mv mw b">user</code>状态对象和赋值函数。</p><p id="b502" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们可以创建我们的<code class="fe mt mu mv mw b">logout</code>函数，它只是等待Firebase将我们注销，然后清除用户状态。然后是处理注册和登录的<code class="fe mt mu mv mw b">login</code>函数。它总是首先尝试注册用户，如果他们已经注册了，它就会尝试让他们登录。</p><p id="6673" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv mw b">login</code>功能是手动邮箱地址+密码认证，不是OAuth。为了使用OAuth，我们有一个单独的<code class="fe mt mu mv mw b">loginGithub</code>动作，让Firebase使用弹出窗口处理OAuth。</p><p id="4af8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们继续之前，我们需要确保我们的<a class="ae kt" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>被正确配置为允许登录。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/60f1baea2cc7079afe22be4ed9e125d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hVeXHgSfDwYxLI4bv1CJA.png"/></div></div></figure><p id="efd3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你打算使用OAuth，确保你已经启用了电子邮件/密码认证和Github。</p><p id="5724" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">稍后，我将解释如何为OAuth使用您自己的自定义域，因此如果您对此感兴趣，请确保您已经将其添加为授权域:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/a07bd9ae75e9ce6d199e34028f5c711c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYGzGTnu4PMANby3zfPpjw.png"/></div></div></figure><p id="2ca7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里我添加了<a class="ae kt" href="https://lynk.sh" rel="noopener ugc nofollow" target="_blank"> https://lynk.sh </a>作为授权域。</p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h2 id="1d43" class="lq lr in bd ls lt lu dn lv lw lx dp ly kg lz ma mb kk mc md me ko mf mg mh mi bi translated">第3部分:添加持久性</h2><p id="669a" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">如果您现在尝试使用如下所示的登录功能登录您的应用程序，它将正常工作。然而，当你导航到一个不同的页面(使用类似<code class="fe mt mu mv mw b">this.$router.push();</code>的东西)时，你会丢失你的状态，并且在这样做的过程中也会丢失你的身份验证。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/ea38d9432d334d22e54465f8044b71c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjwmKjGiFvpJ7Jp2-69taA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Source: <a class="ae kt" href="https://gist.github.com/ShivanshVij/f1f75fa3a9a2c05a7a46ac3ce3f6f91d" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ShivanshVij/f1f75fa3a9a2c05a7a46ac3ce3f6f91d</a></figcaption></figure><p id="5396" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了保持这一点，我们将使用一个npm库:<code class="fe mt mu mv mw b">vuex-persistedstate</code></p><p id="b39b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先安装它:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/7f1ea41cfddd42b7d843f3ba2a5bbfb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uohkfKejwcV6_M3f5qUD6Q.png"/></div></div></figure><p id="682d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">安装完成后，创建我们之前添加到<code class="fe mt mu mv mw b">nuxt.config.js</code>中的localStorage插件:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/66350bdfcd9e1158cd1995c5151c292e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TNT6ICZ6ymmZ0-X8jriOtQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Source: <a class="ae kt" href="https://gist.github.com/ShivanshVij/32f30073fa67dee80c6609d0fa04af84" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/ShivanshVij/32f30073fa67dee80c6609d0fa04af84</a></figcaption></figure><p id="d177" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！现在您可以放心地在您的Nuxt.js应用程序中使用Firebase身份验证了！</p></div><div class="ab cl lj lk hr ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ig ih ii ij ik"><h2 id="6fa0" class="lq lr in bd ls lt lu dn lv lw lx dp ly kg lz ma mb kk mc md me ko mf mg mh mi bi translated">如何为OAuth使用自定义域</h2><p id="b24e" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">如果您确实想为OAuth提供者使用自定义域，而不是提供的Firebase】，请执行以下操作:</p><p id="ff2d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，在<code class="fe mt mu mv mw b">~/plugins/firebase.js</code>中修改你的<code class="fe mt mu mv mw b">config</code>对象:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/dff0a9dc4ae4687b8815b6e7733dda77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtaBkfw9f4ZUaRxKbc142g.png"/></div></div></figure><p id="dc4f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对我来说那就是<code class="fe mt mu mv mw b">authDomain: "lynk.sh"</code>。</p><p id="9599" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，在OAuth应用程序中修改回调url:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/da6e3bacee5c9a69dcd001e4dbd79b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DNe2q9ZPmRnUixPXZVVe9g.png"/></div></div></figure><p id="7ab3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">确保使用您的自定义域，而不是提供的域<code class="fe mt mu mv mw b">https://&lt;APP&gt;.firebaseapp.com/__/auth/handler</code>。</p><p id="d837" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这样，你就可以开始了！</p><p id="c17f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读！如果您有任何问题，请随时通过<code class="fe mt mu mv mw b">shivanshvij@loopholelabs.io</code>联系我。</p><p id="7943" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我最近花了很多时间开发Lynk，这是一个允许开发者安全地向互联网公开他们基于TCP的服务的工具。不再需要处理端口转发、绕过防火墙或设置动态DNS。有了Lynk，你可以开始一个隧道，并继续发展。</p><p id="6755" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想了解Lynk，请在<a class="ae kt" href="https://lynk.sh" rel="noopener ugc nofollow" target="_blank"> https://lynk.sh </a>注册我们的邮件列表</p><p id="8658" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">查看我们的产品搜索:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="a60e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在<code class="fe mt mu mv mw b"><a class="ae kt" href="https://shivanshvij.com" rel="noopener ugc nofollow" target="_blank">https://shivanshvij.com</a></code>、<code class="fe mt mu mv mw b"><a class="ae kt" href="https://github.com/shivanshvij" rel="noopener ugc nofollow" target="_blank">https://github.com/shivanshvi</a>j</code>或<code class="fe mt mu mv mw b"><a class="ae kt" href="https://linkedin.com/in/shivanshvij" rel="noopener ugc nofollow" target="_blank">https://linkedin.com/in/shivanshvij</a></code>找到更多关于我的信息</p></div></div>    
</body>
</html>