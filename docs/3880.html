<html>
<head>
<title>How To Find The Caret Inside A Contenteditable Element</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Contenteditable元素中查找插入符号</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-find-the-caret-inside-a-contenteditable-element-955a5ad9bf81?source=collection_archive---------1-----------------------#2020-10-31">https://javascript.plainenglish.io/how-to-find-the-caret-inside-a-contenteditable-element-955a5ad9bf81?source=collection_archive---------1-----------------------#2020-10-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="298e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">获取光标坐标和索引位置以显示交互式UI元素！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/57c8b6500bc1d78fe574ac583f44d373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtM9VEBCuDq4aC2spcZtTA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">You can find this working example at the end of this article.</figcaption></figure><p id="35f3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">是的，我知道…当然有比处理网页上的光标更令人兴奋的话题可以写。但是因为在我最近的项目中，我在这个问题上挣扎了很久，所以我决定分享我的方法——希望它能帮助其中一方。</p><p id="baf2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将创建两种定位插入符号的方法:一种获取X/Y坐标，另一种获取内容中的索引位置。</p><h1 id="88ce" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">问题是</h1><p id="f9b1" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">最近，我构建了一个文本编辑器，用户可以在其中编辑一个<code class="fe mo mp mq mr b">contenteditable</code>元素中的HTML内容。为了调整内容的样式，我想在光标上方显示一个上下文菜单。</p><p id="6dc2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们需要知道插入符号的确切位置。但是我们怎么知道呢？</p><p id="d0d9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您使用一个<code class="fe mo mp mq mr b">input</code>或<code class="fe mo mp mq mr b">textarea</code>元素，那么获取该信息相对容易，因为表单元素本身有一个<code class="fe mo mp mq mr b">selectionStart</code>和<code class="fe mo mp mq mr b">selectionEnd</code>属性。</p><p id="d21b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是对于<code class="fe mo mp mq mr b">contenteditable</code>元素，你没有这些属性。此外，可编辑元素内部可以有嵌套的HTML元素(例如在<code class="fe mo mp mq mr b">div</code>中有一个<code class="fe mo mp mq mr b">strong</code>标签)。这就更难了。</p><p id="fd8d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，我们可以轻松解决这两个问题。</p><h1 id="b1ef" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">解决方案</h1><h2 id="97ec" class="ms ls iq bd lt mt mu dn lx mv mw dp mb le mx my md li mz na mf lm nb nc mh nd bi translated">获取插入符号坐标</h2><p id="d470" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在上面提到的例子中，我想在插入符号的正上方显示一个上下文菜单。因此，我们需要知道它的X和Y坐标。如果我们有了这些，我们可以显示一个具有<code class="fe mo mp mq mr b">position: absolute;</code>属性和适当的顶部和左侧定位的<code class="fe mo mp mq mr b">div</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8ecc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了获得插入符号坐标，我们首先从<code class="fe mo mp mq mr b">window</code>对象中获得选择。所选内容包含关于光标的信息:光标是否被放置、被放置在哪里以及在屏幕上选择了多少内容。</p><p id="1c3a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用该信息来检查是否有光标设置(第7行)。如果这是真的，我们克隆当前范围。范围是选择的基本概念。每个范围代表一对边界点，即选择的起点和终点。</p><p id="a9ec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们的文本编辑器中有一个跨多个字符的范围，我们将该范围折叠到开始处(第9行)。最后，我们可以调用<code class="fe mo mp mq mr b">getClientRects</code>来获取上下文菜单所需的所有定位数据(第10–13行)。该方法与<code class="fe mo mp mq mr b">getBoundingClientRect</code>类似。它返回元素相对于其视口的坐标。</p><p id="df52" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们可以返回定义插入符号左上角的<code class="fe mo mp mq mr b">x</code>和<code class="fe mo mp mq mr b">y</code>。</p><h2 id="220e" class="ms ls iq bd lt mt mu dn lx mv mw dp mb le mx my md li mz na mf lm nb nc mh nd bi translated">获取插入符号索引位置</h2><p id="f826" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">除了上下文菜单示例之外，可能还有不需要X和Y坐标而是需要插入符号的索引位置的用例。当<code class="fe mo mp mq mr b">input.selectionStart</code>返回<code class="fe mo mp mq mr b">input</code>元素中的插入符号位置时，您可能需要一个与<code class="fe mo mp mq mr b">contenteditable</code>元素等效的方法。</p><p id="8fe6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这也可以通过几行代码来实现:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="1044" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们从一个和以前相似的方法开始。获取选择，检查光标是否就位，并克隆范围。现在下一步，我们选择<code class="fe mo mp mq mr b">contenteditable</code>节点的所有文本内容。</p><p id="3f96" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">想象一下，您将在可编辑元素内按下键盘上的<code class="fe mo mp mq mr b">cmd + a</code> / <code class="fe mo mp mq mr b">ctrl + a</code>。这正是我们在内部所做的。然后，我们将选择的结束边界点更改为我们设置的插入符号的索引位置。</p><p id="8584" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们可以通过检查所选内容的长度来返回插入符号的索引位置。</p><h1 id="11bb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">资源</h1><p id="64e5" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">如您所见，将光标定位在<code class="fe mo mp mq mr b">contenteditable</code>元素中只比常规表单元素稍微困难一点。如果你想了解更多关于浏览器中的选择和范围，我真的建议阅读这篇文章。这对我帮助很大！</p><div class="ng nh gp gr ni nj"><a href="https://javascript.info/selection-range" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">选择和范围</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">在本章中，我们将介绍文档中的选择，以及表单域中的选择，例如。JavaScript可以…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">javascript.info</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx kp nj"/></div></div></a></div><p id="185f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于浏览器支持的附加说明:只有当浏览器支持<code class="fe mo mp mq mr b">window.getSelection</code>时，这两种方法才有效。您可以在<a class="ae ny" href="https://caniuse.com/?search=window.getselection" rel="noopener ugc nofollow" target="_blank">Caniuse.com</a>上查看浏览器支持。我希望这对你的项目没问题。</p><h2 id="6cd7" class="ms ls iq bd lt mt mu dn lx mv mw dp mb le mx my md li mz na mf lm nb nc mh nd bi translated">工作示例</h2><p id="ace6" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">您可以在CodeSandbox上找到一个工作示例。请随意将其用于您自己的项目。它使用了与我向您展示的完全相同的方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz nf l"/></div></figure></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="67ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">像往常一样，谢谢你的阅读！如果你知道更好的方法在浏览器中找到carets和游标，请让我知道或在评论部分分享。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><h2 id="e146" class="ms ls iq bd lt mt mu dn lx mv mw dp mb le mx my md li mz na mf lm nb nc mh nd bi translated">进一步阅读</h2><div class="ng nh gp gr ni nj"><a href="https://bit.cloud/blog/meet-component-driven-content-applicable-composable-l24cw7ku" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">满足组件驱动的内容:适用、可组合</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">自从反应和角度等技术出现以来，我们经常把术语“组件”与…联系起来</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">bit.cloud</p></div></div><div class="ns l"><div class="oh l nu nv nw ns nx kp nj"/></div></div></a></div><p id="4d72" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="oi">更多内容请看</em><a class="ae ny" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oi">plain English . io</em></strong></a><em class="oi">。报名参加我们的</em> <a class="ae ny" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="oi">免费周报</em> </strong> </a> <em class="oi">。关注我们关于</em><a class="ae ny" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oi">Twitter</em></strong></a><a class="ae ny" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oi">LinkedIn</em></strong></a><strong class="kx ir"><em class="oi"/></strong><a class="ae ny" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oi">YouTube</em></strong></a><strong class="kx ir"><em class="oi">，以及</em></strong><em class="oi"/><a class="ae ny" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="oi">不和</em> </strong> </a>  <em class="oi">对成长黑客感兴趣？检查</em> <a class="ae ny" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="oi">电路</em> </strong> </a> <strong class="kx ir"> <em class="oi">。</em> </strong></p></div></div>    
</body>
</html>