<html>
<head>
<title>New Things That You Can Do With JavaScript Promises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你可以用JavaScript做一些新的事情</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-promise-evolution-ecmascript-what-is-very-interesting-about-it-ae49dadec9e0?source=collection_archive---------10-----------------------#2020-12-01">https://javascript.plainenglish.io/javascript-promise-evolution-ecmascript-what-is-very-interesting-about-it-ae49dadec9e0?source=collection_archive---------10-----------------------#2020-12-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5e407ce4f49e6c4e5459125d565f1e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vuABwsaULIX7bLh-_M12OQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Do you Promise with JavaScript?</figcaption></figure><p id="f386" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">promise用于处理JavaScript中的<strong class="kb io">异步</strong>操作。</p><p id="e207" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这个承诺是一个克服<a class="ae kx" href="https://www.geeksforgeeks.org/what-is-callback-hell-in-node-js/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io">回调地狱</strong> </a>问题的想法，与<strong class="kb io"> </strong>回调和事件相比<strong class="kb io">有更好的</strong> <strong class="kb io">错误处理</strong>。</p><p id="1c4b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">A <code class="fe ky kz la lb b">Promise</code>处于以下状态之一:</p><ul class=""><li id="cff4" class="lc ld in kb b kc kd kg kh kk le ko lf ks lg kw lh li lj lk bi translated"><em class="ll">待定</em>:初始状态，未履行也未拒绝。</li><li id="c4ab" class="lc ld in kb b kc lm kg ln kk lo ko lp ks lq kw lh li lj lk bi translated"><em class="ll">完成</em>:表示操作成功完成。</li><li id="e164" class="lc ld in kb b kc lm kg ln kk lo ko lp ks lq kw lh li lj lk bi translated"><em class="ll">拒绝</em>:表示操作失败。</li></ul><h2 id="7481" class="lr ls in bd lt lu lv dn lw lx ly dp lz kk ma mb mc ko md me mf ks mg mh mi mj bi translated"><strong class="ak"> 1。基础知识</strong></h2><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="50e6" class="lr ls in lb b gy ms mt l mu mv">Promise.resolve(value);</span></pre><p id="c461" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ky kz la lb b"><strong class="kb io">Promise.resolve()</strong></code>方法返回一个用给定值解析的<code class="fe ky kz la lb b"><a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">Promise</a></code>对象。</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="b537" class="lr ls in lb b gy ms mt l mu mv">Promise.reject(value);</span></pre><p id="af99" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ky kz la lb b"><strong class="kb io">Promise.reject()</strong></code>方法返回一个因给定原因被拒绝的<code class="fe ky kz la lb b">Promise</code>对象。</p><h2 id="1731" class="lr ls in bd lt lu lv dn lw lx ly dp lz kk ma mb mc ko md me mf ks mg mh mi mj bi translated">2.Promise.all()</h2><p id="a8a5" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk my km kn ko mz kq kr ks na ku kv kw ig bi translated">如果每一个承诺值(即:承诺1，2，3)都<strong class="kb io">依赖于彼此的承诺值</strong>，那么使用这个会很有帮助<strong class="kb io"> Promise.all()。</strong></p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="5445" class="lr ls in lb b gy ms mt l mu mv">const promise1 = Promise.resolve(1);<br/>const promise2 = Promise.resolve(2);<br/>const promise3 = Promise.resolve(3);</span><span id="d8e8" class="lr ls in lb b gy nb mt l mu mv">Promise.all([promise1, promise2, promise3])<br/>.then((values) =&gt; {<br/>      console.log(“All promise resolved”,values);})<br/>.catch((error) =&gt;{<br/>      console.log(“Any one Promise Rejected”,error)<br/>})</span></pre><p id="a799" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果所有的承诺都被解析，那么所有被解析的<strong class="kb io">值</strong>作为<strong class="kb io">数组</strong>返回。</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="cc2e" class="lr ls in lb b gy ms mt l mu mv"><strong class="lb io">Output:<br/></strong>"All promise resolved" Array [1, 2, 3]</span></pre><p id="e3b7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果任何一个承诺被拒绝，则返回被拒绝的<strong class="kb io">值</strong>。</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="c582" class="lr ls in lb b gy ms mt l mu mv">const promise1 = Promise.resolve(1);<br/>const promise2 = Promise.reject(2);<br/>const promise3 = Promise.resolve(3);</span><span id="881e" class="lr ls in lb b gy nb mt l mu mv">Promise.all([promise1, promise2, promise3])<br/>.then((values) =&gt; {<br/>      console.log(“All promise resolved”,values);})<br/>.catch((error) =&gt;{<br/>      console.log(“Promise Rejected”,error)<br/>})</span><span id="acc4" class="lr ls in lb b gy nb mt l mu mv"><strong class="lb io">Output:<br/></strong>"Promise Rejected" 2</span></pre><h2 id="ab27" class="lr ls in bd lt lu lv dn lw lx ly dp lz kk ma mb mc ko md me mf ks mg mh mi mj bi translated"><strong class="ak"> 3 </strong>。<strong class="ak"> Promise.allSettled() </strong></h2><p id="40be" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk my km kn ko mz kq kr ks na ku kv kw ig bi translated">当你有<strong class="kb io">多个异步任务</strong>并且<strong class="kb io">不依赖于另一个</strong>来成功完成时，或者你总是想知道每个承诺的结果时，通常会用到它。</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="c262" class="lr ls in lb b gy ms mt l mu mv">const promise1 = Promise.resolve(1);<br/>const promise2 = Promise.resolve(2);<br/>const promise3 = Promise.reject(3)<br/>const promise4 = Promise.resolve(4);<br/>const promises = [promise1, promise2,promise3,promise4];</span><span id="f978" class="lr ls in lb b gy nb mt l mu mv">Promise.allSettled(promises).then((results) =&gt; console.log(results))</span><span id="a65b" class="lr ls in lb b gy nb mt l mu mv"><strong class="lb io">Output:<br/></strong>[<br/>{ status: "fulfilled", value: 1 }, <br/>{ status: "fulfilled", value: 2 }, <br/>{ status: "rejected", reason: 3 }, <br/>{ status: "fulfilled", value: 4 }]</span></pre><h2 id="a8c9" class="lr ls in bd lt lu lv dn lw lx ly dp lz kk ma mb mc ko md me mf ks mg mh mi mj bi translated"><strong class="ak"> 4 </strong>。<strong class="ak"> Promise.any() </strong></h2><p id="bdba" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk my km kn ko mz kq kr ks na ku kv kw ig bi translated">返回一个<strong class="kb io">单个承诺</strong>，该单个承诺使用该承诺的值进行解析。你可以把这当成<strong class="kb io"> Promise.all() </strong>的反义词</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="8ecb" class="lr ls in lb b gy ms mt l mu mv">const promise1 = Promise.resolve(1);<br/>const promise2 = Promise.resolve(2);</span><span id="32d9" class="lr ls in lb b gy nb mt l mu mv">const promises = [promise1, promise2];</span><span id="79a9" class="lr ls in lb b gy nb mt l mu mv">Promise.any(promises).then((value) =&gt; console.log(value))<br/> .catch(error=&gt;{<br/> console.log(error);<br/>})</span><span id="d275" class="lr ls in lb b gy nb mt l mu mv"><strong class="lb io">Output:<br/></strong>1</span></pre><p id="1eb9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ky kz la lb b"><a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError" rel="noopener ugc nofollow" target="_blank">AggregateError</a></code>,<code class="fe ky kz la lb b"><a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" rel="noopener ugc nofollow" target="_blank">Error</a></code>的一个新子类，将单个错误组合在一起。</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="2283" class="lr ls in lb b gy ms mt l mu mv">const promise1 = Promise.reject(1);<br/>const promise2 = Promise.reject(2);</span><span id="7d46" class="lr ls in lb b gy nb mt l mu mv">const promises = [promise1, promise2];</span><span id="48cf" class="lr ls in lb b gy nb mt l mu mv">Promise.any(promises).then((value) =&gt; console.log(value))<br/> .catch(error=&gt;{<br/> console.log(error);<br/>})</span><span id="d258" class="lr ls in lb b gy nb mt l mu mv"><strong class="lb io">Output:<br/></strong>AggregateError: All promises were rejected</span></pre><h2 id="987e" class="lr ls in bd lt lu lv dn lw lx ly dp lz kk ma mb mc ko md me mf ks mg mh mi mj bi translated">承诺，承诺，竞赛</h2><p id="cad4" class="pw-post-body-paragraph jz ka in kb b kc mw ke kf kg mx ki kj kk my km kn ko mz kq kr ks na ku kv kw ig bi translated"><code class="fe ky kz la lb b"><strong class="kb io">Promise.race()</strong></code>方法返回一个承诺，只要iterable中的一个承诺满足或拒绝，该承诺就满足或拒绝，并带有该承诺的值或原因。</p><pre class="mk ml mm mn gt mo lb mp mq aw mr bi"><span id="8e46" class="lr ls in lb b gy ms mt l mu mv">const promise1 = new Promise((resolve, reject) =&gt; {<br/> setTimeout(reject, 500, ‘1’);<br/>});</span><span id="cd68" class="lr ls in lb b gy nb mt l mu mv">const promise2 = new Promise((resolve, reject) =&gt; {<br/> setTimeout(reject, 100, ‘2’);<br/>});</span><span id="cfdf" class="lr ls in lb b gy nb mt l mu mv">Promise.race([promise1, promise2]).then((value) =&gt; {<br/> console.log(value);<br/> // Both resolve, but promise2 is faster<br/>}).catch(error=&gt;{<br/> console.log(error);<br/>})</span><span id="7559" class="lr ls in lb b gy nb mt l mu mv"><strong class="lb io">Output:<br/></strong>"2"</span></pre></div></div>    
</body>
</html>