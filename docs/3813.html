<html>
<head>
<title>How to Build a Reusable Geolocation &amp;&amp; Reverse-Geocoding Web Component</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建可重用的地理定位和反向地理编码Web组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-a-reusable-geolocation-reverse-geocoding-web-component-d18bd7892a5e?source=collection_archive---------16-----------------------#2020-10-26">https://javascript.plainenglish.io/how-to-build-a-reusable-geolocation-reverse-geocoding-web-component-d18bd7892a5e?source=collection_archive---------16-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e1f9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过几个简单的步骤和使用网络标准</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/430bc6df4c1f2c914a2b5fccc46be19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*znIE2yv9Wfh7tvrgUKX_jQ.png"/></div></div></figure><p id="7682" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇小文章中，将向您展示如何构建一个简单的网页，该网页将自动定位您的位置，将其绘制在地图上，并向您显示对应于地图坐标的文本地址。</p><p id="12ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们来定义一些术语:</p><p id="5c25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">地理定位</strong>识别或估计一个物体的真实地理位置，比如一栋建筑或一部手机。</p><p id="ec97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">地理编码</strong>是获取输入文本(如地址或地名)并返回该地点在地球表面的纬度/经度位置的过程。</p><p id="e6bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">反向地理编码</strong>是将地址(如“10 Downing Stree<strong class="kt ir">”</strong>)转换成他的经纬度地理坐标的过程，你可以用它在地图上放置标记或定位地图。</p><p id="80c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">澄清了前面的术语后，我们将需要以下内容来构建我们的位置页面:</p><ul class=""><li id="dc55" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae lw" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank">地图盒</a>用于地图。如果您有一个免费的API令牌来使用他的API，那会很有帮助。</li><li id="ef04" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">基本的JavaScript知识。</li><li id="bacd" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://jquery.com/" rel="noopener ugc nofollow" target="_blank"> Jquery </a>和<a class="ae lw" href="https://jqueryui.com/dialog/" rel="noopener ugc nofollow" target="_blank"> JqueryUI </a>显示所选地址的对话框。如果不想使用Jquery，可以使用“alert”。</li><li id="eeda" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">我们将使用一个<a class="ae lw" href="https://stackblitz.com/" rel="noopener ugc nofollow" target="_blank"> JS在线版</a> r来尝试它(可选)。在文章末尾的参考资料中，我留下了一个在本教程中创建的web应用程序的链接。</li><li id="5758" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">我们将使用<a class="ae lw" href="https://medium.com/javascript-in-plain-english/build-a-reusable-pagination-web-component-with-bootstrap-4-and-litelement-63ff4eebda4b" rel="noopener"> LitElement </a>来构建一个Web组件。LitElement是<em class="mc">遵循</em> <a class="ae lw" href="https://developer.mozilla.org/en-US/docs/Web/Web_Components" rel="noopener ugc nofollow" target="_blank"> <em class="mc"> Web组件标准</em> </a> <em class="mc">规范的简单实现。</em></li></ul><h1 id="2bce" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">步伐</h1><p id="054c" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">我们将构建一个npm项目，所以首先，我们需要创建我们的package.json文件。如果你用的是像<a class="ae lw" href="https://stackblitz.com/" rel="noopener ugc nofollow" target="_blank">https://stackblitz.com/</a>这样的JS在线编辑器，就不需要这么做了。否则，您需要在计算机上安装nodejs，并安装必要的脚本来构建和服务您的应用程序。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="a8e1" class="nf me iq nb b gy ng nh l ni nj">$npm init</span></pre><h2 id="5706" class="nf me iq bd mf nk nl dn mj nm nn dp mn la no np mp le nq nr mr li ns nt mt nu bi translated">配置package.json文件</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/fb6545431902366259c4a27e9d8cb274.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*W6Z94T_Sr2V0Jipz_oHthA.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">package.json file</figcaption></figure><p id="67ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该文件包含我们项目的配置以及我们将使用的库和脚本。</p><p id="7dee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">名称:包的名称。必须是小写字母和一个单词，但可以包含连字符和下划线。</p><p id="071c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">版本:包的版本。当我们在存储库上发布我们的模块时，我们使用它。</p><p id="a26d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Private:如果在package.json中将“private”设置为true，那么npm将拒绝发布它。</p><p id="ad61" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">依赖关系:项目依赖关系。我们将使用litElement依赖项为地图构建Web组件和mapbox-gl库。</p><h2 id="a20c" class="nf me iq bd mf nk nl dn mj nm nn dp mn la no np mp le nq nr mr li ns nt mt nu bi translated">创建包含组件的HTML模板</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/5166428cb04a82b3dee5ccb968bd91a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b5kOniXJ9T5d1uSo_tCxZQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">index.html file</figcaption></figure><ol class=""><li id="a8c3" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ob lt lu lv bi translated">我们在应用程序中添加了Mapbox使用的样式。</li><li id="ce49" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ob lt lu lv bi translated">在这一步中，我们导入了Jquery和JqueryUI库，我们将使用它们来显示一个窗口对话框。这是可选的，您可以用一个本地JavaScript警告替换这个对话框。</li><li id="6998" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ob lt lu lv bi translated">在这里，我们定义了地图容器将使用的样式，以便它占据整个页面。</li></ol><h2 id="4c38" class="nf me iq bd mf nk nl dn mj nm nn dp mn la no np mp le nq nr mr li ns nt mt nu bi translated">导入组件</h2><p id="cd99" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">因为我使用的是stackblitz在线编辑器，所以我将使用index.ts文件来导入组件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/7eb11c850e729223d43ea5a21601c489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*68LwqH5J5R4qK7ZOcQvEpQ.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">Import my-mapbox-component image</figcaption></figure><h2 id="aca7" class="nf me iq bd mf nk nl dn mj nm nn dp mn la no np mp le nq nr mr li ns nt mt nu bi translated">构建Web组件</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/88f40f52f0e52009143acb16ba1a8439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYTdvCdHGBf3LOMKUUi5Ww.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">my-mapbox-component.js part 1.</figcaption></figure><ol class=""><li id="3bf5" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ob lt lu lv bi translated">我们将使用litElement来构建Web组件，所以我们要做的第一件事是扩展LitElement类。</li><li id="cc26" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ob lt lu lv bi translated">第一次呈现Web Component时，我们调用initMap函数，然后刷新Web组件来显示它。</li><li id="d95c" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ob lt lu lv bi translated">如果我们想要使用我们的样式，在本例中，为了呈现Mapbox元素，LitElement createRenderRoot函数是必需的。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4e660ba807ee906b5780a277dec7c1e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*jbTyE8DEGUuOg2owg5fCVw.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">my-mapbox-component.js part 2.</figcaption></figure><p id="6703" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.我们定义了地图的特征:这里是精度和有效时间。</p><p id="2855" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.在这一步中，我们获得浏览器的位置，当我们获得它时，我们调用我们的buildMap函数。给我们的浏览器适当的位置许可是必要的。这个例子已经在Firefox中测试过了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/460cf9123f27883163a585cd20a055fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*kWIKR0MBjproDE3FdHjZHA.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">my-mapbox-component.js part 3.</figcaption></figure><p id="a88e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">6.我们使用从<a class="ae lw" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank">地图框</a>网页获得的令牌，并创建了地图。</p><p id="f1fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">7.我们用当前位置创建标记，并将其绘制在地图上。</p><p id="8e82" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">8.我们调用Mapbox API来获取所获得的坐标的地址。当我们有了地址，我们显示一个对话。</p><p id="47b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">9.我们为地图上的事件“click”创建了一个监听器。这帮助我们移动位置标记，并向我们显示一个带有更新地址的新对话框。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/47a8c9a5824a2af883cb3ef86879379b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*KzfT6JpsZnL9prRduRnq9A.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">my-mapbox-component.js part 4.</figcaption></figure><p id="05d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">10.这是我们创建的一个帮助器函数，用于使用浏览器获取位置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/011df0f39516ecee478ba9e8551c6b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*v1lu8AkAVJe7noS2Ld5-RQ.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">my-mapbox-component.js part 5.</figcaption></figure><p id="ecad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">11.这是我们创建的另一个辅助函数，用于反向地理编码。</p><p id="fb0f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">12.这是呈现组件的LitElement函数。</p><h1 id="e408" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">结果</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/9f968c86107df51d00a82c95986d78b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*WGnJylp4civvXy00Lg2daQ.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">Our component.</figcaption></figure><h1 id="081b" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">结论</h1><p id="c8eb" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la mx lc ld le my lg lh li mz lk ll lm ij bi translated">这篇文章展示了如何创建一个显示我们位置的地图组件。您还可以更改标记，并获取地图上您单击的任何点的地址。现在，您可以在项目中任意多次重用该组件。</p><p id="2193" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请随意复制并改进它，因为它只是展示如何构建地理定位Web组件的初级版本。</p><p id="9d95" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">开始改进代码的一点是使用<a class="ae lw" href="https://medium.com/javascript-in-plain-english/javascript-a-fast-trip-for-dummies-from-callbacks-to-es6-async-await-a61b0a4b0bed" rel="noopener"> async/await </a>使代码更具可读性。</p><p id="a55b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我创建的组件的<a class="ae lw" href="https://stackblitz.com/edit/mapboxcomponent" rel="noopener ugc nofollow" target="_blank">演示和代码</a>。</p><p id="9037" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢你阅读我！保重。</p></div></div>    
</body>
</html>