<html>
<head>
<title>How to use window events in React and access the state</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中使用窗口事件并访问状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-window-events-in-react-and-access-current-state-inside-callbacks-1958816fbdb7?source=collection_archive---------1-----------------------#2020-07-23">https://javascript.plainenglish.io/how-to-use-window-events-in-react-and-access-current-state-inside-callbacks-1958816fbdb7?source=collection_archive---------1-----------------------#2020-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/6b1538296893eccb2a48a1a66ca435f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXdPBD9g4CtA_cjRqIIKYw.png"/></div></div></figure><div class=""/><div class=""><h2 id="51d3" class="pw-subtitle-paragraph jv ix iy bd b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dk translated">使用窗口事件和在react钩子中访问组件当前状态的指南</h2></div><p id="c728" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">如果您曾经尝试在React中使用窗口事件，您会发现事件中组件的状态已经过时，因此下面是组件应该是什么样子才能工作，以及为什么会发生这种情况的解释。</p><p id="5347" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这是我们的空组件和一些导入，现在我们必须让它工作。</p><figure class="lj lk ll lm gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="ea7c" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">现在，我们需要添加一些钩子，<strong class="kp iz"><em class="lp">【useLayoutEffect】</em></strong><em class="lp"/>类似于<strong class="kp iz"><em class="lp">componentDidMount</em></strong>(它们都在组件的同一相位上发射，在这里阅读更多关于这个钩子的内容<a class="ae lq" href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect" rel="noopener ugc nofollow" target="_blank"><strong class="kp iz"/></a>)</p><p id="6b1b" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在下面的代码中，我添加了带有回调函数的<strong class="kp iz"><em class="lp">useLayoutEffect</em></strong>，它返回一个清理函数。</p><figure class="lj lk ll lm gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="5d80" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">接下来，我创建了一个<strong class="kp iz"> useState </strong>钩子、一个<strong class="kp iz"> useRef </strong>钩子和一个函数。</p><figure class="lj lk ll lm gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="fd89" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">但是为什么呢？当我们向事件监听器发送回调时，它会获取当前状态的一个“<em class="lp">快照</em>”，因此在下一个触发事件中，它将使用钩子被调用时的初始状态，而不是当前状态，这就是为什么我们需要使用该值作为ref。</p><p id="8921" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">这是我们最后的代码，解释在那下面。</p><figure class="lj lk ll lm gt ip"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="7920" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">在前13行中，我们定义了我们的状态；有三个部分。首先，我们像往常一样设置我们的<strong class="kp iz"> <em class="lp"> useState </em> </strong>钩子，但是有一点变化，在第二个参数的开头有一个下划线。<br/>然后我们创建一个ref，默认参数为<strong class="kp iz"> <em class="lp"> useState </em> </strong>值。现在我们有了国家和裁判。<br/>最后，我们使用<strong class="kp iz"> <em class="lp"> setState </em> </strong>的命名约定创建一个函数(与第一个类似，但没有下划线)。它做两件事，设置ref值和设置state值。所以当我们调用我们的<strong class="kp iz"> <em class="lp"> setState </em> </strong>的时候；它更新状态和ref。状态在组件中使用，引用在事件回调中使用。</p><p id="3eaa" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">接下来的部分是<strong class="kp iz"> <em class="lp"> useLayoutEffect </em> </strong>。我们为回调创建一个函数(不是一个箭头函数，以便清理工作)，然后我们定义事件并传递这个回调。<br/>如你所知，效果钩子可以返回一个清理函数(类似于<strong class="kp iz"><em class="lp">component will unmount</em></strong>如果你来自基于类的)。我们移除该函数中的事件监听器，传递回调函数。<br/>在回调里面，我们可以使用<strong class="kp iz"> <em class="lp"> ref.current </em> </strong>，它会有当前状态，你也可以使用我们上面创建的<strong class="kp iz"> <em class="lp"> setState </em> </strong>函数。</p><p id="3b3f" class="pw-post-body-paragraph kn ko iy kp b kq kr jz ks kt ku kc kv kw kx ky kz la lb lc ld le lf lg lh li ig bi translated">如果你想玩代码，我会留下一个沙盒。</p><h2 id="6a3f" class="lr ls iy bd lt lu lv dn lw lx ly dp lz kw ma mb mc la md me mf le mg mh mi mj bi translated">希望这篇文章对你有用，感谢阅读。💕😁</h2><figure class="lj lk ll lm gt ip"><div class="bz fp l di"><div class="mk lo l"/></div></figure></div></div>    
</body>
</html>