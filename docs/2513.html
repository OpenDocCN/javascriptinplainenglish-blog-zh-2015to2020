<html>
<head>
<title>Build a beautiful Job Search App using React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React创建一个漂亮的求职应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-beautiful-job-search-app-using-react-7325c4d232c2?source=collection_archive---------1-----------------------#2020-07-01">https://javascript.plainenglish.io/build-a-beautiful-job-search-app-using-react-7325c4d232c2?source=collection_archive---------1-----------------------#2020-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f274" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用延迟加载、上下文API、添加加载更多功能、创建自定义挂钩等等</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a02e62d2c1f7810ad0d06fce42a0b2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OilnGEl03u8Kgcoue5yyQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">GitHub Job Search App</figcaption></figure><h2 id="4003" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">在本文中，我们将使用<a class="ae lr" href="https://jobs.github.com/api" rel="noopener ugc nofollow" target="_blank"> Github Jobs API </a>构建一个漂亮的求职应用程序</h2><p id="b1d7" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma le mb mc md li me mf mg lm mh mi mj mk ij bi translated">通过构建此应用程序，您将了解到:</p><p id="f3da" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">1.如何在React <br/> 2中懒加载图片？如何使用React上下文API在组件之间共享数据<br/> 3。为什么React不会呈现JSX表达式中使用的HTML以及如何在需要时正确显示它<br/> 4。如何在实际图像正在下载时显示替代加载图像<br/> 5。如何使用React Portal <br/> 6创建自己版本的加载程序。如何添加加载更多功能</p><p id="769c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">还有更多。</p><blockquote class="mq mr ms"><p id="80a5" class="ls lt mt lu b lv ml jr lx ly mm ju ma mu mn mc md mv mo mf mg mw mp mi mj mk ij bi translated">你可以在这里看到应用<a class="ae lr" href="https://github-jobs-react-app.netlify.app/" rel="noopener ugc nofollow" target="_blank">的现场演示</a></p></blockquote><h2 id="d886" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">我们开始吧</h2><p id="e9a2" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma le mb mc md li me mf mg lm mh mi mj mk ij bi translated">使用<code class="fe mx my mz na b">create-react-app</code>创建一个新项目</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="0efc" class="kv kw iq na b gy nf ng l nh ni">create-react-app github-jobs-react-app</span></pre><p id="b8bb" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">项目创建完成后，删除<code class="fe mx my mz na b">src</code>文件夹中的所有文件，并在<code class="fe mx my mz na b">src</code>文件夹中创建<code class="fe mx my mz na b">index.js</code>文件。同时在<code class="fe mx my mz na b">src</code>文件夹中创建<code class="fe mx my mz na b">actions</code>、<code class="fe mx my mz na b">components,</code>、<code class="fe mx my mz na b">context</code>、<code class="fe mx my mz na b">css</code>、<code class="fe mx my mz na b">custom-hooks</code>、<code class="fe mx my mz na b">images</code>、<code class="fe mx my mz na b">reducers</code>、<code class="fe mx my mz na b">router</code>、<code class="fe mx my mz na b">store</code>和<code class="fe mx my mz na b">utils</code>文件夹。</p><p id="60dd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">安装必要的依赖项</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="a4fd" class="kv kw iq na b gy nf ng l nh ni">yarn add axios@0.19.2 bootstrap@4.5.0 lodash@4.17.15 moment@2.27.0 node-sass@4.14.1 prop-types@15.7.2 react-bootstrap@1.0.1 react-redux@7.2.0 redux@4.0.5 redux-thunk@2.3.0</span></pre><p id="5c1b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">src</code>文件夹外新建一个名为<code class="fe mx my mz na b">server</code>的文件夹，并从<code class="fe mx my mz na b">server</code>文件夹执行以下命令</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="d594" class="kv kw iq na b gy nf ng l nh ni">yarn init -y</span></pre><p id="842c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这将在<code class="fe mx my mz na b">server</code>文件夹中创建一个<code class="fe mx my mz na b">package.json</code>文件。</p><p id="6299" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从<code class="fe mx my mz na b">server</code>文件夹安装所需的依赖项</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="728f" class="kv kw iq na b gy nf ng l nh ni">yarn add axios@0.19.2 express@4.17.1 cors@2.8.5 nodemon@2.0.4</span></pre><p id="340f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">server</code>文件夹中创建一个名为<code class="fe mx my mz na b">.gitignore</code>的新文件，并在其中添加下面一行，这样<code class="fe mx my mz na b">node_modules</code>文件夹将不受版本控制</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="12ba" class="kv kw iq na b gy nf ng l nh ni">node_modules</span></pre><p id="5f38" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">src/css</code>文件夹中创建一个新文件<code class="fe mx my mz na b">styles.scss</code>，并将<a class="ae lr" href="https://gist.github.com/myogeshchavan97/f288ebcb5f2cc53398e44eb780f5628b" rel="noopener ugc nofollow" target="_blank">中的内容添加到</a>中。</p><p id="ae76" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">src/reducers</code>文件夹中创建一个新文件<code class="fe mx my mz na b">jobs.js</code>,内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="349a" class="kv kw iq na b gy nf ng l nh ni">const jobsReducer = (state = [], action) =&gt; {<br/>  switch (action.type) {<br/>    case 'SET_JOBS':<br/>      return action.jobs;<br/>    case 'LOAD_MORE_JOBS':<br/>      return [...state, ...action.jobs];<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="fadb" class="kv kw iq na b gy nj ng l nh ni">export default jobsReducer;</span></pre><p id="fb29" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在该文件中，我们使用<code class="fe mx my mz na b">SET_JOBS</code>动作在redux中添加来自API的新作业数据，并使用<code class="fe mx my mz na b">LOAD_MORE_JOBS</code>动作获取更多作业，并使用spread操作符将其添加到现有的作业数组中。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="09c3" class="kv kw iq na b gy nf ng l nh ni">[...state, ...action.jobs]</span></pre><p id="3a87" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">src/reducers</code>文件夹下创建一个新文件<code class="fe mx my mz na b">errors.js</code>，内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="3e7d" class="kv kw iq na b gy nf ng l nh ni">const errorsReducer = (state = {}, action) =&gt; {<br/>  switch (action.type) {<br/>    case 'SET_ERRORS':<br/>      return {<br/>        error: action.error<br/>      };<br/>    case 'RESET_ERRORS':<br/>      return {};<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="06ed" class="kv kw iq na b gy nj ng l nh ni">export default errorsReducer;</span></pre><p id="503a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们通过调度<code class="fe mx my mz na b">SET_ERRORS</code>动作将API错误(如果有)添加到redux存储中，如果通过调度<code class="fe mx my mz na b">RESET_ERRORS</code>动作从API获得响应时没有错误，则从redux存储中删除错误对象。</p><p id="51fb" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">src</code>文件夹中创建一个新文件<code class="fe mx my mz na b">store.js</code>，内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="90a2" class="kv kw iq na b gy nf ng l nh ni">import { createStore, combineReducers, applyMiddleware, compose } from 'redux';<br/>import thunk from 'redux-thunk';<br/>import jobsReducer from '../reducers/jobs';<br/>import errorsReducer from '../reducers/errors';</span><span id="15bb" class="kv kw iq na b gy nj ng l nh ni">const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;<br/>const store = createStore(<br/>  combineReducers({<br/>    jobs: jobsReducer,<br/>    errors: errorsReducer<br/>  }),<br/>  composeEnhancers(applyMiddleware(thunk))<br/>);</span><span id="6c3a" class="kv kw iq na b gy nj ng l nh ni">console.log(store.getState());</span><span id="2b40" class="kv kw iq na b gy nj ng l nh ni">export default store;</span></pre><p id="5dc0" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们创建了一个redux store，它使用了<code class="fe mx my mz na b">combineReducers</code>并添加了来自<code class="fe mx my mz na b">redux-thunk</code>的<code class="fe mx my mz na b">thunk</code>作为管理异步API处理的中间件。</p><p id="43da" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们还使用<code class="fe mx my mz na b">composeEnhandlers.</code>添加了redux devtool配置</p><p id="c448" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果您是redux-thunk和redux devtool配置的新手，请查看我以前的文章<a class="ae lr" href="https://medium.com/javascript-in-plain-english/how-to-integrate-redux-thunk-into-your-react-application-cd92b87c1629" rel="noopener">这里的</a>以了解如何使用它。</p><p id="d142" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">src/index.js</code>文件内添加以下内容</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="1a9d" class="kv kw iq na b gy nf ng l nh ni">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import { Provider } from 'react-redux';<br/>import store from './store/store';<br/>import HomePage from './components/HomePage';<br/>import 'bootstrap/dist/css/bootstrap.min.css';<br/>import './css/styles.scss';</span><span id="3dfb" class="kv kw iq na b gy nj ng l nh ni">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;HomePage /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="116b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在该文件中，我们使用来自<code class="fe mx my mz na b">react-redux</code>的<code class="fe mx my mz na b">Provider</code>组件，这将允许我们将商店数据共享给<code class="fe mx my mz na b">HomePage</code>及其所有子组件。</p><p id="2272" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">src/components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">HomePage.js</code>，内容如下。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="2855" class="kv kw iq na b gy nf ng l nh ni">import React from 'react';</span><span id="ece9" class="kv kw iq na b gy nj ng l nh ni">const HomePage = () =&gt; {<br/>  return &lt;div className="container"&gt;Home Page&lt;/div&gt;;<br/>};</span><span id="4ce2" class="kv kw iq na b gy nj ng l nh ni">export default HomePage;</span></pre><p id="f258" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，打开<code class="fe mx my mz na b">public/index.html</code>并更换</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="71d9" class="kv kw iq na b gy nf ng l nh ni">&lt;title&gt;React App&lt;/title&gt;</span></pre><p id="d448" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="0620" class="kv kw iq na b gy nf ng l nh ni">&lt;title&gt;Github Job Search&lt;/title&gt;</span></pre><p id="6dac" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在从<code class="fe mx my mz na b">github-jobs-react-app</code>文件夹运行下面的命令启动React应用程序</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="a368" class="kv kw iq na b gy nf ng l nh ni">yarn start</span></pre><p id="0ca2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">您将看到显示主页文本的应用程序</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/03953469cfd40f14fb8b9f37445440d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tn2Zh4B2qUPxY-GcSSEiRA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Initial screen</figcaption></figure><p id="1ad3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">Header.js</code>，内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="21e2" class="kv kw iq na b gy nf ng l nh ni">import React from 'react';</span><span id="64ea" class="kv kw iq na b gy nj ng l nh ni">const Header = () =&gt; (<br/>  &lt;header className="header"&gt;<br/>    &lt;div className="title"&gt;Github Job Search&lt;/div&gt;<br/>  &lt;/header&gt;<br/>);</span><span id="83d4" class="kv kw iq na b gy nj ng l nh ni">export default Header;</span></pre><p id="f5fd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">Search.js</code>，内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="caf1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们添加了两个输入文本字段来获取用户的描述和位置，并添加了一个复选框来仅获取全职工作。</p><p id="526c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们还为每个输入字段添加了一个<code class="fe mx my mz na b">onChange</code>处理程序来更新状态值。</p><p id="972e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，打开<code class="fe mx my mz na b">HomePage.js</code>并用以下内容替换它</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c464" class="kv kw iq na b gy nf ng l nh ni">import React from 'react';<br/>import Header from './Header';<br/>import Search from './Search';</span><span id="4979" class="kv kw iq na b gy nj ng l nh ni">const HomePage = () =&gt; {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Header /&gt;<br/>      &lt;Search /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="1b97" class="kv kw iq na b gy nj ng l nh ni">export default HomePage;</span></pre><p id="8d6a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，如果您在输入字段中输入数值并点击<code class="fe mx my mz na b">Search</code>按钮，您将看到输入的数据显示在控制台中</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/3f7a227ace1bdbb4e586543aee454a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2wWVg8MnXtcUgQi7TpDTig.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Search Page</figcaption></figure><p id="a04d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">src/actions</code>文件夹中创建<code class="fe mx my mz na b">errors.js</code>，内容如下:</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="3def" class="kv kw iq na b gy nf ng l nh ni">export const setErrors = (error) =&gt; ({<br/>  type: 'SET_ERRORS',<br/>  error<br/>});</span><span id="736a" class="kv kw iq na b gy nj ng l nh ni">export const resetErrors = () =&gt; ({<br/>  type: 'RESET_ERRORS'<br/>});</span></pre><p id="107c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们添加了action creator函数，我们将调用这些函数向reducer发送动作。</p><p id="d189" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">utils</code>文件夹中创建一个新文件<code class="fe mx my mz na b">constants.js</code>，内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="b905" class="kv kw iq na b gy nf ng l nh ni">export const BASE_API_URL = 'http://localhost:5000';</span></pre><p id="23b9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">src/actions</code>文件夹中创建一个新文件<code class="fe mx my mz na b">jobs.js</code>，内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3205" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在该文件中，我们添加了一个<code class="fe mx my mz na b">initiateGetJobs</code>函数，该函数将通过对Node.js中的<code class="fe mx my mz na b">Express</code>服务器进行API调用来获取JSON数据，一旦接收到数据，就会调度<code class="fe mx my mz na b">SET_JOBS</code>动作，该动作将通过执行<code class="fe mx my mz na b">reducers/jobs.js</code>文件中的<code class="fe mx my mz na b">SET_JOBS</code>切换用例来将所有作业数据添加到redux存储中。</p><p id="e194" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">server</code>文件夹中创建一个新文件<code class="fe mx my mz na b">server.js</code>,内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="9040" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们使用<code class="fe mx my mz na b">Express</code>服务器创建了一个<code class="fe mx my mz na b">/jobs</code> get API。</p><p id="520f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这里，我们调用<a class="ae lr" href="https://jobs.github.com/api" rel="noopener ugc nofollow" target="_blank"> Github作业API </a>，通过传递<code class="fe mx my mz na b">description</code>和<code class="fe mx my mz na b">location</code>来获取可用作业的列表。默认情况下，API只给出最新的<code class="fe mx my mz na b">50</code>作业列表，但是我们可以通过发送值为1、2、3等的页面查询参数来获得更多的作业。</p><p id="6fea" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，我们通过下面的代码来验证页面查询参数</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="6b8d" class="kv kw iq na b gy nf ng l nh ni">if (page) {<br/>  page = parseInt(page);<br/>  page = isNaN(page) ? '' : `&amp;page=${page}`;<br/>}</span></pre><p id="83dc" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果我们只想要全职工作，那么我们需要添加一个额外的<code class="fe mx my mz na b">full_time</code>参数来查询值为<code class="fe mx my mz na b">true</code>的字符串</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="02c9" class="kv kw iq na b gy nf ng l nh ni">full_time = full_time === 'true' ? '&amp;full_time=true' : '';</span></pre><p id="2a34" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">最后，我们通过组合所有参数值来创建API URL。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="41cf" class="kv kw iq na b gy nf ng l nh ni">`https://jobs.github.com/positions.json?description=${description}&amp;location=${location}${full_time}${page}`;</span></pre><p id="3bad" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">为每个输入字段添加<code class="fe mx my mz na b">encodeURIComponent</code>的原因是为了将特殊字符(如有)转换为<code class="fe mx my mz na b">%20</code>。</p><p id="488a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果你注意到了，我们已经在<code class="fe mx my mz na b">actions/jobs.js</code>文件中的<code class="fe mx my mz na b">initiateGetJobs</code>函数中添加了相同的解析代码。将它包含在服务器代码中的原因还在于，我们还可以直接访问<code class="fe mx my mz na b">/jobs</code> get API，而不需要任何应用程序，只需进行我们添加的附加检查条件。</p><p id="9349" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，在<code class="fe mx my mz na b">components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">JobItem.js</code>，内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="cbcf" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们显示了来自API的数据</p><p id="e4ae" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">Results.js</code>，内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="d7f7" class="kv kw iq na b gy nf ng l nh ni">import React from 'react';<br/>import JobItem from './JobItem';</span><span id="a9b5" class="kv kw iq na b gy nj ng l nh ni">const Results = ({ results }) =&gt; {<br/>  return (<br/>    &lt;div className="search-results"&gt;<br/>      {results.map((job, index) =&gt; (<br/>        &lt;JobItem key={job.id} {...job} index={index} /&gt;<br/>      ))}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="acf1" class="kv kw iq na b gy nj ng l nh ni">export default Results;</span></pre><p id="b9fd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们循环通过来自<code class="fe mx my mz na b">results</code>数组的每个作业对象，并且我们传递单个作业数据以显示在先前创建的<code class="fe mx my mz na b">JobItem</code>组件中。</p><p id="42e2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，打开<code class="fe mx my mz na b">components/HomePage.js</code>文件并用以下内容替换它</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="5805" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们现在开始使用React钩子。如果你是第一次接触React钩子，请点击这里查看我以前的一篇关于钩子的介绍文章</p><p id="8292" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">让我们来理解来自<code class="fe mx my mz na b">HomePage</code>组件的代码。</p><p id="148f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">最初，我们使用<code class="fe mx my mz na b">useState</code>钩子来声明状态变量，以将来自API的结果存储在一个数组中，并声明一个标志来显示错误指示的加载和对象。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="2406" class="kv kw iq na b gy nf ng l nh ni">const [results, setResults] = useState([]);<br/>const [errors, setErrors] = useState(null);<br/>const [isLoading, setIsLoading] = useState(false);</span></pre><p id="6294" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">然后我们调用<code class="fe mx my mz na b">useEffect</code>钩子来获取作业和错误(如果有的话)的列表</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="6a4e" class="kv kw iq na b gy nf ng l nh ni">useEffect(() =&gt; {<br/>  setResults(props.jobs);<br/>}, [props.jobs]);</span><span id="86c7" class="kv kw iq na b gy nj ng l nh ni">useEffect(() =&gt; {<br/>  setErrors(props.errors);<br/>}, [props.errors]);</span></pre><p id="2845" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们使用<code class="fe mx my mz na b">useEffect</code>钩子通过传递依赖数组作为第二个参数来实现类组件的<code class="fe mx my mz na b">componentDidUpdate</code>生命周期方法。所以这些useEffect钩子只有在它们的依赖关系改变时才会被执行。当<code class="fe mx my mz na b">props.jobs</code>改变或<code class="fe mx my mz na b">props.errors</code>改变时。props中的数据是可用的，因为我们在文件的末尾添加了一个<code class="fe mx my mz na b">mapStateToProps</code>方法</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="629f" class="kv kw iq na b gy nf ng l nh ni">const mapStateToProps = (state) =&gt; ({<br/>  jobs: state.jobs,<br/>  errors: state.errors<br/>});</span></pre><p id="1b09" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">并传递给连接<code class="fe mx my mz na b">react-redux</code>库的方法。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="30ff" class="kv kw iq na b gy nf ng l nh ni">export default connect(mapStateToProps)(HomePage);</span></pre><p id="0822" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">然后，我们将<code class="fe mx my mz na b">onSearch</code>属性传递给<code class="fe mx my mz na b">Search</code>组件，其值是<code class="fe mx my mz na b">handleSearch</code>函数。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="6017" class="kv kw iq na b gy nf ng l nh ni">&lt;Search onSearch={handleSearch} /&gt;</span></pre><p id="fb64" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从这个函数内部，我们调用了<code class="fe mx my mz na b">loadJobs</code>函数，该函数调用了<code class="fe mx my mz na b">initiateGetJobs</code>动作创建器函数来对<code class="fe mx my mz na b">Express</code>服务器进行API调用。</p><p id="fefd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们正在将<code class="fe mx my mz na b">onSearch</code>道具传递给<code class="fe mx my mz na b">Search</code>组件，但是我们还没有使用它，所以让我们先使用它。</p><p id="d273" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">打开<code class="fe mx my mz na b">Search.js</code>组件并更换</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="eed4" class="kv kw iq na b gy nf ng l nh ni">const handleSearch = (event) =&gt; {<br/>  event.preventDefault();<br/>  console.log(state);<br/>};</span></pre><p id="ba84" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="f311" class="kv kw iq na b gy nf ng l nh ni">const handleSearch = (event) =&gt; {<br/>  event.preventDefault();<br/>  console.log(state);<br/>  <strong class="na ir">props.onSearch(state);</strong><br/>};</span></pre><p id="5c9d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以现在，当我们单击搜索按钮时，我们正在调用作为道具从<code class="fe mx my mz na b">HomePage</code>组件传递给<code class="fe mx my mz na b">Search</code>组件的<code class="fe mx my mz na b">onSearch</code>函数。</p><p id="f231" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，让我们运行应用程序。在运行它之前，我们需要做一些更改。</p><p id="c4ba" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">打开<code class="fe mx my mz na b">server/package.json</code>文件并在其中添加<code class="fe mx my mz na b">start</code>脚本</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c710" class="kv kw iq na b gy nf ng l nh ni">"start": "nodemon server.js"</span></pre><p id="ae09" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此<code class="fe mx my mz na b">server</code>文件夹中的<code class="fe mx my mz na b">package.json</code>将如下所示</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="fad5" class="kv kw iq na b gy nf ng l nh ni">{<br/>  "name": "server",<br/>  "version": "1.0.0",<br/>  "main": "index.js",<br/>  "license": "MIT",<br/>  "scripts": {<br/>    "start": "nodemon server.js"<br/>  },<br/>  "dependencies": {<br/>    "axios": "0.19.2",<br/>    "cors": "2.8.5",<br/>    "express": "4.17.1",<br/>    "nodemon": "^2.0.4",<br/>  }<br/>}</span></pre><p id="2a80" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，从<code class="fe mx my mz na b">server</code>文件夹执行开始命令</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="04b4" class="kv kw iq na b gy nf ng l nh ni">yarn run start</span></pre><p id="dee1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这将启动<code class="fe mx my mz na b">Express</code>服务器。</p><p id="a180" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">打开另一个终端，从<code class="fe mx my mz na b">github-jobs-react-app</code>文件夹执行<code class="fe mx my mz na b">yarn run start</code>命令。这将启动您的React应用程序。</p><p id="53d1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated"><code class="fe mx my mz na b">description</code>和<code class="fe mx my mz na b">location</code>是Github Jobs API的可选参数，因此如果您不输入任何值并单击search按钮，您将在屏幕上显示所有按发布日期排序的可用工作</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/6e839039f54038df5421138955d800e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCv0jkKk3CGZDwpd7VXx1Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Result Page</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/579b0a0fa04d6f373aed1da190ff3e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/1*cnKDBDD95OKw0ZZmzcdZaQ.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Working search functionality</figcaption></figure><p id="f2d2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">数据按<code class="fe mx my mz na b">actions/jobs.js</code>文件中<code class="fe mx my mz na b">initiateGetJobs</code>函数的创建日期排序</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="d1bc" class="kv kw iq na b gy nf ng l nh ni">const sortedJobs = jobs.data.sort(<br/>  (a, b) =&gt;<br/>    moment(new Date(b.created_at)) - moment(new Date(a.created_at))<br/>);</span></pre><p id="2705" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">您可以在这里找到到此为止的源代码<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/code_till_display_jobs" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="39a1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，当我们从结果中单击任何作业时，我们将获得作业的详细信息</p><p id="e198" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">components</code>文件夹下创建一个新文件<code class="fe mx my mz na b">JobDetails.js</code>，内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6c4a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这里，我们显示的是作业详细信息的<code class="fe mx my mz na b">description</code>。</p><p id="4295" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，我们需要一个标志来决定何时显示细节页面，何时显示作业列表。因此，在<code class="fe mx my mz na b">HomePage.js</code>文件中创建一个新的状态变量，默认值为<code class="fe mx my mz na b">home</code>，还有一个变量用来跟踪被点击的作业的id</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="ccd7" class="kv kw iq na b gy nf ng l nh ni">const [jobId, setJobId] = useState(-1);<br/>const [page, setPage] = useState('home');</span></pre><p id="cf78" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">打开<code class="fe mx my mz na b">HomePage.js</code>文件，替换为以下内容</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8e6d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们添加了<code class="fe mx my mz na b">handleItemClick</code>和<code class="fe mx my mz na b">handleResetPage</code>函数。</p><p id="feaa" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">同样，当我们单击详细信息页面时，我们从<code class="fe mx my mz na b">results</code>数组中过滤出作业</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="f801" class="kv kw iq na b gy nf ng l nh ni">let jobDetails = {};<br/>if (page === 'details') {<br/>  jobDetails = results.find((job) =&gt; job.id === jobId);<br/>}</span></pre><p id="1d0e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">并将其传递给<code class="fe mx my mz na b">JobDetails</code>组件</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="17a4" class="kv kw iq na b gy nf ng l nh ni">&lt;JobDetails details={jobDetails} onResetPage={handleResetPage} /&gt;</span></pre><p id="1201" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果页面值为<code class="fe mx my mz na b">home</code>，我们将显示<code class="fe mx my mz na b">header</code>、<code class="fe mx my mz na b">search</code>和<code class="fe mx my mz na b">results</code>页面，如果页面值为<code class="fe mx my mz na b">details</code>，我们将显示<code class="fe mx my mz na b">JobDetails</code>页面，因为我们添加了<code class="fe mx my mz na b">hide</code> CSS类来显示各自的组件</p><p id="b518" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">注意，我们还将<code class="fe mx my mz na b">onItemClick</code> prop传递给了<code class="fe mx my mz na b">Results</code>组件。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="2a71" class="kv kw iq na b gy nf ng l nh ni">&lt;Results results={results} onItemClick={handleItemClick} /&gt;</span></pre><p id="a62e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从<code class="fe mx my mz na b">Results</code>组件，我们将它向下传递给<code class="fe mx my mz na b">JobItem</code>组件，在该组件中，我们将该处理程序添加到最顶层的div</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="4ca7" class="kv kw iq na b gy nf ng l nh ni">&lt;div className="job-item" index={index + 1} onClick={() =&gt; onItemClick(id)}&gt;</span></pre><p id="4d34" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们从props中析构id，并将其传递给<code class="fe mx my mz na b">onItemClick</code>函数</p><p id="09bd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，通过运行<code class="fe mx my mz na b">yarn run start</code>命令重启React应用程序和服务器，并验证更改</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/a5f59a66ab4f53f54d3e874c70907bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/1*y2tNPy2SiHFz4PH-wGmyQA.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Details page with HTML not rendered correctly</figcaption></figure><p id="f59d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，当我们单击任何作业时，我们可以看到该作业的详细信息，但是如果您注意到了详细信息页面，您可以看到详细信息页面的HTML按原样显示，这意味着<p>标记显示为静态文本，而不是呈现段落。</p></p><blockquote class="mq mr ms"><p id="ab34" class="ls lt mt lu b lv ml jr lx ly mm ju ma mu mn mc md mv mo mf mg mw mp mi mj mk ij bi translated">这是因为在默认情况下，React在JSX表达式中使用时不会直接显示HTML内容，以避免跨站脚本(XSS)攻击。React对JSX表达式中提供的所有html内容进行转义，这些内容写在花括号中，因此将按原样打印出来。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/d01145639a76152b2ee02a6b9c97733a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-0X-nYv5bt64T-pCPCN3w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">API response</figcaption></figure><p id="7c9c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果您检查上面的API响应，您可以看到<code class="fe mx my mz na b">description</code>字段包含HTML内容，我们在<code class="fe mx my mz na b">JobDetails.js</code>文件中打印描述如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="053d" class="kv kw iq na b gy nf ng l nh ni">&lt;div className="job-description"&gt;{description}&lt;/div&gt;</span></pre><p id="1761" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">此外，在<code class="fe mx my mz na b">how to apply</code>部分</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="68f5" class="kv kw iq na b gy nf ng l nh ni">&lt;div&gt;{how_to_apply}&lt;/div&gt;</span></pre><p id="75ec" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在我们的例子中，如果需要显示HTML内容，我们需要使用一个名为<code class="fe mx my mz na b">dangerouslySetInnerHTML</code>的特殊道具，并在<code class="fe mx my mz na b">__html</code>字段中传递HTML，如下所示</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="fdab" class="kv kw iq na b gy nf ng l nh ni">&lt;div className="job-description" dangerouslySetInnerHTML={{ __html: description }}&gt;&lt;/div&gt;</span></pre><p id="c43a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">和</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c63c" class="kv kw iq na b gy nf ng l nh ni">&lt;div dangerouslySetInnerHTML={{ __html: how_to_apply }}&gt;&lt;/div&gt;</span></pre><p id="ec57" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，在<code class="fe mx my mz na b">JobDetails.js</code>文件中进行这些更改，现在检查应用程序，您将看到正确呈现的HTML</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/be0df21ba8921839bd4e56090b8b1401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9ilI--J6bHk2lQu0ZsDaQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Details page with HTML rendered correctly</figcaption></figure><p id="2b05" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">厉害！</p><p id="bee0" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">还有一件事，在构建应用程序时，每次测试都向实际的服务器发送请求是不好的，所以在<code class="fe mx my mz na b">public</code>文件夹中创建一个新文件<code class="fe mx my mz na b">jobs.json</code>，保存来自<a class="ae lr" href="https://gist.github.com/myogeshchavan97/08fdb2c7a070283f752a174ff52f6cf8" rel="noopener ugc nofollow" target="_blank">的API的响应</a>，并在<code class="fe mx my mz na b">actions/jobs.js</code>文件中为下面一行添加注释</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="b65c" class="kv kw iq na b gy nf ng l nh ni">const jobs = await axios.get(<br/>  `${BASE_API_URL}/jobs?description=${description}&amp;location=${location}${full_time}${page}`<br/>);</span></pre><p id="7b5d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">并在它下面添加以下代码。</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="90d3" class="kv kw iq na b gy nf ng l nh ni">const jobs = await axios.get('./jobs.json');</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/10d808735b6e468b4552d0adfdd7b98f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_HRmltZbmpFoFCF1UYsgQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Jobs action file</figcaption></figure><p id="fe34" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以现在，每当我们点击<code class="fe mx my mz na b">Search</code>按钮时，我们将从存储在<code class="fe mx my mz na b">public</code>文件夹中的JSON文件中获取数据，这将提供更快的响应，并且也不会增加对实际Github API的请求数量。</p><p id="db30" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果您正在使用其他一些API，它们可能会被限制在一个特定的请求数内，如果您超出了这个限制，它们可能会向您收费。<br/> <strong class="lu ir">注意:</strong> Github Jobs API是免费的，不会对请求数量收费，但使用缓存响应还是不错的，只有当你需要处理适当的场景时，才使用实际的API，而不是缓存的。</p><p id="0bd5" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">你可以在这里找到代码直到这个点<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/job_details_page_display" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="7bbe" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，如果你检查<code class="fe mx my mz na b">HomePage</code>组件，我们将<code class="fe mx my mz na b">onItemClick</code>函数传递给<code class="fe mx my mz na b">Results</code>组件，而<code class="fe mx my mz na b">Results</code>组件将其传递给<code class="fe mx my mz na b">JobItem</code>组件而不使用它，因此为了避免这种道具钻取，并使从<code class="fe mx my mz na b">HomePage</code>组件返回的JSX更简单，我们可以在这里使用<code class="fe mx my mz na b">React Context</code> API。</p><p id="5ce1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果你不熟悉<code class="fe mx my mz na b">React Context</code> API，请点击这里查看我之前的文章<a class="ae lr" href="https://medium.com/swlh/what-is-context-api-in-react-and-how-to-use-it-in-react-app-dedbcdd78801" rel="noopener"/></p><p id="7cb3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">src/context</code>文件夹中，创建一个新文件<code class="fe mx my mz na b">jobs.js</code>,内容如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="f049" class="kv kw iq na b gy nf ng l nh ni">import React from 'react';</span><span id="7491" class="kv kw iq na b gy nj ng l nh ni">const JobsContext = React.createContext();</span><span id="6723" class="kv kw iq na b gy nj ng l nh ni">export default JobsContext;</span></pre><p id="d040" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这里，我们只是创建了一个<code class="fe mx my mz na b">Context</code>,我们可以用它来访问其他组件中的数据</p><p id="0dfe" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">HomePage.js</code>文件中，在文件顶部导入该上下文</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="5ad7" class="kv kw iq na b gy nf ng l nh ni">import JobsContext from '../context/jobs';</span></pre><p id="658b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在返回JSX之前，用我们希望在其他组件中访问的数据创建一个值对象</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="1e43" class="kv kw iq na b gy nf ng l nh ni">const value = {<br/>  results,<br/>  details: jobDetails,<br/>  onSearch: handleSearch,<br/>  onItemClick: handleItemClick,<br/>  onResetPage: handleResetPage<br/>};</span></pre><p id="856a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">将返回的JSX从</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="9ca6" class="kv kw iq na b gy nf ng l nh ni">return (<br/>  &lt;div&gt;<br/>    &lt;div className={`${page === 'details' &amp;&amp; 'hide'}`}&gt;<br/>      &lt;Header /&gt;<br/>      &lt;Search onSearch={handleSearch} /&gt;<br/>      {!_.isEmpty(errors) &amp;&amp; (<br/>        &lt;div className="errorMsg"&gt;<br/>          &lt;p&gt;{errors.error}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>      {isLoading &amp;&amp; &lt;p className="loading"&gt;Loading...&lt;/p&gt;}<br/>      &lt;Results results={results} onItemClick={handleItemClick} /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div className={`${page === 'home' &amp;&amp; 'hide'}`}&gt;<br/>      &lt;JobDetails details={jobDetails} onResetPage={handleResetPage} /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="16c5" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="f09e" class="kv kw iq na b gy nf ng l nh ni">return (<br/>  &lt;JobsContext.Provider value={value}&gt;<br/>    &lt;div className={`${page === 'details' &amp;&amp; 'hide'}`}&gt;<br/>      &lt;Header /&gt; <br/>      &lt;Search /&gt;<br/>      {!_.isEmpty(errors) &amp;&amp; (<br/>        &lt;div className="errorMsg"&gt;<br/>          &lt;p&gt;{errors.error}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>      {isLoading &amp;&amp; &lt;p className="loading"&gt;Loading...&lt;/p&gt;} <br/>      &lt;Results /&gt;<br/>    &lt;/div&gt;<br/>    &lt;div className={`${page === 'home' &amp;&amp; 'hide'}`}&gt;<br/>      &lt;JobDetails /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/JobsContext.Provider&gt;<br/>);</span></pre><p id="de75" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">正如你所看到的，我们已经移除了所有传递给<code class="fe mx my mz na b">Search</code>、<code class="fe mx my mz na b">Results</code>和<code class="fe mx my mz na b">JobDetails</code>组件的<code class="fe mx my mz na b">props</code>，并且我们正在使用</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="588e" class="kv kw iq na b gy nf ng l nh ni">&lt;JobsContext.Provider value={value}&gt;</span></pre><p id="7805" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">来传递所有这些值，因为<code class="fe mx my mz na b">Provider</code>组件需要一个<code class="fe mx my mz na b">value</code>属性，现在开始和结束<code class="fe mx my mz na b">JobsContext.Provider</code>标记之间的所有组件都可以从作为属性传递的<code class="fe mx my mz na b">value</code>对象中访问任何值。</p><p id="06ec" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，打开<code class="fe mx my mz na b">Search.js</code>文件并在顶部添加上下文的导入。同样在顶部导入<code class="fe mx my mz na b">useContext</code>挂钩</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="9aed" class="kv kw iq na b gy nf ng l nh ni">import React, { useState, useContext } from 'react';</span></pre><p id="2b8a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，要访问来自<code class="fe mx my mz na b">value</code>对象的数据，请在<code class="fe mx my mz na b">Search</code>组件中添加以下代码</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="9834" class="kv kw iq na b gy nf ng l nh ni">const { onSearch } = useContext(JobsContext);</span></pre><p id="5bf4" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，你可以删除传递给组件的props参数，并在<code class="fe mx my mz na b">handleSearch</code>函数内部，改变</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c43c" class="kv kw iq na b gy nf ng l nh ni">props.onSearch(state);</span></pre><p id="2799" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">只是为了</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="85e6" class="kv kw iq na b gy nf ng l nh ni">onSearch(state);</span></pre><p id="7c28" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，您的<code class="fe mx my mz na b">Search</code>组件将如下所示</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="67e6" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，让我们使用<code class="fe mx my mz na b">Results</code>组件中的上下文</p><p id="9ada" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">移除传递给组件的两个属性</p><p id="55a9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在文件顶部导入上下文</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c9a0" class="kv kw iq na b gy nf ng l nh ni">import JobsContext from '../context/jobs';</span></pre><p id="f552" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从上下文中取出所需的值</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="8fd7" class="kv kw iq na b gy nf ng l nh ni">const { results } = useContext(JobsContext);</span></pre><p id="2c2d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，您可以移除传递给<code class="fe mx my mz na b">JobItem</code>组件的<code class="fe mx my mz na b">onItemClick</code>道具</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c306" class="kv kw iq na b gy nf ng l nh ni">import React, { useContext } from 'react';<br/>import JobItem from './JobItem';<br/>import JobsContext from '../context/jobs';</span><span id="e4d6" class="kv kw iq na b gy nj ng l nh ni">const Results = () =&gt; {<br/>  const { results } = useContext(JobsContext);<br/>  return (<br/>    &lt;div className="search-results"&gt;<br/>      {results.map((job, index) =&gt; (<br/>        &lt;JobItem key={job.id} {...job} index={index} /&gt;<br/>      ))}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="bd9b" class="kv kw iq na b gy nj ng l nh ni">export default Results;</span></pre><p id="a9b7" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，让我们重构<code class="fe mx my mz na b">JobDetails</code>组件</p><p id="7220" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在文件顶部导入上下文</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="cf29" class="kv kw iq na b gy nf ng l nh ni">import JobsContext from '../context/jobs';</span></pre><p id="29c2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从上下文中取出所需的值</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="f7fe" class="kv kw iq na b gy nf ng l nh ni">const { details, onResetPage } = useContext(JobsContext);</span></pre><p id="6e3c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，您的<code class="fe mx my mz na b">JobDetails.js</code>文件将如下所示</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0e88" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，让我们重构<code class="fe mx my mz na b">JobItem</code>组件</p><p id="b1b7" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在文件顶部导入上下文</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="4fad" class="kv kw iq na b gy nf ng l nh ni">import JobsContext from '../context/jobs';</span></pre><p id="369b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从上下文中取出所需的值</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="2574" class="kv kw iq na b gy nf ng l nh ni">const { onItemClick } = useContext(JobsContext);</span></pre><p id="6b05" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，你的<code class="fe mx my mz na b">JobItem.js</code>文件看起来会像这样</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="07d3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，检查您的应用程序，您可以看到应用程序的工作方式与以前相同，但现在我们已经避免了不必要的适当演练，并使代码更容易理解</p><p id="f57c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">你可以在这里找到代码直到这个点<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/changes_using_context" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="152e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">您可能已经注意到，当我们在工作列表上向下滚动一点并单击任何工作时，页面滚动保持在同一位置，我们看到的是页面的底部而不是顶部</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/debfe2341c63249407d2bbf546772d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/1*24aUxdwFPS1PF9M0TH8OYg.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">detail page automatically scrolled if details page content is larger</figcaption></figure><p id="734d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这是因为我们只是将<code class="fe mx my mz na b">hide</code>类添加到我们点击任何作业时不需要的组件中，所以滚动位置不会改变。</p><p id="5c75" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">要解决这个问题，打开<code class="fe mx my mz na b">JobDetail.js</code>文件并添加以下代码</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="545a" class="kv kw iq na b gy nf ng l nh ni">useEffect(() =&gt; {<br/> window.scrollTo(0, 0);<br/>}, []);</span></pre><p id="04ec" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以现在，当显示<code class="fe mx my mz na b">JobDetails</code>组件时，我们会自动显示在页面顶部。</p><p id="ae6b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">空数组指定这段代码应该只在组件被挂载时执行(类似于<code class="fe mx my mz na b">componentDidMount</code>生命周期方法),并且不再执行。</p><p id="1967" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们还需要确保，<code class="fe mx my mz na b">JobDetails</code>组件仅在我们点击任何作业时加载，因此打开<code class="fe mx my mz na b">HomePage.js</code>文件并进行更改</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="a1d7" class="kv kw iq na b gy nf ng l nh ni">&lt;div className={`${page === 'home' &amp;&amp; 'hide'}`}&gt;<br/> &lt;JobDetails /&gt;<br/>&lt;/div&gt;</span></pre><p id="8136" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="dd6f" class="kv kw iq na b gy nf ng l nh ni">&lt;div className={`${page === 'home' &amp;&amp; 'hide'}`}&gt;<br/> {page === 'details' &amp;&amp; &lt;JobDetails /&gt;}<br/>&lt;/div&gt;</span></pre><p id="1e78" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，如果您检查应用程序，您可以看到当单击任何作业时，页面的顶部都会显示出来。</p><p id="62a2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">正如我们已经知道的，当我们点击Github Jobs API时，我们只获得最新的<code class="fe mx my mz na b">50</code>作业，为了获得更多的作业，我们需要传递带有递增数字的<code class="fe mx my mz na b">page</code>查询参数，因此让我们在应用程序中实现load more功能。</p><p id="534c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">让我们用初始值<code class="fe mx my mz na b">1</code>和<code class="fe mx my mz na b">selection</code>状态变量在<code class="fe mx my mz na b">HomePage.js</code>中创建一个<code class="fe mx my mz na b">pageNumber</code>状态变量</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c88b" class="kv kw iq na b gy nf ng l nh ni">const [pageNumber, setPageNumber] = useState(1);<br/>const [selection, setSelection] = useState(null);</span></pre><p id="4974" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">添加代码以在<code class="fe mx my mz na b">HomePage.js</code>文件中显示加载更多按钮</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="d30f" class="kv kw iq na b gy nf ng l nh ni">{results.length &gt; 0 &amp;&amp; _.isEmpty(errors) &amp;&amp; (<br/>  &lt;div<br/>    className="load-more"<br/>    onClick={isLoading ? null : handleLoadMore}<br/>  &gt;<br/>    &lt;button<br/>      disabled={isLoading}<br/>      className={`${isLoading ? 'disabled' : ''}`}<br/>    &gt;<br/>      Load More Jobs<br/>    &lt;/button&gt;<br/>  &lt;/div&gt;<br/>)}</span></pre><p id="4969" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">此外，将装载条件从<code class="fe mx my mz na b">&lt;Results /&gt;</code>之前移到之后</p><p id="a6e8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，您的JSX返回的表单<code class="fe mx my mz na b">HomePage.js</code>将如下所示</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="aac8" class="kv kw iq na b gy nf ng l nh ni">return (<br/>  &lt;JobsContext.Provider value={value}&gt;<br/>    &lt;div className={`${page === 'details' &amp;&amp; 'hide'}`}&gt;<br/>      &lt;Header /&gt; &lt;Search /&gt;<br/>      {!_.isEmpty(errors) &amp;&amp; (<br/>        &lt;div className="errorMsg"&gt;<br/>          &lt;p&gt;{errors.error}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>      &lt;Results /&gt; <br/>      {isLoading &amp;&amp; &lt;p className="loading"&gt;Loading...&lt;/p&gt;}<br/>      {results.length &gt; 0 &amp;&amp; _.isEmpty(errors) &amp;&amp; (<br/>        &lt;div<br/>          className="load-more"<br/>          onClick={isLoading ? null : handleLoadMore}<br/>        &gt;<br/>          &lt;button<br/>            disabled={isLoading}<br/>            className={`${isLoading ? 'disabled' : ''}`}<br/>          &gt;<br/>            Load More Jobs<br/>          &lt;/button&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>    &lt;div className={`${page === 'home' &amp;&amp; 'hide'}`}&gt;<br/>      {page === 'details' &amp;&amp; &lt;JobDetails /&gt;}<br/>    &lt;/div&gt;<br/>  &lt;/JobsContext.Provider&gt;<br/>);</span></pre><p id="8426" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在上面的添加更多按钮div中，我们通过添加禁用的<code class="fe mx my mz na b">class</code>和禁用的<code class="fe mx my mz na b">attribute</code>来禁用用户点击的按钮</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="466a" class="kv kw iq na b gy nf ng l nh ni">className={`${isLoading ? 'disabled' : ''}`}</span></pre><p id="b3eb" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们还确保按钮被禁用时不会执行<code class="fe mx my mz na b">handleLoadMore</code>功能，因此通过从<code class="fe mx my mz na b">onClick</code>处理程序返回<code class="fe mx my mz na b">null</code>来禁用按钮。这在用户通过在开发工具中编辑来移除禁用的<code class="fe mx my mz na b">attribute</code>的情况下很有用。</p><p id="139f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在在<code class="fe mx my mz na b">HomePage</code>组件中添加<code class="fe mx my mz na b">handleLoadMore</code>功能</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="4a79" class="kv kw iq na b gy nf ng l nh ni">const handleLoadMore = () =&gt; {<br/>  loadJobs({ ...selection, page: pageNumber + 1 });<br/>  setPageNumber(pageNumber + 1);<br/>};</span></pre><p id="2204" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，我们将递增的页码传递给<code class="fe mx my mz na b">loadJobs</code>函数，但是我们需要进一步将它传递给我们的动作分派器函数，所以在<code class="fe mx my mz na b">loadJobs</code>函数中，就在<code class="fe mx my mz na b">dispatch(resetErrors());</code>之前添加以下代码</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="ef7c" class="kv kw iq na b gy nf ng l nh ni">let isLoadMore = false;<br/>if (selection.hasOwnProperty('page')) {<br/>  isLoadMore = true;<br/>}</span></pre><p id="cf2e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">并将<code class="fe mx my mz na b">isLoadMore</code>作为最后一个参数传递给<code class="fe mx my mz na b">initiateGetJobs</code>函数。</p><p id="afb8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以你的<code class="fe mx my mz na b">loadJobs</code>函数看起来像这样</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="ee8f" class="kv kw iq na b gy nf ng l nh ni">const loadJobs = (selection) =&gt; {<br/>  const { dispatch } = props;<br/>  const { description, location, full_time, page = 1 } = selection;<br/>  let isLoadMore = false;<br/>  if (selection.hasOwnProperty('page')) {<br/>    isLoadMore = true;<br/>  }<br/>  dispatch(resetErrors());<br/>  setIsLoading(true);<br/>  dispatch(<br/>    initiateGetJobs({ description, location, full_time, page }, isLoadMore)<br/>  )<br/>    .then(() =&gt; {<br/>      setIsLoading(false);<br/>    })<br/>    .catch(() =&gt; setIsLoading(false));<br/>};</span></pre><p id="f9b8" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在函数<code class="fe mx my mz na b">handleSearchction</code>中，调用<code class="fe mx my mz na b">setSelection</code>函数来设置状态</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="5d35" class="kv kw iq na b gy nf ng l nh ni">const handleSearch = (selection) =&gt; {<br/>  loadJobs(selection);<br/>  setSelection(selection);<br/>};</span></pre><p id="cb8b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，打开<code class="fe mx my mz na b">actions/jobs.js</code>文件，接受<code class="fe mx my mz na b">isLoadMore</code>作为第二个参数</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="1020" class="kv kw iq na b gy nf ng l nh ni">export const initiateGetJobs = (data, isLoadMore) =&gt; {</span></pre><p id="c360" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">和改变</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="5e81" class="kv kw iq na b gy nf ng l nh ni">return dispatch(setJobs(sortedJobs));</span></pre><p id="48dc" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="6402" class="kv kw iq na b gy nf ng l nh ni">if (isLoadMore) {<br/>  return dispatch(setLoadMoreJobs(sortedJobs));<br/>} else {<br/>  return dispatch(setJobs(sortedJobs));<br/>}</span></pre><p id="eca2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这段代码中，如果点击了load more按钮，那么我们将调用<code class="fe mx my mz na b">setLoadMoreJobs</code>函数向现有的结果数组中添加新的任务。<br/>如果<code class="fe mx my mz na b">isLoadMore</code>为假意味着我们点击了页面上的搜索按钮，那么我们调用<code class="fe mx my mz na b">setJobs</code>函数将结果添加到一个新的数组中。</p><p id="d577" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，通过运行<code class="fe mx my mz na b">yarn run start</code>命令重启React应用程序，您可以看到load more功能正在按预期工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/a6257b34718197febb7159d20da3fb5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/1*HEyWlUAwIzR1FOPsgJdF8w.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Load More functionality</figcaption></figure><p id="6082" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">你可以找到代码，直到这一点<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/added_load_more_functionality" rel="noopener ugc nofollow" target="_blank">这里</a></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="2a81" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">但是您会注意到，我们已经将加载消息移到了“加载更多”按钮的上方，因此，如果我们在结果已经显示的情况下在“描述”和“位置”字段中输入一些值，并且我们单击<code class="fe mx my mz na b">Search</code>按钮，我们将看不到加载消息，因为为此，我们需要滚动页面。这不是好的用户体验。此外，即使显示加载消息，用户也可以点击任何作业，即使加载正在进行，这也是不期望的。</p><p id="7dee" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，让我们使用<code class="fe mx my mz na b">React Portal</code>创建我们自己的加载器来显示覆盖图，这样用户在加载时将不能点击任何作业，我们也将看到加载的清晰指示。</p><p id="8e61" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果你不知道<code class="fe mx my mz na b">React Portal</code>，请点击这里查看我之前的文章<a class="ae lr" href="https://levelup.gitconnected.com/how-to-create-custom-reusable-toast-component-in-react-d556bf624b85" rel="noopener ugc nofollow" target="_blank"/></p><p id="20fa" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">Loader.js</code>,内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3062" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在打开<code class="fe mx my mz na b">public/index.html</code>，在id为<code class="fe mx my mz na b">root</code>的div旁边添加另一个id为<code class="fe mx my mz na b">loader</code>的div</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="082b" class="kv kw iq na b gy nf ng l nh ni">&lt;div id="root"&gt;&lt;/div&gt;<br/>&lt;div id="loader"&gt;&lt;/div&gt;</span></pre><p id="dea1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们在<code class="fe mx my mz na b">Loader.js</code>中使用的<code class="fe mx my mz na b">ReactDOM.createPortal</code>方法将在id为<code class="fe mx my mz na b">loader</code>的div中创建一个加载器，因此它将在React应用程序DOM层次结构之外，因此我们可以使用它为整个应用程序提供一个覆盖。这是使用React门户创建加载器的主要原因。</p><p id="33d3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，即使我们将<code class="fe mx my mz na b">Loader</code>组件包含在<code class="fe mx my mz na b">HomePage.js</code>文件中，它也将呈现在所有div之外，但在id为<code class="fe mx my mz na b">loader</code>的div之内。</p><p id="abfe" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">Loader.js</code>文件中，我们首先创建了一个div，其中将添加一个加载器消息</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="4b15" class="kv kw iq na b gy nf ng l nh ni">const [node] = useState(document.createElement('div'));</span></pre><p id="c133" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">然后，我们将<code class="fe mx my mz na b">message</code>类添加到该div中，并将该div添加到在<code class="fe mx my mz na b">index.html</code>中添加的div中</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="0a62" class="kv kw iq na b gy nf ng l nh ni">document.querySelector('#loader').appendChild(node).classList<br/> .add('message');</span></pre><p id="ebfc" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">基于从<code class="fe mx my mz na b">HomePage</code>组件传递来的<code class="fe mx my mz na b">show</code>属性，我们将<code class="fe mx my mz na b">add</code>或<code class="fe mx my mz na b">remove</code>生成<code class="fe mx my mz na b">hide</code>类，最后我们将使用</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="b392" class="kv kw iq na b gy nf ng l nh ni">ReactDOM.createPortal(props.children, node)</span></pre><p id="5620" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">然后，我们向页面的<code class="fe mx my mz na b">body</code>标签添加或移除<code class="fe mx my mz na b">loader-open</code>类，这将禁用或启用页面的滚动</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="9d4a" class="kv kw iq na b gy nf ng l nh ni">document.body.classList.add('loader-open');<br/>document.body.classList.remove('loader-open');</span></pre><p id="94b1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这里，我们将在开始和结束标记<code class="fe mx my mz na b">Loader</code>之间传递的数据将在<code class="fe mx my mz na b">props.children</code>中可用，因此我们可以显示一个简单的加载消息，或者我们可以包含一个作为加载器显示的图像。</p><p id="2de9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，让我们使用这个组件</p><p id="f4b2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">打开<code class="fe mx my mz na b">HomePage.js</code>文件并在<code class="fe mx my mz na b">&lt;JobsContext.Provider value={value}&gt;</code>后</p><p id="1277" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">线添加<code class="fe mx my mz na b">Loader</code>组件</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="4fc7" class="kv kw iq na b gy nf ng l nh ni">&lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;</span></pre><p id="0acc" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">同样，导入文件顶部的<code class="fe mx my mz na b">Loader</code></p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="0f90" class="kv kw iq na b gy nf ng l nh ni">import Loader from './Loader';</span></pre><p id="94a9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，您可以删除以前使用的below线</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="b49a" class="kv kw iq na b gy nf ng l nh ni">{isLoading &amp;&amp; &lt;p className="loading"&gt;Loading...&lt;/p&gt;}</span></pre><p id="0164" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，我们什么时候停止装载更多的物品？<br/>显然没有更多的项目时。</p><p id="692e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">当没有更多的作业时，Github jobs API返回一个空数组<code class="fe mx my mz na b">[]</code>作为响应，您可以通过将更大的页码传递给API <a class="ae lr" href="https://jobs.github.com/positions.json?page=10" rel="noopener ugc nofollow" target="_blank">来检查</a></p><p id="f4d1" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，为了处理打开<code class="fe mx my mz na b">HomePage.js</code>文件，在<code class="fe mx my mz na b">loadJobs</code>函数中，在<code class="fe mx my mz na b">.then</code>处理程序中添加以下代码</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="da0c" class="kv kw iq na b gy nf ng l nh ni">if (response &amp;&amp; response.jobs.length === 0) {<br/> setHideLoadMore(true);<br/>} else {<br/> setHideLoadMore(false);<br/>}<br/>setIsLoading(false);</span></pre><p id="6415" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以你的<code class="fe mx my mz na b">loadJobs</code>函数看起来像这样</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="f19b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">添加另一个状态变量</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="4d47" class="kv kw iq na b gy nf ng l nh ni">const [hideLoadMore, setHideLoadMore] = useState(false);</span></pre><p id="230e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">对于加载更多按钮代码，请更改</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="2d9d" class="kv kw iq na b gy nf ng l nh ni">{results.length &gt; 0 &amp;&amp; _.isEmpty(errors) &amp;&amp; (</span></pre><p id="4a20" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="e338" class="kv kw iq na b gy nf ng l nh ni">{results.length &gt; 0 &amp;&amp; _.isEmpty(errors) &amp;&amp; !hideLoadMore &amp;&amp; (</span></pre><p id="0e2e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以我们只是添加了一个额外的<code class="fe mx my mz na b">!hideLoadMore</code>条件，现在，如果响应中没有更多的作业，我们将隐藏load more jobs按钮。</p><p id="feed" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，如果您检查您的应用程序，您可以看到，如果我们单击<code class="fe mx my mz na b">Load More Jobs</code>按钮时没有更多要加载的作业，它将不会显示。在开始和结束的<code class="fe mx my mz na b">Loader</code>标记之间包含数据的好处是</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="573c" class="kv kw iq na b gy nf ng l nh ni">&lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;</span></pre><p id="e5d3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们可以在标签之间包含任何东西，甚至是一个图像，这个图像将代替<code class="fe mx my mz na b">Loading</code>文本显示出来，因为我们使用了<code class="fe mx my mz na b">props.children</code>在loader div中显示</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="3dde" class="kv kw iq na b gy nf ng l nh ni">ReactDOM.createPortal(props.children, node)</span></pre><p id="985d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">你可以在这里找到代码直到这个点<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/added_loader_with_overlay" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="1219" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">正如你现在所知道的，当我们从Jobs API请求时，我们最初会得到一个<code class="fe mx my mz na b">50</code>职位的列表，当我们在列表页面上显示公司徽标时，浏览器必须下载这50个图像，这可能需要一些时间，所以有时在图像完全加载之前，你可能会看到空白区域。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b9da84fc10c37ed06bcda303c8d37fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*Q_W6DjtlSQgWkyWh_obWPw.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Blank area for the image on initial load</figcaption></figure><p id="93c5" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">此外，如果您在移动设备上浏览应用程序，并且使用慢速网络连接，下载图像可能需要更多时间，即使您没有滚动页面来查看其他工作列表，浏览器也可能会下载大量不必要的图像，这不是很好的用户体验。</p><p id="1467" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果您检查当前功能，直到我们点击<code class="fe mx my mz na b">Search</code>按钮而没有输入任何值，对我来说，总共有<code class="fe mx my mz na b">99</code>个请求占用了大约<code class="fe mx my mz na b">2MB</code>个数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/09f80a32effc25e6264bb01be3efb153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mI-68c2VHmu4Y1Ezf15iBw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Requests information</figcaption></figure><p id="8597" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们可以通过延迟加载图像来解决这个问题。因此，在用户没有滚动到列表中的作业之前，不会下载图像，这样效率更高。</p><p id="4582" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">那么就从它开始吧。</p><p id="bbb3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">custom-hooks</code>文件夹中创建一个新文件<code class="fe mx my mz na b">observer.js</code>，内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="830c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们使用<code class="fe mx my mz na b">Intersection Observer API</code>来标识页面的哪个区域当前正在显示，并且只有该区域中的图像将被下载。</p><p id="1d8c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果你不知道<code class="fe mx my mz na b">Intersection Observer</code>，看看我以前的文章<a class="ae lr" href="https://levelup.gitconnected.com/what-is-so-special-about-intersection-observer-api-in-javascript-f2430a159fa7" rel="noopener ugc nofollow" target="_blank">这里</a>详细解释了如何用JavaScript在卷轴上做延迟加载、滑动动画和<code class="fe mx my mz na b">play/pause</code>视频。</p><p id="48b2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，在<code class="fe mx my mz na b">observer.js</code>文件中，我们获取一个<code class="fe mx my mz na b">ref</code>并将要观察的<code class="fe mx my mz na b">ref</code>添加到观察者中</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="8bf5" class="kv kw iq na b gy nf ng l nh ni">observer.observe(current);</span></pre><p id="4218" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果添加了<code class="fe mx my mz na b">ref</code>的图像显示在屏幕上，那么我们调用<code class="fe mx my mz na b">setIsVisible(true);</code>并从这个自定义钩子返回<code class="fe mx my mz na b">isVisible</code>值，根据<code class="fe mx my mz na b">isVisible</code>标志我们可以决定是否要显示图像。</p><p id="18e2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">所以打开<code class="fe mx my mz na b">JobItem.js</code>文件，为我们刚刚创建的定制钩子添加一个导入</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="1d90" class="kv kw iq na b gy nf ng l nh ni">import useObserver from '../custom-hooks/observer';</span></pre><p id="6e20" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">导入文件顶部的<code class="fe mx my mz na b">useRef</code>钩子</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="8752" class="kv kw iq na b gy nf ng l nh ni">import React, { useRef } from 'react';</span></pre><p id="d09d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">创建一个我们可以分配给图像的<code class="fe mx my mz na b">ref</code></p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="fd01" class="kv kw iq na b gy nf ng l nh ni">const imageRef = useRef();</span></pre><p id="fa0f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">调用自定义钩子并获取<code class="fe mx my mz na b">isVisible</code>值</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="be29" class="kv kw iq na b gy nf ng l nh ni">const [isVisible] = useObserver(imageRef);</span></pre><p id="25cb" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">变化</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="293b" class="kv kw iq na b gy nf ng l nh ni">&lt;div className="company-logo"&gt;<br/> &lt;img src={company_logo} alt={company} width="100" height="100" /&gt;<br/>&lt;/div&gt;</span></pre><p id="3798" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="a8ac" class="kv kw iq na b gy nf ng l nh ni">&lt;div className="company-logo" ref={imageRef}&gt;<br/> {isVisible &amp;&amp; (<br/> &lt;img src={company_logo} alt={company} width="100" height="100" /&gt;<br/> )}<br/>&lt;/div&gt;</span></pre><p id="43e0" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，通过运行<code class="fe mx my mz na b">yarn run start</code>重启React应用程序，并检查延迟加载功能。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/32210f1a5dee9871d65c4873a376dc3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/1*uraba2e1s5JBwQB8zFgX1g.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Lazy loading images</figcaption></figure><p id="10ff" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如您所见，最初仅发送了5个请求，仅下载了两个徽标图像，当您滚动页面时，将下载下一个显示的图像。</p><p id="0997" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这比以前一次下载所有图片的体验好多了。这也将更快地加载页面并节省互联网带宽。</p><p id="d486" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">你可以在这里找到代码直到这个点<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/added_lazy_loading_images" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="0558" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">如果你注意到了，即使我们缓慢地加载图像，最初你会看到空白区域而不是图像，直到图像被完全加载。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b9da84fc10c37ed06bcda303c8d37fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*Q_W6DjtlSQgWkyWh_obWPw.gif"/></div></figure><p id="b842" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">我们可以通过提供替代图像来解决这个问题，并在下载完成后用原始图像替换它。</p><p id="3642" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">这种方式我们可以避免空白空间，并且是一种广泛使用的不显示空白图像区域的方式。</p><p id="9632" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">从<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/blob/master/src/images/loading.png" rel="noopener ugc nofollow" target="_blank">这里</a>下载加载器图像，并将其添加到<code class="fe mx my mz na b">src/images</code>文件夹中</p><p id="86f2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">用于创建图像的网站是<a class="ae lr" href="https://placeholder.com/" rel="noopener ugc nofollow" target="_blank"> THIS </a>。</p><p id="8bb9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">您可以指定所需图像的<code class="fe mx my mz na b">width</code>、<code class="fe mx my mz na b">height</code>和<code class="fe mx my mz na b">text</code>。</p><p id="2eef" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">用于生成加载图像的URL如下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="e28b" class="kv kw iq na b gy nf ng l nh ni">https://via.placeholder.com/100x100?text=Loading</span></pre><p id="151a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在<code class="fe mx my mz na b">components</code>文件夹中创建一个新文件<code class="fe mx my mz na b">Image.js</code>,内容如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6611" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">在这个文件中，我们最初显示的是加载图像，而不是实际的图像。</p><p id="8e5c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated"><code class="fe mx my mz na b">img</code>标签添加了<code class="fe mx my mz na b">onLoad</code>处理程序，当图像被完全加载时将被触发，我们将<code class="fe mx my mz na b">isVisible</code>标志设置为<code class="fe mx my mz na b">true</code>，一旦为真，我们将显示该图像并使用display CSS属性隐藏先前加载的图像。</p><p id="a695" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在打开<code class="fe mx my mz na b">JobItem.js</code>文件，改一下</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="f4b4" class="kv kw iq na b gy nf ng l nh ni">{isVisible &amp;&amp; (<br/> &lt;img src={company_logo} alt={company} width="100" height="100" /&gt;<br/>)}</span></pre><p id="793f" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="c630" class="kv kw iq na b gy nf ng l nh ni">{isVisible &amp;&amp; (<br/> &lt;Image src={company_logo} alt={company} width="100" height="100" /&gt;<br/>)}</span></pre><p id="66e9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">同样，在文件顶部导入<code class="fe mx my mz na b">Image</code>组件</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="e394" class="kv kw iq na b gy nf ng l nh ni">import Image from './Image';</span></pre><p id="1093" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">请注意，我们刚刚将<code class="fe mx my mz na b">img</code>更改为<code class="fe mx my mz na b">Image</code>，并且我们正在访问<code class="fe mx my mz na b">Image</code>组件中的附加道具</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="85c1" class="kv kw iq na b gy nf ng l nh ni">const Image = ({ src, alt, ...props }) =&gt; {</span></pre><p id="20df" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">因此，除了<code class="fe mx my mz na b">src</code>和<code class="fe mx my mz na b">alt</code>之外，所有其他道具，如<code class="fe mx my mz na b">width</code>、<code class="fe mx my mz na b">height</code>都将存储在名为<code class="fe mx my mz na b">props</code>的数组中，然后我们通过扩展道具数组<code class="fe mx my mz na b">{...props} </code>将这些道具传递给实际图像，我们可以在详细信息页面上为公司徽标添加相同的功能。</p><p id="4074" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">打开<code class="fe mx my mz na b">JobDetails.js</code>文件并更改</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="b2e4" class="kv kw iq na b gy nf ng l nh ni">&lt;img src={company_logo} alt={company} className="company-logo" /&gt;</span></pre><p id="0b5b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">到</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="d87f" class="kv kw iq na b gy nf ng l nh ni">&lt;Image src={company_logo} alt={company} className="company-logo" /&gt;</span></pre><p id="1003" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">此外，导入文件顶部的<code class="fe mx my mz na b">Image</code>组件</p><pre class="kg kh ki kj gt nb na nc nd aw ne bi"><span id="9e9d" class="kv kw iq na b gy nf ng l nh ni">import Image from './Image';</span></pre><p id="9e22" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">现在，通过运行<code class="fe mx my mz na b">yarn run start </code>重启React应用程序并检查它</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/b10614a7abbe581cd0380934b994dbcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4ymA58aCwveDPCYfLp9XPQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">displaying Loading image until the image is completely loaded</figcaption></figure><p id="6246" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">您可以在这里找到到此为止的源代码<a class="ae lr" href="https://github.com/myogeshchavan97/github-jobs-react-app/tree/added_alternate_loading_image" rel="noopener ugc nofollow" target="_blank"/></p><p id="1fb5" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">厉害！我们已经完成了对应用程序的更改。</p><p id="8bb3" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">你可以在这里找到完整的Github源代码，在这里找到现场演示</p><p id="2643" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">今天到此为止。我希望你学到了新东西。</p><p id="c176" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma le mn mc md li mo mf mg lm mp mi mj mk ij bi translated">不要忘记订阅我的每周简讯，里面有惊人的技巧、窍门和文章，直接在这里的收件箱里。T29】</p></div></div>    
</body>
</html>