<html>
<head>
<title>Improve First Paint Timing With Pre-Rendered Routes by Using React-Snap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过使用“反应-捕捉”,使用预渲染路线改进首次绘制时间</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/improve-first-paint-timing-with-pre-rendered-by-using-react-snap-28f0643fce90?source=collection_archive---------8-----------------------#2020-10-28">https://javascript.plainenglish.io/improve-first-paint-timing-with-pre-rendered-by-using-react-snap-28f0643fce90?source=collection_archive---------8-----------------------#2020-10-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/61228dcf3d22fb3828e0f51e20294a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAZiE9NyCLE-a7788JtvdA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">React Performance Tips</figcaption></figure><h1 id="2b9e" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">快速小结</h1><p id="39d3" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">当您在Lighthouse性能报告中看到react应用程序首次绘制时间过高时，您可以通过使用<a class="ae lv" href="https://github.com/stereobooster/react-snap" rel="noopener ugc nofollow" target="_blank"> react-snap </a>轻松改善。</p><h1 id="2a67" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">介绍</h1><p id="219a" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">我当时正在开发react <a class="ae lv" href="https://en.wikipedia.org/wiki/Progressive_web_application" rel="noopener ugc nofollow" target="_blank"> PWA </a>应用程序，在<a class="ae lv" href="https://developers.google.com/web/tools/lighthouse" rel="noopener ugc nofollow" target="_blank"> lighthouse </a>审计期间，出于好奇，我在lighthouse工作室检查了其他选项。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/8735488f1df504170ea023a843d766db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ds7fzv0Gpdm32mc1CWiP5A.png"/></div></div></figure><p id="14a9" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">当我运行性能报告时，它只得到49%。因此，我决定敲打每一个问题，以提高性能。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/2e3938647db42bcc56d2873ff4b63d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6CNXI1SUWW6hZLEq1hA1LQ.png"/></div></div></figure><h2 id="186e" class="mg ka in bd kb mh mi dn kf mj mk dp kj li ml mm kn lm mn mo kr lq mp mq kv mr bi translated">从49%到73%</h2><p id="cba1" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">这是我的错误，我在开发模式下运行审计，而不是生产模式。在生成产品构建之后，我运行了审计，得到了高达73%的结果。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/f1cd1cfd86cab0a214d6515ee77979dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2iNdL08VBVGNDB__nqYKw.png"/></div></div></figure><p id="85e0" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">现在，需要集中精力进行<strong class="kz io">的第一次心满意足的绘画。</strong>先说第一件事，第一幅内容丰富的画是什么(或者干脆是FCP)？</p><h2 id="b0c1" class="mg ka in bd kb mh mi dn kf mj mk dp kj li ml mm kn lm mn mo kr lq mp mq kv mr bi translated"><strong class="ak">第一次心满意足的画画</strong></h2><p id="93e5" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">第一次绘画是当你的web应用程序开始从空白页面加载到有意义的内容时。它可以是文本、图像(包括背景图像)、非白色画布或SVG中的任何内容。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/e0c7b8bcbc137fd99b20c2f372d57012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j4c5Xtx6k0uw3Q3v"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">https://treo.sh</figcaption></figure><p id="513e" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">从你注意到的图片来看，Pinterest实际上正在加载一个小型加载器来改进他们的<strong class="kz io"> First Contentful Paint。</strong>所以我决定在页面加载之前添加一个加载器，但是我的审计报告还是一样的。</p><h2 id="9229" class="mg ka in bd kb mh mi dn kf mj mk dp kj li ml mm kn lm mn mo kr lq mp mq kv mr bi translated">捆绑分析器报告</h2><p id="58d8" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">因此，我决定在我的react应用程序上分析生产捆绑报告。</p><p id="b4d5" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">在<a class="ae lv" href="https://www.npmjs.com/package/source-map-explorer" rel="noopener ugc nofollow" target="_blank"> source-map-explorer </a>的帮助下，我们可以使用create-react-app来分析React app create的包大小。它通过计算每个树节点的源映射的大小来创建包大小报告。</p><p id="1e14" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">第一步:安装包</strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="1f8b" class="mg ka in mu b gy my mz l na nb">npm i source-map-explorer --dev</span></pre><p id="c12d" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">第二步:在package.json上添加npm脚本</strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="8f6a" class="mg ka in mu b gy my mz l na nb">"scripts": {<br/>  <strong class="mu io">"analyze": "source-map-explorer 'build/static/js/*.js'",</strong><br/>}</span></pre><p id="75f8" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">步骤3:创建一个生产版本</strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="ead0" class="mg ka in mu b gy my mz l na nb">npm run build</span></pre><p id="13f0" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">步骤4:运行分析命令，分析捆绑包大小</strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="9646" class="mg ka in mu b gy my mz l na nb">npm run analyze</span></pre><p id="70dd" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">得到报告后，我发现我的文件比实际的react产品代码要大。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/f6468015150f00f35677a85d333233b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G1sNcLx931HYLP_ZhqXf3A.png"/></div></div></figure><p id="858c" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">出于好奇，我决定审计Next.js应用程序，以了解React和next.js之间的性能差异。</p><h2 id="d254" class="mg ka in bd kb mh mi dn kf mj mk dp kj li ml mm kn lm mn mo kr lq mp mq kv mr bi translated"><strong class="ak">接下来。JS审计报告</strong></h2><p id="35f0" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">我用next.js建立了一个<a class="ae lv" href="https://naveenda.github.io/" rel="noopener ugc nofollow" target="_blank"> portfolio </a>网站，我只是在上面运行了性能审计，它获得了惊人的98%。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/8219c4a9247efb22ec120cc1a94cad98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SKPj2uTijlB-PltHNDJJdg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk"><a class="ae lv" href="https://naveenda.github.io/" rel="noopener ugc nofollow" target="_blank">https://naveenda.github.io/</a></figcaption></figure><p id="87ba" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">我知道，这是一个静态呈现的站点，这意味着为每条路线创建一个实际的HTML文件。</p><p id="e047" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">反应迅速</strong></p><p id="6036" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">我正在寻找的东西，获取所有的路线，并为每个路线创建HTML页面。幸运的是我找到了<a class="ae lv" href="https://github.com/stereobooster/react-snap" rel="noopener ugc nofollow" target="_blank"> react-snap </a>，react snap做的正是我想要的。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/d01446d95a68416bf9185409cf40e468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1bNM50IJN5cJkfW9fAvgA.png"/></div></div></figure><p id="ab5a" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">让我们在我的项目中配置反应快照</p><h2 id="dd20" class="mg ka in bd kb mh mi dn kf mj mk dp kj li ml mm kn lm mn mo kr lq mp mq kv mr bi translated">配置</h2><p id="a29e" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">react-snap配置非常简单，只需3个步骤</p><p id="e127" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">第一步:安装react-snap </strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="40ec" class="mg ka in mu b gy my mz l na nb">npm i react-snap --dev</span></pre><p id="afc5" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">第二步:在你的package.json上添加npm脚本</strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="2d84" class="mg ka in mu b gy my mz l na nb">"scripts": {<br/><strong class="mu io">  "postbuild": "react-snap"<br/></strong>}</span></pre><p id="a7d1" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">第三步:修改你的</strong> <code class="fe ne nf ng mu b"><strong class="kz io">index.jsx</strong></code> <strong class="kz io">文件</strong></p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="0599" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">每当我们创建生产构建时，react-snap就会为我们创建预渲染路线。</p><h2 id="7233" class="mg ka in bd kb mh mi dn kf mj mk dp kj li ml mm kn lm mn mo kr lq mp mq kv mr bi translated"><strong class="ak">获得90%🎉</strong></h2><p id="dcdb" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">在创建生产版本之后，我再次运行审计，得到了90%</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/1025831eb76e141a4cf07edb65d7c3e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pslt7bTrhpc-U7ObABtIEQ.png"/></div></div></figure><p id="631b" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated">还有10%的剩余😞。如果你能改进这些，请在评论中告诉我</p></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><p id="dfaa" class="pw-post-body-paragraph kx ky in kz b la mb lc ld le mc lg lh li md lk ll lm me lo lp lq mf ls lt lu ig bi translated"><strong class="kz io">感谢您的阅读！</strong>如果你喜欢这篇文章，可以考虑<a class="ae lv" href="https://twitter.com/NaveenDA_" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我</a>，并与你的开发者朋友分享这篇文章🐋😀</p></div></div>    
</body>
</html>