<html>
<head>
<title>Handle Docker Images Like A Pro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专业人士一样处理Docker图像</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/delete-docker-images-like-a-pro-a8fece854ec8?source=collection_archive---------4-----------------------#2020-12-18">https://javascript.plainenglish.io/delete-docker-images-like-a-pro-a8fece854ec8?source=collection_archive---------4-----------------------#2020-12-18</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="688f" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用一些基本的Linux命令</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/8d5f29db24c0af63647ca189ba7cee40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgtGHn5ScHOHwlephJc6Bg.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@claybanks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Clay Banks</a> on <a class="ae kw" href="https://unsplash.com/s/photos/delete?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="cf88" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">问题是</h2><p id="5739" class="pw-post-body-paragraph lt lu ir lv b lw lx js ly lz ma jv mb lg mc md me lk mf mg mh lo mi mj mk ml ik bi translated">每当我玩docker的时候，在几个<code class="fe mm mn mo mp b">docker build</code>命令之后，我的本地机器就会被大量的图像弄得臃肿不堪。最新的一个被标记为<code class="fe mm mn mo mp b">latest</code>以前的版本会失效，但不会被删除。</p><p id="0a22" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">所以当我运行命令<code class="fe mm mn mo mp b">docker images</code>时，列表看起来像这样，有很多无效图像…</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj mv"><img src="../Images/5238f7da7230aacc93733ca314fa8b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zzVE1-tZY5jsDQ5QtqZTg.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">invalid images</figcaption></figure><h2 id="5654" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">当量溶液</h2><p id="4a9f" class="pw-post-body-paragraph lt lu ir lv b lw lx js ly lz ma jv mb lg mc md me lk mf mg mh lo mi mj mk ml ik bi translated">通常情况下，解决方案是用类似</p><pre class="kh ki kj kk gu mw mp mx my aw mz bi"><span id="d6ae" class="kx ky ir mp b gz na nb l nc nd">docker rmi -f IMAGE_ID</span></pre><p id="b13b" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">所以现在我必须按照图片id一个接一个地删除每张图片。一点都不好玩。</p><h2 id="b51f" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">快捷解决方案</h2><p id="4de5" class="pw-post-body-paragraph lt lu ir lv b lw lx js ly lz ma jv mb lg mc md me lk mf mg mh lo mi mj mk ml ik bi translated">要删除所有无效的图像(名称/标签为<code class="fe mm mn mo mp b">none</code>)，只需运行以下命令。。。</p><pre class="kh ki kj kk gu mw mp mx my aw mz bi"><span id="379f" class="kx ky ir mp b gz na nb l nc nd">docker images | grep none| tr -s ' ' | cut -d ' ' -f 3 | xargs -I {} docker rmi -f {}</span></pre><p id="05ae" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">想了解关于这些命令的更多信息吗？继续读。。。</p><h1 id="4a90" class="ne ky ir bd kz nf ng nh lc ni nj nk lf jx nl jy lj ka nm kb ln kd nn ke lr no bi translated">说明</h1><p id="8943" class="pw-post-body-paragraph lt lu ir lv b lw lx js ly lz ma jv mb lg mc md me lk mf mg mh lo mi mj mk ml ik bi translated">我们将讨论帮助我们实现这一目标的每个命令。顺便了解更多关于Linux的知识。。。</p><h2 id="542e" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">可做文件内的字符串查找</h2><ul class=""><li id="1b61" class="np nq ir lv b lw lx lz ma lg nr lk ns lo nt ml nu nv nw nx bi translated">命令的第一部分<code class="fe mm mn mo mp b">docker images</code>简单地列出了所有的图片。命令<code class="fe mm mn mo mp b">grep none</code>过滤包含单词<code class="fe mm mn mo mp b">none</code>的图像。所以我们可以用这个命令看到所有无效的图像。</li></ul><p id="2e90" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">这是grep命令的一个简单用法。这是一个非常强大的命令。我们可以使用这个命令添加定制的逻辑来删除docker图像！</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj mv"><img src="../Images/2e7b5b6776285fb60d04c689fed69e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMhWJADT2cmU-2sbx7iRdA.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">docker images | grep none</figcaption></figure><h2 id="018e" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">tr</h2><p id="b4ed" class="pw-post-body-paragraph lt lu ir lv b lw lx js ly lz ma jv mb lg mc md me lk mf mg mh lo mi mj mk ml ik bi translated">下一个命令是<code class="fe mm mn mo mp b">tr -s ' '</code>。这是一个<a class="ae kw" href="https://linuxize.com/post/linux-tr-command/" rel="noopener ugc nofollow" target="_blank">命令</a>,帮助我们用我们选择的字符压缩一个字符串。我们可以看到在名称、标签、图像ID之间有多个空格。所以使用这个命令我们可以最小化它们之间的空间。</p><p id="a010" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">运行该命令后，我们可以看到名称现在是等间距的。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj mv"><img src="../Images/2533f05a8d3202eca6016412beb1d3f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GoblkzNEHTYzh6qpXCSqg.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">after squeezing their name</figcaption></figure><h2 id="edde" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">切口</h2><pre class="kh ki kj kk gu mw mp mx my aw mz bi"><span id="fee5" class="kx ky ir mp b gz na nb l nc nd">cut -d ' ' -f 3</span></pre><p id="55ca" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">这个<a class="ae kw" href="https://linuxize.com/post/linux-cut-command/" rel="noopener ugc nofollow" target="_blank">命令</a>帮助我们剪切输入字符串的一部分。选项<code class="fe mm mn mo mp b">-d ' '</code>有助于将分隔分隔符设置为空格。并且<code class="fe mm mn mo mp b">-f 3</code>指定我们想要字符串的第三部分。</p><p id="2ff2" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">如果我们运行这个命令，它将给出所有带有标签<code class="fe mm mn mo mp b">none</code>的图像id列表</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj mv"><img src="../Images/05146f516091be9273ce3f9c8b190747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2mSYkzSX3mErrC-JdD79g.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">All image Id of tag none</figcaption></figure><h2 id="bbe9" class="kx ky ir bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">xargs</h2><p id="6b39" class="pw-post-body-paragraph lt lu ir lv b lw lx js ly lz ma jv mb lg mc md me lk mf mg mh lo mi mj mk ml ik bi translated">该命令的最后一部分是</p><pre class="kh ki kj kk gu mw mp mx my aw mz bi"><span id="1530" class="kx ky ir mp b gz na nb l nc nd">xargs -I {} docker rmi -f {}</span></pre><p id="9871" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">该命令获取一个命令的输出，并将其作为输入提供给另一个命令。在我们的例子中，我们希望使用图像ID列表作为<code class="fe mm mn mo mp b">docker rmi -f</code>的输入。</p><p id="51b0" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">运行整个命令后，你可以看到所有不需要的图像都被删除了。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj mv"><img src="../Images/a1a24b6ba3f8332f911bfc891025c607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhJrerI8rONJQArID63XMA.png"/></div></div></figure><p id="ea05" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">您可以再次使用命令<code class="fe mm mn mo mp b">docker images</code>进行验证，以验证所有不需要的图像现在都已消失。</p><p id="4675" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">如果你想用第一个<code class="fe mm mn mo mp b">grep</code>命令进行另一种过滤，你可以使用这个命令，因为它也支持正则表达式过滤。</p><p id="2bd6" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated">今天到此为止。编码快乐！:D</p><p id="d950" class="pw-post-body-paragraph lt lu ir lv b lw mq js ly lz mr jv mb lg ms md me lk mt mg mh lo mu mj mk ml ik bi translated"><strong class="lv is">通过</strong> <a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"> <strong class="lv is"> LinkedIn </strong> </a> <strong class="lv is">或我的</strong> <a class="ae kw" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lv is">个人网站</strong> </a> <strong class="lv is">与我取得联系。</strong></p></div></div>    
</body>
</html>