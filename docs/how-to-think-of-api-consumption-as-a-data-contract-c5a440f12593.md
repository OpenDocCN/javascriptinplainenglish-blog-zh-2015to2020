# 如何看待 API 消费为数据契约

> 原文：<https://javascript.plainenglish.io/how-to-think-of-api-consumption-as-a-data-contract-c5a440f12593?source=collection_archive---------9----------------------->

这篇文章最初发表在 [***TK 的博客***](https://leandrotk.github.io/tk/2020/04/thinking-in-data-contracts/index.html) 。

在前端开发中，消费 API 数据并使用它来呈现用户界面是很常见的。但是有时候，API 数据并不是我们想要的。所以我们设法将 API 数据映射到应用程序状态。

![](img/50c9d81ff758b8f95ca7786927231ed1.png)

但是不需要很复杂。它可以只是一个简单的映射函数、一个 API 数据契约和应用程序状态契约。

我将在 Redux 应用程序的上下文中展示一个例子，以及我们如何使状态保持一致。

我们从最初的国家契约开始。

并在初始状态定义中使用合同类型:

在 app 状态定义之后，我们可以想到 API 契约。我们可以用数据所需的所有类型实现一个类型`PersonAPI`。

既然我们已经定义了我们的契约，我们就可以使用数据映射了。它不需要是一个超级复杂的类。它可以是一个简单的纯函数，接收`PersonAPI`数据并将其转换为`Person`数据。

这很简单！我们如何使用它？

数据进来了。数据出来了。一切纯洁。

这里我们有一个非常简单的映射，没有复杂的逻辑。但是如果我们收到的 API 数据没有`name`，只有`firstName`和`lastName`呢？我们希望将`firstName`和`lastName`转换成`Person`契约中的`name`属性。

`PersonAPI`类型:

`Person`类型:

在我们的`name`中，我们需要连接字符串。基本上是做字符串插值:

所以我们的映射函数应该是这样的:

太好了！为用户界面呈现转换数据。

下一步:假设我们的`lastName`是一个可选的数据库列。所以 API 端点可以返回它...还是不要！

我们可以使用类型脚本`Optional Property`。它告诉我们:“它是一个可选属性，它有这个类型，但是数据可以在这里...还是不要！”

所以我们在 API 合同中使用它:

不错！现在我们知道我们需要做某种逻辑来构建`name`属性。

*   它有`lastName`属性:concat `firstName`和`lastName`
*   它没有`lastName`:只返回`firstName`值

但是我们也可以通过三元运算将这个`let`语句转换成一个`const`:

或者更好:把它的职责分离成一个建立名字的功能！

我们将每个职能部门的职责分开。太好了！现在测试我们的功能更容易了。

下一阶段:使用 API 数据构建新的应用程序状态。假设我们想知道这个人是否活跃。业务规则是:人员状态应该是`active`，最后一次访问应该在本周内(过去 7 天内)。

首先是我们的 API 合同:

我们将使用这些属性:`status`和`lastVisit`。

我们的应用状态合同第二:

现在的业务规则是:

*   人员状态应为`active`

*   个人最后一次访问应该在过去 7 天内

现在我们的映射函数:

我们来重构一下吧！我们就从`status`这件事开始吧。`'active'`是字符串。为了在数据结构中定义它并实现可重用性，我们可以使用 Typescript 的 Enum。

我们像这样使用它:

这个特性使人员状态逻辑变得简单:

现在是最后一次探访。代替随机数，让它更具描述性怎么样？这是以毫秒为单位的 1 天:

这是以毫秒为单位的 7 天:

这是一周前:

现在我们的逻辑变得简单了:

我们现在可以用一个名为`isActive`的函数将所有这些连接在一起，这个函数返回一个布尔值？

我真想把`weekAgo`“逻辑”单独成一个新功能。我还想说出这些陈述。

命名我们的语句，看起来像:

所以我们最后的`isActive`函数看起来很漂亮:

我们的映射函数很简单:

只是做了一些调整:对象属性值简写为`id`和`email`。

# 学习

那么我们在这里学到了什么？

*   数据契约帮助我们更好地定义我们的数据结构，即我们希望在前端正确呈现 UI 的状态。
*   它也是很好的文档:更好地理解我们的 API 响应和我们需要处理的应用程序状态。
*   另一个很酷的好处是当我们定义数据类型并在初始状态下使用它们时。[如果我们在整个应用程序中保持状态契约，我们就能使我们的系统真正一致](https://leandrotk.github.io/tk/2020/04/consistent-state-management-in-react-and-redux/index.html)。
*   不需要很复杂。仅简单和纯粹的函数。将每个职能部门的职责分开，我们就万事俱备了。这也有助于我们进行测试。

我希望我能很好地概述数据契约、简单的功能和单一责任原则。在软件工程中，真的很容易把一切都搞复杂，搞砸。但是如果我们仔细考虑我们的数据，我们正在使用的数据结构，以及我们如何管理复杂性和逻辑，我认为我们有很好的机会构建好的软件。

## JavaScript 用简单的英语写的一个注释:

我们已经推出了三种新的出版物！请关注我们的新出版物:[**AI in Plain English**](https://medium.com/ai-in-plain-english)[**UX in Plain English**](https://medium.com/ux-in-plain-english)[**Python in Plain English**](https://medium.com/python-in-plain-english)**——谢谢，继续学习！**