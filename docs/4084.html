<html>
<head>
<title>Async/await is awesome, but don’t abandon Promises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Async/await很棒，但是不要放弃承诺</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/async-await-is-awesome-but-dont-abandon-promises-f815b3df51dc?source=collection_archive---------6-----------------------#2020-11-15">https://javascript.plainenglish.io/async-await-is-awesome-but-dont-abandon-promises-f815b3df51dc?source=collection_archive---------6-----------------------#2020-11-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="297e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">什么是JavaScript承诺？每次都是代码发誓要工作的时候。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c0d3443818f60dc3707d27ec32c471d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjATL-EAN7xvJf0kjMUh5Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Shoutout to <a class="ks kt ep" href="https://medium.com/u/4c5633187eea?source=post_page-----f815b3df51dc--------------------------------" rel="noopener" target="_blank">Cassidy Williams</a> 😀</figcaption></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="f958" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">让我们创建一个按钮，它将:</p><ul class=""><li id="951f" class="lx ly in ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">执行昂贵的同步操作，</li><li id="c447" class="lx ly in ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">启动2个AJAX请求，然后</li><li id="b601" class="lx ly in ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">根据AJAX响应更新DOM。</li></ul><p id="addd" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这是标记。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1c05" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">下面是函数。让我们也用<a class="ae mn" href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/measure" rel="noopener ugc nofollow" target="_blank"> Performance API </a>来测量每个操作的持续时间，它可视化了Chrome DevTools性能时间线上每个函数执行的时间和持续时间。(感谢<a class="ae mn" href="https://jsonplaceholder.typicode.com" rel="noopener ugc nofollow" target="_blank"> JSONPlaceholder </a>的虚拟端点。)</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="f407" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">你还在这里？好，有趣的部分来了:为<code class="fe mo mp mq mr b">button</code>编写<code class="fe mo mp mq mr b">onclick</code>处理程序。既然所有酷小孩都这么做，那就用<code class="fe mo mp mq mr b">async</code> / <code class="fe mo mp mq mr b">await</code>吧。</p><pre class="kd ke kf kg gt ms mr mt mu aw mv bi"><span id="76df" class="mw mx in mr b gy my mz l na nb">async function handleClick() {<br/>   someSyncOperation(); // Expensive sync operation </span><span id="0e52" class="mw mx in mr b gy nc mz l na nb">   const postJson = await fetchPost(); // AJAX request #1</span><span id="bfbf" class="mw mx in mr b gy nc mz l na nb">   const commentsJson = await fetchComments(); // AJAX request #2</span><span id="a389" class="mw mx in mr b gy nc mz l na nb">   appendPostDOM(postJson);<br/>   appendCommentsDOM(commentsJson);<br/>}</span></pre><p id="6447" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">这里是点击<code class="fe mo mp mq mr b">button</code>后的表演时间线。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/578d6f6b9dfb6e12fac8fcb9d1879a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPbydXJik0QO9KfFCcx97g.png"/></div></div></figure><p id="63b1" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">让我们仔细看看。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/9d5db767fb0039760cba07fcedba0cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Afxib_uy8WZ53t31PLEX1w.png"/></div></div></figure><p id="0ca8" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">有道理，关于<code class="fe mo mp mq mr b">async</code> / <code class="fe mo mp mq mr b">await</code>如何将异步代码变成阻塞代码的文章很多。仅供参考，当将网络节流到“慢3G”时，每个条形约为2秒。</p><p id="7160" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated"><strong class="ld io">所以总共执行时间为6秒。</strong></p><p id="d716" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">好的。<code class="fe mo mp mq mr b">fetchPost</code>和<code class="fe mo mp mq mr b">fetchComments</code>可以并行执行，所以让我们使用<code class="fe mo mp mq mr b">await Promise.all</code>组合。</p><pre class="kd ke kf kg gt ms mr mt mu aw mv bi"><span id="a84b" class="mw mx in mr b gy my mz l na nb">async function handleClick() {<br/>  someSyncOperation();</span><span id="a0ff" class="mw mx in mr b gy nc mz l na nb">  const [ postJson, commentsJson ] = await Promise.all([<br/>    fetchPost(), <br/>    fetchComments()<br/>  ]);</span><span id="7151" class="mw mx in mr b gy nc mz l na nb">  appendPostDOM(postJson);<br/>  appendCommentsDOM(commentsJson);<br/>}</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/1b9211a0c3017f42c26e047aa74333a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37EwgrRI3pE2GHO9axxQpA.png"/></div></div></figure><p id="7464" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated"><strong class="ld io">由于</strong> <code class="fe mo mp mq mr b"><strong class="ld io">fetchPost</strong></code> <strong class="ld io">和</strong> <code class="fe mo mp mq mr b"><strong class="ld io">fetchComments</strong></code> <strong class="ld io">并行执行，现在总执行时间为4秒。</strong></p><p id="0db6" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">好的。由于<code class="fe mo mp mq mr b">someSyncOperation</code>不依赖于AJAX请求，让我们看看将它移到函数的最后一行是否会加快速度。</p><pre class="kd ke kf kg gt ms mr mt mu aw mv bi"><span id="c2f9" class="mw mx in mr b gy my mz l na nb">async function handleClick() {<br/>  const [ postJson, commentsJson ] = await Promise.all([<br/>    fetchPost(), <br/>    fetchComments()<br/>  ]);</span><span id="31b7" class="mw mx in mr b gy nc mz l na nb">  appendPostDOM(postJson);<br/>  appendCommentsDOM(commentsJson);</span><span id="645a" class="mw mx in mr b gy nc mz l na nb">  someSyncOperation();<br/>}</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ng"><img src="../Images/825f2617c41849b71d7d5498fd4b9d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LIFtuI-vycSo2BLz15jZVg.png"/></div></div></figure><p id="8aa2" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">没有，总执行时间仍然是4秒。</p><p id="51cb" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">好的。是时候去“全面承诺”了。</p><pre class="kd ke kf kg gt ms mr mt mu aw mv bi"><span id="ca4f" class="mw mx in mr b gy my mz l na nb">function handleClick() {<br/>  Promise.all([<br/>    fetchPost(),<br/>    fetchComments()<br/>  ]).then(([ postJson, commentsJson ]) =&gt; {<br/>    appendPostDOM(postJson);<br/>    appendCommentsDOM(commentsJson)<br/>  });</span><span id="ef38" class="mw mx in mr b gy nc mz l na nb">  someSyncOperation();<br/>}</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nh"><img src="../Images/955529e1cc9172729a2a0e80af48db93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBJ0Vh_BHYVCzm4BF0dQoQ.png"/></div></div></figure><p id="1ef5" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated"><strong class="ld io">执行“完全承诺”会将总执行时间减少到2秒。</strong></p><p id="07ce" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">为什么这个作品值得自己的文章，但<a class="ae mn" href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D" rel="noopener ugc nofollow" target="_blank">在这里是一个可怕的解释者</a>。</p><p id="3683" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">今天我学会了。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/407ad2ccf21df147f0fa56a2dbb92123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-WWI7e_QvvXBYp7BPzw0PA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source: <a class="ae mn" href="https://programmerhumour.tumblr.com/post/633961754778533888/google-my-saviour" rel="noopener ugc nofollow" target="_blank">Programmer Humor</a></figcaption></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="e342" class="mw mx in bd nj nk nl dn nm nn no dp np lk nq nr ns lo nt nu nv ls nw nx ny nz bi translated">奖金</h2><p id="41d2" class="pw-post-body-paragraph lb lc in ld b le oa jo lg lh ob jr lj lk oc lm ln lo od lq lr ls oe lu lv lw ig bi translated">对于那些铁杆粉丝来说，我了解到(实际上是在写这个故事的那天)下面的片段实际上做了同样的事情。此文由<a class="ks kt ep" href="https://medium.com/u/994dcd5bc2e8?source=post_page-----f815b3df51dc--------------------------------" rel="noopener" target="_blank">月亮</a>归功于<a class="ae mn" href="https://medium.com/better-programming/an-extremely-easy-tip-to-improve-web-performance-with-async-await-b609e7e65744" rel="noopener">。</a></p><pre class="kd ke kf kg gt ms mr mt mu aw mv bi"><span id="dd59" class="mw mx in mr b gy my mz l na nb">async function handleClick() {<br/>  const postPromise = fetchPost();<br/>  const commentsPromise = fetchComments();<br/>  <br/>  someSyncOperation();<br/>  const postJson = await postPromise;<br/>  const commentsJson = await commentsPromise;</span><span id="f8b7" class="mw mx in mr b gy nc mz l na nb">  appendPostDOM(postJson);<br/>  appendCommentsDOM(commentsJson);<br/>}</span></pre></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="a283" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">喜欢这篇文章吗？如果有，通过<a class="ae mn" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ld io">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="ld io">！</strong></p><p id="dbf2" class="pw-post-body-paragraph lb lc in ld b le lf jo lg lh li jr lj lk ll lm ln lo lp lq lr ls lt lu lv lw ig bi translated">📫<em class="of">在</em><a class="ae mn" href="https://www.linkedin.com/in/suhanwijaya/" rel="noopener ugc nofollow" target="_blank"><em class="of">LinkedIn</em></a><em class="of">或</em> <a class="ae mn" href="mailto:suhanw@gmail.com" rel="noopener ugc nofollow" target="_blank"> <em class="of">邮箱</em> </a> <em class="of">！</em></p></div></div>    
</body>
</html>