<html>
<head>
<title>Introduction to State Management with Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux状态管理简介</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-state-management-with-redux-12d4b383e4fd?source=collection_archive---------8-----------------------#2020-04-21">https://javascript.plainenglish.io/introduction-to-state-management-with-redux-12d4b383e4fd?source=collection_archive---------8-----------------------#2020-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/04e6e57a97fa84be81b101094deb5539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NPvVe4K4sVTlOP8D"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@cobblepot?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kit Suman</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="47cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了Redux，我们可以用它在JavaScript应用程序的中央位置存储数据。它可以单独工作，当与React-Redux结合使用时，它也是一个受欢迎的React应用程序状态管理解决方案。</p><p id="f75a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何在应用程序中创建一个基本商店并使用它。</p><h1 id="8d2f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="c9c5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Redux可作为NPM包。我们可以通过运行以下命令来安装它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="908e" class="mn lc iq mj b gy mo mp l mq mr">npm install --save redux</span></pre><p id="a5e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与NPM或:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="138e" class="mn lc iq mj b gy mo mp l mq mr">yarn add redux</span></pre><p id="ab35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用纱线。</p><h1 id="e673" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">基本示例</h1><p id="688a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用redux通过创建一个store和reducer来存储一个app的状态。</p><p id="6008" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以订阅存储来获取数据，并调度操作来更改状态。</p><p id="1c4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5346" class="mn lc iq mj b gy mo mp l mq mr">import { createStore } from "redux";</span><span id="cee8" class="mn lc iq mj b gy ms mp l mq mr">function counter(state = 0, action) {<br/>  switch (action.type) {<br/>    case "INCREMENT":<br/>      return state + action.payload || 1;<br/>    case "DECREMENT":<br/>      return state - action.payload || 1;<br/>    default:<br/>      return state;<br/>  }<br/>}</span><span id="0639" class="mn lc iq mj b gy ms mp l mq mr">let store = createStore(counter);<br/>store.subscribe(() =&gt; console.log(store.getState()));</span><span id="f884" class="mn lc iq mj b gy ms mp l mq mr">store.dispatch({ type: "INCREMENT", payload: 2 });<br/>store.dispatch({ type: "DECREMENT", payload: 1 });</span></pre><p id="2a4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有<code class="fe mt mu mv mj b">counter</code> reducer函数，它获取动作类型和有效负载，然后相应地应用它。</p><p id="aaa4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">counter</code>函数检查动作类型<code class="fe mt mu mv mj b">INCREMENT</code>和<code class="fe mt mu mv mj b">DECREMENT</code>，并返回添加了<code class="fe mt mu mv mj b">payload</code>的新状态。</p><p id="04c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们通过运行以下命令来创建<code class="fe mt mu mv mj b">store</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a542" class="mn lc iq mj b gy mo mp l mq mr">let store = createStore(counter);</span></pre><p id="b46c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，我们可以通过调用商店上的<code class="fe mt mu mv mj b">subscribe</code>来订阅商店，然后在回调中调用<code class="fe mt mu mv mj b">getState</code>，如下所示:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b39d" class="mn lc iq mj b gy mo mp l mq mr">store.subscribe(() =&gt; console.log(store.getState()));</span></pre><p id="39ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过用一个带有<code class="fe mt mu mv mj b">type</code>和<code class="fe mt mu mv mj b">payload</code>的对象调用商店上的<code class="fe mt mu mv mj b">dispatch</code>来分派动作，这些动作将被传递到<code class="fe mt mu mv mj b">action</code>参数中的<code class="fe mt mu mv mj b">counter</code>函数中。</p><p id="fcd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，<code class="fe mt mu mv mj b">state</code>将被<code class="fe mt mu mv mj b">action</code>更新，因为对于第一个<code class="fe mt mu mv mj b">dispatch</code>调用:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="29b6" class="mn lc iq mj b gy mo mp l mq mr">store.dispatch({ type: "INCREMENT", payload: 2 });</span></pre><p id="6a17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">type</code>将作为<code class="fe mt mu mv mj b">action.type</code>传入，有效载荷将设置为<code class="fe mt mu mv mj b">action.payload</code>至<code class="fe mt mu mv mj b">counter</code>。</p><p id="e7a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">action.type</code>是<code class="fe mt mu mv mj b">‘INCREMENT’</code>，<code class="fe mt mu mv mj b">action.payload</code>是2。</p><p id="3653" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，在第二次调用中，<code class="fe mt mu mv mj b">action.type</code>为<code class="fe mt mu mv mj b">‘DECREMENT’</code>，<code class="fe mt mu mv mj b">action.payload</code>为1。</p><p id="c887" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，我们没有在<code class="fe mt mu mv mj b">counter</code>中直接改变状态。我们通过从现有状态派生出一个新状态来返回它。</p><h1 id="d757" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">冗余的三个原则</h1><p id="7137" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">三个原则适用于Redux的构建方式。</p><h2 id="f708" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">真理的单一来源</h2><p id="0f41" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Redux将状态存储在一个地方。这使得获取数据变得容易，因为我们只需要在一个地方获取数据。</p><p id="22f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此调试也很容易。这使得开发速度更快。</p><p id="f440" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一些以前很难实现的功能现在变得很容易，因为现在状态存储在一个单独的树中。</p><h2 id="16ef" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">状态为只读</h2><p id="4149" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">该状态是只读的，因此不会被意外更改。我们必须表达改变国家的意图。</p><p id="92c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">没有微妙的竞争条件需要注意，因为所有的变化都是集中的，并以严格的顺序一个接一个地发生。</p><p id="4d45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为动作只是普通的对象，所以它们可以被记录、序列化、存储和重放，用于调试和测试目的。</p><h2 id="1ced" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">变化是由纯函数产生的</h2><p id="c446" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Reducers是纯函数，它接受前一个状态和动作，并返回下一个状态。我们返回新的状态对象，而不是改变以前的状态。</p><p id="3c52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从单个缩减器开始，然后将它分成管理状态树其他部分的更小的缩减器。</p><p id="4d83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以控制如何调用它们，传递额外的数据，或者制造可重用的reducers。</p><h1 id="bf62" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通量架构</h1><p id="51bb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Redux将所有模型更新逻辑集中在一个app的一层。这是Redux采用的Flux架构的一部分。</p><p id="397d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Redux没有调度员。它依靠纯函数而不是事件发射器来改变状态。</p><p id="d577" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">纯函数很容易组合，不需要额外的管理。</p><p id="b682" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Redux假设我们从不改变我们的数据。我们应该总是返回新的对象。这很容易，因为我们有了对象的spread操作符。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/a6f3c58c098f7f129d069f28b1803b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qfT1SkSA4AZa2x-r"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kelly Sikkema</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="5066" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">RxJS</h1><p id="da07" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过订阅Redux存储并调用<code class="fe mt mu mv mj b">nexr</code>来返回最新状态，从而将Redux存储转换为Rxjs可观察存储。</p><p id="8ae4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0937" class="mn lc iq mj b gy mo mp l mq mr">import { createStore } from "redux";</span><span id="43c3" class="mn lc iq mj b gy ms mp l mq mr">function counter(state = 0, action) {<br/>  switch (action.type) {<br/>    case "INCREMENT":<br/>      return state + action.payload || 1;<br/>    case "DECREMENT":<br/>      return state - action.payload || 1;<br/>    default:<br/>      return state;<br/>  }<br/>}</span><span id="857b" class="mn lc iq mj b gy ms mp l mq mr">let store = createStore(counter);</span><span id="8bee" class="mn lc iq mj b gy ms mp l mq mr">function toObservable(store) {<br/>  return {<br/>    subscribe({ next }) {<br/>      const unsubscribe = store.subscribe(() =&gt; next(store.getState()));<br/>      next(store.getState());<br/>      return { unsubscribe };<br/>    }<br/>  };<br/>}</span><span id="fa9f" class="mn lc iq mj b gy ms mp l mq mr">const counterObservable = toObservable(store);</span><span id="9416" class="mn lc iq mj b gy ms mp l mq mr">counterObservable.subscribe({<br/>  next(count) {<br/>    console.log(count);<br/>  }<br/>});</span><span id="f377" class="mn lc iq mj b gy ms mp l mq mr">store.dispatch({ type: "INCREMENT", payload: 2 });<br/>store.dispatch({ type: "DECREMENT", payload: 1 });</span></pre><p id="0654" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="808d" class="mn lc iq mj b gy mo mp l mq mr">function toObservable(store) {<br/>  return {<br/>    subscribe({ next }) {<br/>      const unsubscribe = store.subscribe(() =&gt; next(store.getState()));<br/>      next(store.getState());<br/>      return { unsubscribe };<br/>    }<br/>  };<br/>}</span><span id="e661" class="mn lc iq mj b gy ms mp l mq mr">const counterObservable = toObservable(store);</span><span id="7412" class="mn lc iq mj b gy ms mp l mq mr">counterObservable.subscribe({<br/>  next(count) {<br/>    console.log(count);<br/>  }<br/>});</span><span id="8a17" class="mn lc iq mj b gy ms mp l mq mr">store.dispatch({ type: "INCREMENT", payload: 2 });<br/>store.dispatch({ type: "DECREMENT", payload: 1 });</span></pre><p id="fc8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">toObservable</code>返回一个我们可以订阅的可观察值，因为它返回一个<code class="fe mt mu mv mj b">subscribe</code>方法。</p><p id="24c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Redux store的<code class="fe mt mu mv mj b">subscribe</code>方法返回一个<code class="fe mt mu mv mj b">unsubscribe</code>函数，这样当我们不再需要它时就可以取消订阅。</p><p id="f487" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，当我们调用上面的<code class="fe mt mu mv mj b">dispatch</code>时，我们将获得记录在上面的<code class="fe mt mu mv mj b">next</code>函数中的新值。</p><h1 id="e9dc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="83ec" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Redux将应用程序的数据存储在一个中心位置。为此，我们创建一个存储，然后订阅它以从中获取最新状态。</p><p id="8be3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们用一个带有动作类型和有效负载的普通对象对存储调用<code class="fe mt mu mv mj b">dispatch</code>,将存储更改为最新状态。</p><h2 id="0b99" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="0e81" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a><a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a><a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>——谢谢，继续学习！</p><p id="3cbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>