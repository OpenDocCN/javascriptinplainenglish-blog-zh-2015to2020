<html>
<head>
<title>What You Don’t Know About the User-Agent</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于用户代理你不知道的是</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/3-facts-you-should-know-about-user-agent-a476251ee3b5?source=collection_archive---------3-----------------------#2020-07-19">https://javascript.plainenglish.io/3-facts-you-should-know-about-user-agent-a476251ee3b5?source=collection_archive---------3-----------------------#2020-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ca5a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">每个开发人员都应该知道的关于用户代理的3个事实</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/97be14a5dca7357fa55963698ded40aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZI0EihvbHHPB_D-5"/></div></div></figure><p id="0837" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在花半天时间深入研究用户代理问题之前，我希望知道一些事实。我将分享我在这篇文章中学到的东西。</p><p id="a29c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，让我们定义什么是用户代理。</p><blockquote class="ln lo lp"><p id="8f94" class="kr ks lq kt b ku kv jr kw kx ky ju kz lr lb lc ld ls lf lg lh lt lj lk ll lm ij bi translated">用户代理(UA)是包含在HTTP头中的字符串，用于浏览器检测:识别访问用户的设备/平台，并可用于确定要返回的适当内容。</p></blockquote></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h2 id="970a" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">用户代理一团糟</h2><p id="87ac" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">事实是，用户代理充满了谎言。在很多情况下，<a class="ae mz" href="https://webaim.org/blog/user-agent-string-history/" rel="noopener ugc nofollow" target="_blank">一个浏览器用用户代理</a>伪装成另一个浏览器。在用户代理的历史上，浏览器经常伪装成另一个浏览器，因为一些网站基于像Mozilla这样的浏览器类型提供内容(框架等)。伪装成“Mozilla”是用框架接收内容的最简单方法。</p><p id="409e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以现在每个浏览器都伪装成另一个类似Mozilla的浏览器。一个例子就是Chrome自称<em class="lq"> M </em> <code class="fe na nb nc nd b"><em class="lq">ozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/0.2.149.27 Safari/525.13</em></code> <em class="lq">。</em></p><p id="9732" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不幸的是，几乎所有的浏览器都这样做，这使得用户代理完全一团糟。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h2 id="c2c4" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">使用UA的浏览器检测不可靠</h2><p id="ba6a" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">用户代理通常用于浏览器检测，通常包括在UA字符串中搜索特定的字符串或模式。下面是一个简单的例子。</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="e25b" class="mb mc iq nd b gy ni nj l nk nl">if (window.navigator.userAgent.indexOf('MSIE') &gt; 0){<br/>    <!-- -->alert('IE is not supported');<br/>}</span></pre><p id="2c75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个快速简单的解决方案，但也有代价。一个问题是用户代理字符串在新版本中可能会改变。然后，脚本需要更新。如果UA浏览器检测的目的是使用/不允许某个web功能，找到每个浏览器用户代理是不实际的，因为有太多的变化。</p><p id="9e84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个更好的解决方案是使用像<a class="ae mz" href="https://modernizr.com/" rel="noopener ugc nofollow" target="_blank"> Modernizr </a>这样的工具进行特征检测。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h2 id="d2be" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">用户代理将被谷歌弃用</h2><p id="9ef4" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">2020年，谷歌宣布<a class="ae mz" href="http://User Agent will be deprecated" rel="noopener ugc nofollow" target="_blank">它将“反对并冻结”用户代理</a>。</p><blockquote class="ln lo lp"><p id="e2ee" class="kr ks lq kt b ku kv jr kw kx ky ju kz lr lb lc ld ls lf lg lh lt lj lk ll lm ij bi translated">“除了这些隐私问题，用户代理嗅探是兼容性问题的一个丰富来源，特别是对少数民族浏览器来说，导致浏览器对自己撒谎，网站(包括谷歌属性)<a class="ae mz" href="https://www.google.com/url?q=https%3A%2F%2Fwww.onmsft.com%2Fnews%2Fgoogle-has-apparently-blocked-its-stadia-cloud-gaming-service-on-the-chromium-based-microsoft-edge&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGLbwpKABVCN-FuD6HvibnwdHJ-5g" rel="noopener ugc nofollow" target="_blank">在一些浏览器中被破坏</a>没有好的理由，”<a class="ae mz" href="https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/-2JIRNMWJ7s/yHe4tQNLCgAJ" rel="noopener ugc nofollow" target="_blank">负责Chrome浏览器的谷歌工程师Yoav Weiss </a>说。</p></blockquote><p id="8c28" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">谷歌的第一步是用Chrome 81弃用<code class="fe na nb nc nd b">navigator.userAgent</code>方法，然后随着2020年6月Chrome 83的发布，每次更新都会冻结用户代理字符串。Chrome 85将统一跨设备的用户代理。</p><p id="0283" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">谷歌取代用户代理的是<a class="ae mz" href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/client-hints" rel="noopener ugc nofollow" target="_blank">客户端提示</a>。</p><p id="6c4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">围绕谷歌的举动有很多争论和怀疑，但在苹果和微软的支持下，用户代理的逐步淘汰似乎是不可避免的。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h2 id="a1de" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">结论</h2><p id="29dd" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">以下摘自<a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent" rel="noopener ugc nofollow" target="_blank"> MDN Web </a>的摘录很好地总结了本文的论点。</p><blockquote class="ln lo lp"><p id="48d7" class="kr ks lq kt b ku kv jr kw kx ky ju kz lr lb lc ld ls lf lg lh lt lj lk ll lm ij bi translated">使用用户代理嗅探很少是个好主意。您几乎总能找到更好、更广泛兼容的方法来解决您的问题！</p></blockquote></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="98bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lq">如果您还不是Medium的付费会员，</em> <a class="ae mz" href="https://sunnysun-5694.medium.com/membership" rel="noopener"> <strong class="kt ir"> <em class="lq">您可以访问此链接</em> </strong> </a> <em class="lq">。你可以无限制地阅读媒体上的所有报道。我会收你一部分会员费作为介绍费。</em></p></div></div>    
</body>
</html>