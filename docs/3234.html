<html>
<head>
<title>Loving GraphQL more than REST</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">爱图表胜过爱休息</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/loving-graphql-more-than-rest-4e213c568635?source=collection_archive---------12-----------------------#2020-09-11">https://javascript.plainenglish.io/loving-graphql-more-than-rest-4e213c568635?source=collection_archive---------12-----------------------#2020-09-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/50444819889b1443f1def8a8d382c0df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxDw0j3ANBxpatoCdNW8JQ.png"/></div></div></figure><p id="d688" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自从脸书开源GraphQL以来，它的受欢迎程度一直在不断增加，今天几乎无处不在。但是是什么让它如此受欢迎呢？它与基于REST的架构相比如何，它会完全取代REST APIs吗？以下是我对GraphQL的一些看法</p><p id="3e6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我刚开始学习GraphQL的时候，对这个一无所知。我已经有了这样的想法，我将学习一些与Rest APIs世界完全不同的东西。但是在我学习GraphQL的中途，我意识到甚至在开始学习它之前，我就已经产生了一些非常不切实际的想法，其中最大的想法是</p><p id="329e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GraphQL是一个独立的东西，它没有使用我们在REST APIs中真正熟悉的东西。</p><p id="ab3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这与现实相差甚远，也很有趣，但对于那些从未接触过GraphQL，只是看到它在表面上工作的人来说，这就是它的样子。</p><h2 id="9403" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">那么GraphQL到底是什么呢？</h2><p id="933a" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">如果我现在用最简单的术语来定义它，我会说它只是一个<strong class="ka ir">规范</strong>。一种非常酷的使用现有网络技术的方式。在幕后，GraphQL查询只是一个对API端点的HTTP Post请求。是的，它是对一个端点的Post请求，该端点被设计成处理包括GraphQL查询的请求，让我们通过构建一个GraphQL服务器来快速地看一个例子</p><p id="c4c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了简单起见，我将使用Node，但是因为GraphQL本身就是一个运行时。我们用什么语言来构建API并不重要。让我们快速安装依赖项</p><p id="f4de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lv lw lx ly b">yarn add apollo-server moment</code></p><p id="149c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并构建一个简单的GraphQL API</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="ace8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行查询</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/3f4337789c8965f789d33f583bc19464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTjqS4y5E1JZzhuxSjKwaQ.jpeg"/></div></div></figure><h2 id="1121" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated"><strong class="ak">等等，这不是在GraphQL中运行查询的方式！</strong></h2><p id="b79f" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">是的，完全正确，如果你曾经接触过GraphQL playground，你就会知道，但这就是我上面所说的。在幕后，一个GraphQL客户端(考虑GraphQL playground)向指定的API端点/通道发送一个post请求，其主体与上面类似。GraphQL运行时已经知道如何处理请求，因为它对将要获取和发送回的数据有一种模式感。</p><p id="7e08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，这通常会导致一个意想不到的行为，当你返回一个你没有在类型定义中指定的值时，GraphQL会尝试自动类型转换这个值，如果它不起作用，就会爆炸。</p><p id="574b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">快速提示——对GraphQL API的每个请求都被归类为一个查询，包括变异、订阅和查询本身，如果你知道它们是什么的话。</em></p><h2 id="eef7" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">Schema是GraphQL如此强大的唯一原因吗？</h2><p id="3042" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">不，还有更多，真的有更多，GraphQL为您的API(尤其是客户端)带来了更多的功能，它允许它们只查询特定的字段，因此它们只能查询所需的数据，而忽略其余的，这导致了更小的传输大小、更少的带宽和延迟。让我们从上面对我们的代码进行更改，并看看它的运行情况</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="addd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们向类型dateTime添加了另一个字段，这次我们不想查询其他两个字段。这真的非常简单，我们所要做的就是在发出如下请求时指定我们感兴趣的字段</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/7efa52906a26b58e81ba2cf3d46eec28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zaQAUnUIov7mPj2ygLk1w.jpeg"/></div></div></figure><p id="40b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于一个小的应用程序来说，这并没有增加多少。但是对于一个大的应用程序，你总是想要最优的解决方案。只查询必需字段的想法本身就非常强大，因此它一直是传统REST架构中的一种模式，也为检索某些特定数据制定路线。这对于一个小的应用程序来说没有问题，甚至在理论上也没有问题，但是随着应用程序变得越来越大(想想脸书)，连接线变得越来越复杂，你最终会遇到这样的情况，你不得不使用GraphQL之类的东西重新设计整个系统，或者可能最终构建另一个GraphQL。</p><p id="0d67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GraphQL还提供了更多更酷的东西(比如订阅)，但这些可以留到以后的文章中讨论，因为我想讨论GraphQL是否比传统的REST APIs更好。</p><h2 id="83c1" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">GraphQL真的是更好的REST并且要完全取代它吗？</h2><p id="642e" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我同意GraphQL是rest的一个更好的版本，它是REST的一个非常强大的替代品，但它不会在今天或短期内取代API。这有几个原因。主要的是</p><p id="89d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于一个小的应用程序来说，REST API可以做GraphQL API能做的几乎所有事情。</p><p id="83f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">因为GraphQL允许客户端只查询他们需要的字段，所以给客户端带来了更大的能力。但是这个强大的特性牺牲了服务器端的性能，如果客户端请求大量的嵌套字段，需要多个资源，比如从文件系统或数据库中读取。有数以百万计的此类请求，而您的服务器无法快速扩展，您最终会耗尽资源。</em></p><p id="48fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以上原因就是为什么在<strong class="ka ir">企业界，GraphQL APIs是和REST API结合使用的。</strong></p><h2 id="e009" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">GraphQL的个人体验</h2><p id="ee58" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在个人层面上，GraphQL是我构建API时的首选，现在我真的还没有构建过任何不包含graph QL的东西。仅仅是因为它增加了一个更好的全栈DX。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="40c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你做到了最底层！感谢您的阅读。</p><h2 id="b392" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">简单英语的JavaScript</h2><p id="b285" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">你知道我们有三份出版物和一个YouTube频道吗？在<a class="ae mo" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">寻找一切的链接plainenglish.io </strong> </a>！</p></div></div>    
</body>
</html>