# è®©æˆ‘ä»¬æž„å»ºä¸€ä¸ª MongoDB+Express+React+graph QL+Relay Modern å…¨æ ˆ Web App(ä»Žé›¶å¼€å§‹ï¼)â€”åŽç«¯éƒ¨åˆ†

> åŽŸæ–‡ï¼š<https://javascript.plainenglish.io/lets-build-a-mongodb-express-react-graphql-relay-modern-full-stack-web-app-from-scratch-a4ae3aaf212?source=collection_archive---------1----------------------->

![](img/f9a0b8a0894f4922c372d7e490ecccb3.png)

React x Relay x GraphQL

> å—¨ï¼ä½ å¯ä»¥åœ¨ä¸‹é¢çš„é“¾æŽ¥ä¸­æ‰¾åˆ°æœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†ã€‚
> 
> [æœ¬æ–‡ç¬¬äºŒéƒ¨åˆ†ã€‚ä½¿ç”¨ React å’Œ Relay é…ç½®å‰ç«¯ã€‚](https://medium.com/@jelorivera08/lets-build-a-mongodb-express-react-graphql-relay-modern-full-stack-web-app-from-scratch-d41b5091d41d)

è‡ªä»Žæˆ‘ä¸Šä¸€ç¯‡å…³äºŽ web åº”ç”¨å †æ ˆçš„æ–‡ç« ä»¥æ¥ï¼Œæˆ‘æ”¶é›†äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼Œæˆ‘æƒ³ä¸Žä½ ä»¬åˆ†äº«ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸Šè¿°æ‰€æœ‰æŠ€æœ¯çš„åŸºæœ¬ notes web åº”ç”¨ç¨‹åºã€‚CRUDï¼Œcloud mongoDBï¼ŒReact å‰ç«¯ï¼Œä¸­ç»§çŽ°ä»£çŠ¶æ€ç®¡ç†(å¥–é‡‘æ›´æ–°æ•™ç¨‹)ï¼ŒgraphQL æŸ¥è¯¢å’Œçªå˜ã€‚

ä½œä¸ºä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæˆ‘ä¸€ç›´åœ¨åŠªåŠ›å¯»æ‰¾å°†è¿™äº›æŠ€æœ¯çš„åŸºæœ¬åº”ç”¨èžå…¥åˆ°ä¸€ä¸ªçœŸå®žåº”ç”¨ä¸­çš„æ–‡ç« ã€‚è¿™å°±æ˜¯æˆ‘å‘è¡¨è¿™ç¯‡æ–‡ç« çš„åŽŸå› ã€‚æˆ‘ä»¬å°†ä»Žå¤´å¼€å§‹æž„å»ºè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥å‡†å¤‡å¥½ä½ çš„ç¼–ç æ‰‹æŒ‡ã€‚(ç»™ä½ ä¸€ä¸ªå»ºè®®ï¼Œæˆ‘ä¼šåœ¨æ–‡ç« çš„æœ€åŽå‘å¸ƒè¿™ä¸ª web åº”ç”¨ç¨‹åºçš„æœ€ç»ˆ git repoï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä¸€æ­¥ä¸€æ­¥åœ°è·Ÿç€æˆ‘äº†ã€‚è¿™å°†æœ‰åŠ©äºŽä½ ç‰¢ç‰¢æŽŒæ¡è¿™äº›æŠ€æœ¯æå‡ºçš„ç†è®º/æƒ³æ³•ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¤§åž‹ç§‘æŠ€å…¬å¸ç›®å‰æ­£åœ¨ä½¿ç”¨çš„æœ€æ–°ã€æœ€é¡¶å°–çš„æŠ€æœ¯ã€‚æœ¬æ–‡è¦æ±‚æ‚¨è‡³å°‘å…·å¤‡ Reactã€Javascriptã€Relay å’Œ graphQL çš„åŸºç¡€çŸ¥è¯†ã€‚å¦‚æžœä½ æœ‰è¿™äº›åŸºæœ¬æŠ€èƒ½ï¼Œè®©æˆ‘ä»¬å¼€å§‹æž„å»ºå¹¶å¼€å§‹ç¼–ç å§ï¼[ðŸ‘¨â€ðŸ’»](https://emojipedia.org/man-technologist/) [ðŸ‘©â€ðŸ’»](https://emojipedia.org/woman-technologist/)

> æˆ‘ä½¿ç”¨ Heroku éƒ¨ç½²äº† web åº”ç”¨ç¨‹åºçš„æœ€ç»ˆç‰ˆæœ¬ã€‚åŠ è½½ web app æ—¶è¯·è€å¿ƒç­‰å¾…ã€‚å½“ç½‘ç«™é—²ç½®ä¸€æ®µæ—¶é—´åŽï¼ŒHeroku ä¼šå¯åŠ¨æœåŠ¡å™¨ã€‚å’Œå¹³ï¼:-)

# åŠ å¿«æˆ‘ä»¬çš„åŽç«¯

å…ˆè¯´æˆ‘ä»¬çš„ GraphQL + Express + MongoDB æœåŠ¡å™¨æ ˆã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚è®©æˆ‘ä»¬å°†å…¶å‘½åä¸º full-stack-appï¼Œå¹¶åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡å™¨ç›®å½•ã€‚è®©æˆ‘ä»¬åˆå§‹åŒ–æˆ‘ä»¬çš„æœåŠ¡å™¨ç›®å½•å¹¶å®‰è£…ä¸‹é¢çš„åº“ã€‚

```
mkdir full-stack-app
cd full-stack-app
mkdir server
cd server
mkdir src
touch src/index.js
npm init -y 
npm install express express-graphql cors graphql mongodb
```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº† src æ ¹ç›®å½•å’Œ index.jsã€‚åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬å°†åˆå§‹åŒ–æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œå› æ­¤ç»§ç»­åœ¨ src/index.js ä¸­é”®å…¥ä¸‹é¢çš„ä»£ç 

backend â€” src/index.js

å½“æ‚¨è¿è¡Œ`node *./src/index.js*` æ—¶ï¼ŒæœåŠ¡å™¨åº”è¯¥å¯åŠ¨å¹¶è¿è¡Œã€‚

çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬é…ç½®æˆ‘ä»¬çš„ MongoDB æ•°æ®åº“ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ MongoDB åœ¨äº‘ä¸­å­˜å‚¨æˆ‘ä»¬çš„æ•°æ®ã€‚ç™»é™†ä»–ä»¬çš„[ç½‘ç«™](https://www.mongodb.com/cloud/atlas)ï¼Œåˆ›å»ºä½ è‡ªå·±çš„è´¦æˆ·ã€‚åˆ«æ‹…å¿ƒï¼Œè¿™æ˜¯å…è´¹çš„ã€‚æ³¨å†Œå¹¶ç™»å½•åŽã€‚éµå¾ªè¿™äº›æ­¥éª¤ã€‚æˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„ç©ºé—²é›†ç¾¤ï¼Œå¹¶å°†å…¶é“¾æŽ¥åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„èŠ‚ç‚¹æœåŠ¡å™¨ã€‚

1.  ä»Žé€‰é¡¹ä¸­é€‰æ‹©*åˆ›å»ºè‡ªç”±é›†ç¾¤*ã€‚
2.  é€šè¿‡é€‰æ‹©æ‚¨å–œæ¬¢çš„æ•°æ®åº“åŒºåŸŸç­‰æ¥è®¾ç½®æ‚¨çš„ç©ºé—²é›†ç¾¤ã€‚
3.  MongoDB Atlas å°†æŒ‡å¯¼æ‚¨éµå¾ªä»–ä»¬çš„æ•™ç¨‹ï¼Œä¹‹åŽæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„é›†ç¾¤è¿žæŽ¥åˆ°æˆ‘ä»¬çš„èŠ‚ç‚¹æœåŠ¡å™¨ã€‚

```
Atlas tutorial will tell you to: 3.a. Build your own cluster  - done :-)
    3.b. Create your own database user
    3.c. Whitelist your own IP address
    3.d. Load Sample Data (optional)
    3.e. Connect to your cluster
```

åœ¨é›†ç¾¤çš„è¿žæŽ¥é€‰é¡¹ä¸­ï¼Œé€‰æ‹©â€œè¿žæŽ¥æ‚¨çš„åº”ç”¨ç¨‹åºâ€é€‰é¡¹ï¼Œå¹¶å¤åˆ¶æ˜¾ç¤ºçš„è¿žæŽ¥å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥ä¸­éœ€è¦å®ƒã€‚

çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬å›žåˆ°èŠ‚ç‚¹æœåŠ¡å™¨ä»£ç ï¼Œåœ¨ src ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º config çš„ç›®å½•ã€‚åœ¨æˆ‘ä»¬çš„é…ç½®ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º databaseConnection.js çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™ä¸‹é¢çš„ä»£ç ã€‚å°†æˆ‘ä»¬ä¹‹å‰å¤åˆ¶çš„å­—ç¬¦ä¸²ç²˜è´´åˆ° uri å˜é‡ä¸­ï¼Œå¹¶å°† db ç”¨æˆ·å‡­è¯æ›´æ”¹ä¸ºæ‚¨çš„å‡­è¯ã€‚

çŽ°åœ¨æˆ‘ä»¬å¿…é¡»åœ¨ index.js å†…éƒ¨è°ƒç”¨å®ƒã€‚

```
src/index.js
...const graphqlHTTP = require('express-graphql');
const { setupDB } = require('./config/databaseConnection')setupDB(*v* => console.log(v));const schema = {
*// we will add this later* };...
```

å†æ¬¡è¿è¡Œ`node .src/index.js` ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®åº“æˆåŠŸè¿žæŽ¥ã€‚

çŽ°åœ¨ï¼Œå…³äºŽ GraphQL éƒ¨åˆ†çš„äº‹æƒ…ã€‚åœ¨æˆ‘ä»¬çš„ src ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª graphql ç›®å½•ï¼Œå¹¶æŒ‰ç…§ä¸‹é¢çš„æ–‡ä»¶å¤¹ç»“æž„å¯¹å…¶è¿›è¡Œé€ åž‹ã€‚

![](img/829605dde2d4310d78ccaa50651734bb.png)

å°†ä¸‹é¢çš„è¦ç‚¹ç¼–ç åˆ°å®ƒä»¬å„è‡ªçš„æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†åœ¨ä¸‹é¢è®¨è®ºé‡è¦çš„éƒ¨åˆ†ã€‚

*   [NotesMutation.js](https://gist.github.com/jelorivera08/0becf53746a93aedb612a1c3309d9539)
*   [nodeTypes.js](https://gist.github.com/jelorivera08/cdef9b47a2cc9c06cf43be305135f62b)
*   [NotesQuery.js](https://gist.github.com/jelorivera08/6a9931e02fefce907a577785f70a7d42)
*   [schema.js](https://gist.github.com/jelorivera08/f2688be46c68e4e6e8162427fe79879e)

ä»Ž *schema.js å¼€å§‹ï¼Œç„¶åŽæ˜¯ nodeTypes.jsï¼Œç„¶åŽæ˜¯ NotesQuery.jsï¼Œæœ€åŽæ˜¯ notesumtation . js*

![](img/a103329a242b17503cd51d7452068fef.png)

schema.js

è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬çš„ graphql æ ¹æ¨¡å¼ã€æŸ¥è¯¢å’Œå˜å¼‚ã€‚è¿™äº›å°±åƒè§£æžæ•°æ®åº“æŸ¥è¯¢å’Œå…¶ä»–æœåŠ¡å™¨ç›¸å…³ä»»åŠ¡çš„ api è·¯ç”±ã€‚

![](img/28a325acb336b2aabe9206789998a613.png)

nodeTypes.js

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„ graphql å¯¹è±¡æ•°æ®ç±»åž‹ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ³¨é‡Šç±»åž‹ï¼Œå®ƒæœ‰è‡ªå·±çš„ _id å’Œå†…å®¹å­—æ®µã€‚

![](img/9149e36fcca6df733847a0c23dd05ccf.png)

NotesQuery.js

è¿™æ˜¯æˆ‘ä»¬çš„è´¦å•ã€‚ä¸€æ—¦æˆ‘ä»¬å¼€å§‹åˆ›å»ºå®ƒä»¬ï¼Œè¿™å°†è¿”å›žå­˜å‚¨åœ¨æˆ‘ä»¬æ•°æ®åº“ä¸­çš„æ‰€æœ‰â€œæ³¨é‡Šâ€ã€‚

![](img/c66934ab2d1db1173ae56dc5a1b7e115.png)

NotesMutation.js

è¿™æ˜¯æˆ‘ä»¬ notes å˜å¼‚çš„ä¸€ä¸ªä¾‹å­ã€‚ä¸€æ—¦æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªçªå˜æŸ¥è¯¢ï¼Œè¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªæ³¨é‡Šã€‚

çŽ°åœ¨è¿™äº›éƒ½æ˜¯ä¸€å£æ°”è¦åšçš„å¾ˆå¤šï¼Œæ‰€ä»¥æ…¢æ…¢æ¥ï¼Œé˜…è¯»å¹¶ç†è§£èƒŒåŽçš„ä»£ç å’Œæƒ³æ³•ã€‚æ‚¨å¯èƒ½æƒ³çŸ¥é“ NoteService çš„ä¸œè¥¿æ˜¯ä»Žå“ªé‡Œæ¥çš„ã€‚å®ƒåªæ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªæœåŠ¡ç±»ï¼Œç”¨æ¥æŠ½è±¡æˆ‘ä»¬çš„ mongodb å­˜å‚¨åº“æŸ¥è¯¢ã€‚æˆ‘ä»¬ä¸€ä¼šå„¿å°±ä¼šè°ˆåˆ°è¿™ä¸€ç‚¹ã€‚

æˆ‘ä»¬çŽ°åœ¨å¤„äºŽæœåŠ¡å™¨è®¾ç½®çš„æœ€åŽé˜¶æ®µã€‚æˆ‘ä»¬åªéœ€å°†æˆ‘ä»¬çš„ mongodb å­˜å‚¨åº“ä¸Žæˆ‘ä»¬çš„ graphql æŸ¥è¯¢é“¾æŽ¥èµ·æ¥ã€‚ä¸ºæ­¤ï¼Œåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æ–‡ä»¶å¤¹ç»“æž„ã€‚

![](img/df457db4dcc4d73976074c8e186c9598.png)

services and repository

å°±åƒæˆ‘ä»¬ä¸ä¹…å‰æ‰€åšçš„é‚£æ ·ï¼Œå°†ä¸‹é¢çš„è¦ç‚¹ç¼–ç åˆ°å®ƒä»¬å„è‡ªçš„ js æ–‡ä»¶ä¸­ï¼Œæˆ‘ä¼šè¾¹èµ°è¾¹è§£é‡Šå®ƒä»¬ã€‚

*   [mongoDbRepository.js](https://gist.github.com/jelorivera08/0676b10a9de26ce137c5ee2e93746ec8)
*   [notes service . js](https://gist.github.com/jelorivera08/90b88184430f4a9ee781b56906b39426)

![](img/7cd701eb7f71674b8993b17f4b0ac196.png)

MongoDbRepo class

åœ¨è¿™ä¸ª MongoDbRepo ç±»ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯è¿žæŽ¥åˆ°æˆ‘ä»¬çš„ MongoDB æ•°æ®åº“ï¼Œæˆ‘ä»¬å…¬å¼€äº†ä¸€äº› APIï¼Œè®©æˆ‘ä»¬å¯ä»¥å¯¹æˆ‘ä»¬çš„æ•°æ®åº“æ¡ç›®è¿›è¡Œ CRUD æ“ä½œã€‚

![](img/6f3349dafb2db372273b89398ab810fc.png)

è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ MongoDbRepo ç±»æ¥å®žä¾‹åŒ–ä¸€ä¸ªé“¾æŽ¥åˆ°â€œnotesâ€æ•°æ®åº“çš„å­˜å‚¨åº“ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­ä¿å­˜æ‰€æœ‰çš„â€œNotesâ€æ¡ç›®ã€‚è¯·æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸ºäº†æ›´å¥½åœ°æ‰©å±•æˆ‘ä»¬çš„ä»£ç ï¼Œä»¥åŠæ›´å¥½åœ°æŠ½è±¡æˆ‘ä»¬çš„æ•°æ®ã€‚

å”·ï¼å¿«å¥½äº†ï¼

çŽ°åœ¨è®©æˆ‘ä»¬ä¿®æ”¹ src/index.js ä»£ç ï¼Œä»¥ä¾¿å°† graphql æ¨¡å¼é“¾æŽ¥åˆ°æˆ‘ä»¬çš„ express æœåŠ¡å™¨ã€‚å°† src/index.js ä»£ç æ›´æ”¹å¦‚ä¸‹ã€‚

```
const express = require('express');
const graphqlHTTP = require('express-graphql');
const schema = require('./graphql/schema');
const { setupDB } = require('./config/databaseConnection');
const cors = require('cors');const app = express();
setupDB(*v* => console.log(v));app.use(cors());
app.use(
    '/graphql',
    graphqlHTTP({
        schema,
        graphiql: true,
        pretty: true
    })
);app.listen(4000);
console.log('SERVER OK');
```

æžå®šäº†ã€‚çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å°è¯•æˆ‘ä»¬çš„ graphql æœåŠ¡å™¨ï¼Œçœ‹çœ‹è¿™ä¸ªå®è´æ˜¯å¦‚ä½•éª‘è¡Œçš„ï¼å°†ä¸‹é¢çš„ url ç²˜è´´åˆ°æµè§ˆå™¨ä¸­ï¼ŒæŸ¥çœ‹æˆ‘ä»¬æ–°æž„å»ºçš„ graphql æœåŠ¡å™¨ã€‚

```
[http://localhost:4000/graphql](http://localhost:4000/graphql)
```

å°è¯•ç”¨è¿™ä¸ªçªå˜æŸ¥è¯¢åˆ›å»ºä¸€ä¸ªæ³¨é‡Šã€‚

```
mutation {
 createNote(content:"test") {
    content
    _id
  }
}
```

ç„¶åŽï¼Œä¸ºäº†æŸ¥çœ‹æˆ‘ä»¬çš„æŸ¥è¯¢æ˜¯å¦æœ‰æ•ˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„æŸ¥è¯¢æ¥æŸ¥è¯¢æœåŠ¡å™¨ä¸­æ‰€æœ‰å¯ç”¨çš„ notesã€‚

```
query {
  notes {
    _id
    content
  }
}
```

è€¶ï¼çŽ°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†æˆ‘ä»¬çš„åŽç«¯ï¼Œæˆ‘ä»¬çŽ°åœ¨åº”è¯¥ç»§ç»­ä½¿ç”¨ React+Relay modem åˆ›å»ºæˆ‘ä»¬çš„å‰ç«¯ã€‚æˆ‘å°†åœ¨æœ¬æ–‡çš„ç¬¬äºŒéƒ¨åˆ†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘æƒ³æŠŠå®ƒæ”¾åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œä½†æˆ‘è®¤ä¸ºå®ƒä¼šä½¿è¿™ç¯‡æ–‡ç« è¿‡äºŽé¥±å’Œï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºæœ€å¥½æŠŠå®ƒæ”¾åœ¨å•ç‹¬çš„ä¸€ç¯‡æ–‡ç« é‡Œã€‚

å¦‚æžœä½ èƒ½èµ°åˆ°è¿™ä¸€æ­¥ï¼Œæ­å–œä½ ï¼ç»™è‡ªå·±ä¸€ä¸ªé¼“åŠ±ï¼ŒèŠ±ç‚¹æ—¶é—´å¸æ”¶è¿™äº›æ–°å›¾ä¹¦é¦†è¯•å›¾ä¼ è¾¾çš„æ€æƒ³ã€‚è¿™äº›æŠ€æœ¯èµ‹äºˆå¼€å‘äººå‘˜çš„æ€ç»´å®šåŠ¿æ‰æ˜¯çœŸæ­£è®©æˆ‘ä»¬èƒ½å¤Ÿä¸ºæœ€ç»ˆç”¨æˆ·å’Œå¼€å‘äººå‘˜æž„å»ºä½¿äººç±»ç”Ÿæ´»æ›´è½»æ¾çš„ä¸œè¥¿ã€‚

> [å¦‚çº¦è€Œè‡³ã€‚](https://github.com/jelorivera08/MERG-BE)