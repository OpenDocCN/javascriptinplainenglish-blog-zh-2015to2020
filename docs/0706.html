<html>
<head>
<title>useTimeout() React Hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">useTimeout() React挂钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/usetimeout-react-hook-3cc58b94af1f?source=collection_archive---------2-----------------------#2019-11-29">https://javascript.plainenglish.io/usetimeout-react-hook-3cc58b94af1f?source=collection_archive---------2-----------------------#2019-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/abb644c4162e37dc6d7e9ba59f52d669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfaen2d5keUfKyLhjg7SgQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Running out of time! Photo by <a class="ae kc" href="https://unsplash.com/@bradneathery?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Brad Neathery</a> on <a class="ae kc" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7638" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在React中处理时间效果很难。例如，如果React组件生命周期使用不当，构建倒计时组件就非常容易出错(<a class="ae kc" href="https://medium.com/javascript-in-plain-english/usetime-react-hook-f57979338de" rel="noopener">，但是如果你有一个使用时间钩子</a>，这就很容易了！).</p><p id="b46e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将延迟回调集成到React生命周期中也存在同样的困难。我们将在React钩子中包装setTimeout。在本文中，我们将讨论:</p><ul class=""><li id="11c0" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">在React钩子中处理回调</li><li id="74c2" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">效果清理</li><li id="ecf0" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">取消效果</li></ul><h1 id="8575" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">代码优先！</h1><p id="2484" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">钩子、Jest测试和一个示例组件可以在GitHub repo:</p><div class="ms mt gp gr mu mv"><a href="https://github.com/jamesfulford/testing-react-hooks/tree/master/src/hooks/useTimeout" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">jamesfulford/测试-反应-挂钩</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj jw mv"/></div></div></a></div><p id="abce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">提供一个回调和一个超时值(以毫秒为单位)，钩子将启动一个<code class="fe nk nl nm nn b">setTimeout</code>并返回一个可以取消超时的函数。</p><figure class="no np nq nr gt jr"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="7167" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有趣的事实是，如果你想知道:在一个已经被清除的ID上调用clearTimeout是不可行的。</p><h1 id="2f0f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">挂钩依赖和效果清理</h1><p id="73ab" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">使用这个钩子最棘手的部分是在指定回调的时候。如果在重新渲染期间，传递给<code class="fe nk nl nm nn b">useTimeout</code>的回调被重新定义(即使实现是相同的)，那么效果清理被触发。这将导致超时被取消，新的超时将被排队。这可能不是您想要的行为。</p><p id="b88d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了控制重新渲染重排行为，您应该<a class="ae kc" href="https://reactjs.org/docs/hooks-reference.html#usecallback" rel="noopener ugc nofollow" target="_blank">使用React的useCallback </a>并在那里管理依赖关系。当回调的依赖关系改变时，回调将改变并触发超时清理/重新渲染。</p><p id="9b59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">说到正确管理Rect钩子依赖，我建议使用<a class="ae kc" href="https://github.com/facebook/react/issues/14920" rel="noopener ugc nofollow" target="_blank"> exhaustive-deps eslint规则</a>。</p><h1 id="5922" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">示例用法</h1><p id="99a7" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">我用这个钩子创建了一个快速堆栈来展示一个示例组件。<a class="ae kc" href="https://stackblitz.com/edit/react-use-timeout?file=InterruptingCow.jsx" rel="noopener ugc nofollow" target="_blank">https://stackblitz.com/edit/react-use-timeout?file=InterruptingCow.jsx </a></p><p id="5f22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该组件展示了钩子的重新呈现行为，使用和不使用<code class="fe nk nl nm nn b">useCallback</code>方法。它还展示了取消回调。请务必打开控制台并阅读评论！</p><p id="806a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，请查看GitHub repo中的单元测试:它们非常清楚地说明了钩子是如何工作的。</p><div class="ms mt gp gr mu mv"><a href="https://github.com/jamesfulford/testing-react-hooks/blob/master/src/hooks/useTimeout/index.test.ts" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">jamesfulford/测试-反应-挂钩</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">您现在不能执行该操作。您使用另一个选项卡或窗口登录。您在另一个选项卡上注销，或者…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="nu l ng nh ni ne nj jw mv"/></div></div></a></div><h1 id="5536" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">相关文章</h1><p id="ba3a" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">有兴趣了解更多关于React Hooks的信息吗？请真实地阅读您最近的文章:</p><div class="ms mt gp gr mu mv"><a href="https://medium.com/javascript-in-plain-english/usetime-react-hook-f57979338de" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">使用时间()反应挂钩</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">反应中的倒数很复杂/很难。让我们用钩子。</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="nv l ng nh ni ne nj jw mv"/></div></div></a></div></div></div>    
</body>
</html>