<html>
<head>
<title>Dynamically translating a PrimeNG menu using ngx-translate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ngx-translate动态翻译菜单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/dynamically-translating-a-primeng-menu-using-ngx-translate-4e758eb5aee0?source=collection_archive---------2-----------------------#2020-05-05">https://javascript.plainenglish.io/dynamically-translating-a-primeng-menu-using-ngx-translate-4e758eb5aee0?source=collection_archive---------2-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="216a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，为了我们的<em class="kl">令人敬畏的</em>启动项目，我们决定远离棱角分明的材料，转而使用<a class="ae km" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank">顺风</a> + <a class="ae km" href="https://www.primefaces.org/primeng/" rel="noopener ugc nofollow" target="_blank">顺气</a>。</p><p id="6ec2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">采取这一举措的原因是，我们设计师的工作感觉与材料设计相去甚远，我们不愿意逆流而行。我们觉得覆盖所有有棱角的材质风格并不容易，而且会很粗糙。</p><p id="70a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为向Prime过渡的一部分，我们必须重写我们的<a class="ae km" href="https://material.angular.io/components/menu/overview" rel="noopener ugc nofollow" target="_blank"> mat-menu </a>用法，以PrimeNG的“等价”<a class="ae km" href="https://www.primefaces.org/primeng/showcase/#/menu" rel="noopener ugc nofollow" target="_blank">菜单组件</a>。</p><p id="ad26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将解释我们如何成功地动态翻译PrimeNG菜单。</p></div><div class="ab cl kn ko hu kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ij ik il im in"><h1 id="2728" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">问题是</h1><p id="64ca" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">Prime的菜单系统的好处和坏处在于它有一个强大的<a class="ae km" href="https://www.primefaces.org/primeng/showcase/#/menumodel" rel="noopener ugc nofollow" target="_blank">菜单模型</a>作为后盾。</p><p id="d824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个模型的好处在于，我们可以静态地定义菜单的配置，将它作为输入传递给p-menu，让它为我们呈现一切。</p><p id="0322" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不太好的是，我们对菜单项如何呈现的控制非常有限，这与Angular Material的mat-menu组件相反，它使用内容投影，因此让我们可以轻松地将我们想要的东西插入菜单。</p><p id="b6d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这至少在国际化的环境中是有问题的，因为我们传递给菜单的标签不是动态的。它们只设置一次，不会自动更新。真扫兴。</p><p id="ef26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了mat-menu，我们只需使用ngx-translate的翻译管道，就可以很好地工作。对于PrimeNG的菜单，我们不得不求助于translateService.instant(…)，它只做一次性翻译，不会自动更新。</p><p id="0873" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我们的菜单转换成PrimeNG后的样子:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="69d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和模板:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="b635" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题是，有了这个，菜单翻译在构建时(在ngOnInit期间)只被插入<em class="kl">一次</em>，但是当语言改变时，这些不会被重新评估。真扫兴。</p><h1 id="556b" class="ku kv iq bd kw kx me kz la lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr bi translated">解决方案</h1><p id="d452" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">经过一番调查，只有两个解决方案脱颖而出:</p><ul class=""><li id="0b47" class="mj mk iq jp b jq jr ju jv jy ml kc mm kg mn kk mo mp mq mr bi translated">Fork PrimeNG的菜单来按照我们的意愿弯曲它，并且能够直接对菜单模型中提供的标签使用translate管道</li><li id="b2f1" class="mj mk iq jp b jq ms ju mt jy mu kc mv kg mw kk mo mp mq mr bi translated">每当语言发生变化时，重新构建菜单模型，使其包含正确的翻译文本</li></ul><p id="b7c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们从第二个选项开始。出于其他原因，第一种方法可能更好，但也有问题，因为它会引入技术债务。</p><p id="ea25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们的计划是:订阅语言变化事件，并在每次语言变化时重建整个菜单。</p><p id="d941" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的应用程序中，我们将当前语言存储在NGRX store中，我们的facade简单地公开了一个选择器来让我们观察值的变化，这使事情变得非常简单，但是同样的事情可以通过使用由<a class="ae km" href="https://github.com/ngx-translate/core" rel="noopener ugc nofollow" target="_blank"> ngx-translate </a>的TranslateService服务公开的<em class="kl"> onTranslationChange </em>事件发射器来实现:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="f423" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了它，每当语言发生变化时，我们都会得到警告。当这种情况发生时，我们需要重建菜单。请注意，上面的示例代码没有正确处理订阅；但是不要忘记在应用程序中使用它，否则会导致内存泄漏；-)</p><p id="4e50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了更容易地做到这一点，我们简单地将菜单模型的构造代码移到了工厂方法中:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="25e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当调用语言更改回调时，我们只需调用我们的buildUserProfileMenu方法来获得带有正确翻译的新版本菜单。</p><p id="b988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是代码的概述:</p><figure class="lx ly lz ma gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="a276" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题解决了！</p><h1 id="be0f" class="ku kv iq bd kw kx me kz la lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr bi translated">结论</h1><p id="9ac1" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">在这篇小文章中，我描述了我们如何处理新PrimeNG菜单的国际化。</p><p id="9265" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我对我们不得不这样做并不满意，但这是我能找到的最干净的方法。</p><p id="69d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止！</p><h1 id="e0c9" class="ku kv iq bd kw kx me kz la lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr bi translated">喜欢这篇文章吗？点击下面“喜欢”按钮查看更多内容，并确保其他人也能看到！</h1><p id="d9aa" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">PS:如果你想学习大量关于软件开发、Web开发、TypeScript、Angular、React、Vue、Kotlin、Java、Docker/Kubernetes和其他很酷的主题的其他很酷的东西，那么不要犹豫去<a class="ae km" href="https://www.amazon.com/Learn-TypeScript-Building-Applications-understanding-ebook/dp/B081FB89BL" rel="noopener ugc nofollow" target="_blank">拿一本我的书</a>并订阅<a class="ae km" href="https://mailchi.mp/fb661753d54a/developassion-newsletter" rel="noopener ugc nofollow" target="_blank">我的简讯</a>！</p><h2 id="c587" class="mx kv iq bd kw my mz dn la na nb dp le jy nc nd li kc ne nf lm kg ng nh lq ni bi translated">简明英语笔记</h2><p id="f12a" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">你知道我们有四种出版物吗？给他们一个follow来表达爱意:<a class="ae km" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="jp ir">JavaScript in Plain English</strong></a><a class="ae km" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="jp ir">AI in Plain English</strong></a>，<a class="ae km" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="jp ir">UX in Plain English</strong></a>，<a class="ae km" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="jp ir">Python in Plain English</strong></a><strong class="jp ir"/>—谢谢，继续学习！</p><p id="1eac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们总是有兴趣帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae km" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">submissions @ plain English . io</strong></a><strong class="jp ir"/>，附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>