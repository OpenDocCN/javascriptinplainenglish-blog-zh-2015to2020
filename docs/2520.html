<html>
<head>
<title>404: React Page Not Found</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">404:未找到反应页面</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/404-react-page-not-found-355b9352041e?source=collection_archive---------1-----------------------#2020-07-02">https://javascript.plainenglish.io/404-react-page-not-found-355b9352041e?source=collection_archive---------1-----------------------#2020-07-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4fb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="https://www.blog.karenying.com/posts/404-react-page-not-found" rel="noopener ugc nofollow" target="_blank"> <em class="kj">在黑暗模式下阅读本</em> </a> <em class="kj">上的</em><a class="ae ki" href="https://www.blog.karenying.com/" rel="noopener ugc nofollow" target="_blank"><em class="kj">blog.karenying.com</em></a><em class="kj">。</em></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/f5ecbb3a5dd4f6981ba90dce5fa5a4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SykPj2Btn7Tff_I9S_oPNA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Netlify’s 404 Page</figcaption></figure><p id="c300" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您刚刚将第一个<a class="ae ki" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank"> Create React应用</a>部署到Netlify。<code class="fe la lb lc ld b">Site is live</code>显示在滚动部署日志中。成功🎉</p><p id="f66c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你愉快地访问你的新网站，点击相关链接。好样的，<a class="ae ki" href="https://www.npmjs.com/package/react-router" rel="noopener ugc nofollow" target="_blank">反应过来的路由器</a>已经投入了工作。一切看起来都很棒。</p><p id="611b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你在地址栏中输入一个路径，你知道它是由React路由器处理的……然后得到“找不到页面”的提示。啊？</p><p id="e78f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">确信你一定做错了什么，你在你的本地开发环境中启动你的应用程序并试图复制这个错误。但是路由在本地非常好。它甚至适用于生产版本:<code class="fe la lb lc ld b">npm run build</code>和<code class="fe la lb lc ld b">serve -s build</code>。那么这里的问题是什么呢？</p><h1 id="60f9" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">单页应用程序中的路由</h1><p id="c57a" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">如果你使用<a class="ae ki" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank"> Create React App </a> (CRA)和<a class="ae ki" href="https://www.npmjs.com/package/react-router" rel="noopener ugc nofollow" target="_blank"> React Router </a>，你的站点很可能是一个单页面应用(SPA)。</p><p id="0219" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">与传统的多页面应用程序相反，spa只维护一个HTML文件，通常是<code class="fe la lb lc ld b">index.html</code>。spa依赖于客户端路由，而不是为每个路径提供不同的HTML文件。React Router是一个受欢迎的客户端路由库，每周下载量接近300万次。</p><p id="b79f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用最简单的话来说，React路由器将路径连接到一个组件。当找到路径时，React Router会将相关的元素插入DOM树中，而不需要刷新页面。</p><p id="cfcc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，为了使这个过程工作，HTTP GET请求必须只从<code class="fe la lb lc ld b">index.html</code>中检索数据——所有的React路由器逻辑都在这里处理。这意味着服务器必须将所有请求发送到<code class="fe la lb lc ld b">index.html</code>。</p><p id="9b66" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那么，为什么这在当地行得通呢？这就是Webpack的用武之地。</p><h1 id="45a6" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">网络包</h1><p id="a99b" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">有没有想过当你穿着CRA跑<code class="fe la lb lc ld b">npm start</code>时会发生什么？</p><p id="eb7f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe la lb lc ld b">npm start</code>在引擎盖下运行<code class="fe la lb lc ld b">react-scripts start</code>(在你的<code class="fe la lb lc ld b">package.json</code>里检查一下)。如果我们偷看<code class="fe la lb lc ld b">/node_modules</code>下的<code class="fe la lb lc ld b">react-scripts</code>文件夹，我们会看到CRA使用<a class="ae ki" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>来捆绑和服务你的应用。</p><p id="06bd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您的应用程序的所有Webpack“设置”都保存在<code class="fe la lb lc ld b">/react-scripts/config</code>下的<code class="fe la lb lc ld b">webpackDevServer.config.js</code>和<code class="fe la lb lc ld b">webpack.config.js</code>中。</p><p id="e06f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于应用程序的开发版本，Webpack将<a class="ae ki" href="https://webpack.js.org/configuration/dev-server/#devserverhistoryapifallback" rel="noopener ugc nofollow" target="_blank">历史API回退选项</a>设置为true。在<code class="fe la lb lc ld b">webpackDevServer.config.js</code>中，Webpack被指示将所有请求重定向到<code class="fe la lb lc ld b">paths.publicUrlOrPath</code>，它是服务于<code class="fe la lb lc ld b">index.html</code>的基本URL<code class="fe la lb lc ld b"><a class="ae ki" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>/</code>:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/d4396979bd22ee7127292db4e316b1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*O4aSF0dvgT5eOCSbCZaW2Q.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk"><em class="mi">Examining </em><code class="fe la lb lc ld b">webpackDevServer.config.js</code></figcaption></figure><p id="02c6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于当你<code class="fe la lb lc ld b">npm run build</code>和<code class="fe la lb lc ld b">serve -s build</code>时提供的产品版本，我们转向<code class="fe la lb lc ld b">webpack.config.js</code>。这里，我们将<a class="ae ki" href="https://developers.google.com/web/tools/workbox/reference-docs/latest/module-workbox-webpack-plugin.GenerateSW" rel="noopener ugc nofollow" target="_blank">导航回退选项</a>设置为<code class="fe la lb lc ld b">paths.publicUrlOrPath + 'index.html'</code>:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/26d8366425e41f9c354442ecf346dedb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*LtOYcrdTX4B1f5l2RgjbdA.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk"><em class="mi">Examining webpack.config.js</em></figcaption></figure><p id="e667" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">瞧啊。同样，Webpack将所有流量导向<code class="fe la lb lc ld b">index.html</code>。</p><p id="0089" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">太好了，这解释了为什么它在您的本地环境中都很好，但是在Netlify上呢？</p><h1 id="381c" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">网络生活</h1><p id="48ba" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">让我们回到您在本地机器上的生产构建。当您运行<code class="fe la lb lc ld b">npm run build</code>时，Webpack将所有组织好的代码打包并缩小到根目录下的<code class="fe la lb lc ld b">build</code>文件夹中。这个文件夹的内容正是Webpack在本地作为产品版本使用的内容，也是Netlify在互联网上提供的内容。</p><p id="436a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是你有没有试过用Python的<a class="ae ki" href="https://docs.python.org/3.0/library/http.server.html" rel="noopener ugc nofollow" target="_blank"> http.server </a>来服务你的应用呢？它需要一个<code class="fe la lb lc ld b">index.html</code>文件，因此我们可以在您的prod <code class="fe la lb lc ld b">build</code>文件夹中运行它:</p><pre class="kl km kn ko gt mk ld ml mm aw mn bi"><span id="8961" class="mo lf in ld b gy mp mq l mr ms">$ cd /build<br/>$ python3 -m http.server</span></pre><p id="aed4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">前往<code class="fe la lb lc ld b"><a class="ae ki" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/</a></code>。输入您在React路由器中指定的路径，或单击相对链接并点击刷新。您应该感觉似曾相识，并看到以下404错误消息:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c2cc480fd1f48c06ebb8c3de56f8ab4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*O7lWHWWlnF3Ce3-B9TtOOA.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Another 404 page 😞</figcaption></figure><p id="b29f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这正是Netlify上发生的事情。</p><p id="ff69" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Netlify的服务器和Python的http.server不处理到<code class="fe la lb lc ld b">index.html</code>的重定向。尽管Netlify提供Webpack捆绑的服务，但它并不使用Webpack来实际提供页面服务。</p><p id="b026" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你不手动输入地址或刷新页面，一切都很完美。这是因为您没有对这两个操作提出新的请求。你没有离开<code class="fe la lb lc ld b">index.html</code>，而React路由器正在正确地工作。然而，当你刷新或输入一个网址时，网站就崩溃了。</p><p id="67f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对此你能做些什么？</p><h2 id="1adb" class="mo lf in bd lg mu mv dn lk mw mx dp lo jv my mz ls jz na nb lw kd nc nd ma ne bi translated">解决方案</h2><p id="6018" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">幸运的是，你可以使用Netlify的<a class="ae ki" href="https://docs.netlify.com/routing/redirects/" rel="noopener ugc nofollow" target="_blank">重定向选项</a>。为了实现这一点，Netlify需要在根目录中有一个名为<code class="fe la lb lc ld b">_redirects</code>的文件。这条航线是奇迹发生的地方:</p><pre class="kl km kn ko gt mk ld ml mm aw mn bi"><span id="bcf8" class="mo lf in ld b gy mp mq l mr ms">/* /index.html 200</span></pre><p id="a773" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该规则指定所有路径(<code class="fe la lb lc ld b">/*</code>)重定向到<code class="fe la lb lc ld b">/index.html</code> <a class="ae ki" href="https://docs.netlify.com/routing/redirects/redirect-options/" rel="noopener ugc nofollow" target="_blank">而不改变浏览器地址栏</a> ( <code class="fe la lb lc ld b">200</code>)中的URL。</p><p id="4f2b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以<strong class="jm io">或者</strong></p><ul class=""><li id="603b" class="nf ng in jm b jn jo jr js jv nh jz ni kd nj kh nk nl nm nn bi translated">把这个<code class="fe la lb lc ld b">_redirects</code>文件和上面的一行放到你app的<code class="fe la lb lc ld b">public</code>文件夹里。该文件夹中的所有内容都原封不动地放入<code class="fe la lb lc ld b">/build</code>的根目录中。</li></ul><p id="a68b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">或</strong></p><ul class=""><li id="1617" class="nf ng in jm b jn jo jr js jv nh jz ni kd nj kh nk nl nm nn bi translated">将<code class="fe la lb lc ld b">&amp;&amp; echo ‘/* /index.html 200’ | cat &gt;build/_redirects</code>添加到<code class="fe la lb lc ld b">package.json</code>中的<code class="fe la lb lc ld b">build</code>脚本中。如果您检查部署日志，Netlify会在每次部署之前运行<code class="fe la lb lc ld b">npm build</code>。这样，Netlify每次都会在根目录中手动创建<code class="fe la lb lc ld b">_redirects</code>文件。</li></ul><p id="c83a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过添加<code class="fe la lb lc ld b">_redirects</code>文件，我们复制了Webpack在本地机器上的功能。</p><h1 id="4ea3" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="cfc8" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">您刚刚成功修复了可怕的404 Netlify错误！在此过程中，我们了解了React路由器如何为spa、Webpack配置和Netlify重定向规则工作。</p><p id="a21c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于这是一个<a class="ae ki" href="https://stackoverflow.com/search?q=react+router+404" rel="noopener ugc nofollow" target="_blank">常见的</a>问题，我通过谷歌搜索很容易就找到了解决办法。这毕竟是一行程序。然而，我找不到一个可靠的解释来解释<em class="kj">为什么</em>会成功。希望这篇文章能填补这个空白。</p><p id="f64a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Netlify不是一个人！正如我们在上面看到的，Python的http.server是另一个罪魁祸首。任何静态托管的SPA都会出现这种偷偷摸摸的错误。作为重定向的替代，<a class="ae ki" href="https://itnext.io/why-using-hash-based-urls-in-your-react-spa-will-save-you-more-time-than-you-think-a21e2c560879" rel="noopener ugc nofollow" target="_blank">散列路由</a>也允许SPA客户端路由。如果你有兴趣，一定要去看看。</p><h2 id="5ea2" class="mo lf in bd lg mu mv dn lk mw mx dp lo jv my mz ls jz na nb lw kd nc nd ma ne bi translated">进一步阅读</h2><ul class=""><li id="8ed1" class="nf ng in jm b jn mc jr md jv no jz np kd nq kh nk nl nm nn bi translated"><a class="ae ki" href="https://github.com/rafrex/spa-github-pages" rel="noopener ugc nofollow" target="_blank">GitHub页面解决方案</a></li><li id="450d" class="nf ng in jm b jn nr jr ns jv nt jz nu kd nv kh nk nl nm nn bi translated"><a class="ae ki" href="https://hackernoon.com/deploying-any-react-app-to-heroku-1ee6db9b97d3" rel="noopener ugc nofollow" target="_blank">Heroku解决方案</a></li><li id="4ed8" class="nf ng in jm b jn nr jr ns jv nt jz nu kd nv kh nk nl nm nn bi translated"><a class="ae ki" href="https://www.sej-ko.dk/2017/03/29/routing-single-page-application-on-apache-with-htaccess/" rel="noopener ugc nofollow" target="_blank">Apache解决方案</a></li><li id="da98" class="nf ng in jm b jn nr jr ns jv nt jz nu kd nv kh nk nl nm nn bi translated"><a class="ae ki" href="https://itnext.io/why-using-hash-based-urls-in-your-react-spa-will-save-you-more-time-than-you-think-a21e2c560879" rel="noopener ugc nofollow" target="_blank">采用哈希路由的解决方案</a></li></ul><p id="1d67" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">感谢阅读。编码快乐！</p></div></div>    
</body>
</html>