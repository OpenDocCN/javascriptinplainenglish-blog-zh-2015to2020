<html>
<head>
<title>Adding Actions to a Vuex Store</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向Vuex商店添加操作</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-actions-to-a-vuex-store-9d534fb3cac5?source=collection_archive---------5-----------------------#2020-05-01">https://javascript.plainenglish.io/adding-actions-to-a-vuex-store-9d534fb3cac5?source=collection_archive---------5-----------------------#2020-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ceb28b32f6880ef2183eeecd1711af50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E4m_JefCgFvAKOJe"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@robertbye?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Robert Bye</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="07cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Vue.js是一个易于使用的web应用框架，我们可以用它来开发交互式前端应用。</p><p id="2cb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">借助Vuex，我们可以将Vue应用的状态存储在一个中心位置。</p><p id="d194" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何向我们的Vuex商店添加动作来改变商店的状态。</p><h1 id="eb45" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是行动？</h1><p id="892a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">动作类似于突变，但是它们提交突变而不是突变状态。与突变不同，动作也可以提交异步操作。</p><p id="3fb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以添加如下简单操作:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="63a5" class="mn lc iq mj b gy mo mp l mq mr">const store = new Vuex.Store({<br/>  state: {<br/>    count: 0<br/>  },<br/>  mutations: {<br/>    increase(state) {<br/>      state.count++;<br/>    }<br/>  },<br/>  actions: {<br/>    increase(context) {<br/>      context.commit("increase");<br/>    }<br/>  }<br/>});</span></pre><p id="6d03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个动作接受一个<code class="fe ms mt mu mj b">context</code>对象，我们可以用它来调用<code class="fe ms mt mu mj b">commit</code>来提交一个变异。</p><h1 id="a3c3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">调度操作</h1><p id="fec6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过呼叫<code class="fe ms mt mu mj b">store.dispatch('increase')</code>来调度行动。</p><p id="e523" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这比直接提交突变有用得多，因为我们可以用它来运行异步操作。</p><p id="98ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以在Vue app中调度一个操作，如下所示:</p><p id="e216" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.js</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5c8a" class="mn lc iq mj b gy mo mp l mq mr">const store = new Vuex.Store({<br/>  state: {<br/>    count: 0<br/>  },<br/>  mutations: {<br/>    increase(state, payload) {<br/>      state.count += payload.amount;<br/>    }<br/>  },<br/>  actions: {<br/>    increaseAsync({ commit }, payload) {<br/>      setTimeout(() =&gt; {<br/>        commit("increase", payload);<br/>      }, 1000);<br/>    }<br/>  }<br/>});</span><span id="1a8a" class="mn lc iq mj b gy mv mp l mq mr">new Vue({<br/>  el: "#app",<br/>  store,<br/>  methods: {<br/>    ...Vuex.mapActions(["increaseAsync"])<br/>  },<br/>  computed: {<br/>    ...Vuex.mapState(["count"])<br/>  }<br/>});</span></pre><p id="283e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.html</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2aed" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;script src="<a class="ae kc" href="https://unpkg.com/vue/dist/vue.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/vue/dist/vue.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script src="<a class="ae kc" href="https://unpkg.com/vuex" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/vuex</a>"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;button <a class="ae kc" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="increaseAsync({amount: 10})"&gt;Increase&lt;/button&gt;<br/>      &lt;p&gt;{{count}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script src="index.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="2f74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们用下面的代码实现了动作<code class="fe ms mt mu mj b">increaseAsync</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a440" class="mn lc iq mj b gy mo mp l mq mr">increaseAsync({ commit }, payload) {<br/>  setTimeout(() =&gt; {<br/>    commit("increase", payload);<br/>  }, 1000);<br/>}</span></pre><p id="61df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在action方法中，我们用一个<code class="fe ms mt mu mj b">payload</code>对象来提交<code class="fe ms mt mu mj b">increase</code>变异，当我们调度action时会传递这个对象。</p><p id="83d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Vue实例中，我们有:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2f1a" class="mn lc iq mj b gy mo mp l mq mr">methods: {<br/>    ...Vuex.mapActions(["increaseAsync"])<br/>},<br/>computed: {<br/>  ...Vuex.mapState(["count"])<br/>}</span></pre><p id="c92f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它通过调用<code class="fe ms mt mu mj b">mapActions</code>来映射存储中的动作，并通过使用<code class="fe ms mt mu mj b">mapState</code>从存储中映射它们来添加计算属性，因此我们得到了一个<code class="fe ms mt mu mj b">count</code>属性，它是从<code class="fe ms mt mu mj b">state.count</code>作为计算属性计算出来的。</p><p id="ed67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在模板中，当我们按下增加按钮1秒后更新<code class="fe ms mt mu mj b">state.count</code>时，我们调用<code class="fe ms mt mu mj b">increaseAsync</code>。</p><p id="49b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们应该看到数字更新了，因为我们从商店映射了状态。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/ab8d004eefc869187fe49eb81e33f694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eyN801UOqQIjqDF5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@danielmonteirox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniel Monteiro</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="684e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">撰写动作</h1><p id="3f25" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以将回报承诺的行动串连起来。</p><p id="569a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以创建一个操作来更新2个计数，如下所示:</p><p id="0b33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.js</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f360" class="mn lc iq mj b gy mo mp l mq mr">const store = new Vuex.Store({<br/>  state: {<br/>    count1: 0,<br/>    count2: 0<br/>  },<br/>  mutations: {<br/>    increase(state, payload) {<br/>      state.count1 += payload.amount;<br/>    },<br/>    decrease(state, payload) {<br/>      state.count2 -= payload.amount;<br/>    }<br/>  },<br/>  actions: {<br/>    async increaseAsync({ commit }, payload) {<br/>      return Promise.resolve(commit("increase", payload));<br/>    },<br/>    async decreaseAsync({ commit }, payload) {<br/>      return Promise.resolve(commit("decrease", payload));<br/>    },<br/>    async updateCounts({ dispatch }, payload) {<br/>      await dispatch("increaseAsync", payload);<br/>      await dispatch("decreaseAsync", payload);<br/>    }<br/>  }<br/>});</span><span id="33f7" class="mn lc iq mj b gy mv mp l mq mr">new Vue({<br/>  el: "#app",<br/>  store,<br/>  methods: {<br/>    ...Vuex.mapActions(["updateCounts"])<br/>  },<br/>  computed: {<br/>    ...Vuex.mapState(["count1", "count2"])<br/>  }<br/>});</span></pre><p id="bf10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.html</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="63db" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;App&lt;/title&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;script src="<a class="ae kc" href="https://unpkg.com/vue/dist/vue.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/vue/dist/vue.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script src="<a class="ae kc" href="https://unpkg.com/vuex" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/vuex</a>"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;<br/>      &lt;button <a class="ae kc" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="updateCounts({amount: 10})"&gt;Update Counts&lt;/button&gt;<br/>      &lt;p&gt;Count 1: {{count1}}&lt;/p&gt;<br/>      &lt;p&gt;Count 2: {{count2}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script src="index.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="62f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们用<code class="fe ms mt mu mj b">increaseAsync</code>动作和<code class="fe ms mt mu mj b">payload</code>让<code class="fe ms mt mu mj b">updateCounts</code>动作开关调用<code class="fe ms mt mu mj b">dispatch</code>。然后用<code class="fe ms mt mu mj b">decreaseAsync</code>动作和<code class="fe ms mt mu mj b">payload</code>调用<code class="fe ms mt mu mj b">dispatch</code>。</p><p id="0389" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">increaseAsync</code>提交<code class="fe ms mt mu mj b">increase</code>突变，<code class="fe ms mt mu mj b">decreaseAsync</code>提交<code class="fe ms mt mu mj b">decrease</code>突变。</p><p id="3ac4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于都有<code class="fe ms mt mu mj b">Promise.resolve</code>，所以都是异步的。</p><p id="ceca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe ms mt mu mj b">mapActions</code>将商店的<code class="fe ms mt mu mj b">updateCounts</code>动作包含在我们的Vue实例中。我们还包括了<code class="fe ms mt mu mj b">count1</code>和<code class="fe ms mt mu mj b">mapState</code>的<code class="fe ms mt mu mj b">count2</code>州。</p><p id="cb6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们点击更新计数按钮时，我们调用<code class="fe ms mt mu mj b">updateCounts</code>，然后<code class="fe ms mt mu mj b">count1</code>和<code class="fe ms mt mu mj b">count2</code>随着我们点击按钮而更新。<code class="fe ms mt mu mj b">count1</code>每点击一次应增加10，而<code class="fe ms mt mu mj b">count2</code>每点击一次应减少10。</p><h1 id="251a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2f35" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用动作来提交一个或多个突变或分派其他动作。</p><p id="c8f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为突变总是同步的，所以将存储操作组合在一起并运行异步代码很方便。</p><p id="40ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe ms mt mu mj b">mapActions</code>将它们包含在我们的组件中。</p><p id="acb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过调用<code class="fe ms mt mu mj b">dispatch</code>来分派动作，而通过<code class="fe ms mt mu mj b">commit</code>方法来提交变异。</p><h2 id="2335" class="mn lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><strong class="ak">用简单英语写的JavaScript笔记</strong></h2><p id="6500" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们已经推出了三种新的出版物！请关注我们的新出版物:<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>——谢谢，继续学习！</p><p id="c0ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也一直有兴趣帮助推广高质量的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>，并附上您的Medium用户名，我们会将您添加为作者。另外，请让我们知道您想加入哪个/哪些出版物。</p></div></div>    
</body>
</html>