<html>
<head>
<title>Understanding Service Providers in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从角度理解服务提供商</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/understanding-service-providers-in-angular-6f1ec72b7535?source=collection_archive---------2-----------------------#2020-11-16">https://javascript.plainenglish.io/understanding-service-providers-in-angular-6f1ec72b7535?source=collection_archive---------2-----------------------#2020-11-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5fa1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">看看在Angular中提供服务的不同方式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/81b99671680c9ea633b15ca45c5c5edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uhBI5raxJbJvxTBx"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@introspectivedsgn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Erik Mclean</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8de5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本指南中，我们将了解在Angular应用程序中提供服务的不同方式。您选择提供服务的方法将决定您的服务的范围和对其依赖者的可见性。</p><p id="7832" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Angular中，服务可以是您的应用程序需要的简单值、函数或特性。然而，在大多数情况下，Angular中的服务是执行某些特定功能的类。</p><p id="6247" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了能够通过依赖注入使用服务，您必须至少向一个提供者注册它。</p><p id="9fcd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Angular中，有三种主要的方法可以让您的服务对其依赖者可用。</p><h1 id="b4eb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在Angular中创建服务</h1><p id="3525" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要在Angular项目中创建服务，可以运行以下CLI命令。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="4434" class="mu lt iq mq b gy mv mw l mx my">ng generate service car-list </span></pre><p id="e0a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中<strong class="ky ir"> <em class="mz"> car-list </em> </strong>是我们想要用上面的命令创建的服务的名称。</p><p id="2d64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的命令创建的典型服务如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d47e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们已经创建了一个服务，让我们看看如何使它对其依赖者可用。</p><h1 id="55db" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">通过根注入器提供服务</h1><p id="a28e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">默认情况下，当您通过CLI创建一个Angular服务时，正如我们在上面所做的，它会注册到根注入器。</p><p id="7b99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的服务中，通过指定<code class="fe nc nd ne mq b">providedIn:'root'</code>。我们告诉Angular在根级别提供服务。</p><p id="d716" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是通过根注入器注册的服务的一些重要特征。</p><ul class=""><li id="22b0" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">它们可用于任何通过依赖注入请求服务的类。</li><li id="899d" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">Angular为整个应用程序创建一个共享的服务实例(singleton)。</li><li id="43f8" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">此外，当服务没有被任何其他类请求时，会进行一些树抖动。</li></ul><p id="d1e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意</strong>:要在一个组件中使用一个服务，只需简单地导入它，然后将它注入到构造函数中，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="a1fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，如果您想在应用程序中限制服务的范围，该怎么做呢？在下面的小节中，我将讨论如何在模块或组件级别提供服务。</p><h1 id="2059" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">提供模块级别的服务</h1><p id="680a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">提供服务的另一种方法是只在模块级别提供服务。这意味着除非您指定，否则该服务对应用程序的其他模块不可用。</p><p id="fc67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，让我们在上面创建的car-list服务只在应用程序的CarModule中可用。首先，导入我们希望使服务在其中可用的模块。然后在服务元数据中，我们将提供如下的模块名称。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9956" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了使服务在模块中可用，然后在<code class="fe nc nd ne mq b"><em class="mz">@NgModule</em></code>元数据的<code class="fe nc nd ne mq b"><em class="mz">providers</em></code>数组中注册服务，如下所示。另外，一定要记住导入您想要在模块中注册的服务。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9e60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">惰性加载是Angular中的一个流行概念。使用延迟加载，你只在需要的时候加载一个模块，而不是在应用程序启动的时候。</p><p id="8a4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从Angular version 9开始，您可以通过为每个延迟加载的模块提供一个新的as服务实例来充分利用延迟加载。要实现这一点，您可以使用带有<code class="fe nc nd ne mq b"><em class="mz">providedIn</em></code>属性的<code class="fe nc nd ne mq b"><em class="mz">any</em></code>关键字，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="21b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你使用<code class="fe nc nd ne mq b">providedIn: 'any'</code>提供服务时，所有急切加载的模块共享一个单例实例；然而，惰性加载模块每个都有一个唯一的服务实例。</p><h1 id="4c69" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">提供组件级别的服务</h1><p id="b248" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您还可以将服务的范围限制为某个特定的组件。</p><p id="06ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Angular为创建的每个组件实例创建一个新的服务实例。</p><p id="a348" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在组件中注册的服务仅对组件及其子代可用。</p><p id="9a8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要将服务的范围仅限于其组件，您应该向组件的提供者数组注册它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="875a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="320f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">大多数情况下，您会希望向根提供者注册您的服务，以使服务在整个应用程序中可用。</p><p id="a277" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要限制角度服务的范围，可以考虑在模块或组件级别注册服务。</p></div></div>    
</body>
</html>