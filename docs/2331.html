<html>
<head>
<title>Automated Testing with Node.js for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向初学者的Node.js自动化测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/automated-testing-with-node-js-for-beginners-2e1fecd1ac68?source=collection_archive---------6-----------------------#2020-06-13">https://javascript.plainenglish.io/automated-testing-with-node-js-for-beginners-2e1fecd1ac68?source=collection_archive---------6-----------------------#2020-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a6ae45349e2b6d2a4f0d458935ed95a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wXR3F3VWzAKzL9c6FMqVbQ.png"/></div></div></figure><h1 id="de9b" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">为什么要测试？</h1><p id="59b0" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">测试代码是web开发的一个重要阶段。它防止您的代码运行出错，并确保它可以跨所有设备和浏览器工作。但是测试你的代码可能会很耗时和复杂，尤其是如果你是一个初学者。</p><p id="8e42" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">一些常见的测试如<strong class="ky ir">林挺</strong>和<strong class="ky ir">缩小</strong>可以自动化，帮助你比以往更容易地修复代码中的常见bug和标记错误。这有助于在执行测试时节省大量时间！</p><blockquote class="lz ma mb"><p id="3cd6" class="kw kx mc ky b kz lu lb lc ld lv lf lg md lw lj lk me lx ln lo mf ly lr ls lt ij bi translated"><strong class="ky ir"> <em class="iq">林挺:</em> </strong> <em class="iq">运行程序的过程，分析代码中潜在的错误。—维基百科</em></p><p id="12e1" class="kw kx mc ky b kz lu lb lc ld lv lf lg md lw lj lk me lx ln lo mf ly lr ls lt ij bi translated"><strong class="ky ir"> <em class="iq">缩小:</em> </strong> <em class="iq">从解释编程语言或标记语言的源代码中去掉所有不必要的字符而不改变其功能的过程。—维基百科</em></p></blockquote><p id="2333" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在本教程中，我将向您展示如何使用Node.js和npm设置一个任务运行器来自动化3个过程:</p><ol class=""><li id="4bb7" class="mg mh iq ky b kz lu ld lv lh mi ll mj lp mk lt ml mm mn mo bi translated">HTML林挺和缩小:修复错误和不良格式</li><li id="ed8f" class="mg mh iq ky b kz mp ld mq lh mr ll ms lp mt lt ml mm mn mo bi translated">CSS自动修复和林挺:添加前缀以在旧浏览器中运行并修复错误</li><li id="0cbe" class="mg mh iq ky b kz mp ld mq lh mr ll ms lp mt lt ml mm mn mo bi translated">JavaScript林挺和转换文件:修复错误并转换新的JS代码以在旧浏览器中工作</li></ol><h1 id="9130" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤1:下载Node.js和npm</h1><p id="2172" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在<a class="ae mu" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/download/</a>下载Node.js(带npm)</p><p id="3d83" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">安装后，要检查它是否存在，请转到您的命令提示符:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="4141" class="ne jz iq na b gy nf ng l nh ni">node -v<br/>npm -v</span></pre><h1 id="184f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">第二步:安装Gulp</h1><p id="cd69" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Gulp是一个自动化工具包，我们将使用它来创建我们的测试任务运行器(参见<a class="ae mu" href="https://gulpjs.com/docs/en/getting-started/quick-start" rel="noopener ugc nofollow" target="_blank">文档</a>)。您可以通过npm在命令提示符下运行以下命令行来安装它:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="194b" class="ne jz iq na b gy nf ng l nh ni">npm install --global gulp-cli</span></pre><p id="6f0c" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在初始化npm之后，将在您的项目目录中生成一个<code class="fe nj nk nl na b">package.json</code>。</p><h1 id="a67c" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤3:创建一个项目，导航到它并初始化npm</h1><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="f17e" class="ne jz iq na b gy nf ng l nh ni">mkdir test-project<br/>cd test-project<br/>npm init</span></pre><p id="fc58" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在初始化npm之后，您的项目目录中将会生成一个<strong class="ky ir"> package.json </strong>。</p><h1 id="fb28" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤4:将Gulp设置为依赖项</h1><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="c1d8" class="ne jz iq na b gy nf ng l nh ni">npm install --save-dev gulp</span></pre><p id="b212" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在，您应该可以在<code class="fe nj nk nl na b">devDependencies</code>属性下的<strong class="ky ir"> package.json </strong>中看到gulp。</p><h1 id="b8bc" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤5:创建gulpfile.js</h1><p id="e777" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在您的项目目录中，创建一个<strong class="ky ir"> gulpfile.js </strong>文件，我们将在其中写入我们的任务运行器，并添加以下内容作为第一行:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7596" class="ne jz iq na b gy nf ng l nh ni">const gulp = require('gulp');</span></pre><p id="c4e9" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在，让我们创建3个自动化测试任务，从html、css开始，然后是JavaScript。</p><h1 id="ccec" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤6:创建“html”任务</h1><p id="c7bf" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们从用<code class="fe nj nk nl na b">gulp-htmltidy</code>创建html任务开始，它是HTML林挺的一个gulp插件。参见<a class="ae mu" href="https://www.npmjs.com/package/gulp-htmltidy" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="f702" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">首先，我们安装它:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="e094" class="ne jz iq na b gy nf ng l nh ni">npm install --save-dev gulp-htmltidy</span></pre><p id="5611" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">然后，在<strong class="ky ir"> gulpfile.js </strong>中添加依赖关系:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="fca8" class="ne jz iq na b gy nf ng l nh ni">const htmltidy = require('gulp-htmltidy');</span></pre><p id="b4af" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">添加以下测试来检查html文件中的错误:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="b1c9" class="ne jz iq na b gy nf ng l nh ni">gulp.task('html', function() {<br/>  return gulp.src('./*.html') // your html directory<br/>        .pipe(htmltidy())<br/>        .pipe(gulp.dest('build/')); //writes the output, cleanly formatted HTML to the build directory<br/>});</span></pre><p id="af2a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">太好了！我们已经创建了第一个测试来检查HTML中的错误和不良格式。让我们继续创建一个CSS测试。</p><h1 id="f995" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤7:创建“css”任务</h1><p id="3d34" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">通过运行安装<code class="fe nj nk nl na b">gulp-autoprefixer</code> ( <a class="ae mu" href="https://www.npmjs.com/package/gulp-autoprefixer" rel="noopener ugc nofollow" target="_blank">文档</a>)和<code class="fe nj nk nl na b">gulp-csslint</code> ( <a class="ae mu" href="https://www.npmjs.com/package/gulp-csslint" rel="noopener ugc nofollow" target="_blank">文档</a>):</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="2019" class="ne jz iq na b gy nf ng l nh ni">npm install --save-dev gulp-autoprefixer<br/>npm install --save-dev gulp-csslint</span></pre><p id="b431" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">然后，就像htmltidy一样，我们在<strong class="ky ir"> gulpfile.js </strong>的顶部添加依赖项:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="de0e" class="ne jz iq na b gy nf ng l nh ni">const autoprefixer = require('gulp-autoprefixer'); <br/>const csslint = require('gulp-csslint');</span></pre><p id="d1e3" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">最后，我们在html任务下面添加css任务，如下所示:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="199f" class="ne jz iq na b gy nf ng l nh ni">gulp.task('css', function() {<br/>    return gulp.src('./*.css') //your css directory<br/>        .pipe(csslint())<br/>        .pipe(csslint.formatter())<br/>        .pipe(autoprefixer({<br/>            browsers: ['last 5 versions'],  //config to add prefixes to work on older browsers<br/>            cascade: false<br/>        }))<br/>        .pipe(gulp.dest('./build'));<br/>});</span></pre><p id="cf3f" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在，我们已经准备好css测试任务了！让我们为我们的JavaScript代码做最后一个。</p><h1 id="fd4e" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤8:创建任务</h1><p id="9c05" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">对于JavaScript测试，我们将通过运行以下命令来安装<code class="fe nj nk nl na b">gulp-jshint</code> ( <a class="ae mu" href="https://www.npmjs.com/package/gulp-jshint" rel="noopener ugc nofollow" target="_blank">文档</a>)和<code class="fe nj nk nl na b">gulp-babel</code> ( <a class="ae mu" href="https://www.npmjs.com/package/gulp-babel" rel="noopener ugc nofollow" target="_blank">文档</a>):</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7b3a" class="ne jz iq na b gy nf ng l nh ni">npm install --save-dev gulp-babel @babel/preset-env<br/>npm install --save-dev @babel/core<br/>npm install --save-dev jshint gulp-jshint</span></pre><p id="e862" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">然后，最后一次添加依赖项:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="ba2b" class="ne jz iq na b gy nf ng l nh ni">const babel = require('gulp-babel');<br/>const jshint = require('gulp-jshint');</span></pre><p id="e4a7" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">以及<strong class="ky ir"> gulpfile.js </strong>底部的任务:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="a6d7" class="ne jz iq na b gy nf ng l nh ni">gulp.task('js', function() {<br/>    return gulp.src('./*.js')  //directory of your .js file<br/>        .pipe(jshint())<br/>        .pipe(jshint.reporter('default'))<br/>        .pipe(babel({<br/>            presets: ['@babel/env']<br/>        }))<br/>        .pipe(gulp.dest('./build'));<br/>});</span></pre><p id="709a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">好了，我们已经写好了3个任务！我们已经使用gulp完成了测试设置！Babel会将我们的代码转换成旧的语法，以便在旧的浏览器上运行，而<code class="fe nj nk nl na b">gulp-jshint</code>会检查我们代码中的错误。</p><h1 id="2c4a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">第九步:最终任务</h1><p id="e10d" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">最后，在<strong class="ky ir"> gulpfile.js </strong>的底部，加上:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="9b5d" class="ne jz iq na b gy nf ng l nh ni">gulp.task('default', gulp.series('html', 'css', 'js'));</span></pre><p id="67a3" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这样我们可以同时进行三项测试。</p><p id="6218" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">你最终的<strong class="ky ir"> gulpfile.js </strong>应该是这样的:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="397d" class="ne jz iq na b gy nf ng l nh ni">const gulp = require('gulp');<br/>const htmltidy = require('gulp-htmltidy');<br/>const autoprefixer = require('gulp-autoprefixer');<br/>const csslint = require('gulp-csslint');<br/>const babel = require('gulp-babel');<br/>const jshint = require('gulp-jshint');<br/><br/>gulp.task('html', function() {<br/>    return gulp.src('./*.html') // your html directory<br/>          .pipe(htmltidy())<br/>          .pipe(gulp.dest('build/')); //writes the output, cleanly formatted HTML to the build directory<br/>});<br/><br/>gulp.task('css', function() {<br/>    return gulp.src('./*.css') //your css directory<br/>        .pipe(csslint())<br/>        .pipe(csslint.formatter())<br/>        .pipe(autoprefixer({<br/>            browsers: ['last 5 versions'],  //config to add prefixes to work on older browsers<br/>            cascade: false<br/>        }))<br/>        .pipe(gulp.dest('./build'));<br/>});<br/><br/>gulp.task('js', function() {<br/>    return gulp.src('./*.js')  //directory of your .js file<br/>        .pipe(jshint())<br/>        .pipe(jshint.reporter('default'))<br/>        .pipe(babel({<br/>            presets: ['@babel/env']<br/>        }))<br/>        .pipe(gulp.dest('./build'));<br/>});<br/><br/>gulp.task('default', gulp.series('html', 'css', 'js'));</span></pre><p id="4e40" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">您最终的<strong class="ky ir"> package.json </strong>文件应该类似于:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="ede7" class="ne jz iq na b gy nf ng l nh ni">{<br/>  "name": "test-project",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "main.js",<br/>  "scripts": {<br/>    "test": "test"<br/>  },<br/>  "author": "",<br/>  "license": "ISC",<br/>  "devDependencies": {<br/>    "@babel/core": "^7.10.2",<br/>    "@babel/preset-env": "^7.10.2",<br/>    "gulp": "^4.0.2",<br/>    "gulp-autoprefixer": "^7.0.1",<br/>    "gulp-babel": "^8.0.0",<br/>    "gulp-csslint": "^1.0.1",<br/>    "gulp-htmltidy": "^0.2.4",<br/>    "gulp-jshint": "^2.1.0",<br/>    "jshint": "^2.11.1"<br/>  }<br/>}</span></pre><h1 id="789f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">运行测试</h1><p id="a874" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在尝试运行项目目录中的命令<code class="fe nj nk nl na b">gulp</code>来运行自动化测试！</p><p id="cef9" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">您应该会看到类似这样的内容:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/b42d76406a559b0f1e182aa380f1afaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7vxU6D4m434SuACP"/></div></div></figure><p id="b884" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">看起来我有很多错误，这些错误大多与使用新的JavaScript语法有关，这些语法在旧的浏览器上无法工作。如果我查看“build”文件夹，我可以看到我新格式化的HTML、CSS和JS文件，它们是通过运行测试修复的！</p><h1 id="e67d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">后续步骤</h1><p id="f12a" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">恭喜你，你已经学会了如何使用Node.js、npm和gulp设置自动化的html、css和JavaScript测试。测试不仅仅是林挺和缩小你的代码，所以我鼓励你自己多读一些。对于这个特殊的测试，您可以进一步添加</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="115f" class="ne jz iq na b gy nf ng l nh ni">gulp.task('watch', function(){<br/>  gulp.watch('src/*.html', ['html']);<br/>  gulp.watch('src/*.css', ['css']);<br/>  gulp.watch('src/*.js', ['js']);<br/>});</span></pre><p id="063a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">到你的<strong class="ky ir"> gulpfile.js </strong>中，这样每当你保存一个文件时，测试就会运行(更多细节见<a class="ae mu" href="https://gulpjs.com/docs/en/api/watch/" rel="noopener ugc nofollow" target="_blank">文档</a>)。</p><p id="8201" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我希望这对你有所帮助。如果你对本教程有任何疑问，请在下面的评论中告诉我。祝您测试项目好运！干杯！</p><h2 id="d53b" class="ne jz iq bd ka nn no dn ke np nq dp ki lh nr ns km ll nt nu kq lp nv nw ku nx bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="4712" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae mu" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">订阅我们的YouTube频道</strong> </a> <strong class="ky ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>