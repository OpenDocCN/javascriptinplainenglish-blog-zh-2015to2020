<html>
<head>
<title>How to build an Alert Component using Recoil</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用反冲构建警报组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-an-alert-component-using-recoil-eec9cae6ae79?source=collection_archive---------12-----------------------#2020-11-23">https://javascript.plainenglish.io/how-to-build-an-alert-component-using-recoil-eec9cae6ae79?source=collection_archive---------12-----------------------#2020-11-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/82f5dfeaf6b94226d49b6997c53deb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1XvNKCDQH1OfGGt0.png"/></div></div></figure><p id="e7b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">反应状态管理是一个广泛的话题，选择正确的管理工具通常是困难的。众所周知，React缺少状态管理工具，通常由开发人员来解决。然而，多年来，一些伟大的工具已经出现，给开发者一些强大的功能。</p><p id="850c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将使用反冲来构建一个警报组件，但是您可以在您选择的任何状态管理工具中应用相同的原则。</p><p id="b5f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您想直接进入代码，这里是整个项目的回购:</p><div class="kt ku gp gr kv kw"><a href="https://github.com/EntryLevelDeveloperTraining/recoil-alerts" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab fo"><div class="ky ab kz cl cj la"><h2 class="bd io gy z fp lb fr fs lc fu fw im bi translated">entryleveldeveloper training/反冲警报</h2><div class="ld l"><h3 class="bd b gy z fp lb fr fs lc fu fw dk translated">这是一个由create-next-app引导的Next.js项目。首先，运行开发服务器:打开…</h3></div><div class="le l"><p class="bd b dl z fp lb fr fs lc fu fw dk translated">github.com</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk jt kw"/></div></div></a></div><h1 id="f8ff" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置</h1><p id="1a88" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">我将从我创建的一个名为Next.js Tailwind CSS Starter的项目开始这个项目。您可以在这里找到代码repo:</p><div class="kt ku gp gr kv kw"><a href="https://github.com/EntryLevelDeveloperTraining/nextjs-tailwind-css-starter" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab fo"><div class="ky ab kz cl cj la"><h2 class="bd io gy z fp lb fr fs lc fu fw im bi translated">entry veldeveloper training/next js-tail wind-CSS-starter</h2><div class="ld l"><h3 class="bd b gy z fp lb fr fs lc fu fw dk translated">这是一个由create-next-app引导的Next.js项目。首先，运行开发服务器:打开…</h3></div><div class="le l"><p class="bd b dl z fp lb fr fs lc fu fw dk translated">github.com</p></div></div><div class="lf l"><div class="mo l lh li lj lf lk jt kw"/></div></div></a></div><p id="8c4d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我开始使用Next.js和Tailwind CSS来启动我的项目，以便在没有太多配置的情况下轻松完成一些事情。如果你想要一个起点，你可以克隆这个回购。</p><h1 id="286e" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">装置</h1><p id="0eb5" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">现在我已经准备好了我的初学者项目，我现在需要的就是安装反冲。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="c35b" class="my lm in mu b gy mz na l nb nc">npm install recoil </span></pre><h1 id="59f7" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">风格</h1><p id="8116" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">在我们开始创建组件之前，我想用Tailwind CSS设置我的样式。这是我在Tailwind中的组件，我将用来显示信息、错误和警告警报。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="d74f" class="my lm in mu b gy mz na l nb nc">.screen {<br/>  @apply w-screen h-screen flex justify-center items-center bg-blue-200;<br/>}</span><span id="1555" class="my lm in mu b gy nd na l nb nc">.paper {<br/>  @apply bg-white shadow-2xl rounded-lg border p-10;<br/>}</span><span id="01c9" class="my lm in mu b gy nd na l nb nc">.h1 {<br/>  @apply text-center pb-5 text-xl;<br/>}</span><span id="4c3a" class="my lm in mu b gy nd na l nb nc">.alert-info {<br/>  @apply bg-green-200 border-green-600 text-green-800;<br/>}</span><span id="aced" class="my lm in mu b gy nd na l nb nc">.alert-error {<br/>  @apply bg-red-200 border-red-600 text-red-800;<br/>}</span><span id="7dc3" class="my lm in mu b gy nd na l nb nc">.alert-warning {<br/>  @apply bg-yellow-200 border-yellow-600 text-yellow-800;<br/>}</span><span id="660b" class="my lm in mu b gy nd na l nb nc">.btn-info {<br/>  @apply bg-green-200 hover:bg-green-100 p-5 rounded text-black focus:outline-none;<br/>}</span><span id="8143" class="my lm in mu b gy nd na l nb nc">.btn-error {<br/>  @apply bg-red-200 hover:bg-red-100 p-5 rounded text-black focus:outline-none;<br/>}</span><span id="4fbe" class="my lm in mu b gy nd na l nb nc">.btn-warning {<br/>  @apply bg-yellow-200 hover:bg-yellow-100 p-5 rounded text-black focus:outline-none;<br/>}</span></pre><p id="be1a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里没什么太难的。您可以看到我正在为警报定义颜色，如下所示:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="ceca" class="my lm in mu b gy mz na l nb nc">bg-red-200 border-red-600 text-red-800;</span></pre><p id="3d4f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当背景是柔和的颜色时，边框的饱和度更高，而文本的饱和度最高。</p><h1 id="88f8" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">回复状态</h1><p id="39ca" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">现在，让我们创建反冲状态，该状态将保存显示警报所需的文本、警报类型以及在经过一定时间后关闭警报的超时。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="8dfa" class="my lm in mu b gy mz na l nb nc">import { atom, RecoilState } from 'recoil';</span><span id="17ae" class="my lm in mu b gy nd na l nb nc">export interface AlertState {<br/>  open: boolean;<br/>  primary: string;<br/>  secondary: string;<br/>  type: string;<br/>  timeout: number;<br/>}</span><span id="fdfb" class="my lm in mu b gy nd na l nb nc">export const alertState: RecoilState&lt;AlertState&gt; = atom({<br/>  key: 'alertState',<br/>  default: {<br/>    open: false,<br/>    primary: '',<br/>    secondary: '',<br/>    type: 'info',<br/>    timeout: 5000,<br/>  },<br/>});</span></pre><p id="b13c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我还使用类型脚本来定义我将在反冲原子中保存的信息。</p><p id="1553" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">反冲原子是反冲中的基本类型，可以用来存储任何类型的状态。</p><p id="4c1d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它保持了原生React Hooks提供的相同流程，因此很容易实现到React项目流中。</p><p id="280c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我给了它<code class="fe ne nf ng mu b">alertState</code>的键，以确定我将把它用于我的警报组件。</p><h1 id="5212" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">警报组件</h1><p id="8111" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">现在我们来谈谈警报组件。我需要把它分成两部分。第一个组件将是显示警报的实际组件，第二个组件将是知道何时显示不同类型的警报的容器。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="3032" class="my lm in mu b gy mz na l nb nc">interface AlertProps {<br/>  type?: string;<br/>  icon?: React.ReactNode;<br/>  primary: string;<br/>  secondary?: string;<br/>  onClose?: Function;<br/>}</span><span id="9489" class="my lm in mu b gy nd na l nb nc">function Alert(props: AlertProps) {<br/>  const { type, icon, primary, secondary, onClose } = props;<br/>  return (<br/>    &lt;div<br/>      className={`relative border-t-4 rounded-b px-4 py-3 shadow-md my-2 alert-${type}`}<br/>      role="alert"<br/>    &gt;<br/>      &lt;div className="absolute top-0 right-0 p-2"&gt;<br/>        &lt;div className="cursor-pointer" title="Close" onClick={() =&gt; onClose()}&gt;<br/>          &lt;CloseIcon /&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="flex items-center"&gt;<br/>        &lt;div className="p-2 pr-4"&gt;{icon}&lt;/div&gt;<br/>        &lt;div&gt;<br/>          &lt;p className="font-bold"&gt;{primary}&lt;/p&gt;<br/>          &lt;p className="text-sm"&gt;{secondary}&lt;/p&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="56f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第一个组件将负责显示一个图标，显示主要和次要文本，以及一个关闭按钮。它也将参考我在上面设置的Tailwind CSS样式的组件。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="498a" class="my lm in mu b gy mz na l nb nc">function InfoAlert(props: AlertProps) {<br/>  return &lt;Alert {...props} type="info" icon={&lt;InfoIcon /&gt;} /&gt;;<br/>}</span><span id="a7e1" class="my lm in mu b gy nd na l nb nc">function ErrorAlert(props: AlertProps) {<br/>  return &lt;Alert {...props} type="error" icon={&lt;ErrorIcon /&gt;} /&gt;;<br/>}</span><span id="d908" class="my lm in mu b gy nd na l nb nc">function WarningAlert(props: AlertProps) {<br/>  return &lt;Alert {...props} type="warning" icon={&lt;WarningIcon /&gt;} /&gt;;<br/>}</span></pre><p id="2011" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我将设置一些帮助器组件，这些组件将引用正确的类型和图标。我需要提到的是，我通过去<a class="ae nh" href="https://heroicons.dev/" rel="noopener ugc nofollow" target="_blank">https://heroicons.dev/</a>创建了图标</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="013b" class="my lm in mu b gy mz na l nb nc">export function useAlert() {<br/>  const [alert, setAlert] = useRecoilState&lt;AlertState&gt;(alertState);<br/>  const showAlert = (props) =&gt; {<br/>    setAlert({<br/>      ...alert,<br/>      ...props,<br/>    });<br/>  };<br/>  useEffect(() =&gt; {<br/>    if (alert?.open &amp;&amp; alert?.timeout) {<br/>      setTimeout(() =&gt; {<br/>        showAlert({<br/>          open: false,<br/>        });<br/>      }, alert?.timeout);<br/>    }<br/>  }, [alert?.open, alert?.timeout]);<br/>  return { alert, showAlert };<br/>}</span></pre><p id="b923" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我还设置了一个钩子，它使用反冲状态和一个助手函数来设置反冲原子的状态。它还使用一个<code class="fe ne nf ng mu b">useEffect</code>来设置超时，每当它打开时，它将设置超时来关闭警报。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="81ff" class="my lm in mu b gy mz na l nb nc">export default function Alerts() {<br/>  const { alert, showAlert } = useAlert();<br/>  const onClose = () =&gt; {<br/>    showAlert({<br/>      open: false,<br/>    });<br/>  };<br/>  <br/>  return (<br/>    &lt;Transition<br/>      show={alert.open}<br/>      enter="transition ease-out duration-500"<br/>      enterFrom="transform opacity-0 scale-95"<br/>      enterTo="transform opacity-100 scale-100"<br/>      leave="transition ease-in duration-500"<br/>      leaveFrom="transform opacity-100 scale-100"<br/>      leaveTo="transform opacity-0 scale-95"<br/>      className="fixed inset-x-0 top-0 w-2/3 md:w-1/3 mx-auto z-50"<br/>    &gt;<br/>      {alert.type === 'info' &amp;&amp; (<br/>        &lt;InfoAlert<br/>          primary={alert.primary}<br/>          secondary={alert.secondary}<br/>          onClose={() =&gt; onClose()}<br/>        /&gt;<br/>      )}<br/>      {alert.type === 'error' &amp;&amp; (<br/>        &lt;ErrorAlert<br/>          primary={alert.primary}<br/>          secondary={alert.secondary}<br/>          onClose={() =&gt; onClose()}<br/>        /&gt;<br/>      )}<br/>      {alert.type === 'warning' &amp;&amp; (<br/>        &lt;WarningAlert<br/>          primary={alert.primary}<br/>          secondary={alert.secondary}<br/>          onClose={() =&gt; onClose()}<br/>        /&gt;<br/>      )}<br/>    &lt;/Transition&gt;<br/>  );<br/>}</span></pre><p id="337a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Tailwind也有一个过渡库，使得过渡在类中的使用更加简单。如果您想安装库来使用转换组件，就像我在这里做的那样，那么您可以运行这个安装命令:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="4f0b" class="my lm in mu b gy mz na l nb nc">npm install @headlessui/react</span></pre><p id="c2d0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以上面是主要的警报组件，它知道什么时候显示什么类型的警报。我使用条件语句来更好地记录代码在做什么，但是我也可以使用映射来显示基于类型的组件。它还负责关闭警报。</p><h1 id="4617" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">应用程序组件</h1><p id="ee93" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">在Next.js <code class="fe ne nf ng mu b">_app.tsx</code>组件中，我需要为反冲和我的警报组件添加一些代码。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="6e27" class="my lm in mu b gy mz na l nb nc">import '../styles/index.css';<br/>import { RecoilRoot } from 'recoil';<br/>import Alerts from '../components/core/Alerts';</span><span id="6334" class="my lm in mu b gy nd na l nb nc">function MyApp({ Component, pageProps }) {<br/>  return (<br/>    &lt;RecoilRoot&gt;<br/>      &lt;Component {...pageProps} /&gt;<br/>      &lt;Alerts /&gt;<br/>    &lt;/RecoilRoot&gt;<br/>  );<br/>}</span><span id="735e" class="my lm in mu b gy nd na l nb nc">export default MyApp;</span></pre><p id="5a23" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">反冲将不会工作，除非我们将应用程序包装在反冲根组件中，我还添加了我的警报组件，以便能够在应用程序的任何地方使用它。</p><h1 id="1ffe" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">主页</h1><p id="f605" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">在主页<code class="fe ne nf ng mu b">index.tsx</code>组件中，我添加了一些测试功能来显示运行中的警报。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="630e" class="my lm in mu b gy mz na l nb nc">import { useAlert } from '../components/core/Alerts';</span><span id="35ff" class="my lm in mu b gy nd na l nb nc">function InfoButton() {<br/>  const { showAlert } = useAlert();<br/>  const onClick = (type: string) =&gt; {<br/>    showAlert({<br/>      open: true,<br/>      primary: 'Message',<br/>      secondary: 'This is the message for the alert',<br/>      type,<br/>    });<br/>  };<br/>  return (<br/>    &lt;button className="btn-info" onClick={() =&gt; onClick('info')}&gt;<br/>      Info Alert<br/>    &lt;/button&gt;<br/>  );<br/>}</span><span id="34e8" class="my lm in mu b gy nd na l nb nc">function ErrorButton() {<br/>  const { showAlert } = useAlert();<br/>  const onClick = (type: string) =&gt; {<br/>    showAlert({<br/>      open: true,<br/>      primary: 'Message',<br/>      secondary: 'This is the message for the alert',<br/>      type,<br/>    });<br/>  };<br/>  return (<br/>    &lt;button className="btn-error" onClick={() =&gt; onClick('error')}&gt;<br/>      Error Alert<br/>    &lt;/button&gt;<br/>  );<br/>}</span><span id="4397" class="my lm in mu b gy nd na l nb nc">function WarningButton() {<br/>  const { showAlert } = useAlert();<br/>  const onClick = (type: string) =&gt; {<br/>    showAlert({<br/>      open: true,<br/>      primary: 'Message',<br/>      secondary: 'This is the message for the alert',<br/>      type,<br/>    });<br/>  };<br/>  return (<br/>    &lt;button className="btn-warning" onClick={() =&gt; onClick('warning')}&gt;<br/>      Warning Alert<br/>    &lt;/button&gt;<br/>  );<br/>}</span><span id="b641" class="my lm in mu b gy nd na l nb nc">export default function Home() {<br/>  return (<br/>    &lt;div className="screen"&gt;<br/>      &lt;div className="paper"&gt;<br/>        &lt;div className="h1"&gt;Recoil Alerts&lt;/div&gt;<br/>        &lt;div className="flex gap-2"&gt;<br/>          &lt;InfoButton /&gt;<br/>          &lt;ErrorButton /&gt;<br/>          &lt;WarningButton /&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="9322" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我设置了三个按钮，点击时会显示一个警告。下面是运行中的组件的屏幕截图。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/41097a3b4007b600843fecbc72bf8bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6pCTv665W40Fq7bKJ91DrQ.png"/></div></div></figure><h1 id="7615" class="ll lm in bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="ee67" class="pw-post-body-paragraph jv jw in jx b jy mj ka kb kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks ig bi translated">React有很多状态管理工具，但是我发现当你想保持和React钩子一样的API基础，并且不想处理太多的渲染时，反冲是一个很好的库。</p><p id="8b6b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还有许多你可以使用的警告组件，但是我发现使用Tailwind CSS和样式化你自己的组件可以让你的页面脱颖而出，而不是千篇一律。</p></div></div>    
</body>
</html>