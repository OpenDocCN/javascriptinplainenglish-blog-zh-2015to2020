<html>
<head>
<title>Introduction to Firebase Storage #1: Upload Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase存储简介#1:上传文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-firebase-storage-1-upload-files-25e63a74a8c2?source=collection_archive---------8-----------------------#2020-11-28">https://javascript.plainenglish.io/introduction-to-firebase-storage-1-upload-files-25e63a74a8c2?source=collection_archive---------8-----------------------#2020-11-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="145e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些应用程序允许用户上传图片和文件，阅读，删除，甚至可以随时下载。这种功能对于社交媒体平台、博客平台或存储服务可能是有用的。Firebase云存储提供了一个解决方案来轻松存储用户生成的内容。</p><p id="afc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">各位开发者好，在本文中，我们将讨论Firebase云存储，以及我们如何实现它来安全地上传、检索和存储用户文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6ae669e6d504607c5d1c3726c3fd6685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U4X7HTF4Mxuv5cMaqLc70Q.png"/></div></div></figure><h1 id="f26a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是Firebase云存储？</h1><p id="1271" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Firebase云存储是一种服务，开发人员可以使用它来存储和下载客户端直接生成的文件。不需要服务器端代码。</p><p id="9d0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它使用谷歌云存储桶来存储文件，允许从谷歌云和Firebase访问。这些存储桶是在分层结构中形成的。例如:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/cece2d305dc78ef6fb2c09568343d65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ChK9AAKYmvNdfkko.png"/></div></div></figure><p id="5c44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我真正喜欢Firebase云存储的是它与Firebase身份验证的无缝集成，因此您可以根据每个用户组织上传的文件，并在需要时应用访问控制。</p><p id="34eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，它可以自动扩展，因此当存储的数据变得太大时，不必担心会转移到另一个提供商。</p><p id="f633" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们知道了Firebase存储可以做什么，让我们试着在我们的项目中使用它。对于本教程，我正在制作一个简单的相册应用程序，允许用户上传、查看和删除图像。</p><h1 id="a0f1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤1:创建一个新的Firebase项目</h1><p id="08b8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">前往firebase.google.com<a class="ae mb" href="http://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">创建一个新项目。</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/03fcf532eaf8868db0d11348f8ef54d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kftzTv6LzjZTsTWm"/></div></div></figure><p id="6c7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在仪表板上，单击Web图标为Web应用程序初始化Firebase。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/09b5bab84b47156ff73789c7c67adf36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AMmgvQ03L158QvUE"/></div></div></figure><p id="b217" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照Firebase的步骤，你会看到一个显示配置变量的页面(见下图)。这很重要，所以复制并保存在某个地方。我们很快就会用到它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi me"><img src="../Images/a4131c2ced7df90caddb07960b78faf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5Uuot_WddzmEhRXt"/></div></div></figure><p id="d19a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，转到“存储”选项卡，单击“开始”按钮。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/3de7e7b992991a66378382714ef5759d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OqRed-i59czS72qx"/></div></div></figure><p id="dd53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到一个弹出窗口，询问您是否同意某些设置。更换<code class="fe mg mh mi mj b">request.auth !=null</code>到<code class="fe mg mh mi mj b">true</code>。为了本教程的简单性，这确保了我们被允许上传文件到Firebase而不需要认证。</p><p id="5f99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“下一步”继续。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/c464863b6524d6e1f24b61381d0293e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Il8bBNTvBSEI-s2K"/></div></div></figure><p id="313e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就对了。Firebase云存储现已启用。让我们将它集成到我们的应用程序中。</p><h1 id="6ea6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤2:创建一个React应用程序</h1><p id="9f3f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">对于这个例子，我使用react项目模板。你可以使用任何你喜欢的前端框架。</p><p id="e5d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建React项目，只需运行:</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="be7f" class="mp ky iq mj b gy mq mr l ms mt">npx create-react-app &lt;app-name&gt;</span></pre><p id="80d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建项目后，运行:</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="9b34" class="mp ky iq mj b gy mq mr l ms mt">npm install firebase</span></pre><p id="a40a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个包，其中包含了在我们的应用程序中设置Firebase所需的必要工具和基础设施。</p><h1 id="089c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第三步:config.js</h1><p id="f359" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">创建一个名为<code class="fe mg mh mi mj b">config.js</code>的文件来存储我们之前复制的Firebase配置变量。</p><p id="cda5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的<code class="fe mg mh mi mj b">config.js</code>会是什么样子:</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="4c2f" class="mp ky iq mj b gy mq mr l ms mt">import firebase from "firebase/app";<br/>import "firebase/storage";</span><span id="2a56" class="mp ky iq mj b gy mu mr l ms mt">const app = firebase.initializeApp({<br/>  apiKey: process.env.REACT_APP_API_KEY,<br/>  authDomain: process.env.REACT_APP_AUTH_DOMAIN,<br/>  databaseURL: process.env.REACT_APP_DATABASE_URL,<br/>  projectId: process.env.REACT_APP_PROJECT_ID,<br/>  storageBucket: process.env.REACT_APP_STORAGE_BUCKET,<br/>  messagingSenderId: process.env.REACT_APP_MESSAGING_SENDER_ID,<br/>});</span><span id="a01a" class="mp ky iq mj b gy mu mr l ms mt">// Get a reference to the storage service, export it for use<br/>export const storage = firebase.storage(); </span><span id="8b47" class="mp ky iq mj b gy mu mr l ms mt">export default app;</span></pre><p id="86e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我将实际的配置值存储在我的<code class="fe mg mh mi mj b">.env</code>文件中，并作为<code class="fe mg mh mi mj b">process.env.VARIABLE_NAME</code>访问它们。</p><blockquote class="mv mw mx"><p id="144a" class="jn jo my jp b jq jr js jt ju jv jw jx mz jz ka kb na kd ke kf nb kh ki kj kk ij bi translated">如果你是环境变量的新手，我发现这篇很好的文章解释了如何使用它。</p></blockquote><h1 id="6f7f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤4:将文件上传到存储器</h1><p id="9e2b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在<code class="fe mg mh mi mj b">App.js</code>中，我们可以导入从<code class="fe mg mh mi mj b">config.js</code>文件中导出的存储引用。</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="9759" class="mp ky iq mj b gy mq mr l ms mt">import {storage} from "./config";</span></pre><p id="0ef1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了上传文件，我们需要有一个用户输入字段。我们可以像这样创建一个输入元素:</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="fe80" class="mp ky iq mj b gy mq mr l ms mt">&lt;input type="file" accept="image/x-png,image/jpeg" /&gt;</span></pre><p id="2e63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过指定<code class="fe mg mh mi mj b">type</code>到文件，输入字段将是一个文件选择器。</p><p id="a32b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个例子，我们只接受文件为<code class="fe mg mh mi mj b">.png</code>或<code class="fe mg mh mi mj b">.jpeg</code>的文件。我们可以在<code class="fe mg mh mi mj b">accept</code>属性中指定这个需求。</p><p id="eac8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们添加一个按钮，点击后会将我们的图像上传到Firebase。</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="636d" class="mp ky iq mj b gy mq mr l ms mt">&lt;button&gt;Upload to Firebase&lt;/button&gt;</span></pre><p id="0f2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，用户界面看起来应该很简单，如下所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/50fd96d1d9a152218815464514fc7c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RLFx-oAFBupzgCZ7"/></div></div></figure><h1 id="84b2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">1.创建图像状态</h1><p id="3252" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了跟踪用户是否在输入中提供了文件，我们应该有一个<code class="fe mg mh mi mj b">image</code>状态。首先，导入<code class="fe mg mh mi mj b">useState</code>钩子。</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="03fa" class="mp ky iq mj b gy mq mr l ms mt">import React, { useState } from "react";</span></pre><p id="477b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并将状态初始化为空:</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="4a07" class="mp ky iq mj b gy mq mr l ms mt">const [image, setImage] = useState(null);</span></pre><h1 id="e4dc" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">2.onImageChange</h1><p id="f68f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">接下来，让我们创建一个<code class="fe mg mh mi mj b">onImageChange</code>函数，它将在每次用户向输入字段提供新文件时更新<code class="fe mg mh mi mj b">image</code>状态。</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="cc78" class="mp ky iq mj b gy mq mr l ms mt">const onImageChange = (e) =&gt; {<br/>    const reader = new FileReader();<br/>    let file = e.target.files[0]; // get the supplied file<br/>    // if there is a file, set image to that file<br/>    if (file) {<br/>      reader.onload = () =&gt; {<br/>        if (reader.readyState === 2) {<br/>          console.log(file);<br/>          setImage(file);<br/>        }<br/>      };<br/>      reader.readAsDataURL(e.target.files[0]);<br/>    // if there is no file, set image back to null<br/>    } else {<br/>      setImage(null);<br/>    }<br/>  };</span></pre><p id="9d0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将把这个函数传递给input元素的<code class="fe mg mh mi mj b">onChange</code>处理程序。</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="6a96" class="mp ky iq mj b gy mq mr l ms mt">&lt;input type="file" accept="image/x-png,image/jpeg" onChange={(e) =&gt; {onImageChange(e); }}/&gt;</span></pre><h1 id="83f0" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">3.上传至防火墙</h1><p id="d188" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在让我们为按钮创建一个<code class="fe mg mh mi mj b">uploadToFirebase</code>函数，这样当用户点击按钮时，图像将被上传到Firebase。</p><p id="6d62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们实现函数的方法:</p><ol class=""><li id="d441" class="nd ne iq jp b jq jr ju jv jy nf kc ng kg nh kk ni nj nk nl bi translated">检查<code class="fe mg mh mi mj b">image</code>状态是否为空。如果是，请用户首先提供一个文件。</li><li id="6228" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated">如果<code class="fe mg mh mi mj b">image</code>是一个文件，我们将为我们的存储创建一个根引用。</li><li id="07bb" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated">然后我们创建一个子引用来存储我们的文件。我们可以通过图像的<code class="fe mg mh mi mj b">name</code>属性来命名该引用。</li><li id="8214" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated">最后，使用<code class="fe mg mh mi mj b">put(image)</code>将我们的文件存储在引用中。</li><li id="bc41" class="nd ne iq jp b jq nm ju nn jy no kc np kg nq kk ni nj nk nl bi translated">然后有一个回调函数让用户知道文件已经成功上传到Firebase。</li></ol><p id="2188" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是代码实现:</p><pre class="km kn ko kp gt ml mj mm mn aw mo bi"><span id="439d" class="mp ky iq mj b gy mq mr l ms mt">const uploadToFirebase = () =&gt; {<br/>    //1.<br/>    if (image) {<br/>      //2.<br/>      const storageRef = storage.ref();<br/>      //3.<br/>      const imageRef = storageRef.child(image.name);<br/>      //4.<br/>      imageRef.put(image)<br/>     //5.<br/>     .then(() =&gt; {<br/>        alert("Image uploaded successfully to Firebase.");<br/>    });<br/>    } else {<br/>      alert("Please upload an image first.");<br/>    }<br/>  };</span></pre><h1 id="8005" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">应该可以了！</h1><p id="c3c0" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">让我们检查它是否工作。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nr"><img src="../Images/e1eb802d3b69ee4f8ae5f602127cb051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yF8UhAamhibW3rx4ktyuww.png"/></div></div></figure><p id="5ee0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太棒了。上传的图像在Firebase存储器中。</p><h1 id="11f4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="cea1" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">有了Firebase云存储，你可以做很多事情来处理、组织和存储用户的数据和文件。请继续关注下一篇关于如何从Firebase存储中检索、显示和删除文件的文章。</p><p id="f0da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读，我希望它对您有所帮助。欢迎在下面的评论中提出任何问题，并参考Firebase <a class="ae mb" href="https://firebase.google.com/docs/storage" rel="noopener ugc nofollow" target="_blank">文档</a>亲自阅读更多信息。保重，干杯！</p></div></div>    
</body>
</html>