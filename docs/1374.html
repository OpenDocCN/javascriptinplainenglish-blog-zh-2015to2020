<html>
<head>
<title>Using the CORS Middleware for Cross-Domain Communication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CORS中间件进行跨域通信</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-the-cors-middleware-for-cross-domain-communication-6e78d17b7eac?source=collection_archive---------3-----------------------#2020-03-08">https://javascript.plainenglish.io/using-the-cors-middleware-for-cross-domain-communication-6e78d17b7eac?source=collection_archive---------3-----------------------#2020-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8855fa7b634dbc615e69aab614d4e3fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0UX61RvXiFV3YMtq"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@trebhu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hubert Van den Borre</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d821" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，Express没有提供任何东西来支持跨域通信。</p><p id="d4de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着单页面web应用程序的流行，我们需要在应用程序中启用跨域通信，以便单页面web应用程序可以与我们的后端通信。</p><p id="dc61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何使用<code class="fe lb lc ld le b">cors</code>中间件来实现跨域通信。CORS站是跨源资源共享，这是让浏览器应用程序与其他领域的应用程序通信的方式。</p><h1 id="c24e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">添加中间件</h1><p id="a8c7" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">为了安装中间件，我们运行:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="40fe" class="mq lg iq le b gy mr ms l mt mu">npm install cors</span></pre><p id="9e8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们可以如下使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="1335" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();<br/>app.use(cors())</span><span id="8e7f" class="mq lg iq le b gy mv ms l mt mu">app.get('/', (req, res, next) =&gt; {<br/>  res.json({ foo: 'bar' })<br/>})</span><span id="3125" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="3acd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们有:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="6a30" class="mq lg iq le b gy mr ms l mt mu">app.use(cors())</span></pre><p id="dd85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">整个应用程序将启用跨域通信。</p><h1 id="314d" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">选择</h1><p id="9507" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lb lc ld le b">cors</code>中间件接受一个可选的<code class="fe lb lc ld le b">options</code>对象。它有以下选项:</p><h2 id="a90c" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">起源</h2><ul class=""><li id="bdbc" class="nh ni iq kf b kg md kk me ko nj ks nk kw nl la nm nn no np bi translated">如果这是一个<code class="fe lb lc ld le b">boolean </code> —如果我们希望允许所有域的请求，则设置为<code class="fe lb lc ld le b">true</code>。<code class="fe lb lc ld le b">false</code>如果我们想禁用CORS。</li><li id="fc24" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">string——将<code class="fe lb lc ld le b">origin</code>设置为一个特定的原点，比如<code class="fe lb lc ld le b">http://example.com</code>,我们希望从这个原点接受请求</li><li id="e467" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">Regex——我们可以将其设置为一个regex，以匹配我们希望接受请求的原始域</li><li id="1929" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">array——我们可以将它设置为我们希望接受请求的源字符串的数组</li><li id="9bd2" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">函数—我们可以将其设置为以<code class="fe lb lc ld le b">origin</code>和<code class="fe lb lc ld le b">callback</code>为参数的函数。<code class="fe lb lc ld le b">origin</code>是来自<code class="fe lb lc ld le b">Origin</code>请求头的请求的原始URL。回调的第一个参数是错误对象，第二个参数是布尔值，表示我们是否希望CORS继续。</li></ul><h2 id="3617" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">方法</h2><p id="aa27" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lb lc ld le b">methods</code>让我们设置我们想要允许的请求方法，比如GET、POST等。我们可以传入一个字符串，比如<code class="fe lb lc ld le b">'GET,POST'</code>，或者一个类似<code class="fe lb lc ld le b">['GET', 'POST']</code>的数组。</p><p id="3478" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它设置<code class="fe lb lc ld le b">Access-Control-Allow-Methods</code> CORS割台。</p><h2 id="2cf9" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">允许的标题</h2><p id="4b07" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">它设置<code class="fe lb lc ld le b">Access-Control-Allow-Headers</code> CORS标题。</p><p id="12c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以把它设置成一个类似于<code class="fe lb lc ld le b">‘Content-Type,Authorization’ </code>的字符串或者一个数组<code class="fe lb lc ld le b">[‘Content-Type’, ‘Authorization’]</code>。</p><h2 id="a0de" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">暴露的标题</h2><p id="9ae3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">这将设置<code class="fe lb lc ld le b">Access-Control-Expose-Headers</code> CORS割台。</p><p id="e035" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以把它设置成一个类似于<code class="fe lb lc ld le b">‘Content-Range,X-Content-Range’</code>的字符串或者一个数组<code class="fe lb lc ld le b">[‘Content-Range’, ‘X-Content-Range’]</code>。</p><p id="4f46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果未指定任何内容，则不会公开任何自定义标头。</p><h2 id="a5a6" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">资格证书</h2><p id="82f4" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">这将设置<code class="fe lb lc ld le b">Access-Control-Allow-Credentials</code> CORS标题。</p><p id="5be0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想通过割台，将此设置为<code class="fe lb lc ld le b">true</code>。否则省略。</p><h2 id="f553" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">maxAge</h2><p id="028e" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated"><code class="fe lb lc ld le b">maxAge</code>落下了<code class="fe lb lc ld le b">Access-Control-Max-Age</code> CORS的头球。</p><p id="62b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将它设置为一个整数来传递头，否则，它将被忽略。</p><h2 id="e819" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">预闪光继续</h2><p id="6310" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">设置此项，将CORS预检响应传递给下一个处理程序</p><h2 id="d1f3" class="mq lg iq bd lh mw mx dn ll my mz dp lp ko na nb lt ks nc nd lx kw ne nf mb ng bi translated">选项成功状态</h2><p id="18bd" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">更改成功的选项请求的状态代码。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/9c273cf1154a33355724f693604938a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B2wdGcAue1K-244c"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@hilesy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">George Hiles</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="b966" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">启用CORS的单一路由</h1><p id="7f88" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以通过为单个路由添加CORS中间件来为单个路由启用CORS:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="050e" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();</span><span id="e8eb" class="mq lg iq le b gy mv ms l mt mu">app.get('/', cors(), (req, res, next) =&gt; {<br/>  res.json({ foo: 'bar' })<br/>})</span><span id="1f86" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="88dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么只有<code class="fe lb lc ld le b">/</code>路线启用了CORS。</p><h1 id="d2d7" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">配置CORS</h1><p id="2894" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以配置<code class="fe lb lc ld le b">cors</code>只接受不同域的请求。此外，我们可以更改OPTIONS请求的成功响应代码，这是针对实际请求的。</p><p id="6f22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以为成功的选项请求配置域和状态代码，如下所示:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="5e42" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();<br/>const corsOptions = {<br/>  origin: '<a class="ae kc" href="https://WheatTurboRuntimes--five-nine.repl.co'" rel="noopener ugc nofollow" target="_blank">https://WheatTurboRuntimes--five-nine.repl.co'</a>,<br/>  optionsSuccessStatus: 200<br/>}</span><span id="0832" class="mq lg iq le b gy mv ms l mt mu">app.use(express.static('public'));<br/>app.get('/foo', cors(corsOptions), (req, res, next) =&gt; {<br/>  res.json({ foo: 'bar' })<br/>})</span><span id="7f5c" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="0d62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将我们的应用程序配置为只接受来自<code class="fe lb lc ld le b"><a class="ae kc" href="https://WheatTurboRuntimes--five-nine.repl.co'" rel="noopener ugc nofollow" target="_blank">https://WheatTurboRuntimes--five-nine.repl.co</a></code>的请求，选项请求的成功状态代码为200，而不是通常的204。</p><p id="a52b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lb lc ld le b">public</code>文件夹中，我们添加一个<code class="fe lb lc ld le b">script.js</code>并添加:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="344b" class="mq lg iq le b gy mr ms l mt mu">(async ()=&gt;{<br/>  const result = await fetch('<a class="ae kc" href="https://WheatTurboRuntimes--five-nine.repl.co/foo'" rel="noopener ugc nofollow" target="_blank">https://WheatTurboRuntimes--five-nine.repl.co/foo'</a>);<br/>  const res = await result.json();<br/>  const p = document.querySelector('p');<br/>  p.innerText = res.foo;<br/>})();</span></pre><p id="6f16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lb lc ld le b">index.html</code>中，我们添加:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="76d3" class="mq lg iq le b gy mr ms l mt mu">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="4ee1" class="mq lg iq le b gy mv ms l mt mu">&lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;meta name="viewport" content="width=device-width"&gt;<br/>  &lt;title&gt;repl.it express&lt;/title&gt;<br/>  &lt;link href="style.css" rel="stylesheet" type="text/css" /&gt;<br/>&lt;/head&gt;</span><span id="22bc" class="mq lg iq le b gy mv ms l mt mu">&lt;body&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>  &lt;script src="script.js"&gt;<br/>  &lt;/script&gt;<br/>&lt;/body&gt;</span><span id="4664" class="mq lg iq le b gy mv ms l mt mu">&lt;/html&gt;</span></pre><p id="424d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在屏幕上看到<code class="fe lb lc ld le b">bar</code>。</p><h1 id="3e9d" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">动态起源</h1><p id="ad27" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">通过将<code class="fe lb lc ld le b">origin</code>属性的值设置为一个函数，<code class="fe lb lc ld le b">origin</code>设置可以是动态的。</p><p id="58f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该函数以<code class="fe lb lc ld le b">origin</code>和<code class="fe lb lc ld le b">callback</code>为参数。</p><p id="6779" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">origin</code>具有请求的发起域，而<code class="fe lb lc ld le b">callback</code>是在检查域后调用的函数。</p><p id="fa6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以将其设置如下:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="f193" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();<br/>const corsOptions = {<br/>  origin: (origin, callback) =&gt; {<br/>    if (origin.includes('WheatTurboRuntimes')) {<br/>      callback(null, true)<br/>    }<br/>  },<br/>  optionsSuccessStatus: 200<br/>}</span><span id="b49a" class="mq lg iq le b gy mv ms l mt mu">app.use(express.static('public'));<br/>app.get('/foo', cors(corsOptions), (req, res, next) =&gt; {<br/>  res.json({ foo: 'bar' })<br/>})</span><span id="d699" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="14e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，当我们向<code class="fe lb lc ld le b">/foo</code>发送GET请求，并将<code class="fe lb lc ld le b">Origin</code>头设置为<code class="fe lb lc ld le b">https://WheatTurboRuntimes--five-nine.repl.co</code>时，我们将返回:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="0e03" class="mq lg iq le b gy mr ms l mt mu">{<br/>    "foo": "bar"<br/>}</span></pre><p id="033d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当原点符合我们的条件，也就是包含<code class="fe lb lc ld le b">WheatTurboRuntimes</code>时，就会调用<code class="fe lb lc ld le b">callback</code>。</p><p id="9f8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回调的第一个参数是错误对象，第二个参数是布尔值，表示我们是否希望CORS继续。</p><h1 id="0d33" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">启用CORS预飞行</h1><p id="600d" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">如果我们想为预检选项请求启用CORS，我们可以使用<code class="fe lb lc ld le b">cors</code>中间件来实现。</p><p id="86c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="1b4f" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();</span><span id="1c7b" class="mq lg iq le b gy mv ms l mt mu">app.use(express.static('public'));<br/>app.options('/foo', cors())<br/>app.get('/foo', cors(), (req, res, next) =&gt; {<br/>  res.json({ foo: 'bar' })<br/>})</span><span id="4d62" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><p id="bd8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="9411" class="mq lg iq le b gy mr ms l mt mu">app.options('/foo', cors())</span></pre><p id="5fd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将使选项请求可用于所有域。</p><p id="81a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过编写以下内容为所有路径启用飞行前请求:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="a1f8" class="mq lg iq le b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();</span><span id="ee25" class="mq lg iq le b gy mv ms l mt mu">app.use(express.static('public'));<br/>app.options('*', cors())<br/>app.get('/foo', cors(), (req, res, next) =&gt; {<br/>  res.json({ foo: 'bar' })<br/>})</span><span id="23a3" class="mq lg iq le b gy mv ms l mt mu">app.listen(3000);</span></pre><h1 id="2871" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="f1df" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">cors</code>中间件来实现与不同来源的浏览器应用程序的跨域通信。</p><p id="6e74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它允许我们设置各种选项，如要接受的起点，以及选项成功响应的状态。</p><p id="0877" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以设置各种响应头，并动态检查来源，看看我们是否希望允许它。</p><p id="79f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">cors</code>中间件可以用于单条路由，也可以用于所有路由。</p></div></div>    
</body>
</html>