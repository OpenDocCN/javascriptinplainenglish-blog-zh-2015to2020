# 重构:改进现有代码的 5 个步骤

> 原文：<https://javascript.plainenglish.io/how-to-refactor-existing-code-70e9e5af4ce3?source=collection_archive---------7----------------------->

![](img/20ab0d1d0818e5198485eb440939f524.png)

The hardest & most frequent thing you’ll do as a developer

作为开发人员，您的大部分工作是更新现有代码。然而，并没有太多的指南或教程来教你如何成功地重构，以及应该寻找什么。

在这篇文章中，我将分享一套简单的指导原则，当我不得不重构时，这些原则对我很有用。

# 为什么要重构？

代码库变得难以理解的速度之快令人惊讶。并不是说最初的作者是糟糕的程序员。需求发生了变化，一些东西被添加进来。

当时的决定似乎是合理的。重构规则 1:责怪别人不会有任何帮助。

那么为什么要重构呢？

*   因为它使代码更容易理解，更容易理解的代码也更容易被下一个开发人员更新
*   通常，它会使您的代码执行得更快
*   它迫使你真正理解代码是如何工作的&为什么它会这样工作，使你成为一个更好的开发者
*   未来，重构后的代码更加灵活。重用逻辑、常量和数据结构使得代码更容易扩展。

# 什么时候重构？

我看到工程团队陷入了一个又一个重构的循环中。我如何决定什么值得我花时间去解决？

*   永远假设你不会是下一个接触这个代码的人(或者未来——你会忘记代码是如何工作的)。现在，当你明白这是澄清它的最佳时机。
*   这并不意味着你必须重写它的基本工作原理(尽管你可能会这么做)。很多时候，清理一些东西并重命名其他东西会产生很大的不同。
*   如果你被分配了一个特定的任务/任务单，不要重构你的任务单范围之外的代码。限制重构的范围。
*   你应该总是努力让代码比你发现的更好。

什么时候应该寻找代码的味道和使代码更简单的方法？一直都是。

什么时候你应该进行一次大规模的重构，这将触及代码库的许多部分？只有当你被明确地分配了任务并且得到了整个团队的支持时。

# 我最喜欢的 5 种重构试探法

> “启发式是解决问题或自我发现的任何方法，它采用的实际方法不能保证是最佳的、完美的或合理的，但足以达到一个直接的、短期的目标。”——维基百科

虽然它们不会涵盖每一个可能的重构机会，但这 5 个启发法对我简化代码有很大帮助。

# 1.进行测试

当你重构某个东西时，第一步是[检查是否有针对这个功能的测试](https://en.wikipedia.org/wiki/Test-driven_development)。

更改现有代码意味着您可能会破坏某些东西，因此在我们进行任何更改之前，我们希望了解原始代码产生的预期响应。

如果你没有测试，重构的第一步就是写测试。

# 2.减少 If/Else

任何时候你添加一个 if 语句到你的代码中，你增加了它的复杂性。下一个阅读它的人必须记住他们遇到的所有不同的可能的代码路径。

通常，通过将工作转移到提前返回的[函数中也可以获得相同的结果](https://stackoverflow.com/a/1804276)。

[功能编程](https://maryrosecook.com/blog/post/a-practical-introduction-to-functional-programming)的元素也将帮助[减少条件逻辑](https://medium.com/swlh/stop-using-if-else-statements-f4d2323e6e4)。

理想情况下，你的代码不应该嵌套(缩进)超过几层。

# 3.使用变量名来阐明

如果你的变量名不清楚、错误或者太普通，那么代码就更难阅读。

通常，这是一场轻松的胜利。找到不好的变量名并用好的替换。

此外，将复杂的条件逻辑转换为存储布尔值的变量。如果您调用函数只是为了查看它们是否有值，那么将它们保存为具有明确名称的变量:

```
has_thing = self.logic.find_the_thing(lookup, other_stuff)
```

总是在寻找澄清和简化变量名的方法。命名是编码中最难的部分之一。

# 4.函数应该只做一件事

当你写函数&重构别人的函数时，请记住这一点。他们应该尽可能的沉默。

我昨天写了这个函数:

```
def get_company_override_rate(self, date):
    “”” Find the currency conversion rate for this time period “””
    date = arrow.get(date)
    rate = self.conversion_rates.get(date.format(‘YYYY-MM’))       
    return rate
```

我并不是说这个函数是简单的顶峰。有更多的事情可以做得更简单。但是它很短，并且很快就能明白它是做什么的。

Python 程序员会注意到，如果日期不在字典中，这个函数会返回`None`。代码这样做是为了减少 If/Else(见上面的#2 ),当这些小函数被链接在一起做更复杂的逻辑时。

保持你的函数简单，让它们互相调用。

# 5.在类/状态级别存储有用的信息

如果你看到一个函数有很多参数，那么它可能需要一些类或状态对象。

使用`this.state`或`self.attribute`是常见的模式，尽管语法会根据您的语言而变化。

当您在类实例上存储数据时，您可以在该类的不同方法之间引用该数据。然后，初始化类调用标准逻辑来填充这些值。

您将获得更加一致的结果，可以在许多地方重复使用，而无需重复。

# 凭直觉

这些只是我发现有用的指导方针。最终，你工作的代码将会和我的有很大的不同，所以你只需要发展直觉，知道什么代码需要改变。

如果你在代码中嗅到一些可疑的东西，跟随你的直觉。几乎可以肯定的是，有些东西是可以改进的。

想深入了解重构吗？一定要读马丁·福勒的书——《重构:改进现有代码的设计》

你使用更多的重构试探法吗？我很想听听他们的故事——使用评论或 hello@bennettgarner.com

# 关于班尼特

我是一名用 Python 和 JavaScript 构建东西的 web 开发人员。

*想要我关于 web 开发和成为更好的程序员的最佳内容吗？*

*我在邮件列表中分享我最喜欢的建议——没有垃圾邮件，没有推销内容，只有有用的内容。*

加入我的电子邮件系列中的 500 名其他开发人员。