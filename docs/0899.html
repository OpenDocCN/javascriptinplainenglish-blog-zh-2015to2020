<html>
<head>
<title>What is ObjectId in MongoDB and how to generate it manually when required</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB中的ObjectId是什么，需要时如何手动生成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-objectid-in-mongodb-and-how-to-generate-it-manually-when-required-923f7cf1dac8?source=collection_archive---------2-----------------------#2019-12-31">https://javascript.plainenglish.io/what-is-objectid-in-mongodb-and-how-to-generate-it-manually-when-required-923f7cf1dac8?source=collection_archive---------2-----------------------#2019-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="45b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们插入任何新记录/文档时，ObjectId会自动生成</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/c43321e6d57c408d69ad70b2550b3df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VnARvftwRT6PUMGK"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@ikukevk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kevin Ku</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9485" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用MongoDB时，您可能已经注意到，当我们在集合中插入任何文档时，都会生成一个名为<strong class="jp ir"> _id </strong>的额外字段。<br/>generated _ id的值不是任何随机数，而是一个在世界上所有mongodb数据库中唯一的值。</p><p id="91f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于本文，我假设您已经在系统上安装了MongoDB，并且已经通过运行mongod可执行文件启动了MongoDB服务器。</p><p id="5bd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了更好地理解它，我们将使用mongodb库而不是mongoose库。<br/>使用以下命令安装mongodb npm软件包</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="5d3f" class="lh li iq ld b gy lj lk l ll lm">npm install mongodb</span></pre><p id="69d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个新文件mongodb.js，并在其中添加以下代码</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="7d37" class="lh li iq ld b gy lj lk l ll lm">const { MongoClient } = require('mongodb');<br/>const connectionURL = "mongodb://127.0.0.1";<br/>const databaseName = "company";</span><span id="d2ce" class="lh li iq ld b gy ln lk l ll lm">MongoClient.connect(connectionURL, { useNewUrlParser: true, useUnifiedTopology: true }, (error, client) =&gt; {<br/> if(error) {<br/>  return console.log('error connecting to mongodb');<br/> }</span><span id="7b13" class="lh li iq ld b gy ln lk l ll lm">const db = client.db(databaseName);<br/>db.collection('employees')<br/> <strong class="ld ir">.insertOne({ name: 'David', age: 30, designation: 'Developer' })</strong><br/> .then(result =&gt; console.log(result))<br/> .catch(error =&gt; console.log(error));<br/>});</span></pre><p id="456a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您通过运行以下命令来执行上述文件时</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="f21a" class="lh li iq ld b gy lj lk l ll lm">node mongodb.js</span></pre><p id="486c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到，一个新文档被添加到公司数据库内的employees集合中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lo"><img src="../Images/0247f61d1f5add2c96447d893111ea08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-RY8MZhhQkGMTLFBaj1MA.png"/></div></div></figure><p id="e07c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在上面的代码中所看到的，我们只插入了姓名、年龄和职务，但是添加了一个带有值的extra _id字段</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="1ba5" class="lh li iq ld b gy lj lk l ll lm"><strong class="ld ir">ObjectId("5e0af1c63b6482125c1b42cb")</strong></span></pre><p id="523d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">双引号内的值是一个12字节的值，包括</p><ul class=""><li id="a21e" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">一个4字节的<em class="ly">时间戳值</em>，代表ObjectId的创建，从1970年1月1日午夜的Unix纪元开始以秒为单位测量</li><li id="462e" class="lp lq iq jp b jq lz ju ma jy mb kc mc kg md kk lu lv lw lx bi translated">一个5字节的随机值<em class="ly"/></li><li id="a7b8" class="lp lq iq jp b jq lz ju ma jy mb kc mc kg md kk lu lv lw lx bi translated">3字节<em class="ly">递增计数器</em>，初始化为随机值</li></ul><p id="857e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是特意设计的，使它在世界上所有的数据库中是唯一的，这样一个ObjectId将只对那个文档是唯一的。</p><p id="38d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在某些情况下，我们可能希望存储生成的ObjectId供您参考。在这种情况下，我们可以手动生成ObjectId，并在向集合添加新文档时使用它</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="32b1" class="lh li iq ld b gy lj lk l ll lm">const { MongoClient, <strong class="ld ir">ObjectID</strong> } = require('mongodb');<br/>const connectionURL = "mongodb://127.0.0.1";<br/>const databaseName = "company";</span><span id="67e5" class="lh li iq ld b gy ln lk l ll lm">MongoClient.connect(connectionURL, { useNewUrlParser: true, useUnifiedTopology: true }, (error, client) =&gt; {<br/> if(error) {<br/>  return console.log('error connecting to mongodb');<br/>}</span><span id="a60b" class="lh li iq ld b gy ln lk l ll lm">const db = client.db(databaseName);<br/><strong class="ld ir">const newObjectId = new ObjectID();</strong></span><span id="5a4c" class="lh li iq ld b gy ln lk l ll lm"><strong class="ld ir">console.log('object id', newObjectId);</strong></span><span id="e840" class="lh li iq ld b gy ln lk l ll lm">db.collection('employees')<br/> .insertOne({<strong class="ld ir"> _id: newObjectId</strong>, name: 'Jen', age: 35, designation: 'Designer' })<br/> .then(result =&gt; console.log('total records inserted', result.insertedCount))<br/> .catch(error =&gt; console.log(error));<br/>});</span></pre><p id="4c09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从代码中可以看出，我们使用</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="47b1" class="lh li iq ld b gy lj lk l ll lm">const newObjectId = new ObjectID();</span></pre><p id="b3a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建新的ObjectId，并在插入文档时指定</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="ea75" class="lh li iq ld b gy lj lk l ll lm">_id: newObjectId</span></pre><p id="6622" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果您使用<strong class="jp ir">节点mongodb.js </strong>再次运行该文件，您将看到一个带有新生成的id的新文档被打印到控制台，并且与插入到数据库中的文档相同</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi me"><img src="../Images/fae21c4d23d55be29aa16ece9384c06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WN_3L2hNLkXhsZUzKHZ4Q.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lo"><img src="../Images/84f27bcf1c58e7204d9948552b748d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-irag03RvE6Jhcb8aLKShQ.png"/></div></div></figure><p id="2bfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ObjectId还提供了getTimestamp方法，该方法允许我们从ObjectId 的12个字节中获取时间戳值，即<em class="ly"> 4个字节的时间戳值</em></p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="45da" class="lh li iq ld b gy lj lk l ll lm">const newObjectId = new ObjectID();<br/>console.log("timestamp value", newObjectId.getTimestamp());<br/>// 2019-12-31T08:05:25.000Z</span></pre><p id="92f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止。希望你今天学到了新东西。</p><p id="0659" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">别忘了直接在你的收件箱</strong> <a class="ae lb" href="https://yogeshchavan.dev" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">这里</strong> </a> <strong class="jp ir">订阅我的每周时事通讯，里面有惊人的技巧、诀窍和文章。</strong></p></div></div>    
</body>
</html>