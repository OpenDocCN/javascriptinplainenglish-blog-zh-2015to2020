<html>
<head>
<title>Add Google Login to your React Apps in 10 mins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在10分钟内将Google登录添加到您的React应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-google-login-to-your-react-apps-in-10-mins-c45315c93db0?source=collection_archive---------2-----------------------#2020-06-27">https://javascript.plainenglish.io/add-google-login-to-your-react-apps-in-10-mins-c45315c93db0?source=collection_archive---------2-----------------------#2020-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d27ba375813485e617615971441037c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4xDwuRkt_2jTDDsdQSz3g.png"/></div></div></figure><p id="52c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为客户端开发人员，创建带身份验证的应用程序可能是一个乏味的过程。因为我们需要在服务器中处理认证并维护代码。它确实有一些基于身份验证机制的多个案例需要维护。(Basic、OAuth等)这个博客帮助你为你的react应用创建一个独立的后端无认证。(或另外)您也可以添加服务器配置，以便与您的服务器进行认证。</p><h1 id="ff67" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为什么是OAuth？</h1><p id="94a1" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">使用OAuth有很多原因。</p><ul class=""><li id="0bd6" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">它是安全的。</li><li id="c135" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">它不需要用户的任何凭证。所以不需要记住多个密码。</li><li id="b580" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">网站也可以获得用户的基本信息，而不用花太多时间在表格上。</li></ul><p id="bfe8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">特别是在我们的案例中，我们不需要服务器来验证或获取用户的初始详细信息。😉</p><p id="a881" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发现了一个名为<code class="fe mn mo mp mq b">react-google-login</code>的包。它提供了添加Google登录的简单机制。您可以直接使用他们的<code class="fe mn mo mp mq b">GoogleLogin</code>组件，也可以使用自定义按钮。他们还提供像<code class="fe mn mo mp mq b">useGoogleLogin</code>和<code class="fe mn mo mp mq b">useGoogleLogout</code>这样的定制钩子，这对钩子爱好者来说很容易。<em class="mr">(两种方法如下所述)</em></p><p id="0a72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">他们为这个库提供的<a class="ae ms" href="https://npmjs.com/package/react-google-login" rel="noopener ugc nofollow" target="_blank">文档</a>棒极了。但它在某些方面是缺失的，这在这篇博客中有所提及。详细来说，这个博客有助于在谷歌开发者控制台中创建你的应用程序，并访问<code class="fe mn mo mp mq b">clientId</code>。这个包获得的初始<code class="fe mn mo mp mq b">access_token</code>只会持续一个小时(出于安全原因<em class="mr">)。</em>我们需要使用<code class="fe mn mo mp mq b">refresh_token</code>迭代这个过程来访问新的<code class="fe mn mo mp mq b">access_token</code>。因此您可以制作一个<strong class="ka ir">生产就绪的应用程序。</strong></p><h1 id="8d3d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">步伐</h1><ul class=""><li id="d686" class="lz ma iq ka b kb lu kf lv kj mt kn mu kr mv kv me mf mg mh bi translated">我们需要在Google开发者控制台中创建一个应用程序。它提供了<code class="fe mn mo mp mq b">clientId</code>用于识别你的应用的认证细节。按照以下步骤获取客户端ID。</li></ul><ol class=""><li id="a72b" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv mw mf mg mh bi translated">进入<a class="ae ms" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">凭证页面</a>。<em class="mr">(如果你是新手，那么</em> <a class="ae ms" href="https://console.developers.google.com/projectcreate" rel="noopener ugc nofollow" target="_blank"> <em class="mr">创建一个项目</em> </a> <em class="mr">并遵循这些步骤)</em></li><li id="24cb" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mw mf mg mh bi translated">点击<strong class="ka ir">创建凭证&gt; OAuth客户端ID </strong>。</li><li id="fa79" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mw mf mg mh bi translated">选择<strong class="ka ir"> Web应用</strong>类型。</li><li id="165c" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv mw mf mg mh bi translated">命名你的OAuth 2.0客户端，点击<strong class="ka ir">创建</strong></li></ol><ul class=""><li id="fdc8" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">确保您提供了您的域和重定向URL。以便Google识别它可以提供认证的源域。</li></ul><figure class="my mz na nb gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/f3207cf9f8a9879fe571b74e9fb19f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*UBpcYTXiF8w5lg_RuiAN1w.png"/></div></figure><p id="f811" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您也可以添加您的本地发展路线。现在，Google开发者控制台中的身份验证设置已经准备好了。</p><h1 id="7f8e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">让我们编码</h1><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/d47edfa8d99ef42ec692765deb5dab2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHcK-ybudf-M3-Jzm72tZA.png"/></div></div></figure><p id="3a12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">先说代码。<a class="ae ms" href="https://github.com/sivanesh-s/react-google-authentication/" rel="noopener ugc nofollow" target="_blank">查看我的回购</a>获取所有代码片段。查看<a class="ae ms" href="https://sivanesh-s.github.io/react-google-authentication/" rel="noopener ugc nofollow" target="_blank">演示</a>。</p><p id="ad22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在你的CRA安装包中</p><p id="2878" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个充当登录按钮的<code class="fe mn mo mp mq b">Login</code>组件。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/b8785441a2e8a65b3185b182ad3dab4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kkTD52mR2J1eiWlbrMbkWw.png"/></div></div></figure><p id="5fee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，创建一个<code class="fe mn mo mp mq b">Logout</code>组件</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/01fbbd8151f6199795c2d7caa06317ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggUqJ3uAC9ciTat-77smsA.png"/></div></div></figure><p id="9eec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并将二者添加到应用程序的所需位置。我的在<code class="fe mn mo mp mq b">App.js</code></p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/f26871b1ead37134eea171b9bf572fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cYazkxofbvPFC4J6-0O7Dg.png"/></div></div></figure><p id="b777" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行你的应用程序，登录后会在控制台显示<code class="fe mn mo mp mq b">profileObj</code>。</p><p id="3bcc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">祝贺🎉你成功地做到了😃。</p><p id="4827" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是1小时后你的<code class="fe mn mo mp mq b">tokenId</code>就过期了，因此它不会被用来访问数据或验证用户。因此我们需要生成新的<code class="fe mn mo mp mq b">tokenId</code>。为了让事情顺利进行，我们需要在<code class="fe mn mo mp mq b">Login</code>组件中添加一些额外的案例。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/dde033a7dc4ba41fd2915b2ca8937bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qMddkONZvGs53ruj6Asg7g.png"/></div></div></figure><p id="ecfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mn mo mp mq b">refreshTokenSetup</code>函数将负责处理新的<code class="fe mn mo mp mq b">tokenIds</code></p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/8157de15725285b31f4006eb640d9a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0_6NLqNjz3jJA_V05jGPA.png"/></div></div></figure><p id="11fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该函数检查<code class="fe mn mo mp mq b">expires_in</code>时间戳或我们的自定义时间<em class="mr">(在令牌过期之前)</em>并调用<code class="fe mn mo mp mq b">reloadAuthResponse</code>，这是库提供的一个实用函数，它处理<code class="fe mn mo mp mq b">refresh_token</code>并获得新的<code class="fe mn mo mp mq b">tokenId</code>。</p><p id="220d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是的😃Google登录已成功添加到您的应用程序中🎉。所以现在你可以访问用户的<strong class="ka ir">姓名、照片网址、电子邮件、谷歌Id、</strong>等。</p><h1 id="88dc" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">额外的</h1><p id="9a8b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">以上方式使用Google登录默认按钮。您也可以使用<code class="fe mn mo mp mq b">render</code>道具使用您的自定义按钮。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/245b21614f3672cdd73798c0bb44f215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvVfmDvpzoFG7kyAMM5eWw.png"/></div></div></figure><p id="428b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们也可以使用<strong class="ka ir"> React钩子实现相同的功能。</strong> ❤️</p><p id="0041" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mn mo mp mq b">LoginHooks.js</code></p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/b8d02dbf68dda07afec4f552d2959d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ze0rtwpc66mZy3TzIFgdZQ.png"/></div></div></figure><p id="9d78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mn mo mp mq b">LogoutHooks.js</code></p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/dea678859307fad0d4aa088cdad5a555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNwzf--Gig5_QJ7NiB5LOw.png"/></div></div></figure><h1 id="cf69" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">服务器端验证</h1><p id="9331" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果您希望添加服务器端验证，请在调用<code class="fe mn mo mp mq b">Login</code>组件中的<code class="fe mn mo mp mq b">onSuccess</code>后，将<code class="fe mn mo mp mq b">tokenId</code>从客户端发送到服务器。</p><p id="94ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在处理认证路由时，来自客户端的所有请求都需要在报头中发送用户的<code class="fe mn mo mp mq b">tokenId</code>作为<strong class="ka ir">承载令牌。</strong>在服务器上，一旦收到令牌，就必须对其进行验证<code class="fe mn mo mp mq b">tokenId</code></p><ul class=""><li id="b686" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">属于当前应用程序。</li><li id="541d" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">过期了吗</li></ul><p id="e0bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以手动操作，但是谷歌建议使用他们的认证库<em class="mr">(需要最少的努力)</em>。</p><p id="bd12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在服务器端<em class="mr">(这里使用Node.js)。</em></p><p id="22c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装谷歌官方支持的库<code class="fe mn mo mp mq b">google-auth-library</code>包，用于认证和验证OAuth应用。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/0022be7c52cb443330a74d5eb338f33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lnr5UgiZt-CKEoBKxS01bA.png"/></div></div></figure><p id="cdfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，通过我们发送的<code class="fe mn mo mp mq b">GOOGLE_CLIENT_ID</code>，它验证这个令牌是否属于我们的应用程序。它解析它们并在<code class="fe mn mo mp mq b">getPayload</code>函数中提供配置文件细节。您可以使用它们来访问用户数据。</p><p id="58ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如有任何疑问，欢迎在我的社交媒体账户中发表评论或与我本人聊天。</p><p id="86a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我喜欢与开发人员联系在一起。😃</p><p id="251d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ms" href="https://twitter.com/sivanesh_fiz" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ms" href="https://www.linkedin.com/in/sivanesh-shanmugam/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ms" href="https://github.com/Sivanesh-S" rel="noopener ugc nofollow" target="_blank">GitHub</a></p></div></div>    
</body>
</html>