<html>
<head>
<title>React Native: How to Add Firebase Google authenticaton in an Expo project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native:如何在Expo项目中添加Firebase Google认证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-firebase-adding-google-authenticaton-in-an-expo-project-2-ed20cb440732?source=collection_archive---------1-----------------------#2020-08-12">https://javascript.plainenglish.io/react-native-firebase-adding-google-authenticaton-in-an-expo-project-2-ed20cb440732?source=collection_archive---------1-----------------------#2020-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d86b59952f0cc82b00a8aecf5e1c77cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMPuQdQ0j5rq1eDB_a9yjA.png"/></div></div></figure><p id="1090" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">请注意</strong>:这篇文章是我上一篇文章的扩展，所以这里显示的代码只是这个功能的一部分，如果你想从头开始，你可以从这个URL开始阅读:</p><div class="kw kx gp gr ky kz"><a rel="noopener  ugc nofollow" target="_blank" href="/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">React Native:世博项目中的Firebase电子邮件认证</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">在我学习React Native应用程序开发的旅程中，我决定尝试制作一个小型的包含应用程序，它将…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><p id="cccb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">继我之前使用Firebase和电子邮件/密码认证(<a class="ae lo" href="https://medium.com/react-native-playground/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890" rel="noopener">见我之前的故事</a>)开发一个基本登录应用程序的成功尝试之后，我决定开始附加到这个基本系统，更多的登录提供商，因为Firebase与他们中的许多人很好地集成，我决定从谷歌登录开始。</p><p id="553e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Expo提供了两个Google sign in API:Google sign in(【https://docs.expo.io/versions/latest/sdk/google-sign-in/】)看起来更容易实现，但不幸的是只能用在独立的应用程序中——这意味着你每次都需要构建你的应用程序进行测试——和Google(<a class="ae lo" href="https://docs.expo.io/versions/latest/sdk/google/" rel="noopener ugc nofollow" target="_blank"/>)在Expo应用程序中工作(在我看来也是独立的),它缺乏关于Firebase集成的文档，需要更多的调整才能让它按预期工作。由于目前我将呆在世博会内，我选择了第二个。</p><h1 id="a041" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">这个应用程序如何工作</h1><p id="9671" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">这个应用程序将扩展我以前的一个(<a class="ae lo" href="https://medium.com/react-native-playground/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890" rel="noopener">https://medium . com/react-native-playground/react-native-firebase-email-authenticaton-in-an-Expo-project-2e 413 e9 a 4890</a>)添加一个<em class="ms">登录谷歌</em>按钮，一旦点击该按钮，用户通过谷歌认证，认证密钥将发送到Firebase，以在Firebase上创建/认证用户。一旦在Firebase上通过身份验证，用户就会被导航到一个“登录屏幕”。</p><h1 id="b598" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">先决条件</h1><p id="c3ba" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">在开始之前，您需要一个带有电子邮件/密码登录方法和(至少)Google签名方法的认证工作流的工作Firebase项目</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/0f5e267e9f48c1ff8b2756673906e1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEbgPXRPBbiqr6ydjP9Wcw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Enable Google Provider in Firebase Authentication</figcaption></figure><p id="6bb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还需要在Google开发者控制台中创建OAuth 2.0客户端ID(本指南遵循Expo Google API文档(<a class="ae lo" href="https://docs.expo.io/versions/latest/sdk/google/" rel="noopener ugc nofollow" target="_blank">https://docs.expo.io/versions/latest/sdk/google/</a>部分“在Expo应用程序中使用它”):</p><ul class=""><li id="d977" class="nc nd iq ka b kb kc kf kg kj ne kn nf kr ng kv nh ni nj nk bi translated">前往谷歌开发者控制台凭证(【https://console.developers.google.com/apis/credentials】T2)，如果需要，创建一个新的应用程序</li><li id="c0eb" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">单击“创建凭据”，然后单击“OAuth客户端ID”并遵循程序</li><li id="53d0" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">创建IOS OAuth客户端id和Android OAuth客户端ID</li><li id="bc84" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">对于IOS，唯一需要的信息是“捆绑包标识符”，将其设置为</li></ul><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="0d6b" class="nv lq iq nr b gy nw nx l ny nz">host.exp.exponent</span></pre><ul class=""><li id="cad6" class="nc nd iq ka b kb kc kf kg kj ne kn nf kr ng kv nh ni nj nk bi translated">对于Android，将“包名”设置为:</li></ul><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="f555" class="nv lq iq nr b gy nw nx l ny nz">host.exp.exponent</span></pre><ul class=""><li id="d267" class="nc nd iq ka b kb kc kf kg kj ne kn nf kr ng kv nh ni nj nk bi translated">还生成一个指纹，在终端运行以下命令</li></ul><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="6970" class="nv lq iq nr b gy nw nx l ny nz">openssl rand -base64 32 | openssl sha1 -c</span></pre><ul class=""><li id="e956" class="nc nd iq ka b kb kc kf kg kj ne kn nf kr ng kv nh ni nj nk bi translated">将上述命令的输出粘贴到“签名证书指纹”中</li><li id="6c81" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">在这两种情况下，一旦您单击create，您将收到一个客户端ID，请记下它，它将用于应用程序配置和Firebase</li></ul><p id="1b81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦你有了Android和IOS的客户端ID，它们就可以被添加到app.json的额外部分</p><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="f37f" class="nv lq iq nr b gy nw nx l ny nz">"extra": {</span><span id="d7ec" class="nv lq iq nr b gy oa nx l ny nz">"IOS_KEY": "&lt;generated_client_id&gt;",</span><span id="168c" class="nv lq iq nr b gy oa nx l ny nz">"ANDROID_KEY": "&lt;generated_client_id&gt;",</span><span id="a1ab" class="nv lq iq nr b gy oa nx l ny nz">...<br/>}</span></pre><p id="96f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了让Firebase与您的应用程序正常工作，请将这些客户端ID添加到Firebase中Google配置的外部客户端ID白名单中</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/db5330d36d1ff79c422313aa1f0dd0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fB-teeYuc5ITWatlMQwLdg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Add both client id to whitelist</figcaption></figure><p id="9b4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记住，这种配置将只在Expo的开发过程中工作，当构建一个独立的应用程序时，您需要做一些调整(稍后将详细介绍)</p><p id="01f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的应用程序中，我们安装了谷歌依赖项</p><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="2025" class="nv lq iq nr b gy nw nx l ny nz">expo install expo-google-app-auth</span></pre><p id="de63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们假设您已经安装了Firebase依赖项和所有其他需要的库(导航、react-native-paper等等)，如果没有，请参考我之前的指南= &gt;<a class="ae lo" href="https://medium.com/react-native-playground/react-native-firebase-email-authenticaton-in-an-expo-project-2e413e9a4890" rel="noopener"><strong class="ka ir">https://medium . com/react-native-playground/react-native-Firebase-email-authenticaton-in-an-Expo-project-2e 413 e9 a 4890</strong></a></p><p id="40e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一切配置妥当后，我们就可以开始为登录编写Google扩展了。</p><h1 id="56da" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">App.js</h1><p id="ab17" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">在App.js中，我们开始添加所需的导入:</p><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="8604" class="nv lq iq nr b gy nw nx l ny nz">import Constants from 'expo-constants'; //So we can read app.json extra<br/>import * as Google from 'expo-google-app-auth'; //google auth libraries<br/>import firebase from 'firebase'; //basic firebase<br/>import Firebase from './Firebase'; //This is the initialized Firebase, you can find it in my GitHub</span></pre><p id="0093" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们添加一个函数来登录Google，只是一个基本的Google登录和一个后续的Firebase登录</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="17e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此登录功能导出到上下文中的其他组件:</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="86a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以在中使用新的登录系统了</p><h1 id="f443" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">LoginScreen.js</h1><p id="96dc" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">在LoginScreen.js中，我们从上下文中“导入”登录函数</p><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="f646" class="nv lq iq nr b gy nw nx l ny nz">const { handleGLogin } = useContext(mainContext);</span></pre><p id="6ac1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们创建一个按钮来登录谷歌</p><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="ac9f" class="nv lq iq nr b gy nw nx l ny nz">&lt;Button <br/> style={{ backgroundColor: '#4285F4', marginTop: 20 }}<br/> onPress={() =&gt; handleGLogin()}<br/> mode="contained"<br/> icon="google"<br/>&gt;<br/>Login with Google<br/>&lt;/Button&gt;</span></pre><p id="7194" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一点上，应用程序应该显示与谷歌按钮登录，如果一切都正确设置按钮应该让用户登录，并添加到Firebase的谷歌用户，如果不存在。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/af14fad2e91b669eef662c743f9c63a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*_0H8DjIP6OgQ2RweWIO7Sg.png"/></div></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c495795dcf39ff4cf4cc950e9589ee9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*DPYKm1_yPLCKEz_073UM5Q.png"/></div></figure><h1 id="cefc" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">土豆太郎</h1><p id="1dba" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">目前，所有的错误信息都没有得到处理</p><h1 id="eeb6" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">上线</h1><p id="1264" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">当应用程序在Expo中正确运行时，无需代码重构即可创建独立版本，只需在应用程序和Google develper控制台中添加一些信息:</p><h2 id="0ced" class="nv lq iq bd lr oe of dn lv og oh dp lz kj oi oj md kn ok ol mh kr om on ml oo bi translated">适用于Android</h2><ul class=""><li id="2492" class="nc nd iq ka b kb mn kf mo kj op kn oq kr or kv nh ni nj nk bi translated">在<code class="fe os ot ou nr b">app.json</code>中添加正确的<code class="fe os ot ou nr b">package.name</code>(例如com.mycompany.myapp)</li><li id="2165" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">从您的项目构建一个apk</li><li id="9975" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">用<code class="fe os ot ou nr b">expo fetch:android:hashes</code>创建谷歌证书指纹并复制</li><li id="72f4" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">转到<a class="ae lo" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">谷歌开发者证书</a></li><li id="09e4" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">单击Create credentials，然后单击API Key，最后在弹出的模式中单击RESTRICT KEY。</li><li id="a890" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">点击键限制下的Android apps单选按钮，然后点击+添加包名和指纹。</li><li id="1160" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">救援</li><li id="40ab" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">单击创建凭据，然后单击OAuth客户端ID，然后选择Android单选按钮。</li><li id="80d0" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">用与上面相同的数据填充签名证书指纹字段和包名称字段</li><li id="e222" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">转到<a class="ae lo" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">谷歌开发者证书</a>并找到你的API密匙。</li><li id="68f3" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">打开<code class="fe os ot ou nr b">app.json</code>并将你的谷歌API密钥添加到<code class="fe os ot ou nr b">android.config.googleSignIn.apiKey</code></li><li id="99dc" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">从上面取<code class="fe os ot ou nr b">Google Certificate Hash</code>，添加到<code class="fe os ot ou nr b">android.config.googleSignIn.certificateHash</code>下的<code class="fe os ot ou nr b">app.json</code></li><li id="c5ad" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">当您使用<code class="fe os ot ou nr b">Google.logInAsync(..)</code>时，传入OAuth客户端ID作为<code class="fe os ot ou nr b">androidStandaloneAppClientId</code>选项</li></ul><pre class="mu mv mw mx gt nq nr ns nt aw nu bi"><span id="c560" class="nv lq iq nr b gy nw nx l ny nz">const result = await Google.logInAsync({ //CHANGE (or add) standalone keys here</span><span id="cb00" class="nv lq iq nr b gy oa nx l ny nz">iosStandaloneAppClientId: Constants.manifest.extra.IOS_STANDALONE_KEY,</span><span id="939d" class="nv lq iq nr b gy oa nx l ny nz">androidStandaloneAppClientId: Constants.manifest.extra.ANDROID_STANDALONE_KEY,</span><span id="ea6b" class="nv lq iq nr b gy oa nx l ny nz">});</span></pre><ul class=""><li id="ddb2" class="nc nd iq ka b kb kc kf kg kj ne kn nf kr ng kv nh ni nj nk bi translated">还要将OAuth客户机ID添加到Firebase中Google配置的外部客户机的白名单中</li></ul><h2 id="6571" class="nv lq iq bd lr oe of dn lv og oh dp lz kj oi oj md kn ok ol mh kr om on ml oo bi translated">适用于IOS</h2><ul class=""><li id="8dfd" class="nc nd iq ka b kb mn kf mo kj op kn oq kr or kv nh ni nj nk bi translated">如果你还没有<code class="fe os ot ou nr b">bundleIdentifier</code>的话，给你的<code class="fe os ot ou nr b">app.json</code>加一个。</li><li id="a5e8" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">打开浏览器进入<a class="ae lo" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">谷歌开发者证书</a></li><li id="8b3f" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">单击创建凭据，然后单击OAuth客户端ID，然后选择IOS。</li><li id="30da" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">在Bundle ID字段中输入您的<code class="fe os ot ou nr b">bundleIdentifier</code>,然后点击Create。</li><li id="dd0f" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">将给定的IOS URL方案添加到您的<code class="fe os ot ou nr b">app.json</code>中的<code class="fe os ot ou nr b">ios.config.googleSignIn.reservedClientId</code>下。</li><li id="c90a" class="nc nd iq ka b kb nl kf nm kj nn kn no kr np kv nh ni nj nk bi translated">在使用<code class="fe os ot ou nr b">Google.logInAsync</code>的地方，提供OAuth客户端ID作为<code class="fe os ot ou nr b">iosStandaloneAppClientId</code>选项(<em class="ms">见上面的</em>)。</li></ul><h2 id="5973" class="nv lq iq bd lr oe of dn lv og oh dp lz kj oi oj md kn ok ol mh kr om on ml oo bi translated">结论</h2><p id="9046" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">现在您可以重新构建应用程序了！</p><p id="4ccc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个项目需要帮助吗？在https://github.com/popeating/FirebaseLogin下载完整的项目</p><p id="6961" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在lennaz@gmail.com联系我</p></div></div>    
</body>
</html>