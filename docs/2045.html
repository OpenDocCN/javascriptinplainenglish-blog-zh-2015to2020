<html>
<head>
<title>How to cancel Fetch API requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何取消获取API请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/abort-requests-with-abortcontroller-in-fetch-api-7829c919c3f9?source=collection_archive---------4-----------------------#2020-05-15">https://javascript.plainenglish.io/abort-requests-with-abortcontroller-in-fetch-api-7829c919c3f9?source=collection_archive---------4-----------------------#2020-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cee433306d1e99d4cec4c5562b92b088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lq-AzqUXMXDfZyG5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@chilinik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nikita Kostrykin</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3db8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fetch API提供了一个获取资源的接口。直到2017年，我们都没有办法用这个API取消请求。然而，当一个名为AbortController的新接口引入时，情况发生了变化。</p><p id="adc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章将重点让你开始使用AbortController接口，以便在需要时中止请求。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="99c0" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">用例</h1><p id="95e9" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">让我们首先看一个基本的fetch实现和一个例子:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Simple fetch implementation</figcaption></figure><p id="9d79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上述沙盒只是在一个循环中运行获取请求。您可以点击“获取数据”按钮，一旦获取所有数据，结果将显示在卡片上。</p><p id="b8a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以打开开发人员工具来查看一个接一个的请求。目前没有办法中止正在进行的请求，我们必须等到所有的结果回来。这似乎是一个用例，用户可能想要取消长时间运行的请求，并参与应用程序的其他部分。</p><blockquote class="mr ms mt"><p id="060f" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">注意:上面的沙盒只是为了演示的目的，显示一些需要时间的请求。我们还不如利用<strong class="kf ir"> Promise.all </strong>同时发出多个请求，但这不是本文的重点。</p></blockquote></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="5882" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">介绍中止控制器</h1><p id="f16f" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在上面的代码中使用abortController之前，让我们先介绍一下它的一些语法基础。</p><p id="4d3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> AbortController </strong>接口代表一个控制器对象，允许您在需要时中止一个或多个Web请求。</p><p id="f264" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController/AbortController" rel="noopener ugc nofollow" target="_blank"> AbortController创建一个新的AbortController对象。AbortController() </a>构造函数。使用<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" rel="noopener ugc nofollow" target="_blank"> AbortSignal </a>对象完成与DOM请求的通信。</p><h2 id="e2e8" class="my lj iq bd lk mz na dn lo nb nc dp ls ko nd ne lw ks nf ng ma kw nh ni me nj bi translated">构造器</h2><blockquote class="mr ms mt"><p id="138f" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">中止控制器()</p><p id="6726" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">创建新的AbortController对象实例。</p></blockquote><h2 id="f0dc" class="my lj iq bd lk mz na dn lo nb nc dp ls ko nd ne lw ks nf ng ma kw nh ni me nj bi translated">性能</h2><blockquote class="mr ms mt"><p id="b9ee" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">AbortController.signal <strong class="kf ir">只读</strong></p><p id="ee68" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">返回一个<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" rel="noopener ugc nofollow" target="_blank"> AbortSignal </a>对象实例，该实例可用于与DOM请求通信或中止DOM请求。</p></blockquote><h2 id="141e" class="my lj iq bd lk mz na dn lo nb nc dp ls ko nd ne lw ks nf ng ma kw nh ni me nj bi translated">方法</h2><blockquote class="mr ms mt"><p id="13f9" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated"><a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController/abort" rel="noopener ugc nofollow" target="_blank">abort controller . abort()</a></p><p id="133b" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">在DOM请求完成之前中止它。这能够中止<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch" rel="noopener ugc nofollow" target="_blank">获取请求</a>，任何响应<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/Body" rel="noopener ugc nofollow" target="_blank">主体</a>和流的消耗。</p></blockquote><p id="6c36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基本完成了。现在让我们在前面的例子中使用AbortController。使用起来非常简单，所以我将在这里嵌入代码沙箱:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">AbortController in action</figcaption></figure><p id="12a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在此添加的内容:</p><ul class=""><li id="509a" class="nk nl iq kf b kg kh kk kl ko nm ks nn kw no la np nq nr ns bi translated">HTML中的取消按钮，用于取消正在进行的请求</li><li id="51d2" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">我们定义了AbortController实例，并提取了AbortSignal来控制与之关联的DOM请求。</li><li id="10b3" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">然后，我们将这个信号用于获取请求。</li><li id="831e" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">最后，单击“Cancel Request ”,我们添加了一个事件监听器，它在abort()方法的帮助下取消正在进行的请求。</li></ul><p id="bab9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">您会注意到，一旦您取消请求，只会生成该请求已处理的那些数量的卡，而不会发送任何进一步的请求。</strong></p><blockquote class="ny"><p id="28fe" class="nz oa iq bd ob oc od oe of og oh la dk translated"><strong class="ak">注意</strong>:当abort()被调用时，fetch() promise以一个名为AbortError的DOMException拒绝。</p></blockquote><p id="4b58" class="pw-post-body-paragraph kd ke iq kf b kg oi ki kj kk oj km kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">所有主流浏览器的支持看起来都很有希望:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/377fb2ea496663dbd7b5e7eeef4abc1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1mW9auom4erHhmnpOjSXA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Globally available in 90%+ browsers</figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="838a" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">资源</h1><div class="oo op gp gr oq or"><a href="https://caniuse.com/#feat=abortcontroller" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">我能用吗...HTML5、CSS3等的支持表</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">“我可以使用吗”提供了最新的浏览器支持表，以支持桌面和移动设备上的前端web技术…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">caniuse.com</p></div></div></div></a></div><div class="oo op gp gr oq or"><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">堕胎控制员</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">AbortController接口代表一个控制器对象，它允许您中止一个或多个Web请求，如和…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">developer.mozilla.org</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf jw or"/></div></div></a></div><h2 id="5672" class="my lj iq bd lk mz na dn lo nb nc dp ls ko nd ne lw ks nf ng ma kw nh ni me nj bi translated"><strong class="ak">简明英语团队的笔记</strong></h2><p id="9609" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">你知道我们有四种出版物吗？给他们一个关注来表达爱意吧:<a class="ae kc" href="https://medium.com/javascript-in-plain-english" rel="noopener"><strong class="kf ir">JavaScript in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ai-in-plain-english" rel="noopener"><strong class="kf ir">AI in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/ux-in-plain-english" rel="noopener"><strong class="kf ir">UX in Plain English</strong></a>，<a class="ae kc" href="https://medium.com/python-in-plain-english" rel="noopener"><strong class="kf ir">Python in Plain English</strong></a><strong class="kf ir"/>—谢谢，继续学习！我们还推出了一个YouTube，希望你能通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的英语频道</strong> </a>来支持我们</p><p id="10f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一如既往,“简明英语”希望帮助推广好的内容。如果您有一篇文章想要提交给我们的任何出版物，请发送电子邮件至<a class="ae kc" href="mailto:submissions@plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">submissions @ plain English . io</strong></a><strong class="kf ir"/>并附上您的媒体用户名和您感兴趣的内容，我们将会回复您！</p></div></div>    
</body>
</html>