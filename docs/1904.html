<html>
<head>
<title>How to Integrate Redux Thunk into your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Redux Thunk集成到您的React应用程序中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-integrate-redux-thunk-into-your-react-application-cd92b87c1629?source=collection_archive---------2-----------------------#2020-05-03">https://javascript.plainenglish.io/how-to-integrate-redux-thunk-into-your-react-application-cd92b87c1629?source=collection_archive---------2-----------------------#2020-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c80a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用redux thunk API进行异步API调用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b3f6327d28315e0fe86b6e2d3fafab90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xXxG_QiVWm7WrZXu"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@casparrubin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Caspar Camille Rubin</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="de4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将了解redux thunk以及将其集成到react应用程序中的步骤。所以让我们开始吧</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="03a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">什么是redux thunk，我们为什么需要它？</strong></p><p id="d7fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lz ma mb mc b">Redux thunk</code>是一个中间件，允许我们编写异步代码来与商店交互。</p><blockquote class="md me mf"><p id="423c" class="kw kx mg ky b kz la jr lb lc ld ju le mh lg lh li mi lk ll lm mj lo lp lq lr ij bi translated">因为reducer是一个纯函数，这意味着它不应该修改它的参数，也不应该产生副作用。此外，它应该同步工作，所以不建议在reducer内部调用异步API。</p></blockquote><p id="0818" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了解决这个问题，我们需要中间件，redux-thunk提供了一种方法。</p><p id="7cee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们从动作文件中调用API，只要我们需要API的响应就调用dispatch，而不是调用<code class="fe lz ma mb mc b">componentDidMount.</code>，这总是好的</p><p id="cf76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，从这里的<a class="ae kv" href="https://github.com/myogeshchavan97/react_node_optimized" rel="noopener ugc nofollow" target="_blank">克隆本文<a class="ae kv" href="https://medium.com/javascript-in-plain-english/how-to-optimize-react-app-for-production-and-deploy-it-to-heroku-498fbf222de?source=friends_link&amp;sk=9a2b48e4cafe7aaeca2cbd6f398d4f5d" rel="noopener">中创建的</a>存储库。</a></p><p id="cdc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">克隆完成后，通过依次运行以下命令来启动应用程序</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="fadf" class="mo mp iq mc b gy mq mr l ms mt">1. npm install<br/>2. npm run start</span></pre><p id="fcd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以通过导航到<a class="ae kv" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>来访问该应用程序</p><p id="efe6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过从终端运行以下命令来安装<code class="fe lz ma mb mc b">redux-thunk</code>库</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="588f" class="mo mp iq mc b gy mq mr l ms mt">npm install redux-thunk@2.3.0</span></pre><p id="71ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你打开<code class="fe lz ma mb mc b">src/app.js</code>，你会看到我们正在<code class="fe lz ma mb mc b">componentDidMount</code>内部进行API调用，所以我们将把这个API调用移动到动作文件中。</p><p id="0695" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe lz ma mb mc b">store/store.js</code>并添加让我们添加<code class="fe lz ma mb mc b">redux-thunk</code>支持，这样我们就可以使用它。</p><p id="a1af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为<code class="fe lz ma mb mc b">redux-thunk</code>添加导入</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="9127" class="mo mp iq mc b gy mq mr l ms mt">import thunk from "redux-thunk";</span></pre><p id="1bdb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，<code class="fe lz ma mb mc b">thunk</code>是默认的导出，所以我们可以随意命名，比如</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="00b2" class="mo mp iq mc b gy mq mr l ms mt">import reduxThunk from "redux-thunk";</span></pre><p id="bdad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从redux导入<code class="fe lz ma mb mc b">applyMiddleware</code>并在<code class="fe lz ma mb mc b">createStore</code>功能中使用</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="2d10" class="mo mp iq mc b gy mq mr l ms mt">const store = createStore(usersReducer, applyMiddleware(thunk));</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/f462b582a069fd49c72ac0178462f03c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vt6L2J3aKh6dsSvNjbeqBQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">store.js</figcaption></figure><p id="6a40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以现在我们已经配置了我们的商店来使用<code class="fe lz ma mb mc b">redux-thunk</code>中间件。</p><p id="3506" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe lz ma mb mc b">src/actions/users.js</code>添加一个函数进行API调用。</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="0e1b" class="mo mp iq mc b gy mq mr l ms mt">export const initiateAddUsers = () =&gt; {<br/> return (dispatch) =&gt; {<br/>  axios.get("/users").then((response) =&gt; {<br/>   console.log(response.data);<br/>   dispatch(addUsers(response.data.results));<br/>  });<br/> };<br/>};</span></pre><p id="0166" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，导入顶部的<code class="fe lz ma mb mc b">axios</code></p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="3b39" class="mo mp iq mc b gy mq mr l ms mt">import axios from "axios";</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/72568f507f7caab6d935b187db746414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ji3rwLRY9sYeprAi3IJVPw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">users.js</figcaption></figure><p id="8d2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你注意到，以前我们有返回一个对象的<code class="fe lz ma mb mc b">addUsers</code>动作生成器。当我们像这样从<code class="fe lz ma mb mc b">app.js</code>调用<code class="fe lz ma mb mc b">store.dispatch</code>方法时，这个动作对象被发送到reducer</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="6aef" class="mo mp iq mc b gy mq mr l ms mt">store.dispatch(addUsers(response.data.results));</span></pre><p id="b5cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们已经添加了<code class="fe lz ma mb mc b">initiateAddUsers</code>函数，它将<em class="mg">返回一个接受<code class="fe lz ma mb mc b">dispatch</code>作为参数的函数</em>，一旦它接收到来自<code class="fe lz ma mb mc b">/users</code> API的响应，它将调用我们的常规<code class="fe lz ma mb mc b">addUsers</code>动作生成器，该生成器将把动作发送给我们的<code class="fe lz ma mb mc b">usersReducer</code>，并且它将更新redux存储。</p><p id="50f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe lz ma mb mc b">src/app.js</code>，添加<code class="fe lz ma mb mc b">initiateAddUsers</code>函数的导入，在<code class="fe lz ma mb mc b">componentDidMount</code>方法中调用<code class="fe lz ma mb mc b">initiateAddUsers</code>函数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/26b3b1566e62a6ccd8777f6ef48fb32c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4Qnwii5kkZRTfLQy0AxIQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">app.js</figcaption></figure><p id="c96a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>我们能够从<code class="fe lz ma mb mc b">actions/users.js</code>中的<code class="fe lz ma mb mc b">initiateAddUsers</code>函数返回一个自动传递了<code class="fe lz ma mb mc b">dispatch</code>参数的函数，只是因为我们在<code class="fe lz ma mb mc b">store.js</code>文件中添加了<code class="fe lz ma mb mc b">redux-thunk</code>作为中间件</p><pre class="kg kh ki kj gt mk mc ml mm aw mn bi"><span id="3f88" class="mo mp iq mc b gy mq mr l ms mt">const store = createStore(usersReducer, applyMiddleware(thunk));</span></pre><p id="f854" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，通过重新运行<code class="fe lz ma mb mc b">npm run start</code>命令重启应用程序，应用程序仍将像以前一样工作。唯一的区别是，我们现在已经将API调用从组件转移到动作文件，并使用<code class="fe lz ma mb mc b">redux-thunk</code>来管理它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/df3d19cd7db3313eddb83510d9089095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEOFhdEkHrmGiQJrWuzgJg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Application</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="7120" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">配置redux开发工具</strong></p><p id="ae2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想看到存储的数据和分派给reducer的动作，你可以从<a class="ae kv" href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en" rel="noopener ugc nofollow" target="_blank">这里</a>为chrome安装<code class="fe lz ma mb mc b">redux devtools</code></p><p id="36a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装完成后，打开<code class="fe lz ma mb mc b">chrome developer toolbar</code>并点击<code class="fe lz ma mb mc b">Redux</code>选项卡，您将看到以下消息</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/aedb846d7259ffd3fcad74eabccc4bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9xP-03VzKhzyIiHqey_7Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">No store found message in redux devtools</figcaption></figure><p id="0914" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">消息说我们没有存储，因为我们需要将开发工具配置添加到我们的代码中</p><p id="7037" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<strong class="ky ir">说明</strong>链接，向下滚动到<code class="fe lz ma mb mc b">"Advanced store setup" </code>部分<a class="ae kv" href="https://github.com/zalmoxisus/redux-devtools-extension#user-content-12-advanced-store-setup" rel="noopener ugc nofollow" target="_blank">此处</a></p><p id="f5ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们对我们的应用程序进行这些配置更改。</p><p id="f3ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe lz ma mb mc b">store/store.js</code>和<code class="fe lz ma mb mc b">composeEnhancers</code>代码</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/39098973bd13366ef06fad2fdef4e817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPLe6wthDsIfHbUsDIIygA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">store.js</figcaption></figure><p id="5047" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，通过重新运行<code class="fe lz ma mb mc b">npm run start</code>命令重启应用程序，并检查redux选项卡。您将在左侧部分看到调度动作<code class="fe lz ma mb mc b">ADD_USERS</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/b15cd32c63b5ffe2b30acbb3c9e36429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7j8X8y-i0HnV5aZ9khgO9A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">redux devtool</figcaption></figure><p id="374b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击右侧部分的<code class="fe lz ma mb mc b">state</code>子菜单(默认选择<code class="fe lz ma mb mc b">Diff</code>),您将看到redux store中添加的所有数据</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/05abc167e9535eda85901c156281f9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRFssfpt-RnfQc-KfsCM6Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Redux store data</figcaption></figure><p id="6e06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里找到这个应用程序的完整源代码</p><p id="2bf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天到此为止。我希望你学到了新东西。</p><p id="5b65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">别忘了订阅我的每周时事通讯，里面有惊人的技巧、窍门和文章，直接在你的收件箱</strong> <a class="ae kv" href="https://yogeshchavan.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">这里。</strong>T13】</a></p></div></div>    
</body>
</html>