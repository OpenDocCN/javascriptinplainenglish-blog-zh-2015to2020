<html>
<head>
<title>A Google Apps Script Example Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Apps脚本示例项目</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/apps-script-example-project-get-the-number-of-emails-with-a-specific-label-d7e1fb2e998b?source=collection_archive---------5-----------------------#2020-12-13">https://javascript.plainenglish.io/apps-script-example-project-get-the-number-of-emails-with-a-specific-label-d7e1fb2e998b?source=collection_archive---------5-----------------------#2020-12-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="51ff" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">获取带有特定标签的电子邮件数量</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/791fe97061867d87a1a0c5621a3deddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TqGCs7TYeRPFZoB5"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@andreasdress?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andreas Dress</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e274" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">软件开发很难。这条推文说明了专业开发人员有时是如何看待他们的工作的:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/019d729ebe51cba1c3969754e0a481d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/0*dKYifVhGB0BPeNGJ"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://twitter.com/catalinmpit/status/1327533237065969666" rel="noopener ugc nofollow" target="_blank">https://twitter.com/catalinmpit/status/1327533237065969666</a></figcaption></figure><p id="24a9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">事情并不总是这样。在这篇文章中，我将展示一个<em class="lq">公民开发者</em>如何使用Google Apps脚本快速从想法转变为可行的解决方案。</p><p id="cfcd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lq">公民开发者是指使用公司IT认可的开发和运行时环境创建新的业务应用程序供他人使用的用户。过去，最终用户应用程序开发通常局限于使用Microsoft Excel和Access等工具构建的单用户或工作组解决方案。然而，今天，最终用户可以使用共享服务、第四代语言(4GL)风格的开发平台和云计算服务来构建部门、企业甚至公共应用。(</em><a class="ae ks" href="https://www.gartner.com/en/information-technology/glossary/citizen-developer" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://www . Gartner . com/en/information-technology/glossary/citizen-developer</em></a><em class="lq">)</em></p><p id="8e4f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对我来说,<em class="lq">公民开发者</em>可以是任何发现Google Apps脚本的人。这篇文章就是从这个角度写的。我不会讨论使代码健壮和可维护所需做的所有事情。你写代码，你对使用和生命周期负责。</p><h1 id="e135" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">从用例到应用程序</h1><p id="45ca" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">第一步是理解用例。这意味着提出正确的问题。前景是自动化一些可以手动完成的事情。对于公民开发者来说，从这里开始非常重要。</p><p id="4c2c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在示例用例中，我们希望记录在某个时间段内具有某个标签的电子邮件的数量。这些信息应该记录在谷歌表。</p><p id="c248" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我们打开这个，我们会得到:</p><ol class=""><li id="47c4" class="mo mp in kv b kw kx kz la lc mq lg mr lk ms lo mt mu mv mw bi translated">统计一段时间内收到的带有标签的电子邮件数量</li><li id="fc2c" class="mo mp in kv b kw mx kz my lc mz lg na lk nb lo mt mu mv mw bi translated">将这些信息记录在谷歌表单中</li></ol><p id="3abb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一步是手动重现这些步骤。这里唯一的挑战是统计电子邮件。因此，我们确保可以手动完成这项工作:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/94073fd2e6b3fb9893f68a50c195747c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZsbQ_C-_aeRa3qAA"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Gmail screenshot of the search window</figcaption></figure><p id="3ddc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦我们确定我们可以手动完成所有的步骤，我们需要把它翻译成代码。这就是Google Apps脚本文档的用处(<a class="ae ks" href="https://developers.google.com/apps-script" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/apps-script</a>)。</p><p id="3546" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我们的例子中，我们可以从Gmail推送信息，或者将信息拉进Google表单。为了获得更好的想法，我们可以看看指南<a class="ae ks" href="https://developers.google.com/apps-script/overview" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/apps-script/overview</a>中的“扩展谷歌工作空间”部分。这里没有提到Gmail，但是提到了Google Sheets。</p><p id="73aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们有几个选择。我们要么通读整份文件(<a class="ae ks" href="https://developers.google.com/apps-script/guides/sheets" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/apps-script/guides/sheets</a>)并试着理解，要么浏览文件并试着找到一些我们可以开始的东西。我通常选择最后一个选项。在这种情况下，第一步是:</p><p id="306e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">"要创建一个绑定脚本，从谷歌工作表中选择<strong class="kv io">工具&gt;脚本编辑器</strong>"</p><p id="b21c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">和一些将向工作表写入内容的代码:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="beb1" class="ni ls in ne b gy nj nk l nl nm">function addProduct() {<br/>  var sheet = SpreadsheetApp.getActiveSheet();          <br/>  sheet.appendRow([‘Cotton Sweatshirt XL’, ‘css004’]);<br/>}</span></pre><h2 id="d3b8" class="ni ls in bd lt nn no dn lx np nq dp mb lc nr ns md lg nt nu mf lk nv nw mh nx bi translated">手放在床单上</h2><p id="b492" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">因此，我们创建一个工作表并打开脚本编辑器。或者您可以创建一份此表的副本:<a class="ae ks" href="https://docs.google.com/spreadsheets/d/19N5nkEi-1q1i3QLRhYsZ6EULv0Uizr27E87kMCLKyKI/edit#gid=0" rel="noopener ugc nofollow" target="_blank">文章示例项目—测量电子邮件标签的数量</a></p><p id="85c4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">打开编辑器后，将代码粘贴到编辑器中。当我们运行代码时，我们得到一个结果:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/9b26535ada5ca6b8f416f3a83885b465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/0*z1D6BBJk-NLw7EPP"/></div></div></figure><p id="3f69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们把它变得更像最终结果:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="9ead" class="ni ls in ne b gy nj nk l nl nm">function countEmails() {<br/>  var sheet = SpreadsheetApp.getActiveSheet();<br/>  sheet.appendRow([‘apps-script’, 155]);<br/>}</span></pre><p id="90ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我们运行代码时，我们看到标签和计数。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nz"><img src="../Images/e825c7254435ae17d52735bcb548ca09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*81xD2byCFk8-Gi3m"/></div></div></figure><h2 id="fa9b" class="ni ls in bd lt nn no dn lx np nq dp mb lc nr ns md lg nt nu mf lk nv nw mh nx bi translated">动手吧，开始计数</h2><p id="3f41" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">下一步是从邮件中获取实际的计数。这需要对Apps脚本中的服务有一点了解。打开参考页面上的Google Workspace Services部分(<a class="ae ks" href="https://developers.google.com/apps-script/reference" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/apps-script/reference</a>)。我们想用Gmail做点什么，所以让我们打开GmailApp页面。</p><p id="4c0d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是一个棘手的部分。这里我们需要将手动操作映射到应用程序脚本代码。这可能需要一些时间来发现。在我们的例子中，我们进行搜索，我们可以使用:<a class="ae ks" href="https://developers.google.com/apps-script/reference/gmail/gmail-app#search(String)" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/apps-script/reference/Gmail/Gmail-app # search(String)</a></p><p id="1cf0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们已经有了查询，所以我们可以这样尝试:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="0055" class="ni ls in ne b gy nj nk l nl nm">function myFunction() {</span><span id="6955" class="ni ls in ne b gy oa nk l nl nm">  var threads = GmailApp.search(‘label:apps-script after:2020/10/18  before:2020/11/2 ‘);</span><span id="468c" class="ni ls in ne b gy oa nk l nl nm">  console.log(threads.length)</span><span id="6af5" class="ni ls in ne b gy oa nk l nl nm">}</span></pre><p id="be1b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">确保用您自己的工作查询替换我的查询</p><p id="c166" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有两个新东西，console.log()和threads.length()。相信我，再运行一次代码。</p><h2 id="be0b" class="ni ls in bd lt nn no dn lx np nq dp mb lc nr ns md lg nt nu mf lk nv nw mh nx bi translated">双手合十，齐心协力</h2><p id="23df" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">我们的脚步是</p><ol class=""><li id="b97c" class="mo mp in kv b kw kx kz la lc mq lg mr lk ms lo mt mu mv mw bi translated">统计一段时间内收到的带有标签的电子邮件数量</li><li id="a178" class="mo mp in kv b kw mx kz my lc mz lg na lk nb lo mt mu mv mw bi translated">将这些信息记录在谷歌表单中</li></ol><p id="2dd5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">也就是说:</p><pre class="kd ke kf kg gt nd ne nf ng aw nh bi"><span id="caf0" class="ni ls in ne b gy nj nk l nl nm">function countEmails2() {</span><span id="6e16" class="ni ls in ne b gy oa nk l nl nm">  var threads = GmailApp.search(‘label:apps-script after:2020/10/18 before:2020/11/2 ‘);<br/>  var sheet = SpreadsheetApp.getActiveSheet()</span><span id="521e" class="ni ls in ne b gy oa nk l nl nm">  sheet.appendRow([‘apps-script’, threads.length]);</span><span id="9e3f" class="ni ls in ne b gy oa nk l nl nm">}</span></pre><h1 id="1ab0" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">包扎</h1><p id="83a9" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">在这篇文章中，我讨论了一个<em class="lq">公民开发者</em>可以采取的快速自动化任务的步骤。目标不是编写漂亮的可维护代码，而是将手工任务分解成可以编程的步骤。这样，流程就变得简单且易于管理。</p></div></div>    
</body>
</html>