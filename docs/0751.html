<html>
<head>
<title>Calculating Azimuth, Distance, and Altitude from a Pair of GPS Locations in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript从一对GPS位置计算方位角、距离和高度</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/calculating-azimuth-distance-and-altitude-from-a-pair-of-gps-locations-36b4325d8ab0?source=collection_archive---------0-----------------------#2019-12-05">https://javascript.plainenglish.io/calculating-azimuth-distance-and-altitude-from-a-pair-of-gps-locations-36b4325d8ab0?source=collection_archive---------0-----------------------#2019-12-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7118" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个寻找你的无人机或瞄准卫星天线的算法，带有JavaScript示例代码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/38bd0b7df2ea66b846884afcf4a47711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9QViUdhbDSrmNYS7"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@wizwow?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Donald Giannatti</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a2b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设你正站在地球上的某个地方，地球上有另一个地方你想面对、接近或用望远镜瞄准。如果您有这两个位置的GPS坐标(纬度、经度和海拔),我将向您展示一种算法，用于计算将您的起点指向该目标点的两个方向角。此外，该算法还会计算两点之间的距离。我还提供了一个基于web的计算器，它使用开源的JavaScript代码实现了这个算法。</p><h2 id="4c4a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">输入</h2><p id="96a0" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了执行计算，该算法需要两个点的三个坐标，总共六个数字。你所站的点称为a点。要观察的目标点是b点。对于这两个点，你都需要:</p><ul class=""><li id="2920" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">纬度</strong>:该点在地球赤道以北或以南多少度。正值为赤道以北，负值为赤道以南。</li><li id="7452" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><strong class="ky ir">经度</strong>:该点距离英国格林威治本初子午线东(正)或西(负)多少度。</li><li id="a686" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><strong class="ky ir">高程</strong>:该点高于(正)或低于(负)平均海平面的高度，单位为米。</li></ul><h2 id="a1d1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">地球静止卫星</h2><p id="1448" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你的目标位置是地球同步卫星，这个算法也是有效的。所有地球静止卫星都在地球赤道(纬度= 0度)正上方的轨道上运行，高度为35，786，000米。因为纬度和海拔已经知道，唯一缺少的是卫星的经度。我的在线计算器有一个地球同步卫星的复选框，使这种情况更容易。启用该复选框后，您只需输入卫星的经度。人们已经利用这一功能来帮助瞄准卫星天线。</p><h2 id="e28f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">输出</h2><p id="7318" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">给定两组坐标，该算法计算以下量:</p><ul class=""><li id="3762" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">方位角</strong>:从a点看B点的罗盘方向，这是一个0到360度的数字。值0表示北，90表示东，180表示南，270表示西。</li><li id="7ab7" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><strong class="ky ir">高度</strong>:这是观察者在a点看到的B点地平线以上(正)或以下(负)的角度。不要与上面定义的高度输入相混淆。</li><li id="bac2" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><strong class="ky ir">距离</strong>:A点到B点的直线距离(不是绕地球的距离)，单位为公里。</li></ul><h2 id="68a8" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">它是如何工作的</h2><p id="3dfd" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">该算法做的第一件事是将点A和点B转换为笛卡尔坐标(<em class="ne"> x </em>、<em class="ne"> y </em>、<em class="ne"> z </em>)。由于地球不是一个完美的球体，这就变得复杂了。由于旋转，地球在赤道处凸出，形成一个被称为<em class="ne">扁球体</em>的形状。两极之间的距离是6357公里，但是一个直径穿过赤道的距离是6378公里。考虑这个图，其中为了说明的目的，膨胀被夸大了:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/fe797a0145543671465c9ec9caa767f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CiTbXKGUrfxE4hDm79Jdew.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Geocentric latitude <em class="ng">θ is not the same as geodetic latitude φ on the oblate Earth.</em></figcaption></figure><p id="b56a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，<em class="ne"> X </em>是地球表面的一点，<em class="ne"> N </em>是北极，<em class="ne"> S </em>是南极，<em class="ne"> C </em>是地心。赤道由穿过<em class="ne"> C </em>的水平线表示。想象你正站在点<em class="ne"> X </em>。那里与地球相切的虚线表示你当地的地平线。</p><p id="d187" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与你的地平线垂直的是另一条进入地球的虚线。在那条虚线接触地球赤道平面的地方，你会看到一个标有<em class="ne"> φ </em>的角度(希腊字母<em class="ne">φ</em>)。这个角度叫做<em class="ne">大地纬度</em>。这就是GPS报的那种纬度。</p><p id="941c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">的确，大地纬度是自古以来使用的经典纬度。粗略地说，它表示一个天文学测量的纬度:它是北天极(北极星附近天空中的一点)在你当地地平线以上的角度。如果你站在地球的北极，北极星会笔直向上，或者说与地平线成90度。同样，如果你站在赤道上，北极星将在地平线上，或地平线以上0度。因此，在夜空晴朗的情况下，任何水手都可以直接测量大地纬度。</p><p id="719f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，要计算出<em class="ne"> X </em>相对于地球中心<em class="ne"> C </em>的笛卡尔坐标，计算器需要<em class="ne">地心纬度</em>，在图中用<em class="ne"> θ </em>(希腊字母<em class="ne">θ</em>表示。这是从<em class="ne"> C </em>看到的赤道和<em class="ne"> X </em>之间的角度。转换基于世界大地测量系统标准<a class="ae kv" href="https://en.wikipedia.org/wiki/World_Geodetic_System" rel="noopener ugc nofollow" target="_blank"> WGS 84 </a>。在计算器中，这在函数<code class="fe nh ni nj nk b">GeocentricLatitude</code>中实现，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b45f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，从地球中心到地球表面某一点的距离也是可变的。函数<code class="fe nh ni nj nk b">EarthRadiusInMeters</code>根据大地纬度计算该距离，同样使用WGS 84:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8ea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有趣的是，当你在赤道上时，地心纬度和大地纬度是一样的:都是0度。如果你在地球的两极，这两种纬度也是一样的:+90度或-90度。但是在地球上的其他地方，他们的分歧程度不同。</p><p id="c88f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">计算器使用函数<code class="fe nh ni nj nk b">LocationToPoint</code>计算一个点的笛卡尔坐标，给出它的大地纬度、经度和海拔。该函数还计算给定点的法向量，即垂直于观察者地平线的向上方向，以正确调整平均海平面以上的高程。产生的矢量分量都用米表示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="57a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了完成计算，算法使用了一个技巧。它旋转坐标系，使观测点(A点)位于假想的赤道和本初子午线上。换句话说，想象旋转你拿着的地球仪，这样你的观察点就在赤道上，并且正对着你。现在的坐标非常适合于计算观察者在A点看到的方位角和高度角:</p><ul class=""><li id="9c24" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><em class="ne"> x </em>轴指向正上方(从地球中心向外)。</li><li id="7468" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">y轴指向正东方向。</li><li id="7f57" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">z轴指向正北。</li></ul><p id="0ae6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是旋转功能<code class="fe nh ni nj nk b">RotateGlobe</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3ff1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nh ni nj nk b">RotateGlobe</code>旋转坐标系后，你可以从旋转的地球仪上的A点到同一个旋转的地球仪上的B点，通过三维空间画一条线。这条线通常会穿过地球，假设A和B都在地球表面或接近地球表面。使用三角函数和矢量点积的组合，计算器确定方位角和高度角。它使用毕达哥拉斯公式来确定两点之间的直线距离。</p><p id="b842" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有的代码都可以在下面的链接中找到。</p><h2 id="453d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">资源</h2><ul class=""><li id="132c" class="mq mr iq ky b kz ml lc mm lf nn lj no ln np lr mv mw mx my bi translated"><a class="ae kv" href="https://doncross.net/geocalc/compass.html" rel="noopener ugc nofollow" target="_blank">在线计算器</a>:允许您在浏览器中进行计算。</li><li id="62c9" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/cosinekitty/geocalc" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>:包含计算器的完整HTML和JavaScript代码。</li></ul><h2 id="4b9d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">示例用途</h2><p id="7944" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这里有三个例子，说明人们是如何将我的JavaScript代码用于有趣的项目的。(照片和姓名均经个人通信许可使用。)</p><h2 id="1a71" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">例子#1:国际空间站指针</h2><p id="f479" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">来自波恩-莱茵-锡格河应用科技大学的Jan Steinberg和他的同事使用该算法建造了一个总是指向国际空间站的设备。通过计算国际空间站的轨道并使用该设备在地面上的已知位置，计算机将这两个位置转换为方位角和高度角。它使用步进电机来实时定位指针。</p><div class="kg kh ki kj gt ab cb"><figure class="nq kk nr ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/d27e5da0f9751f4c4bd20d0c8de1712c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*PZC6uY_Myl8_DvG5FJlU_g.jpeg"/></div></figure><figure class="nq kk nr ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/945c399f4d1e74609622e4dcefe05455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*F7rwjy2lkhzkfX6Mn1wNiA.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk nw di nx ny">ISS Pointer project by A. Busch, R. Pick, M. Schmidt, J. Steinberg; Bonn-Rhein-Sieg University of Applied Sciences, Germany.</figcaption></figure></div><h2 id="e1e4" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">例2:翼形望远镜</h2><p id="f282" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">来自加州门多西诺的里克·黑明斯使用高度/方位计算器页面构建了一个指向全球各个城市的雕塑。这座雕塑以正确的方位角和高度角直接指向其他城市，向下穿过地球。他为这个项目创造了“pterrascope”这个词。</p><div class="kg kh ki kj gt ab cb"><figure class="nq kk nz ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/946390b392e73d1b92eeb0138857581f.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*RR83NH5EOdLZqCQ9W3fgeA.jpeg"/></div></figure><figure class="nq kk oa ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/6769a9e3c6e44479cfabe403266e67b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*gXgt9676apf-M_kGF_wjow.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk ob di oc ny">Calculations and assembly of Rick Hemming’s pterrascope.</figcaption></figure></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/23ea81a69dd2b8af36e334927adaaa08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ehe4mkSLDi0LYeNbWoJ1nw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Completed pterrascope by Rick Hemmings; Mendocino, California.</figcaption></figure><h2 id="8636" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">例3:月出照片</h2><p id="6934" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><a class="ae kv" href="http://www.facebook.com/astronomiforalle" rel="noopener ugc nofollow" target="_blank">来自挪威Sola的Ole jrgen nord Hagen</a>使用方位角/距离计算器计算出在选定的地球物体后面何时何地拍摄月亮和太阳的照片。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/295250586cc41ae638163167c20b642d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UU8ui7D38oM2DZZZZBCi0Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Moon rising behind Ullandhaugtårnet in Stavanger; by Ole Jørgen Nordhagen.</figcaption></figure><h2 id="aebc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">其他示例</h2><ul class=""><li id="419d" class="mq mr iq ky b kz ml lc mm lf nn lj no ln np lr mv mw mx my bi translated">如果你有一架广播其GPS坐标的无人机，并且你有一个告诉你自己的GPS坐标的设备，你可以自动计算你的无人机的方向和范围。一个人给我发电子邮件说，当他的无人机降落在可见范围之外时，他用这种技术来定位它。</li><li id="2482" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">一个赛船的人用我的工具来帮助规划通过比赛所需航路点的路线。</li><li id="8d7e" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">一位微波天线技术人员用我的工具帮助将微波中继器从一座塔对准另一座塔。</li><li id="8163" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">一位卫星天线安装人员说，我的工具有助于将天线对准特定的卫星。我根据他的建议加了“地球静止卫星”复选框，这样他就不用手动输入高程数了。</li><li id="b328" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">我最初写这个工具是为了让我可以为我建造的AM接收器试验磁环天线。这些天线对广播塔的方向非常敏感。通过转动接收器，我可以知道信号来自哪个方向。我可以将此与广播塔的已知GPS坐标相关联，以验证我是否真的接收到了我认为来自广播塔的信号。</li></ul><p id="1429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">欢迎在这里发表评论，分享你是如何使用这段代码的！我总是对人们做的创造性的事情感兴趣。</p></div></div>    
</body>
</html>