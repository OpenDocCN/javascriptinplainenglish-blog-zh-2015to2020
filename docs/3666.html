<html>
<head>
<title>How to Unit Test Express Middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对Express中间件进行单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-unit-test-express-middleware-typescript-jest-c6a7ad166e74?source=collection_archive---------1-----------------------#2020-10-16">https://javascript.plainenglish.io/how-to-unit-test-express-middleware-typescript-jest-c6a7ad166e74?source=collection_archive---------1-----------------------#2020-10-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/42986711dc4810dcf1a379e976b3d599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9yppJYsYKsgmMN9wOXNyQ.png"/></div></div></figure><div class=""/><p id="9172" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您对Node.js项目使用测试驱动开发，那么您需要编写单元测试。根据我的经验，对于经验不足的开发人员来说，测试使用第三方库的代码部分通常很困难。有效单元测试的关键方面是定义要测试的业务逻辑的边界。</p><h2 id="e9bd" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">测试业务逻辑，仅此而已</h2><p id="a32c" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">当我编写包括Express库的任何结构项的单元测试时，它产生了我必须<strong class="jx iz">避免测试库本身</strong>。这不是我的工作。而不仅仅是我的业务逻辑需要测试。至于中间件，它是中间件功能内部的逻辑。输入参数来自Express库，所以您需要模仿或存根它们。</p><h2 id="2588" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">仅模仿或删除来自Express的所需部分，仅此而已</h2><p id="96e1" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">快速中间件是一种特殊的功能，它有三个参数:请求、响应和下一个功能。这些来自库流，您只需要将中间件连接到适当的级别(应用程序、路由器等)。).</p><h2 id="075c" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">保持键入(使用正式的Express类型)</h2><p id="e444" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">typescript最常见的问题是缺乏类型系统的知识，这迫使程序员试图绕过自己的类型系统，而不是利用它的潜力。不要那样做！Express提供了请求(Request)、响应(Response)甚至下一个函数(next function)的类型。</p><p id="3ddd" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当测试开始时，请求和响应类型的唯一问题是它们有太多必需的属性，这意味着您必须定义所有的属性才能通过类型检查。那根本不会有效。这就是为什么您应该从TypeScript中学习实用程序类型。这些对于根据您的需求定制现有类型非常有用。</p><p id="0389" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，我将只使用请求和响应类型的一部分，这就是部分实用程序类型这次帮助我的原因。带有泛型类型参数的Partial意味着“该类型的某个子集作为类型参数出现”。</p><h2 id="42b0" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">简单的例子—授权标题保护中间件</h2><p id="3e75" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">让我们看一个简单的例子。中间件检查请求是否包含授权头。如果是，您只需让流通过中间件，但是如果头丢失，立即发送一个错误响应。</p><figure class="lr ls lt lu gt ip"><div class="bz fp l di"><div class="lv lw l"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">An Express middleware</figcaption></figure><p id="9b1a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是带有快速请求、响应和下一个功能模拟的单元测试。</p><figure class="lr ls lt lu gt ip"><div class="bz fp l di"><div class="lv lw l"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Unit tests (Jest) for an Express middleware</figcaption></figure><h2 id="aedc" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">保持干巴巴的原则(不要重复自己)</h2><p id="632a" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">不要互相重写测试用例。例如:您希望在请求体中使用字符串输入属性来测试您的中间件。在这种情况下，不要用相同的字符串类型编写多个不同的测试用例，如果它们与您的业务逻辑观点没有不同的话。乍一看，这似乎不是一个严重的问题，但是请相信我，您可能会产生大量的代码气味，没有人希望在他们的项目中出现这种气味。请记住这个建议。</p><h2 id="4204" class="kt ku iy bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">练习，多多练习</h2><p id="a319" class="pw-post-body-paragraph jv jw iy jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">编写有效的自动化测试是您可以选择的最难的软件开发挑战之一。你很容易感觉到你对如何以正确的方式进行测试没有任何概念。这很正常。我认为提高测试技能的唯一方法是实践。尽可能多地编写单元(或集成，或其他)测试，犯错误并从中吸取教训。</p></div></div>    
</body>
</html>