<html>
<head>
<title>How to Use Vue Router with Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何配合Vue.js使用Vue路由器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-vue-router-with-vue-js-cdc6c57c7d9f?source=collection_archive---------4-----------------------#2019-11-14">https://javascript.plainenglish.io/how-to-use-vue-router-with-vue-js-cdc6c57c7d9f?source=collection_archive---------4-----------------------#2019-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aaf51a4af6d0823652421540fbbb7c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCkPcIhKe4P77MbbQ0DuAA.png"/></div></div></figure><p id="8f74" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了用Vue.js创建一个单页面应用程序，我们需要使用一个URL路由器来根据点击链接时输入的URL显示我们的页面。Vue.js有Vue路由器作为路由选项。我们可以在创建应用程序项目时设置它，或者稍后将其作为包添加。它很容易使用，并且附带有Vue.js，所以它非常频繁地用于Vue.js单页应用程序。</p><p id="88a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vue Router可以将URL映射到我们的页面，它还可以在用<code class="fe kw kx ky kz b">router.beforeEach</code>钩子加载URL之前运行代码。它接受<code class="fe kw kx ky kz b">to</code>、<code class="fe kw kx ky kz b">from</code>和<code class="fe kw kx ky kz b">next</code>参数。<code class="fe kw kx ky kz b">to</code>参数指示用户通过点击链接或直接输入URL将要去的URL。<code class="fe kw kx ky kz b">from</code>是用户导航的URL,<code class="fe kw kx ky kz b">next</code>是一个函数，如果你想让用户看到他或她要去的路线，你可以调用这个函数。</p><p id="4b77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将制作一个简单的带身份验证的Bitbucket应用程序。我们将让用户注册一个帐户，并为他们的帐户设置他们的位桶用户名和密码。一旦用户登录并设置了他们的位存储桶凭证，他们就可以查看他们的存储库和每个存储库的提交。</p><p id="2ad3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">前端将是一个Vue.js应用程序，使用Vue路由器进行路由。</p><p id="e10a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Bitbucket是一个很棒的存储库托管服务，可以让你免费托管Git存储库。您可以升级到他们的付费计划，以低价获得更多功能。它还有一个全面的自动化和获取数据的API。</p><p id="5f2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开发者为Bitbucket的API做了Node.js客户端。我们可以很容易地使用它来做我们想做的事情，如操纵提交、添加、删除或编辑存储库、跟踪问题、操纵构建管道等等。</p><p id="3e16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Bitbucket.js包是用于编写Node.js Bitbucket应用程序的最简单的包之一。我们所要做的就是用我们的Bitbucket用户名和密码登录Bitbucket实例，并调用在<a class="ae la" href="https://bitbucketjs.netlify.com/#api-_" rel="noopener ugc nofollow" target="_blank">https://bitbucketjs.netlify.com/#api-_</a>中列出的内置函数来完成我们想用Bitbucket包做的几乎任何事情。</p><p id="c4b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的应用程序将包括后端和前端。后端处理用户身份验证，并通过Bitbucket API与Bitbucket通信。前端有注册表单，登录表单，用于设置密码和位桶用户名和密码的设置表单。</p><h1 id="c096" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">后端</h1><p id="e3dd" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">为了开始构建应用程序，我们创建一个项目文件夹，其中包含<code class="fe kw kx ky kz b">backend</code>文件夹。然后我们进入<code class="fe kw kx ky kz b">backend</code>文件夹，通过运行<code class="fe kw kx ky kz b">npx express-generator</code>来运行快速生成器。接下来我们自己安装一些包。我们需要Babel来使用<code class="fe kw kx ky kz b">import</code>，BCrypt来散列密码，Bitbucket.js来使用Bitbucket API。Crypto-JS用于加密和解密我们的位桶密码，Dotenv用于存储哈希和加密秘密，Sequelize用于ORM，JSON Web Token包用于身份验证，CORS用于跨域通信，SQLite用于数据库。</p><p id="0e91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe kw kx ky kz b">npm i @babel/cli @babel/core @babel/node @babel/preset-env bcrypt bitbucket cors crypto-js dotenv jsonwebtoken sequelize sqlite3</code>来安装这些包。</p><p id="3c6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kw kx ky kz b">package.json</code>的<code class="fe kw kx ky kz b">script</code>部分，输入:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="be97" class="mm lc iq kz b gy mn mo l mp mq">"start": "nodemon --exec npm run babel-node --  ./bin/www",<br/>"babel-node": "babel-node"</span></pre><p id="ae73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Babel Node启动我们的应用程序，而不是常规的Node.js运行时，这样我们就可以获得最新的JavaScript特性。</p><p id="5841" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们在<code class="fe kw kx ky kz b">backend</code>文件夹中创建一个名为<code class="fe kw kx ky kz b">.babelrc</code>的文件，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="bac0" class="mm lc iq kz b gy mn mo l mp mq">{<br/>    "presets": [<br/>        "<a class="ae la" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>"<br/>    ]<br/>}</span></pre><p id="5e4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启用最新功能。</p><p id="f252" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们必须通过运行<code class="fe kw kx ky kz b">npx sequelize-cli init</code>来添加序列代码。之后，我们应该在<code class="fe kw kx ky kz b">config</code>文件夹中得到一个<code class="fe kw kx ky kz b">config.json</code>文件。</p><p id="e5e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kw kx ky kz b">config.json</code>中，我们输入:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="0018" class="mm lc iq kz b gy mn mo l mp mq">{<br/>  "development": {<br/>    "dialect": "sqlite",<br/>    "storage": "development.db"<br/>  },<br/>  "test": {<br/>    "dialect": "sqlite",<br/>    "storage": "test.db"<br/>  },<br/>  "production": {<br/>    "dialect": "sqlite",<br/>    "storage": "production.db"<br/>  }<br/>}</span></pre><p id="6137" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用SQLite作为我们的数据库。</p><p id="ad86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们添加一个用于验证认证令牌的中间件，在<code class="fe kw kx ky kz b">backend</code>文件夹中添加一个<code class="fe kw kx ky kz b">middllewares</code>文件夹，并在其中添加<code class="fe kw kx ky kz b">authCheck.js</code>。在文件中，添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="c8ab" class="mm lc iq kz b gy mn mo l mp mq">const jwt = require("jsonwebtoken");<br/>const secret = process.env.JWT_SECRET;</span><span id="fb0f" class="mm lc iq kz b gy mr mo l mp mq">export const authCheck = (req, res, next) =&gt; {<br/>  if (req.headers.authorization) {<br/>    const token = req.headers.authorization;<br/>    jwt.verify(token, secret, (err, decoded) =&gt; {<br/>      if (err) {<br/>        res.send(401);<br/>      } else {<br/>        next();<br/>      }<br/>    });<br/>  } else {<br/>    res.send(401);<br/>  }<br/>};</span></pre><p id="0ae3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果令牌无效，我们返回401响应。</p><p id="3f32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们创建一些迁移和模型。运行:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="ec1b" class="mm lc iq kz b gy mn mo l mp mq">npx sequelize-cli model:create --name User --attributes username:string,password:string,bitBucketUsername:string,bitBucketPassword:string</span></pre><p id="c9bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">来创建模型。请注意，属性选项没有空格。</p><p id="900d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们向Users表的<code class="fe kw kx ky kz b">username</code>列添加unique约束。为此，请运行:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="6dd4" class="mm lc iq kz b gy mn mo l mp mq">npx sequelize-cli migration:create addUniqueConstraintToUser</span></pre><p id="99d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在新创建的迁移文件中，添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="124c" class="mm lc iq kz b gy mn mo l mp mq">"use strict";</span><span id="97ac" class="mm lc iq kz b gy mr mo l mp mq">module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.addConstraint("Users", ["username"], {<br/>      type: "unique",<br/>      name: "usernameUnique"<br/>    });<br/>  },</span><span id="cfb5" class="mm lc iq kz b gy mr mo l mp mq">down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.removeConstraint("Users", "usernameUnique");<br/>  }<br/>};</span></pre><p id="5c0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe kw kx ky kz b">npx sequelize-cli db:migrate</code>运行所有迁移。</p><p id="1fad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们创建路线。创建一个名为<code class="fe kw kx ky kz b">bitbucket.js</code>的文件，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="4579" class="mm lc iq kz b gy mn mo l mp mq">var express = require("express");<br/>const models = require("../models");<br/>const CryptoJS = require("crypto-js");<br/>const Bitbucket = require("bitbucket");<br/>const jwt = require("jsonwebtoken");<br/>import { authCheck } from "../middlewares/authCheck";</span><span id="e593" class="mm lc iq kz b gy mr mo l mp mq">const bitbucket = new Bitbucket();<br/>var router = express.Router();</span><span id="4189" class="mm lc iq kz b gy mr mo l mp mq">router.post("/setBitbucketCredentials", authCheck, async (req, res, next) =&gt; {<br/>  const { bitBucketUsername, bitBucketPassword } = req.body;<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const cipherText = CryptoJS.AES.encrypt(<br/>    bitBucketPassword,<br/>    process.env.CRYPTO_SECRET<br/>  );<br/>  await models.User.update(<br/>    {<br/>      bitBucketUsername,<br/>      bitBucketPassword: cipherText.toString()<br/>    },<br/>    {<br/>      where: { id }<br/>    }<br/>  );<br/>  res.json({});<br/>});</span><span id="9698" class="mm lc iq kz b gy mr mo l mp mq">router.get("/repos/:page", authCheck, async (req, res, next) =&gt; {<br/>  const page = req.params.page || 1;<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const users = await models.User.findAll({ where: { id } });<br/>  const user = users[0];<br/>  const bytes = CryptoJS.AES.decrypt(<br/>    user.bitBucketPassword.toString(),<br/>    process.env.CRYPTO_SECRET<br/>  );<br/>  const password = bytes.toString(CryptoJS.enc.Utf8);<br/>  bitbucket.authenticate({<br/>    type: "basic",<br/>    username: user.bitBucketUsername,<br/>    password<br/>  });<br/>  let { data } = await bitbucket.repositories.list({<br/>    username: user.bitBucketUsername,<br/>    page,<br/>    sort: "-updated_on"<br/>  });<br/>  res.json(data);<br/>});</span><span id="81c6" class="mm lc iq kz b gy mr mo l mp mq">router.get("/commits/:repoName", authCheck, async (req, res, next) =&gt; {<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const users = await models.User.findAll({ where: { id } });<br/>  const user = users[0];<br/>  const repoName = req.params.repoName;<br/>  const bytes = CryptoJS.AES.decrypt(<br/>    user.bitBucketPassword.toString(),<br/>    process.env.CRYPTO_SECRET<br/>  );<br/>  const password = bytes.toString(CryptoJS.enc.Utf8);<br/>  bitbucket.authenticate({<br/>    type: "basic",<br/>    username: user.bitBucketUsername,<br/>    password<br/>  });<br/>  let { data } = await bitbucket.commits.list({<br/>    username: user.bitBucketUsername,<br/>    repo_slug: repoName,<br/>    sort: "-date"<br/>  });<br/>  res.json(data);<br/>});</span><span id="3ec0" class="mm lc iq kz b gy mr mo l mp mq">module.exports = router;</span></pre><p id="04cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在每个路由中，我们从令牌中获取用户，因为我们将把用户ID添加到令牌中，并从令牌中获取Bitbucket用户名和密码，用于登录Bitbucket API。请注意，我们必须解密密码，因为我们在将密码保存到数据库之前对其进行了加密。</p><p id="fef9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在<code class="fe kw kx ky kz b">setBitbucketCredentials</code>路由中设置位桶凭证。我们在保存密码之前对其进行加密，以确保其安全。</p><p id="d54a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在<code class="fe kw kx ky kz b">repos</code>路径中，我们获得用户的回复，并按照相反的<code class="fe kw kx ky kz b">update_on</code>顺序进行排序，因为我们在<code class="fe kw kx ky kz b">sort</code>参数中指定了<code class="fe kw kx ky kz b">-updated_on</code>。由于我们在<code class="fe kw kx ky kz b">sort</code>参数中指定了<code class="fe kw kx ky kz b">-date</code>，所以提交是按日期倒序排列的。</p><p id="d24f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将<code class="fe kw kx ky kz b">user.js</code>添加到<code class="fe kw kx ky kz b">routes</code>文件夹中，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="de9d" class="mm lc iq kz b gy mn mo l mp mq">const express = require("express");<br/>const models = require("../models");<br/>const bcrypt = require("bcrypt");<br/>const jwt = require("jsonwebtoken");<br/>import { authCheck } from "../middlewares/authCheck";<br/>const router = express.Router();</span><span id="423a" class="mm lc iq kz b gy mr mo l mp mq">router.post("/signup", async (req, res, next) =&gt; {<br/>  try {<br/>    const { username, password } = req.body;<br/>    const hashedPassword = await bcrypt.hash(password, 10);<br/>    const user = await models.User.create({<br/>      username,<br/>      password: hashedPassword<br/>    });<br/>    res.json(user);<br/>  } catch (error) {<br/>    res.status(400).json(error);<br/>  }<br/>});</span><span id="5b71" class="mm lc iq kz b gy mr mo l mp mq">router.post("/login", async (req, res, next) =&gt; {<br/>  const { username, password } = req.body;<br/>  const users = await models.User.findAll({ where: { username } });<br/>  const user = users[0];<br/>  const response = await bcrypt.compare(password, user.password);<br/>  if (response) {<br/>    const token = jwt.sign({ userId: user.id }, process.env.JWT_SECRET);<br/>    res.json({ token });<br/>  } else {<br/>    res.status(401).json({});<br/>  }<br/>});</span><span id="0a0f" class="mm lc iq kz b gy mr mo l mp mq">router.post("/changePassword", authCheck, async (req, res, next) =&gt; {<br/>  const { password } = req.body;<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const hashedPassword = await bcrypt.hash(password, 10);<br/>  await models.User.update({ password: hashedPassword }, { where: { id } });<br/>  res.json({});<br/>});</span><span id="ad1d" class="mm lc iq kz b gy mr mo l mp mq">router.get("/currentUser", authCheck, async (req, res, next) =&gt; {<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const users = await models.User.findAll({ where: { id } });<br/>  const { username, bitBucketUsername } = users[0];<br/>  res.json({ username, bitBucketUsername });<br/>});</span><span id="2e2c" class="mm lc iq kz b gy mr mo l mp mq">module.exports = router;</span></pre><p id="d153" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有注册、登录和更改密码的路径。当我们注册或更改密码时，我们会在保存之前对密码进行哈希运算。</p><p id="490d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">currentUser</code>路线将用于前端的设置表单。</p><p id="d220" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kw kx ky kz b">app.js</code>中，我们将现有代码替换为:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="aa3a" class="mm lc iq kz b gy mn mo l mp mq">require("dotenv").config();<br/>var createError = require("http-errors");<br/>var express = require("express");<br/>var path = require("path");<br/>var cookieParser = require("cookie-parser");<br/>var logger = require("morgan");<br/>const cors = require("cors");</span><span id="7057" class="mm lc iq kz b gy mr mo l mp mq">var indexRouter = require("./routes/index");<br/>var usersRouter = require("./routes/users");<br/>var bitbucketRouter = require("./routes/bitbucket");</span><span id="2981" class="mm lc iq kz b gy mr mo l mp mq">var app = express();</span><span id="4ce3" class="mm lc iq kz b gy mr mo l mp mq">// view engine setup<br/>app.set("views", path.join(__dirname, "views"));<br/>app.set("view engine", "jade");</span><span id="8dba" class="mm lc iq kz b gy mr mo l mp mq">app.use(logger("dev"));<br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: false }));<br/>app.use(cookieParser());<br/>app.use(express.static(path.join(__dirname, "public")));<br/>app.use(cors());</span><span id="d5ee" class="mm lc iq kz b gy mr mo l mp mq">app.use("/", indexRouter);<br/>app.use("/users", usersRouter);<br/>app.use("/bitbucket", bitbucketRouter);</span><span id="05b3" class="mm lc iq kz b gy mr mo l mp mq">// catch 404 and forward to error handler<br/>app.use(function(req, res, next) {<br/>  next(createError(404));<br/>});</span><span id="db74" class="mm lc iq kz b gy mr mo l mp mq">// error handler<br/>app.use(function(err, req, res, next) {<br/>  // set locals, only providing error in development<br/>  res.locals.message = err.message;<br/>  res.locals.error = req.app.get("env") === "development" ? err : {};</span><span id="0f9c" class="mm lc iq kz b gy mr mo l mp mq">// render the error page<br/>  res.status(err.status || 500);<br/>  res.render("error");<br/>});</span><span id="63e9" class="mm lc iq kz b gy mr mo l mp mq">module.exports = app;</span></pre><p id="dd89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加CORS插件以支持跨域通信，并通过添加以下内容在我们的应用程序中添加<code class="fe kw kx ky kz b">users</code>和<code class="fe kw kx ky kz b">bitbucket</code>路由:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="ba34" class="mm lc iq kz b gy mn mo l mp mq">app.use("/users", usersRouter);<br/>app.use("/bitbucket", bitbucketRouter);</span></pre><p id="5be1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这完成了应用程序的后端部分。</p><h1 id="bdc3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">前端</h1><p id="2b28" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">现在我们可以构建前端了。</p><p id="c21f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用Vue构建它，所以我们从运行项目根文件夹中的<code class="fe kw kx ky kz b">npx @vue/cli frontend</code>开始。请务必选择“手动选择功能”，然后选择包括Babel和Vue路由器。</p><p id="48e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们必须安装一些软件包。我们需要Axios进行HTTP请求，需要Bootstrap进行样式设计，需要Vee-Validate进行表单验证，需要Vue-Filter-Date-Format包进行日期格式化。</p><p id="817c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们通过运行以下命令来安装所有软件包:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="c71b" class="mm lc iq kz b gy mn mo l mp mq">npm i axios bootstrap-vue vee-validate vue-filter-date-format</span></pre><p id="df26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦完成，我们就可以开始编写前端应用程序了。首先，我们为我们的前端添加顶部酒吧。我们制作一个在用户登录时显示，另一个在用户注销时显示。</p><p id="862a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kw kx ky kz b">components</code>文件夹中创建<code class="fe kw kx ky kz b">LoggedInTopBar.vue</code>并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="ed64" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;b-navbar toggleable="lg" type="dark" variant="info"&gt;<br/>    &lt;b-navbar-brand to="/"&gt;Bitbucket App&lt;/b-navbar-brand&gt;</span><span id="afc9" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-navbar-toggle target="nav-collapse"&gt;&lt;/b-navbar-toggle&gt;</span><span id="e031" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-collapse id="nav-collapse" is-nav&gt;<br/>      &lt;b-navbar-nav&gt;<br/>        &lt;b-nav-item to="/settings" :active="path  == '/settings'"&gt;Settings&lt;/b-nav-item&gt;<br/>        &lt;b-nav-item to="/repos" :active="path.includes('/repos')"&gt;Repos&lt;/b-nav-item&gt;<br/>        &lt;b-nav-item <a class="ae la" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="logOut()"&gt;Log Out&lt;/b-nav-item&gt;<br/>      &lt;/b-navbar-nav&gt;<br/>    &lt;/b-collapse&gt;<br/>  &lt;/b-navbar&gt;<br/>&lt;/template&gt;</span><span id="56b3" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>export default {<br/>  name: "LoggedInTopBar",<br/>  data() {<br/>    return {<br/>      path: this.$route &amp;&amp; this.$route.path<br/>    };<br/>  },<br/>  watch: {<br/>    $route(route) {<br/>      this.path = route.path;<br/>    }<br/>  },<br/>  methods: {<br/>    logOut() {<br/>      localStorage.clear();<br/>      this.$router.push("/");<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="a50e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们观察用户当前导航到的URL来设置<code class="fe kw kx ky kz b">active</code>属性，当用户转到代码中带有条件的URL时，该属性会突出显示链接。</p><p id="64d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">b-navbar</code>由BootstrapVue提供。</p><p id="d1bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，我们在同一个文件夹中创建<code class="fe kw kx ky kz b">LoggedOutTopBar.vue</code>,并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="184d" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;b-navbar toggleable="lg" type="dark" variant="info"&gt;<br/>    &lt;b-navbar-brand to="/"&gt;Bitbucket App&lt;/b-navbar-brand&gt;</span><span id="6b79" class="mm lc iq kz b gy mr mo l mp mq">    &lt;b-navbar-toggle target="nav-collapse"&gt;&lt;/b-navbar-toggle&gt;</span><span id="d2ec" class="mm lc iq kz b gy mr mo l mp mq">    &lt;b-collapse id="nav-collapse" is-nav&gt;<br/>      &lt;b-navbar-nav&gt;<br/>        &lt;b-nav-item to="/" :active="path  == '/'"&gt;Home&lt;/b-nav-item&gt;<br/>      &lt;/b-navbar-nav&gt;<br/>    &lt;/b-collapse&gt;<br/>  &lt;/b-navbar&gt;<br/>&lt;/template&gt;</span><span id="7082" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>export default {<br/>  name: "LoggedOutTopBar",<br/>  data() {<br/>    return {<br/>      path: this.$route &amp;&amp; this.$route.path<br/>    };<br/>  },<br/>  watch: {<br/>    $route(route) {<br/>      this.path = route.path;<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="f1c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们在<code class="fe kw kx ky kz b">src</code>文件夹中创建一个<code class="fe kw kx ky kz b">mixins</code>文件夹，并添加一个<code class="fe kw kx ky kz b">requestsMixin.js</code>文件来创建共享代码，让我们的组件发出HTTP请求。在这个文件中，我们添加了:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="3465" class="mm lc iq kz b gy mn mo l mp mq">const APIURL = "<a class="ae la" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>";<br/>const axios = require("axios");</span><span id="7a41" class="mm lc iq kz b gy mr mo l mp mq">axios.interceptors.request.use(<br/>  config =&gt; {<br/>    config.headers.authorization = localStorage.getItem("token");<br/>    return config;<br/>  },<br/>  error =&gt; Promise.reject(error)<br/>);</span><span id="a031" class="mm lc iq kz b gy mr mo l mp mq">axios.interceptors.response.use(<br/>  response =&gt; {<br/>    return response;<br/>  },<br/>  error =&gt; {<br/>    if (error.response.status == 401) {<br/>      localStorage.clear();<br/>    }<br/>    return error;<br/>  }<br/>);</span><span id="eca9" class="mm lc iq kz b gy mr mo l mp mq">export const requestsMixin = {<br/>  methods: {<br/>    signUp(data) {<br/>      return axios.post(`${APIURL}/users/signup`, data);<br/>    },</span><span id="8a8e" class="mm lc iq kz b gy mr mo l mp mq">    logIn(data) {<br/>      return axios.post(`${APIURL}/users/login`, data);<br/>    },</span><span id="e7a8" class="mm lc iq kz b gy mr mo l mp mq">    changePassword(data) {<br/>      return axios.post(`${APIURL}/users/changePassword`, data);<br/>    },</span><span id="f051" class="mm lc iq kz b gy mr mo l mp mq">    currentUser() {<br/>      return axios.get(`${APIURL}/users/currentUser`);<br/>    },</span><span id="8c1f" class="mm lc iq kz b gy mr mo l mp mq">    setBitbucketCredentials(data) {<br/>      return axios.post(`${APIURL}/bitbucket/setBitbucketCredentials`, data);<br/>    },</span><span id="e55c" class="mm lc iq kz b gy mr mo l mp mq">repos(page) {<br/>      return axios.get(`${APIURL}/bitbucket/repos/${page || 1}`);<br/>    },</span><span id="cc68" class="mm lc iq kz b gy mr mo l mp mq">    commits(repoName) {<br/>      return axios.get(`${APIURL}/bitbucket/commits/${repoName}`);<br/>    }<br/>  }<br/>};</span></pre><p id="6676" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有一个HTTP请求拦截器来将身份验证令牌添加到请求的头部，在响应拦截器中，如果收到401响应，我们会拦截响应并清除本地存储。</p><p id="1a98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们制作页面。首先，我们制作一个页面，列出在URL中给定存储库名称的存储库的提交。在<code class="fe kw kx ky kz b">views</code>文件夹中创建一个名为<code class="fe kw kx ky kz b">CommitsPage.vue</code>的文件，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="30a7" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;LoggedInTopBar /&gt;<br/>    &lt;div class="page"&gt;<br/>      &lt;h1 class="text-center"&gt;Commits - {{repoName}}&lt;/h1&gt;<br/>      &lt;b-card :title="b.message" v-for="b in bitBucketCommits" :key="b.hash"&gt;<br/>        &lt;b-card-text&gt;<br/>          &lt;p&gt;Hash: {{b.hash}}&lt;/p&gt;<br/>          &lt;p&gt;Date: {{ new Date(b.date) | dateFormat('YYYY-MM-DD hh:mm:ss a') }}&lt;/p&gt;<br/>        &lt;/b-card-text&gt;<br/>      &lt;/b-card&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="8593" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>// @ is an alias to /src<br/>import LoggedInTopBar from "@/components/LoggedInTopBar.vue";<br/>import { requestsMixin } from "../mixins/requestsMixin";</span><span id="6a60" class="mm lc iq kz b gy mr mo l mp mq">export default {<br/>  name: "home",<br/>  mixins: [requestsMixin],<br/>  components: {<br/>    LoggedInTopBar<br/>  },<br/>  data() {<br/>    return {<br/>      bitBucketCommits: [],<br/>      repoName: ""<br/>    };<br/>  },<br/>  methods: {},<br/>  async beforeMount() {<br/>    this.repoName = this.$route.params.repoName;<br/>    const response = await this.commits(this.repoName);<br/>    this.bitBucketCommits = response.data.values;<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="5007" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从URL中获取存储库名称，然后使用给定的名称获取存储库的提交，并将它们显示在BootstrapVue卡中。</p><p id="f07e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们将<code class="fe kw kx ky kz b">Home.vue</code>的内容替换为:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="96ae" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;LoggedOutTopBar /&gt;<br/>    &lt;div class="page"&gt;<br/>      &lt;h1 class="text-center"&gt;Log In&lt;/h1&gt;<br/>      &lt;ValidationObserver ref="observer" v-slot="{ invalid }"&gt;<br/>        &lt;b-form <a class="ae la" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onSubmit"&gt;<br/>          &lt;b-form-group label="Username" label-for="username"&gt;<br/>            &lt;ValidationProvider name="username" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="form.username"<br/>                type="text"<br/>                required<br/>                placeholder="Username"<br/>                name="username"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Username is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="f9af" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-form-group label="Password" label-for="password"&gt;<br/>            &lt;ValidationProvider name="password" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="form.password"<br/>                type="password"<br/>                required<br/>                placeholder="Password"<br/>                name="password"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Password is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="4a9e" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-button type="submit" variant="primary" style="margin-right: 10px"&gt;Log In&lt;/b-button&gt;<br/>          &lt;b-button type="button" variant="primary" <a class="ae la" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="$router.push('/signup')"&gt;Sign Up&lt;/b-button&gt;<br/>        &lt;/b-form&gt;<br/>      &lt;/ValidationObserver&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="acb1" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>// @ is an alias to /src<br/>import LoggedOutTopBar from "@/components/LoggedOutTopBar.vue";<br/>import { requestsMixin } from "../mixins/requestsMixin";</span><span id="8e85" class="mm lc iq kz b gy mr mo l mp mq">export default {<br/>  name: "home",<br/>  mixins: [requestsMixin],<br/>  components: {<br/>    LoggedOutTopBar<br/>  },<br/>  data() {<br/>    return {<br/>      form: {}<br/>    };<br/>  },<br/>  methods: {<br/>    async onSubmit() {<br/>      const isValid = await this.$refs.observer.validate();<br/>      if (!isValid) {<br/>        return;<br/>      }<br/>      try {<br/>        const response = await this.logIn(this.form);<br/>        localStorage.setItem("token", response.data.token);<br/>        this.$router.push("/settings");<br/>      } catch (error) {<br/>        alert("Invalid username or password");<br/>      }<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="7914" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个页面是我们的注册页面。我们使用Vee-Validate来验证我们的表单。我们用<code class="fe kw kx ky kz b">ValidationObserver</code>包装整个表单，用<code class="fe kw kx ky kz b">onSubmit</code>函数中的<code class="fe kw kx ky kz b">await this.$refs.observer.validate()</code>获得验证状态。我们将每个输入放在一个<code class="fe kw kx ky kz b">ValidationProvider</code>中，这样每个字段都根据定义的规则进行验证。</p><p id="fd63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦<code class="fe kw kx ky kz b">this.logIn</code> promise成功解析，我们就获得一个认证令牌，我们将它设置在本地存储中，供我们的请求访问。</p><p id="cdad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们在<code class="fe kw kx ky kz b">views</code>文件夹中创建<code class="fe kw kx ky kz b">RepoPage.vue</code>，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="682d" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;LoggedInTopBar /&gt;<br/>    &lt;div class="page"&gt;<br/>      &lt;h1 class="text-center"&gt;Repos&lt;/h1&gt;<br/>      &lt;b-card :title="b.name" v-for="b in bitBucketRepos" :key="b.slug"&gt;<br/>        &lt;b-card-text&gt;<br/>          &lt;p&gt;Updated on: {{ new Date(b.updated_on) | dateFormat('YYYY-MM-DD hh:mm:ss a') }}&lt;/p&gt;<br/>        &lt;/b-card-text&gt;</span><span id="32e5" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-button :to="`/commits/${b.slug}`" variant="primary"&gt;See Commits&lt;/b-button&gt;<br/>      &lt;/b-card&gt;<br/>      &lt;br /&gt;<br/>      &lt;b-pagination-nav :link-gen="linkGen" :number-of-pages="numPages" use-router v-model="page"&gt;&lt;/b-pagination-nav&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="534b" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>// @ is an alias to /src<br/>import LoggedInTopBar from "@/components/LoggedInTopBar.vue";<br/>import { requestsMixin } from "../mixins/requestsMixin";</span><span id="d3c1" class="mm lc iq kz b gy mr mo l mp mq">export default {<br/>  name: "home",<br/>  mixins: [requestsMixin],<br/>  components: {<br/>    LoggedInTopBar<br/>  },<br/>  data() {<br/>    return {<br/>      bitBucketRepos: [],<br/>      page: 1,<br/>      numPages: 1<br/>    };<br/>  },<br/>  methods: {<br/>    linkGen(pageNum) {<br/>      return pageNum === 1 ? "?" : `?page=${pageNum}`;<br/>    },<br/>    async getRepos() {<br/>      const response = await this.repos(this.page);<br/>      this.bitBucketRepos = response.data.values;<br/>      this.numPages = response.data.size / response.data.pagelen;<br/>    }<br/>  },<br/>  beforeMount() {<br/>    this.getRepos();<br/>  },<br/>  watch: {<br/>    async page(val) {<br/>      await this.getRepos(val);<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="f89b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">获取给定用户的存储库。注意，我们有分页，因为分页是由后端提供的。我们使用BootstrapVue分页器，它接受一个用于传入函数以生成链接内容的<code class="fe kw kx ky kz b">link-gen</code>属性和一个表示页面数量的<code class="fe kw kx ky kz b">number-of-pages</code>属性。我们需要<code class="fe kw kx ky kz b">v-model</code>来更新<code class="fe kw kx ky kz b">this.page</code>，并且我们可以使用我们定义的<code class="fe kw kx ky kz b">watch</code>块来获取集合页面的存储库。</p><p id="66c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">this.getRepos</code>出自<code class="fe kw kx ky kz b">requestsMixin</code>。</p><p id="5c07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来在<code class="fe kw kx ky kz b">views</code>文件夹中创建一个<code class="fe kw kx ky kz b">SettingsPage.vue</code>文件，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="6284" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;LoggedInTopBar /&gt;<br/>    &lt;div class="page"&gt;<br/>      &lt;h1 class="text-center"&gt;Settings&lt;/h1&gt;</span><span id="f4af" class="mm lc iq kz b gy mr mo l mp mq">      &lt;h2&gt;User Settings&lt;/h2&gt;<br/>      &lt;ValidationObserver ref="userObserver" v-slot="{ invalid }"&gt;<br/>        &lt;b-form <a class="ae la" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onUserSettingSubmit"&gt;<br/>          &lt;b-form-group label="Username" label-for="username"&gt;<br/>            &lt;ValidationProvider name="username" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                disabled<br/>                :state="errors.length == 0"<br/>                v-model="form.username"<br/>                type="text"<br/>                required<br/>                placeholder="Username"<br/>                name="username"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Username is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="7cdf" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-form-group label="Password" label-for="password"&gt;<br/>            &lt;ValidationProvider name="password" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="form.password"<br/>                type="password"<br/>                required<br/>                placeholder="Password"<br/>                name="password"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Password is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="10c8" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-button type="submit" variant="primary"&gt;Save&lt;/b-button&gt;<br/>        &lt;/b-form&gt;<br/>      &lt;/ValidationObserver&gt;</span><span id="6d4c" class="mm lc iq kz b gy mr mo l mp mq">&lt;br /&gt;</span><span id="5234" class="mm lc iq kz b gy mr mo l mp mq">      &lt;h2&gt;Bitbucket Settings&lt;/h2&gt;<br/>      &lt;ValidationObserver ref="bitbucketObserver" v-slot="{ invalid }"&gt;<br/>        &lt;b-form <a class="ae la" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onBitbucketSettingSubmit"&gt;<br/>          &lt;b-form-group label="Bitbucket Username" label-for="bitBucketUsername"&gt;<br/>            &lt;ValidationProvider name="username" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="bitBucketForm.bitBucketUsername"<br/>                type="text"<br/>                required<br/>                placeholder="Username"<br/>                name="bitBucketUsername"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Username is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="d84d" class="mm lc iq kz b gy mr mo l mp mq">          &lt;b-form-group label="Bitbucket Password" label-for="bitBucketPassword"&gt;<br/>            &lt;ValidationProvider name="password" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="bitBucketForm.bitBucketPassword"<br/>                type="password"<br/>                required<br/>                placeholder="Password"<br/>                name="bitBucketPassword"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Password is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="c2f7" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-button type="submit" variant="primary"&gt;Save&lt;/b-button&gt;<br/>        &lt;/b-form&gt;<br/>      &lt;/ValidationObserver&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="36f4" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>// @ is an alias to /src<br/>import LoggedInTopBar from "@/components/LoggedInTopBar.vue";<br/>import { requestsMixin } from "../mixins/requestsMixin";</span><span id="e29f" class="mm lc iq kz b gy mr mo l mp mq">export default {<br/>  name: "home",<br/>  mixins: [requestsMixin],<br/>  components: {<br/>    LoggedInTopBar<br/>  },<br/>  data() {<br/>    return {<br/>      form: {},<br/>      bitBucketForm: {}<br/>    };<br/>  },<br/>  methods: {<br/>    async onUserSettingSubmit() {<br/>      const isValid = await this.$refs.userObserver.validate();<br/>      if (!isValid) {<br/>        return;<br/>      }<br/>      await this.changePassword(this.form);<br/>      alert("Password changed");<br/>    },</span><span id="c91e" class="mm lc iq kz b gy mr mo l mp mq">    async onBitbucketSettingSubmit() {<br/>      const isValid = await this.$refs.bitbucketObserver.validate();<br/>      if (!isValid) {<br/>        return;<br/>      }<br/>      await this.setBitbucketCredentials(this.bitBucketForm);<br/>      alert("Bitbucket credentials changed");<br/>    }<br/>  },<br/>  async beforeMount() {<br/>    const response = await this.currentUser();<br/>    const { username, bitBucketUsername } = response.data;<br/>    this.form = { username };<br/>    this.bitBucketForm = { bitBucketUsername };<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="ef60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在这里有设置帐户密码和设置位桶凭证的表单。这些表格的工作方式与<code class="fe kw kx ky kz b">Home.vue</code>中的登录表格相同。<code class="fe kw kx ky kz b">this.changePassword </code>和<code class="fe kw kx ky kz b">this.setBitbucketCredentials</code>功能来自我们的<code class="fe kw kx ky kz b">requestsMixin</code>。这些函数发出HTTP请求。</p><p id="3887" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们在<code class="fe kw kx ky kz b">views</code>文件夹中创建<code class="fe kw kx ky kz b">SignUpPage.vue</code>，并添加:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="2f26" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;LoggedOutTopBar /&gt;<br/>    &lt;div class="page"&gt;<br/>      &lt;h1 class="text-center"&gt;Sign Up&lt;/h1&gt;<br/>      &lt;ValidationObserver ref="observer" v-slot="{ invalid }"&gt;<br/>        &lt;b-form <a class="ae la" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="onSubmit"&gt;<br/>          &lt;b-form-group label="Username" label-for="username"&gt;<br/>            &lt;ValidationProvider name="username" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="form.username"<br/>                type="text"<br/>                required<br/>                placeholder="Username"<br/>                name="username"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Username is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="7830" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-form-group label="Password" label-for="password"&gt;<br/>            &lt;ValidationProvider name="password" rules="required" v-slot="{ errors }"&gt;<br/>              &lt;b-form-input<br/>                :state="errors.length == 0"<br/>                v-model="form.password"<br/>                type="password"<br/>                required<br/>                placeholder="Password"<br/>                name="password"<br/>              &gt;&lt;/b-form-input&gt;<br/>              &lt;b-form-invalid-feedback :state="errors.length == 0"&gt;Password is required&lt;/b-form-invalid-feedback&gt;<br/>            &lt;/ValidationProvider&gt;<br/>          &lt;/b-form-group&gt;</span><span id="3326" class="mm lc iq kz b gy mr mo l mp mq">&lt;b-button type="submit" variant="primary"&gt;Sign Up&lt;/b-button&gt;<br/>        &lt;/b-form&gt;<br/>      &lt;/ValidationObserver&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="e0fa" class="mm lc iq kz b gy mr mo l mp mq">&lt;script&gt;<br/>// @ is an alias to /src<br/>import LoggedOutTopBar from "@/components/LoggedOutTopBar.vue";<br/>import { requestsMixin } from "../mixins/requestsMixin";</span><span id="abec" class="mm lc iq kz b gy mr mo l mp mq">export default {<br/>  name: "home",<br/>  mixins: [requestsMixin],<br/>  components: {<br/>    LoggedOutTopBar<br/>  },<br/>  data() {<br/>    return {<br/>      form: {}<br/>    };<br/>  },<br/>  methods: {<br/>    async onSubmit() {<br/>      const isValid = await this.$refs.observer.validate();<br/>      if (!isValid) {<br/>        return;<br/>      }<br/>      try {<br/>        await this.signUp(this.form);<br/>        alert("Sign up successful");<br/>      } catch (error) {<br/>        alert("Username is already taken");<br/>      }<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="2b42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在这里创建注册表单，并通过从<code class="fe kw kx ky kz b">requestsMixin</code>中调用<code class="fe kw kx ky kz b">this.signUp</code>来提交带有HTTP请求的数据。</p><p id="5110" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来在<code class="fe kw kx ky kz b">App.vue</code>中，将现有代码替换为:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="dfcc" class="mm lc iq kz b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;router-view /&gt;<br/>&lt;/template&gt;</span><span id="9021" class="mm lc iq kz b gy mr mo l mp mq">&lt;style lang="scss"&gt;<br/>.page {<br/>  padding: 20px;<br/>}<br/>&lt;/style&gt;</span></pre><p id="fea3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有了<code class="fe kw kx ky kz b">router-view</code>,所以我们可以查看由Vue路由器路由的组件，并且我们向页面添加了一些填充。</p><p id="4482" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来在<code class="fe kw kx ky kz b">main.js</code>中，将现有代码替换为:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="216b" class="mm lc iq kz b gy mn mo l mp mq">import Vue from "vue";<br/>import App from "./App.vue";<br/>import router from "./router";<br/>import store from "./store";<br/>import "bootstrap/dist/css/bootstrap.css";<br/>import "bootstrap-vue/dist/bootstrap-vue.css";<br/>import BootstrapVue from "bootstrap-vue";<br/>import { ValidationProvider, extend, ValidationObserver } from "vee-validate";<br/>import { required } from "vee-validate/dist/rules";<br/>import VueFilterDateFormat from "vue-filter-date-format";</span><span id="ac0d" class="mm lc iq kz b gy mr mo l mp mq">extend("required", required);<br/>Vue.component("ValidationProvider", ValidationProvider);<br/>Vue.component("ValidationObserver", ValidationObserver);<br/>Vue.use(BootstrapVue);<br/>Vue.use(VueFilterDateFormat);</span><span id="d010" class="mm lc iq kz b gy mr mo l mp mq">Vue.config.productionTip = false;</span><span id="c0cc" class="mm lc iq kz b gy mr mo l mp mq">router.beforeEach((to, from, next) =&gt; {<br/>  const token = localStorage.getItem("token");<br/>  if (to.fullPath != "/" &amp;&amp; to.fullPath != "/signup") {<br/>    if (!token) {<br/>      router.push("/");<br/>    }<br/>  }</span><span id="4b53" class="mm lc iq kz b gy mr mo l mp mq">  next();<br/>});</span><span id="6e94" class="mm lc iq kz b gy mr mo l mp mq">new Vue({<br/>  router,<br/>  store,<br/>  render: h =&gt; h(App)<br/>}).$mount("#app");</span></pre><p id="8007" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我们包含我们在这个应用中使用的库的地方，并且还截取Vue路由器导航来检查认证令牌是否出现在认证的路由中。如果令牌存在，如果用户试图访问经过认证的路由，我们就调用<code class="fe kw kx ky kz b">next</code>。</p><p id="389b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还在这个文件中导入了引导CSS，因此我们看到了引导样式。</p><p id="4e1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在<code class="fe kw kx ky kz b">index.html</code>中，将现有代码替换为:</p><pre class="me mf mg mh gt mi kz mj mk aw ml bi"><span id="db9c" class="mm lc iq kz b gy mn mo l mp mq">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width,initial-scale=1.0" /&gt;<br/>    &lt;link rel="icon" href="&lt;%= BASE_URL %&gt;favicon.ico" /&gt;<br/>    &lt;title&gt;Bitbucket App&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt;<br/>      &lt;strong<br/>        &gt;We're sorry but frontend doesn't work properly without JavaScript<br/>        enabled. Please enable it to continue.&lt;/strong<br/>      &gt;<br/>    &lt;/noscript&gt;<br/>    &lt;div id="app"&gt;&lt;/div&gt;<br/>    &lt;!-- built files will be auto injected --&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="d556" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更改我们应用程序的标题。</p><p id="10ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在所有艰苦的工作完成后，我们通过进入<code class="fe kw kx ky kz b">backend</code>文件夹并运行<code class="fe kw kx ky kz b">npm start</code>来运行后端应用程序。然后进入<code class="fe kw kx ky kz b">frontend</code>文件夹，运行<code class="fe kw kx ky kz b">npm run serve</code>。</p><p id="4eee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们得到:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/30331e890d6f82080dc0a5cdd2ecad83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmVkjT1UUjPnYZYUGvkV2Q.png"/></div></div></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/c5ad7814e6bd1f1d4b168cbefe8dcae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sReUjUpIA7hlrvjotVdJRw.png"/></div></div></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/bcfcd719f720d8716d5f870c741871cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZLrbXNtPmbni-Th8t1bMtw.png"/></div></div></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/8ee6544b07d587a5176c82a9c7d55f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTxX18XYoMRi3E1cMaxIOQ.png"/></div></div></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/d96fa3ed705644dd9bc6bfd93005da71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QPEXH0mLaaOMiQpfqzI7Mg.png"/></div></div></figure></div></div>    
</body>
</html>