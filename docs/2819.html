<html>
<head>
<title>Layer 7 Load Balancing with Nginx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nginx实现第7层负载平衡</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/layer-7-load-balancing-with-nginx-315a49e5f2b4?source=collection_archive---------2-----------------------#2020-07-27">https://javascript.plainenglish.io/layer-7-load-balancing-with-nginx-315a49e5f2b4?source=collection_archive---------2-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ce667393ede90e515f5b099eed9a3f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAM3LMbovhHd46GGUQnYcg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@davidmartinjr?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">David Martin</a> on <a class="ae kc" href="https://unsplash.com/s/photos/roads?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3118" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署后端应用程序时，您可能需要多个实例来处理大流量。负载平衡器用于管理多个服务器之间的大量请求。</p><blockquote class="lb lc ld"><p id="0405" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><a class="ae kc" href="https://www.nginx.com/resources/glossary/layer-7-load-balancing/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">第7层负载均衡</strong> </a>在高级<em class="iq">应用</em>层运行。它可以根据邮件内容(例如，URL或cookie)做出负载平衡决定。然后，它与选定的上游服务器建立新的TCP连接(或通过<a class="ae kc" href="https://www.nginx.com/blog/http-keepalives-and-web-performance/" rel="noopener ugc nofollow" target="_blank"> HTTP keepalives </a>重用现有的连接)，并将请求写入服务器。</p></blockquote><p id="cd1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行第7层负载平衡的设备通常被称为<a class="ae kc" href="https://www.nginx.com/resources/glossary/reverse-proxy-server/" rel="noopener ugc nofollow" target="_blank"> <em class="le">反向代理服务器</em> </a>。</p><p id="5758" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">客户端不直接连接到服务器。负载平衡器接收来自客户端的请求。负载平衡器决定将请求发送到哪个服务器。服务器接收请求并将响应发送回负载平衡器，负载平衡器通过端口80将响应转发给客户端。</p><p id="0e4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个例子。考虑一个负载平衡器，它管理三台服务器之间的流量。负载平衡器为此使用了一种循环算法。</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/bebe4de509f7b3cc22bf59f7eb78202e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*-vVC-BV8M3PsKZrZN_9SMA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Request 1 is sent to the server 1</figcaption></figure><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/30cb2c31e6f6a99093b32dfbb3b3c2d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*YtShhkZRhMLeQECTHBcd5A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Request 2 is sent to the server 2</figcaption></figure><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/b270f189e8f033f1671db4eccd3b1fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*Fy3EPXQ8es50PIe266zQIw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Request 3 is sent to the server 3</figcaption></figure><p id="473a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Nginx是一个可以充当web服务器、反向代理、负载平衡器、HTTP缓存等的软件。它可以充当第7层和第4层负载平衡器。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="0ca3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将演示如何在一个使用Nginx的系统上运行的4台服务器之间创建一个第7层负载平衡器。我已经创建了一个简单的Node JS应用程序，并制作了它的docker映像。我启动了该映像的4个容器，并将容器端口发布到系统的4个不同端口。你可以使用你的后端应用程序，甚至不需要创建它的docker映像。只需在不同的端口上启动服务器。我已经在端口2222、3333、4444、5555上启动了服务器。<a class="ae kc" href="https://github.com/subhrapaladhi/Docker-Node-App" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">在这里结账我的节点JS app</strong></a></p><p id="588e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在在你的系统上安装Nginx。我们必须对决定Nginx行为的<code class="fe lu lv lw lx b">nginx.conf</code>文件进行修改。找到nginx.conf，在Linux中，一般在<code class="fe lu lv lw lx b">/etc/nginx/</code>中。<strong class="kf ir">对现有的<code class="fe lu lv lw lx b">nginx.conf</code>文件进行备份</strong>并清除原文件的内容。</p><p id="773a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的后端应用程序有这4条路线。他们有不同的需求，因此我可以向您展示负载平衡的各种应用</p><p id="79be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lu lv lw lx b">1.<a class="ae kc" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">http://localhost:PORT/</strong></a></code>:该路由应该在所有端口之间实现负载平衡。</p><p id="e978" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回复:<code class="fe lu lv lw lx b">hello from a lightweight container. App ID = ${PORT}</code></p><p id="8f35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lu lv lw lx b">2.<a class="ae kc" href="http://localhost:3000/app1" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">http://localhost:PORT/app1</strong></a></code>:此路由应该在端口2222和3333之间实现负载平衡</p><p id="3789" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回应:<code class="fe lu lv lw lx b">this is app1. App ID = ${PORT}</code></p><p id="e744" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lu lv lw lx b">3.<a class="ae kc" href="http://localhost:3000/app1" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">http://localhost:PORT/app</strong></a><strong class="kf ir">2</strong></code>:此路由应该在端口4444和5555之间实现负载平衡。</p><p id="d76c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回应:<code class="fe lu lv lw lx b">this is app2. App ID = ${PORT}</code></p><p id="615e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lu lv lw lx b">4.<a class="ae kc" href="http://localhost:3000/admin" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">http://localhost:PORT/admin</strong></a></code>:该路由不能从端口80(HTTP使用的端口)访问。</p><p id="c348" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回应:<code class="fe lu lv lw lx b">admin page. . App ID = ${PORT}</code></p><p id="5549" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们来看看<code class="fe lu lv lw lx b">nginx.conf</code>。看评论了解流程。</p><figure class="lj lk ll lm gt jr"><div class="bz fp l di"><div class="ly lz l"/></div></figure></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="d385" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是我的后端应用程序得到的结果。</p><ol class=""><li id="b7bd" class="ma mb iq kf b kg kh kk kl ko mc ks md kw me la mf mg mh mi bi translated">对于路线<code class="fe lu lv lw lx b"><a class="ae kc" href="http://localhost/" rel="noopener ugc nofollow" target="_blank">http://localhost/</a></code></li></ol><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/d554ccc60e264fe7d1e88ae2e3d78455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*Dh0PB3vCtBWnSLSTiuJ95Q.png"/></div></figure><p id="01d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.对于路线<code class="fe lu lv lw lx b">http://localhost/app1</code></p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/526be241e84701c952c39722c5c2ea00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*tPwYmswK0ILte9CTUnavTw.png"/></div></figure><p id="8270" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.对于路线<code class="fe lu lv lw lx b"><a class="ae kc" href="http://localhost/app2" rel="noopener ugc nofollow" target="_blank">http://localhost/app2</a></code></p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/83b4955b808e7cbe5bc7541e7b582051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*iGzbNl_e1JIXhrSxBZEArg.png"/></div></figure><p id="d350" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.对于路线<code class="fe lu lv lw lx b"><a class="ae kc" href="http://localhost/admin" rel="noopener ugc nofollow" target="_blank">http://localhost/admin</a></code></p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/da65d088cc9f9161b74b79a0f9bb5996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*2-Kwb4K8_oEU1mol0aVaKA.png"/></div></figure></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="62ff" class="mn mo iq bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">资源和参考资料</h1><ol class=""><li id="2a59" class="ma mb iq kf b kg nl kk nm ko nn ks no kw np la mf mg mh mi bi translated"><a class="ae kc" href="https://www.youtube.com/watch?v=WC2-hNNBWII" rel="noopener ugc nofollow" target="_blank"> NginX速成班(第4层&amp;第7层代理，HTTPS，TLS 1.3，HTTP/2 &amp;更多)</a>作者<a class="ae kc" href="https://www.youtube.com/channel/UC_ML5xP23TOWKUcc-oAE_Eg" rel="noopener ugc nofollow" target="_blank"> Hussein Nasser </a></li></ol><p id="d77a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.<a class="ae kc" href="https://www.nginx.com/resources/glossary/layer-7-load-balancing/" rel="noopener ugc nofollow" target="_blank">什么是第7层负载均衡？</a></p><div class="nq nr gp gr ns nt"><a href="https://www.nginx.com/resources/glossary/layer-7-load-balancing/" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">第7层负载平衡的优势| NGINX负载平衡器</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">在开放系统互连(OSI)参考模型中，可以在不同的层执行负载平衡，以便…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">www.nginx.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh jw nt"/></div></div></a></div><p id="e719" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.<a class="ae kc" href="https://github.com/subhrapaladhi/Docker-Node-App" rel="noopener ugc nofollow" target="_blank"> Docker节点app。</a></p><div class="nq nr gp gr ns nt"><a href="https://github.com/subhrapaladhi/Docker-Node-App" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">subhrapaladhi/Docker-Node-App</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">一个简单的节点服务器应用。curl " http://localhost:3000/" Res:hello来自一个轻量级容器。应用ID = ${PORT} curl…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="oi l oe of og oc oh jw nt"/></div></div></a></div><p id="1af9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.使用Nginx实现负载平衡。</p><div class="nq nr gp gr ns nt"><a href="https://github.com/subhrapaladhi/Loadbalancing-with-Nginx" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">subhrapaladhi/使用-Nginx进行负载平衡</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">节点应用程序存储库为节点应用程序创建docker映像，并启动所需数量的容器。放…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="oj l oe of og oc oh jw nt"/></div></div></a></div></div></div>    
</body>
</html>