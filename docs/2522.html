<html>
<head>
<title>Building a Serverless email client for AWS SES</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为AWS SES构建无服务器电子邮件客户端</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-serverless-email-client-for-aws-ses-933234244f3c?source=collection_archive---------3-----------------------#2020-07-02">https://javascript.plainenglish.io/building-a-serverless-email-client-for-aws-ses-933234244f3c?source=collection_archive---------3-----------------------#2020-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6d52" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何管理您的电子邮件，获得无限的电子邮件id，改变您与收件箱的联系方式，并在Amazon sca  le从收件箱中挖掘可行的见解</h2></div><p id="8010" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">自2006年3月推出以来，AWS已经成长为其母公司的克隆体，尽管是在软件领域，也就是说，AWS现在相当于云服务和计算服务的<a class="ae lc" href="https://en.wikipedia.org/wiki/The_Everything_Store" rel="noopener ugc nofollow" target="_blank">百货店</a>。</p><p id="4fa2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在本文中，我们特别感兴趣的是AWS提供的简单电子邮件服务(SES)。</p><p id="e4b0" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">以下是SES可以为我们做的:<em class="ld">【SES】是一个电子邮件平台，为您提供一种简单、经济的方式，让您使用自己的电子邮件地址和域名发送和接收电子邮件。</em></p><p id="35e8" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">当AWS SES首次推出时，它仅限于代表我们发送电子邮件。这里有一个来自2011年的ServerFault帖子的<a class="ae lc" href="https://serverfault.com/a/338365/415326" rel="noopener ugc nofollow" target="_blank">回复，有人在那里询问通过SES接收电子邮件的方法。</a></p><p id="7e67" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><em class="ld">亚马逊的SES严格用于发送电子邮件。如果你想接收电子邮件，你必须在EC2服务器实例上设置一个邮件传输代理(MTA ),如Sendmail、Postfix、Qmail等，并将你的DNS MX记录指向该实例。</em></p><p id="9c31" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">从推出到2015年，SES一直是一项只发送的服务。</p><p id="262a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">2015年，SES为收到的邮件增加了一种做事的方式。</p><p id="b1f2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">因为，在它的核心，SES仍然是一个电子邮件规模的服务，你只能以准程序化的方式与收到的电子邮件进行交互。</p><h2 id="d02e" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">处理收到的电子邮件</h2><p id="2c1d" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">SES不是让你像Gmail或Outlook一样阅读收到的邮件，而是让你在接收邮件时做三件基本的事情:</p><ol class=""><li id="f107" class="mc md iq ki b kj kk km kn kp me kt mf kx mg lb mh mi mj mk bi translated">在S3保存收到的邮件</li><li id="65a4" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">向监听者发送社交网络通知</li><li id="7cbf" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">触发Lambda函数</li></ol><p id="ad47" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如你所见，这些解决方案都不太人性化。SES仍然是一种不是为人类使用而设计的事务性服务。</p><p id="9540" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">他们的<a class="ae lc" href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/receiving-email.html" rel="noopener ugc nofollow" target="_blank">关于接收电子邮件的文档</a>间接地告诉了我们这一点。</p><blockquote class="mq"><p id="d852" class="mr ms iq bd mt mu mv mw mx my mz lb dk translated">Amazon SES不包括接收电子邮件的POP或IMAP服务器</p></blockquote><p id="f98c" class="pw-post-body-paragraph kg kh iq ki b kj na jr kl km nb ju ko kp nc kr ks kt nd kv kw kx ne kz la lb ij bi translated">没有POP或IMAP意味着没有电子邮件客户端，因此，没有人类友好的方式来查看收到的电子邮件。</p><p id="84ed" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">POP代表邮局协议，而IMAP代表互联网消息访问协议。这两种协议都支持从服务器访问电子邮件。为了发送电子邮件，电子邮件客户端使用SMTP，但是因为这篇文章是关于接收电子邮件的，我们现在将忽略SMTP。</p><p id="26e8" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir"> <em class="ld">注</em> </strong>:从技术上来说，你可以以4美元/用户/月的价格购买一个<a class="ae lc" href="https://aws.amazon.com/workmail/" rel="noopener ugc nofollow" target="_blank">亚马逊工作邮件</a>账户来接收SES邮件，但我已经使用工作邮件两年多了，我可以告诉你，你最好把你的邮件钱花在别的地方。</p><h2 id="7d6f" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">建议</h2><p id="8ac1" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">现在，我们对AWS SES有了一个大致的了解，接下来就可以讨论为SES创建电子邮件客户端的可能性了。</p><p id="7399" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这个电子邮件客户端将下载并在浏览器上显示保存在S3的电子邮件，而不是依赖于无论如何都不可用的POP或IMAP。</p><h2 id="9749" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">问题</h2><p id="1fda" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">要实现这个电子邮件客户端，我们必须克服SES强加给我们的某些限制:</p><ol class=""><li id="0077" class="mc md iq ki b kj kk km kn kp me kt mf kx mg lb mh mi mj mk bi translated">没有POP/IMAP——如上所述，由于SES没有为我们提供POP/IMAP服务，我们已经编写了自己的API来下载电子邮件</li><li id="956a" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">电子邮件接收于。eml格式。虽然您可以重命名. eml文件，但是只有IE本身可以打开该文件。eml文件到。mht并在任何浏览器中打开它。</li><li id="f00e" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">在S3，电子邮件文件以一个长(41个字符)字母数字字符串保存，文件名没有可识别的模式。因此，您可能首先会收到一封电子邮件，文件名为<em class="ld">82 vendohoan 4 Rb 4 poes 26 r 8 RDA 5s b5 vbg H9 s 3c C1</em>，然后是<em class="ld">7 EPE 24 edptua 4 mjepr 8 hlhypt 444 c0krvkkrn 181</em>。</li><li id="78f9" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">所有电子邮件元数据(如发送时间、发送对象、主题等)都存储在电子邮件文件本身中。您必须解析电子邮件文件来提取这些信息。</li></ol><h2 id="4802" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">解决办法</h2><p id="6043" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">总体而言，我们的战略如下:</p><ol class=""><li id="354d" class="mc md iq ki b kj kk km kn kp me kt mf kx mg lb mh mi mj mk bi translated">设置一种在S3按接收日期降序存储电子邮件的方式。我们需要这样做，以便按照正确的接收顺序向用户显示电子邮件。这解决了问题3。这个函数的源代码是<a class="ae lc" href="https://github.com/psiCode/ses-email-client/blob/master/lambdas/rename-eml-file-s3.js" rel="noopener ugc nofollow" target="_blank">@这里</a></li><li id="4988" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">从提取电子邮件元数据和内容。eml文件。这解决了问题4，这样一来，问题2就没有实际意义了。对于这个任务，我们使用优秀的<a class="ae lc" href="https://github.com/nodemailer/mailparser" rel="noopener ugc nofollow" target="_blank">邮件解析器</a>模块。</li><li id="d541" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">创建两个API——一个按照收到日期的降序返回收到的电子邮件列表(<a class="ae lc" href="https://github.com/psiCode/ses-email-client/blob/master/lambdas/get-eml-file-ids-s3.js" rel="noopener ugc nofollow" target="_blank"> <em class="ld">源代码</em> </a>)，另一个返回电子邮件的元数据和内容(<a class="ae lc" href="https://github.com/psiCode/ses-email-client/blob/master/lambdas/get-eml-contents.js" rel="noopener ugc nofollow" target="_blank"> <em class="ld">源代码</em> </a>)。这解决了问题1。</li></ol><figure class="ng nh ni nj gt nk gh gi paragraph-image"><div role="button" tabindex="0" class="nl nm di nn bf no"><div class="gh gi nf"><img src="../Images/0a3b655a28cc0919dd6e2cc0c51c10f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBJaO1XGOdA7_cqTfFa9_A.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Architecture diagram</figcaption></figure><p id="46fa" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">完成后，最后一步是创建基于浏览器的UI，以:</p><ol class=""><li id="c455" class="mc md iq ki b kj kk km kn kp me kt mf kx mg lb mh mi mj mk bi translated">请求已接收邮件的列表</li><li id="69df" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">对于上面列表中的每封电子邮件，请求元数据和内容</li><li id="928b" class="mc md iq ki b kj ml km mm kp mn kt mo kx mp lb mh mi mj mk bi translated">在浏览器中显示元数据和内容</li></ol><p id="97a7" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">浏览器UI的源代码是<a class="ae lc" href="https://github.com/psiCode/ses-email-client/tree/master/email" rel="noopener ugc nofollow" target="_blank">@此处</a>。完整的源代码在<a class="ae lc" href="https://github.com/psiCode/ses-email-client" rel="noopener ugc nofollow" target="_blank"> Github </a>上。</p><figure class="ng nh ni nj gt nk gh gi paragraph-image"><div role="button" tabindex="0" class="nl nm di nn bf no"><div class="gh gi nv"><img src="../Images/7086efd895640e4fbcf5d5cbc73325c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOw0lrLE9ADvf73ITCQE7Q.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">This is what the client looks like!</figcaption></figure><h2 id="0dc0" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">限制</h2><p id="6e93" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">客户端只显示收到的邮件<code class="fe nw nx ny nz b">today.</code>，这意味着它只显示收到的邮件<code class="fe nw nx ny nz b">today</code>和<code class="fe nw nx ny nz b">today-1</code>。</p><p id="9dbc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">结果限于最近收到的100封电子邮件<code class="fe nw nx ny nz b">today</code>。还有<code class="fe nw nx ny nz b">today-1.</code></p><h2 id="8896" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">其他增强功能</h2><p id="5c51" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">其他实现的无关增强包括使用AWS Cognito来控制对电子邮件客户端的访问。毕竟，你不想让全世界都看到你的邮件，对吧？</p><p id="d82a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">UI是使用Foundation CSS和Vuejs构建的。</p><h1 id="037c" class="oa lf iq bd lg ob oc od lj oe of og lm jw oh jx lp jz oi ka ls kc oj kd lv ok bi translated">结论</h1><p id="7060" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">这种只读客户端填补了我们与SES交互方式的一大空白。从历史上看，SES一直是基础架构级别的产品，也就是说，它不适合人类友好的使用情形。</p><p id="6afd" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">有了这个电子邮件客户端，我们开始了将SES带入人类可用性空间的过程。</p><h2 id="90d9" class="le lf iq bd lg lh li dn lj lk ll dp lm kp ln lo lp kt lq lr ls kx lt lu lv lw bi translated">我们能从这里去哪里</h2><p id="382d" class="pw-post-body-paragraph kg kh iq ki b kj lx jr kl km ly ju ko kp lz kr ks kt ma kv kw kx mb kz la lb ij bi translated">既然我们可以直接访问自己的电子邮件，而不需要像Gmail或Microsoft Outlook这样的邮件提供商的介入，我们可以开始以不同的方式想象我们的收件箱。</p><p id="9428" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">最简单的改进可能是为我们的域名获取无限的电子邮件，以帮助摆脱监视资本主义，它使用我们的电子邮件id作为数据点来描述我们。</p><p id="2b95" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">通过一次只显示有限数量的电子邮件，我们可以改善我们与收件箱的关系，减少我们看到数百封电子邮件时的焦虑。</p><p id="46cc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">随着对电子邮件的更好控制，我们可以开始重新想象我们的电子邮件是如何呈现给我们的。我们可以将电子邮件显示为博客文章，或者显示收件箱的文字云。</p><p id="1486" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">API对电子邮件内容和元数据的访问使我们能够从收件箱中挖掘可操作的见解。</p></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><p id="a31f" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">选择是无穷无尽的。只需要一些想象力。</p></div></div>    
</body>
</html>