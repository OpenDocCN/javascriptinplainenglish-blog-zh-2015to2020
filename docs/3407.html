<html>
<head>
<title>Best Features of ES2018— Async Iteration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ES2018的最佳特性—异步迭代</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/best-features-of-es2018-async-iteration-be383df9635e?source=collection_archive---------8-----------------------#2020-09-26">https://javascript.plainenglish.io/best-features-of-es2018-async-iteration-be383df9635e?source=collection_archive---------8-----------------------#2020-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a23a1b865ad7e523a8d3b6a830b5f6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8xmnh3T21ruIwyeN"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@srz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">sydney Rae</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="891a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2015年以来，JavaScript有了巨大的进步。</p><p id="c894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在用起来比以前舒服多了。</p><p id="193a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解ES2018的最佳特性。</p><h1 id="02c5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">异步迭代</h1><p id="2777" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在ES6中，JavaScript引入了for-of循环。</p><p id="869a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它让我们同步迭代可迭代对象。</p><p id="59cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，没有办法异步迭代。</p><p id="87dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ES2018引入了异步迭代功能来填补这一空白。</p><p id="b0af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同步迭代适用于任何具有<code class="fe me mf mg mh b">Symbol.iterator</code>方法的对象，这是一种生成器方法。</p><p id="92bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当调用<code class="fe me mf mg mh b">next</code> next方法时，它按顺序返回每一项。</p><p id="f3fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">返回的对象具有从生成器返回的值，这是迭代器命中的当前条目。</p><p id="3767" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还具有<code class="fe me mf mg mh b">done</code>属性来指示是否所有th值都已返回。</p><p id="3be7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8a78" class="mq lc iq mh b gy mr ms l mt mu">const iterable = ['foo', 'bar'];<br/>const iterator = iterable[Symbol.iterator]();</span></pre><p id="939b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们打电话时:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e43a" class="mq lc iq mh b gy mr ms l mt mu">iterator.next()</span></pre><p id="130a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一次，我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8257" class="mq lc iq mh b gy mr ms l mt mu">{ value: 'foo', done: false }</span></pre><p id="55b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们再次调用它时，我们得到；</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6056" class="mq lc iq mh b gy mr ms l mt mu">{ value: 'b', done: false }</span></pre><p id="0917" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们再次调用它时，我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a1b6" class="mq lc iq mh b gy mr ms l mt mu">{ value: undefined, done: true }</span></pre><p id="1d15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">迭代是同步的，所以我们不能异步迭代。</p><p id="e0f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们希望能够逐个调用可迭代对象中的承诺。</p><p id="06e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可以通过for-await-of循环来解决。</p><p id="0dd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以这样使用它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="31d1" class="mq lc iq mh b gy mr ms l mt mu">async function main() {<br/>  const arr = [<br/>    Promise.resolve('foo'),<br/>    Promise.resolve('bar'),<br/>  ];<br/>  for await (const x of arr) {<br/>    console.log(x);<br/>  }<br/>}<br/>main();</span></pre><p id="21c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一系列的承诺，我们迭代通过。</p><p id="271c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们会被一个接一个地运行。</p><p id="913f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们得到:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2114" class="mq lc iq mh b gy mr ms l mt mu">foo<br/>bar</span></pre><p id="0f07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记录在控制台日志中。</p><p id="68ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">for-await-of循环也适用于同步可重复项。</p><p id="835d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d2ac" class="mq lc iq mh b gy mr ms l mt mu">async function main() {<br/>  for await (const x of ['foo', 'bar']) {<br/>    console.log(x);<br/>  }<br/>}<br/>main();</span></pre><p id="8c65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们记录了同样的结果。</p><h1 id="3c6e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">异步发电机</h1><p id="280f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">异步生成器让我们创建异步可迭代的。</p><p id="ae32" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">异步生成器只是一个返回承诺的生成器函数。</p><p id="6f3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以通过编写以下代码来创建一个异步生成器函数:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="860f" class="mq lc iq mh b gy mr ms l mt mu">async function* createAsyncIterable(arr) {<br/>  for (const elem of arr) {<br/>    yield elem;<br/>  }<br/>}</span></pre><p id="2ae3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">普通生成器返回一个生成器对象。</p><p id="2db5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每次调用<code class="fe me mf mg mh b">next</code>方法都会返回一个具有属性<code class="fe me mf mg mh b">value</code>和<code class="fe me mf mg mh b">done</code>的对象。</p><p id="05f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">异步生成器返回一个生成器对象。</p><p id="6dd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个<code class="fe me mf mg mh b">next</code>调用返回一个具有属性<code class="fe me mf mg mh b">value</code>和<code class="fe me mf mg mh b">done</code>的对象的承诺。</p><p id="e4c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们调用一个异步生成器时，JavaScript引擎将在调用下一个之前等待承诺被解决。</p><p id="f4b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个异步发电机都有一个队列，承诺用<code class="fe me mf mg mh b">yield</code>或<code class="fe me mf mg mh b">throw</code>解决。</p><p id="0954" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当<code class="fe me mf mg mh b">next</code>被调用时，一个承诺被排队。</p><p id="7a5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除非异步生成器已经在运行，否则它会继续运行并等待承诺完成。</p><p id="8817" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以用<code class="fe me mf mg mh b">yield</code>、<code class="fe me mf mg mh b">throw</code>或<code class="fe me mf mg mh b">return await</code>结束。</p><p id="8807" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦完成，承诺就会被退回。</p><p id="fcce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">约定承诺的结果以异步方式交付。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/40fd8bad4b4d32c783c409f31e2a82d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KVRGCiqrBYobbho1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@gcsgpp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Gabriel Gusmao</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="03e1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2f04" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">for-await-of循环让我们通过顺序返回每个值的承诺来遍历异步生成器。</p><h2 id="e61a" class="mq lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated"><strong class="ak">用简单英语写的JavaScript</strong></h2><p id="579f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅获取更多类似内容解码，我们的YouTube频道</strong> </a> <strong class="kf ir">！</strong></p></div></div>    
</body>
</html>