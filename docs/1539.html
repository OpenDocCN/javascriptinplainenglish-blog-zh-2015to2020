<html>
<head>
<title>Why should you start using globalThis property in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么应该在JavaScript中开始使用globalThis属性？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-should-you-start-using-globalthis-in-javascript-fe811151a8b?source=collection_archive---------4-----------------------#2020-03-29">https://javascript.plainenglish.io/why-should-you-start-using-globalthis-in-javascript-fe811151a8b?source=collection_archive---------4-----------------------#2020-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4437" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">简短、有用的JavaScript课程——让它变得简单。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/93104f50231140fdfc2d5c6a3db98197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKblSxV-sY5nPKmhqeGWaQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Here is an image with a f<a class="ae kv" href="https://www.pexels.com/es-es/foto/mujer-oficina-trabajando-ordenador-3861963/" rel="noopener ugc nofollow" target="_blank">emale software engineer coding on a computer.</a></figcaption></figure><p id="09c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在各种各样的环境中使用JavaScript，比如web浏览器、Node.js或Web Workers。每个环境都有自己的对象模型，并提供不同的语法来访问全局对象。在网络浏览器中，可通过<window>、<self>或<frame/>属性访问全局对象。在Web Workers中，只有<self>可用。在Node.js中，这些都不可用，你必须使用<global>。</global></self></self></window></p><p id="7ff4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在浏览器中，您可以使用<window>对象:</window></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0a93" class="lx ly iq lt b gy lz ma l mb mc">window.setTimeout(() =&gt; console.log('Hello Rick'),1000);</span></pre><p id="b2de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是<window>在节点环境下不起作用。Node.js中的顶级作用域不是全局作用域，但是您可以使用等效的<global>关键字来访问全局对象:</global></window></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="8832" class="lx ly iq lt b gy lz ma l mb mc">global.setTimeout(() =&gt; console.log('Hello Rick'),1000);</span></pre><p id="5b9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题是，如果我们编写需要在不同环境下运行的代码，首先要检测它是在哪个情境下运行的，然后选择如何使用它。尽管如此，不同环境的列表可能会很长，并且检查哪个正在运行的方法可能会很棘手并且容易让人误解。</p><p id="c74b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解决这个问题的一个(错误的)方法是创建我们的<a class="ae kv" href="https://medium.com/javascript-in-plain-english/use-the-latest-javascript-features-in-any-browser-f047f5c426a8" rel="noopener"> polyfill </a>函数，负责返回适当的全局对象。</p><p id="f733" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个获取全局this对象的示例:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="dc7b" class="lx ly iq lt b gy lz ma l mb mc">const getGlobalThis = () =&gt; {</span><span id="3661" class="lx ly iq lt b gy md ma l mb mc">if (typeof globalThis !== 'undefined') return globalThis;<br/>  if (typeof self !== 'undefined') return self;<br/>  if (typeof window !== 'undefined') return window;<br/>  if (typeof global !== 'undefined') return global;</span><span id="12d9" class="lx ly iq lt b gy md ma l mb mc">//Note: this might return the wrong result.<br/>  if (typeof this !== 'undefined') return this;<br/>  throw new Error('Unable to locate global this object');</span><span id="094f" class="lx ly iq lt b gy md ma l mb mc">};</span><span id="f671" class="lx ly iq lt b gy md ma l mb mc"><em class="me">//Note: We use &lt;var&gt; to ensure 'globalThis' becomes</em><br/><em class="me">//a global variable when running in the global scope.</em></span><span id="5539" class="lx ly iq lt b gy md ma l mb mc">var globalThis = getGlobalThis();</span></pre><p id="c6b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是在其他问题中，这不能在非浏览器环境中的<strict mode="">函数或JavaScript模块中运行(不包括支持globalThis的浏览器)。此外，getGlobalThis可能会返回错误的结果，因为它依赖于上下文相关的<this>对象，并且可能会被类似<a class="ae kv" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>的捆绑器更改。</this></strict></p><p id="477b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是新的globalThis特性的用武之地。globalThis提案在撰写本文时处于第4阶段，它引入了一种集中式机制来在任何JavaScript环境中访问全局对象。因此，如果需要访问全局对象，必须使用globalThis属性。</p><p id="643b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近流行的浏览器都支持该功能，Node.js 12+也支持。</p><p id="dd29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用globalThis属性编写上面的代码:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="f86f" class="lx ly iq lt b gy lz ma l mb mc">globalThis.setTimeout(() =&gt; console.log('Hello Rick'), 1000);</span></pre><h2 id="2b1a" class="lx ly iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">结论</h2><p id="8754" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">需要注意的是，我们不能使用独占的环境函数，例如alert()函数。然而，这是一个实用的特性，可以帮助开发人员更容易地创建应用程序，并避免在不同环境中可能被忽略的错误。</p><p id="1913" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你喜欢这篇文章。非常感谢你阅读我！</p><h2 id="f75a" class="lx ly iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated"><strong class="ak">用简单英语写的JavaScript的注释:</strong></h2><p id="1c05" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">我们总是有兴趣帮助推广高质量的内容。如果你有一篇文章想用简单的英语提交给JavaScript，请用你的Medium用户名发邮件到<a class="ae kv" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>给我们，我们会把你添加为作者。</p></div></div>    
</body>
</html>