<html>
<head>
<title>Creative Uses of TypeScript Discriminated Unions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">打字稿歧视性联合的创造性使用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creative-uses-of-typescript-discriminated-unions-bec2c1c63f45?source=collection_archive---------10-----------------------#2020-03-08">https://javascript.plainenglish.io/creative-uses-of-typescript-discriminated-unions-bec2c1c63f45?source=collection_archive---------10-----------------------#2020-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c225" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我向您展示如何创造性地使用TypeScript的<a class="ae kl" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions" rel="noopener ugc nofollow" target="_blank">区别联合</a>、类型别名和函数，可以在您自己的代码中给予您更大程度的灵活性。</p><p id="1322" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将通过举例说明这些技术是如何解决我试图解决的问题的，然后谈谈如何应用这些技术的一些额外想法。</p><h1 id="e0b1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">我正在解决的问题</h1><p id="bdfa" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我正在构建一个基于文本的游戏，我将在今年春天做一些演讲。这是一种游戏，游戏引擎描述一些东西，然后玩家输入命令，比如<code class="fe lp lq lr ls b">look at the flowers</code>或<code class="fe lp lq lr ls b">hit the mushroom with the glowing red hammer</code>。</p><p id="2ed3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了做到这一点，我需要能够将游戏世界的部分表示为对玩家可以尝试的动词有基本反应的对象。</p><p id="e7fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很容易用一个简单的对象来表示，其中带有自定义响应的动词被定义为对象的字符串属性(<em class="lt">注意:在我的游戏中玩家是一只狗</em>):</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/c4677a613a6a88cf9dd3cff344fc86fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K2RvOm4ndP3YISnH"/></div></div></figure><p id="3b78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，使用上面的对象，引擎将对未在该对象上定义的动词给出默认响应(例如，吃或捡)。</p><p id="2e30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果我想让一个动词真正影响游戏世界呢？我需要更灵活一点的东西。</p><p id="964b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是受歧视的工会发挥作用的地方。</p><h1 id="3df7" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是歧视性工会？</h1><p id="0ee4" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">TypeScript中的区别联合是告诉TypeScript某件事将成为固定数量的可能性之一的一种方式。</p><p id="4c5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果我声明一个参数为<code class="fe lp lq lr ls b">x: string | number | boolean</code>，我会告诉TypeScript它应该期望<code class="fe lp lq lr ls b">x</code>是<code class="fe lp lq lr ls b">string</code>、一个<code class="fe lp lq lr ls b">number</code>或者一个<code class="fe lp lq lr ls b">boolean</code>。然后，TypeScript将检查我对<code class="fe lp lq lr ls b">x</code>的使用，以确保我使用的是每一个都通用的属性，或者进行必要的类型检查/转换。</p><p id="a676" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很有帮助的原因是，它允许您根据传入的值为事物指定简单的路径和复杂的路径。</p><h1 id="9d27" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">定义类型</h1><p id="d823" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">既然我们已经确定了什么是歧视性工会以及为什么它们可能会有所帮助，让我们看看我对<code class="fe lp lq lr ls b">GameObject</code>的定义。这是游戏世界中玩家可以潜在地与之交互的对象。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="8521" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先关注第4行的<code class="fe lp lq lr ls b">ObjectResponse</code>。这是用于表示对象上的动词处理程序的类型。例如，<code class="fe lp lq lr ls b">shoe</code>如何回应<code class="fe lp lq lr ls b">eat</code>动词。</p><p id="891e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将<code class="fe lp lq lr ls b">ObjectResponse</code>定义为一个<code class="fe lp lq lr ls b">ContextAction | string</code>，这意味着它要么是一个简单的字符串，表示要打印的描述，要么是一个由<code class="fe lp lq lr ls b">ContextAction</code>表示的更复杂的响应。</p><p id="157c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lp lq lr ls b">ContextAction</code>是一个自定义类型定义，它表示一个函数，接受一个<code class="fe lp lq lr ls b">CommandContext</code>对象(一个自定义域对象，表示世界的当前状态和一些基本的响应格式化功能)并返回<code class="fe lp lq lr ls b">void</code> (nothing)。</p><p id="9922" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这实际上是说，对象上的动词处理程序要么返回一个简单的字符串描述，要么是一个更复杂的函数，接受一个<code class="fe lp lq lr ls b">CommandContext</code>对象并对其进行处理。</p><p id="f620" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个实际例子，它使用两个签名在其<code class="fe lp lq lr ls b">push</code>和<code class="fe lp lq lr ls b">look</code>动词响应中执行更复杂的逻辑:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/b1bd5518d0e93ee3bba127831eeb86ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GnlpJXx8sqBY2x5X"/></div></div></figure><h1 id="0dc1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">解释不同类型的价值观</h1><p id="07e8" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">好吧，如果我们面对的是一个受歧视的工会，我们如何有效地与之合作？</p><p id="dc4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看一下这段TypeScript片段:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi gj"><img src="../Images/a30d2fd0958c0bcc618339928870481b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i4yku2cCEQ2wHh8u"/></div></div></figure><p id="6f60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们查询<code class="fe lp lq lr ls b">gameObject</code>看它是否有一个与<code class="fe lp lq lr ls b">verbName</code>同名的属性。如果<em class="lt">没有</em>出现，我们就添加动词的一般反应。</p><p id="a4f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果响应<em class="lt">是</em>存在，我们知道它是<code class="fe lp lq lr ls b">string</code>或<code class="fe lp lq lr ls b">ContextAction</code>，因此我们可以关闭该值的类型并适当地处理它。</p><p id="a07c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们通过将值转换为string来响应<code class="fe lp lq lr ls b">string</code>值，并使用<code class="fe lp lq lr ls b">context</code>上的方法来添加一条简单的消息。</p><p id="6c83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果值是<em class="lt">而不是</em> a <code class="fe lp lq lr ls b">string</code>，那么我们知道它将是一个<code class="fe lp lq lr ls b">ContextAction</code>并且将是一个带有签名的函数，它接受一个<code class="fe lp lq lr ls b">CommandContext</code>并返回<code class="fe lp lq lr ls b">void</code>。在这种情况下，我们只需调用函数并传入<code class="fe lp lq lr ls b">context</code>。</p><h1 id="322b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结束语</h1><p id="9812" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">希望这说明了有区别的联合和类型别名在处理各种场景中的有用性，并可能为您提供如何简化一些现有逻辑的想法。</p><p id="87d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我看到相似数据的模式或大量样板文件或重复代码的可能性时，我个人会考虑有区别的联合和使用函数。</p><p id="4e50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有区别的联合确实增加了代码的复杂性，但是在其他领域的简单性和灵活性方面，这个代价是值得的。最终决定取决于你，并且会根据你试图解决的问题而改变。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="0e23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">原载于2020年3月8日</em><a class="ae kl" href="https://killalldefects.com/2020/03/08/creative-uses-of-typescript-discriminated-unions/" rel="noopener ugc nofollow" target="_blank"><em class="lt">【https://killalldefects.com】</em></a><em class="lt">。</em></p></div></div>    
</body>
</html>