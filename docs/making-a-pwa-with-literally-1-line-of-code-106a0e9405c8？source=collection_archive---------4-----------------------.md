# 用一行代码制作 PWA

> 原文：<https://javascript.plainenglish.io/making-a-pwa-with-literally-1-line-of-code-106a0e9405c8?source=collection_archive---------4----------------------->

![](img/1a9b5921a5f8974e755afe79c0a06ce2.png)

就在 2020 年变成一场全球闹剧之前，我召集了几个朋友，我们一起想出了一个简单的小应用程序的想法，我们认为它会有所帮助。我们的应用程序被谦逊地称为冠状病毒应用程序，最终有超过 1500 万人在使用它，我相信这是有史以来使用最广泛的冠状病毒应用程序之一。

我喜欢网络。我喜欢艾滋。有什么不喜欢的，真的？使用 PWA，您只需要管理一个代码库。你的应用在任何地方都有效。而且你也不用把自己辛辛苦苦赚来的 30%的收入分给苹果和谷歌。

但是 PWAs 真的很奇怪。与此同时,*非常容易*开始，而*非常痛苦*一直进行下去。

## PWA 二分法

创建一个 JSON 文件，命名为 manifest.json，填写 Google 推荐的字段[。然后创建一个 JavaScript 文件，将其命名为 service-worker.js，](https://web.dev/add-manifest/)[从您的客户端代码注册它](https://developers.google.com/web/fundamentals/primers/service-workers/registration)。你完了。你有一个 PWA，它有点像单词。你花了几个小时去弄清楚所有的事情，花了 30 分钟去写代码。还不错。

从这里开始，事情开始走下坡路。

假设您想在代码中添加一个按钮，让用户在他们的设备上安装您的应用程序。作为参考，下面是[谷歌建议如何做](https://web.dev/customize-install/)。

> 1.监听`beforeinstallprompt`事件。
> 
> 2.保存`beforeinstallprompt`事件，这样它可以在以后用来触发安装流程。
> 
> 3.提醒用户您的 PWA 是可安装的，并提供一个按钮或其他元素来启动应用内安装流程。

感觉有点不舒服。但是很简单。

除了当你做了那件事，你已经完成了 2%的工作。

在 Windows/Chrome 上，`beforeinstallprompt`有时也会在每个会话中发出几次。有时在应用程序安装完成后*。也就是说，依靠该事件，你可以要求用户安装应用程序…在他们安装之后。在 iOS/Safari 上，它根本不会被触发。所以你甚至没有机会告诉你的用户你的应用是可以安装的。*

甚至在 Chrome 上——当`beforeinstallprompt`被触发时，意味着应用程序是可安装的。但是当它……*没有被解雇*又意味着什么呢？是不是意味着 app 不能安装了？还是已经安装了应用程序？在我等待`beforeinstallprompt`到*触发*或者*不触发的时候，我应该怎么处理我的安装按钮呢？*

或者我们也可以谈谈`appinstalled`事件。如果不是因为这个事件在 iOS/Safari 或 Android/Samsung Internet 上根本不会被触发，这真的很有用。安装应用程序后，您可能想要隐藏或禁用安装按钮。当你甚至不确定应用程序是否已经安装时，你该怎么做呢？

## 这有点糟糕，但这不是任何人的错

当谈到 PWAs 时，Google 是参考。因此，如果您自己创建了一个，您可能会阅读他们的文档。这很好，除了它真的只对 Chrome 的有好处。

当然，这是公平的。你不能指望谷歌为不属于他们的浏览器写文档。

其实 PWAs 最大的优点也是它最大的弱点。由于应用程序生活在开放的网络上，没有人真正控制格式。当没有人控制时，事情往往会变得一团糟。

## 史上最无聊的轮子

让冠状病毒应用程序成为 PWA 感觉非常笨拙。这么多边缘案件要处理。这么多奇怪的代码。同一个 logo 要创作这么多版本。

哦，是的，当我改变我的标志时会发生什么？我应该记住它在我的 HTML 文档的 meta 标记中，但也在我的 JavaScript 中的某个地方被引用，以动态创建 iOS 需要的资产吗？两年后我不会记得这件事。

在网络上……事情在发展。相当快。因此，如果明天苹果、三星或谷歌做出改变，我必须 1-想办法确保我意识到这一点，2-相应地重写我的代码。

在构建冠状病毒应用程序时，我记得我经常想:*为什么我必须做所有这些工作？*

我的 PWA 本质上只有 4 个变量:一个名称、一个域名、一种颜色和一个标志(我在这里简化了一点，但是你明白了)。我想告诉某人我的 4 个变量是什么。并且让那个*某人*弄清楚*其余的*。

剩下的工作就是编写代码来解决一些无聊的问题，这些问题一定是其他地方的其他开发人员已经解决了的——而且很可能是以完全相同的方式。

女士们先生们，这就是所谓的*重新发明轮子*。虽然重新发明一些轮子来了解事物的工作原理很有趣，但这个特殊的轮子一点也不有趣。也没有教会你任何有价值的东西。

## 这让我很生气。

所以既然我下定决心要解决这个问题，我想我也可以试着为其他人解决这个问题。这正是我对进步人士 T2 所做的。

使用 Progressier，构建 PWA 正是我上面描述的内容。你告诉平台你的 4 个变量。就是这样。该软件在正确的位置以正确的大小生成正确的资产。当 Google 或 Apple 做出更改时，我们会更新我们的代码，而不是您的代码，因此您的网站上总是有最新的 PWA 实现。再见，维修。

让我们回到上面的安装按钮例子。以下是如何使用 Progressier 的方法:

`<button class="progressier-install-button"></button>`

你不必处理用户在 iOS 上时发生的事情。或者其设备与 PWAs 不兼容。或者已经安装了您的应用程序。别管那些废话了。Progressier 为您处理此事。就这样，你把*两周的工作*变成了 *25 秒的工作*。

这只是 Progressier 所做的一个例子。它还可以自动跟踪应用程序的安装，让您设置规则来决定何时推广您的 PWA 安装，生成所有正确的徽标，等等。这还只是第一版。推送通知、离线、缓存策略、自动化应用商店提交——路线图中有很多非常酷的东西。

## 准备好了吗？

艾滋病人的美妙之处在于他们在任何地方都能工作。PWAs 丑陋的一面是，实现这一点需要付出巨大的努力，而且大多没有记录在案。

所以帮你自己一个忙，[注册一个 Progressier 账户](https://progressier.com/signup)，用它替换你的硬编码 PWA 实现，让我来替你处理那些无聊的事情。它只需要一行代码。占用你两分钟时间。还有你的 0 美元。

喜欢这篇文章吗？如果有，通过 [**订阅我们的 YouTube 频道**](https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true) **获取更多类似内容！**