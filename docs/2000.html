<html>
<head>
<title>Decorator based reactive forms in Angular — An efficient way to validate forms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular中基于装饰器的反应式表单——一种有效的表单验证方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/decorator-based-reactive-forms-in-angular-an-efficient-way-to-validate-forms-1cdc11a0918d?source=collection_archive---------4-----------------------#2020-05-11">https://javascript.plainenglish.io/decorator-based-reactive-forms-in-angular-an-efficient-way-to-validate-forms-1cdc11a0918d?source=collection_archive---------4-----------------------#2020-05-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/77f776250ec6a79401b9583870006ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMJnj0EQMXZc-BrPi2r-zw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Image is taken from <a class="ae jz" href="https://burst.shopify.com/" rel="noopener ugc nofollow" target="_blank">burst</a></figcaption></figure><p id="786c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在Angular中处理表单时，我们有两种选择:-</p><ul class=""><li id="69ef" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">模板驱动的表单</li><li id="0669" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">基于模型的<strong class="kc io">反应形式</strong></li></ul><p id="52b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据表单的复杂程度，每种表单都有自己的用例。</p><ul class=""><li id="fb9e" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">模板驱动的表单在登录和注册这样简单的表单时很有用，但是它们没有反应式表单那么大。如果您有非常基本和简单的需求，请使用模板驱动的表单。这里的主要缺点是，没有组件内部的表单模型，单元测试是相当复杂的。</li><li id="16a0" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><strong class="kc io">反应式表单</strong>更加健壮，因为它们更具可伸缩性、可重用性和可测试性。大部分繁重的工作都是通过将输入字段的实例放在模板上从组件类中完成的，这使得单元测试更容易。如果您使用具有复杂业务逻辑的大型面向数据的表单，请始终使用反应式表单。</li></ul><p id="ac07" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将讨论基于decorator的验证的反应式表单方法。但是在开始之前，我先解释一下如何在没有装饰器的情况下工作。</p><h1 id="83ea" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">不带装饰器</strong></h1><h2 id="eacc" class="mk ln in bd lo ml mm dn ls mn mo dp lw kl mp mq ma kp mr ms me kt mt mu mi mv bi translated">1)导入反应式模块</h2><p id="791f" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">首先，我们需要在app.module.ts中导入<a class="ae jz" href="https://angular.io/docs/ts/latest/api/forms/index/ReactiveFormsModule-class.html" rel="noopener ugc nofollow" target="_blank"> ReactiveFormsModule </a>。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">app.module.ts</figcaption></figure><h2 id="efd1" class="mk ln in bd lo ml mm dn ls mn mo dp lw kl mp mq ma kp mr ms me kt mt mu mi mv bi translated">2)模板:formGroup，formControlName &amp; ngSubmit</h2><p id="9bb2" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">对于反应式表单，大部分工作被委托给组件类，因此模板文件更加简单明了。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">reactive-form.component.html</figcaption></figure><h2 id="74b1" class="mk ln in bd lo ml mm dn ls mn mo dp lw kl mp mq ma kp mr ms me kt mt mu mi mv bi translated"><strong class="ak"> 3)组件类别</strong></h2><p id="d91a" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated"><strong class="kc io"> NgSubmit </strong> —这是提交表单时将触发的事件。</p><p id="101b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">表单控件</strong>—<code class="fe nh ni nj nk b"><a class="ae jz" href="https://angular.io/docs/ts/latest/api/forms/index/FormControl-class.html" rel="noopener ugc nofollow" target="_blank">FormControl</a></code>方便了单个表单控件，跟踪值和验证状态，还表示视图中的输入。第一个参数是默认值，第二个是验证器数组。</p><p id="37cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> FormGroup </strong> — A <code class="fe nh ni nj nk b">FormGroup</code>将每个子<code class="fe nh ni nj nk b"><a class="ae jz" href="https://angular.io/api/forms/FormControl" rel="noopener ugc nofollow" target="_blank">FormControl</a></code>的值聚集到一个对象中，每个控件名作为键。它通过减少其子节点的状态值来计算其状态。例如，如果一个组中的一个控件无效，则整个组都将无效。如果我们想创建一个复杂的值，我们也可以嵌套FormGroup。</p><p id="189a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> FormControlName </strong> —每个表单域应该有一个<code class="fe nh ni nj nk b">formControlName</code>指令，其值将是组件类中使用的名称。</p><p id="1d7e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，让我们在<code class="fe nh ni nj nk b">ngOnInit()</code>的控制器中创建表单。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">reactive-form.component.ts</figcaption></figure><p id="a1cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> OnSubmit </strong>输出显示我们如何访问表单的有效性和表单控制值。</p><h2 id="ec20" class="mk ln in bd lo ml mm dn ls mn mo dp lw kl mp mq ma kp mr ms me kt mt mu mi mv bi translated"><strong class="ak"> 4)当前表单验证的问题</strong></h2><ul class=""><li id="b16a" class="ky kz in kc b kd mw kh mx kl nl kp nm kt nn kx ld le lf lg bi translated">反应模块不是强类型的。</li><li id="fcf3" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在创建表单组时，我们不能通过验证将模型对象值直接映射到反应式表单。</li><li id="a0f0" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">我们必须手动配置每个属性的验证器。</li><li id="1bbd" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">如果有多个验证器，编写太多代码来管理FormControl的模板验证。</li></ul><blockquote class="no np nq"><p id="b340" class="ka kb nr kc b kd ke kf kg kh ki kj kk ns km kn ko nt kq kr ks nu ku kv kw kx ig bi translated"><strong class="kc io">注:- </strong>欲了解更多关于反应式表单的详细信息，请访问<a class="ae jz" href="https://angular.io/api/forms" rel="noopener ugc nofollow" target="_blank">https://angular.io/api/forms</a></p></blockquote><h1 id="3bdf" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">带装饰器</strong></h1><p id="dba6" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">我们将把<code class="fe nh ni nj nk b"><a class="ae jz" href="https://www.npmjs.com/package/@rxweb/reactive-form-validators" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">@rxweb/reactive-form-validators</strong></a></code> angular库用于基于装饰器的验证方法。</p><p id="8624" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是使用这个库的一些优点</p><ol class=""><li id="4758" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx nv le lf lg bi translated">使用基于模型的方法来构造反应式表单，只需在类属性上添加像<code class="fe nh ni nj nk b">@alpha()</code>、<code class="fe nh ni nj nk b">@required()</code>等装饰器。</li><li id="8384" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx nv le lf lg bi translated">模板端不需要额外的代码，组件中也不需要任何形式的自定义验证。</li></ol><h1 id="44a4" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">实施</strong></h1><p id="f16b" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">1) npm安装<code class="fe nh ni nj nk b"><a class="ae jz" href="https://www.npmjs.com/package/@rxweb/reactive-form-validators" rel="noopener ugc nofollow" target="_blank">@rxweb/reactive-form-validators</a></code></p><p id="115c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2)还需要在app.module中导入<code class="fe nh ni nj nk b"><strong class="kc io">RxReactiveFormsModule</strong></code></p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="bedb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3)使用<strong class="kc io"> app.module.ts </strong>中的<code class="fe nh ni nj nk b"><strong class="kc io">ReactiveFormConfig</strong></code> <strong class="kc io"> </strong>，使用set方法传递验证消息对象。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3804" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4)用各自的装饰者创建一个用户模型:-</p><p id="ad32" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nh ni nj nk b"><strong class="kc io">@required()</strong></code>:所有字段都应该是必填的。如果您想要一个定制消息，那么在装饰器中将<code class="fe nh ni nj nk b">message</code>作为一个参数传递。</p><pre class="nb nc nd ne gt nw nk nx ny aw nz bi"><span id="bdfb" class="mk ln in nk b gy oa ob l oc od">@required({message: 'Last Name is required'})</span><span id="5fa1" class="mk ln in nk b gy oe ob l oc od">lastName: string;</span></pre><p id="d7a6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nh ni nj nk b"><strong class="kc io">@alpha()</strong></code>:userName属性只接受字母。如果你想允许空白，那么在装饰器中把<code class="fe nh ni nj nk b">allowWhitespace</code>作为一个参数传递。</p><pre class="nb nc nd ne gt nw nk nx ny aw nz bi"><span id="8bb2" class="mk ln in nk b gy oa ob l oc od">@required()</span><span id="e765" class="mk ln in nk b gy oe ob l oc od">@alpha({ allowWhiteSpace: true })</span><span id="d9fd" class="mk ln in nk b gy oe ob l oc od">userName: string;</span></pre><p id="1bc0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nh ni nj nk b"><strong class="kc io">@minLength({ value: 8 })</strong></code>:密码属性的最小字符串长度必须为8个字符。</p><p id="d0f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nh ni nj nk b"><strong class="kc io">@compare({ fieldName: 'password' })</strong></code>:比较属性值应该与密码属性值相同。</p><blockquote class="no np nq"><p id="5620" class="ka kb nr kc b kd ke kf kg kh ki kj kk ns km kn ko nt kq kr ks nu ku kv kw kx ig bi translated"><strong class="kc io">注意:- </strong>这些只是一些装饰器，仅用于演示目的。更多可用装饰者的详细列表，请访问:-<a class="ae jz" href="https://github.com/rxweb/rxweb/tree/master/packages/reactive-form-validators/decorators" rel="noopener ugc nofollow" target="_blank"><strong class="kc io">https://github . com/rx web/rx web/tree/master/packages/reactive-form-validators/decorators</strong></a></p></blockquote><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d592" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5)在<code class="fe nh ni nj nk b"><strong class="kc io">ngOnInit</strong></code>钩子中创建组件类并初始化用户模型实例，然后将其传递给<code class="fe nh ni nj nk b"><strong class="kc io">RxFormBuilder</strong></code>的<code class="fe nh ni nj nk b"><strong class="kc io">FormGroup</strong></code>。</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a673" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6)使用<code class="fe nh ni nj nk b">formGroup</code>、<code class="fe nh ni nj nk b">formControlName</code>、&amp;、<code class="fe nh ni nj nk b">ngSubmit</code>编写模板文件</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="b560" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">结论</strong></h1><p id="aa5e" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated"><code class="fe nh ni nj nk b"><a class="ae jz" href="https://www.npmjs.com/package/@rxweb/reactive-form-validators" rel="noopener ugc nofollow" target="_blank">@rxweb/reactive-form-validators</a></code>是一个非常健壮的库，可以满足angular中的所有表单验证需求。它不仅支持反应式表单，还通过<strong class="kc io">指令</strong>支持基于模板的验证。</p><p id="ac59" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是库文档中一个验证器的例子。</p><h2 id="71f5" class="mk ln in bd lo ml mm dn ls mn mo dp lw kl mp mq ma kp mr ms me kt mt mu mi mv bi translated"><code class="fe nh ni nj nk b">allOf</code></h2><p id="9a7a" class="pw-post-body-paragraph ka kb in kc b kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx ig bi translated">该验证将检查用户是否输入了给定字段的所有值。</p><blockquote class="no np nq"><p id="24cc" class="ka kb nr kc b kd ke kf kg kh ki kj kk ns km kn ko nt kq kr ks nu ku kv kw kx ig bi translated"><strong class="kc io"> <em class="in">无功形式验证</em> </strong></p></blockquote><pre class="nb nc nd ne gt nw nk nx ny aw nz bi"><span id="869b" class="mk ln in nk b gy oa ob l oc od">this.employeeInfoFormGroup = this.formBuilder.group({</span><span id="d545" class="mk ln in nk b gy oe ob l oc od">skills: [RxwebValidators.allOf({<br/>  matchValues: ["MVC", "AngularJS","AngularJS 5","C#"]<br/>})],</span><span id="ffbc" class="mk ln in nk b gy oe ob l oc od">});</span></pre><blockquote class="no np nq"><p id="f4bc" class="ka kb nr kc b kd ke kf kg kh ki kj kk ns km kn ko nt kq kr ks nu ku kv kw kx ig bi translated"><strong class="kc io"> <em class="in">模板表单验证</em> </strong></p></blockquote><pre class="nb nc nd ne gt nw nk nx ny aw nz bi"><span id="3e60" class="mk ln in nk b gy oa ob l oc od">&lt;input <strong class="nk io">id</strong>="skills" <strong class="nk io">name</strong>="skills" <strong class="nk io">type</strong>="checkbox" <strong class="nk io">value</strong>="{{tag.name}}" [(<strong class="nk io">ngModel</strong>)]="employee.skills" [<strong class="nk io">allOf</strong>]='{"matchValues":"MVC","AngularJS","AngularJS","C#"}'/&gt;</span></pre><blockquote class="no np nq"><p id="e722" class="ka kb nr kc b kd ke kf kg kh ki kj kk ns km kn ko nt kq kr ks nu ku kv kw kx ig bi translated"><strong class="kc io"> <em class="in">装饰器基础验证</em> </strong></p></blockquote><pre class="nb nc nd ne gt nw nk nx ny aw nz bi"><span id="166b" class="mk ln in nk b gy oa ob l oc od">@allOf({matchValues<strong class="nk io">:</strong> ["MVC", "AngularJS","Angular 5","C#"]}) skills<strong class="nk io">:</strong> string</span></pre></div><div class="ab cl of og hr oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ig ih ii ij ik"><p id="6fda" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想要完整的代码。这里是项目的<a class="ae jz" href="https://github.com/kaushiksamanta/angular-decorator-validation" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</p><h1 id="4ba3" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">资源</h1><ol class=""><li id="12c7" class="ky kz in kc b kd mw kh mx kl nl kp nm kt nn kx nv le lf lg bi translated"><a class="ae jz" href="https://www.npmjs.com/package/@rxweb/reactive-form-validators" rel="noopener ugc nofollow" target="_blank">https://www . npmjs . com/package/@ rx web/reactive-form-validators</a></li><li id="b19e" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx nv le lf lg bi translated"><a class="ae jz" href="https://medium.com/@oojhaajay/angular-reactive-form-validation-with-rxweb-validation-decorators-e943fa85d67c" rel="noopener">https://medium . com/@ oojhaajay/angular-reactive-form-validation-with-rx web-validation-decorators-e 943 fa 85d 67 c</a></li><li id="47bd" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx nv le lf lg bi translated"><a class="ae jz" href="https://angular.io/api/forms" rel="noopener ugc nofollow" target="_blank">https://angular.io/api/forms</a></li></ol></div></div>    
</body>
</html>