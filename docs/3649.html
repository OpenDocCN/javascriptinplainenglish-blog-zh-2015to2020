<html>
<head>
<title>Firebase + Nuxt, Role Based Authentication &amp; Authorization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase + Nuxtï¼ŒåŸºäºè§’è‰²çš„è®¤è¯å’Œæˆæƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/firebase-nuxt-role-based-authentication-authorization-a2eea9a1a586?source=collection_archive---------1-----------------------#2020-10-15">https://javascript.plainenglish.io/firebase-nuxt-role-based-authentication-authorization-a2eea9a1a586?source=collection_archive---------1-----------------------#2020-10-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1acf7432d9f4c84bddea077dbdb35aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Ui-OD1VfDBOewgz3Uj-8Q.png"/></div></div></figure><h2 id="fb39" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨<a class="ae kr" href="https://firebase.google.com/docs/auth/admin/custom-claims" rel="noopener ugc nofollow" target="_blank"> Authè‡ªå®šä¹‰å£°æ˜</a>æ¥è®¾ç½®ç”¨æˆ·è§’è‰²ï¼Œå¹¶åœ¨åˆ›å»ºæ–°çš„Firebaseç”¨æˆ·å¸æˆ·æ—¶å°†ç”¨æˆ·æ•°æ®å­˜å‚¨åˆ°äº‘Firestoreã€‚</h2><p id="325a" class="pw-post-body-paragraph ks kt in ku b kv kw kx ky kz la lb lc ke ld le lf ki lg lh li km lj lk ll lm ig bi translated">æ­¤å¤–ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨ç™»å½•æ—¶åŸºäºç”¨æˆ·è§’è‰²ä¿æŠ¤è·¯ç”±ã€‚</p><p id="df1b" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">æœ€åï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå½“ç™»å½•ç”¨æˆ·æ‹¥æœ‰ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå¦‚ä½•è·å–æ‰€æœ‰ç”¨æˆ·å¸æˆ·ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¯è°ƒç”¨çš„äº‘å‡½æ•°æ¥æ›´æ”¹ç”¨æˆ·è§’è‰²ã€‚</p><p id="c759" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">è¿™æ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„3ä¸ªç”¨æˆ·è§’è‰²:</strong></p><ul class=""><li id="0451" class="ls lt in ku b kv ln kz lo ke lu ki lv km lw lm lx ly lz ma bi translated"><strong class="ku io"> Admin </strong>è§’è‰²å¯ä»¥è®¿é—®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç”¨æˆ·ï¼Œå¹¶è¢«æˆäºˆä½¿ç”¨å®‰å…¨è§„åˆ™æ›´æ”¹ç”¨æˆ·è§’è‰²çš„æƒé™ã€‚</li><li id="eb68" class="ls lt in ku b kv mb kz mc ke md ki me km mf lm lx ly lz ma bi translated"><strong class="ku io">å®¢æˆ·</strong>è§’è‰²å°†æœ‰æƒè®¿é—®<strong class="ku io">å®¢æˆ·</strong>è§†å›¾ï¼Œå¹¶ä¸”å®ƒå°†è¢«è®¾ç½®ä¸ºé»˜è®¤è§’è‰²ï¼Œå› ä¸ºå¤§å¤šæ•°ç”¨æˆ·å°†å¤„äºè¯¥è§’è‰²ä¸‹ã€‚</li><li id="1ce9" class="ls lt in ku b kv mb kz mc ke md ki me km mf lm lx ly lz ma bi translated"><strong class="ku io">è®¢æˆ·</strong>è§’è‰²å°†æœ‰æƒè®¿é—®<strong class="ku io">è®¢æˆ·</strong>è§†å›¾ã€‚</li></ul><ol class=""><li id="995d" class="ls lt in ku b kv ln kz lo ke lu ki lv km lw lm mg ly lz ma bi translated"><strong class="ku io">å¯åŠ¨å¹¶è¿è¡ŒNuxté¡¹ç›®</strong></li></ol><p id="5f3d" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">æˆ‘å·²ç»ä½¿ç”¨<code class="fe mh mi mj mk b">npx create-nuxt-app &lt;name&gt;</code>åˆ›å»ºäº†ä¸€ä¸ª<a class="ae kr" href="https://github.com/alexkasongo/firebase-nuxt-role-based-auth" rel="noopener ugc nofollow" target="_blank">å¯åŠ¨é¡¹ç›®</a>ï¼Œå¹¶åœ¨src/pagesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºäº†å…­ä¸ªé¡µé¢ã€‚Nuxtå¤„ç†æ‰€æœ‰è·¯ç”±ã€‚æ‚¨å¯ä»¥å…‹éš†è¿™ä¸ªrepoå¹¶ä¸€èµ·ç¼–ç ã€‚æ ¹æ®æ‚¨çš„ç‰¹å®šç”¨ä¾‹ï¼Œæ‚¨è¿˜å¯ä»¥å°†ä»£ç æ·»åŠ åˆ°ç°æœ‰é¡¹ç›®ä¸­ã€‚</p><blockquote class="ml mm mn"><p id="2b43" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">å¦‚æœä½ æƒ³åœ¨Vue.jsåº”ç”¨ç¨‹åºä¸­å®ç°å®ƒï¼Œè¯·éšæ„åœ¨è¿™é‡Œå…‹éš†ä»£ç çš„Vueç‰ˆæœ¬<a class="ae kr" href="https://github.com/alexkasongo/firebase-vue-role-based-auth" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="2ea1" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 2ã€‚å®‰è£…firebaseå¹¶åˆ›å»ºä¸€ä¸ªFirebaseç”¨æˆ·å¸æˆ·</strong></p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="c2a1" class="jv jw in mk b gy na nb l nc nd">npm install firebase</span></pre><p id="cd22" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">åœ¨nuxt.config.jså†…çš„æ’ä»¶æ•°ç»„ä¸­æ³¨å†Œfirebase.js</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="f1ad" class="jv jw in mk b gy na nb l nc nd">// nuxt.config.js<br/>Plugins = [<br/>  '~/plugins/firebase.js',<br/>],</span></pre><p id="8c47" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">ç»§ç»­åœ¨Firebaseæ§åˆ¶å°ä¸Šåˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚åœ¨ä½ çš„Nuxtåº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨<strong class="ku io"> src/plugins </strong>ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<strong class="ku io"> firebase.js </strong>çš„æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«ä½ çš„firebaseåˆå§‹åŒ–ä»£ç ã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="733b" class="jv jw in mk b gy na nb l nc nd">// firebase.js<br/><em class="mo">import</em> "firebase/auth";<br/><em class="mo">import</em> "firebase/firestore";</span><span id="a74b" class="jv jw in mk b gy ne nb l nc nd">// Your web app's Firebase configuration<br/>var firebaseConfig = {<br/>  apiKey: "**************",<br/>  authDomain: "**************",<br/>  databaseURL: "**************",<br/>  projectId: "**************",<br/>  storageBucket: "",<br/>  messagingSenderId: "**************",<br/>  appId: "**************",<br/>  measurementId: "**************"<br/>};<br/>// Initialize Firebase<br/>firebase.initializeApp(firebaseConfig);</span></pre><p id="6b58" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 3ã€‚æ›´æ–°Default.vue </strong></p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="c0c3" class="jv jw in mk b gy na nb l nc nd">// default.vue<br/>&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;nav class="navbar navbar-expand-lg navbar-light bg-light"&gt;<br/>      &lt;a class="navbar-brand" href="#"&gt;Navbar&lt;/a&gt;<br/>      &lt;button<br/>        class="navbar-toggler"<br/>        type="button"<br/>        data-toggle="collapse"<br/>        data-target="#navbarSupportedContent"<br/>        aria-controls="navbarSupportedContent"<br/>        aria-expanded="false"<br/>        aria-label="Toggle navigation"<br/>      &gt;<br/>        &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;<br/>      &lt;/button&gt;<br/><br/>      &lt;div class="collapse navbar-collapse" id="navbarSupportedContent"&gt;<br/>        &lt;ul class="navbar-nav mr-auto"&gt;<br/>          &lt;li class="nav-item"&gt;<br/>            &lt;nuxt-link class="nav-link" to="/login"&gt;Login&lt;/nuxt-link&gt;<br/>          &lt;/li&gt;<br/>          &lt;li class="nav-item"&gt;<br/>            &lt;nuxt-link class="nav-link" to="/register-customer"<br/>              &gt;Register Customer&lt;/nuxt-link<br/>            &gt;<br/>          &lt;/li&gt;<br/>          &lt;li class="nav-item"&gt;<br/>            &lt;nuxt-link class="nav-link" to="/register-admin"<br/>              &gt;Register Admin&lt;/nuxt-link<br/>            &gt;<br/>          &lt;/li&gt;<br/>        &lt;/ul&gt;<br/>      &lt;/div&gt;<br/>    &lt;/nav&gt;<br/>    &lt;div class="container mt-5"&gt;<br/>      &lt;Nuxt /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;style&gt;<br/>html {<br/>  font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI",<br/>    Roboto, "Helvetica Neue", Arial, sans-serif;<br/>  font-size: 16px;<br/>  word-spacing: 1px;<br/>  -ms-text-size-adjust: 100%;<br/>  -webkit-text-size-adjust: 100%;<br/>  -moz-osx-font-smoothing: grayscale;<br/>  -webkit-font-smoothing: antialiased;<br/>  box-sizing: border-box;<br/>}<br/><br/>*,<br/>*::before,<br/>*::after {<br/>  box-sizing: border-box;<br/>  margin: 0;<br/>}<br/><br/>.button--green {<br/>  display: inline-block;<br/>  border-radius: 4px;<br/>  border: 1px solid #3b8070;<br/>  color: #3b8070;<br/>  text-decoration: none;<br/>  padding: 10px 30px;<br/>}<br/><br/>.button--green:hover {<br/>  color: #fff;<br/>  background-color: #3b8070;<br/>}<br/><br/>.button--grey {<br/>  display: inline-block;<br/>  border-radius: 4px;<br/>  border: 1px solid #35495e;<br/>  color: #35495e;<br/>  text-decoration: none;<br/>  padding: 10px 30px;<br/>  margin-left: 15px;<br/>}<br/><br/>.button--grey:hover {<br/>  color: #fff;<br/>  background-color: #35495e;<br/>}<br/>&lt;/style&gt;</span></pre><p id="0e2a" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 3ã€‚æ³¨å†Œå®¢æˆ·</strong></p><p id="4b43" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ³¨å†Œè¡¨å•ã€‚æˆ‘ç”¨<a class="ae kr" href="https://getbootstrap.com/docs/4.5/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> Bootstrap CDN </a>ä½†æ˜¯å¯ä»¥éšæ„ç”¨ä½ æœ€å–œæ¬¢çš„ã€‚ç”¨æˆ·æ•°æ®å°†å­˜å‚¨åœ¨è§’è‰²é›†åˆä¸‹çš„äº‘Firestoreä¸­ã€‚è¿™æ ·ï¼Œå½“æ‚¨æ‹¥æœ‰ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå°±å¯ä»¥è·å¾—æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p><blockquote class="ml mm mn"><p id="d466" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">src/é¡µé¢/æ³¨å†Œ-å®¢æˆ·</p></blockquote><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="e8a4" class="jv jw in mk b gy na nb l nc nd">// src/pages/register-customer</span><span id="71c5" class="jv jw in mk b gy ne nb l nc nd">&lt;template&gt;<br/>  &lt;div class="row"&gt;<br/>    &lt;div class="col-sm-4 off-set"&gt;<br/>      &lt;form @submit.prevent="onSubmit"&gt;<br/>        &lt;div class="form-group"&gt;<br/>          &lt;label for="exampleInputEmail1"&gt;Email address&lt;/label&gt;<br/>          &lt;input<br/>            type="email"<br/>            class="form-control"<br/>            placeholder="Enter email"<br/>            v-model="email"<br/>          /&gt;<br/>        &lt;/div&gt;<br/>        &lt;div class="form-group"&gt;<br/>          &lt;label for="exampleInputPassword1"&gt;Password&lt;/label&gt;<br/>          &lt;input<br/>            type="password"<br/>            class="form-control"<br/>            placeholder="Password"<br/>            v-model="password"<br/>          /&gt;<br/>        &lt;/div&gt;<br/>        &lt;button type="submit" class="btn btn-primary"&gt;Register Customer&lt;/button&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import * as firebase from "firebase/app";<br/>import "firebase/auth";<br/><br/>export default {<br/>  name: "RegisterCustomer",<br/>  data: () =&gt; ({<br/>    email: "",<br/>    password: "",<br/>  }),<br/>  methods: {<br/>    async onSubmit() {<br/>      try {<br/>        var { user } = await firebase<br/>          .auth()<br/>          .createUserWithEmailAndPassword(this.email, this.password);<br/>        // signout<br/>        firebase<br/>          .auth()<br/>          .signOut()<br/>          .then((user) =&gt; {<br/>            this.$router.push("/login");<br/>          });<br/>      } catch (error) {<br/>        console.log("ğŸ¤¡", error.message);<br/>      }<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="2401" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å½“é€šè¿‡æˆæƒè‡ªå®šä¹‰å£°æ˜è®¾ç½®ç”¨æˆ·è§’è‰²æ—¶ï¼Œå®ƒå°†åœ¨æ³¨é”€å¹¶é‡æ–°ç™»å½•åå˜å¾—å¯ç”¨ã€‚</p><p id="5cfd" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘åœ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç”¨æˆ·å¸æˆ·åï¼Œæœ‰äº†ä¸‹é¢çš„æ³¨é”€åŠŸèƒ½ã€‚</p><p id="59e3" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 4ã€‚æ·»åŠ Firebaseäº‘åŠŸèƒ½</strong></p><p id="0708" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">4.1 <strong class="ku io">é‡è¦:</strong>æ”¯æŒNode.jsã€10ã€12ç‰ˆæœ¬ã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="4e17" class="jv jw in mk b gy na nb l nc nd">npm install -g firebase-tools</span></pre><p id="ab42" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">æˆ–è€…</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="8e3c" class="jv jw in mk b gy na nb l nc nd">sudo npm install -g firebase-tools</span></pre><p id="8f47" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">4.2 <strong class="ku io">é‡è¦æç¤º:</strong>æ›´æ–°Firebase CLIå’ŒSDK</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="c20a" class="jv jw in mk b gy na nb l nc nd">npm install firebase-functions@latest firebase-admin@latest --save<br/>npm install -g firebase-tools</span></pre><p id="e1ad" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">4.2<strong class="ku io">T9ã€‘åˆå§‹åŒ–ä½ çš„é¡¹ç›®</strong></p><p id="c8bc" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è¿è¡Œ<code class="fe mh mi mj mk b">firebase login</code>é€šè¿‡æµè§ˆå™¨ç™»å½•å¹¶éªŒè¯firebaseå·¥å…·ã€‚</p><p id="8adc" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è¿è¡Œ<code class="fe mh mi mj mk b">firebase init</code></p><p id="a860" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å¯¹äºæˆ‘ä»¬çš„æ¡ˆä¾‹ï¼Œè®©æˆ‘ä»¬é€‰æ‹©ä»¥ä¸‹å†…å®¹:</p><p id="aba8" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">æ‚¨æƒ³ä¸ºæ­¤æ–‡ä»¶å¤¹è®¾ç½®å“ªäº›Firebase CLIåŠŸèƒ½ï¼Ÿ</strong> <em class="mo">åŠŸèƒ½</em></p><p id="3088" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">ä½ æƒ³ç”¨ä»€ä¹ˆè¯­è¨€å†™äº‘å‡½æ•°ï¼Ÿ</strong> <em class="mo"> JavaScript </em></p><p id="df6e" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">ä½ æƒ³ä½¿ç”¨ESLintæ¥æ•æ‰å¯èƒ½çš„bugå¹¶åŠ å¼ºé£æ ¼å—ï¼Ÿ <em class="mo">æ˜¯</em></p><p id="3913" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">T22æ‚¨æƒ³ç°åœ¨å®‰è£…ä¸npmçš„ä¾èµ–å…³ç³»å—ï¼Ÿ <em class="mo">æ˜¯</em></p><p id="df41" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">ä»…æ­¤è€Œå·²ï¼</p><p id="8bb0" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è®©<strong class="ku io"> Firebase CLI </strong>åšé¡¹ç›®è„šæ‰‹æ¶ï¼Œå‡†å¤‡å¥½é¡¹ç›®æ–‡ä»¶ã€‚</p><blockquote class="ml mm mn"><p id="341e" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">src/åŠŸèƒ½</p></blockquote><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/4b1c1e36be868eca7606a33f3a9bc928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*W2n5MhSe32w845q3Pp_CMg.png"/></div></figure><p id="d9b7" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 5ã€‚æ·»åŠ ç®¡ç†å‘˜æˆæƒè‡ªå®šä¹‰å£°æ˜</strong></p><p id="6026" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å¦‚ä½ æ‰€çŸ¥ï¼Œä»å®¢æˆ·ç«¯è®¾ç½®ç®¡ç†å‘˜è§’è‰²ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œæ‰€ä»¥æˆ‘å°†ä½¿ç”¨Firebase Cloudå‡½æ•°æ¥æ·»åŠ å®ƒã€‚</p><p id="2ed9" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">åˆ›å»ºæ–°çš„Firebaseç”¨æˆ·å¸æˆ·æ—¶ï¼Œå°†è§¦å‘AddUserRole()å‡½æ•°ã€‚</p><blockquote class="ml mm mn"><p id="1ae9" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">å‡½æ•°/index.js</p></blockquote><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="8ccf" class="jv jw in mk b gy na nb l nc nd">// functions/index.js<br/>const functions = require('firebase-functions');<br/>const admin = require('firebase-admin')</span><span id="2bca" class="jv jw in mk b gy ne nb l nc nd">admin.initializeApp()</span><span id="58cc" class="jv jw in mk b gy ne nb l nc nd">const db = admin.firestore()</span><span id="6aff" class="jv jw in mk b gy ne nb l nc nd"><em class="mo">// trigger function on new user creation.<br/>// when a new user is created this fucntion is triggered. When triggered a defualt<br/>// data object is pushed to the roles collection, this object contains the user's role status</em></span><span id="57e9" class="jv jw in mk b gy ne nb l nc nd">exports.AddUserRole = functions.auth.user().onCreate(async (authUser) =&gt; {<br/>  if (authUser.email) {<br/>    const customClaims = {<br/>      admin: true,<br/>    };<br/>    try {<br/>      var _ = await admin.auth().setCustomUserClaims(authUser.uid, customClaims)<br/>      return db.collection("roles").doc(authUser.uid).set({<br/>        email: authUser.email,<br/>        role: customClaims<br/>      })<br/>    } catch (error) {<br/>      console.log(error)<br/>    }<br/>  }<br/>});</span></pre><p id="0b96" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">é‡è¦æç¤º:</strong>å°†åŠŸèƒ½éƒ¨ç½²åˆ°Firebaseã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="3f50" class="jv jw in mk b gy na nb l nc nd">firebase deploy --only functions</span></pre><p id="99d7" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 6ã€‚æ³¨å†Œç®¡ç†å‘˜</strong></p><p id="e07a" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">ä»å®¢æˆ·ç«¯è®¾ç½®ç®¡ç†å‘˜è§’è‰²å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ï¼Œæ‰€ä»¥æˆ‘å°†ä½¿ç”¨Firebase Cloudå‡½æ•°æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚</p><blockquote class="ml mm mn"><p id="ec5d" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">src/pages/register-admin.vue</p></blockquote><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="c10f" class="jv jw in mk b gy na nb l nc nd">// src/pages/register-admin</span><span id="c700" class="jv jw in mk b gy ne nb l nc nd">&lt;template&gt;<br/>  &lt;div <em class="mo">class</em>="row"<!-- -->&gt;<br/>    &lt;div class="col-sm-4 off-set"&gt;<br/>      &lt;form @submit.prevent="onSubmit"&gt;<br/>        &lt;div class="form-group"&gt;<br/>          &lt;label for="exampleInputEmail1"&gt;Email address&lt;/label&gt;<br/>          &lt;input<br/>            type="text"<br/>            placeholder="Email"<br/>            v-model="email"<br/>            class="form-control"<br/>            required<br/>          /&gt;<br/>        &lt;/div&gt;</span><span id="72d0" class="jv jw in mk b gy ne nb l nc nd">        &lt;div class="form-group"&gt;<br/>          &lt;label for="exampleInputPassword1"&gt;Password&lt;/label&gt;<br/>          &lt;input<br/>            type="password"<br/>            placeholder="Password"<br/>            v-model="password"<br/>            class="form-control"<br/>            required<br/>          /&gt;<br/>        &lt;/div&gt;</span><span id="0d82" class="jv jw in mk b gy ne nb l nc nd">        &lt;button type="submit" class="btn btn-primary"&gt;Register Admin&lt;/button&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="dbbb" class="jv jw in mk b gy ne nb l nc nd">&lt;script&gt;<br/>import * as firebase from "firebase/app";<br/>import "firebase/auth";<br/>import "firebase/functions";</span><span id="06e4" class="jv jw in mk b gy ne nb l nc nd">export default {<br/>  name: "RegisterAdmin",<br/>  data() {<br/>    return {<br/>      name: "",<br/>      phone: "",<br/>      email: "",<br/>      password: "",<br/>      user: null,<br/>    };<br/>  },<br/>  methods: {<br/>    async onSubmit() {<br/>      let admin = {<br/>        role: {<br/>          admin: true,<br/>        },<br/>      };</span><span id="062f" class="jv jw in mk b gy ne nb l nc nd">      await firebase<br/>        .auth()<br/>        .createUserWithEmailAndPassword(this.email, this.password)<br/>        .then((response) =&gt; {<br/>          if (response) {<br/>            const setAdmin = firebase.functions().httpsCallable("setAdmin");<br/>            const data = { uid: response.user.uid, role: admin.role };<br/>            setAdmin(data)<br/>              .then((result) =&gt; {<br/>                console.log(`index.js - 183 - "ğŸ‰"`, result);<br/>              })<br/>              .then(() =&gt; {<br/>                // signout<br/>                firebase<br/>                  .auth()<br/>                  .signOut()<br/>                  .then(() =&gt; {<br/>                    this.$router.push("/login");<br/>                  });<br/>              });<br/>          }<br/>        })<br/>        .catch((error) =&gt; {<br/>          // Handle Errors here.<br/>          console.log("ğŸ¤¡", error.message);<br/>        });<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="2566" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">6.1å‡½æ•°/ç´¢å¼•. js</p><p id="43eb" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">æ·»åŠ åˆ›å»ºæ–°ç®¡ç†å‘˜æ—¶è°ƒç”¨çš„äº‘å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªuidå’Œæ–°çš„è§’è‰²æ•°æ®ã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="a21e" class="jv jw in mk b gy na nb l nc nd">// create admin user on signup<br/>exports.setAdmin = functions.https.onCall(async (data, context) =&gt; {<br/><br/>    // if (!context.auth.token.admin) return<br/>    if (!context.auth.token) return<br/><br/>    try {<br/>        var _ = await admin.auth().setCustomUserClaims(data.uid, data.role)<br/><br/>        return db.collection("roles").doc(data.uid).update({<br/>            role: data.role<br/>        })<br/><br/>    } catch (error) {<br/>        console.log('ğŸ¤¡', error)<br/>    }<br/><br/>});</span></pre><p id="c970" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">é‡è¦æç¤º:</strong>å°†åŠŸèƒ½éƒ¨ç½²åˆ°Firebaseã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="ed8e" class="jv jw in mk b gy na nb l nc nd">firebase deploy --only functions</span></pre><p id="f05e" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 7ã€‚ç™»å½•</strong></p><p id="cd7b" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è®©æˆ‘ä»¬ä½¿ç”¨åœ¨register-adminé¡µé¢ä¸Šåˆ›å»ºçš„ç®¡ç†å‘˜å¸æˆ·ç™»å½•ç®¡ç†å‘˜å¸æˆ·</p><blockquote class="ml mm mn"><p id="05ba" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">src/pages/login.vue</p></blockquote><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="fa13" class="jv jw in mk b gy na nb l nc nd">&lt;template&gt;<br/>  &lt;div class="row"&gt;<br/>    &lt;div class="col-sm-4 off-set"&gt;<br/>      &lt;form @submit.prevent="onSubmit"&gt;<br/>        &lt;div class="form-group"&gt;<br/>          &lt;label for="exampleInputEmail1"&gt;Email address&lt;/label&gt;<br/>          &lt;input<br/>            type="email"<br/>            class="form-control"<br/>            placeholder="Enter email"<br/>            v-model="email"<br/>          /&gt;<br/>        &lt;/div&gt;<br/>        &lt;div class="form-group"&gt;<br/>          &lt;label for="exampleInputPassword1"&gt;Password&lt;/label&gt;<br/>          &lt;input<br/>            type="password"<br/>            class="form-control"<br/>            placeholder="Password"<br/>            v-model="password"<br/>          /&gt;<br/>        &lt;/div&gt;<br/>        &lt;button type="submit" class="btn btn-primary"&gt;Login&lt;/button&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import * as firebase from "firebase/app";<br/>import "firebase/auth";<br/><br/>export default {<br/>  name: "Login",<br/>  data: () =&gt; ({<br/>    email: "",<br/>    password: "",<br/>  }),<br/>  created() {<br/>    firebase.auth().onAuthStateChanged((userAuth) =&gt; {<br/>      if (userAuth) {<br/>        firebase<br/>          .auth()<br/>          .currentUser.getIdTokenResult()<br/>          .then((tokenResult) =&gt; {<br/>            console.log("ğŸ ", tokenResult.claims);<br/>          });<br/>      }<br/>    });<br/>  },<br/><br/>  methods: {<br/>    async onSubmit() {<br/>      try {<br/>        const { user } = await firebase<br/>          .auth()<br/>          .signInWithEmailAndPassword(this.email, this.password);<br/>      } catch (error) {<br/>        console.log("ğŸ¤¡", error);<br/>      }<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="ead4" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 8.1æ³¨å†Œå®¢æˆ·</strong></p><p id="563c" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è½¬åˆ°æ³¨å†Œå®¢æˆ·è§†å›¾ï¼Œæ³¨å†Œä¸€ä¸ªæ–°çš„å®¢æˆ·ç”¨æˆ·ã€‚æ³¨å†ŒæˆåŠŸåï¼Œå°†åœ¨äº‘Firestoreæ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºâ€œè§’è‰²â€çš„æ–°é›†åˆã€‚</p><p id="eeb3" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 8.2ç™»å½•å®¢æˆ·</strong></p><p id="05e4" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å½“æ‚¨ä½¿ç”¨å·²ç»åˆ›å»ºçš„å®¢æˆ·ç™»å½•æ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ§åˆ¶å°ä¸­çš„è‡ªå®šä¹‰å£°æ˜å¯¹è±¡å†…çš„å®¢æˆ·å±æ€§è¢«è®¾ç½®ä¸ºtrue</p><p id="ce01" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 8.2æ³¨å†Œç®¡ç†å‘˜</strong></p><p id="1e25" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è½¬åˆ°Register Adminè§†å›¾ï¼Œæ³¨å†Œä¸€ä¸ªæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·ã€‚æ³¨å†ŒæˆåŠŸåï¼Œå°†åœ¨äº‘Firestoreæ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºâ€œè§’è‰²â€çš„æ–°é›†åˆã€‚</p><p id="4a48" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 8.2ç™»å½•ç®¡ç†å‘˜</strong></p><p id="84e6" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å½“æ‚¨ä½¿ç”¨å·²ç»åˆ›å»ºçš„adminç™»å½•æ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ§åˆ¶å°ä¸­çš„custom claimså¯¹è±¡å†…çš„customerå±æ€§è¢«è®¾ç½®ä¸ºtrue</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/86712edba9389a74a4dcac8be386bf3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n3MENkIaYiaDJIBl8J_eqA.png"/></div></div></figure><p id="12b9" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 9ã€‚å®¢æˆ·è§†å›¾</strong></p><p id="d32d" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è¿™ä¸ªè§†å›¾æœ‰ä¸€ä¸ªç®€å•çš„æ ‡é¢˜ï¼Œç”¨æˆ·ç”µå­é‚®ä»¶å’Œæ³¨é”€æŒ‰é’®ï¼Œé©±åŠ¨ç¨‹åºè§†å›¾æ˜¯ç›¸åŒçš„ï¼Œé™¤äº†æ ‡é¢˜æ–‡æœ¬ã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="0880" class="jv jw in mk b gy na nb l nc nd">// src/pages/customer<br/>&lt;template&gt;<br/>  &lt;section&gt;<br/>    &lt;div class="ui middle aligned center aligned grid"&gt;<br/>      &lt;div class="column"&gt;<br/>        &lt;h1&gt;Customer&lt;/h1&gt;<br/>        &lt;p v-if="user"&gt;Customer: {{ user.email }}&lt;/p&gt;<br/>        &lt;button class="btn btn-primary" @click="signout"&gt;Signout&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/section&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import * as firebase from "firebase/app";<br/>import "firebase/auth";</span><span id="e79d" class="jv jw in mk b gy ne nb l nc nd">export default {<br/>  data() {<br/>    return {<br/>      user: null,<br/>    };<br/>  },<br/>  created() {<br/>    var self = this;<br/>    firebase.auth().onAuthStateChanged(function (user) {<br/>      self.user = user;<br/>    });<br/>  },<br/>  methods: {<br/>    signout() {<br/>      firebase<br/>        .auth()<br/>        .signOut()<br/>        .then((user) =&gt; {<br/>          this.$router.push("/login");<br/>        });<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="3744" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">æ‚¨å¯èƒ½æƒ³çŸ¥é“ï¼Œå¦‚æœæˆ‘ä¸æƒ³è®©å®¢æˆ·æˆ–è®¢æˆ·çœ‹åˆ°ä»ªè¡¨æ¿ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœæˆ‘æƒ³å°†ç”¨æˆ·è§’è‰²(å¦‚å®¢æˆ·)æ›´æ”¹ä¸ºè®¢æˆ·ï¼Œåä¹‹äº¦ç„¶ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p id="1081" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¸€ä¼šå„¿ä¼šè®²åˆ°çš„ã€‚</p><p id="b486" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 9ã€‚æˆæƒçš„æˆæƒå®ˆå«</strong></p><p id="3030" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è®©æˆ‘ä»¬åœ¨srcä¸­åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<em class="mo">çš„æ–‡ä»¶</em></p><p id="9b93" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">é‡è¦:</strong>åœ¨nuxt.config.jsä¸­æ³¨å†Œä¸­é—´ä»¶</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="80b0" class="jv jw in mk b gy na nb l nc nd">// nuxt.config.js<br/>router: {<br/>  middleware: ['authenticated']<br/>},</span></pre><p id="b868" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">åœ¨beforeEachæ–¹æ³•ä¸­ï¼Œæˆ‘ä½¿ç”¨Firebaseä¸­çš„onAuthStateChangedæ–¹æ³•æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚</p><p id="169c" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">å¦‚æœæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆè·å–ä¸€ä¸ªidTokeResultï¼Œå®ƒåŒ…å«claimså¯¹è±¡ï¼Œæˆ‘å¯ä»¥åœ¨å…¶ä¸­è·å–åœ¨åˆ›å»ºæ–°ç”¨æˆ·å¸æˆ·æ—¶è®¾ç½®çš„ç”¨æˆ·è§’è‰²ã€‚</p><p id="df55" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">src/middleware/authenticated . js</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="a148" class="jv jw in mk b gy na nb l nc nd">import * as firebase from 'firebase/app';<br/>import 'firebase/auth';<br/><br/>export default function ({ app, store, route, redirect }) {<br/><br/>    app.router.beforeEach((to, from, next) =&gt; {<br/><br/>  firebase.auth().onAuthStateChanged(userAuth =&gt; {<br/><br/>    if (userAuth) {<br/>      firebase.auth().currentUser.getIdTokenResult()<br/>        .then(function ({<br/>          claims<br/>        }) {<br/><br/>          if (claims.customer) {<br/>            if (to.path !== '/customer')<br/>              return next({<br/>                path: '/customer',<br/>              })<br/>          } else if (claims.admin) {<br/>            if (to.path !== '/admin')<br/>              return next({<br/>                path: '/admin',<br/>              })<br/>          } else if (claims.subscriber) {<br/>            if (to.path !== '/subscriber')<br/>              return next({<br/>                path: '/subscriber',<br/>              })<br/>          }<br/><br/>        })<br/>    } else {<br/>      if (to.matched.some(record =&gt; record.meta.auth)) {<br/>        next({<br/>          path: '/login',<br/>          query: {<br/>            redirect: to.fullPath<br/>          }<br/>        })<br/>      } else {<br/>        next()<br/>      }<br/>    }<br/><br/>  })<br/><br/>  next()<br/><br/>})<br/><br/>}</span></pre><p id="4839" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io"> 11ã€‚æ”¹å˜ç”¨æˆ·è§’è‰²</strong></p><p id="381a" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è®©æˆ‘ä»¬åœ¨ç®¡ç†å‘˜å¸æˆ·ç™»å½•æ—¶è·å–æ‰€æœ‰ç”¨æˆ·å¸æˆ·ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä»å‰ç«¯å°†è§’è‰²æ›´æ”¹ä¸ºä»»ä½•ç”¨æˆ·ã€‚</p><p id="4d30" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">ç®¡ç†å‘˜ç”¨æˆ·ç•Œé¢</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="fce3" class="jv jw in mk b gy na nb l nc nd">&lt;template&gt;<br/>  &lt;section&gt;<br/>    &lt;div class="ui middle aligned center aligned grid"&gt;<br/>      &lt;div class="column"&gt;<br/>        &lt;h1&gt;Admin&lt;/h1&gt;<br/>        &lt;p v-if="user"&gt;User: {{ user.email }}&lt;/p&gt;<br/>        &lt;button class="btn btn-primary mb-4" @click="signout"&gt;Signout&lt;/button&gt;<br/>        &lt;table class="table table-hover"&gt;<br/>          &lt;thead&gt;<br/>            &lt;tr&gt;<br/>              &lt;th scope="col"&gt;Email&lt;/th&gt;<br/>              &lt;th scope="col"&gt;Role&lt;/th&gt;<br/>            &lt;/tr&gt;<br/>          &lt;/thead&gt;<br/>          &lt;tbody&gt;<br/>            &lt;tr v-for="user in users" :key="user.id"&gt;<br/>              &lt;td data-label="Name"&gt;{{ user.email }}&lt;/td&gt;<br/>              &lt;td&gt;<br/>                &lt;select @change="changeRole(user.id, $event)"&gt;<br/>                  &lt;option :selected="user.role.subscriber" value="subscriber"&gt;<br/>                    Subscriber<br/>                  &lt;/option&gt;<br/>                  &lt;option :selected="user.role.customer" value="customer"&gt;<br/>                    Customer<br/>                  &lt;/option&gt;<br/>                &lt;/select&gt;<br/>              &lt;/td&gt;<br/>            &lt;/tr&gt;<br/>          &lt;/tbody&gt;<br/>        &lt;/table&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/section&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import * as firebase from "firebase/app";<br/>import "firebase/auth";<br/>import "firebase/functions";<br/><br/>export default {<br/>  name: "Admin",<br/>  data() {<br/>    return {<br/>      users: [],<br/>      user: null,<br/>    };<br/>  },<br/>  created() {<br/>    var self = this;<br/>    firebase.auth().onAuthStateChanged((user) =&gt; {<br/>      self.user = user;<br/>    });<br/>    this.users = [];<br/>    firebase<br/>      .firestore()<br/>      .collection("roles")<br/>      .get()<br/>      .then((snap) =&gt; {<br/>        snap.forEach((doc) =&gt; {<br/>          var user = doc.data();<br/>          user.id = doc.id;<br/>          console.log("ğŸŒ¿", doc.data());<br/>          if (!user.role.admin) this.users.push(user);<br/>        });<br/>      });<br/>  },<br/>  methods: {<br/>    signout() {<br/>      firebase<br/>        .auth()<br/>        .signOut()<br/>        .then((user) =&gt; {<br/>          this.$router.push("/login");<br/>        });<br/>    },<br/>    changeRole(uid, event) {<br/>      var setUserRole = firebase.functions().httpsCallable("setUserRole");<br/>      var data = { uid: uid, role: { [event.target.value]: true } };<br/>      setUserRole(data)<br/>        .then((result) =&gt; {<br/>          console.log("ğŸ‰", result);<br/>        })<br/>        .catch((error) =&gt; {<br/>          console.log("ğŸ¤¡", error);<br/>        });<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="66a5" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">è®©æˆ‘ä»¬å°†å®‰å…¨è§„åˆ™æ·»åŠ åˆ°æ•°æ®åº“çº§åˆ«ã€‚åªæœ‰adminèƒ½å¤ŸæŸ¥çœ‹created()æ–¹æ³•ä¸­rolesé›†åˆçš„æ‰€æœ‰ç”¨æˆ·æ•°æ®ã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="500a" class="jv jw in mk b gy na nb l nc nd">rules_version = '2';<br/>service cloud.firestore {<br/>  match /databases/{database}/documents {<br/>     match /roles/{uid} {<br/>      allow read, write: if request.auth.token.admin == true<br/>    }<br/>    <br/>  }<br/>}</span></pre><p id="d859" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">ç°åœ¨ï¼Œåœ¨æ¯ä¸ªç”¨æˆ·æ—è¾¹æ·»åŠ ä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œæ˜¾ç¤ºä»–ä»¬å¯ä»¥åˆ‡æ¢åˆ°çš„è§’è‰²ï¼Œå¹¶å°†uidå’Œæ–°çš„è§’è‰²æ•°æ®å‘é€åˆ°åç«¯çš„å¯è°ƒç”¨å‡½æ•°setUserRole()ä¸­ã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="96a2" class="jv jw in mk b gy na nb l nc nd"><em class="mo">// this function can only be triggered by the admin. This function allows the admin to<br/>// set user roles accordingly.</em></span><span id="1e21" class="jv jw in mk b gy ne nb l nc nd">exports.setUserRole = functions.https.onCall(async (data, context) =&gt; {<br/>  if (!context.auth.token.admin) return<br/>  try {<br/>    var _ = await admin.auth().setCustomUserClaims(data.uid, data.role)<br/>    return db.collection("roles").doc(data.uid).update({<br/>      role: data.role<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>});</span></pre><p id="21c0" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">é‡è¦æç¤º:</strong>å°†åŠŸèƒ½éƒ¨ç½²åˆ°Firebaseã€‚</p><pre class="ms mt mu mv gt mw mk mx my aw mz bi"><span id="2928" class="jv jw in mk b gy na nb l nc nd">firebase deploy --only functions</span></pre><p id="2542" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated">é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚æ˜¯å¦æ˜¯ç”±ç®¡ç†å‘˜ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„è‡ªå®šä¹‰å£°æ˜å‘å‡ºçš„ã€‚ç„¶åï¼Œä½¿ç”¨uidä¸ºè‡ªå®šä¹‰å£°æ˜å¯¹è±¡è®¾ç½®ä¸€ä¸ªæ–°è§’è‰²ï¼Œå¹¶æ›´æ–°ç›¸åº”çš„æ–‡æ¡£ä»¥åæ˜ è§’è‰²çš„å˜åŒ–ã€‚</p><blockquote class="ml mm mn"><p id="13a5" class="ks kt mo ku b kv ln kx ky kz lo lb lc mp lp le lf mq lq lh li mr lr lk ll lm ig bi translated">å¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·åœ¨ä¸‹é¢çš„è¯„è®ºåŒºå‘Šè¯‰æˆ‘ã€‚</p></blockquote><p id="622d" class="pw-post-body-paragraph ks kt in ku b kv ln kx ky kz lo lb lc ke lp le lf ki lq lh li km lr lk ll lm ig bi translated"><strong class="ku io">ğŸ</strong> <a class="ae kr" href="https://github.com/alexkasongo/firebase-nuxt-role-based-auth" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> GITHUBå›è´­</strong> </a> <strong class="ku io">ğŸ</strong></p></div></div>    
</body>
</html>