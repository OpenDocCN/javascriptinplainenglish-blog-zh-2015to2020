<html>
<head>
<title>Defining and Using Angular Attribute Directives</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">定义和使用角度属性指令</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/defining-and-using-angular-attribute-directives-b4a033f651af?source=collection_archive---------5-----------------------#2020-04-03">https://javascript.plainenglish.io/defining-and-using-angular-attribute-directives-b4a033f651af?source=collection_archive---------5-----------------------#2020-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d780a5384b4024765948187c2f0dd6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rcxDM4cMPkorkjAi"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@borisworkshop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Boris Smokrovic</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ea3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Angular是Google制作的一个流行的前端框架。像其他流行的前端框架一样，它使用基于组件的架构来构建应用程序。</p><p id="2255" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Angular创建和使用属性指令。</p><h1 id="0bf5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">构建一个简单的属性指令</h1><p id="de13" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Angular CLI创建一个简单的指令。</p><p id="6372" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建一个，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="566a" class="mn lc iq mj b gy mo mp l mq mr">ng generate directive highlight</span></pre><p id="a67c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为我们的指令创建框架代码。</p><p id="b69a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们这样做了，我们就可以为我们的指令写一些代码。我们编写以下代码:</p><p id="df62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">highlight.directive.ts</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7f2e" class="mn lc iq mj b gy mo mp l mq mr">import { Directive, ElementRef } from '@angular/core';</span><span id="5db2" class="mn lc iq mj b gy mv mp l mq mr">@Directive({<br/>  selector: '[appHighlight]'<br/>})<br/>export class HighlightDirective {<br/>  constructor(el: ElementRef) {<br/>    el.nativeElement.style.backgroundColor = 'pink';<br/>  }<br/>}</span></pre><p id="72b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码接受指令所应用到的元素的一个<code class="fe ms mt mu mj b">ElementRef</code>。</p><p id="a9f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将它的<code class="fe ms mt mu mj b">backgroundColor</code>设置为<code class="fe ms mt mu mj b">'pink'</code>。</p><p id="854d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">括号使我们的指令成为属性指令。</p><p id="231f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该给我们的指令名加上类似<code class="fe ms mt mu mj b">app</code>的前缀，这样它们就不会和HTML属性名冲突。</p><p id="3428" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">app.module.ts</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="68db" class="mn lc iq mj b gy mo mp l mq mr">import { BrowserModule } from '@angular/platform-browser';<br/>import { NgModule } from '@angular/core';</span><span id="4d56" class="mn lc iq mj b gy mv mp l mq mr">import { AppRoutingModule } from './app-routing.module';<br/>import { AppComponent } from './app.component';<br/>import { HighlightDirective } from './highlight.directive';</span><span id="1f08" class="mn lc iq mj b gy mv mp l mq mr">@NgModule({<br/>  declarations: [<br/>    AppComponent,<br/>    HighlightDirective<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    AppRoutingModule<br/>  ],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule { }</span></pre><p id="a237" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在我们的<code class="fe ms mt mu mj b">AppModule</code>中添加了<code class="fe ms mt mu mj b">HighlightDirective</code>，这样我们就可以使用它了。</p><p id="2873" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们可以在<code class="fe ms mt mu mj b">app.component.html</code>中如下使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a890" class="mn lc iq mj b gy mo mp l mq mr">&lt;div appHighlight&gt;foo&lt;/div&gt;</span></pre><p id="807b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们应该看到一个粉红色的div，里面有“foo”。</p><h1 id="46c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">响应用户发起的事件</h1><p id="c91b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以使用指令来检测和处理用户发起的事件。</p><p id="ff7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以将上面的<code class="fe ms mt mu mj b">HighlightDirective</code>修改如下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="abca" class="mn lc iq mj b gy mo mp l mq mr">import { Directive, ElementRef, HostListener } from '@angular/core';</span><span id="d27f" class="mn lc iq mj b gy mv mp l mq mr">@Directive({<br/>  selector: '[appHighlight]'<br/>})<br/>export class HighlightDirective {<br/>  constructor(private el: ElementRef) {    }</span><span id="9d19" class="mn lc iq mj b gy mv mp l mq mr">  @HostListener('mouseenter') onMouseEnter() {<br/>    this.highlight('pink');<br/>  }</span><span id="fa6b" class="mn lc iq mj b gy mv mp l mq mr">  @HostListener('mouseleave') onMouseLeave() {<br/>    this.highlight(null);<br/>  }</span><span id="87d0" class="mn lc iq mj b gy mv mp l mq mr">  private highlight(color: string){<br/>    this.el.nativeElement.style.color = color;<br/>  }<br/>}</span></pre><p id="88e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了<code class="fe ms mt mu mj b">HostListener</code>decorator来监听我们的<code class="fe ms mt mu mj b">highlight</code>指令所应用到的元素的<code class="fe ms mt mu mj b">mouseenter</code>和<code class="fe ms mt mu mj b">mouseleave</code>事件。</p><p id="3880" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，当我们悬停在文本上时，我们会看到它变成粉红色。否则，它会恢复正常颜色。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/f2198ec694e38d5d77fc0b683dd48141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qRAbtyIaSZDabf-u"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@aa_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrew Alexander</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="d212" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用@Input数据绑定将值传递到指令中</h1><p id="a727" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以像处理组件一样使用<code class="fe ms mt mu mj b">@Input</code>装饰器将数据传递给指令。</p><p id="853d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以这样写:</p><p id="034a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">highlight.directive.ts</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4290" class="mn lc iq mj b gy mo mp l mq mr">import { Directive, ElementRef, HostListener, Input } from '@angular/core';</span><span id="a188" class="mn lc iq mj b gy mv mp l mq mr">@Directive({<br/>  selector: '[appHighlight]'<br/>})<br/>export class HighlightDirective {<br/>  @Input() highlightColor: string;<br/>  constructor(private el: ElementRef) { }</span><span id="66f7" class="mn lc iq mj b gy mv mp l mq mr">  ngOnInit() {<br/>    this.el.nativeElement.style.color = this.highlightColor;<br/>  }<br/>}</span></pre><p id="8ff0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">app.component.html</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c396" class="mn lc iq mj b gy mo mp l mq mr">&lt;div appHighlight highlightColor='pink'&gt;foo&lt;/div&gt;</span></pre><p id="1bb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们添加了<code class="fe ms mt mu mj b">highlightColor</code>输入，然后在<code class="fe ms mt mu mj b">app.component.html</code>中传递颜色字符串来设置颜色。</p><p id="1484" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们将<code class="fe ms mt mu mj b">highlightColor</code>设置为粉色，所以我们将得到粉色文本。</p><h1 id="d13e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">绑定到@Input别名</h1><p id="a0e0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们把别名<code class="fe ms mt mu mj b">@Input</code>改成与指令名相同的名字，我们可以使上面的代码更短。</p><p id="0eae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="aacf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">highlight.directive.ts</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ff8f" class="mn lc iq mj b gy mo mp l mq mr">import { Directive, ElementRef, HostListener, Input } from '@angular/core';</span><span id="f30b" class="mn lc iq mj b gy mv mp l mq mr">@Directive({<br/>  selector: '[appHighlight]'<br/>})<br/>export class HighlightDirective {<br/>  @Input('appHighlight') highlightColor: string;<br/>  constructor(private el: ElementRef) { }</span><span id="370d" class="mn lc iq mj b gy mv mp l mq mr">  ngOnInit() {<br/>    this.el.nativeElement.style.color = this.highlightColor;<br/>  }<br/>}</span></pre><p id="0696" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们可以在<code class="fe ms mt mu mj b">app.component.html</code>中如下使用；</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b8d4" class="mn lc iq mj b gy mo mp l mq mr">&lt;div appHighlight='pink'&gt;foo&lt;/div&gt;</span></pre><p id="12e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我们所看到的，我们不再需要单独指定<code class="fe ms mt mu mj b">highlightColor</code>。</p><h1 id="abc9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">绑定到第二个属性</h1><p id="3d74" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以将多个<code class="fe ms mt mu mj b">@Input</code>绑定到多个属性。</p><p id="8fad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以这样写:</p><p id="d1b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">highlight.directive.ts</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4b07" class="mn lc iq mj b gy mo mp l mq mr">import { Directive, ElementRef, HostListener, Input } from '@angular/core';</span><span id="d6b1" class="mn lc iq mj b gy mv mp l mq mr">@Directive({<br/>  selector: '[appHighlight]'<br/>})<br/>export class HighlightDirective {<br/>  @Input('appHighlight') highlightColor: string;<br/>  @Input() defaultColor: string;<br/>  constructor(private el: ElementRef) { }</span><span id="c291" class="mn lc iq mj b gy mv mp l mq mr">  ngOnInit() {<br/>    this.el.nativeElement.style.color = this.highlightColor || this.defaultColor;<br/>  }<br/>}</span></pre><p id="d0ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们有两个<code class="fe ms mt mu mj b">@Inputs</code>，而不是一个。</p><p id="3ab4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以在<code class="fe ms mt mu mj b">app.component.html</code>中如下使用它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d6df" class="mn lc iq mj b gy mo mp l mq mr">&lt;div appHighlight='pink' defaultColor='yellow'&gt;foo&lt;/div&gt;<br/>&lt;div appHighlight defaultColor='green'&gt;bar&lt;/div&gt;</span></pre><p id="0964" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们在第二个div中没有设置任何颜色字符串的情况下应用了<code class="fe ms mt mu mj b">appHighlight</code>指令。</p><p id="c7c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，由于<code class="fe ms mt mu mj b">defaultColor</code>被设置为<code class="fe ms mt mu mj b">'green'</code>，它将按照我们在<code class="fe ms mt mu mj b">highlight.directive.ts</code>的<code class="fe ms mt mu mj b">ngOnInit</code>方法中指定的方式被应用。</p><h1 id="45a1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ef87" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们通过运行<code class="fe ms mt mu mj b">ng g directive</code>来定义属性指令，并用名字外面的括号给它们命名。</p><p id="3438" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe ms mt mu mj b">@Input</code> s传入属性，用<code class="fe ms mt mu mj b">@HostListener</code>监听事件。</p><p id="b6b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们获取指令所应用的元素，然后对其应用我们想要的任何样式。</p><p id="619a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【JavaScript用简单英语写的一句话:我们总是对帮助推广优质内容感兴趣。如果你有一篇文章想用简单的英语提交给JavaScript，用你的Medium用户名给我们发邮件到<a class="ae kc" href="mailto:submissions@javascriptinplainenglish.com" rel="noopener ugc nofollow" target="_blank">submissions@javascriptinplainenglish.com</a>，我们会把你添加为作者。</p></div></div>    
</body>
</html>