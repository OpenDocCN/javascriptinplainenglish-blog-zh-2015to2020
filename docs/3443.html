<html>
<head>
<title>How to display code coverage of a Vue project in Gitlab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨Gitlabä¸­æ˜¾ç¤ºVueé¡¹ç›®çš„ä»£ç è¦†ç›–ç‡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/how-to-display-code-coverage-of-a-vue-project-in-gitlab-9d1510a3e794?source=collection_archive---------1-----------------------#2020-09-29">https://javascript.plainenglish.io/how-to-display-code-coverage-of-a-vue-project-in-gitlab-9d1510a3e794?source=collection_archive---------1-----------------------#2020-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/d33eb15ce0789f1ab7cc33e37d2eeccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5Vu9Vuc6qSnZjZtc.png"/></div></div></figure><div class=""/><p id="85ee" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ‰äººå¯èƒ½ä¼šè®¤ä¸ºè¿™åº”è¯¥å¾ˆç®€å•ï¼Œä¸éœ€è¦å†™æ–‡ç« ï¼Œè‡³å°‘æˆ‘æ˜¯è¿™æ ·è®¤ä¸ºçš„ã€‚ä½†æ˜¯å½“æˆ‘è¯•å›¾ä¸ºæˆ‘çš„ä¸€äº›é¡¹ç›®è®¾ç½®å®ƒæ—¶ï¼Œå®ƒèŠ±è´¹äº†æˆ‘æ¯”æˆ‘é¢„æœŸå¤šå¾—å¤šçš„æ—¶é—´ã€‚</p><p id="7e74" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸ºäº†è®©å®ƒå‘æŒ¥ä½œç”¨ï¼Œä½ éœ€è¦è·¨è¶Šä¸€äº›éšœç¢ã€‚æ¯ä¸€ä¸ªéƒ½å¯ä»¥åœ¨äº’è”ç½‘ä¸Šçš„æŸä¸ªåœ°æ–¹æ‰¾åˆ°ï¼Œä½†æ˜¯æŠŠå®ƒä»¬éƒ½æ”¾åœ¨ä¸€èµ·æœ‰ç‚¹éº»çƒ¦ã€‚æ‰€ä»¥æˆ‘å†³å®šå†™ä¸€ä¸ªå¿«é€Ÿæ“ä½œæŒ‡å—ï¼ŒæŠŠæ‰€æœ‰çš„æŠ€å·§éƒ½æ”¾åœ¨ä¸€ä¸ªé¡µé¢ä¸Šã€‚</p><h1 id="c503" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">ç¬¬ä¸€ä¸ªé™·é˜±</h1><p id="51f6" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">å› ä¸ºæ‚¨å¯èƒ½å·²ç»åœ¨è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥æ‚¨çš„package.jsonä¸­åº”è¯¥å·²ç»æœ‰ä¸€ä¸ªç±»ä¼¼å¦‚ä¸‹çš„è„šæœ¬:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9aa7" class="mi kx jb me b gy mj mk l ml mm">"scripts": {<br/>	"serve": "vue-cli-service serve",<br/>	"build": "vue-cli-service build",<br/>	"test:unit": "vue-cli-service test:unit",<br/>	"lint:js": "vue-cli-service lint",<br/>	"lint:css": "stylelint \"src/**/*.scss\""<br/>}</span></pre><p id="50f7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç¬¬ä¸€ä¸ªçªé—¨æ¥äº†â€¦ Jestï¼ŒVue.jsé¡¹ç›®ä¸­çš„é»˜è®¤runnerï¼Œç»™æ§åˆ¶å°è¾“å‡ºç€è‰²ï¼Œä½¿å…¶æ›´å®¹æ˜“é˜…è¯»(å¤§å¤šæ•°runneréƒ½è¿™æ ·åš)ã€‚ä¸å¹¸çš„æ˜¯ï¼Œé¢œè‰²ä¸Gitlabè§£æå™¨ä¸å…¼å®¹ã€‚æ‰€ä»¥ä½ å¿…é¡»é€šè¿‡æ·»åŠ <strong class="ka jc"> â€”æ— è‰²</strong>å‚æ•°æ¥å…³é—­å®ƒã€‚</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="61fc" class="mi kx jb me b gy mj mk l ml mm">"scripts": {<br/>	"serve": "vue-cli-service serve",<br/>	"build": "vue-cli-service build",<br/>	"test:unit": "vue-cli-service test:unit <strong class="me jc">--no-color</strong>",<br/>	"lint:js": "vue-cli-service lint",<br/>	"lint:css": "stylelint \"src/**/*.scss\""<br/>}</span></pre><h1 id="ab1d" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">jesté…ç½®</h1><p id="8c7e" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">ä¸‹ä¸€æ­¥æ˜¯è®©jestæ”¶é›†è¦†ç›–ç‡å¹¶ç”ŸæˆGitlabèƒ½å¤Ÿè§£æçš„æŠ¥å‘Šã€‚ä¸ºæ­¤ï¼Œä½ å¿…é¡»ç¼–è¾‘<strong class="ka jc"> jest.config.js </strong>æ–‡ä»¶ã€‚<br/>é¦–å…ˆé€šè¿‡å°†<strong class="ka jc"> collectCoverage </strong>è®¾ç½®ä¸º<strong class="ka jc"> true </strong>æ¥æ¿€æ´»è¦†ç›–ç‡æ”¶é›†ï¼Œç„¶å<strong class="ka jc"> </strong>å°†<strong class="ka jc"> text-summary </strong>ç±»å‹æ·»åŠ åˆ°<strong class="ka jc"> coverageReporters </strong>åˆ—è¡¨ä¸­ã€‚</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="ea6c" class="mi kx jb me b gy mj mk l ml mm">module.exports = {<br/>	collectCoverage: <strong class="me jc">true</strong>,<br/>	collectCoverageFrom: ['src/**/*.js', '!**/node_modules/**'],<br/>	coverageDirectory: './coverage',<br/>	coverageReporters: ['html', 'text', '<strong class="me jc">text-summary</strong>'],<br/>	testMatch: ['**/tests/*.spec.js']<br/>};</span></pre><p id="be59" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™å°†åœ¨æ§åˆ¶å°è¾“å‡ºä¸­ç”Ÿæˆ<em class="mn"> coverage summary </em>éƒ¨åˆ†ï¼ŒGitlabä½œä¸šå¯ä»¥å¯¹å…¶è¿›è¡Œè§£æã€‚</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/5f102779a107a1839b2e10e6fd6ac173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RuwG_Vb8I5voXCXJQUdyjA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">The coverage summary section in the (colored) console reported with the text-summary parameter</figcaption></figure><p id="8b3a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ­¤å¤–ï¼Œä¸Šé¢çš„è®¾ç½®è¿˜ä¼šç”Ÿæˆä¸€ä¸ªHTMLæŠ¥å‘Šï¼Œè¿™ä¸ªæŠ¥å‘Šä¼šæ›´åŠ è¯¦ç»†ï¼Œæœ‰åŠ©äºæ‚¨æ‰¾åˆ°è¦†ç›–èŒƒå›´ä¸­çš„ç¼ºå£ã€‚</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/422953a8b2c97377aa4098dcc431bd44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zf-yRYHoFIJXUqbZF0fTNQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">The HTML report generated by jest</figcaption></figure><h1 id="b58b" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">è¯ä½“</h1><p id="e05e" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">è¿™é‡Œæ˜¾è€Œæ˜“è§çš„æ­¥éª¤æ˜¯è®©æ‚¨çš„CIè¿è¡Œæµ‹è¯•ï¼Œä»¥ä¾¿åœ¨Gitlabæ§åˆ¶å°ä¸­ç”Ÿæˆè¦†ç›–ç‡è¾“å‡ºã€‚è¿™éå¸¸ç®€å•ï¼Œå› ä¸ºå®ƒåªéœ€è¦ç”¨npmä»package.jsonè°ƒç”¨å•å…ƒæµ‹è¯•è„šæœ¬ã€‚</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="71f5" class="mi kx jb me b gy mj mk l ml mm">image: node<br/><br/>stages:<br/>  - test-unit<br/><br/>test-unit:<br/>  stage: test-unit<br/>  script: <strong class="me jc">npm run test:unit</strong><br/>  artifacts:<br/>    when: always<br/>    paths:<br/>      - coverage<br/>    expire_in: 30 days</span></pre><p id="3a9d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[å¯é€‰]æ‚¨å¯ä»¥æ·»åŠ çš„ä¸€ä¸ªå¥½å¤„æ˜¯å°†åŒ…å«HTMLæŠ¥å‘Šçš„coverageæ–‡ä»¶å¤¹ä¸Šä¼ åˆ°Gitlab artefactsã€‚è¿™æ ·ï¼Œè¯¥å·¥ä½œçš„æ¯ä¸ªäººéƒ½å¯ä»¥è·å¾—è¯¦ç»†çš„æŠ¥å‘Šã€‚</p><p id="27d0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ— è®ºé˜¶æ®µçš„ç»“æœå¦‚ä½•(æˆåŠŸæˆ–å¤±è´¥),éƒ½å°†å§‹ç»ˆä¸Šä¼ HTMLï¼Œå¹¶ä¸ä½œä¸šä¸€èµ·å­˜å‚¨30å¤©ã€‚</p><h1 id="53a8" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">é…ç½®Gitlab</h1><p id="a572" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">æœ€åä¸€æ­¥æ˜¯é…ç½®Gitlabè§£æå™¨ï¼Œç”¨ä¸€ä¸ªå°çš„æ­£åˆ™è¡¨è¾¾å¼ä»æ§åˆ¶å°ä¸­æ­£ç¡®åœ°é€‰æ‹©æˆ‘ä»¬çš„è¦†ç›–ç‡ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒGitlabé»˜è®¤ä¸æ”¯æŒJestï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾ä¸åˆ°ä¸€ä¸ªåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æœ‰æ•ˆçš„Jestï¼Œæ‰€ä»¥æˆ‘æƒ³å‡ºäº†è‡ªå·±çš„æ–¹æ³•:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="6cac" class="mi kx jb me b gy mj mk l ml mm"><strong class="me jc">Lines</strong>\s*:\s*(\d+.?\d*)%</span></pre><p id="2389" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½ åªéœ€è¦åœ¨ä½ é¡¹ç›®çš„<em class="mn"> CI/CDè®¾ç½®</em>çš„<em class="mn">é€šç”¨ç®¡é“</em>åŒºåŸŸæ·»åŠ ä¸Šé¢çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/d342580e3a8479009a345d6701b5a1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uR-wEY2ggABNTc3Hnpg6Pw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Regular expression used for test coverage parsing</figcaption></figure><p id="2b7b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨<strong class="ka jc">è¡Œ</strong>è¦†ç›–ï¼Œä½†æ˜¯å¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨<strong class="ka jc">è¯­å¥</strong>æˆ–è€…<strong class="ka jc">å‡½æ•°</strong>ï¼Œä½ åªéœ€è¦æ›¿æ¢æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„boldå…³é”®å­—ã€‚</p><h1 id="3946" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">åŒ…æ‰</h1><p id="b496" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">å°±è¿™æ ·â€¦ä¸‹æ¬¡è¿è¡Œæ‚¨çš„CIæ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°Jobsåˆ—è¡¨ä¸­çš„coverageåˆ—å¼€å§‹å¡«å……æ‚¨çš„ç»“æœ</p><figure class="lz ma mb mc gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/1c193558c16e06a38b4021ba4e3131b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98ZWHcJoJIijtzj8NG7yQQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Coverage under CI/CD &gt; Jobs</figcaption></figure><p id="cd6f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨<em class="mn"> Analytics &gt; Repository </em>ä¸‹ä¹Ÿæœ‰æ‚¨çš„è¦†ç›–èŒƒå›´çš„å›¾å½¢åŒ–å†å²è®°å½•</p><p id="5784" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨å”¯ä¸€è¦åšçš„å°±æ˜¯æé«˜è¦†ç›–ç‡ğŸ˜‰</p></div></div>    
</body>
</html>