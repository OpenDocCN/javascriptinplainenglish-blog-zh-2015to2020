<html>
<head>
<title>Create a custom form control component in Angular with Control Value Accessor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用控件值访问器在Angular中创建自定义窗体控件组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-custom-form-control-component-in-angular-with-control-value-accessor-807f1304bcd7?source=collection_archive---------1-----------------------#2020-07-15">https://javascript.plainenglish.io/create-a-custom-form-control-component-in-angular-with-control-value-accessor-807f1304bcd7?source=collection_archive---------1-----------------------#2020-07-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/733f73d9759a160bcab274497bbe69a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xdz_elME5sTYbJ4orn_guw.png"/></div></div></figure><blockquote class="jv"><p id="1bb6" class="jw jx in bd jy jz ka kb kc kd ke kf dk translated">“食谱什么也没告诉你。学习技巧是关键”——汤姆·库里其奥</p></blockquote><p id="d8c6" class="pw-post-body-paragraph kg kh in ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc kf ig bi ld translated"><span class="l le lf lg bm lh li lj lk ll di"> O </span>我如此喜欢angular的原因之一是它的开箱即用特性。Angular提供了设置典型web应用程序所需的几乎所有现成的东西。Angular team还提供了<a class="ae lm" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank"> material </a> library，其中包含经过良好测试并随时可用的有用组件。作为一个angular开发者，我们享受着如此多的便利。太好了！但是，我们的应用并不总是典型的！我们可能需要在应用程序中实现非常复杂的行为来满足业务逻辑。</p><p id="a1c2" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">这种满足业务逻辑的过程有时可能包括拥有一个自定义的表单控件。例如，您可能需要创建一个漂亮的定制搜索组件，以便在整个应用程序中重用。在不同的应用程序中，您可能需要一个测验组件，该组件可以与表单控件连接起来，以提高可重用性和可扩展性。可能是这样的👇</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/c219bf713c833b6cbb791373a77ea2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*-Nx5jMEr1WEd6OvZiHu8zA.png"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Quiz component</figcaption></figure><p id="fdc8" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">上述组件就是我们今天关注的内容！</p><p id="9b9c" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">你会如何建造它？</p><p id="0369" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">天真的做法是根本不使用定制组件。我们可以重复构建它所需的代码，使用<code class="fe mb mc md me b">*ngFor</code>进行循环，并对其使用<code class="fe mb mc md me b">ngModel</code>或<code class="fe mb mc md me b">formControl</code>。可以给你一个工作代码。但是，如果您想在应用程序的其他地方重用它，该怎么办呢？是的，你必须重复密码。我们都知道重复代码不是解决问题的方法，不是吗？</p><p id="2f75" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">我最初的一个更好的想法是创建一个自定义组件，将其命名为<code class="fe mb mc md me b">quiz.component.ts</code>，使用<code class="fe mb mc md me b">@<a class="ae lm" href="https://angular.io/api/core/Output" rel="noopener ugc nofollow" target="_blank">Output</a>, </code>为父组件上的事件添加一个事件监听器，并手动更改父组件上的答案。那可能行得通。但是嘿，如果我想用<code class="fe mb mc md me b"><a class="ae lm" href="https://angular.io/api/forms/NgModel" rel="noopener ugc nofollow" target="_blank">[(ngModel)]</a></code>绑定它呢？或者我想和<code class="fe mb mc md me b"><a class="ae lm" href="https://angular.io/api/forms/FormControl" rel="noopener ugc nofollow" target="_blank">formControl</a>?</code>一起用呢</p><p id="6b14" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">这似乎不是直截了当的，不是吗？</p><p id="3da9" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">但是幸运的是，angular提供了一种方便的方法来做到这一点。<br/> <strong class="ki io">我们来看看如何！</strong></p><h1 id="bec3" class="mf mg in bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">引入控制值访问器接口！</h1><p id="6e75" class="pw-post-body-paragraph kg kh in ki b kj nd kl km kn ne kp kq kr nf kt ku kv ng kx ky kz nh lb lc kf ig bi translated">角度<a class="ae lm" href="https://angular.io/api/forms/ControlValueAccessor" rel="noopener ugc nofollow" target="_blank"> <strong class="ki io">控制值访问器</strong> </a>可用于自定义与角度表单集成的表单控制指令。让我们看看医生怎么说</p><blockquote class="ni nj nk"><p id="91c7" class="kg kh nl ki b kj ln kl km kn lo kp kq nm lp kt ku nn lq kx ky no lr lb lc kf ig bi translated">定义一个接口，作为Angular forms API和DOM中的本地元素之间的桥梁。</p></blockquote><p id="053b" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">那听起来正是我们所需要的！</p><p id="5aee" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">我们可以创建自定义的测验组件，并利用<code class="fe mb mc md me b">ControlValueAccessor</code>在组件和表单API之间架起桥梁！</p><p id="e934" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">退出！我们开始吧。在我们跳到代码之前，我们需要创建我们的angular应用程序。</p><pre class="lt lu lv lw gt np me nq nr aw ns bi"><span id="b33f" class="nt mg in me b gy nu nv l nw nx">ng new ng-quiz</span></pre><p id="3682" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">现在我们已经准备好了我们的应用程序，继续创建我们的<em class="nl">测验组件。</em></p><pre class="lt lu lv lw gt np me nq nr aw ns bi"><span id="376a" class="nt mg in me b gy nu nv l nw nx">ng g c quiz</span></pre><p id="aff5" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">此时，我们的应用程序中有两个组件。即<code class="fe mb mc md me b">app.component</code>(通篇称为‘父组件’)<code class="fe mb mc md me b">quiz.component</code>(称为‘测验组件’或‘自定义组件’)。</p><p id="3141" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">现在让我们来看看<code class="fe mb mc md me b">ControlValueAccessor</code> <strong class="ki io"> </strong>接口<strong class="ki io"> </strong>和实现相同。通过实现<code class="fe mb mc md me b">ControlValueAccessor</code>接口并将自己注册为<code class="fe mb mc md me b">NG_VALUE_ACCESSOR</code>提供者，任何组件都可以变成<code class="fe mb mc md me b">ControlValueAccessor</code>。</p><p id="33a7" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated"><code class="fe mb mc md me b">ControlValueAccessor</code>实现以下方法</p><ol class=""><li id="436c" class="ny nz in ki b kj ln kn lo kr oa kv ob kz oc kf od oe of og bi translated"><strong class="ki io"> registerOnChange — </strong>注册一个回调函数，当控件的值在UI中改变时调用这个函数。</li><li id="1f55" class="ny nz in ki b kj oh kn oi kr oj kv ok kz ol kf od oe of og bi translated"><strong class="ki io"> writeValue — </strong>向元素写入一个值。</li><li id="b3e3" class="ny nz in ki b kj oh kn oi kr oj kv ok kz ol kf od oe of og bi translated"><strong class="ki io"> registerOnTouched — </strong>注册一个回调函数，该函数由表单API在初始化时调用，以在模糊时更新表单模型。</li><li id="901c" class="ny nz in ki b kj oh kn oi kr oj kv ok kz ol kf od oe of og bi translated"><strong class="ki io"> setDisabledState — </strong>当控件状态变为“禁用”或从“禁用”变为“禁用”时，由表单API调用的函数。根据状态，它启用或禁用适当的DOM元素。</li></ol><p id="35c0" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">当涉及到表单实现和验证时，上述所有方法都很有用。让我们看看如何利用这些方法并实现我们的<code class="fe mb mc md me b">quiz component</code>。</p><p id="6aae" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">我们的模板文件将如下所示👇</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="om on l"/></div></figure><blockquote class="ni nj nk"><p id="2d18" class="kg kh nl ki b kj ln kl km kn lo kp kq nm lp kt ku nn lq kx ky no lr lb lc kf ig bi translated">您需要导入<em class="in">模板驱动表单</em>或<em class="in">反应表单</em>模块，以便在您的模板中使用<code class="fe mb mc md me b">ngModel</code>。您可以在本文后面看到如何做到这一点。</p></blockquote><p id="d9b6" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">请注意，我在这里使用了<a class="ae lm" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank">材料组件</a>以获得更好的风格，这完全是可选的。</p><p id="48e1" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">代码是自我解释的。我们有一个将<code class="fe mb mc md me b">ngModel</code>绑定到名为<code class="fe mb mc md me b">value</code>的属性的单选按钮。相当主流的东西在这里，让我们来看看控制器的实现。</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="58d9" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">在上面的代码中，以下内容值得注意。</p><ol class=""><li id="d619" class="ny nz in ki b kj ln kn lo kr oa kv ob kz oc kf od oe of og bi translated">我们的自定义表单组件，<code class="fe mb mc md me b">QuizComponent</code>，现在的<code class="fe mb mc md me b">implements</code> <code class="fe mb mc md me b">ControlValueAccessor</code>，是从<code class="fe mb mc md me b">@angular/forms</code>导入的。</li><li id="609a" class="ny nz in ki b kj oh kn oi kr oj kv ok kz ol kf od oe of og bi translated">我们已经从<code class="fe mb mc md me b">@angular/forms</code>导入了<code class="fe mb mc md me b">NG_VALUE_ACCESSOR</code>并提供给了组件。</li><li id="96d6" class="ny nz in ki b kj oh kn oi kr oj kv ok kz ol kf od oe of og bi translated"><code class="fe mb mc md me b">formwardRef</code>是必需的，因为当提供者注册时，我们的类还没有被定义，我们需要告诉<strong class="ki io">提供者构造函数</strong>，这样它可以等待类被定义。</li></ol><p id="1a66" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">角度窗体控件不同于DOM窗体控件。angular所做的是绑定到DOM元素的输入/输出，并为您提供结果。通过提供<code class="fe mb mc md me b">NG_VALUE_ACCESSOR</code>,我们告诉Angular的表单API它如何从/向你的自定义表单控件读取和写入值。</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="f811" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">我们在这里使用了<code class="fe mb mc md me b">@Input</code>将特定的问题从父组件传递给我们的测验组件。另外，由<code class="fe mb mc md me b">ControlValueAccessor</code>实现的方法也被连接起来。您可以在这里使用这些未使用的方法(onChange、onTouch)来实现验证和禁用/启用表单元素状态等功能。</p><p id="47a0" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">差不多就是这样！现在，您拥有了一个全功能的自定义组件，可以在整个应用程序中与表单一起使用！</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Usage with ngModel</figcaption></figure><p id="0e55" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">这是我如何利用它的👆。或者，您可以将与表单控件一起使用，作为</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="om on l"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Usage form form control</figcaption></figure><p id="b47c" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">你可以在我的<a class="ae lm" href="https://github.com/BharathRavi27/angular-custom-form-value-accessor" rel="noopener ugc nofollow" target="_blank"> github </a>上找到完整的项目供参考。</p><p id="e242" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">更多类似的文章👇</p><div class="oo op gp gr oq or"><a href="https://bharathravi.com/" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd io gy z fp ow fr fs ox fu fw im bi translated">Bharath Ravi | javaScript文章</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">有能力的文章来提升你的网络技能。javaScript全栈开发者Bharath Ravi的个人博客</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">bharathravi.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf jt or"/></div></div></a></div><p id="5646" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">你可以在twitter <a class="ae lm" href="https://twitter.com/_bharath_ravi" rel="noopener ugc nofollow" target="_blank">这里</a>找到我。</p><p id="c64a" class="pw-post-body-paragraph kg kh in ki b kj ln kl km kn lo kp kq kr lp kt ku kv lq kx ky kz lr lb lc kf ig bi translated">黑客快乐！</p></div></div>    
</body>
</html>