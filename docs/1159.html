<html>
<head>
<title>More Useful Rxjs Creation Operators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更有用的Rxjs创建运算符</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/more-useful-rxjs-creation-operators-60f18c625349?source=collection_archive---------8-----------------------#2020-02-05">https://javascript.plainenglish.io/more-useful-rxjs-creation-operators-60f18c625349?source=collection_archive---------8-----------------------#2020-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/641a1dfb061b2812cd1bdb2bfbc28fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nq7pFosC0fObvTvQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@r3dmax?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jonatan Pie</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="821b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Rxjs是一个用于进行反应式编程的库。创建操作符对于从各种数据源生成供观察者订阅的数据非常有用。</p><p id="95f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究来自Rxjs的更多创建操作符，比如从事件处理程序创建观察值的函数，生成发出数字的观察值的函数，以及让我们有条件地订阅观察值的函数。</p><h1 id="cab2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">来自事件</h1><p id="064b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">fromEvent</code>函数创建一个可观察对象，当它发生在事件目标上时，发出我们指定类型的事件对象。</p><p id="d538" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它最多需要4个参数。第一个参数是事件目标。这是必须的。它可以是要附加事件处理程序的DOM事件目标、Node.js事件发射器、jQuery like事件目标、NodeList或HTMLCollection。</p><p id="9ef1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是事件目标发出的事件名称。</p><p id="a19f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三个参数是带有一些选项的可选参数。</p><p id="fd3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个参数是可选的结果选择器函数。</p><p id="498f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每次订阅观察对象时，事件处理函数将在给定的事件类型上注册到事件目标。</p><p id="a730" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当事件触发时，事件对象将由可观察对象发出。</p><p id="dd3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事件目标通过duck typing进行检查。如果对象上的对象公开了以下方法，我们可以安全地在对象上使用<code class="fe me mf mg mh b">fromEvent</code>:</p><ul class=""><li id="9087" class="mi mj iq kf b kg kh kk kl ko mk ks ml kw mm la mn mo mp mq bi translated">DOM事件目标，如果它有<code class="fe me mf mg mh b">addEventLister</code>和<code class="fe me mf mg mh b">removeEventListener</code>方法</li><li id="5ca1" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">Node.js事件发射器，如果它有<code class="fe me mf mg mh b">addListener</code>和<code class="fe me mf mg mh b">removeListener</code>方法的话</li><li id="00ae" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">jQuery样式对象，如果它有<code class="fe me mf mg mh b">on</code>和<code class="fe me mf mg mh b">off</code>方法的话</li><li id="6630" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">DOM NodeLists或HtmlCollection，如果它们有一个由DOM节点的<code class="fe me mf mg mh b">document.querySelectorAll</code>或<code class="fe me mf mg mh b">childNodes</code>属性等方法返回的DOM节点列表。</li></ul><p id="5349" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">fromEvent</code>如下:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="d71e" class="ne lc iq mh b gy nf ng l nh ni">import { fromEvent } from "rxjs";</span><span id="c2a4" class="ne lc iq mh b gy nj ng l nh ni">const clicks = fromEvent(window, "click");<br/>clicks.subscribe(x =&gt; console.log(x));</span></pre><p id="8fcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码监视对<code class="fe me mf mg mh b">document</code>对象的点击。当我们单击浏览器选项卡上的任意位置时，我们应该会看到记录的<code class="fe me mf mg mh b">MouseEvent</code>对象。</p><h1 id="256e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">fromEventPattern</h1><p id="4aec" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这类似于<code class="fe me mf mg mh b">fromEvent</code>，除了我们传入了用于添加事件监听器和移除事件监听器的处理函数。</p><p id="5d60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要三个参数。前两个分别是添加和删除处理程序。移除处理程序是可选的。最后一个参数是可选的结果选择器函数，用于操作发出的值。</p><p id="bde4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以使用它来检测ID为<code class="fe me mf mg mh b">app</code>的<code class="fe me mf mg mh b">div</code>上的点击，如下所示:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="519f" class="ne lc iq mh b gy nf ng l nh ni">import { fromEventPattern } from "rxjs";</span><span id="ca38" class="ne lc iq mh b gy nj ng l nh ni">const app = document.querySelector("#app");</span><span id="4fbc" class="ne lc iq mh b gy nj ng l nh ni">function addClickHandler(handler) {<br/>  app.addEventListener("click", handler);<br/>}</span><span id="62f1" class="ne lc iq mh b gy nj ng l nh ni">function removeClickHandler(handler) {<br/>  app.removeEventListener("click", handler);<br/>}</span><span id="5be5" class="ne lc iq mh b gy nj ng l nh ni">const clicks = fromEventPattern(addClickHandler, removeClickHandler);<br/>clicks.subscribe(x =&gt; console.log(x));</span></pre><p id="9c77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们单击ID为<code class="fe me mf mg mh b">app</code>的div上的任意位置时，我们应该会看到记录的<code class="fe me mf mg mh b">MouseEvent</code>对象。</p><h1 id="7230" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">产生</h1><p id="45b8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">generate</code>函数通过传入初始状态创建一个带有值流的可观察对象，一个带有结束值发送的条件的函数，一个遍历值的函数，一个选择发送结果的结果选择器函数，以及一个改变值发送时间的调度器对象。</p><p id="dd6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只需要初始状态。例如，我们可以通过编写以下内容来创建一个发出值0到9的可观察对象:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="0f41" class="ne lc iq mh b gy nf ng l nh ni">import { generate } from "rxjs";</span><span id="7d69" class="ne lc iq mh b gy nj ng l nh ni">const generated = generate(0, x =&gt; x &lt; 10, x =&gt; x + 1);<br/>generated.subscribe(<br/>  value =&gt; console.log(value),<br/>  err =&gt; {}<br/>);</span></pre><p id="2cc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">generate</code>函数调用的第一个参数具有要发出的第一个值或初始状态。第二个有结束条件，小于10。最后一个参数具有指示如何继续前进并发出下一个项目以及向第二个参数中的结束条件前进的功能。</p><h1 id="f309" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">间隔</h1><p id="2f0f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">interval</code>创建一个在特定时间间隔内发出连续数字的可观察对象。</p><p id="c1f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有两个可选参数。第一个是由调度程序的时钟决定的毫秒数或时间单位。默认值为0。</p><p id="85aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是要使用的调度器，默认为<code class="fe me mf mg mh b">async</code>。</p><p id="e960" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="014f" class="ne lc iq mh b gy nf ng l nh ni">import { interval } from "rxjs";</span><span id="83c5" class="ne lc iq mh b gy nj ng l nh ni">const numbers = interval(1000);</span></pre><p id="380b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建每秒发出一个新值的可观察对象。</p><h1 id="a420" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">关于</h1><p id="6f43" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这就产生了一个可观察的论点。</p><p id="3291" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要无数个参数。</p><p id="4bfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="5146" class="ne lc iq mh b gy nf ng l nh ni">import { of } from "rxjs";</span><span id="53df" class="ne lc iq mh b gy nj ng l nh ni">of(1, 2, 3).subscribe(<br/>  val =&gt; console.log(val),<br/>  err =&gt; console.log(err),<br/>  () =&gt; console.log("end")<br/>);</span></pre><h1 id="f6c4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">范围</h1><p id="9144" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">range</code>来创建一个在指定范围内发出一系列数字的可观察对象。</p><p id="28ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有3个可选参数，这是开始，默认为0。要生成的整数个数，默认为<code class="fe me mf mg mh b">undefined</code>和要使用的调度程序，默认为<code class="fe me mf mg mh b">undefined</code>。</p><p id="c6db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以使用它来创建一个可观察对象，它发出数字1到20，如下所示:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="9a88" class="ne lc iq mh b gy nf ng l nh ni">import { range } from "rxjs";</span><span id="f7af" class="ne lc iq mh b gy nj ng l nh ni">const numbers = range(1, 20);<br/>numbers.subscribe(x =&gt; console.log(x));</span></pre><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/345f62c3dd1d5cfe13d4e2382f314185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zu9BtO1ER7qdLxr-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@thiiagocerqueira?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thiago Cerqueira</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="c925" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">投掷误差</h1><p id="f094" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">创建一个只发出错误通知的可观察对象。</p><p id="61d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它最多需要两个参数。第一个是要发出的错误。第二个是可选的调度器参数，让我们选择调度器。默认为<code class="fe me mf mg mh b">undefined</code>。</p><p id="b642" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以如下使用它:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="50e1" class="ne lc iq mh b gy nf ng l nh ni">import { throwError } from "rxjs";</span><span id="ee7d" class="ne lc iq mh b gy nj ng l nh ni">const numbers = throwError("error");<br/>numbers.subscribe(() =&gt; {}, err =&gt; console.log(err));</span></pre><p id="f903" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们订阅了第二个参数中的错误通知。</p><h1 id="3d7d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">计时器</h1><p id="9ab7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">timer</code>创建一个在指定时间后开始发出值并在指定间隔后发出不断增加的数字的可观察对象。</p><p id="32f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是可观测开始发射的时间，默认为0。数字以毫秒为单位。</p><p id="f5b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是发射值的周期，默认为<code class="fe me mf mg mh b">undefined</code>。数字以毫秒为单位。</p><p id="2895" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个参数是要使用的调度器，默认为<code class="fe me mf mg mh b">undefined</code>。</p><p id="6a80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以创建一个可观察对象，在2秒钟后发出值，然后通过编写以下内容每秒发出一次值:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="6a7f" class="ne lc iq mh b gy nf ng l nh ni">import { timer } from "rxjs";</span><span id="fda3" class="ne lc iq mh b gy nj ng l nh ni">const numbers = timer(2000, 1000);<br/>numbers.subscribe(x =&gt; console.log(x));</span></pre><h1 id="da81" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">间接免疫荧光</h1><p id="5721" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们创建一个观察对象，它决定在订阅时订阅哪个观察对象。</p><p id="d4e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最多需要3个参数。第一个是选择可观察对象的条件。第二个和第三个参数是分别在条件为真和假时选择的可观察值。</p><p id="86fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mw mx my mz gt na mh nb nc aw nd bi"><span id="70c9" class="ne lc iq mh b gy nf ng l nh ni">import { iif, of } from "rxjs";</span><span id="3a52" class="ne lc iq mh b gy nj ng l nh ni">let wantFoo;<br/>const fooBar = iif(() =&gt; wantFoo, of("foo"), of("bar"));</span><span id="fedb" class="ne lc iq mh b gy nj ng l nh ni">wantFoo = true;<br/>fooBar.subscribe(val =&gt; console.log(val));</span><span id="28c0" class="ne lc iq mh b gy nj ng l nh ni">wantFoo = false;<br/>fooBar.subscribe(val =&gt; console.log(val));</span></pre><p id="8fdd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，如果<code class="fe me mf mg mh b">wantFoo</code>是<code class="fe me mf mg mh b">true</code>，当<code class="fe me mf mg mh b">of('foo')</code>被订阅时。否则，<code class="fe me mf mg mh b">of('bar')</code>就订阅了。</p><p id="6244" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">fromEvent</code>创建操作符创建处理DOM或Node.js事件的Observables。</p><p id="4a73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运算符让我们可以从任何对象列表中创建可观测量。</p><p id="2e25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">throw</code>只抛出一个错误，其他什么都不做。</p><p id="33dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">generate</code>、<code class="fe me mf mg mh b">interval</code>和<code class="fe me mf mg mh b">range</code>让我们创建发出数字范围的可观测量。</p><p id="d8d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">timer</code>让我们创建定时观察值，而<code class="fe me mf mg mh b">iif</code>让我们创建条件观察值。</p></div></div>    
</body>
</html>