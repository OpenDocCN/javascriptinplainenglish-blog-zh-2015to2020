<html>
<head>
<title>A Complete Guide to Upload JSON files in Amazon S3 using AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda在亚马逊S3上传JSON文件的完整指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-complete-guide-to-upload-json-file-in-s3-using-aws-lambda-bb14112ee2b6?source=collection_archive---------2-----------------------#2020-11-30">https://javascript.plainenglish.io/a-complete-guide-to-upload-json-file-in-s3-using-aws-lambda-bb14112ee2b6?source=collection_archive---------2-----------------------#2020-11-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="29c0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在S3上传文件，我们必须遵循一些步骤。让我们开始做这些步骤。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/de919ba1ed3a7b99b76fc56b0330835a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-lyKrCqo2Pkem3Do"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clément Hélardot</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="e41c" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak">打造S3斗</strong></h2><p id="0599" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">第一步是在<a class="ae ks" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank">亚马逊S3控制台</a>中创建一个S3桶，点击<strong class="lr io">创建桶</strong>按钮。您将重定向到此页面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/f6f20dc4b85fb1358367dab6f4204022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bVFv0ih8U7q_pLwsRO-LLQ.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">creating an s3 bucket</figcaption></figure><p id="6da6" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在在<strong class="lr io">桶名</strong>字段输入一个名称。然后向下滚动，您将看到黄色的<strong class="lr io">创建存储桶</strong>按钮，单击该按钮。它将为您创建一个存储桶，您将在列表中看到它。</p><h2 id="f617" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">创建Lambda函数</h2><p id="b79d" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">在<a class="ae ks" href="https://console.aws.amazon.com/lambda" rel="noopener ugc nofollow" target="_blank"> AWS Lambda控制台</a>中创建Lambda函数，点击<strong class="lr io">创建函数</strong>按钮。您将重定向到此页面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/680bde9b99b010de346f7794dcc5cbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9mxZc0i3JMvheNOCmMAPw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Creating a lambda function</figcaption></figure><p id="3ccc" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">在<strong class="lr io">功能名称</strong>字段中输入功能名称。如果您已经创建了lambda函数，那么您可以选择<strong class="lr io">使用蓝图。</strong>如果没有，你必须从头选择<strong class="lr io">作者</strong>并向下滚动点击<strong class="lr io">创建功能</strong>按钮。您将看到如下所示的内容。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/fae08a16c8c21ea7bb3ab1aa50f2963b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qt5XHpdPa1d72WL005AhhQ.jpeg"/></div></div></figure><h2 id="3d5c" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak">创建一个项目</strong></h2><p id="d26f" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">打开您的终端并输入以下命令。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="2df8" class="kt ku in mp b gy mt mu l mv mw">$ mkdir lambda-tutorial &amp;&amp; cd lambda-tutorial</span><span id="a72e" class="kt ku in mp b gy mx mu l mv mw">$ npm init -y</span><span id="c3e9" class="kt ku in mp b gy mx mu l mv mw">$ npm i aws-sdk</span><span id="d46e" class="kt ku in mp b gy mx mu l mv mw">$ touch index.js</span></pre><p id="94f9" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">通过输入这些命令，它将创建一个项目并安装<code class="fe my mz na mp b">aws-sdk </code>包和<code class="fe my mz na mp b">index.js</code>文件。这将需要在代码上创建逻辑。现在在你喜欢的代码编辑器上打开<code class="fe my mz na mp b">index.js</code>。例如，您想用VS代码打开。输入以下命令。你可以用Atom，Sublime text来做这个。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="d241" class="kt ku in mp b gy mt mu l mv mw">$ code ./index.js</span></pre><p id="3690" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在在这个文件中输入下面的代码。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="d04f" class="kt ku in mp b gy mt mu l mv mw">const AWS <em class="nb">=</em> require('aws-sdk');</span><span id="0a4b" class="kt ku in mp b gy mx mu l mv mw">const s3 <em class="nb">=</em> <em class="nb">new</em> AWS<em class="nb">.S3</em>({<br/><em class="nb">  accessKeyId</em>: 'YOUR_ACCESS_KEY', <em class="nb">// replace with your access key<br/>  secretAccessKey</em>: 'YOUR_SECRET_KEY', <em class="nb">// replace with your secret   key<br/></em>});</span><span id="62e0" class="kt ku in mp b gy mx mu l mv mw"><em class="nb">exports.</em>handler <em class="nb">=</em> async (event, context, callback) =&gt; {<br/>/*<br/> HANDLE DATA WHICH ARE SENT FROM CLINT APP.<br/> HERE I JUST ADD STATIC DATA <br/>*/<br/>   const s3Bucket <em class="nb">=</em> 'YOUR_BUCKET_NAME'; <em class="nb">// replace with your bucket name<br/>  </em>const objectName <em class="nb">=</em> 'helloworld.json'; <em class="nb">// File name which you want to put in s3 bucket<br/>  </em>const objectData <em class="nb">=</em> '{ "message" : "Hello World!" }'; <em class="nb">// file data you want to put<br/>  </em>const objectType <em class="nb">=</em> 'application/json'; <em class="nb">// type of file</em></span><span id="e07b" class="kt ku in mp b gy mx mu l mv mw"><em class="nb">  try</em> {</span><span id="bc9d" class="kt ku in mp b gy mx mu l mv mw"><em class="nb">    // setup params for putObject<br/>    </em>const params <em class="nb">=</em> {<br/>       <em class="nb">Bucket</em>: s3Bucket,<br/>       <em class="nb">Key</em>: objectName,<br/>       <em class="nb">Body</em>: objectData,<br/>       <em class="nb">ContentType</em>: objectType,<br/>    };</span><span id="39dd" class="kt ku in mp b gy mx mu l mv mw">    const result <em class="nb">=</em> <em class="nb">await</em> s3<em class="nb">.</em>putObject(params)<em class="nb">.</em>promise();</span><span id="1fc5" class="kt ku in mp b gy mx mu l mv mw">    console<em class="nb">.</em>log(`File uploaded successfully at https:/` <em class="nb">+ </em>s3Bucket <em class="nb">+   </em>`.s3.amazonaws.com/` <em class="nb">+ </em>objectName);<br/>  } <em class="nb">catch</em> (error) {<br/>    console<em class="nb">.</em>log('error');<br/>  }<br/>};</span></pre><h2 id="9395" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak">在Lambda上部署代码</strong></h2><p id="f956" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">现在我们将把代码部署到lambda函数中。我们需要将我们的项目转换成zip格式。压缩后，进入<a class="ae ks" href="https://console.aws.amazon.com/lambda" rel="noopener ugc nofollow" target="_blank"> AWS Lambda控制台</a>并选择我们在步骤2中创建的函数。您将重定向到此页面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/fae08a16c8c21ea7bb3ab1aa50f2963b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qt5XHpdPa1d72WL005AhhQ.jpeg"/></div></div></figure><p id="af83" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">向下滚动到<strong class="lr io">功能代码</strong>部分。点击<strong class="lr io">动作</strong>按钮，选择<strong class="lr io">上传. zip文件</strong>并上传您之前创建的zip文件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/c201681a9111e17f2cf199d42fc1bede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jw_wyyw_zwi8hCGN46gWfw.jpeg"/></div></div></figure><p id="8473" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">更新成功后，您将在编辑器中看到代码。现在你会看到<strong class="lr io">动作</strong>按钮旁边的<strong class="lr io">展开</strong>按钮。点击<strong class="lr io">测试</strong>按钮并创建测试。创建后，再次测试点击<strong class="lr io">测试</strong>按钮。然后你会看到这样一个日志。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/8ab62eb90843d15adc29d6a01901e6b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgiZgDmz8G4Z58l_ugcwxg.jpeg"/></div></div></figure><p id="9dca" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">此外，您可以确认它是否已成功添加。进入<a class="ae ks" href="https://console.aws.amazon.com/s3" rel="noopener ugc nofollow" target="_blank">亚马逊S3控制台</a>选择你创建的桶。在<strong class="lr io">物体</strong>部分，你会看到如下图。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/f6d8cc6b00d0e238b6cb859b13907792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQ_EvwfXRTKTypgzsDoP8w.jpeg"/></div></div></figure><p id="a810" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在我们想从客户端应用程序调用我们的lambda函数。为此，我们必须执行以下步骤。</p><h2 id="2804" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">使用AWS API网关创建API</h2><p id="ed8f" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">转到<a class="ae ks" href="https://console.aws.amazon.com/apigateway" rel="noopener ugc nofollow" target="_blank">亚马逊API网关控制台</a>，点击<strong class="lr io">创建API </strong>，然后选择HTTP API，在那里你会找到<strong class="lr io">构建</strong>按钮。现在，您必须遵循4个步骤来创建一个API。</p><p id="e3eb" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io">第一步。</strong>输入API名称。另外，选择integrations作为lambda，并添加我们已经创建的lambda函数。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/5c64f1776f9ececa34aa18013e16652a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWUfu3M5VLRWxHWasapp2Q.jpeg"/></div></div></figure><p id="f4b0" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io">第二步。</strong>选择一个方法并为API添加一个路径。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/988109f8d630feb93208e85f47d78c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Vzjoi0UwdxrnxuVP5HH2Q.jpeg"/></div></div></figure><p id="209e" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io">步骤三。</strong>为API定义一个阶段。对于这个教程，我不需要任何舞台。因此，我将它作为默认设置。如果你需要你可以添加。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/05d9d0eb1512b0a42784f13e617a1e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqbiYivMrLqJG7dKzg9IRw.jpeg"/></div></div></figure><p id="9e39" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io">第四步。</strong>回顾一切正确与否。如果没有，可以点击<strong class="lr io">编辑</strong>按钮进行编辑。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/39692a25e2430e8249a60de2375e0d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGo9y8VOtvDlFYjPCbKBiQ.jpeg"/></div></div></figure><p id="4219" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">正确完成这些步骤后，现在点击<strong class="lr io">创建</strong>按钮。它将为您创建一个API，该API使用后端作为我们指定的lambda函数。现在，您将看到如下所示的内容。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/e46818a3a9d3b5e12c3ec7b65da6430c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTEk-L5m4ELBjxJyNCsXow.jpeg"/></div></div></figure><p id="e40a" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在复制<strong class="lr io">调用URL。这是我们下一步需要的。我们还必须做另一件事，那就是我们的客户将来自不同的域，为此我们必须启用<strong class="lr io"> CORS </strong>。要启用CORS，请转到<a class="ae ks" href="https://console.aws.amazon.com/apigateway/" rel="noopener ugc nofollow" target="_blank">亚马逊API网关控制台</a>选择您已经创建的API。从左侧导航，在<strong class="lr io">开发</strong>部分点击<strong class="lr io"> CORS </strong>选项卡。你看下面这样。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/f4946e8960050f44ccbaefbabc8ab213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZqSZ6ZgPGH-8-OLivelzg.jpeg"/></div></div></figure><p id="6cd9" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在点击<strong class="lr io">配置</strong>按钮，添加你希望被允许的源代码、头文件和方法。为了这个教程的目的，我在下面添加一些东西。您可以根据需要进行定制。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/c7cfbe5cc1b7809011b27bfe94323210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TIXrnEJ24EMbyzb3Iq1n3g.jpeg"/></div></div></figure><h2 id="3d3a" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">构建客户端应用程序</h2><p id="ae2a" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">现在我们将使用ReactJs构建一个客户端应用程序。我们开始吧。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="4315" class="kt ku in mp b gy mt mu l mv mw">$ npx create-react-app call-lambda &amp;&amp; cd call-lambda</span></pre><p id="8748" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">你想请求我们的API调用lambda函数。对于请求，我们将使用<code class="fe my mz na mp b">axios</code>包。要安装它，请输入以下命令。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="6805" class="kt ku in mp b gy mt mu l mv mw">$ yarn add axios</span><span id="6ffe" class="kt ku in mp b gy mx mu l mv mw">or,</span><span id="a6a1" class="kt ku in mp b gy mx mu l mv mw">$ npm i axios</span></pre><p id="68b9" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在打开App.js文件，并在文件中添加以下代码。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="92b4" class="kt ku in mp b gy mt mu l mv mw">import React from 'react';<br/>import axios from 'axios';</span><span id="6903" class="kt ku in mp b gy mx mu l mv mw">function App() {<br/>  const api = 'YOUR_URL'; // enter the URL copied from prev. step<br/>  const data = { name: 'Jhon Doe', age: 40 }<br/>  const handleClick = () =&gt; {<br/>    axios.post(api, data)<br/>      .then(res =&gt; console.log(res))<br/>      .catch(err =&gt; console.log(err))<br/>  }</span><span id="5348" class="kt ku in mp b gy mx mu l mv mw">return(<br/>     &lt;div&gt;<br/>        &lt;button onClick={() =&gt; handleClick()}&gt;Upload File&lt;/button&gt;<br/>     &lt;/div&gt;<br/>  )<br/>}</span><span id="5804" class="kt ku in mp b gy mx mu l mv mw">export default App;</span></pre><p id="7054" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在运行客户端应用程序。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="ea1e" class="kt ku in mp b gy mt mu l mv mw">$ yarn start</span></pre><p id="33c9" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">现在点击<strong class="lr io">上传文件</strong>按钮，这将调用我们的lambda函数并将文件放在我们的S3桶中。</p><p id="edcf" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">恭喜你。您已经成功地使用AWS Lambda在S3完成了JSON文件的上传过程。这是一次非常漫长的旅程。我希望你的时间没有浪费。你学到了新的东西。我感谢你的努力。</p></div></div>    
</body>
</html>