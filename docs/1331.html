<html>
<head>
<title>Guide to the Express Response Object — Redirection and Templates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速响应对象指南—重定向和模板</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/guide-to-the-express-response-object-redirection-and-templates-f6714591bd50?source=collection_archive---------3-----------------------#2020-03-02">https://javascript.plainenglish.io/guide-to-the-express-response-object-redirection-and-templates-f6714591bd50?source=collection_archive---------3-----------------------#2020-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a6f70d35e715ad3a3cb5f8838925b263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sFoG_YRdWc_mX8OW"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@gabrielbenois?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Gabriel Benois</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d412" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Express response对象允许我们向客户端发送响应。</p><p id="1a9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以发送各种响应，比如字符串、JSON和文件。此外，除了主体之外，我们还可以向客户端发送各种标头和状态代码。</p><p id="0ff8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将查看响应对象的各种属性，包括发送<code class="fe lb lc ld le b">Links</code>响应头、重定向到不同的路径和URL，以及呈现HTML。</p><h1 id="f0a8" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">方法</h1><h2 id="42c6" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源链接(链接)</h2><p id="eb90" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated"><code class="fe lb lc ld le b">links</code>方法将一个带有链接的对象连接在一起，并发送带有链接的<code class="fe lb lc ld le b">Link</code>响应头。</p><p id="177c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="2cf8" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="aaa8" class="md lg iq le b gy ng nd l ne nf">const app = express();</span><span id="1101" class="md lg iq le b gy ng nd l ne nf">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="3bcc" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res<br/>    .links({<br/>      next: '<a class="ae kc" href="http://foo.com?page=1'" rel="noopener ugc nofollow" target="_blank">http://foo.com?page=1'</a>,<br/>      last: '<a class="ae kc" href="http://foo.com?page=2'" rel="noopener ugc nofollow" target="_blank">http://foo.com?page=2'</a><br/>    })<br/>    .send();<br/>});</span><span id="e41e" class="md lg iq le b gy ng nd l ne nf">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="0999" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe lb lc ld le b">Link</code>响应头的值是:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="cecf" class="md lg iq le b gy nc nd l ne nf">&lt;http://foo.com?page=1&gt;; rel="next", &lt;http://foo.com?page=2&gt;; rel="last"</span></pre><p id="d895" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们向<code class="fe lb lc ld le b">/</code>路径提出请求时。</p><h2 id="be9a" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源位置(路径)</h2><p id="00b9" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated"><code class="fe lb lc ld le b">location</code>方法发送带有指定的<code class="fe lb lc ld le b">path</code>参数作为值的<code class="fe lb lc ld le b">Location</code>响应头。</p><p id="f3dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="f37f" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="7a82" class="md lg iq le b gy ng nd l ne nf">const app = express();</span><span id="570e" class="md lg iq le b gy ng nd l ne nf">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="daa2" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res<br/>    .location('<a class="ae kc" href="http://medium.com'" rel="noopener">http://medium.com'</a>)<br/>    .send();<br/>});</span><span id="dd9d" class="md lg iq le b gy ng nd l ne nf">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="023f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="9a94" class="md lg iq le b gy nc nd l ne nf">http://medium.com</span></pre><p id="358a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们向<code class="fe lb lc ld le b">/</code>路由发出请求时，作为<code class="fe lb lc ld le b">Location</code>响应头的值。</p><h2 id="069d" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">资源重定向([状态，]路径)</h2><p id="1ed5" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated"><code class="fe lb lc ld le b">redirect</code>方法重定向到用指定的<code class="fe lb lc ld le b">status</code>指定的URL或路径。如果未指定状态，默认值为302。</p><p id="5872" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以如下使用它来重定向到另一个路由:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="b2bc" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="9e10" class="md lg iq le b gy ng nd l ne nf">const app = express();</span><span id="fc6d" class="md lg iq le b gy ng nd l ne nf">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="ccd1" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res.redirect('/bar');<br/>});</span><span id="3d91" class="md lg iq le b gy ng nd l ne nf">app.get('/bar', (req, res) =&gt; {<br/>  res.send('bar');<br/>});</span><span id="1d2f" class="md lg iq le b gy ng nd l ne nf">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="c7ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们应该看到<code class="fe lb lc ld le b">bar</code>，因为我们重定向到了<code class="fe lb lc ld le b">bar</code>路线。</p><p id="d7a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以指定如下状态代码:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="e08c" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="59f8" class="md lg iq le b gy ng nd l ne nf">const app = express();</span><span id="a8ae" class="md lg iq le b gy ng nd l ne nf">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="bff9" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>  res.redirect(301, '/bar');<br/>});</span><span id="f5fa" class="md lg iq le b gy ng nd l ne nf">app.get('/bar', (req, res) =&gt; {<br/>  res.send('bar');<br/>});</span><span id="5faa" class="md lg iq le b gy ng nd l ne nf">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="348f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以重定向到完整的URL:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="0ffc" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="55e5" class="md lg iq le b gy ng nd l ne nf">const app = express();</span><span id="9040" class="md lg iq le b gy ng nd l ne nf">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="fd34" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>    res.redirect('<a class="ae kc" href="http://google.com'" rel="noopener ugc nofollow" target="_blank">http://google.com'</a>);<br/>});</span><span id="9391" class="md lg iq le b gy ng nd l ne nf">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="30a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，当我们在浏览器中进入<code class="fe lb lc ld le b">/</code>时，我们会在浏览器中显示Google。</p><p id="1225" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用以下内容重定向回推荐人:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="24e9" class="md lg iq le b gy nc nd l ne nf">res.redirect('back')</span></pre><p id="bfd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以重定向到一个更高级别的URL，默认为<code class="fe lb lc ld le b">/</code>。</p><p id="a789" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以如下使用它:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="c92f" class="md lg iq le b gy nc nd l ne nf">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="0ed6" class="md lg iq le b gy ng nd l ne nf">const app = express();<br/>const post = express.Router();</span><span id="dbb9" class="md lg iq le b gy ng nd l ne nf">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="981c" class="md lg iq le b gy ng nd l ne nf">post.get('/', (req, res) =&gt; {<br/>    res.redirect('..');<br/>});</span><span id="b090" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res) =&gt; {<br/>    res.send('hi');<br/>});</span><span id="1507" class="md lg iq le b gy ng nd l ne nf">app.use('/post', post);</span><span id="49ac" class="md lg iq le b gy ng nd l ne nf">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="02c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，如果我们转到<code class="fe lb lc ld le b">/post</code>，就会得到<code class="fe lb lc ld le b">hi</code>，因为我们看到了重定向到<code class="fe lb lc ld le b">'..'</code>。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/0ae9f543d59dcd224b15cfcd0dc2dc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sCOTK0P7Xt_jVsV7"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@joanna_nix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joanna Nix</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="778a" class="md lg iq bd lh me mf dn ll mg mh dp lp ko mi mj lt ks mk ml lx kw mm mn mb mo bi translated">res.render(视图[，局部变量] [，回调])</h2><p id="c91f" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated"><code class="fe lb lc ld le b">res.render</code>让我们使用模板来呈现HTML。一旦我们设置了HTML模板引擎，我们就可以使用模板文件来显示结果。</p><p id="0cb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对象拥有我们可以在模板中访问的属性。</p><p id="9bbb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe lb lc ld le b">callback</code>可以得到错误和呈现的HTML字符串。</p><p id="b9d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">view</code>参数包含带有模板文件名的字符串。视图的文件夹是在我们调用<code class="fe lb lc ld le b">res.render</code>之前设置的，所以我们不需要完整的文件夹名。</p><p id="cf88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以使用Pug模板来呈现模板，如下所示:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="b2d5" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))<br/>app.set('views', './views');<br/>app.set('view engine', 'pug');</span><span id="941d" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.render('index', { pageTitle: 'Hello', pageMessage: 'Hello there!' });<br/>})<br/>app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="d3b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以将名为<code class="fe lb lc ld le b">index.pug</code>的模板文件添加到<code class="fe lb lc ld le b">views</code>文件夹中，如下所示:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="f0d1" class="md lg iq le b gy nc nd l ne nf">html<br/>  head<br/>    title= pageTitle<br/>  body<br/>    h1= pageMessage</span></pre><p id="3088" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8de497e743943d3f840d8062e903648d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*NZveSR9C3jb5p2Uo8iiQZg.png"/></div></figure><p id="3c9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以向render方法传递一个回调，如下所示:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="0439" class="md lg iq le b gy nc nd l ne nf">const express = require('express')<br/>const app = express()<br/>app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))<br/>app.set('views', './views');<br/>app.set('view engine', 'pug');</span><span id="1466" class="md lg iq le b gy ng nd l ne nf">app.get('/', (req, res, next) =&gt; {<br/>  res.render(<br/>    'index',<br/>    { pageTitle: 'Hello', pageMessage: 'Hello there!' },<br/>    (err, html) =&gt; {<br/>      if (err) {<br/>        next(err);<br/>      }<br/>      else {<br/>        console.log(html);<br/>      }<br/>    }<br/>  );<br/>})<br/>app.listen(3000);</span></pre><p id="467b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们从<code class="fe lb lc ld le b">console.log</code>中得到渲染后的HTML:</p><pre class="mu mv mw mx gt my le mz na aw nb bi"><span id="23ad" class="md lg iq le b gy nc nd l ne nf">&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Hello there!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre><p id="455d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何错误都将通过<code class="fe lb lc ld le b">next</code>功能发送到快速错误处理器。</p><h1 id="9af2" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="c19f" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">我们可以用<code class="fe lb lc ld le b">render</code>方法渲染HTML结果。</p><p id="19dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe lb lc ld le b">redirect</code>方法，我们可以用不同的响应代码重定向到不同的路径和URL。</p><p id="0249" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe lb lc ld le b">links</code>和<code class="fe lb lc ld le b">locations</code>方法分别发送<code class="fe lb lc ld le b">Links</code>和<code class="fe lb lc ld le b">Locations</code>响应头。</p></div></div>    
</body>
</html>