<html>
<head>
<title>Create Custom Jest Matchers to Test Like a Pro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建自定义笑话匹配器，像专业人士一样进行测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-custom-jest-matchers-to-test-like-a-pro-3ee5f3d7a702?source=collection_archive---------1-----------------------#2020-02-19">https://javascript.plainenglish.io/create-custom-jest-matchers-to-test-like-a-pro-3ee5f3d7a702?source=collection_archive---------1-----------------------#2020-02-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1d12625677eb112534ad0f6f30815f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JIKIgyM9ZNpUqQKn.png"/></div></div></figure><p id="1bcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jest是JS项目的行业标准测试框架。它是由脸书开发的，用来测试他们的代码，并且是开源的。在本文中，我将教你创建自定义的笑话匹配器来增强你的测试技能。</p><h1 id="956a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是火柴人？</h1><p id="2e63" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">匹配器(或断言)是用于检查特定条件的函数。最常见的是，它比较两个值。以下是Jest中可用的一些基本匹配:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="85a2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么我们需要定制匹配器？</h1><p id="a7c5" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">虽然Jest是非常强大的开箱即用，但总有一些特定于项目的东西可以添加。它应该通过为常见用例创建自定义Jest匹配器来提高可读性并减少代码量。</p><p id="26dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的一个项目中，我必须测试某个值是否是格式正确的ISO日期。这可以用正则表达式来完成，但是我不得不测试它很多次，把这个逻辑移到一个定制的Jest matcher是值得的。</p><h1 id="72d3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">添加安装文件</h1><p id="09b0" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在我们添加匹配器本身之前，为Jest添加一个设置文件是很重要的。设置文件是一个用来设置环境和做一些事情的文件，比如添加自定义匹配器、启用模拟和配置jest。在项目根目录下创建一个名为<code class="fe mg mh mi mj b">setupJest.js</code>的文件，这将是我们的设置文件。现在你需要将这一行添加到你的Jest配置中(在<code class="fe mg mh mi mj b">package.json</code>或<code class="fe mg mh mi mj b">jest.config.js</code>):</p><pre class="ma mb mc md gt mk mj ml mm aw mn bi"><span id="d25c" class="mo ky iq mj b gy mp mq l mr ms">"setupFilesAfterEnv": ["./setupJest.js"]</span></pre><p id="7ea8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">React Native/Expo用户注意事项</strong>:如果您正在使用jest-expo预设，这将不起作用。问题是预置覆盖了<code class="fe mg mh mi mj b">setupFilesAfterEnv</code>设置。要避免这种情况，请像这样编写您的配置:</p><p id="b54c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您覆盖预设的<code class="fe mg mh mi mj b">setupFilesAfterEnv</code>设置并添加您自己的文件。</p><h1 id="25bc" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">编写自定义笑话匹配器</h1><p id="5a7a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在这个例子中，我将编写一个匹配器来检查一个字符串是否是格式正确的ISO日期。这是使用<code class="fe mg mh mi mj b">expect.extend</code>功能完成的。它接受一个对象，该对象的键是匹配器名称，值是执行实际匹配的函数。下面是进入<code class="fe mg mh mi mj b">setupJest.js</code>的代码:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="a6b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以看到<code class="fe mg mh mi mj b">toBeISODate</code>是一个接受单个值<code class="fe mg mh mi mj b">received</code>的函数。您可以接受更多的参数，这些参数将被直接传递给匹配器(稍后会详细介绍)。在第4-6行，我们对照regexp检查<code class="fe mg mh mi mj b">received</code>，在第14-15行，我们检查JS是否能正确解析<code class="fe mg mh mi mj b">received</code>。</p><p id="ce14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">匹配器必须返回一个具有两个属性的对象:<code class="fe mg mh mi mj b">pass</code>和<code class="fe mg mh mi mj b">message</code>。<code class="fe mg mh mi mj b">pass</code>很简单:如果检查通过则为真，否则为假。<code class="fe mg mh mi mj b">message</code>稍微有点混乱。当<code class="fe mg mh mi mj b">pass=false</code>时，<code class="fe mg mh mi mj b">message</code>是<code class="fe mg mh mi mj b">expect(something).toBeISODate()</code>失败时显示的错误。当<code class="fe mg mh mi mj b">pass=true</code>时，<code class="fe mg mh mi mj b">message</code>是当<code class="fe mg mh mi mj b">expect(something).not.toBeISODate()</code>失败时将显示的错误。它永远不会显示测试是否通过。现在你可以这样使用这个匹配器:</p><pre class="ma mb mc md gt mk mj ml mm aw mn bi"><span id="542d" class="mo ky iq mj b gy mp mq l mr ms">const timestamp = get_timestamp_from_somewhere_unreliable(); expect(timestamp).toBeISODate();</span></pre><h1 id="7375" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">接受更多的论点</h1><p id="21c6" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated"><code class="fe mg mh mi mj b">toBeISODate()</code>匹配器不接受任何额外的参数，也不需要接受。但是，假设我们想写一个匹配器来检查一个数是否是其他数的幂。下面是这样一个匹配器的代码，<code class="fe mg mh mi mj b">toBePowerOf()</code>:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="a00b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它接受另一个参数，<code class="fe mg mh mi mj b">power</code>。您可以像这样在代码中使用这个匹配器:</p><pre class="ma mb mc md gt mk mj ml mm aw mn bi"><span id="5591" class="mo ky iq mj b gy mp mq l mr ms">expect(8).toBePowerOf(2); // passes <br/>expect(10).toBePowerOf(3); //fails expect('abacaba').toBePowerOf(); // throws</span></pre><p id="e484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢您阅读本文，希望对您有所帮助。查看我关于JavaScript的其他文章:</p><div class="mt mu gp gr mv mw"><a href="https://medium.com/javascript-in-plain-english/improve-your-redux-skills-by-writing-custom-middleware-32a70b9dfb25" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">通过编写定制中间件来提高您的Redux技能</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">在本文中，我将教您编写定制的中间件来扩展Redux的功能，并深入了解</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">medium.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk jw mw"/></div></div></a></div><div class="mt mu gp gr mv mw"><a href="https://medium.com/javascript-in-plain-english/react-usememo-and-when-you-should-use-it-e69a106bbb02" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">React.useMemo以及何时应该使用它</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">尽管React经过了很好的优化，开箱即用，但了解它提供的制作工具非常重要…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">medium.com</p></div></div><div class="nf l"><div class="nl l nh ni nj nf nk jw mw"/></div></div></a></div><div class="mt mu gp gr mv mw"><a href="https://medium.com/javascript-in-plain-english/10-javascript-interview-questions-for-2020-697b40de9480" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">2020年10个JavaScript面试问题</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">随着对JS开发人员需求的增长，你必须做好准备。这里有10个问题可以帮助你…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">medium.com</p></div></div><div class="nf l"><div class="nm l nh ni nj nf nk jw mw"/></div></div></a></div><figure class="ma mb mc md gt jr gh gi paragraph-image"><a href="http://eepurl.com/gYiA29"><div class="gh gi nn"><img src="../Images/446049aa060bbaea15a64e1a907b1030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*zWeFS3E1gbkEuBmpbvm6Rg.jpeg"/></div></a></figure></div></div>    
</body>
</html>